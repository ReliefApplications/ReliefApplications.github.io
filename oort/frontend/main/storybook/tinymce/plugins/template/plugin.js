!function(){"use strict";var type,global$4=tinymce.util.Tools.resolve("tinymce.PluginManager"),isString=(type="string",function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}),isFunction=function(type){return function(value){return typeof value===type}}("function"),noop=function(){},constant=function(value){return function(){return value}},identity=function(x){return x};var call,id,never=constant(!1),always=constant(!0),global$3=tinymce.util.Tools.resolve("tinymce.util.Tools"),global$2=tinymce.util.Tools.resolve("tinymce.util.XHR"),getModificationDateClasses=function(editor){return editor.getParam("template_mdate_classes","mdate")},getTemplateReplaceValues=function(editor){return editor.getParam("template_replace_values")},getMdateFormat=function(editor){return editor.getParam("template_mdate_format",editor.translate("%Y-%m-%d"))},addZeros=function(value,len){if((value=""+value).length<len)for(var i=0;i<len-value.length;i++)value="0"+value;return value},getDateTime=function(editor,fmt,date){void 0===date&&(date=new Date);var daysShort="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),daysLong="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),monthsShort="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsLong="January February March April May June July August September October November December".split(" ");return fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=fmt.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+date.getFullYear())).replace("%y",""+date.getYear())).replace("%m",addZeros(date.getMonth()+1,2))).replace("%d",addZeros(date.getDate(),2))).replace("%H",""+addZeros(date.getHours(),2))).replace("%M",""+addZeros(date.getMinutes(),2))).replace("%S",""+addZeros(date.getSeconds(),2))).replace("%I",""+((date.getHours()+11)%12+1))).replace("%p",date.getHours()<12?"AM":"PM")).replace("%B",""+editor.translate(monthsLong[date.getMonth()]))).replace("%b",""+editor.translate(monthsShort[date.getMonth()]))).replace("%A",""+editor.translate(daysLong[date.getDay()]))).replace("%a",""+editor.translate(daysShort[date.getDay()]))).replace("%%","%")},replaceTemplateValues=function(html,templateValues){return global$3.each(templateValues,(function(v,k){isFunction(v)&&(v=v(k)),html=html.replace(new RegExp("\\{\\$"+k+"\\}","g"),v)})),html},replaceVals=function(editor,scope){var dom=editor.dom,vl=getTemplateReplaceValues(editor);global$3.each(dom.select("*",scope),(function(e){global$3.each(vl,(function(v,k){dom.hasClass(e,k)&&isFunction(v)&&v(e)}))}))},hasClass=function(n,c){return new RegExp("\\b"+c+"\\b","g").test(n.className)},insertTemplate=function(editor,_ui,html){var dom=editor.dom,sel=editor.selection.getContent();html=replaceTemplateValues(html,getTemplateReplaceValues(editor));var el=dom.create("div",null,html),n=dom.select(".mceTmpl",el);n&&n.length>0&&(el=dom.create("div",null)).appendChild(n[0].cloneNode(!0)),global$3.each(dom.select("*",el),(function(n){hasClass(n,function(editor){return editor.getParam("template_cdate_classes","cdate")}(editor).replace(/\s+/g,"|"))&&(n.innerHTML=getDateTime(editor,function(editor){return editor.getParam("template_cdate_format",editor.translate("%Y-%m-%d"))}(editor))),hasClass(n,getModificationDateClasses(editor).replace(/\s+/g,"|"))&&(n.innerHTML=getDateTime(editor,getMdateFormat(editor))),hasClass(n,function(editor){return editor.getParam("template_selected_content_classes","selcontent")}(editor).replace(/\s+/g,"|"))&&(n.innerHTML=sel)})),replaceVals(editor,el),editor.execCommand("mceInsertContent",!1,el.innerHTML),editor.addVisual()},none=function(){return NONE},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant("none()")},some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some,none,from:function(value){return null==value?NONE:some(value)}},find=function(xs,pred){return function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()}(xs,pred,never)},global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.util.Promise"),hasOwnProperty=Object.hasOwnProperty,has=function(obj,key){return hasOwnProperty.call(obj,key)},entitiesAttr={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},htmlEscape=function(html){return html.replace(/["'<>&]/g,(function(match){return(obj=entitiesAttr,key=match,has(obj,key)?Optional.from(obj[key]):Optional.none()).getOr(match);var obj,key}))},open=function(editor,templateList){var createSelectBoxItems=function(templates){return function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}(templates,(function(t){return{text:t.text,value:t.text}}))},findTemplate=function(templates,templateTitle){return find(templates,(function(t){return t.text===templateTitle}))},loadFailedAlert=function(api){editor.windowManager.alert("Could not load the specified template.",(function(){return api.focus("template")}))},getTemplateContent=function(t){return new global((function(resolve,reject){t.value.url.fold((function(){return resolve(t.value.content.getOr(""))}),(function(url){return global$2.send({url,success:function(html){resolve(html)},error:function(e){reject(e)}})}))}))},onChange=function(templates,updateDialog){return function(api,change){if("template"===change.name){var newTemplateTitle=api.getData().template;findTemplate(templates,newTemplateTitle).each((function(t){api.block("Loading..."),getTemplateContent(t).then((function(previewHtml){updateDialog(api,t,previewHtml)})).catch((function(){updateDialog(api,t,""),api.disable("save"),loadFailedAlert(api)}))}))}}},onSubmit=function(templates){return function(api){var data=api.getData();findTemplate(templates,data.template).each((function(t){getTemplateContent(t).then((function(previewHtml){editor.execCommand("mceInsertTemplate",!1,previewHtml),api.close()})).catch((function(){api.disable("save"),loadFailedAlert(api)}))}))}};(function(){if(!templateList||0===templateList.length){var message=editor.translate("No templates defined.");return editor.notificationManager.open({text:message,type:"info"}),Optional.none()}return Optional.from(global$3.map(templateList,(function(template,index){var isUrlTemplate=function(t){return void 0!==t.url};return{selected:0===index,text:template.title,value:{url:isUrlTemplate(template)?Optional.from(template.url):Optional.none(),content:isUrlTemplate(template)?Optional.none():Optional.from(template.content),description:template.description}}})))})().each((function(templates){var selectBoxItems=createSelectBoxItems(templates),buildDialogSpec=function(bodyItems,initialData){return{title:"Insert Template",size:"large",body:{type:"panel",items:bodyItems},initialData,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:onSubmit(templates),onChange:onChange(templates,updateDialog)}},updateDialog=function(dialogApi,template,previewHtml){var content=function(editor,html){if(-1===html.indexOf("<html>")){var contentCssEntries_1="",contentStyle=function(editor){return editor.getParam("content_style","","string")}(editor),cors_1=function(editor){return editor.getParam("content_css_cors",!1,"boolean")}(editor)?' crossorigin="anonymous"':"";global$3.each(editor.contentCSS,(function(url){contentCssEntries_1+='<link type="text/css" rel="stylesheet" href="'+editor.documentBaseURI.toAbsolute(url)+'"'+cors_1+">"})),contentStyle&&(contentCssEntries_1+='<style type="text/css">'+contentStyle+"</style>");var bodyClass=function(editor){var bodyClass=editor.getParam("body_class","","string");return-1===bodyClass.indexOf("=")?bodyClass:function(editor){return editor.getParam("body_class","","hash")[editor.id]||""}(editor)}(editor),encode=editor.dom.encode,preventClicksOnLinksScript='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(global$1.mac?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);<\/script> ",directionality=editor.getBody().dir,dirAttr=directionality?' dir="'+encode(directionality)+'"':"";html='<!DOCTYPE html><html><head><base href="'+encode(editor.documentBaseURI.getURI())+'">'+contentCssEntries_1+preventClicksOnLinksScript+'</head><body class="'+encode(bodyClass)+'"'+dirAttr+">"+html+"</body></html>"}return replaceTemplateValues(html,function(editor){return editor.getParam("template_preview_replace_values")}(editor))}(editor,previewHtml),bodyItems=[{type:"selectbox",name:"template",label:"Templates",items:selectBoxItems},{type:"htmlpanel",html:'<p aria-live="polite">'+htmlEscape(template.value.description)+"</p>"},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1}],initialData={template:template.text,preview:content};dialogApi.unblock(),dialogApi.redial(buildDialogSpec(bodyItems,initialData)),dialogApi.focus("template")},dialogApi=editor.windowManager.open(buildDialogSpec([],{template:"",preview:""}));dialogApi.block("Loading..."),getTemplateContent(templates[0]).then((function(previewHtml){updateDialog(dialogApi,templates[0],previewHtml)})).catch((function(){updateDialog(dialogApi,templates[0],""),dialogApi.disable("save"),loadFailedAlert(dialogApi)}))}))},register$1=function(editor){editor.addCommand("mceInsertTemplate",function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}(insertTemplate,editor)),editor.addCommand("mceTemplate",function(editor,callback){return function(){var templateList=function(editor){return editor.getParam("templates")}(editor);isFunction(templateList)?templateList(callback):isString(templateList)?global$2.send({url:templateList,success:function(text){callback(JSON.parse(text))}}):callback(templateList)}}(editor,function(editor){return function(templates){open(editor,templates)}}(editor)))};!function Plugin(){global$4.add("template",(function(editor){!function(editor){var onAction=function(){return editor.execCommand("mceTemplate")};editor.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onAction}),editor.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onAction})}(editor),register$1(editor),function(editor){editor.on("PreProcess",(function(o){var dom=editor.dom,dateFormat=getMdateFormat(editor);global$3.each(dom.select("div",o.node),(function(e){dom.hasClass(e,"mceTmpl")&&(global$3.each(dom.select("*",e),(function(e){dom.hasClass(e,getModificationDateClasses(editor).replace(/\s+/g,"|"))&&(e.innerHTML=getDateTime(editor,dateFormat))})),replaceVals(editor,e))}))}))}(editor)}))}()}();