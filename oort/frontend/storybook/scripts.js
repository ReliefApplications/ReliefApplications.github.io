/*! For license information please see scripts.js.LICENSE.txt */
!function(global,factory){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,(function(window,noGlobal){"use strict";var arr=[],getProto=Object.getPrototypeOf,slice=arr.slice,flat=arr.flat?function(array){return arr.flat.call(array)}:function(array){return arr.concat.apply([],array)},push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),support={},isFunction=function isFunction(obj){return"function"==typeof obj&&"number"!=typeof obj.nodeType&&"function"!=typeof obj.item},isWindow=function isWindow(obj){return null!=obj&&obj===obj.window},document=window.document,preservedScriptAttributes={type:!0,src:!0,nonce:!0,noModule:!0};function DOMEval(code,node,doc){var i,val,script=(doc=doc||document).createElement("script");if(script.text=code,node)for(i in preservedScriptAttributes)(val=node[i]||node.getAttribute&&node.getAttribute(i))&&script.setAttribute(i,val);doc.head.appendChild(script).parentNode.removeChild(script)}function toType(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj}var jQuery=function(selector,context){return new jQuery.fn.init(selector,context)};function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);return!isFunction(obj)&&!isWindow(obj)&&("array"===type||0===length||"number"==typeof length&&length>0&&length-1 in obj)}jQuery.fn=jQuery.prototype={jquery:"3.6.0",constructor:jQuery,length:0,toArray:function(){return slice.call(this)},get:function(num){return null==num?slice.call(this):num<0?this[num+this.length]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,(function(elem,i){return callback.call(elem,i,elem)})))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(jQuery.grep(this,(function(_elem,i){return(i+1)%2})))},odd:function(){return this.pushStack(jQuery.grep(this,(function(_elem,i){return i%2})))},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)copy=options[name],"__proto__"!==name&&target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(src=target[name],clone=copyIsArray&&!Array.isArray(src)?[]:copyIsArray||jQuery.isPlainObject(src)?src:{},copyIsArray=!1,target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+("3.6.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isPlainObject:function(obj){var proto,Ctor;return!(!obj||"[object Object]"!==toString.call(obj))&&(!(proto=getProto(obj))||"function"==typeof(Ctor=hasOwn.call(proto,"constructor")&&proto.constructor)&&fnToString.call(Ctor)===ObjectFunctionString)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},globalEval:function(code,options,doc){DOMEval(code,{nonce:options&&options.nonce},doc)},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;i<length&&!1!==callback.call(obj[i],i,obj[i]);i++);else for(i in obj)if(!1===callback.call(obj[i],i,obj[i]))break;return obj},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)!callback(elems[i],i)!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;i<length;i++)null!=(value=callback(elems[i],i,arg))&&ret.push(value);else for(i in elems)null!=(value=callback(elems[i],i,arg))&&ret.push(value);return flat(ret)},guid:1,support:support}),"function"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(_i,name){class2type["[object "+name+"]"]=name.toLowerCase()}));var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),nonnativeSelectorCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,pushNative=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",attributes="\\[[\\x20\\t\\r\\n\\f]*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),rcomma=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),rcombinators=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),rdescend=new RegExp(whitespace+"|>"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},rhtml=/HTML$/i,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),funescape=function(escape,nonHex){var high="0x"+escape.slice(1)-65536;return nonHex||(high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320))},rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){return asCodePoint?"\0"===ch?"ï¿½":ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ":"\\"+ch},unloadHandler=function(){setDocument()},inDisabledFieldset=addCombinator((function(elem){return!0===elem.disabled&&"fieldset"===elem.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){pushNative.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&(setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!nonnativeSelectorCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))&&(1!==nodeType||"object"!==context.nodeName.toLowerCase())){if(newSelector=selector,newContext=context,1===nodeType&&(rdescend.test(selector)||rcombinators.test(selector))){for((newContext=rsibling.test(selector)&&testContext(context.parentNode)||context)===context&&support.scope||((nid=context.getAttribute("id"))?nid=nid.replace(rcssescape,fcssescape):context.setAttribute("id",nid=expando)),i=(groups=tokenize(selector)).length;i--;)groups[i]=(nid?"#"+nid:":scope")+" "+toSelector(groups[i]);newSelector=groups.join(",")}try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){nonnativeSelectorCache(selector,!0)}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el)}catch(e){return!1}finally{el.parentNode&&el.parentNode.removeChild(el),el=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){return"form"in elem?elem.parentNode&&!1===elem.disabled?"label"in elem?"label"in elem.parentNode?elem.parentNode.disabled===disabled:elem.disabled===disabled:elem.isDisabled===disabled||elem.isDisabled!==!disabled&&inDisabledFieldset(elem)===disabled:elem.disabled===disabled:"label"in elem&&elem.disabled===disabled}}function createPositionalPseudo(fn){return markFunction((function(argument){return argument=+argument,markFunction((function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))}))}))}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var namespace=elem&&elem.namespaceURI,docElem=elem&&(elem.ownerDocument||elem).documentElement;return!rhtml.test(namespace||docElem&&docElem.nodeName||"HTML")},setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;return doc!=document&&9===doc.nodeType&&doc.documentElement?(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),preferredDoc!=document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow&&(subWindow.addEventListener?subWindow.addEventListener("unload",unloadHandler,!1):subWindow.attachEvent&&subWindow.attachEvent("onunload",unloadHandler)),support.scope=assert((function(el){return docElem.appendChild(el).appendChild(document.createElement("div")),void 0!==el.querySelectorAll&&!el.querySelectorAll(":scope fieldset div").length})),support.attributes=assert((function(el){return el.className="i",!el.getAttribute("className")})),support.getElementsByTagName=assert((function(el){return el.appendChild(document.createComment("")),!el.getElementsByTagName("*").length})),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert((function(el){return docElem.appendChild(el).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length})),support.getById?(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}):(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem];for(elems=context.getElementsByName(id),i=0;elem=elems[i++];)if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem]}return[]}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert((function(el){var input;docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",el.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),el.querySelectorAll("[selected]").length||rbuggyQSA.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+booleans+")"),el.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),(input=document.createElement("input")).setAttribute("name",""),el.appendChild(input),el.querySelectorAll("[name='']").length||rbuggyQSA.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),el.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),el.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]"),el.querySelectorAll("\\\f"),rbuggyQSA.push("[\\r\\n\\f]")})),assert((function(el){el.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden"),el.appendChild(input).setAttribute("name","D"),el.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==el.querySelectorAll(":enabled").length&&rbuggyQSA.push(":enabled",":disabled"),docElem.appendChild(el).disabled=!0,2!==el.querySelectorAll(":disabled").length&&rbuggyQSA.push(":enabled",":disabled"),el.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")}))),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert((function(el){support.disconnectedMatch=matches.call(el,"*"),matches.call(el,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)})),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)==(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a==document||a.ownerDocument==preferredDoc&&contains(preferredDoc,a)?-1:b==document||b.ownerDocument==preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a==document?-1:b==document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]==preferredDoc?-1:bp[i]==preferredDoc?1:0},document):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if(setDocument(elem),support.matchesSelector&&documentIsHTML&&!nonnativeSelectorCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){nonnativeSelectorCache(expr,!0)}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!=document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!=document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape)},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+className+"("+whitespace+"|$)"))&&classCache(className,(function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")}))},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,_argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,_context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction((function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])})):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction((function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction((function(seed,matches,_context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))})):function(elem,_context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}})),has:markFunction((function(selector){return function(elem){return Sizzle(selector,elem).length>0}})),contains:markFunction((function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||getText(elem)).indexOf(text)>-1}})),lang:markFunction((function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}})),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo((function(){return[0]})),last:createPositionalPseudo((function(_matchIndexes,length){return[length-1]})),eq:createPositionalPseudo((function(_matchIndexes,length,argument){return[argument<0?argument+length:argument]})),even:createPositionalPseudo((function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),odd:createPositionalPseudo((function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),lt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument>length?length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes})),gt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes}))}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&"parentNode"===key,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml);return!1}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}),skip&&skip===elem.nodeName.toLowerCase())elem=elem[dir]||elem;else{if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(uniqueCache[key]=newCache,newCache[2]=matcher(elem,context,xml))return!0}return!1}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction((function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)}))}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator((function(elem){return elem===checkContext}),implicitRelative,!0),matchAnyContext=addCombinator((function(elem){return indexOf(checkContext,elem)>-1}),implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context==document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument==document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert((function(el){return 1&el.compareDocumentPosition(document.createElement("fieldset"))})),assert((function(el){return el.innerHTML="<a href='#'></a>","#"===el.firstChild.getAttribute("href")}))||addHandle("type|href|height|width",(function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)})),support.attributes&&assert((function(el){return el.innerHTML="<input/>",el.firstChild.setAttribute("value",""),""===el.firstChild.getAttribute("value")}))||addHandle("value",(function(elem,_name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue})),assert((function(el){return null==el.getAttribute("disabled")}))||addHandle(booleans,(function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null})),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains,jQuery.escapeSelector=Sizzle.escape;var dir=function(elem,dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},siblings=function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched},rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()}var rsingleTag=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function winnow(elements,qualifier,not){return isFunction(qualifier)?jQuery.grep(elements,(function(elem,i){return!!qualifier.call(elem,i,elem)!==not})):qualifier.nodeType?jQuery.grep(elements,(function(elem){return elem===qualifier!==not})):"string"!=typeof qualifier?jQuery.grep(elements,(function(elem){return indexOf.call(qualifier,elem)>-1!==not})):jQuery.filter(qualifier,elements,not)}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,(function(elem){return 1===elem.nodeType})))},jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter((function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0})));for(ret=this.pushStack([]),i=0;i<len;i++)jQuery.find(selector,self[i],ret);return len>1?jQuery.uniqueSort(ret):ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,"string"==typeof selector){if(!(match="<"===selector[0]&&">"===selector[selector.length-1]&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return(elem=document.getElementById(match[2]))&&(this[0]=elem,this.length=1),this}return selector.nodeType?(this[0]=selector,this.length=1,this):isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):jQuery.makeArray(selector,this)}).prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter((function(){for(var i=0;i<l;i++)if(jQuery.contains(this,targets[i]))return!0}))},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets="string"!=typeof selectors&&jQuery(selectors);if(!rneedsContext.test(selectors))for(;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(targets?targets.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?"string"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,_i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,_i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,_i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return null!=elem.contentDocument&&getProto(elem.contentDocument)?elem.contentDocument:(nodeName(elem,"template")&&(elem=elem.content||elem),jQuery.merge([],elem.childNodes))}},(function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}}));var rnothtmlwhite=/[^\x20\t\r\n\f]+/g;function Identity(v){return v}function Thrower(ex){throw ex}function adoptValue(value,resolve,reject,noValue){var method;try{value&&isFunction(method=value.promise)?method.call(value).done(resolve).fail(reject):value&&isFunction(method=value.then)?method.call(value,resolve,reject):resolve.apply(void 0,[value].slice(noValue))}catch(value){reject.apply(void 0,[value])}}jQuery.Callbacks=function(options){options="string"==typeof options?function createOptions(options){var object={};return jQuery.each(options.match(rnothtmlwhite)||[],(function(_,flag){object[flag]=!0})),object}(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){for(locked=locked||options.once,fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)!1===list[firingIndex].apply(memory[0],memory[1])&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,locked&&(list=memory?[]:"")},self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,(function(_,arg){isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==toType(arg)&&add(arg)}))}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,(function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),index<=firingIndex&&firingIndex--})),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){return list&&(list=[]),this},disable:function(){return locked=queue=[],list=memory="",this},disabled:function(){return!list},lock:function(){return locked=queue=[],memory||firing||(list=memory=""),this},locked:function(){return!!locked},fireWith:function(context,args){return locked||(args=[context,(args=args||[]).slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},catch:function(fn){return promise.then(null,fn)},pipe:function(){var fns=arguments;return jQuery.Deferred((function(newDefer){jQuery.each(tuples,(function(_i,tuple){var fn=isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]]((function(){var returned=fn&&fn.apply(this,arguments);returned&&isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+"With"](this,fn?[returned]:arguments)}))})),fns=null})).promise()},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){var that=this,args=arguments,mightThrow=function(){var returned,then;if(!(depth<maxDepth)){if((returned=handler.apply(that,args))===deferred.promise())throw new TypeError("Thenable self-resolution");then=returned&&("object"==typeof returned||"function"==typeof returned)&&returned.then,isFunction(then)?special?then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special)):(maxDepth++,then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith))):(handler!==Identity&&(that=void 0,args=[returned]),(special||deferred.resolveWith)(that,args))}},process=special?mightThrow:function(){try{mightThrow()}catch(e){jQuery.Deferred.exceptionHook&&jQuery.Deferred.exceptionHook(e,process.stackTrace),depth+1>=maxDepth&&(handler!==Thrower&&(that=void 0,args=[e]),deferred.rejectWith(that,args))}};depth?process():(jQuery.Deferred.getStackHook&&(process.stackTrace=jQuery.Deferred.getStackHook()),window.setTimeout(process))}}return jQuery.Deferred((function(newDefer){tuples[0][3].add(resolve(0,newDefer,isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith)),tuples[1][3].add(resolve(0,newDefer,isFunction(onFulfilled)?onFulfilled:Identity)),tuples[2][3].add(resolve(0,newDefer,isFunction(onRejected)?onRejected:Thrower))})).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return jQuery.each(tuples,(function(i,tuple){var list=tuple[2],stateString=tuple[5];promise[tuple[1]]=list.add,stateString&&list.add((function(){state=stateString}),tuples[3-i][2].disable,tuples[3-i][3].disable,tuples[0][2].lock,tuples[0][3].lock),list.add(tuple[3].fire),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?void 0:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith})),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(singleValue){var remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=slice.call(arguments),primary=jQuery.Deferred(),updateFunc=function(i){return function(value){resolveContexts[i]=this,resolveValues[i]=arguments.length>1?slice.call(arguments):value,--remaining||primary.resolveWith(resolveContexts,resolveValues)}};if(remaining<=1&&(adoptValue(singleValue,primary.done(updateFunc(i)).resolve,primary.reject,!remaining),"pending"===primary.state()||isFunction(resolveValues[i]&&resolveValues[i].then)))return primary.then();for(;i--;)adoptValue(resolveValues[i],updateFunc(i),primary.reject);return primary.promise()}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){window.console&&window.console.warn&&error&&rerrorNames.test(error.name)&&window.console.warn("jQuery.Deferred exception: "+error.message,error.stack,stack)},jQuery.readyException=function(error){window.setTimeout((function(){throw error}))};var readyList=jQuery.Deferred();function completed(){document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed),jQuery.ready()}jQuery.fn.ready=function(fn){return readyList.then(fn).catch((function(error){jQuery.readyException(error)})),this},jQuery.extend({isReady:!1,readyWait:1,ready:function(wait){(!0===wait?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,!0!==wait&&--jQuery.readyWait>0||readyList.resolveWith(document,[jQuery]))}}),jQuery.ready.then=readyList.then,"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed));var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if("object"===toType(key))for(i in chainable=!0,key)access(elems,fn,i,key[i],!0,emptyGet,raw);else if(void 0!==value&&(chainable=!0,isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,_key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g;function fcamelCase(_all,letter){return letter.toUpperCase()}function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)}var acceptData=function(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.prototype={cache:function(owner){var value=owner[this.expando];return value||(value={},acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if("string"==typeof data)cache[camelCase(data)]=value;else for(prop in data)cache[camelCase(prop)]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][camelCase(key)]},access:function(owner,key,value){return void 0===key||key&&"string"==typeof key&&void 0===value?this.get(owner,key):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,cache=owner[this.expando];if(void 0!==cache){if(void 0!==key){i=(key=Array.isArray(key)?key.map(camelCase):(key=camelCase(key))in cache?[key]:key.match(rnothtmlwhite)||[]).length;for(;i--;)delete cache[key[i]]}(void 0===key||jQuery.isEmptyObject(cache))&&(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$&").toLowerCase(),"string"==typeof(data=elem.getAttribute(name))){try{data=function getData(data){return"true"===data||"false"!==data&&("null"===data?null:data===+data+""?+data:rbrace.test(data)?JSON.parse(data):data)}(data)}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,"hasDataAttrs"))){for(i=attrs.length;i--;)attrs[i]&&0===(name=attrs[i].name).indexOf("data-")&&(name=camelCase(name.slice(5)),dataAttr(elem,name,data[name]));dataPriv.set(elem,"hasDataAttrs",!0)}return data}return"object"==typeof key?this.each((function(){dataUser.set(this,key)})):access(this,(function(value){var data;if(elem&&void 0===value)return void 0!==(data=dataUser.get(elem,key))||void 0!==(data=dataAttr(elem,key))?data:void 0;this.each((function(){dataUser.set(this,key,value)}))}),null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each((function(){dataUser.remove(this,key)}))}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=dataPriv.get(elem,type),data&&(!queue||Array.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type);"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,(function(){jQuery.dequeue(elem,type)}),hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add((function(){dataPriv.remove(elem,[type+"queue",key])}))})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each((function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)}))},dequeue:function(type){return this.each((function(){jQuery.dequeue(this,type)}))},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)(tmp=dataPriv.get(elements[i],type+"queueHooks"))&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),cssExpand=["Top","Right","Bottom","Left"],documentElement=document.documentElement,isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)},composed={composed:!0};documentElement.getRootNode&&(isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)||elem.getRootNode(composed)===elem.ownerDocument});var isHiddenWithinTree=function(elem,el){return"none"===(elem=el||elem).style.display||""===elem.style.display&&isAttached(elem)&&"none"===jQuery.css(elem,"display")};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=elem.nodeType&&(jQuery.cssNumber[prop]||"px"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){for(initial/=2,unit=unit||initialInUnit[3],initialInUnit=+initial||1;maxIterations--;)jQuery.style(elem,prop,initialInUnit+unit),(1-scale)*(1-(scale=currentValue()/initial||.5))<=0&&(maxIterations=0),initialInUnit/=scale;initialInUnit*=2,jQuery.style(elem,prop,initialInUnit+unit),valueParts=valueParts||[]}return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];return display||(temp=doc.body.appendChild(doc.createElement(nodeName)),display=jQuery.css(temp,"display"),temp.parentNode.removeChild(temp),"none"===display&&(display="block"),defaultDisplayMap[nodeName]=display,display)}function showHide(elements,show){for(var display,elem,values=[],index=0,length=elements.length;index<length;index++)(elem=elements[index]).style&&(display=elem.style.display,show?("none"===display&&(values[index]=dataPriv.get(elem,"display")||null,values[index]||(elem.style.display="")),""===elem.style.display&&isHiddenWithinTree(elem)&&(values[index]=getDefaultDisplay(elem))):"none"!==display&&(values[index]="none",dataPriv.set(elem,"display",display)));for(index=0;index<length;index++)null!=values[index]&&(elements[index].style.display=values[index]);return elements}jQuery.fn.extend({show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each((function(){isHiddenWithinTree(this)?jQuery(this).show():jQuery(this).hide()}))}});var div,input,rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,rscriptType=/^$|^module$|\/(?:java|ecma)script/i;div=document.createDocumentFragment().appendChild(document.createElement("div")),(input=document.createElement("input")).setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue,div.innerHTML="<option></option>",support.option=!!div.lastChild;var wrapMap={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function getAll(context,tag){var ret;return ret=void 0!==context.getElementsByTagName?context.getElementsByTagName(tag||"*"):void 0!==context.querySelectorAll?context.querySelectorAll(tag||"*"):[],void 0===tag||tag&&nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;i<l;i++)dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,support.option||(wrapMap.optgroup=wrapMap.option=[1,"<select multiple='multiple'>","</select>"]);var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,attached,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;i<l;i++)if((elem=elems[i])||0===elem)if("object"===toType(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if(selection&&jQuery.inArray(elem,selection)>-1)ignored&&ignored.push(elem);else if(attached=isAttached(elem),tmp=getAll(fragment.appendChild(elem),"script"),attached&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment}var rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return!0}function returnFalse(){return!1}function expectSync(elem,type){return elem===function safeActiveElement(){try{return document.activeElement}catch(err){}}()==("focus"===type)}function on(elem,types,selector,data,fn,one){var origFn,type;if("object"==typeof types){for(type in"string"!=typeof selector&&(data=data||selector,selector=void 0),types)on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),!1===fn)fn=returnFalse;else if(!fn)return elem;return 1===one&&(origFn=fn,(fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)}).guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each((function(){jQuery.event.add(this,types,fn,data,selector)}))}function leverageNative(el,type,expectSync){expectSync?(dataPriv.set(el,type,!1),jQuery.event.add(el,type,{namespace:!1,handler:function(event){var notAsync,result,saved=dataPriv.get(this,type);if(1&event.isTrigger&&this[type]){if(saved.length)(jQuery.event.special[type]||{}).delegateType&&event.stopPropagation();else if(saved=slice.call(arguments),dataPriv.set(this,type,saved),notAsync=expectSync(this,type),this[type](),saved!==(result=dataPriv.get(this,type))||notAsync?dataPriv.set(this,type,!1):result={},saved!==result)return event.stopImmediatePropagation(),event.preventDefault(),result&&result.value}else saved.length&&(dataPriv.set(this,type,{value:jQuery.event.trigger(jQuery.extend(saved[0],jQuery.Event.prototype),saved.slice(1),this)}),event.stopImmediatePropagation())}})):void 0===dataPriv.get(el,type)&&jQuery.event.add(el,type,returnTrue)}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(acceptData(elem))for(handler.handler&&(handler=(handleObjIn=handler).handler,selector=handleObjIn.selector),selector&&jQuery.find.matchesSelector(documentElement,selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events=Object.create(null)),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return void 0!==jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||((handlers=events[type]=[]).delegateCount=0,special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)if(type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},handlers=events[type=(selector?special.delegateType:special.bindType)||type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&!1!==special.teardown.call(elem,namespaces,elemData.handle)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,"handle events")}},dispatch:function(nativeEvent){var i,j,ret,matched,handleObj,handlerQueue,args=new Array(arguments.length),event=jQuery.event.fix(nativeEvent),handlers=(dataPriv.get(this,"events")||Object.create(null))[event.type]||[],special=jQuery.event.special[event.type]||{};for(args[0]=event,i=1;i<arguments.length;i++)args[i]=arguments[i];if(event.delegateTarget=this,!special.preDispatch||!1!==special.preDispatch.call(this,event)){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.rnamespace&&!1!==handleObj.namespace&&!event.rnamespace.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,void 0!==(ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args))&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!("click"===event.type&&event.button>=1))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&("click"!==event.type||!0!==cur.disabled)){for(matchedHandlers=[],matchedSelectors={},i=0;i<delegateCount;i++)void 0===matchedSelectors[sel=(handleObj=handlers[i]).selector+" "]&&(matchedSelectors[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length),matchedSelectors[sel]&&matchedHandlers.push(handleObj);matchedHandlers.length&&handlerQueue.push({elem:cur,handlers:matchedHandlers})}return cur=this,delegateCount<handlers.length&&handlerQueue.push({elem:cur,handlers:handlers.slice(delegateCount)}),handlerQueue},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:!0,configurable:!0,get:isFunction(hook)?function(){if(this.originalEvent)return hook(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[name]},set:function(value){Object.defineProperty(this,name,{enumerable:!0,configurable:!0,writable:!0,value:value})}})},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent)},special:{load:{noBubble:!0},click:{setup:function(data){var el=this||data;return rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&leverageNative(el,"click",returnTrue),!1},trigger:function(data){var el=this||data;return rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&leverageNative(el,"click"),!0},_default:function(event){var target=event.target;return rcheckableType.test(target.type)&&target.click&&nodeName(target,"input")&&dataPriv.get(target,"click")||nodeName(target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&!1===src.returnValue?returnTrue:returnFalse,this.target=src.target&&3===src.target.nodeType?src.target.parentNode:src.target,this.currentTarget=src.currentTarget,this.relatedTarget=src.relatedTarget):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||Date.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},jQuery.event.addProp),jQuery.each({focus:"focusin",blur:"focusout"},(function(type,delegateType){jQuery.event.special[type]={setup:function(){return leverageNative(this,type,expectSync),!1},trigger:function(){return leverageNative(this,type),!0},_default:function(){return!0},delegateType:delegateType}})),jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===target||jQuery.contains(target,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}})),jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return!1!==selector&&"function"!=typeof selector||(fn=selector,selector=void 0),!1===fn&&(fn=returnFalse),this.each((function(){jQuery.event.remove(this,types,fn,selector)}))}});var rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return nodeName(elem,"table")&&nodeName(11!==content.nodeType?content:content.firstChild,"tr")&&jQuery(elem).children("tbody")[0]||elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){return"true/"===(elem.type||"").slice(0,5)?elem.type=elem.type.slice(5):elem.removeAttribute("type"),elem}function cloneCopyEvent(src,dest){var i,l,type,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(events=dataPriv.get(src).events))for(type in dataPriv.remove(dest,"handle events"),events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i]);dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();"input"===nodeName&&rcheckableType.test(src.type)?dest.checked=src.checked:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue)}function domManip(collection,args,callback,ignored){args=flat(args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],valueIsFunction=isFunction(value);if(valueIsFunction||l>1&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each((function(index){var self=collection.eq(index);valueIsFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)}));if(l&&(first=(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored)).firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(hasScripts=(scripts=jQuery.map(getAll(fragment,"script"),disableScript)).length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src&&"module"!==(node.type||"").toLowerCase()?jQuery._evalUrl&&!node.noModule&&jQuery._evalUrl(node.src,{nonce:node.nonce||node.getAttribute("nonce")},doc):DOMEval(node.textContent.replace(rcleanScript,""),node,doc))}return collection}function remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&isAttached(node)&&setGlobalEval(getAll(node,"script")),node.parentNode.removeChild(node));return elem}jQuery.extend({htmlPrefilter:function(html){return html},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(!0),inPage=isAttached(elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),i=0,l=(srcElements=getAll(elem)).length;i<l;i++)fixInput(srcElements[i],destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return(destElements=getAll(clone,"script")).length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({detach:function(selector){return remove(this,selector,!0)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,(function(value){return void 0===value?jQuery.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=value)}))}),null,value,arguments.length)},append:function(){return domManip(this,arguments,(function(elem){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||manipulationTarget(this,elem).appendChild(elem)}))},prepend:function(){return domManip(this,arguments,(function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}}))},before:function(){return domManip(this,arguments,(function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)}))},after:function(){return domManip(this,arguments,(function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)}))},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map((function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)}))},html:function(value){return access(this,(function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++)1===(elem=this[i]||{}).nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)}),null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,(function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))}),ignored)}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}}));var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view&&view.opener||(view=window),view.getComputedStyle(elem)},swap=function(elem,options,callback){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.call(elem),options)elem.style[name]=old[name];return ret},rboxStyle=new RegExp(cssExpand.join("|"),"i");function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return(computed=computed||getStyles(elem))&&(""!==(ret=computed.getPropertyValue(name)||computed[name])||isAttached(elem)||(ret=jQuery.style(elem,name)),!support.pixelBoxStyles()&&rnumnonpx.test(ret)&&rboxStyle.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0!==ret?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(!conditionFn())return(this.get=hookFn).apply(this,arguments);delete this.get}}}!function(){function computeStyleTests(){if(div){container.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",div.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",documentElement.appendChild(container).appendChild(div);var divStyle=window.getComputedStyle(div);pixelPositionVal="1%"!==divStyle.top,reliableMarginLeftVal=12===roundPixelMeasures(divStyle.marginLeft),div.style.right="60%",pixelBoxStylesVal=36===roundPixelMeasures(divStyle.right),boxSizingReliableVal=36===roundPixelMeasures(divStyle.width),div.style.position="absolute",scrollboxSizeVal=12===roundPixelMeasures(div.offsetWidth/3),documentElement.removeChild(container),div=null}}function roundPixelMeasures(measure){return Math.round(parseFloat(measure))}var pixelPositionVal,boxSizingReliableVal,scrollboxSizeVal,pixelBoxStylesVal,reliableTrDimensionsVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");div.style&&(div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,jQuery.extend(support,{boxSizingReliable:function(){return computeStyleTests(),boxSizingReliableVal},pixelBoxStyles:function(){return computeStyleTests(),pixelBoxStylesVal},pixelPosition:function(){return computeStyleTests(),pixelPositionVal},reliableMarginLeft:function(){return computeStyleTests(),reliableMarginLeftVal},scrollboxSize:function(){return computeStyleTests(),scrollboxSizeVal},reliableTrDimensions:function(){var table,tr,trChild,trStyle;return null==reliableTrDimensionsVal&&(table=document.createElement("table"),tr=document.createElement("tr"),trChild=document.createElement("div"),table.style.cssText="position:absolute;left:-11111px;border-collapse:separate",tr.style.cssText="border:1px solid",tr.style.height="1px",trChild.style.height="9px",trChild.style.display="block",documentElement.appendChild(table).appendChild(tr).appendChild(trChild),trStyle=window.getComputedStyle(tr),reliableTrDimensionsVal=parseInt(trStyle.height,10)+parseInt(trStyle.borderTopWidth,10)+parseInt(trStyle.borderBottomWidth,10)===tr.offsetHeight,documentElement.removeChild(table)),reliableTrDimensionsVal}}))}();var cssPrefixes=["Webkit","Moz","ms"],emptyStyle=document.createElement("div").style,vendorProps={};function finalPropName(name){var final=jQuery.cssProps[name]||vendorProps[name];return final||(name in emptyStyle?name:vendorProps[name]=function vendorPropName(name){for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if((name=cssPrefixes[i]+capName)in emptyStyle)return name}(name)||name)}var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"};function setPositiveNumber(_elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function boxModelAdjustment(elem,dimension,box,isBorderBox,styles,computedVal){var i="width"===dimension?1:0,extra=0,delta=0;if(box===(isBorderBox?"border":"content"))return 0;for(;i<4;i+=2)"margin"===box&&(delta+=jQuery.css(elem,box+cssExpand[i],!0,styles)),isBorderBox?("content"===box&&(delta-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==box&&(delta-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(delta+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==box?delta+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles):extra+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles));return!isBorderBox&&computedVal>=0&&(delta+=Math.max(0,Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-computedVal-delta-extra-.5))||0),delta}function getWidthOrHeight(elem,dimension,extra){var styles=getStyles(elem),isBorderBox=(!support.boxSizingReliable()||extra)&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),valueIsBorderBox=isBorderBox,val=curCSS(elem,dimension,styles),offsetProp="offset"+dimension[0].toUpperCase()+dimension.slice(1);if(rnumnonpx.test(val)){if(!extra)return val;val="auto"}return(!support.boxSizingReliable()&&isBorderBox||!support.reliableTrDimensions()&&nodeName(elem,"tr")||"auto"===val||!parseFloat(val)&&"inline"===jQuery.css(elem,"display",!1,styles))&&elem.getClientRects().length&&(isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles),(valueIsBorderBox=offsetProp in elem)&&(val=elem[offsetProp])),(val=parseFloat(val)||0)+boxModelAdjustment(elem,dimension,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles,val)+"px"}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(isCustomProp||(name=finalPropName(origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];"string"===(type=typeof value)&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type="number"),null!=value&&value==value&&("number"!==type||isCustomProp||(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(isCustomProp?style.setProperty(name,value):style[name]=value))}},css:function(elem,name,extra,styles){var val,num,hooks,origName=camelCase(name);return rcustomProp.test(name)||(name=finalPropName(origName)),(hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName])&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),!0===extra||isFinite(num)?num||0:val):val}}),jQuery.each(["height","width"],(function(_i,dimension){jQuery.cssHooks[dimension]={get:function(elem,computed,extra){if(computed)return!rdisplayswap.test(jQuery.css(elem,"display"))||elem.getClientRects().length&&elem.getBoundingClientRect().width?getWidthOrHeight(elem,dimension,extra):swap(elem,cssShow,(function(){return getWidthOrHeight(elem,dimension,extra)}))},set:function(elem,value,extra){var matches,styles=getStyles(elem),scrollboxSizeBuggy=!support.scrollboxSize()&&"absolute"===styles.position,isBorderBox=(scrollboxSizeBuggy||extra)&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),subtract=extra?boxModelAdjustment(elem,dimension,extra,isBorderBox,styles):0;return isBorderBox&&scrollboxSizeBuggy&&(subtract-=Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-parseFloat(styles[dimension])-boxModelAdjustment(elem,dimension,"border",!1,styles)-.5)),subtract&&(matches=rcssNum.exec(value))&&"px"!==(matches[3]||"px")&&(elem.style[dimension]=value,value=jQuery.css(elem,dimension)),setPositiveNumber(0,value,subtract)}}})),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,(function(elem,computed){if(computed)return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},(function(){return elem.getBoundingClientRect().left})))+"px"})),jQuery.each({margin:"",padding:"",border:"Width"},(function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},"margin"!==prefix&&(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)})),jQuery.fn.extend({css:function(name,value){return access(this,(function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)}),name,value,arguments.length>1)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,""))&&"auto"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||!jQuery.cssHooks[tween.prop]&&null==tween.elem.style[finalPropName(tween.prop)]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){inProgress&&(!1===document.hidden&&window.requestAnimationFrame?window.requestAnimationFrame(schedule):window.setTimeout(schedule,jQuery.fx.interval),jQuery.fx.tick())}function createFxNow(){return window.setTimeout((function(){fxNow=void 0})),fxNow=Date.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)attrs["margin"+(which=cssExpand[i])]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always((function(){delete tick.elem})),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(length||deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(!function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(easing=specialEasing[name=camelCase(index)],value=props[index],Array.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),(hooks=jQuery.cssHooks[name])&&"expand"in hooks)for(index in value=hooks.expand(value),delete props[name],value)index in props||(props[index]=value[index],specialEasing[index]=easing);else specialEasing[name]=easing}(props,animation.opts.specialEasing);index<length;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=result.stop.bind(result)),result;return jQuery.map(props,createTween,animation),isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){isFunction(props)?(callback=props,props=["*"]):props=props.match(rnothtmlwhite);for(var prop,index=0,length=props.length;index<length;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[function defaultPrefilter(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox="width"in props||"height"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,"fxshow");for(prop in opts.queue||(null==(hooks=jQuery._queueHooks(elem,"fx")).unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always((function(){anim.always((function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()}))}))),props)if(value=props[prop],rfxtypes.test(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if((propTween=!jQuery.isEmptyObject(props))||!jQuery.isEmptyObject(orig))for(prop in isBox&&1===elem.nodeType&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],null==(restoreDisplay=dataShow&&dataShow.display)&&(restoreDisplay=dataPriv.get(elem,"display")),"none"===(display=jQuery.css(elem,"display"))&&(restoreDisplay?display=restoreDisplay:(showHide([elem],!0),restoreDisplay=elem.style.display||restoreDisplay,display=jQuery.css(elem,"display"),showHide([elem]))),("inline"===display||"inline-block"===display&&null!=restoreDisplay)&&"none"===jQuery.css(elem,"float")&&(propTween||(anim.done((function(){style.display=restoreDisplay})),null==restoreDisplay&&(display=style.display,restoreDisplay="none"===display?"":display)),style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always((function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}))),propTween=!1,orig)propTween||(dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,"fxshow",{display:restoreDisplay}),toggle&&(dataShow.hidden=!hidden),hidden&&showHide([elem],!0),anim.done((function(){for(prop in hidden||showHide([elem]),dataPriv.remove(elem,"fxshow"),orig)jQuery.style(elem,prop,orig[prop])}))),propTween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=propTween.start,hidden&&(propTween.end=propTween.start,propTween.start=0))}],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!isFunction(easing)&&easing};return jQuery.fx.off?opt.duration=0:"number"!=typeof opt.duration&&(opt.duration in jQuery.fx.speeds?opt.duration=jQuery.fx.speeds[opt.duration]:opt.duration=jQuery.fx.speeds._default),null!=opt.queue&&!0!==opt.queue||(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||!1===optall.queue?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&this.queue(type||"fx",[]),this.each((function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)}))},finish:function(type){return!1!==type&&(type=type||"fx"),this.each((function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish}))}}),jQuery.each(["toggle","show","hide"],(function(_i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}})),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}})),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=Date.now();i<timers.length;i++)(timer=timers[i])()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){inProgress||(inProgress=!0,schedule())},jQuery.fx.stop=function(){inProgress=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||"fx",this.queue(type,(function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}}))},function(){var input=document.createElement("input"),opt=document.createElement("select").appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,(input=document.createElement("input")).value="t",input.type="radio",support.radioValue="t"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each((function(){jQuery.removeAttr(this,name)}))}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return void 0===elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:null==(ret=jQuery.find.attr(elem,name))?void 0:ret)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return!1===value?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),(function(_i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();return isXML||(handle=attrHandle[lowercaseName],attrHandle[lowercaseName]=ret,ret=null!=getter(elem,name,isXML)?lowercaseName:null,attrHandle[lowercaseName]=handle),ret}}));var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;function stripAndCollapse(value){return(value.match(rnothtmlwhite)||[]).join(" ")}function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}function classesToArray(value){return Array.isArray(value)?value:"string"==typeof value&&value.match(rnothtmlwhite)||[]}jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each((function(){delete this[jQuery.propFix[name]||name]}))}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null},set:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){jQuery.propFix[this.toLowerCase()]=this})),jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each((function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))}));if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each((function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))}));if(!arguments.length)return this.attr("class","");if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>-1;)cur=cur.replace(" "+clazz+" "," ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value,isValidValue="string"===type||Array.isArray(value);return"boolean"==typeof stateVal&&isValidValue?stateVal?this.addClass(value):this.removeClass(value):isFunction(value)?this.each((function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)})):this.each((function(){var className,i,self,classNames;if(isValidValue)for(i=0,self=jQuery(this),classNames=classesToArray(value);className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else void 0!==value&&"boolean"!==type||((className=getClass(this))&&dataPriv.set(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||!1===value?"":dataPriv.get(this,"__className__")||""))}))},hasClass:function(selector){var className,elem,i=0;for(className=" "+selector+" ";elem=this[i++];)if(1===elem.nodeType&&(" "+stripAndCollapse(getClass(elem))+" ").indexOf(className)>-1)return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,valueIsFunction,elem=this[0];return arguments.length?(valueIsFunction=isFunction(value),this.each((function(i){var val;1===this.nodeType&&(null==(val=valueIsFunction?value.call(this,i,jQuery(this).val()):value)?val="":"number"==typeof val?val+="":Array.isArray(val)&&(val=jQuery.map(val,(function(value){return null==value?"":value+""}))),(hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()])&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))}))):elem?(hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()])&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:"string"==typeof(ret=elem.value)?ret.replace(rreturn,""):null==ret?"":ret:void 0}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:stripAndCollapse(jQuery.text(elem))}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type,values=one?null:[],max=one?index+1:options.length;for(i=index<0?max:one?index:0;i<max;i++)if(((option=options[i]).selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)((option=options[i]).selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],(function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})})),support.focusin="onfocusin"in window;var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,stopPropagationCallback=function(e){e.stopPropagation()};jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,lastElement,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=lastElement=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>-1&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,(event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event)).isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||!1!==special.trigger.apply(elem,data))){if(!onlyHandlers&&!special.noBubble&&!isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)lastElement=cur,event.type=i>1?bubbleType:special.bindType||type,(handle=(dataPriv.get(cur,"events")||Object.create(null))[event.type]&&dataPriv.get(cur,"handle"))&&handle.apply(cur,data),(handle=ontype&&cur[ontype])&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),!1===event.result&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&!1!==special._default.apply(eventPath.pop(),data)||!acceptData(elem)||ontype&&isFunction(elem[type])&&!isWindow(elem)&&((tmp=elem[ontype])&&(elem[ontype]=null),jQuery.event.triggered=type,event.isPropagationStopped()&&lastElement.addEventListener(type,stopPropagationCallback),elem[type](),event.isPropagationStopped()&&lastElement.removeEventListener(type,stopPropagationCallback),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem)}}),jQuery.fn.extend({trigger:function(type,data){return this.each((function(){jQuery.event.trigger(type,data,this)}))},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}}),support.focusin||jQuery.each({focus:"focusin",blur:"focusout"},(function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this.document||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this.document||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}}));var location=window.location,nonce={guid:Date.now()},rquery=/\?/;jQuery.parseXML=function(data){var xml,parserErrorElem;if(!data||"string"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){}return parserErrorElem=xml&&xml.getElementsByTagName("parsererror")[0],xml&&!parserErrorElem||jQuery.error("Invalid XML: "+(parserErrorElem?jQuery.map(parserErrorElem.childNodes,(function(el){return el.textContent})).join("\n"):data)),xml};var rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj))jQuery.each(obj,(function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v&&null!=v?i:"")+"]",v,traditional,add)}));else if(traditional||"object"!==toType(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(null==value?"":value)};if(null==a)return"";if(Array.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,(function(){add(this.name,this.value)}));else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this})).filter((function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))})).map((function(_i,elem){var val=jQuery(this).val();return null==val?null:Array.isArray(val)?jQuery.map(val,(function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}})):{name:elem.name,value:val.replace(rCRLF,"\r\n")}})).get()}});var r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],(function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)})),selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){"object"==typeof url&&(options=url,url=void 0),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()+" "]=(responseHeaders[match[1].toLowerCase()+" "]||[]).concat(match[2]);match=responseHeaders[key.toLowerCase()+" "]}return null==match?null:match.join(", ")},getAllResponseHeaders:function(){return completed?responseHeadersString:null},setRequestHeader:function(name,value){return null==completed&&(name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return null==completed&&(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(completed)jqXHR.always(map[jqXHR.status]);else for(code in map)statusCode[code]=[statusCode[code],map[code]];return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR),s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""],null==s.crossDomain){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),completed)return jqXHR;for(i in(fireGlobals=jQuery.event&&s.global)&&0==jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url.replace(rhash,""),s.hasContent?s.data&&s.processData&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&(s.data=s.data.replace(r20,"+")):(uncached=s.url.slice(cacheURL.length),s.data&&(s.processData||"string"==typeof s.data)&&(cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),!1===s.cache&&(cacheURL=cacheURL.replace(rantiCache,"$1"),uncached=(rquery.test(cacheURL)?"&":"?")+"_="+nonce.guid+++uncached),s.url=cacheURL+uncached),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||completed))return jqXHR.abort();if(strAbort="abort",completeDeferred.add(s.complete),jqXHR.done(s.success),jqXHR.fail(s.error),transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),completed)return jqXHR;s.async&&s.timeout>0&&(timeoutTimer=window.setTimeout((function(){jqXHR.abort("timeout")}),s.timeout));try{completed=!1,transport.send(requestHeaders,done)}catch(e){if(completed)throw e;done(-1,e)}}else done(-1,"No Transport");function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;completed||(completed=!0,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&status<300||304===status,responses&&(response=function ajaxHandleResponses(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses)),!isSuccess&&jQuery.inArray("script",s.dataTypes)>-1&&jQuery.inArray("json",s.dataTypes)<0&&(s.converters["text script"]=function(){}),response=function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(!(conv=converters[prev+" "+current]||converters["* "+current]))for(conv2 in converters)if((tmp=conv2.split(" "))[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){!0===conv?conv=converters[conv2]:!0!==converters[conv2]&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(!0!==conv)if(conv&&s.throws)response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&((modified=jqXHR.getResponseHeader("Last-Modified"))&&(jQuery.lastModified[cacheURL]=modified),(modified=jqXHR.getResponseHeader("etag"))&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,isSuccess=!(error=response.error))):(error=statusText,!status&&statusText||(statusText="error",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],(function(_i,method){jQuery[method]=function(url,data,callback,type){return isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}})),jQuery.ajaxPrefilter((function(s){var i;for(i in s.headers)"content-type"===i.toLowerCase()&&(s.contentType=s.headers[i]||"")})),jQuery._evalUrl=function(url,options,doc){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(response){jQuery.globalEval(response,options,doc)}})},jQuery.fn.extend({wrapAll:function(html){var wrap;return this[0]&&(isFunction(html)&&(html=html.call(this[0])),wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map((function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem})).append(this)),this},wrapInner:function(html){return isFunction(html)?this.each((function(i){jQuery(this).wrapInner(html.call(this,i))})):this.each((function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)}))},wrap:function(html){var htmlIsFunction=isFunction(html);return this.each((function(i){jQuery(this).wrapAll(htmlIsFunction?html.call(this,i):html)}))},unwrap:function(selector){return this.parent(selector).not("body").each((function(){jQuery(this).replaceWith(this.childNodes)})),this}}),jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem)},jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)},jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport((function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];for(i in options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest"),headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null,"abort"===type?xhr.abort():"error"===type?"number"!=typeof xhr.status?complete(0,"error"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"text"!==(xhr.responseType||"text")||"string"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=callback(),errorCallback=xhr.onerror=xhr.ontimeout=callback("error"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout((function(){callback&&errorCallback()}))},callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback)throw e}},abort:function(){callback&&callback()}}})),jQuery.ajaxPrefilter((function(s){s.crossDomain&&(s.contents.script=!1)})),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",(function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET")})),jQuery.ajaxTransport("script",(function(s){var script,callback;if(s.crossDomain||s.scriptAttrs)return{send:function(_,complete){script=jQuery("<script>").attr(s.scriptAttrs||{}).prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove(),callback=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}}));var body,oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce.guid++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",(function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=!1!==s.jsonp&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0])return callbackName=s.jsonpCallback=isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):!1!==s.jsonp&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always((function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0})),"script"})),support.createHTMLDocument=((body=document.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===body.childNodes.length),jQuery.parseHTML=function(data,context,keepScripts){return"string"!=typeof data?[]:("boolean"==typeof context&&(keepScripts=context,context=!1),context||(support.createHTMLDocument?((base=(context=document.implementation.createHTMLDocument("")).createElement("base")).href=document.location.href,context.head.appendChild(base)):context=document),scripts=!keepScripts&&[],(parsed=rsingleTag.exec(data))?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes)));var base,parsed,scripts},jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(" ");return off>-1&&(selector=stripAndCollapse(url.slice(off)),url=url.slice(0,off)),isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done((function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)})).always(callback&&function(jqXHR,status){self.each((function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])}))}),this},jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,(function(fn){return elem===fn.elem})).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),("absolute"===position||"fixed"===position)&&(curCSSTop+curCSSLeft).indexOf("auto")>-1?(curTop=(curPosition=curElem.position()).top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each((function(i){jQuery.offset.setOffset(this,options,i)}));var rect,win,elem=this[0];return elem?elem.getClientRects().length?(rect=elem.getBoundingClientRect(),win=elem.ownerDocument.defaultView,{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var offsetParent,offset,doc,elem=this[0],parentOffset={top:0,left:0};if("fixed"===jQuery.css(elem,"position"))offset=elem.getBoundingClientRect();else{for(offset=this.offset(),doc=elem.ownerDocument,offsetParent=elem.offsetParent||doc.documentElement;offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.parentNode;offsetParent&&offsetParent!==elem&&1===offsetParent.nodeType&&((parentOffset=jQuery(offsetParent).offset()).top+=jQuery.css(offsetParent,"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent,"borderLeftWidth",!0))}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var offsetParent=this.offsetParent;offsetParent&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement}))}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,(function(elem,method,val){var win;if(isWindow(elem)?win=elem:9===elem.nodeType&&(win=elem.defaultView),void 0===val)return win?win[prop]:elem[method];win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val}),method,val,arguments.length)}})),jQuery.each(["top","left"],(function(_i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,(function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}))})),jQuery.each({Height:"height",Width:"width"},(function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},(function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(!0===margin||!0===value?"margin":"border");return access(this,(function(elem,type,value){var doc;return isWindow(elem)?0===funcName.indexOf("outer")?elem["inner"+name]:elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)}),type,chainable?margin:void 0,chainable)}}))})),jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(_i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}})),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),jQuery.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(_i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}));var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;jQuery.proxy=function(fn,context){var tmp,args,proxy;if("string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),isFunction(fn))return args=slice.call(arguments,2),(proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))}).guid=fn.guid=fn.guid||jQuery.guid++,proxy},jQuery.holdReady=function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},jQuery.isArray=Array.isArray,jQuery.parseJSON=JSON.parse,jQuery.nodeName=nodeName,jQuery.isFunction=isFunction,jQuery.isWindow=isWindow,jQuery.camelCase=camelCase,jQuery.type=toType,jQuery.now=Date.now,jQuery.isNumeric=function(obj){var type=jQuery.type(obj);return("number"===type||"string"===type)&&!isNaN(obj-parseFloat(obj))},jQuery.trim=function(text){return null==text?"":(text+"").replace(rtrim,"")},"function"==typeof define&&define.amd&&define("jquery",[],(function(){return jQuery}));var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},void 0===noGlobal&&(window.jQuery=window.$=jQuery),jQuery})),function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t),t}:n(jQuery)}((function(u){var e=function(){if(u&&u.fn&&u.fn.select2&&u.fn.select2.amd)var e=u.fn.select2.amd;var t,n,r,h,o,s,f,g,m,v,y,_,i,a,b;function w(e,t){return i.call(e,t)}function l(e,t){var n,r,i,o,s,a,l,c,u,d,p,h=t&&t.split("/"),f=y.map,g=f&&f["*"]||{};if(e){for(s=(e=e.split("/")).length-1,y.nodeIdCompat&&b.test(e[s])&&(e[s]=e[s].replace(b,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),u=0;u<e.length;u++)if("."===(p=e[u]))e.splice(u,1),--u;else if(".."===p){if(0===u||1===u&&".."===e[2]||".."===e[u-1])continue;0<u&&(e.splice(u-1,2),u-=2)}e=e.join("/")}if((h||g)&&f){for(u=(n=e.split("/")).length;0<u;--u){if(r=n.slice(0,u).join("/"),h)for(d=h.length;0<d;--d)if(i=(i=f[h.slice(0,d).join("/")])&&i[r]){o=i,a=u;break}if(o)break;!l&&g&&g[r]&&(l=g[r],c=u)}!o&&l&&(o=l,a=c),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function A(t,n){return function(){var e=a.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),s.apply(h,e.concat([t,n]))}}function x(t){return function(e){m[t]=e}}function D(e){if(w(v,e)){var t=v[e];delete v[e],_[e]=!0,o.apply(h,t)}if(!w(m,e)&&!w(_,e))throw new Error("No "+e);return m[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return e?c(e):[]}return e&&e.requirejs||(e?n=e:e={},m={},v={},y={},_={},i=Object.prototype.hasOwnProperty,a=[].slice,b=/\.js$/,f=function(e,t){var n,r,i=c(e),o=i[0],s=t[1];return e=i[1],o&&(n=D(o=l(o,s))),o?e=n&&n.normalize?n.normalize(e,(r=s,function(e){return l(e,r)})):l(e,s):(o=(i=c(e=l(e,s)))[0],e=i[1],o&&(n=D(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},g={require:function(e){return A(e)},exports:function(e){var t=m[e];return void 0!==t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:(t=e,function(){return y&&y.config&&y.config[t]||{}})};var t}},o=function(e,t,n,r){var i,o,s,a,l,c,u,d=[],p=typeof n;if(c=S(r=r||e),"undefined"==p||"function"==p){for(t=!t.length&&n.length?["require","exports","module"]:t,l=0;l<t.length;l+=1)if("require"===(o=(a=f(t[l],c)).f))d[l]=g.require(e);else if("exports"===o)d[l]=g.exports(e),u=!0;else if("module"===o)i=d[l]=g.module(e);else if(w(m,o)||w(v,o)||w(_,o))d[l]=D(o);else{if(!a.p)throw new Error(e+" missing "+o);a.p.load(a.n,A(r,!0),x(o),{}),d[l]=m[o]}s=n?n.apply(m[e],d):void 0,e&&(i&&i.exports!==h&&i.exports!==m[e]?m[e]=i.exports:s===h&&u||(m[e]=s))}else e&&(m[e]=n)},t=n=s=function(e,t,n,r,i){if("string"==typeof e)return g[e]?g[e](t):D(f(e,S(t)).f);if(!e.splice){if((y=e).deps&&s(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=h}return t=t||function(){},"function"==typeof n&&(n=r,r=i),r?o(h,e,t,n):setTimeout((function(){o(h,e,t,n)}),4),s},s.config=function(e){return s(e)},t._defined=m,(r=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),w(m,e)||w(v,e)||(v[e]=[e,t,n])}).amd={jQuery:!0},e.requirejs=t,e.require=n,e.define=r),e.define("almond",(function(){})),e.define("jquery",[],(function(){var e=u||$;return null==e&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),e})),e.define("select2/utils",["jquery"],(function(o){var i={};function u(e){var t=e.prototype,n=[];for(var r in t)"function"==typeof t[r]&&"constructor"!==r&&n.push(r);return n}function e(){this.listeners={}}i.Extend=function(e,t){var n={}.hasOwnProperty;function r(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},i.Decorate=function(r,i){var e=u(i),t=u(r);function o(){var e=Array.prototype.unshift,t=i.prototype.constructor.length,n=r.prototype.constructor;0<t&&(e.call(arguments,r.prototype.constructor),n=i.prototype.constructor),n.apply(this,arguments)}i.displayName=r.displayName,o.prototype=new function(){this.constructor=o};for(var n=0;n<t.length;n++){var s=t[n];o.prototype[s]=r.prototype[s]}function a(e){var t=function(){};e in o.prototype&&(t=o.prototype[e]);var n=i.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),n.apply(this,arguments)}}for(var l=0;l<e.length;l++){var c=e[l];o.prototype[c]=a(c)}return o},e.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},e.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),(n[0]._type=e)in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},e.prototype.invoke=function(e,t){for(var n=0,r=e.length;n<r;n++)e[n].apply(this,t)},i.Observable=e,i.generateChars=function(e){for(var t="",n=0;n<e;n++)t+=Math.floor(36*Math.random()).toString(36);return t},i.bind=function(e,t){return function(){e.apply(t,arguments)}},i._convertData=function(e){for(var t in e){var n=t.split("-"),r=e;if(1!==n.length){for(var i=0;i<n.length;i++){var o=n[i];(o=o.substring(0,1).toLowerCase()+o.substring(1))in r||(r[o]={}),i==n.length-1&&(r[o]=e[t]),r=r[o]}delete e[t]}}return e},i.hasScroll=function(e,t){var n=o(t),r=t.style.overflowX,i=t.style.overflowY;return(r!==i||"hidden"!==i&&"visible"!==i)&&("scroll"===r||"scroll"===i||n.innerHeight()<t.scrollHeight||n.innerWidth()<t.scrollWidth)},i.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,(function(e){return t[e]}))},i.appendMany=function(e,t){if("1.7"===o.fn.jquery.substr(0,3)){var n=o();o.map(t,(function(e){n=n.add(e)})),t=n}e.append(t)},i.__cache={};var n=0;return i.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null==t&&(e.id?(t=e.id,e.setAttribute("data-select2-id",t)):(e.setAttribute("data-select2-id",++n),t=n.toString())),t},i.StoreData=function(e,t,n){var r=i.GetUniqueElementId(e);i.__cache[r]||(i.__cache[r]={}),i.__cache[r][t]=n},i.GetData=function(e,t){var n=i.GetUniqueElementId(e);return t?i.__cache[n]&&null!=i.__cache[n][t]?i.__cache[n][t]:o(e).data(t):i.__cache[n]},i.RemoveData=function(e){var t=i.GetUniqueElementId(e);null!=i.__cache[t]&&delete i.__cache[t],e.removeAttribute("data-select2-id")},i})),e.define("select2/results",["jquery","./utils"],(function(h,f){function r(e,t,n){this.$element=e,this.data=n,this.options=t,r.__super__.constructor.call(this)}return f.Extend(r,f.Observable),r.prototype.render=function(){var e=h('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&e.attr("aria-multiselectable","true"),this.$results=e},r.prototype.clear=function(){this.$results.empty()},r.prototype.displayMessage=function(e){var t=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var n=h('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),r=this.options.get("translations").get(e.message);n.append(t(r(e.args))),n[0].className+=" select2-results__message",this.$results.append(n)},r.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},r.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var r=e.results[n],i=this.option(r);t.push(i)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},r.prototype.position=function(e,t){t.find(".select2-results").append(e)},r.prototype.sort=function(e){return this.options.get("sorter")(e)},r.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");0<t.length?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},r.prototype.setClasses=function(){var t=this;this.data.current((function(e){var r=h.map(e,(function(e){return e.id.toString()}));t.$results.find(".select2-results__option[aria-selected]").each((function(){var e=h(this),t=f.GetData(this,"data"),n=""+t.id;null!=t.element&&t.element.selected||null==t.element&&-1<h.inArray(n,r)?e.attr("aria-selected","true"):e.attr("aria-selected","false")}))}))},r.prototype.showLoading=function(e){this.hideLoading();var t={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(e)},n=this.option(t);n.className+=" loading-results",this.$results.prepend(n)},r.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},r.prototype.option=function(e){var t=document.createElement("li");t.className="select2-results__option";var n={role:"option","aria-selected":"false"},r=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(var i in(null!=e.element&&r.call(e.element,":disabled")||null==e.element&&e.disabled)&&(delete n["aria-selected"],n["aria-disabled"]="true"),null==e.id&&delete n["aria-selected"],null!=e._resultId&&(t.id=e._resultId),e.title&&(t.title=e.title),e.children&&(n.role="group",n["aria-label"]=e.text,delete n["aria-selected"]),n){var o=n[i];t.setAttribute(i,o)}if(e.children){var s=h(t),a=document.createElement("strong");a.className="select2-results__group",h(a),this.template(e,a);for(var l=[],c=0;c<e.children.length;c++){var u=e.children[c],d=this.option(u);l.push(d)}var p=h("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});p.append(l),s.append(a),s.append(p)}else this.template(e,t);return f.StoreData(t,"data",e),t},r.prototype.bind=function(t,e){var l=this,n=t.id+"-results";this.$results.attr("id",n),t.on("results:all",(function(e){l.clear(),l.append(e.data),t.isOpen()&&(l.setClasses(),l.highlightFirstItem())})),t.on("results:append",(function(e){l.append(e.data),t.isOpen()&&l.setClasses()})),t.on("query",(function(e){l.hideMessages(),l.showLoading(e)})),t.on("select",(function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())})),t.on("unselect",(function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())})),t.on("open",(function(){l.$results.attr("aria-expanded","true"),l.$results.attr("aria-hidden","false"),l.setClasses(),l.ensureHighlightVisible()})),t.on("close",(function(){l.$results.attr("aria-expanded","false"),l.$results.attr("aria-hidden","true"),l.$results.removeAttr("aria-activedescendant")})),t.on("results:toggle",(function(){var e=l.getHighlightedResults();0!==e.length&&e.trigger("mouseup")})),t.on("results:select",(function(){var e=l.getHighlightedResults();if(0!==e.length){var t=f.GetData(e[0],"data");"true"==e.attr("aria-selected")?l.trigger("close",{}):l.trigger("select",{data:t})}})),t.on("results:previous",(function(){var e=l.getHighlightedResults(),t=l.$results.find("[aria-selected]"),n=t.index(e);if(!(n<=0)){var r=n-1;0===e.length&&(r=0);var i=t.eq(r);i.trigger("mouseenter");var o=l.$results.offset().top,s=i.offset().top,a=l.$results.scrollTop()+(s-o);0===r?l.$results.scrollTop(0):s-o<0&&l.$results.scrollTop(a)}})),t.on("results:next",(function(){var e=l.getHighlightedResults(),t=l.$results.find("[aria-selected]"),n=t.index(e)+1;if(!(n>=t.length)){var r=t.eq(n);r.trigger("mouseenter");var i=l.$results.offset().top+l.$results.outerHeight(!1),o=r.offset().top+r.outerHeight(!1),s=l.$results.scrollTop()+o-i;0===n?l.$results.scrollTop(0):i<o&&l.$results.scrollTop(s)}})),t.on("results:focus",(function(e){e.element.addClass("select2-results__option--highlighted")})),t.on("results:message",(function(e){l.displayMessage(e)})),h.fn.mousewheel&&this.$results.on("mousewheel",(function(e){var t=l.$results.scrollTop(),n=l.$results.get(0).scrollHeight-t+e.deltaY,r=0<e.deltaY&&t-e.deltaY<=0,i=e.deltaY<0&&n<=l.$results.height();r?(l.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):i&&(l.$results.scrollTop(l.$results.get(0).scrollHeight-l.$results.height()),e.preventDefault(),e.stopPropagation())})),this.$results.on("mouseup",".select2-results__option[aria-selected]",(function(e){var t=h(this),n=f.GetData(this,"data");"true"!==t.attr("aria-selected")?l.trigger("select",{originalEvent:e,data:n}):l.options.get("multiple")?l.trigger("unselect",{originalEvent:e,data:n}):l.trigger("close",{})})),this.$results.on("mouseenter",".select2-results__option[aria-selected]",(function(e){var t=f.GetData(this,"data");l.getHighlightedResults().removeClass("select2-results__option--highlighted"),l.trigger("results:focus",{data:t,element:h(this)})}))},r.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},r.prototype.destroy=function(){this.$results.remove()},r.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]").index(e),n=this.$results.offset().top,r=e.offset().top,i=this.$results.scrollTop()+(r-n),o=r-n;i-=2*e.outerHeight(!1),t<=2?this.$results.scrollTop(0):(o>this.$results.outerHeight()||o<0)&&this.$results.scrollTop(i)}},r.prototype.template=function(e,t){var n=this.options.get("templateResult"),r=this.options.get("escapeMarkup"),i=n(e,t);null==i?t.style.display="none":"string"==typeof i?t.innerHTML=r(i):h(t).append(i)},r})),e.define("select2/keys",[],(function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}})),e.define("select2/selection/base",["jquery","../utils","../keys"],(function(n,r,i){function o(e,t){this.$element=e,this.options=t,o.__super__.constructor.call(this)}return r.Extend(o,r.Observable),o.prototype.render=function(){var e=n('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=r.GetData(this.$element[0],"old-tabindex")?this._tabindex=r.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),e.attr("title",this.$element.attr("title")),e.attr("tabindex",this._tabindex),e.attr("aria-disabled","false"),this.$selection=e},o.prototype.bind=function(e,t){var n=this,r=e.id+"-results";this.container=e,this.$selection.on("focus",(function(e){n.trigger("focus",e)})),this.$selection.on("blur",(function(e){n._handleBlur(e)})),this.$selection.on("keydown",(function(e){n.trigger("keypress",e),e.which===i.SPACE&&e.preventDefault()})),e.on("results:focus",(function(e){n.$selection.attr("aria-activedescendant",e.data._resultId)})),e.on("selection:update",(function(e){n.update(e.data)})),e.on("open",(function(){n.$selection.attr("aria-expanded","true"),n.$selection.attr("aria-owns",r),n._attachCloseHandler(e)})),e.on("close",(function(){n.$selection.attr("aria-expanded","false"),n.$selection.removeAttr("aria-activedescendant"),n.$selection.removeAttr("aria-owns"),n.$selection.trigger("focus"),n._detachCloseHandler(e)})),e.on("enable",(function(){n.$selection.attr("tabindex",n._tabindex),n.$selection.attr("aria-disabled","false")})),e.on("disable",(function(){n.$selection.attr("tabindex","-1"),n.$selection.attr("aria-disabled","true")}))},o.prototype._handleBlur=function(e){var t=this;window.setTimeout((function(){document.activeElement==t.$selection[0]||n.contains(t.$selection[0],document.activeElement)||t.trigger("blur",e)}),1)},o.prototype._attachCloseHandler=function(e){n(document.body).on("mousedown.select2."+e.id,(function(e){var t=n(e.target).closest(".select2");n(".select2.select2-container--open").each((function(){this!=t[0]&&r.GetData(this,"element").select2("close")}))}))},o.prototype._detachCloseHandler=function(e){n(document.body).off("mousedown.select2."+e.id)},o.prototype.position=function(e,t){t.find(".selection").append(e)},o.prototype.destroy=function(){this._detachCloseHandler(this.container)},o.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},o.prototype.isEnabled=function(){return!this.isDisabled()},o.prototype.isDisabled=function(){return this.options.get("disabled")},o})),e.define("select2/selection/single",["jquery","./base","../utils","../keys"],(function(e,t,n,r){function i(){i.__super__.constructor.apply(this,arguments)}return n.Extend(i,t),i.prototype.render=function(){var e=i.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},i.prototype.bind=function(t,e){var n=this;i.__super__.bind.apply(this,arguments);var r=t.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",r).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",r),this.$selection.on("mousedown",(function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})})),this.$selection.on("focus",(function(e){})),this.$selection.on("blur",(function(e){})),t.on("focus",(function(e){t.isOpen()||n.$selection.trigger("focus")}))},i.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},i.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},i.prototype.selectionContainer=function(){return e("<span></span>")},i.prototype.update=function(e){if(0!==e.length){var t=e[0],n=this.$selection.find(".select2-selection__rendered"),r=this.display(t,n);n.empty().append(r);var i=t.title||t.text;i?n.attr("title",i):n.removeAttr("title")}else this.clear()},i})),e.define("select2/selection/multiple",["jquery","./base","../utils"],(function(i,e,l){function n(e,t){n.__super__.constructor.apply(this,arguments)}return l.Extend(n,e),n.prototype.render=function(){var e=n.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},n.prototype.bind=function(e,t){var r=this;n.__super__.bind.apply(this,arguments),this.$selection.on("click",(function(e){r.trigger("toggle",{originalEvent:e})})),this.$selection.on("click",".select2-selection__choice__remove",(function(e){if(!r.isDisabled()){var t=i(this).parent(),n=l.GetData(t[0],"data");r.trigger("unselect",{originalEvent:e,data:n})}}))},n.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},n.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},n.prototype.selectionContainer=function(){return i('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},n.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=this.selectionContainer(),o=this.display(r,i);i.append(o);var s=r.title||r.text;s&&i.attr("title",s),l.StoreData(i[0],"data",r),t.push(i)}var a=this.$selection.find(".select2-selection__rendered");l.appendMany(a,t)}},n})),e.define("select2/selection/placeholder",["../utils"],(function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(1<t.length||n)return e.call(this,t);this.clear();var r=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(r)},t})),e.define("select2/selection/allowClear",["jquery","../keys","../utils"],(function(i,r,a){function e(){}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",(function(e){r._handleClear(e)})),t.on("keypress",(function(e){r._handleKeyboardClear(e,t)}))},e.prototype._handleClear=function(e,t){if(!this.isDisabled()){var n=this.$selection.find(".select2-selection__clear");if(0!==n.length){t.stopPropagation();var r=a.GetData(n[0],"data"),i=this.$element.val();this.$element.val(this.placeholder.id);var o={data:r};if(this.trigger("clear",o),o.prevented)this.$element.val(i);else{for(var s=0;s<r.length;s++)if(o={data:r[s]},this.trigger("unselect",o),o.prevented)return void this.$element.val(i);this.$element.trigger("input").trigger("change"),this.trigger("toggle",{})}}}},e.prototype._handleKeyboardClear=function(e,t,n){n.isOpen()||t.which!=r.DELETE&&t.which!=r.BACKSPACE||this._handleClear(t)},e.prototype.update=function(e,t){if(e.call(this,t),!(0<this.$selection.find(".select2-selection__placeholder").length||0===t.length)){var n=this.options.get("translations").get("removeAllItems"),r=i('<span class="select2-selection__clear" title="'+n()+'">&times;</span>');a.StoreData(r[0],"data",t),this.$selection.find(".select2-selection__rendered").prepend(r)}},e})),e.define("select2/selection/search",["jquery","../utils","../keys"],(function(r,a,l){function e(e,t,n){e.call(this,t,n)}return e.prototype.render=function(e){var t=r('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></li>');this.$searchContainer=t,this.$search=t.find("input");var n=e.call(this);return this._transferTabIndex(),n},e.prototype.bind=function(e,t,n){var r=this,i=t.id+"-results";e.call(this,t,n),t.on("open",(function(){r.$search.attr("aria-controls",i),r.$search.trigger("focus")})),t.on("close",(function(){r.$search.val(""),r.$search.removeAttr("aria-controls"),r.$search.removeAttr("aria-activedescendant"),r.$search.trigger("focus")})),t.on("enable",(function(){r.$search.prop("disabled",!1),r._transferTabIndex()})),t.on("disable",(function(){r.$search.prop("disabled",!0)})),t.on("focus",(function(e){r.$search.trigger("focus")})),t.on("results:focus",(function(e){e.data._resultId?r.$search.attr("aria-activedescendant",e.data._resultId):r.$search.removeAttr("aria-activedescendant")})),this.$selection.on("focusin",".select2-search--inline",(function(e){r.trigger("focus",e)})),this.$selection.on("focusout",".select2-search--inline",(function(e){r._handleBlur(e)})),this.$selection.on("keydown",".select2-search--inline",(function(e){if(e.stopPropagation(),r.trigger("keypress",e),r._keyUpPrevented=e.isDefaultPrevented(),e.which===l.BACKSPACE&&""===r.$search.val()){var t=r.$searchContainer.prev(".select2-selection__choice");if(0<t.length){var n=a.GetData(t[0],"data");r.searchRemoveChoice(n),e.preventDefault()}}})),this.$selection.on("click",".select2-search--inline",(function(e){r.$search.val()&&e.stopPropagation()}));var o=document.documentMode,s=o&&o<=11;this.$selection.on("input.searchcheck",".select2-search--inline",(function(e){s?r.$selection.off("input.search input.searchcheck"):r.$selection.off("keyup.search")})),this.$selection.on("keyup.search input.search",".select2-search--inline",(function(e){if(s&&"input"===e.type)r.$selection.off("input.search input.searchcheck");else{var t=e.which;t!=l.SHIFT&&t!=l.CTRL&&t!=l.ALT&&t!=l.TAB&&r.handleSearch(e)}}))},e.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},e.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},e.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n&&this.$search.trigger("focus")},e.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},e.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},e.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";e=""!==this.$search.attr("placeholder")?this.$selection.find(".select2-selection__rendered").width():.75*(this.$search.val().length+1)+"em",this.$search.css("width",e)},e})),e.define("select2/selection/eventRelay",["jquery"],(function(s){function e(){}return e.prototype.bind=function(e,t,n){var r=this,i=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],o=["opening","closing","selecting","unselecting","clearing"];e.call(this,t,n),t.on("*",(function(e,t){if(-1!==s.inArray(e,i)){t=t||{};var n=s.Event("select2:"+e,{params:t});r.$element.trigger(n),-1!==s.inArray(e,o)&&(t.prevented=n.isDefaultPrevented())}}))},e})),e.define("select2/translation",["jquery","require"],(function(t,n){function r(e){this.dict=e||{}}return r.prototype.all=function(){return this.dict},r.prototype.get=function(e){return this.dict[e]},r.prototype.extend=function(e){this.dict=t.extend({},e.all(),this.dict)},r._cache={},r.loadPath=function(e){if(!(e in r._cache)){var t=n(e);r._cache[e]=t}return new r(r._cache[e])},r})),e.define("select2/diacritics",[],(function(){return{"â¶":"A","ï¼¡":"A","Ã":"A","Ã":"A","Ã":"A","áº¦":"A","áº¤":"A","áºª":"A","áº¨":"A","Ã":"A","Ä":"A","Ä":"A","áº°":"A","áº®":"A","áº´":"A","áº²":"A","È¦":"A","Ç ":"A","Ã":"A","Ç":"A","áº¢":"A","Ã":"A","Çº":"A","Ç":"A","È":"A","È":"A","áº ":"A","áº¬":"A","áº¶":"A","á¸":"A","Ä":"A","Èº":"A","â±¯":"A","ê²":"AA","Ã":"AE","Ç¼":"AE","Ç¢":"AE","ê´":"AO","ê¶":"AU","ê¸":"AV","êº":"AV","ê¼":"AY","â·":"B","ï¼¢":"B","á¸":"B","á¸":"B","á¸":"B","É":"B","Æ":"B","Æ":"B","â¸":"C","ï¼£":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ã":"C","á¸":"C","Æ":"C","È»":"C","ê¾":"C","â¹":"D","ï¼¤":"D","á¸":"D","Ä":"D","á¸":"D","á¸":"D","á¸":"D","á¸":"D","Ä":"D","Æ":"D","Æ":"D","Æ":"D","ê¹":"D","Ç±":"DZ","Ç":"DZ","Ç²":"Dz","Ç":"Dz","âº":"E","ï¼¥":"E","Ã":"E","Ã":"E","Ã":"E","á»":"E","áº¾":"E","á»":"E","á»":"E","áº¼":"E","Ä":"E","á¸":"E","á¸":"E","Ä":"E","Ä":"E","Ã":"E","áºº":"E","Ä":"E","È":"E","È":"E","áº¸":"E","á»":"E","È¨":"E","á¸":"E","Ä":"E","á¸":"E","á¸":"E","Æ":"E","Æ":"E","â»":"F","ï¼¦":"F","á¸":"F","Æ":"F","ê»":"F","â¼":"G","ï¼§":"G","Ç´":"G","Ä":"G","á¸ ":"G","Ä":"G","Ä ":"G","Ç¦":"G","Ä¢":"G","Ç¤":"G","Æ":"G","ê ":"G","ê½":"G","ê¾":"G","â½":"H","ï¼¨":"H","Ä¤":"H","á¸¢":"H","á¸¦":"H","È":"H","á¸¤":"H","á¸¨":"H","á¸ª":"H","Ä¦":"H","â±§":"H","â±µ":"H","ê":"H","â¾":"I","ï¼©":"I","Ã":"I","Ã":"I","Ã":"I","Ä¨":"I","Äª":"I","Ä¬":"I","Ä°":"I","Ã":"I","á¸®":"I","á»":"I","Ç":"I","È":"I","È":"I","á»":"I","Ä®":"I","á¸¬":"I","Æ":"I","â¿":"J","ï¼ª":"J","Ä´":"J","É":"J","â":"K","ï¼«":"K","á¸°":"K","Ç¨":"K","á¸²":"K","Ä¶":"K","á¸´":"K","Æ":"K","â±©":"K","ê":"K","ê":"K","ê":"K","ê¢":"K","â":"L","ï¼¬":"L","Ä¿":"L","Ä¹":"L","Ä½":"L","á¸¶":"L","á¸¸":"L","Ä»":"L","á¸¼":"L","á¸º":"L","Å":"L","È½":"L","â±¢":"L","â± ":"L","ê":"L","ê":"L","ê":"L","Ç":"LJ","Ç":"Lj","â":"M","ï¼­":"M","á¸¾":"M","á¹":"M","á¹":"M","â±®":"M","Æ":"M","â":"N","ï¼®":"N","Ç¸":"N","Å":"N","Ã":"N","á¹":"N","Å":"N","á¹":"N","Å":"N","á¹":"N","á¹":"N","È ":"N","Æ":"N","ê":"N","ê¤":"N","Ç":"NJ","Ç":"Nj","â":"O","ï¼¯":"O","Ã":"O","Ã":"O","Ã":"O","á»":"O","á»":"O","á»":"O","á»":"O","Ã":"O","á¹":"O","È¬":"O","á¹":"O","Å":"O","á¹":"O","á¹":"O","Å":"O","È®":"O","È°":"O","Ã":"O","Èª":"O","á»":"O","Å":"O","Ç":"O","È":"O","È":"O","Æ ":"O","á»":"O","á»":"O","á» ":"O","á»":"O","á»¢":"O","á»":"O","á»":"O","Çª":"O","Ç¬":"O","Ã":"O","Ç¾":"O","Æ":"O","Æ":"O","ê":"O","ê":"O","Å":"OE","Æ¢":"OI","ê":"OO","È¢":"OU","â":"P","ï¼°":"P","á¹":"P","á¹":"P","Æ¤":"P","â±£":"P","ê":"P","ê":"P","ê":"P","â":"Q","ï¼±":"Q","ê":"Q","ê":"Q","É":"Q","â":"R","ï¼²":"R","Å":"R","á¹":"R","Å":"R","È":"R","È":"R","á¹":"R","á¹":"R","Å":"R","á¹":"R","É":"R","â±¤":"R","ê":"R","ê¦":"R","ê":"R","â":"S","ï¼³":"S","áº":"S","Å":"S","á¹¤":"S","Å":"S","á¹ ":"S","Å ":"S","á¹¦":"S","á¹¢":"S","á¹¨":"S","È":"S","Å":"S","â±¾":"S","ê¨":"S","ê":"S","â":"T","ï¼´":"T","á¹ª":"T","Å¤":"T","á¹¬":"T","È":"T","Å¢":"T","á¹°":"T","á¹®":"T","Å¦":"T","Æ¬":"T","Æ®":"T","È¾":"T","ê":"T","ê¨":"TZ","â":"U","ï¼µ":"U","Ã":"U","Ã":"U","Ã":"U","Å¨":"U","á¹¸":"U","Åª":"U","á¹º":"U","Å¬":"U","Ã":"U","Ç":"U","Ç":"U","Ç":"U","Ç":"U","á»¦":"U","Å®":"U","Å°":"U","Ç":"U","È":"U","È":"U","Æ¯":"U","á»ª":"U","á»¨":"U","á»®":"U","á»¬":"U","á»°":"U","á»¤":"U","á¹²":"U","Å²":"U","á¹¶":"U","á¹´":"U","É":"U","â":"V","ï¼¶":"V","á¹¼":"V","á¹¾":"V","Æ²":"V","ê":"V","É":"V","ê ":"VY","â":"W","ï¼·":"W","áº":"W","áº":"W","Å´":"W","áº":"W","áº":"W","áº":"W","â±²":"W","â":"X","ï¼¸":"X","áº":"X","áº":"X","â":"Y","ï¼¹":"Y","á»²":"Y","Ã":"Y","Å¶":"Y","á»¸":"Y","È²":"Y","áº":"Y","Å¸":"Y","á»¶":"Y","á»´":"Y","Æ³":"Y","É":"Y","á»¾":"Y","â":"Z","ï¼º":"Z","Å¹":"Z","áº":"Z","Å»":"Z","Å½":"Z","áº":"Z","áº":"Z","Æµ":"Z","È¤":"Z","â±¿":"Z","â±«":"Z","ê¢":"Z","â":"a","ï½":"a","áº":"a","Ã ":"a","Ã¡":"a","Ã¢":"a","áº§":"a","áº¥":"a","áº«":"a","áº©":"a","Ã£":"a","Ä":"a","Ä":"a","áº±":"a","áº¯":"a","áºµ":"a","áº³":"a","È§":"a","Ç¡":"a","Ã¤":"a","Ç":"a","áº£":"a","Ã¥":"a","Ç»":"a","Ç":"a","È":"a","È":"a","áº¡":"a","áº­":"a","áº·":"a","á¸":"a","Ä":"a","â±¥":"a","É":"a","ê³":"aa","Ã¦":"ae","Ç½":"ae","Ç£":"ae","êµ":"ao","ê·":"au","ê¹":"av","ê»":"av","ê½":"ay","â":"b","ï½":"b","á¸":"b","á¸":"b","á¸":"b","Æ":"b","Æ":"b","É":"b","â":"c","ï½":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ã§":"c","á¸":"c","Æ":"c","È¼":"c","ê¿":"c","â":"c","â":"d","ï½":"d","á¸":"d","Ä":"d","á¸":"d","á¸":"d","á¸":"d","á¸":"d","Ä":"d","Æ":"d","É":"d","É":"d","êº":"d","Ç³":"dz","Ç":"dz","â":"e","ï½":"e","Ã¨":"e","Ã©":"e","Ãª":"e","á»":"e","áº¿":"e","á»":"e","á»":"e","áº½":"e","Ä":"e","á¸":"e","á¸":"e","Ä":"e","Ä":"e","Ã«":"e","áº»":"e","Ä":"e","È":"e","È":"e","áº¹":"e","á»":"e","È©":"e","á¸":"e","Ä":"e","á¸":"e","á¸":"e","É":"e","É":"e","Ç":"e","â":"f","ï½":"f","á¸":"f","Æ":"f","ê¼":"f","â":"g","ï½":"g","Çµ":"g","Ä":"g","á¸¡":"g","Ä":"g","Ä¡":"g","Ç§":"g","Ä£":"g","Ç¥":"g","É ":"g","ê¡":"g","áµ¹":"g","ê¿":"g","â":"h","ï½":"h","Ä¥":"h","á¸£":"h","á¸§":"h","È":"h","á¸¥":"h","á¸©":"h","á¸«":"h","áº":"h","Ä§":"h","â±¨":"h","â±¶":"h","É¥":"h","Æ":"hv","â":"i","ï½":"i","Ã¬":"i","Ã­":"i","Ã®":"i","Ä©":"i","Ä«":"i","Ä­":"i","Ã¯":"i","á¸¯":"i","á»":"i","Ç":"i","È":"i","È":"i","á»":"i","Ä¯":"i","á¸­":"i","É¨":"i","Ä±":"i","â":"j","ï½":"j","Äµ":"j","Ç°":"j","É":"j","â":"k","ï½":"k","á¸±":"k","Ç©":"k","á¸³":"k","Ä·":"k","á¸µ":"k","Æ":"k","â±ª":"k","ê":"k","ê":"k","ê":"k","ê£":"k","â":"l","ï½":"l","Å":"l","Äº":"l","Ä¾":"l","á¸·":"l","á¸¹":"l","Ä¼":"l","á¸½":"l","á¸»":"l","Å¿":"l","Å":"l","Æ":"l","É«":"l","â±¡":"l","ê":"l","ê":"l","ê":"l","Ç":"lj","â":"m","ï½":"m","á¸¿":"m","á¹":"m","á¹":"m","É±":"m","É¯":"m","â":"n","ï½":"n","Ç¹":"n","Å":"n","Ã±":"n","á¹":"n","Å":"n","á¹":"n","Å":"n","á¹":"n","á¹":"n","Æ":"n","É²":"n","Å":"n","ê":"n","ê¥":"n","Ç":"nj","â":"o","ï½":"o","Ã²":"o","Ã³":"o","Ã´":"o","á»":"o","á»":"o","á»":"o","á»":"o","Ãµ":"o","á¹":"o","È­":"o","á¹":"o","Å":"o","á¹":"o","á¹":"o","Å":"o","È¯":"o","È±":"o","Ã¶":"o","È«":"o","á»":"o","Å":"o","Ç":"o","È":"o","È":"o","Æ¡":"o","á»":"o","á»":"o","á»¡":"o","á»":"o","á»£":"o","á»":"o","á»":"o","Ç«":"o","Ç­":"o","Ã¸":"o","Ç¿":"o","É":"o","ê":"o","ê":"o","Éµ":"o","Å":"oe","Æ£":"oi","È£":"ou","ê":"oo","â":"p","ï½":"p","á¹":"p","á¹":"p","Æ¥":"p","áµ½":"p","ê":"p","ê":"p","ê":"p","â ":"q","ï½":"q","É":"q","ê":"q","ê":"q","â¡":"r","ï½":"r","Å":"r","á¹":"r","Å":"r","È":"r","È":"r","á¹":"r","á¹":"r","Å":"r","á¹":"r","É":"r","É½":"r","ê":"r","ê§":"r","ê":"r","â¢":"s","ï½":"s","Ã":"s","Å":"s","á¹¥":"s","Å":"s","á¹¡":"s","Å¡":"s","á¹§":"s","á¹£":"s","á¹©":"s","È":"s","Å":"s","È¿":"s","ê©":"s","ê":"s","áº":"s","â£":"t","ï½":"t","á¹«":"t","áº":"t","Å¥":"t","á¹­":"t","È":"t","Å£":"t","á¹±":"t","á¹¯":"t","Å§":"t","Æ­":"t","Ê":"t","â±¦":"t","ê":"t","ê©":"tz","â¤":"u","ï½":"u","Ã¹":"u","Ãº":"u","Ã»":"u","Å©":"u","á¹¹":"u","Å«":"u","á¹»":"u","Å­":"u","Ã¼":"u","Ç":"u","Ç":"u","Ç":"u","Ç":"u","á»§":"u","Å¯":"u","Å±":"u","Ç":"u","È":"u","È":"u","Æ°":"u","á»«":"u","á»©":"u","á»¯":"u","á»­":"u","á»±":"u","á»¥":"u","á¹³":"u","Å³":"u","á¹·":"u","á¹µ":"u","Ê":"u","â¥":"v","ï½":"v","á¹½":"v","á¹¿":"v","Ê":"v","ê":"v","Ê":"v","ê¡":"vy","â¦":"w","ï½":"w","áº":"w","áº":"w","Åµ":"w","áº":"w","áº":"w","áº":"w","áº":"w","â±³":"w","â§":"x","ï½":"x","áº":"x","áº":"x","â¨":"y","ï½":"y","á»³":"y","Ã½":"y","Å·":"y","á»¹":"y","È³":"y","áº":"y","Ã¿":"y","á»·":"y","áº":"y","á»µ":"y","Æ´":"y","É":"y","á»¿":"y","â©":"z","ï½":"z","Åº":"z","áº":"z","Å¼":"z","Å¾":"z","áº":"z","áº":"z","Æ¶":"z","È¥":"z","É":"z","â±¬":"z","ê£":"z","Î":"Î","Î":"Î","Î":"Î","Î":"Î","Îª":"Î","Î":"Î","Î":"Î¥","Î«":"Î¥","Î":"Î©","Î¬":"Î±","Î­":"Îµ","Î®":"Î·","Î¯":"Î¹","Ï":"Î¹","Î":"Î¹","Ï":"Î¿","Ï":"Ï","Ï":"Ï","Î°":"Ï","Ï":"Ï","Ï":"Ï","â":"'"}})),e.define("select2/data/base",["../utils"],(function(r){function n(e,t){n.__super__.constructor.call(this)}return r.Extend(n,r.Observable),n.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},n.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},n.prototype.bind=function(e,t){},n.prototype.destroy=function(){},n.prototype.generateResultId=function(e,t){var n=e.id+"-result-";return n+=r.generateChars(4),null!=t.id?n+="-"+t.id.toString():n+="-"+r.generateChars(4),n},n})),e.define("select2/data/select",["./base","../utils","jquery"],(function(e,a,l){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return a.Extend(n,e),n.prototype.current=function(e){var n=[],r=this;this.$element.find(":selected").each((function(){var e=l(this),t=r.item(e);n.push(t)})),e(n)},n.prototype.select=function(i){var o=this;if(i.selected=!0,l(i.element).is("option"))return i.element.selected=!0,void this.$element.trigger("input").trigger("change");if(this.$element.prop("multiple"))this.current((function(e){var t=[];(i=[i]).push.apply(i,e);for(var n=0;n<i.length;n++){var r=i[n].id;-1===l.inArray(r,t)&&t.push(r)}o.$element.val(t),o.$element.trigger("input").trigger("change")}));else{var e=i.id;this.$element.val(e),this.$element.trigger("input").trigger("change")}},n.prototype.unselect=function(i){var o=this;if(this.$element.prop("multiple")){if(i.selected=!1,l(i.element).is("option"))return i.element.selected=!1,void this.$element.trigger("input").trigger("change");this.current((function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].id;r!==i.id&&-1===l.inArray(r,t)&&t.push(r)}o.$element.val(t),o.$element.trigger("input").trigger("change")}))}},n.prototype.bind=function(e,t){var n=this;(this.container=e).on("select",(function(e){n.select(e.data)})),e.on("unselect",(function(e){n.unselect(e.data)}))},n.prototype.destroy=function(){this.$element.find("*").each((function(){a.RemoveData(this)}))},n.prototype.query=function(r,e){var i=[],o=this;this.$element.children().each((function(){var e=l(this);if(e.is("option")||e.is("optgroup")){var t=o.item(e),n=o.matches(r,t);null!==n&&i.push(n)}})),e({results:i})},n.prototype.addOptions=function(e){a.appendMany(this.$element,e)},n.prototype.option=function(e){var t;e.children?(t=document.createElement("optgroup")).label=e.text:void 0!==(t=document.createElement("option")).textContent?t.textContent=e.text:t.innerText=e.text,void 0!==e.id&&(t.value=e.id),e.disabled&&(t.disabled=!0),e.selected&&(t.selected=!0),e.title&&(t.title=e.title);var n=l(t),r=this._normalizeItem(e);return r.element=t,a.StoreData(t,"data",r),n},n.prototype.item=function(e){var t={};if(null!=(t=a.GetData(e[0],"data")))return t;if(e.is("option"))t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){t={text:e.prop("label"),children:[],title:e.prop("title")};for(var n=e.children("option"),r=[],i=0;i<n.length;i++){var o=l(n[i]),s=this.item(o);r.push(s)}t.children=r}return(t=this._normalizeItem(t)).element=e[0],a.StoreData(e[0],"data",t),t},n.prototype._normalizeItem=function(e){return e!==Object(e)&&(e={id:e,text:e}),null!=(e=l.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),l.extend({},{selected:!1,disabled:!1},e)},n.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},n})),e.define("select2/data/array",["./select","../utils","jquery"],(function(e,f,g){function r(e,t){this._dataToConvert=t.get("data")||[],r.__super__.constructor.call(this,e,t)}return f.Extend(r,e),r.prototype.bind=function(e,t){r.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},r.prototype.select=function(n){var e=this.$element.find("option").filter((function(e,t){return t.value==n.id.toString()}));0===e.length&&(e=this.option(n),this.addOptions(e)),r.__super__.select.call(this,n)},r.prototype.convertToOptions=function(e){var t=this,n=this.$element.find("option"),r=n.map((function(){return t.item(g(this)).id})).get(),i=[];function o(e){return function(){return g(this).val()==e.id}}for(var s=0;s<e.length;s++){var a=this._normalizeItem(e[s]);if(0<=g.inArray(a.id,r)){var l=n.filter(o(a)),c=this.item(l),u=g.extend(!0,{},a,c),d=this.option(u);l.replaceWith(d)}else{var p=this.option(a);if(a.children){var h=this.convertToOptions(a.children);f.appendMany(p,h)}i.push(p)}}return i},r})),e.define("select2/data/ajax",["./array","../utils","jquery"],(function(e,t,o){function n(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),n.__super__.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype._applyDefaults=function(e){var t={data:function(e){return o.extend({},e,{q:e.term})},transport:function(e,t,n){var r=o.ajax(e);return r.then(t),r.fail(n),r}};return o.extend({},t,e,!0)},n.prototype.processResults=function(e){return e},n.prototype.query=function(n,r){var i=this;null!=this._request&&(o.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var t=o.extend({type:"GET"},this.ajaxOptions);function e(){var e=t.transport(t,(function(e){var t=i.processResults(e,n);i.options.get("debug")&&window.console&&console.error&&(t&&t.results&&o.isArray(t.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),r(t)}),(function(){"status"in e&&(0===e.status||"0"===e.status)||i.trigger("results:message",{message:"errorLoading"})}));i._request=e}"function"==typeof t.url&&(t.url=t.url.call(this.$element,n)),"function"==typeof t.data&&(t.data=t.data.call(this.$element,n)),this.ajaxOptions.delay&&null!=n.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(e,this.ajaxOptions.delay)):e()},n})),e.define("select2/data/tags",["jquery"],(function(u){function e(e,t,n){var r=n.get("tags"),i=n.get("createTag");void 0!==i&&(this.createTag=i);var o=n.get("insertTag");if(void 0!==o&&(this.insertTag=o),e.call(this,t,n),u.isArray(r))for(var s=0;s<r.length;s++){var a=r[s],l=this._normalizeItem(a),c=this.option(l);this.$element.append(c)}}return e.prototype.query=function(e,c,u){var d=this;this._removeOldTags(),null!=c.term&&null==c.page?e.call(this,c,(function e(t,n){for(var r=t.results,i=0;i<r.length;i++){var o=r[i],s=null!=o.children&&!e({results:o.children},!0);if((o.text||"").toUpperCase()===(c.term||"").toUpperCase()||s)return!n&&(t.data=r,void u(t))}if(n)return!0;var a=d.createTag(c);if(null!=a){var l=d.option(a);l.attr("data-select2-tag",!0),d.addOptions([l]),d.insertTag(r,a)}t.results=r,u(t)})):e.call(this,c,u)},e.prototype.createTag=function(e,t){var n=u.trim(t.term);return""===n?null:{id:n,text:n}},e.prototype.insertTag=function(e,t,n){t.unshift(n)},e.prototype._removeOldTags=function(e){this.$element.find("option[data-select2-tag]").each((function(){this.selected||u(this).remove()}))},e})),e.define("select2/data/tokenizer",["jquery"],(function(d){function e(e,t,n){var r=n.get("tokenizer");void 0!==r&&(this.tokenizer=r),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},e.prototype.query=function(e,t,n){var i=this;t.term=t.term||"";var r=this.tokenizer(t,this.options,(function(e){var t,n=i._normalizeItem(e);if(!i.$element.find("option").filter((function(){return d(this).val()===n.id})).length){var r=i.option(n);r.attr("data-select2-tag",!0),i._removeOldTags(),i.addOptions([r])}t=n,i.trigger("select",{data:t})}));r.term!==t.term&&(this.$search.length&&(this.$search.val(r.term),this.$search.trigger("focus")),t.term=r.term),e.call(this,t,n)},e.prototype.tokenizer=function(e,t,n,r){for(var i=n.get("tokenSeparators")||[],o=t.term,s=0,a=this.createTag||function(e){return{id:e.term,text:e.term}};s<o.length;){var l=o[s];if(-1!==d.inArray(l,i)){var c=o.substr(0,s),u=a(d.extend({},t,{term:c}));null!=u?(r(u),o=o.substr(s+1)||"",s=0):s++}else s++}return{term:o}},e})),e.define("select2/data/minimumInputLength",[],(function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e})),e.define("select2/data/maximumInputLength",[],(function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e})),e.define("select2/data/maximumSelectionLength",[],(function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("select",(function(){r._checkIfMaximumSelected()}))},e.prototype.query=function(e,t,n){var r=this;this._checkIfMaximumSelected((function(){e.call(r,t,n)}))},e.prototype._checkIfMaximumSelected=function(e,n){var r=this;this.current((function(e){var t=null!=e?e.length:0;0<r.maximumSelectionLength&&t>=r.maximumSelectionLength?r.trigger("results:message",{message:"maximumSelected",args:{maximum:r.maximumSelectionLength}}):n&&n()}))},e})),e.define("select2/dropdown",["jquery","./utils"],(function(t,e){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return e.Extend(n,e.Observable),n.prototype.render=function(){var e=t('<span class="select2-dropdown"><span class="select2-results"></span></span>');return e.attr("dir",this.options.get("dir")),this.$dropdown=e},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n})),e.define("select2/dropdown/search",["jquery","../utils"],(function(o,e){function t(){}return t.prototype.render=function(e){var t=e.call(this),n=o('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=n,this.$search=n.find("input"),t.prepend(n),t},t.prototype.bind=function(e,t,n){var r=this,i=t.id+"-results";e.call(this,t,n),this.$search.on("keydown",(function(e){r.trigger("keypress",e),r._keyUpPrevented=e.isDefaultPrevented()})),this.$search.on("input",(function(e){o(this).off("keyup")})),this.$search.on("keyup input",(function(e){r.handleSearch(e)})),t.on("open",(function(){r.$search.attr("tabindex",0),r.$search.attr("aria-controls",i),r.$search.trigger("focus"),window.setTimeout((function(){r.$search.trigger("focus")}),0)})),t.on("close",(function(){r.$search.attr("tabindex",-1),r.$search.removeAttr("aria-controls"),r.$search.removeAttr("aria-activedescendant"),r.$search.val(""),r.$search.trigger("blur")})),t.on("focus",(function(){t.isOpen()||r.$search.trigger("focus")})),t.on("results:all",(function(e){null!=e.query.term&&""!==e.query.term||(r.showSearch(e)?r.$searchContainer.removeClass("select2-search--hide"):r.$searchContainer.addClass("select2-search--hide"))})),t.on("results:focus",(function(e){e.data._resultId?r.$search.attr("aria-activedescendant",e.data._resultId):r.$search.removeAttr("aria-activedescendant")}))},t.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},t.prototype.showSearch=function(e,t){return!0},t})),e.define("select2/dropdown/hidePlaceholder",[],(function(){function e(e,t,n,r){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,r)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),r=t.length-1;0<=r;r--){var i=t[r];this.placeholder.id===i.id&&n.splice(r,1)}return n},e})),e.define("select2/dropdown/infiniteScroll",["jquery"],(function(n){function e(e,t,n,r){this.lastParams={},e.call(this,t,n,r),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return e.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("query",(function(e){r.lastParams=e,r.loading=!0})),t.on("query:append",(function(e){r.lastParams=e,r.loading=!0})),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},e.prototype.loadMoreIfNeeded=function(){var e=n.contains(document.documentElement,this.$loadingMore[0]);if(!this.loading&&e){var t=this.$results.offset().top+this.$results.outerHeight(!1);this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=t+50&&this.loadMore()}},e.prototype.loadMore=function(){this.loading=!0;var e=n.extend({},{page:1},this.lastParams);e.page++,this.trigger("query:append",e)},e.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},e.prototype.createLoadingMore=function(){var e=n('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),t=this.options.get("translations").get("loadingMore");return e.html(t(this.lastParams)),e},e})),e.define("select2/dropdown/attachBody",["jquery","../utils"],(function(f,a){function e(e,t,n){this.$dropdownParent=f(n.get("dropdownParent")||document.body),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("open",(function(){r._showDropdown(),r._attachPositioningHandler(t),r._bindContainerResultHandlers(t)})),t.on("close",(function(){r._hideDropdown(),r._detachPositioningHandler(t)})),this.$dropdownContainer.on("mousedown",(function(e){e.stopPropagation()}))},e.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},e.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},e.prototype.render=function(e){var t=f("<span></span>"),n=e.call(this);return t.append(n),this.$dropdownContainer=t},e.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},e.prototype._bindContainerResultHandlers=function(e,t){if(!this._containerResultsHandlersBound){var n=this;t.on("results:all",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("results:append",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("results:message",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("select",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("unselect",(function(){n._positionDropdown(),n._resizeDropdown()})),this._containerResultsHandlersBound=!0}},e.prototype._attachPositioningHandler=function(e,t){var n=this,r="scroll.select2."+t.id,i="resize.select2."+t.id,o="orientationchange.select2."+t.id,s=this.$container.parents().filter(a.hasScroll);s.each((function(){a.StoreData(this,"select2-scroll-position",{x:f(this).scrollLeft(),y:f(this).scrollTop()})})),s.on(r,(function(e){var t=a.GetData(this,"select2-scroll-position");f(this).scrollTop(t.y)})),f(window).on(r+" "+i+" "+o,(function(e){n._positionDropdown(),n._resizeDropdown()}))},e.prototype._detachPositioningHandler=function(e,t){var n="scroll.select2."+t.id,r="resize.select2."+t.id,i="orientationchange.select2."+t.id;this.$container.parents().filter(a.hasScroll).off(n),f(window).off(n+" "+r+" "+i)},e.prototype._positionDropdown=function(){var e=f(window),t=this.$dropdown.hasClass("select2-dropdown--above"),n=this.$dropdown.hasClass("select2-dropdown--below"),r=null,i=this.$container.offset();i.bottom=i.top+this.$container.outerHeight(!1);var o={height:this.$container.outerHeight(!1)};o.top=i.top,o.bottom=i.top+o.height;var s=this.$dropdown.outerHeight(!1),a=e.scrollTop(),l=e.scrollTop()+e.height(),c=a<i.top-s,u=l>i.bottom+s,d={left:i.left,top:o.bottom},p=this.$dropdownParent;"static"===p.css("position")&&(p=p.offsetParent());var h={top:0,left:0};(f.contains(document.body,p[0])||p[0].isConnected)&&(h=p.offset()),d.top-=h.top,d.left-=h.left,t||n||(r="below"),u||!c||t?!c&&u&&t&&(r="below"):r="above",("above"==r||t&&"below"!==r)&&(d.top=o.top-h.top-s),null!=r&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+r),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+r)),this.$dropdownContainer.css(d)},e.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},e.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},e})),e.define("select2/dropdown/minimumResultsForSearch",[],(function(){function e(e,t,n,r){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,r)}return e.prototype.showSearch=function(e,t){return!(function e(t){for(var n=0,r=0;r<t.length;r++){var i=t[r];i.children?n+=e(i.children):n++}return n}(t.data.results)<this.minimumResultsForSearch)&&e.call(this,t)},e})),e.define("select2/dropdown/selectOnClose",["../utils"],(function(o){function e(){}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("close",(function(e){r._handleSelectOnClose(e)}))},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var n=t.originalSelect2Event;if("select"===n._type||"unselect"===n._type)return}var r=this.getHighlightedResults();if(!(r.length<1)){var i=o.GetData(r[0],"data");null!=i.element&&i.element.selected||null==i.element&&i.selected||this.trigger("select",{data:i})}},e})),e.define("select2/dropdown/closeOnSelect",[],(function(){function e(){}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("select",(function(e){r._selectTriggered(e)})),t.on("unselect",(function(e){r._selectTriggered(e)}))},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e})),e.define("select2/i18n/en",[],(function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more resultsâ¦"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searchingâ¦"},removeAllItems:function(){return"Remove all items"}}})),e.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],(function(c,u,d,p,h,f,g,m,v,y,s,t,_,$,b,w,A,x,D,S,E,C,O,T,q,L,I,j,e){function n(){this.reset()}return n.prototype.apply=function(e){if(null==(e=c.extend(!0,{},this.defaults,e)).dataAdapter){if(null!=e.ajax?e.dataAdapter=b:null!=e.data?e.dataAdapter=$:e.dataAdapter=_,0<e.minimumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,x)),0<e.maximumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,D)),0<e.maximumSelectionLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,S)),e.tags&&(e.dataAdapter=y.Decorate(e.dataAdapter,w)),null==e.tokenSeparators&&null==e.tokenizer||(e.dataAdapter=y.Decorate(e.dataAdapter,A)),null!=e.query){var t=u(e.amdBase+"compat/query");e.dataAdapter=y.Decorate(e.dataAdapter,t)}if(null!=e.initSelection){var n=u(e.amdBase+"compat/initSelection");e.dataAdapter=y.Decorate(e.dataAdapter,n)}}if(null==e.resultsAdapter&&(e.resultsAdapter=d,null!=e.ajax&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,T)),null!=e.placeholder&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,O)),e.selectOnClose&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,I))),null==e.dropdownAdapter){if(e.multiple)e.dropdownAdapter=E;else{var r=y.Decorate(E,C);e.dropdownAdapter=r}if(0!==e.minimumResultsForSearch&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,L)),e.closeOnSelect&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,j)),null!=e.dropdownCssClass||null!=e.dropdownCss||null!=e.adaptDropdownCssClass){var i=u(e.amdBase+"compat/dropdownCss");e.dropdownAdapter=y.Decorate(e.dropdownAdapter,i)}e.dropdownAdapter=y.Decorate(e.dropdownAdapter,q)}if(null==e.selectionAdapter){if(e.multiple?e.selectionAdapter=h:e.selectionAdapter=p,null!=e.placeholder&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,f)),e.allowClear&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,g)),e.multiple&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,m)),null!=e.containerCssClass||null!=e.containerCss||null!=e.adaptContainerCssClass){var o=u(e.amdBase+"compat/containerCss");e.selectionAdapter=y.Decorate(e.selectionAdapter,o)}e.selectionAdapter=y.Decorate(e.selectionAdapter,v)}e.language=this._resolveLanguage(e.language),e.language.push("en");for(var s=[],a=0;a<e.language.length;a++){var l=e.language[a];-1===s.indexOf(l)&&s.push(l)}return e.language=s,e.translations=this._processTranslations(e.language,e.debug),e},n.prototype.reset=function(){function a(e){return e.replace(/[^\u0000-\u007E]/g,(function(e){return t[e]||e}))}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:y.escapeMarkup,language:{},matcher:function e(t,n){if(""===c.trim(t.term))return n;if(n.children&&0<n.children.length){for(var r=c.extend(!0,{},n),i=n.children.length-1;0<=i;i--)null==e(t,n.children[i])&&r.children.splice(i,1);return 0<r.children.length?r:e(t,r)}var o=a(n.text).toUpperCase(),s=a(t.term).toUpperCase();return-1<o.indexOf(s)?n:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},n.prototype.applyFromElement=function(e,t){var n=e.language,r=this.defaults.language,i=t.prop("lang"),o=t.closest("[lang]").prop("lang"),s=Array.prototype.concat.call(this._resolveLanguage(i),this._resolveLanguage(n),this._resolveLanguage(r),this._resolveLanguage(o));return e.language=s,e},n.prototype._resolveLanguage=function(e){if(!e)return[];if(c.isEmptyObject(e))return[];if(c.isPlainObject(e))return[e];var t;t=c.isArray(e)?e:[e];for(var n=[],r=0;r<t.length;r++)if(n.push(t[r]),"string"==typeof t[r]&&0<t[r].indexOf("-")){var i=t[r].split("-")[0];n.push(i)}return n},n.prototype._processTranslations=function(e,t){for(var n=new s,r=0;r<e.length;r++){var i=new s,o=e[r];if("string"==typeof o)try{i=s.loadPath(o)}catch(e){try{o=this.defaults.amdLanguageBase+o,i=s.loadPath(o)}catch(e){t&&window.console&&console.warn&&console.warn('Select2: The language file for "'+o+'" could not be automatically loaded. A fallback will be used instead.')}}else i=c.isPlainObject(o)?new s(o):o;n.extend(i)}return n},n.prototype.set=function(e,t){var n={};n[c.camelCase(e)]=t;var r=y._convertData(n);c.extend(!0,this.defaults,r)},new n})),e.define("select2/options",["require","jquery","./defaults","./utils"],(function(r,d,i,p){function e(e,t){if(this.options=e,null!=t&&this.fromElement(t),null!=t&&(this.options=i.applyFromElement(this.options,t)),this.options=i.apply(this.options),t&&t.is("input")){var n=r(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=p.Decorate(this.options.dataAdapter,n)}}return e.prototype.fromElement=function(e){var t=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),p.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),p.StoreData(e[0],"data",p.GetData(e[0],"select2Tags")),p.StoreData(e[0],"tags",!0)),p.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",p.GetData(e[0],"ajaxUrl")),p.StoreData(e[0],"ajax-Url",p.GetData(e[0],"ajaxUrl")));var n={};function r(e,t){return t.toUpperCase()}for(var i=0;i<e[0].attributes.length;i++){var o=e[0].attributes[i].name,s="data-";if(o.substr(0,s.length)==s){var a=o.substring(s.length),l=p.GetData(e[0],a);n[a.replace(/-([a-z])/g,r)]=l}}d.fn.jquery&&"1."==d.fn.jquery.substr(0,2)&&e[0].dataset&&(n=d.extend(!0,{},e[0].dataset,n));var c=d.extend(!0,{},p.GetData(e[0]),n);for(var u in c=p._convertData(c))-1<d.inArray(u,t)||(d.isPlainObject(this.options[u])?d.extend(this.options[u],c[u]):this.options[u]=c[u]);return this},e.prototype.get=function(e){return this.options[e]},e.prototype.set=function(e,t){this.options[e]=t},e})),e.define("select2/core",["jquery","./options","./utils","./keys"],(function(o,c,u,r){var d=function(e,t){null!=u.GetData(e[0],"select2")&&u.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),t=t||{},this.options=new c(t,e),d.__super__.constructor.call(this);var n=e.attr("tabindex")||0;u.StoreData(e[0],"old-tabindex",n),e.attr("tabindex","-1");var r=this.options.get("dataAdapter");this.dataAdapter=new r(e,this.options);var i=this.render();this._placeContainer(i);var o=this.options.get("selectionAdapter");this.selection=new o(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,i);var s=this.options.get("dropdownAdapter");this.dropdown=new s(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,i);var a=this.options.get("resultsAdapter");this.results=new a(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var l=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current((function(e){l.trigger("selection:update",{data:e})})),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),u.StoreData(e[0],"select2",this),e.data("select2",this)};return u.Extend(d,u.Observable),d.prototype._generateId=function(e){return"select2-"+(null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+u.generateChars(2):u.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},d.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},d.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var r=this._resolveWidth(e,"style");return null!=r?r:this._resolveWidth(e,"element")}if("element"==t){var i=e.outerWidth(!1);return i<=0?"auto":i+"px"}if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(e[0]).width;var o=e.attr("style");if("string"!=typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;a<l;a+=1){var c=s[a].replace(/\s/g,"").match(n);if(null!==c&&1<=c.length)return c[1]}return null},d.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},d.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",(function(){t.dataAdapter.current((function(e){t.trigger("selection:update",{data:e})}))})),this.$element.on("focus.select2",(function(e){t.trigger("focus",e)})),this._syncA=u.bind(this._syncAttributes,this),this._syncS=u.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=e?(this._observer=new e((function(e){t._syncA(),t._syncS(null,e)})),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},d.prototype._registerDataEvents=function(){var n=this;this.dataAdapter.on("*",(function(e,t){n.trigger(e,t)}))},d.prototype._registerSelectionEvents=function(){var n=this,r=["toggle","focus"];this.selection.on("toggle",(function(){n.toggleDropdown()})),this.selection.on("focus",(function(e){n.focus(e)})),this.selection.on("*",(function(e,t){-1===o.inArray(e,r)&&n.trigger(e,t)}))},d.prototype._registerDropdownEvents=function(){var n=this;this.dropdown.on("*",(function(e,t){n.trigger(e,t)}))},d.prototype._registerResultsEvents=function(){var n=this;this.results.on("*",(function(e,t){n.trigger(e,t)}))},d.prototype._registerEvents=function(){var n=this;this.on("open",(function(){n.$container.addClass("select2-container--open")})),this.on("close",(function(){n.$container.removeClass("select2-container--open")})),this.on("enable",(function(){n.$container.removeClass("select2-container--disabled")})),this.on("disable",(function(){n.$container.addClass("select2-container--disabled")})),this.on("blur",(function(){n.$container.removeClass("select2-container--focus")})),this.on("query",(function(t){n.isOpen()||n.trigger("open",{}),this.dataAdapter.query(t,(function(e){n.trigger("results:all",{data:e,query:t})}))})),this.on("query:append",(function(t){this.dataAdapter.query(t,(function(e){n.trigger("results:append",{data:e,query:t})}))})),this.on("keypress",(function(e){var t=e.which;n.isOpen()?t===r.ESC||t===r.TAB||t===r.UP&&e.altKey?(n.close(e),e.preventDefault()):t===r.ENTER?(n.trigger("results:select",{}),e.preventDefault()):t===r.SPACE&&e.ctrlKey?(n.trigger("results:toggle",{}),e.preventDefault()):t===r.UP?(n.trigger("results:previous",{}),e.preventDefault()):t===r.DOWN&&(n.trigger("results:next",{}),e.preventDefault()):(t===r.ENTER||t===r.SPACE||t===r.DOWN&&e.altKey)&&(n.open(),e.preventDefault())}))},d.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.isDisabled()?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},d.prototype._isChangeMutation=function(e,t){var n=!1,r=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&0<t.addedNodes.length)for(var i=0;i<t.addedNodes.length;i++)t.addedNodes[i].selected&&(n=!0);else t.removedNodes&&0<t.removedNodes.length?n=!0:o.isArray(t)&&o.each(t,(function(e,t){if(r._isChangeMutation(e,t))return!(n=!0)}));else n=!0;return n}},d.prototype._syncSubtree=function(e,t){var n=this._isChangeMutation(e,t),r=this;n&&this.dataAdapter.current((function(e){r.trigger("selection:update",{data:e})}))},d.prototype.trigger=function(e,t){var n=d.__super__.trigger,r={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in r){var i=r[e],o={prevented:!1,name:e,args:t};if(n.call(this,i,o),o.prevented)return void(t.prevented=!0)}n.call(this,e,t)},d.prototype.toggleDropdown=function(){this.isDisabled()||(this.isOpen()?this.close():this.open())},d.prototype.open=function(){this.isOpen()||this.isDisabled()||this.trigger("query",{})},d.prototype.close=function(e){this.isOpen()&&this.trigger("close",{originalEvent:e})},d.prototype.isEnabled=function(){return!this.isDisabled()},d.prototype.isDisabled=function(){return this.options.get("disabled")},d.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},d.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},d.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},d.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},d.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var t=[];return this.dataAdapter.current((function(e){t=e})),t},d.prototype.val=function(e){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==e||0===e.length)return this.$element.val();var t=e[0];o.isArray(t)&&(t=o.map(t,(function(e){return e.toString()}))),this.$element.val(t).trigger("input").trigger("change")},d.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",u.GetData(this.$element[0],"old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),u.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},d.prototype.render=function(){var e=o('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return e.attr("dir",this.options.get("dir")),this.$container=e,this.$container.addClass("select2-container--"+this.options.get("theme")),u.StoreData(e[0],"element",this.$element),e},d})),e.define("jquery-mousewheel",["jquery"],(function(e){return e})),e.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],(function(i,e,o,t,s){if(null==i.fn.select2){var a=["open","close","destroy"];i.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each((function(){var e=i.extend(!0,{},t);new o(i(this),e)})),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var n,r=Array.prototype.slice.call(arguments,1);return this.each((function(){var e=s.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),n=e[t].apply(e,r)})),-1<i.inArray(t,a)?this:n}}return null==i.fn.select2.defaults&&(i.fn.select2.defaults=t),o})),{define:e.define,require:e.require}}(),t=e.require("jquery.select2");return u.fn.select2.amd=e,t})),function(){"use strict";var typeOf$1=function(x){if(null===x)return"null";if(void 0===x)return"undefined";var t=typeof x;return"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t},eq$2=function(f){return{eq:f}},eqString=eq$2((function(x,y){return x===y})),eqArray=function(eqa){return eq$2((function(x,y){if(x.length!==y.length)return!1;for(var len=x.length,i=0;i<len;i++)if(!eqa.eq(x[i],y[i]))return!1;return!0}))},eqSortedArray=function(eqa,compareFn){return function(eqa,f){return eq$2((function(x,y){return eqa.eq(f(x),f(y))}))}(eqArray(eqa),(function(xs){return function(xs,compareFn){return Array.prototype.slice.call(xs).sort(compareFn)}(xs,compareFn)}))},eqRecord=function(eqa){return eq$2((function(x,y){var kx=Object.keys(x),ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky))return!1;for(var len=kx.length,i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q]))return!1}return!0}))},eqAny=eq$2((function(x,y){if(x===y)return!0;var tx=typeOf$1(x);return tx===typeOf$1(y)&&(function(x){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(x)}(tx)?x===y:"array"===tx?eqArray(eqAny).eq(x,y):"object"===tx&&eqRecord(eqAny).eq(x,y))})),isType$1=function(type){return function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}},isSimpleType=function(type){return function(value){return typeof value===type}},eq$1=function(t){return function(a){return t===a}},isString$1=isType$1("string"),isObject=isType$1("object"),isArray$1=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),noop=function(){},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},compose1=function(fbc,fab){return function(a){return fbc(fab(a))}},constant=function(value){return function(){return value}},identity=function(x){return x},tripleEquals=function(a,b){return a===b};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var not=function(f){return function(t){return!f(t)}},apply=function(f){return f()},call=function(f){f()},never=constant(!1),always=constant(!0),none=function(){return NONE},NONE=function(){var call=function(thunk){return thunk()},id=identity;return{fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant("none()")}}(),some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},contains$3=function(xs,x){return rawIndexOf(xs,x)>-1},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return!0}return!1},map$3=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$k=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i)}},eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--){f(xs[i],i)}},partition=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter$4=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return eachr(xs,(function(x,i){acc=f(acc,x,i)})),acc},foldl=function(xs,f,acc){return each$k(xs,(function(x,i){acc=f(acc,x,i)})),acc},findUntil$1=function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find$3=function(xs,pred){return findUntil$1(xs,pred,never)},findIndex$2=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},bind=function(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map$3(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){if(!0!==pred(xs[i],i))return!1}return!0},reverse=function(xs){var r=nativeSlice.call(xs,0);return r.reverse(),r},difference=function(a1,a2){return filter$4(a1,(function(x){return!contains$3(a2,x)}))},sort=function(xs,comparator){var copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy},get$a=function(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get$a(xs,0)},last$2=function(xs){return get$a(xs,xs.length-1)},from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty$1=Object.hasOwnProperty,each$j=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},map$2=function(obj,f){return tupleMap(obj,(function(x,i){return{k:i,v:f(x,i)}}))},tupleMap=function(obj,f){var r={};return each$j(obj,(function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v})),r},objAcc=function(r){return function(x,i){r[i]=x}},internalFilter=function(obj,pred,onTrue,onFalse){return each$j(obj,(function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})),{}},filter$3=function(obj,pred){var t={};return internalFilter(obj,pred,objAcc(t),noop),t},values=function(obj){return function(obj,f){var r=[];return each$j(obj,(function(value,name){r.push(f(value,name))})),r}(obj,identity)},get$9=function(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none()},has$2=function(obj,key){return hasOwnProperty$1.call(obj,key)},hasNonNullableKey=function(obj,key){return has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key]},isArray=Array.isArray,each$i=function(o,cb,s){var n,l;if(!o)return!1;if(s=s||o,void 0!==o.length){for(n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return!1}else for(n in o)if(has$2(o,n)&&!1===cb.call(s,o[n],n,o))return!1;return!0},map$1=function(array,callback){var out=[];return each$i(array,(function(item,index){out.push(callback(item,index,array))})),out},filter$2=function(a,f){var o=[];return each$i(a,(function(v,index){f&&!f(v,index,a)||o.push(v)})),o},indexOf$1=function(a,v){if(a)for(var i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1},reduce=function(collection,iteratee,accumulator,thisArg){for(var acc=isUndefined(accumulator)?collection[0]:accumulator,i=0;i<collection.length;i++)acc=iteratee.call(thisArg,acc,collection[i],i);return acc},findIndex$1=function(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1},last$1=function(collection){return collection[collection.length-1]},__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}var cached=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},unknown$2=function(){return nu$4(0,0)},nu$4=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$4,detect:function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown$2():function(regexes,agent){var r=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}}(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu$4(group(1),group(2))}(versionRegexes,cleanedAgent)},unknown:unknown$2},detect$2=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$3(candidates,(function(candidate){return candidate.search(agent)}))},contains$2=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr}(str,prefix,0)},blank=function(r){return function(s){return s.replace(r,"")}},trim$4=blank(/^\s+|\s+$/g),lTrim=blank(/^\s+/g),rTrim=blank(/\s+$/g),isNotEmpty=function(s){return s.length>0},isEmpty$3=function(s){return!isNotEmpty(s)},normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return contains$2(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$2(uastring,"edge/")&&contains$2(uastring,"chrome")&&contains$2(uastring,"safari")&&contains$2(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$2(uastring,"chrome")&&!contains$2(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$2(uastring,"msie")||contains$2(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$2(uastring,"safari")||contains$2(uastring,"mobile/"))&&contains$2(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$2(uastring,"iphone")||contains$2(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(browsers),oses:constant(oses)},nu$3=function(info){var current=info.current,version=info.version,isBrowser=function(name){return function(){return current===name}};return{current:current,version:version,isEdge:isBrowser("Edge"),isChrome:isBrowser("Chrome"),isIE:isBrowser("IE"),isOpera:isBrowser("Opera"),isFirefox:isBrowser("Firefox"),isSafari:isBrowser("Safari")}},Browser={unknown:function(){return nu$3({current:void 0,version:Version.unknown()})},nu:nu$3,edge:constant("Edge"),chrome:constant("Chrome"),ie:constant("IE"),opera:constant("Opera"),firefox:constant("Firefox"),safari:constant("Safari")},nu$2=function(info){var current=info.current,version=info.version,isOS=function(name){return function(){return current===name}};return{current:current,version:version,isWindows:isOS("Windows"),isiOS:isOS("iOS"),isAndroid:isOS("Android"),isOSX:isOS("OSX"),isLinux:isOS("Linux"),isSolaris:isOS("Solaris"),isFreeBSD:isOS("FreeBSD"),isChromeOS:isOS("ChromeOS")}},OperatingSystem={unknown:function(){return nu$2({current:void 0,version:Version.unknown()})},nu:nu$2,windows:constant("Windows"),ios:constant("iOS"),android:constant("Android"),linux:constant("Linux"),osx:constant("OSX"),solaris:constant("Solaris"),freebsd:constant("FreeBSD"),chromeos:constant("ChromeOS")},PlatformDetection_detect=function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=userAgentDataOpt.bind((function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,(function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$3(browsers,(function(browser){var _a;return lcBrand===(null===(_a=browser.brand)||void 0===_a?void 0:_a.toLowerCase())})).map((function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}}))}))}(browsers,userAgentData)})).orThunk((function(){return function(browsers,userAgent){return detect$2(browsers,userAgent).map((function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}}))}(browsers,userAgent)})).fold(Browser.unknown,Browser.nu),os=function(oses,userAgent){return detect$2(oses,userAgent).map((function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}}))}(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)}}(os,browser,userAgent,mediaMatch);return{browser:browser,os:os,deviceType:deviceType}},mediaMatch=function(query){return window.matchMedia(query).matches},platform$2=cached((function(){return PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)})),detect=function(){return platform$2()},userAgent=navigator.userAgent,platform$1=detect(),browser$4=platform$1.browser,os=platform$1.os,deviceType=platform$1.deviceType,webkit=/WebKit/.test(userAgent)&&!browser$4.isEdge(),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,windowsPhone=-1!==userAgent.indexOf("Windows Phone"),Env={opera:browser$4.isOpera(),webkit:webkit,ie:!(!browser$4.isIE()&&!browser$4.isEdge())&&browser$4.version.major,gecko:browser$4.isFirefox(),mac:os.isOSX()||os.isiOS(),iOS:deviceType.isiPad()||deviceType.isiPhone(),android:os.isAndroid(),contentEditable:!0,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:!0,range:window.getSelection&&"Range"in window,documentMode:browser$4.isIE()?document.documentMode||7:10,fileApi:fileApi,ceFalse:!0,cacheSuffix:null,container:null,experimentalShadowDom:!1,canHaveCSP:!browser$4.isIE(),desktop:deviceType.isDesktop(),windowsPhone:windowsPhone,browser:{current:browser$4.current,version:browser$4.version,isChrome:browser$4.isChrome,isEdge:browser$4.isEdge,isFirefox:browser$4.isFirefox,isIE:browser$4.isIE,isOpera:browser$4.isOpera,isSafari:browser$4.isSafari},os:{current:os.current,version:os.version,isAndroid:os.isAndroid,isChromeOS:os.isChromeOS,isFreeBSD:os.isFreeBSD,isiOS:os.isiOS,isLinux:os.isLinux,isOSX:os.isOSX,isSolaris:os.isSolaris,isWindows:os.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}},whiteSpaceRegExp$2=/^\s*|\s*$/g,trim$3=function(str){return null==str?"":(""+str).replace(whiteSpaceRegExp$2,"")},is$3=function(obj,type){return type?!("array"!==type||!isArray(obj))||typeof obj===type:void 0!==obj},walk$3=function(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),each$i(o,(function(o,i){if(!1===f.call(s,o,i,n))return!1;walk$3(o,f,n,s)})))},Tools={trim:trim$3,isArray:isArray,is:is$3,toArray:function(obj){if(isArray(obj))return obj;for(var array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array},makeMap:function(items,delim,map){var i;for(delim=delim||",","string"==typeof(items=items||[])&&(items=items.split(delim)),map=map||{},i=items.length;i--;)map[items[i]]={};return map},each:each$i,map:map$1,grep:filter$2,inArray:indexOf$1,hasOwn:has$2,extend:function(obj){for(var exts=[],_i=1;_i<arguments.length;_i++)exts[_i-1]=arguments[_i];for(var i=0;i<exts.length;i++){var ext=exts[i];for(var name_1 in ext)if(has$2(ext,name_1)){var value=ext[name_1];void 0!==value&&(obj[name_1]=value)}}return obj},create:function(s,p,root){var sp,scn,c,de=0,cn=(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s))[3].match(/(^|\.)(\w+)$/i)[2],ns=this.createNS(s[3].replace(/\.\w+$/,""),root);if(!ns[cn]){if("static"===s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=function(){},de=1),ns[cn]=p[cn],this.extend(ns[cn].prototype,p),s[5]&&(sp=this.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],ns[cn]=de?function(){return sp[scn].apply(this,arguments)}:function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],this.each(sp,(function(f,n){ns[cn].prototype[n]=sp[n]})),this.each(p,(function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!==cn&&(ns[cn].prototype[n]=f)}))),this.each(p.static,(function(f,n){ns[cn][n]=f}))}},walk:walk$3,createNS:function(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)o[v=n[i]]||(o[v]={}),o=o[v];return o},resolve:function(n,o){var i,l;for(o=o||window,i=0,l=(n=n.split(".")).length;i<l&&(o=o[n[i]]);i++);return o},explode:function(s,d){return!s||is$3(s,"array")?s:map$1(s.split(d||","),trim$3)},_addCacheSuffix:function(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}},fromDom$2=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},SugarElement={fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom$2(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom$2(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom$2(node)},fromDom:fromDom$2,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2)}},toArray=function(target,f){var r=[],recurse=function(e){return r.push(e),f(e)},cur=f(target);do{cur=cur.bind(recurse)}while(cur.isSome());return r},is$2=function(element,selector){var dom=element.dom;if(1!==dom.nodeType)return!1;var elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},bypassSelector=function(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount},eq=function(e1,e2){return e1.dom===e2.dom},ieContains=function(e1,e2){return a=e1.dom,b=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY);var a,b},contains$1=function(e1,e2){return detect().browser.isIE()?ieContains(e1,e2):function(e1,e2){var d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)}(e1,e2)};"undefined"!=typeof window?window:Function("return this;")();var name=function(element){return element.dom.nodeName.toLowerCase()},type=function(element){return element.dom.nodeType},isType=function(t){return function(element){return type(element)===t}},isElement$6=isType(1),isText$8=isType(3),isDocument$2=isType(9),isDocumentFragment$1=isType(11),owner$1=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument$2(dos)?dos:owner$1(dos)},defaultView=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},prevSibling=function(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom)},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},prevSiblings=function(element){return reverse(toArray(element,prevSibling))},nextSiblings=function(element){return toArray(element,nextSibling)},children=function(element){return map$3(element.dom.childNodes,SugarElement.fromDom)},child$1=function(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},firstChild=function(element){return child$1(element,0)},lastChild=function(element){return child$1(element,element.dom.childNodes.length-1)},childNodesCount=function(element){return element.dom.childNodes.length},isShadowRoot=function(dos){return isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host)},supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported$1=constant(supported),getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getStyleContainer=function(dos){return isShadowRoot(dos)?dos:function(doc){var b=doc.dom.head;if(null==b)throw new Error("Head is not available yet");return SugarElement.fromDom(b)}(documentOrOwner(dos))},getShadowHost=function(e){return SugarElement.fromDom(e.dom.host)},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},before$4=function(marker,element){parent(marker).each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},after$3=function(marker,element){nextSibling(marker).fold((function(){parent(marker).each((function(v){append$1(v,element)}))}),(function(v){before$4(v,element)}))},prepend=function(parent,element){firstChild(parent).fold((function(){append$1(parent,element)}),(function(v){parent.dom.insertBefore(element.dom,v.dom)}))},append$1=function(parent,element){parent.dom.appendChild(element.dom)},append=function(parent,elements){each$k(elements,(function(x){append$1(parent,x)}))},empty=function(element){element.dom.textContent="",each$k(children(element),(function(rogue){remove$7(rogue)}))},remove$7=function(element){var dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=function(wrapper){var marker,children$1=children(wrapper);children$1.length>0&&(marker=wrapper,each$k(children$1,(function(x){before$4(marker,x)}))),remove$7(wrapper)},inBody=function(element){var dom=isText$8(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var doc=dom.ownerDocument;return function(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none()}(SugarElement.fromDom(dom)).fold((function(){return doc.body.contains(dom)}),compose1(inBody,getShadowHost))},r=function(left,top){return{left:left,top:top,translate:function(x,y){return r(left+x,top+y)}}},SugarPosition=r,firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},viewport=function(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?function(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)}(dom):SugarPosition(0,0)},get$8=function(_DOC){var doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y)},to=function(x,y,_DOC){var win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollTo(x,y)},intoView=function(element,alignToTop){detect().browser.isSafari()&&isFunction(element.dom.scrollIntoViewIfNeeded)?element.dom.scrollIntoViewIfNeeded(!1):element.dom.scrollIntoView(alignToTop)},bounds=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},getBounds=function(_win){var win=void 0===_win?window:_win,doc=win.document,scroll=get$8(SugarElement.fromDom(doc));return function(_win){var win=void 0===_win?window:_win;return detect().browser.isFirefox()?Optional.none():Optional.from(win.visualViewport)}(win).fold((function(){var html=win.document.documentElement,width=html.clientWidth,height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height)}),(function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)}))},isNodeType=function(type){return function(node){return!!node&&node.nodeType===type}},isRestrictedNode=function(node){return!!node&&!Object.getPrototypeOf(node)},isElement$5=isNodeType(1),matchNodeNames=function(names){var lowercasedNames=names.map((function(s){return s.toLowerCase()}));return function(node){if(node&&node.nodeName){var nodeName=node.nodeName.toLowerCase();return contains$3(lowercasedNames,nodeName)}return!1}},matchStyleValues=function(name,values){var items=values.toLowerCase().split(" ");return function(node){if(isElement$5(node))for(var i=0;i<items.length;i++){var computed=node.ownerDocument.defaultView.getComputedStyle(node,null);if((computed?computed.getPropertyValue(name):null)===items[i])return!0}return!1}},hasAttribute=function(attrName){return function(node){return isElement$5(node)&&node.hasAttribute(attrName)}},isBogus$2=function(node){return isElement$5(node)&&node.hasAttribute("data-mce-bogus")},isTable$3=function(node){return isElement$5(node)&&"TABLE"===node.tagName},hasContentEditableState=function(value){return function(node){if(isElement$5(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}},isTextareaOrInput=matchNodeNames(["textarea","input"]),isText$7=isNodeType(3),isComment=isNodeType(8),isDocument$1=isNodeType(9),isDocumentFragment=isNodeType(11),isBr$5=matchNodeNames(["br"]),isImg=matchNodeNames(["img"]),isContentEditableTrue$4=hasContentEditableState("true"),isContentEditableFalse$b=hasContentEditableState("false"),isTableCell$5=matchNodeNames(["td","th"]),isMedia$2=matchNodeNames(["video","audio","object","embed"]),is$1=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists((function(left){return comparator(left,rhs)}))},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},isSupported=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},rawSet=function(dom,key,value){if(!(isString$1(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$1=function(element,key,value){rawSet(element.dom,key,value)},setAll$1=function(element,attrs){var dom=element.dom;each$j(attrs,(function(v,k){rawSet(dom,k,v)}))},get$6=function(element,key){var v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=function(element,key){return Optional.from(get$6(element,key))},remove$6=function(element,key){element.dom.removeAttribute(key)},setAll=function(element,css){var dom=element.dom;each$j(css,(function(v,k){!function(dom,property,value){if(!isString$1(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported(dom)&&dom.style.setProperty(property,value)}(dom,k,v)}))},get$5=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){var dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((function(r){return r.length>0}))},getAllRaw=function(element){var css={},dom=element.dom;if(isSupported(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css},browser$3=detect().browser,firstElement=function(nodes){return find$3(nodes,isElement$6)},hasChild=function(elm,child){return elm.children&&contains$3(elm.children,child)},getPos=function(body,elm,rootElm){var x=0,y=0,doc=body.ownerDocument;if(rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===get$5(SugarElement.fromDom(body),"position")){var pos=elm.getBoundingClientRect();return{x:x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft,y:y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop}}for(var offsetParent=elm;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);){var castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0,y+=castOffsetParent.offsetTop||0,offsetParent=castOffsetParent.offsetParent}for(offsetParent=elm.parentNode;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode;y+=function(elm){return browser$3.isFirefox()&&"table"===name(elm)?firstElement(children(elm)).filter((function(elm){return"caption"===name(elm)})).bind((function(caption){return firstElement(nextSiblings(caption)).map((function(body){var bodyTop=body.dom.offsetTop,captionTop=caption.dom.offsetTop,captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0}))})).getOr(0):0}(SugarElement.fromDom(elm))}return{x:x,y:y}},exports$1={},module$1={exports:exports$1};!function(define,exports,module,require){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).EphoxContactWrapper=factory()}(this,(function(){var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},promise={exports:{}};!function(module){!function(root){var setTimeoutFunc=setTimeout;function noop(){}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,Promise._immediateFn((function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)}))):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn((function(){self._handled||Promise._unhandledRejectionFn(self._value)}));for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn((function(value){done||(done=!0,resolve(self,value))}),(function(reason){done||(done=!0,reject(self,reason))}))}catch(ex){if(done)return;done=!0,reject(self,ex)}}Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise((function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])}))},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise((function(resolve){resolve(value)}))},Promise.reject=function(value){return new Promise((function(resolve,reject){reject(value)}))},Promise.race=function(values){return new Promise((function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)}))},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(commonjsGlobal)}(promise);var promisePolyfill=promise.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||promisePolyfill}}))}(void 0,exports$1,module$1);var Promise$1=module$1.exports.boltExport,nu$1=function(baseFn){var data=Optional.none(),callbacks=[],get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},isReady=function(){return data.isSome()},run=function(cbs){each$k(cbs,call)},call=function(cb){data.each((function(x){setTimeout((function(){cb(x)}),0)}))};return baseFn((function(x){isReady()||(data=Optional.some(x),run(callbacks),callbacks=[])})),{get:get,map:function(f){return nu$1((function(nCallback){get((function(data){nCallback(f(data))}))}))},isReady:isReady}},LazyValue={nu:nu$1,pure:function(a){return nu$1((function(callback){callback(a)}))}},errorReporter=function(err){setTimeout((function(){throw err}),0)},make=function(run){var get=function(callback){run().then(callback,errorReporter)};return{map:function(fab){return make((function(){return run().then(fab)}))},bind:function(aFutureB){return make((function(){return run().then((function(v){return aFutureB(v).toPromise()}))}))},anonBind:function(futureB){return make((function(){return run().then((function(){return futureB.toPromise()}))}))},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make((function(){return null===cache&&(cache=run()),cache}))},toPromise:run,get:get}},Future_nu=function(baseFn){return make((function(){return new Promise$1(baseFn)}))},par$1=function(asyncValues,nu){return nu((function(callback){var r=[],count=0;0===asyncValues.length?callback([]):each$k(asyncValues,(function(asyncValue,i){asyncValue.get(function(i){return function(value){r[i]=value,++count>=asyncValues.length&&callback(r)}}(i))}))}))},value$1=function(o){return{isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:function(_opt){return value$1(o)},orThunk:function(_f){return value$1(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$1(f(o))},mapError:function(_f){return value$1(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}},error=function(message){return{isValue:never,isError:always,getOr:identity,getOrThunk:function(f){return f()},getOrDie:function(){return(msg=String(message),function(){throw new Error(msg)})();var msg},or:identity,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error(message)},mapError:function(f){return error(f(message))},each:noop,bind:function(_f){return error(message)},exists:never,forall:always,toOptional:Optional.none}},Result={value:value$1,error:error,fromOption:function(opt,err){return opt.fold((function(){return error(err)}),value$1)}},Adt_generate=function(cases){if(!isArray$1(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$k(cases,(function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray$1(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);var match=function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(function(reqKey){return contains$3(branchKeys,reqKey)})))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)};return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);var target=foldArgs[count];return target.apply(null,args)},match:match,log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}})),adt};Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var unite=function(result){return result.fold(identity,identity)};function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}var requestAnimationFramePromise,attrName,attrValue,support,Expr,getText,isXML,tokenize,compile,select$1,outermostContext,sortInput,hasDuplicate,setDocument,document$1,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,contains,ancestor$3=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest$3=function(scope,predicate,isRoot){return ClosestOrAncestor((function(s,test){return test(s)}),ancestor$3,scope,predicate,isRoot)},child=function(scope,predicate){return find$3(scope.dom.childNodes,(function(node){return predicate(SugarElement.fromDom(node))})).map(SugarElement.fromDom)},ancestor$2=function(scope,selector,isRoot){return ancestor$3(scope,(function(e){return is$2(e,selector)}),isRoot)},descendant=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)}(selector,scope)},closest$2=function(scope,selector,isRoot){return ClosestOrAncestor((function(element,selector){return is$2(element,selector)}),ancestor$2,scope,selector,isRoot)},promiseObj=window.Promise?window.Promise:Promise$1,wrappedSetTimeout=function(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)},wrappedSetInterval=function(callback,time){return"number"!=typeof time&&(time=1),setInterval(callback,time)},debounce=function(callback,time){var timer,func=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];clearTimeout(timer),timer=wrappedSetTimeout((function(){callback.apply(this,args)}),time)};return func.stop=function(){clearTimeout(timer)},func},Delay={requestAnimationFrame:function(callback,element){requestAnimationFramePromise?requestAnimationFramePromise.then(callback):requestAnimationFramePromise=new promiseObj((function(resolve){element||(element=document.body),function(callback,element){for(var requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"],i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];requestAnimationFrameFunc||(requestAnimationFrameFunc=function(cb){window.setTimeout(cb,0)}),requestAnimationFrameFunc(callback,element)}(resolve,element)})).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout((function(){editor.removed||callback()}),time)},setEditorInterval:function(editor,callback,time){var timer=wrappedSetInterval((function(){editor.removed?clearInterval(timer):callback()}),time);return timer},debounce:debounce,throttle:debounce,clearInterval:function(id){return clearInterval(id)},clearTimeout:function(id){return clearTimeout(id)}},StyleSheetLoader=function(documentOrShadowRoot,settings){void 0===settings&&(settings={});var idCount=0,loadedStates={},edos=SugarElement.fromDom(documentOrShadowRoot),doc=documentOrOwner(edos),maxLoadTime=settings.maxLoadTime||5e3,load=function(url,success,failure){var link,urlWithSuffix=Tools._addCacheSuffix(url),state=function(url){return get$9(loadedStates,url).getOrThunk((function(){return{id:"mce-u"+idCount++,passed:[],failed:[],count:0}}))}(urlWithSuffix);loadedStates[urlWithSuffix]=state,state.count++;var resolve=function(callbacks,status){for(var i=callbacks.length;i--;)callbacks[i]();state.status=status,state.passed=[],state.failed=[],link&&(link.onload=null,link.onerror=null,link=null)},passed=function(){return resolve(state.passed,2)},failed=function(){return resolve(state.failed,3)},waitForWebKitLinkLoaded=function(){var waitCallback;waitCallback=waitForWebKitLinkLoaded,function(){for(var styleSheets=documentOrShadowRoot.styleSheets,i=styleSheets.length;i--;){var owner=styleSheets[i].ownerNode;if(owner&&owner.id===link.id)return passed(),!0}return!1}()||(Date.now()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())};if(success&&state.passed.push(success),failure&&state.failed.push(failure),1!==state.status)if(2!==state.status)if(3!==state.status){state.status=1;var linkElem=SugarElement.fromTag("link",doc.dom);setAll$1(linkElem,{rel:"stylesheet",type:"text/css",id:state.id});var element,startTime=Date.now();settings.contentCssCors&&set$1(linkElem,"crossOrigin","anonymous"),settings.referrerPolicy&&set$1(linkElem,"referrerpolicy",settings.referrerPolicy),(link=linkElem.dom).onload=waitForWebKitLinkLoaded,link.onerror=failed,element=linkElem,append$1(getStyleContainer(edos),element),set$1(linkElem,"href",urlWithSuffix)}else failed();else passed()},loadF=function(url){return Future_nu((function(resolve){load(url,compose(resolve,constant(Result.value(url))),compose(resolve,constant(Result.error(url))))}))},unload=function(url){var urlWithSuffix=Tools._addCacheSuffix(url);get$9(loadedStates,urlWithSuffix).each((function(state){var id,styleContainer;0===--state.count&&(delete loadedStates[urlWithSuffix],id=state.id,styleContainer=getStyleContainer(edos),descendant(styleContainer,"#"+id).each(remove$7))}))};return{load:load,loadAll:function(urls,success,failure){var futures;(futures=map$3(urls,loadF),par$1(futures,Future_nu)).get((function(result){var parts=partition(result,(function(r){return r.isValue()}));parts.fail.length>0?failure(parts.fail.map(unite)):success(parts.pass.map(unite))}))},unload:unload,unloadAll:function(urls){each$k(urls,(function(url){unload(url)}))},_setReferrerPolicy:function(referrerPolicy){settings.referrerPolicy=referrerPolicy}}},instance=function(){var map=new WeakMap;return{forElement:function(referenceElement,settings){var rootDom=getRootNode(referenceElement).dom;return Optional.from(map.get(rootDom)).getOrThunk((function(){var sl=StyleSheetLoader(rootDom,settings);return map.set(rootDom,sl),sl}))}}}(),DomTreeWalker=function(){function DomTreeWalker(startNode,rootNode){this.node=startNode,this.rootNode=rootNode,this.current=this.current.bind(this),this.next=this.next.bind(this),this.prev=this.prev.bind(this),this.prev2=this.prev2.bind(this)}return DomTreeWalker.prototype.current=function(){return this.node},DomTreeWalker.prototype.next=function(shallow){return this.node=this.findSibling(this.node,"firstChild","nextSibling",shallow),this.node},DomTreeWalker.prototype.prev=function(shallow){return this.node=this.findSibling(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.prev2=function(shallow){return this.node=this.findPreviousNode(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.findSibling=function(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!==this.rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}},DomTreeWalker.prototype.findPreviousNode=function(node,startName,siblingName,shallow){var sibling,parent,child;if(node){if(sibling=node[siblingName],this.rootNode&&sibling===this.rootNode)return;if(sibling){if(!shallow)for(child=sibling[startName];child;child=child[startName])if(!child[startName])return child;return sibling}if((parent=node.parentNode)&&parent!==this.rootNode)return parent}},DomTreeWalker}(),lazyLookup=function(items){var lookup;return function(node){return lookup=lookup||function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r}(items,always),has$2(lookup,name(node))}},isHeading=lazyLookup(["h1","h2","h3","h4","h5","h6"]),isBlock$2=lazyLookup(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]),isInline$1=function(node){return isElement$6(node)&&!isBlock$2(node)},isBr$4=function(node){return isElement$6(node)&&"br"===name(node)},isTextBlock$2=lazyLookup(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),isList=lazyLookup(["ul","ol","dl"]),isListItem=lazyLookup(["li","dd","dt"]),isTableSection=lazyLookup(["thead","tbody","tfoot"]),isTableCell$4=lazyLookup(["td","th"]),isWsPreserveElement=lazyLookup(["pre","script","textarea","style"]),isZwsp=function(char){return"\ufeff"===char},trim$2=function(s){return s.replace(/\uFEFF/g,"")},isElement$4=isElement$5,isText$6=isText$7,isCaretContainerBlock$1=function(node){return isText$6(node)&&(node=node.parentNode),isElement$4(node)&&node.hasAttribute("data-mce-caret")},isCaretContainerInline=function(node){return isText$6(node)&&isZwsp(node.data)},isCaretContainer$2=function(node){return isCaretContainerBlock$1(node)||isCaretContainerInline(node)},hasContent=function(node){return node.firstChild!==node.lastChild||!isBr$5(node.firstChild)},isBeforeInline=function(pos){var container=pos.container();return!!isText$7(container)&&("\ufeff"===container.data.charAt(pos.offset())||pos.isAtStart()&&isCaretContainerInline(container.previousSibling))},isAfterInline=function(pos){var container=pos.container();return!!isText$7(container)&&("\ufeff"===container.data.charAt(pos.offset()-1)||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling))},insertBlock$1=function(blockName,node,before){var br,blockNode=node.ownerDocument.createElement(blockName);blockNode.setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(((br=document.createElement("br")).setAttribute("data-mce-bogus","1"),br));var parentNode=node.parentNode;return before?parentNode.insertBefore(blockNode,node):node.nextSibling?parentNode.insertBefore(blockNode,node.nextSibling):parentNode.appendChild(blockNode),blockNode},startsWithCaretContainer$1=function(node){return isText$6(node)&&"\ufeff"===node.data[0]},endsWithCaretContainer$1=function(node){return isText$6(node)&&"\ufeff"===node.data[node.data.length-1]},showCaretContainerBlock=function(caretContainer){return caretContainer&&caretContainer.hasAttribute("data-mce-caret")?(brs=caretContainer.getElementsByTagName("br"),lastBr=brs[brs.length-1],isBogus$2(lastBr)&&lastBr.parentNode.removeChild(lastBr),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null;var brs,lastBr},isRangeInCaretContainerBlock=function(range){return isCaretContainerBlock$1(range.startContainer)},isContentEditableTrue$3=isContentEditableTrue$4,isContentEditableFalse$a=isContentEditableFalse$b,isBr$3=isBr$5,isText$5=isText$7,isInvalidTextElement=matchNodeNames(["script","style","textarea"]),isAtomicInline=matchNodeNames(["img","input","textarea","hr","iframe","video","audio","object","embed"]),isTable$1=matchNodeNames(["table"]),isCaretContainer$1=isCaretContainer$2,isCaretCandidate$3=function(node){return!isCaretContainer$1(node)&&(isText$5(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr$3(node)||isTable$1(node)||isNonUiContentEditableFalse(node))},isNonUiContentEditableFalse=function(node){return!1===function(node){return isElement$5(node)&&"true"===node.getAttribute("unselectable")}(node)&&isContentEditableFalse$a(node)},isEditableCaretCandidate$1=function(node,root){return isCaretCandidate$3(node)&&function(node,root){for(node=node.parentNode;node&&node!==root;node=node.parentNode){if(isNonUiContentEditableFalse(node))return!1;if(isContentEditableTrue$3(node))return!0}return!0}(node,root)},whiteSpaceRegExp$1=/^[ \t\r\n]*$/,isWhitespaceText=function(text){return whiteSpaceRegExp$1.test(text)},hasWhitespacePreserveParent=function(node,rootNode){var scope,selector,isRoot,rootElement=SugarElement.fromDom(rootNode),startNode=SugarElement.fromDom(node);return scope=startNode,selector="pre,code",isRoot=curry(eq,rootElement),ancestor$2(scope,selector,isRoot).isSome()},isContent$1=function(node,rootNode){return isCaretCandidate$3(node)&&!1===function(node,rootNode){return isText$7(node)&&isWhitespaceText(node.data)&&!1===hasWhitespacePreserveParent(node,rootNode)}(node,rootNode)||function(node){return isElement$5(node)&&"A"===node.nodeName&&!node.hasAttribute("href")&&(node.hasAttribute("name")||node.hasAttribute("id"))}(node)||isBookmark(node)},isBookmark=hasAttribute("data-mce-bookmark"),isBogus$1=hasAttribute("data-mce-bogus"),isBogusAll=(attrName="data-mce-bogus",attrValue="all",function(node){return isElement$5(node)&&node.getAttribute(attrName)===attrValue}),isEmpty$2=function(elm,skipBogus){return void 0===skipBogus&&(skipBogus=!0),function(targetNode,skipBogus){var brCount=0;if(isContent$1(targetNode,targetNode))return!1;var node=targetNode.firstChild;if(!node)return!0;var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(!0);continue}if(isBogus$1(node)){node=walker.next();continue}}if(isBr$5(node))brCount++,node=walker.next();else{if(isContent$1(node,targetNode))return!1;node=walker.next()}}while(node);return brCount<=1}(elm.dom,skipBogus)},isInlineContent=function(node,root){return isNonNullable(node)&&(isContent$1(node,root)||isInline$1(SugarElement.fromDom(node)))},isBookmarkNode$2=function(node){return function(node){return"span"===node.nodeName.toLowerCase()}(node)&&"bookmark"===node.getAttribute("data-mce-type")},isKeepTextNode=function(node,root){return isText$7(node)&&node.data.length>0&&function(node,root){var prev=new DomTreeWalker(node,root).prev(!1),next=new DomTreeWalker(node,root).next(!1),prevIsInline=isUndefined(prev)||isInlineContent(prev,root),nextIsInline=isUndefined(next)||isInlineContent(next,root);return prevIsInline&&nextIsInline}(node,root)},trimNode=function(dom,node,root){var rootNode=root||node;if(isElement$5(node)&&isBookmarkNode$2(node))return node;for(var children=node.childNodes,i=children.length-1;i>=0;i--)trimNode(dom,children[i],rootNode);if(isElement$5(node)){var currentChildren=node.childNodes;1===currentChildren.length&&isBookmarkNode$2(currentChildren[0])&&node.parentNode.insertBefore(currentChildren[0],node)}return function(node){return isDocumentFragment(node)||isDocument$1(node)}(node)||isContent$1(node,rootNode)||function(node){return!!isElement$5(node)&&node.childNodes.length>0}(node)||isKeepTextNode(node,rootNode)||dom.remove(node),node},makeMap$3=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"â¬",130:"â",131:"Æ",132:"â",133:"â¦",134:"â ",135:"â¡",136:"Ë",137:"â°",138:"Å ",139:"â¹",140:"Å",142:"Å½",145:"â",146:"â",147:"â",148:"â",149:"â¢",150:"â",151:"â",152:"Ë",153:"â¢",154:"Å¡",155:"âº",156:"Å",158:"Å¾",159:"Å¸"},baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},buildEntitiesLookup=function(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),encodeRaw=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return baseEntities[chr]||chr}))},encodeNumeric=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"}))},encodeNamed=function(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return baseEntities[chr]||entities[chr]||chr}))},Entities={encodeRaw:encodeRaw,encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,(function(chr){return baseEntities[chr]||chr}))},encodeNumeric:encodeNumeric,encodeNamed:encodeNamed,getEncodeFunc:function(name,entities){var entitiesMap=buildEntitiesLookup(entities)||namedEntities,nameMap=makeMap$3(name.replace(/\+/g,","));return nameMap.named&&nameMap.numeric?function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return void 0!==baseEntities[chr]?baseEntities[chr]:void 0!==entitiesMap[chr]?entitiesMap[chr]:chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";"}))}:nameMap.named?entities?function(text,attr){return encodeNamed(text,attr,entitiesMap)}:encodeNamed:nameMap.numeric?encodeNumeric:encodeRaw},decode:function(text){return text.replace(entityRegExp,(function(all,numeric){return numeric?(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))>65535?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||function(text){var elm=SugarElement.fromTag("div").dom;return elm.innerHTML=text,elm.textContent||elm.innerText||text}(all)}))}},mapCache={},dummyObj={},makeMap$2=Tools.makeMap,each$h=Tools.each,extend$5=Tools.extend,explode$3=Tools.explode,inArray$2=Tools.inArray,split$1=function(items,delim){return(items=Tools.trim(items))?items.split(delim||" "):[]},compileElementMap=function(value,mode){var styles;return value&&(styles={},"string"==typeof value&&(value={"*":value}),each$h(value,(function(value,key){styles[key]=styles[key.toUpperCase()]="map"===mode?makeMap$2(value,/[, ]/):explode$3(value,/[, ]/)}))),styles},Schema=function(settings){var elements={},children={},patternElements=[],customElementsMap={},specialElements={},createLookupTable=function(option,defaultValue,extendWith){var value=settings[option];return value?value=makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/)):(value=mapCache[option])||(value=makeMap$2(defaultValue," ",makeMap$2(defaultValue.toUpperCase()," ")),value=extend$5(value,extendWith),mapCache[option]=value),value},schemaItems=function(type){var globalAttributes,blockContent,phrasingContent,flowContent,html4BlockContent,html4PhrasingContent,schema={},add=function(name,attributes,children){var ni,attributesOrder,element,arrayToMap=function(array,obj){var i,l,map={};for(i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map};attributes=attributes||"","string"==typeof(children=children||[])&&(children=split$1(children));var names=split$1(name);for(ni=names.length;ni--;)element={attributes:arrayToMap(attributesOrder=split$1([globalAttributes,attributes].join(" "))),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)},schema[names[ni]]=element},addAttrs=function(name,attributes){var ni,schemaItem,i,l,names=split$1(name);ni=names.length;for(var attrs=split$1(attributes);ni--;)for(schemaItem=schema[names[ni]],i=0,l=attrs.length;i<l;i++)schemaItem.attributes[attrs[i]]={},schemaItem.attributesOrder.push(attrs[i])};return mapCache[type]?mapCache[type]:(globalAttributes="id accesskey class dir lang style tabindex title role",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure main header footer hgroup section nav",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!==type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,html4PhrasingContent="acronym applet basefont big font strike tt"].join(" "),each$h(split$1(html4PhrasingContent),(function(name){add(name,"",phrasingContent)})),blockContent=[blockContent,html4BlockContent="center dir isindex noframes"].join(" "),flowContent=[blockContent,phrasingContent].join(" "),each$h(split$1(html4BlockContent),(function(name){add(name,"",flowContent)}))),flowContent=flowContent||[blockContent,phrasingContent].join(" "),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"===type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!==type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside main header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!==type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!==type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("img","loading"),addAttrs("iframe","sandbox seamless allowfullscreen loading")),each$h(split$1("a form meter progress dfn"),(function(name){schema[name]&&delete schema[name].children[name]})),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema,schema)}((settings=settings||{}).schema);!1===settings.verify_html&&(settings.valid_elements="*[*]");var validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script code pre",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","td th iframe video audio object script code table",shortEndedElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside main nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption details summary",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp");each$h((settings.special||"script noscript iframe noframes noembed title style textarea xmp").split(" "),(function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}));var patternToRegExp=function(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")},addValidElements=function(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)])?$/,attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){var validElementsArr=split$1(validElements,",");for(elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElementsArr.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElementsArr[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],element={attributes:attributes={},attributesOrder:attributesOrder=[]},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes&&(each$j(globalAttributes,(function(value,key){attributes[key]=value})),attributesOrder.push.apply(attributesOrder,globalAttributesOrder)),attrData)for(ai=0,al=(attrData=split$1(attrData,"|")).length;ai<al;ai++)if(matches=attrRuleRegExp.exec(attrData[ai])){if(attr={},attrType=matches[1],attrName=matches[2].replace(/[\\:]:/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType){delete attributes[attrName],attributesOrder.splice(inArray$2(attributesOrder,attrName),1);continue}prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value:value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value:value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap$2(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)}globalAttributes||"@"!==elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}},setValidElements=function(validElements){elements={},patternElements=[],addValidElements(validElements),each$h(schemaItems,(function(element,name){children[name]=element.children}))},addCustomElements=function(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each$h(split$1(customElements,","),(function(rule){var matches=customElementRegExp.exec(rule),inline="~"===matches[1],cloneName=inline?"span":"div",name=matches[2];if(children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){var customRule=elements[cloneName];delete(customRule=extend$5({},customRule)).removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each$h(children,(function(element,elmName){element[cloneName]&&(children[elmName]=element=extend$5({},children[elmName]),element[name]=element[cloneName])}))})))},addValidChildren=function(validChildren){var childRuleRegExp=/^([+\-]?)([A-Za-z0-9_\-.\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]+)\[([^\]]+)]$/;mapCache[settings.schema]=null,validChildren&&each$h(split$1(validChildren,","),(function(rule){var parent,prefix,matches=childRuleRegExp.exec(rule);matches&&(prefix=matches[1],parent=prefix?children[matches[2]]:children[matches[2]]={"#comment":{}},parent=children[matches[2]],each$h(split$1(matches[3],"|"),(function(child){"-"===prefix?delete parent[child]:parent[child]={}})))}))},getElementRule=function(name){var i,element=elements[name];if(element)return element;for(i=patternElements.length;i--;)if((element=patternElements[i]).pattern.test(name))return element};settings.valid_elements?setValidElements(settings.valid_elements):(each$h(schemaItems,(function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children})),"html5"!==settings.schema&&each$h(split$1("strong/b em/i"),(function(item){var items=split$1(item,"/");elements[items[1]].outputName=items[0]})),each$h(split$1("ol ul sub sup blockquote span font a table tbody strong em b i"),(function(name){elements[name]&&(elements[name].removeEmpty=!0)})),each$h(split$1("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),(function(name){elements[name].paddEmpty=!0})),each$h(split$1("span"),(function(name){elements[name].removeEmptyAttrs=!0}))),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each$h({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},(function(parents,item){elements[item]&&(elements[item].parentsRequired=split$1(parents))})),settings.invalid_elements&&each$h(explode$3(settings.invalid_elements),(function(item){elements[item]&&delete elements[item]})),getElementRule("span")||addValidElements("span[!data-mce-type|*]");var getValidStyles=constant(validStyles),getInvalidStyles=constant(invalidStyles),getValidClasses=constant(validClasses),getBoolAttrs=constant(boolAttrMap),getBlockElements=constant(blockElementsMap),getTextBlockElements=constant(textBlockElementsMap),getTextInlineElements=constant(textInlineElementsMap),getShortEndedElements=constant(shortEndedElementsMap),getSelfClosingElements=constant(selfClosingElementsMap),getNonEmptyElements=constant(nonEmptyElementsMap),getMoveCaretBeforeOnEnterElements=constant(moveCaretBeforeOnEnterElementsMap),getWhiteSpaceElements=constant(whiteSpaceElementsMap),getSpecialElements=constant(specialElements),getCustomElements=constant(customElementsMap);return{children:children,elements:elements,getValidStyles:getValidStyles,getValidClasses:getValidClasses,getBlockElements:getBlockElements,getInvalidStyles:getInvalidStyles,getShortEndedElements:getShortEndedElements,getTextBlockElements:getTextBlockElements,getTextInlineElements:getTextInlineElements,getBoolAttrs:getBoolAttrs,getElementRule:getElementRule,getSelfClosingElements:getSelfClosingElements,getNonEmptyElements:getNonEmptyElements,getMoveCaretBeforeOnEnterElements:getMoveCaretBeforeOnEnterElements,getWhiteSpaceElements:getWhiteSpaceElements,getSpecialElements:getSpecialElements,isValidChild:function(name,child){var parent=children[name.toLowerCase()];return!(!parent||!parent[child.toLowerCase()])},isValid:function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},getCustomElements:getCustomElements,addValidElements:addValidElements,setValidElements:setValidElements,addCustomElements:addCustomElements,addValidChildren:addValidChildren}},toHex=function(match,r,g,b){var hex=function(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val};return"#"+hex(r)+hex(g)+hex(b)},Styles=function(settings,schema){var i,validStyles,invalidStyles,_this=this,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={};settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles());var encodingItems="\\\" \\' \\; \\: ; : \ufeff".split(" ");for(i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]="\ufeff"+i,encodingLookup["\ufeff"+i]=encodingItems[i];return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){var matches,name,value,isEncoded,target,a,b,c,styles={},urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||_this,compress=function(prefix,suffix,noJoin){var top=styles[prefix+"-top"+suffix];if(top){var right=styles[prefix+"-right"+suffix];if(right){var bottom=styles[prefix+"-bottom"+suffix];if(bottom){var left=styles[prefix+"-left"+suffix];if(left){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);i>-1&&noJoin||(styles[prefix+suffix]=-1===i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}}}},canCompress=function(key){var i,value=styles[key];if(value){for(i=(value=value.split(" ")).length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}},encode=function(str){return isEncoded=!0,encodingLookup[str]},decode=function(str,keepSlashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,(function(str){return encodingLookup[str]}))),keepSlashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str},decodeSingleHexSequence=function(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16))},decodeHexSequences=function(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence)},processUrl=function(match,url,url2,url3,str,str2){if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"};if(css){for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,(function(str){return str.replace(/[;:]/g,encode)}));matches=styleRegExp.exec(css);)if(styleRegExp.lastIndex=matches.index+matches[0].length,name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,""),name&&value){if(name=decodeHexSequences(name),value=decodeHexSequences(value),-1!==name.indexOf("\ufeff")||-1!==name.indexOf('"'))continue;if(!settings.allow_script_urls&&("behavior"===name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),value=(value=value.replace(rgbRegExp,toHex)).replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(value,!0):value}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),target="border",b="border-style",c="border-color",canCompress(a="border-width")&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c]),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){var css="",serializeStyles=function(name){var value,styleList=validStyles[name];if(styleList)for(var i_1=0,l=styleList.length;i_1<l;i_1++)name=styleList[i_1],(value=styles[name])&&(css+=(css.length>0?" ":"")+name+": "+value+";")};return elementName&&validStyles?(serializeStyles("*"),serializeStyles(elementName)):each$j(styles,(function(value,name){!value||invalidStyles&&!function(name,elementName){var styleMap=invalidStyles["*"];return!(styleMap&&styleMap[name]||(styleMap=invalidStyles[elementName])&&styleMap[name])}(name,elementName)||(css+=(css.length>0?" ":"")+name+": "+value+";")})),css}}},deprecated={keyLocation:!0,layerX:!0,layerY:!0,returnValue:!0,webkitMovementX:!0,webkitMovementY:!0,keyIdentifier:!0,mozPressure:!0},isNativeEvent=function(event){return event instanceof Event||isFunction(event.initEvent)},normalize$3=function(type,originalEvent,fallbackTarget,data){var _a,event=function(originalEvent,data){var event=null!=data?data:{};for(var name_1 in originalEvent)has$2(deprecated,name_1)||(event[name_1]=originalEvent[name_1]);return isNonNullable(event.composedPath)&&(event.composedPath=function(){return originalEvent.composedPath()}),event}(originalEvent,data);return event.type=type,isNullable(event.target)&&(event.target=null!==(_a=event.srcElement)&&void 0!==_a?_a:fallbackTarget),function(event){return isNullable(event.preventDefault)||isNativeEvent(event)}(originalEvent)&&(event.preventDefault=function(){event.defaultPrevented=!0,event.isDefaultPrevented=always,isFunction(originalEvent.preventDefault)?originalEvent.preventDefault():isNativeEvent(originalEvent)&&(originalEvent.returnValue=!1)},event.stopPropagation=function(){event.cancelBubble=!0,event.isPropagationStopped=always,isFunction(originalEvent.stopPropagation)?originalEvent.stopPropagation():isNativeEvent(originalEvent)&&(originalEvent.cancelBubble=!0)},event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=always,event.stopPropagation()},function(event){return event.isDefaultPrevented===always||event.isDefaultPrevented===never}(event)||(event.isDefaultPrevented=!0===event.defaultPrevented?always:never,event.isPropagationStopped=!0===event.cancelBubble?always:never,event.isImmediatePropagationStopped=never)),event},mouseEventRe=/^(?:mouse|contextmenu)|click/,addEvent=function(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)},removeEvent=function(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)},fix=function(originalEvent,data){var event=normalize$3(originalEvent.type,originalEvent,document,data);if(function(event){return isNonNullable(event)&&mouseEventRe.test(event.type)}(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)){var eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,mouseEvent=event;mouseEvent.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return isUndefined(event.metaKey)&&(event.metaKey=!1),event},bindOnReady=function(win,callback,eventUtils){var doc=win.document,event={type:"ready"};if(eventUtils.domLoaded)callback(event);else{var readyHandler=function(){removeEvent(win,"DOMContentLoaded",readyHandler),removeEvent(win,"load",readyHandler),eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event)),win=null};"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),eventUtils.domLoaded||addEvent(win,"load",readyHandler)}},EventUtils=function(){function EventUtils(){this.domLoaded=!1,this.events={},this.count=1,this.expando="mce-data-"+(+new Date).toString(32),this.hasMouseEnterLeave="onmouseenter"in document.documentElement,this.hasFocusIn="onfocusin"in document.documentElement,this.count=1}return EventUtils.prototype.bind=function(target,names,callback,scope){var id,callbackList,i,name,fakeName,nativeHandler,capture,self=this,win=window,defaultNativeHandler=function(evt){self.executeHandlers(fix(evt||win.event),id)};if(target&&3!==target.nodeType&&8!==target.nodeType){target[self.expando]?id=target[self.expando]:(id=self.count++,target[self.expando]=id,self.events[id]={}),scope=scope||target;var namesList=names.split(" ");for(i=namesList.length;i--;)nativeHandler=defaultNativeHandler,fakeName=capture=!1,"DOMContentLoaded"===(name=namesList[i])&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"===target.readyState?callback.call(scope,fix({type:name})):(self.hasMouseEnterLeave||(fakeName=self.mouseEnterLeave[name])&&(nativeHandler=function(evt){var current=evt.currentTarget,related=evt.relatedTarget;if(related&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||((evt=fix(evt||win.event)).type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,self.executeHandlers(evt,id))}),self.hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){(evt=fix(evt||win.event)).type="focus"===evt.type?"focusin":"focusout",self.executeHandlers(evt,id)}),(callbackList=self.events[id][name])?"ready"===name&&self.domLoaded?callback(fix({type:name})):callbackList.push({func:callback,scope:scope}):(self.events[id][name]=callbackList=[{func:callback,scope:scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=null,callback}},EventUtils.prototype.unbind=function(target,names,callback){var callbackList,i,ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return this;var id=target[this.expando];if(id){if(eventMap=this.events[id],names){var namesList=names.split(" ");for(i=namesList.length;i--;)if(callbackList=eventMap[name=namesList[i]]){if(callback)for(ci=callbackList.length;ci--;)if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture;(callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1))).nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else each$j(eventMap,(function(callbackList,name){removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)})),eventMap={};for(name in eventMap)if(has$2(eventMap,name))return this;delete this.events[id];try{delete target[this.expando]}catch(ex){target[this.expando]=null}}return this},EventUtils.prototype.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return this;var event=fix({type:name,target:target},args);do{(id=target[this.expando])&&this.executeHandlers(event,id),target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow}while(target&&!event.isPropagationStopped());return this},EventUtils.prototype.clean=function(target){var i,children;if(!target||3===target.nodeType||8===target.nodeType)return this;if(target[this.expando]&&this.unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName)for(this.unbind(target),i=(children=target.getElementsByTagName("*")).length;i--;)(target=children[i])[this.expando]&&this.unbind(target);return this},EventUtils.prototype.destroy=function(){this.events={}},EventUtils.prototype.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1},EventUtils.prototype.executeHandlers=function(evt,id){var container=this.events[id],callbackList=container&&container[evt.type];if(callbackList)for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}},EventUtils.Event=new EventUtils,EventUtils}(),expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push$1=arr.push,slice$1=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\[[\\x20\\t\\r\\n\\f]*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),rcomma=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),rcombinators=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),rattributeQuotes=new RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*?)[\\x20\\t\\r\\n\\f]*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr$1=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push$1.apply(arr=slice$1.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push$1={apply:arr.length?function(target,els){push_native.apply(target,slice$1.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}var Sizzle=function(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document$1&&setDocument(context),results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=(context=context||document$1).nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr$1.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push$1.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push$1.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push$1.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select$1(selector.replace(rtrim,"$1"),context,results,seed)};function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||-2147483648)-(~a.sourceIndex||-2147483648);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createPositionalPseudo(fn){return markFunction((function(argument){return argument=+argument,markFunction((function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))}))}))}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if((oldCache=(outerCache=elem[expando]||(elem[expando]={}))[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction((function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push$1.apply(results,matcherOut)}))}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator((function(elem){return elem===checkContext}),implicitRelative,!0),matchAnyContext=addCombinator((function(elem){return indexOf.call(checkContext,elem)>-1}),implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document$1&&9===doc.nodeType&&doc.documentElement?(document$1=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==function getTop(win){try{return win.top}catch(ex){}return null}(parent)&&(parent.addEventListener?parent.addEventListener("unload",(function(){setDocument()}),!1):parent.attachEvent&&parent.attachEvent("onunload",(function(){setDocument()}))),support.attributes=!0,support.getElementsByTagName=!0,support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=!0,Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(void 0!==context.getElementsByTagName)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],support.disconnectedMatch=!0,rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document$1},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document$1&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=undefined.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document$1,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document$1&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document$1&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+className+"("+whitespace+"|$)"))&&classCache(className,(function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")}))},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction((function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf.call(seed,matched[i])]=!(matches[idx]=matched[i])})):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction((function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction((function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))})):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}})),has:markFunction((function(selector){return function(elem){return Sizzle(selector,elem).length>0}})),contains:markFunction((function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}})),lang:markFunction((function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}})),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document$1.activeElement&&(!document$1.hasFocus||document$1.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo((function(){return[0]})),last:createPositionalPseudo((function(matchIndexes,length){return[length-1]})),eq:createPositionalPseudo((function(matchIndexes,length,argument){return[argument<0?argument+length:argument]})),even:createPositionalPseudo((function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),odd:createPositionalPseudo((function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),lt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes})),gt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes}))}}).pseudos.nth=Expr.pseudos.eq,each$k(["radio","checkbox","file","password","image"],(function(i){Expr.pseudos[i]=function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}(i)})),each$k(["submit","reset"],(function(i){Expr.pseudos[i]=function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}(i)})),setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)Expr.filter.hasOwnProperty(type)&&(!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length)));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document$1&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push$1.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select$1=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push$1.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=!0;var doc=document,push=Array.prototype.push,slice=Array.prototype.slice,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event$1=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev"),isDefined=function(obj){return void 0!==obj},isString=function(obj){return"string"==typeof obj},createFragment$1=function(html,fragDoc){var node,container=(fragDoc=fragDoc||doc).createElement("div"),frag=fragDoc.createDocumentFragment();for(container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag},domManipulate=function(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem))sourceItem=createFragment$1(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;i>=0;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes},hasClass=function(node,className){return node&&className&&-1!==(" "+node.className+" ").indexOf(" "+className+" ")},wrap$2=function(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each((function(){all&&lastParent===this.parentNode||(lastParent=this.parentNode,newWrapper=wrapper.cloneNode(!1),this.parentNode.insertBefore(newWrapper,this)),newWrapper.appendChild(this)})),elements},numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={for:"htmlFor",class:"className",readonly:"readOnly"},cssFix={float:"cssFloat"},attrHooks={},cssHooks={},DomQueryConstructor=function(selector,context){return new DomQuery.fn.init(selector,context)},whiteSpaceRegExp=/^\s*|\s*$/g,trim$1=function(str){return null==str?"":(""+str).replace(whiteSpaceRegExp,"")},each$g=function(obj,callback){var length,key,i,value;if(obj)if(void 0===(length=obj.length)){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],!1===callback.call(value,key,value)))break}else for(i=0;i<length&&(value=obj[i],!1!==callback.call(value,i,value));i++);return obj},grep$2=function(array,callback){var out=[];return each$g(array,(function(i,item){callback(item,i)&&out.push(item)})),out},getElementDocument=function(element){return element?9===element.nodeType?element:element.ownerDocument:doc};DomQueryConstructor.fn=DomQueryConstructor.prototype={constructor:DomQueryConstructor,selector:"",context:null,length:0,init:function(selector,context){var match,node;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(context&&context.nodeType)this.context=context;else{if(context)return DomQuery(selector).attr(context);this.context=context=document}if(isString(selector)){if(this.selector=selector,!(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector)))return DomQuery(context).find(selector);if(match[1])for(node=createFragment$1(selector,getElementDocument(context)).firstChild;node;)push.call(this,node),node=node.nextSibling;else{if(!(node=getElementDocument(context).getElementById(match[2])))return this;if(node.id!==match[2])return this.find(selector);this.length=1,this[0]=node}}else this.add(selector,!1);return this},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var nodes,i;if(isString(items))return this.add(DomQuery(items));if(!1!==sort)for(nodes=DomQuery.unique(this.toArray().concat(DomQuery.makeArray(items))),this.length=nodes.length,i=0;i<nodes.length;i++)this[i]=nodes[i];else push.apply(this,DomQuery.makeArray(items));return this},attr:function(name,value){var hook,self=this;if("object"==typeof name)each$g(name,(function(name,value){self.attr(name,value)}));else{if(!isDefined(value)){if(self[0]&&1===self[0].nodeType){if((hook=attrHooks[name])&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:void 0;null===(value=self[0].getAttribute(name,2))&&(value=void 0)}return value}this.each((function(){var hook;if(1===this.nodeType){if((hook=attrHooks[name])&&hook.set)return void hook.set(this,value);null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2)}}))}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if("object"==typeof(name=propFix[name]||name))each$g(name,(function(name,value){self.prop(name,value)}));else{if(!isDefined(value))return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each((function(){1===this.nodeType&&(this[name]=value)}))}return self},css:function(name,value){var elm,hook,self=this,camel=function(name){return name.replace(/-(\D)/g,(function(a,b){return b.toUpperCase()}))},dashed=function(name){return name.replace(/[A-Z]/g,(function(a){return"-"+a}))};if("object"==typeof name)each$g(name,(function(name,value){self.css(name,value)}));else if(isDefined(value))name=camel(name),"number"!=typeof value||numericCssMap[name]||(value=value.toString()+"px"),self.each((function(){var style=this.style;if((hook=cssHooks[name])&&hook.set)hook.set(this,value);else{try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))}}));else{if(elm=self[0],(hook=cssHooks[name])&&hook.get)return hook.get(elm);if(!elm.ownerDocument.defaultView)return elm.currentStyle?elm.currentStyle[camel(name)]:"";try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return}}return self},remove:function(){for(var node,i=this.length;i--;)node=this[i],Event$1.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var node,i=this.length;i--;)for(node=this[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var i;if(isDefined(value)){i=this.length;try{for(;i--;)this[i].innerHTML=value}catch(ex){DomQuery(this[i]).empty().append(value)}return this}return this[0]?this[0].innerHTML:""},text:function(value){var i;if(isDefined(value)){for(i=this.length;i--;)"innerText"in this[i]?this[i].innerText=value:this[0].textContent=value;return this}return this[0]?this[0].innerText||this[0].textContent:""},append:function(){return domManipulate(this,arguments,(function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)}))},prepend:function(){return domManipulate(this,arguments,(function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)}),!0)},before:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,(function(node){this.parentNode.insertBefore(node,this)})):self},after:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,(function(node){this.parentNode.insertBefore(node,this.nextSibling)}),!0):self},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap$2(this,content)},wrapAll:function(content){return wrap$2(this,content,!0)},wrapInner:function(content){return this.each((function(){DomQuery(this).contents().wrapAll(content)})),this},unwrap:function(){return this.parent().each((function(){DomQuery(this).replaceWith(this.childNodes)}))},clone:function(){var result=[];return this.each((function(){result.push(this.cloneNode(!0))})),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className||(-1!==className.indexOf(" ")?each$g(className.split(" "),(function(){self.toggleClass(this,state)})):self.each((function(index,node){var classState=hasClass(node,className);if(classState!==state){var existingClassName=node.className;classState?node.className=trim$1((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className}}))),self},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each$g(this,callback)},on:function(name,callback){return this.each((function(){Event$1.bind(this,name,callback)}))},off:function(name,callback){return this.each((function(){Event$1.unbind(this,name,callback)}))},trigger:function(name){return this.each((function(){"object"==typeof name?Event$1.fire(this,name.type,name):Event$1.fire(this,name)}))},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return DomQuery(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep$2(this.toArray(),(function(item,i){return selector(i,item)})):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each((function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node===selector){result.push(node);break}node=node.parentNode}})),DomQuery(result)},offset:function(offset){var elm,doc,docElm,pos,x=0,y=0;return offset?this.css(offset):((elm=this[0])&&(docElm=(doc=elm.ownerDocument).documentElement,elm.getBoundingClientRect&&(x=(pos=elm.getBoundingClientRect()).left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push:push,sort:Array.prototype.sort,splice:Array.prototype.splice},Tools.extend(DomQueryConstructor,{extend:Tools.extend,makeArray:function(object){return(obj=object)&&obj===obj.window||object.nodeType?[object]:Tools.toArray(object);var obj},inArray:function(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1},isArray:Tools.isArray,each:each$g,trim:trim$1,grep:grep$2,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!==elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}});var dir=function(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(void 0!==until){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched},sibling$1=function(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(void 0!==until){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result},firstSibling=function(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType===nodeType)return node;return null};each$g({parent:function(node){var parent=node.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling$1(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},(function(name,fn){DomQueryConstructor.fn[name]=function(selector){var result=[];this.each((function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))})),this.length>1&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse()));var wrappedResult=DomQuery(result);return selector?wrappedResult.filter(selector):wrappedResult}})),each$g({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling$1(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling$1(node,"previousSibling",1,until).slice(1)}},(function(name,fn){DomQueryConstructor.fn[name]=function(selector,filter){var result=[];this.each((function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))})),this.length>1&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse()));var wrappedResult=DomQuery(result);return filter?wrappedResult.filter(filter):wrappedResult}})),DomQueryConstructor.fn.is=function(selector){return!!selector&&this.filter(selector).length>0},DomQueryConstructor.fn.init.prototype=DomQueryConstructor.fn,DomQueryConstructor.overrideDefaults=function(callback){var defaults,sub=function(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context||(context=defaults.context),new sub.fn.init(selector,context)};return DomQuery.extend(sub,this),sub},DomQueryConstructor.attrHooks=attrHooks,DomQueryConstructor.cssHooks=cssHooks;var DomQuery=DomQueryConstructor,each$f=Tools.each,grep$1=Tools.grep,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,updateInternalStyleAttr=function(styles,$elm){var rawValue=$elm.attr("style"),value=styles.serialize(styles.parse(rawValue),$elm[0].nodeName);value||(value=null),$elm.attr("data-mce-style",value)},findNodeIndex=function(node,normalized){var lastNodeType,nodeType,idx=0;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!==nodeType||nodeType!==lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx},DOMUtils=function(doc,settings){void 0===settings&&(settings={});var addedStyles={},win=window,files={},counter=0,styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy}),boundEvents=[],schema=settings.schema?settings.schema:Schema({}),styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),events=settings.ownEvents?new EventUtils:EventUtils.Event,blockElementsMap=schema.getBlockElements(),$=DomQuery.overrideDefaults((function(){return{context:doc,element:self.getRoot()}})),get=function(elm){return elm&&doc&&isString$1(elm)?doc.getElementById(elm):elm},$$=function(elm){return $("string"==typeof elm?get(elm):elm)},getAttrib=function(elm,name,defaultVal){var hook,value,$elm=$$(elm);return $elm.length&&(value=(hook=attrHooks[name])&&hook.get?hook.get($elm,name):$elm.attr(name)),void 0===value&&(value=defaultVal||""),value},getAttribs=function(elm){var node=get(elm);return node?node.attributes:[]},setAttrib=function(elm,name,value){""===value&&(value=null);var $elm=$$(elm),originalValue=$elm.attr(name);if($elm.length){var hook=attrHooks[name];hook&&hook.set?hook.set($elm,value,name):$elm.attr(name,value),originalValue!==value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:$elm,attrName:name,attrValue:value})}},getRoot=function(){return settings.root_element||doc.body},getPos$1=function(elm,rootElm){return getPos(doc.body,get(elm),rootElm)},getStyle=function(elm,name,computed){var $elm=$$(elm);return computed?$elm.css(name):("float"===(name=name.replace(/-(\D)/g,(function(a,b){return b.toUpperCase()})))&&(name=Env.browser.isIE()?"styleFloat":"cssFloat"),$elm[0]&&$elm[0].style?$elm[0].style[name]:void 0)},getSize=function(elm){var w,h;return elm=get(elm),w=getStyle(elm,"width"),h=getStyle(elm,"height"),-1===w.indexOf("px")&&(w=0),-1===h.indexOf("px")&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},is=function(elm,selector){var i;if(!elm)return!1;if(!Array.isArray(elm)){if("*"===selector)return 1===elm.nodeType;if(simpleSelectorRe.test(selector)){var selectors=selector.toLowerCase().split(/,/),elmName=elm.nodeName.toLowerCase();for(i=selectors.length-1;i>=0;i--)if(selectors[i]===elmName)return!0;return!1}if(elm.nodeType&&1!==elm.nodeType)return!1}var elms=Array.isArray(elm)?elm:[elm];return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0},getParents=function(elm,selector,root,collect){var selectorVal,result=[],node=get(elm);for(collect=void 0===collect,root=root||("BODY"!==getRoot().nodeName?getRoot().parentNode:null),Tools.is(selector,"string")&&(selectorVal=selector,selector="*"===selector?function(node){return 1===node.nodeType}:function(node){return is(node,selectorVal)});node&&!(node===root||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node));){if(!selector||"function"==typeof selector&&selector(node)){if(!collect)return[node];result.push(node)}node=node.parentNode}return collect?result:null},_findSib=function(node,selector,name){var func=selector;if(node)for("string"==typeof selector&&(func=function(node){return is(node,selector)}),node=node[name];node;node=node[name])if("function"==typeof func&&func(node))return node;return null},run=function(elm,func,scope){var result,node="string"==typeof elm?get(elm):elm;if(!node)return!1;if(Tools.isArray(node)&&(node.length||0===node.length))return result=[],each$f(node,(function(elm,i){elm&&result.push(func.call(scope,"string"==typeof elm?get(elm):elm,i))})),result;var context=scope||this;return func.call(context,node)},setAttribs=function(elm,attrs){$$(elm).each((function(i,node){each$f(attrs,(function(value,name){setAttrib(node,name,value)}))}))},setHTML=function(elm,html){var $elm=$$(elm);isIE?$elm.each((function(i,target){if(!1!==target.canHaveHTML){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){DomQuery("<div></div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}})):$elm.html(html)},add=function(parentElm,name,attrs,html,create){return run(parentElm,(function(parentElm){var newElm="string"==typeof name?doc.createElement(name):name;return setAttribs(newElm,attrs),html&&("string"!=typeof html&&html.nodeType?newElm.appendChild(html):"string"==typeof html&&setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)}))},create=function(name,attrs,html){return add(doc.createElement(name),name,attrs,html,!0)},encode=Entities.encodeAllRaw,remove=function(node,keepChildren){var $node=$$(node);return keepChildren?$node.each((function(){for(var child;child=this.firstChild;)3===child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)})).remove():$node.remove(),$node.length>1?$node.toArray():$node[0]},toggleClass=function(elm,cls,state){$$(elm).toggleClass(cls,state).each((function(){""===this.className&&DomQuery(this).attr("class",null)}))},replace=function(newElm,oldElm,keepChildren){return run(oldElm,(function(oldElm){return Tools.is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each$f(grep$1(oldElm.childNodes),(function(node){newElm.appendChild(node)})),oldElm.parentNode.replaceChild(newElm,oldElm)}))},isNonEmptyElement=function(node){if(isElement$5(node)){var isNamedAnchor="a"===node.nodeName.toLowerCase()&&!getAttrib(node,"href")&&getAttrib(node,"id");if(getAttrib(node,"name")||getAttrib(node,"data-mce-bookmark")||isNamedAnchor)return!0}return!1},createRng=function(){return doc.createRange()},bind=function(target,name,func,scope){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=bind(target[i],name,func,scope);return rv}return!settings.collect||target!==doc&&target!==win||boundEvents.push([target,name,func,scope]),events.bind(target,name,func,scope||self)},unbind=function(target,name,func){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=unbind(target[i],name,func);return rv}if(boundEvents.length>0&&(target===doc||target===win))for(i=boundEvents.length;i--;){var item=boundEvents[i];target!==item[0]||name&&name!==item[1]||func&&func!==item[2]||events.unbind(item[0],item[1],item[2])}return events.unbind(target,name,func)},getContentEditable=function(node){if(node&&isElement$5(node)){var contentEditable=node.getAttribute("data-mce-contenteditable");return contentEditable&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null}return null},self={doc:doc,settings:settings,win:win,files:files,stdMode:!0,boxModel:!0,styleSheetLoader:styleSheetLoader,boundEvents:boundEvents,styles:styles,schema:schema,events:events,isBlock:function(node){if("string"==typeof node)return!!blockElementsMap[node];if(node){var type=node.nodeType;if(type)return!(1!==type||!blockElementsMap[node.nodeName])}return!1},$:$,$$:$$,root:null,clone:function(node,deep){if(!isIE||1!==node.nodeType||deep)return node.cloneNode(deep);var clone_1=doc.createElement(node.nodeName);return each$f(getAttribs(node),(function(attr){setAttrib(clone_1,attr.nodeName,getAttrib(node,attr.nodeName))})),clone_1},getRoot:getRoot,getViewPort:function(argWin){var vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height}},getRect:function(elm){elm=get(elm);var pos=getPos$1(elm),size=getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize:getSize,getParent:function(node,selector,root){var parents=getParents(node,selector,root,!1);return parents&&parents.length>0?parents[0]:null},getParents:getParents,get:get,getNext:function(node,selector){return _findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return _findSib(node,selector,"previousSibling")},select:function(selector,scope){return Sizzle(selector,get(scope)||settings.root_element||doc,[])},is:is,add:add,create:create,createHTML:function(name,attrs,html){var key,outHtml="";for(key in outHtml+="<"+name,attrs)hasNonNullableKey(attrs,key)&&(outHtml+=" "+key+'="'+encode(attrs[key])+'"');return void 0!==html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:function(html){var node,container=doc.createElement("div"),frag=doc.createDocumentFragment();for(frag.appendChild(container),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag.removeChild(container),frag},remove:remove,setStyle:function(elm,name,value){var $elm=isString$1(name)?$$(elm).css(name,value):$$(elm).css(name);settings.update_styles&&updateInternalStyleAttr(styles,$elm)},getStyle:getStyle,setStyles:function(elm,stylesArg){var $elm=$$(elm).css(stylesArg);settings.update_styles&&updateInternalStyleAttr(styles,$elm)},removeAllAttribs:function(e){return run(e,(function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--)e.removeAttributeNode(attrs.item(i))}))},setAttrib:setAttrib,setAttribs:setAttribs,getAttrib:getAttrib,getPos:getPos$1,parseStyle:function(cssText){return styles.parse(cssText)},serializeStyle:function(stylesArg,name){return styles.serialize(stylesArg,name)},addStyle:function(cssText){var head,styleElm;if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText])return;addedStyles[cssText]=!0}(styleElm=doc.getElementById("mceDefaultStyles"))||((styleElm=doc.createElement("style")).id="mceDefaultStyles",styleElm.type="text/css",(head=doc.getElementsByTagName("head")[0]).firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:function(urls){urls||(urls=""),each$k(urls.split(","),(function(url){files[url]=!0,styleSheetLoader.load(url,noop)}))},addClass:function(elm,cls){$$(elm).addClass(cls)},removeClass:function(elm,cls){toggleClass(elm,cls,!1)},hasClass:function(elm,cls){return $$(elm).hasClass(cls)},toggleClass:toggleClass,show:function(elm){$$(elm).show()},hide:function(elm){$$(elm).hide()},isHidden:function(elm){return"none"===$$(elm).css("display")},uniqueId:function(prefix){return(prefix||"mce_")+counter++},setHTML:setHTML,getOuterHTML:function(elm){var node="string"==typeof elm?get(elm):elm;return isElement$5(node)?node.outerHTML:DomQuery("<div></div>").append(DomQuery(node).clone()).html()},setOuterHTML:function(elm,html){$$(elm).each((function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}remove(DomQuery(this).html(html),!0)}))},decode:Entities.decode,encode:encode,insertAfter:function(node,reference){var referenceNode=get(reference);return run(node,(function(node){var parent=referenceNode.parentNode,nextSibling=referenceNode.nextSibling;return nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node),node}))},replace:replace,rename:function(elm,name){var newElm;return elm.nodeName!==name.toUpperCase()&&(newElm=create(name),each$f(getAttribs(elm),(function(attrNode){setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName))})),replace(newElm,elm,!0)),newElm||elm},findCommonAncestor:function(a,b){for(var pe,ps=a;ps;){for(pe=b;pe&&ps!==pe;)pe=pe.parentNode;if(ps===pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:function(rgbVal){return styles.toHex(Tools.trim(rgbVal))},run:run,getAttribs:getAttribs,isEmpty:function(node,elements){var type,name,brCount=0;if(isNonEmptyElement(node))return!1;if(node=node.firstChild){var walker=new DomTreeWalker(node,node.parentNode),whitespace=schema?schema.getWhiteSpaceElements():{};elements=elements||(schema?schema.getNonEmptyElements():null);do{if(type=node.nodeType,isElement$5(node)){var bogusVal=node.getAttribute("data-mce-bogus");if(bogusVal){node=walker.next("all"===bogusVal);continue}if(name=node.nodeName.toLowerCase(),elements&&elements[name]){if("br"===name){brCount++,node=walker.next();continue}return!1}if(isNonEmptyElement(node))return!1}if(8===type)return!1;if(3===type&&!isWhitespaceText(node.nodeValue))return!1;if(3===type&&node.parentNode&&whitespace[node.parentNode.nodeName]&&isWhitespaceText(node.nodeValue))return!1;node=walker.next()}while(node)}return brCount<=1},createRng:createRng,nodeIndex:findNodeIndex,split:function(parentElm,splitElm,replacementElm){var beforeFragment,afterFragment,parentNode,range=createRng();if(parentElm&&splitElm)return range.setStart(parentElm.parentNode,findNodeIndex(parentElm)),range.setEnd(splitElm.parentNode,findNodeIndex(splitElm)),beforeFragment=range.extractContents(),(range=createRng()).setStart(splitElm.parentNode,findNodeIndex(splitElm)+1),range.setEnd(parentElm.parentNode,findNodeIndex(parentElm)+1),afterFragment=range.extractContents(),(parentNode=parentElm.parentNode).insertBefore(trimNode(self,beforeFragment),parentElm),replacementElm?parentNode.insertBefore(replacementElm,parentElm):parentNode.insertBefore(splitElm,parentElm),parentNode.insertBefore(trimNode(self,afterFragment),parentElm),remove(parentElm),replacementElm||splitElm},bind:bind,unbind:unbind,fire:function(target,name,evt){return events.fire(target,name,evt)},getContentEditable:getContentEditable,getContentEditableParent:function(node){for(var root=getRoot(),state=null;node&&node!==root&&null===(state=getContentEditable(node));node=node.parentNode);return state},destroy:function(){if(boundEvents.length>0)for(var i=boundEvents.length;i--;){var item=boundEvents[i];events.unbind(item[0],item[1],item[2])}each$j(files,(function(_,url){styleSheetLoader.unload(url),delete files[url]})),Sizzle.setDocument&&Sizzle.setDocument()},isChildOf:function(node,parent){if(isIE){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1}return node===parent||parent.contains(node)},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset}},attrHooks=function(styles,settings,getContext){var keepValues=settings.keep_values,keepUrlHook={set:function($elm,value,name){settings.url_converter&&null!==value&&(value=settings.url_converter.call(settings.url_converter_scope||getContext(),value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}},attrHooks={style:{set:function($elm,value){null===value||"object"!=typeof value?(keepValues&&$elm.attr("data-mce-style",value),null!==value&&"string"==typeof value?($elm.removeAttr("style"),$elm.css(styles.parse(value))):$elm.attr("style",value)):$elm.css(value)},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return styles.serialize(styles.parse(value),$elm[0].nodeName)}}};return keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks}(styles,settings,constant(self));return self};DOMUtils.DOM=DOMUtils(document),DOMUtils.nodeIndex=findNodeIndex;var DOM$a=DOMUtils.DOM,each$e=Tools.each,grep=Tools.grep,ScriptLoader=function(){function ScriptLoader(settings){void 0===settings&&(settings={}),this.states={},this.queue=[],this.scriptLoadedCallbacks={},this.queueLoadedCallbacks=[],this.loading=0,this.settings=settings}return ScriptLoader.prototype._setReferrerPolicy=function(referrerPolicy){this.settings.referrerPolicy=referrerPolicy},ScriptLoader.prototype.loadScript=function(url,success,failure){var elm,dom=DOM$a,cleanup=function(){dom.remove(id),elm&&(elm.onerror=elm.onload=elm=null)},id=dom.uniqueId();(elm=document.createElement("script")).id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),this.settings.referrerPolicy&&dom.setAttrib(elm,"referrerpolicy",this.settings.referrerPolicy),elm.onload=function(){cleanup(),success()},elm.onerror=function(){cleanup(),isFunction(failure)?failure():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+url)},(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)},ScriptLoader.prototype.isDone=function(url){return 2===this.states[url]},ScriptLoader.prototype.markDone=function(url){this.states[url]=2},ScriptLoader.prototype.add=function(url,success,scope,failure){var state=this.states[url];this.queue.push(url),void 0===state&&(this.states[url]=0),success&&(this.scriptLoadedCallbacks[url]||(this.scriptLoadedCallbacks[url]=[]),this.scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this}))},ScriptLoader.prototype.load=function(url,success,scope,failure){return this.add(url,success,scope,failure)},ScriptLoader.prototype.remove=function(url){delete this.states[url],delete this.scriptLoadedCallbacks[url]},ScriptLoader.prototype.loadQueue=function(success,scope,failure){this.loadScripts(this.queue,success,scope,failure)},ScriptLoader.prototype.loadScripts=function(scripts,success,scope,failure){var self=this,failures=[],execCallbacks=function(name,url){each$e(self.scriptLoadedCallbacks[url],(function(callback){isFunction(callback[name])&&callback[name].call(callback.scope)})),self.scriptLoadedCallbacks[url]=void 0};self.queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this});var loadScripts=function(){var loadingScripts=grep(scripts);if(scripts.length=0,each$e(loadingScripts,(function(url){2!==self.states[url]?3!==self.states[url]?1!==self.states[url]&&(self.states[url]=1,self.loading++,self.loadScript(url,(function(){self.states[url]=2,self.loading--,execCallbacks("success",url),loadScripts()}),(function(){self.states[url]=3,self.loading--,failures.push(url),execCallbacks("failure",url),loadScripts()}))):execCallbacks("failure",url):execCallbacks("success",url)})),!self.loading){var notifyCallbacks=self.queueLoadedCallbacks.slice(0);self.queueLoadedCallbacks.length=0,each$e(notifyCallbacks,(function(callback){0===failures.length?isFunction(callback.success)&&callback.success.call(callback.scope):isFunction(callback.failure)&&callback.failure.call(callback.scope,failures)}))}};loadScripts()},ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}(),Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},data={},currentCode=Cell("en"),getLanguageData=function(){return get$9(data,currentCode.get())},I18n={getData:function(){return map$2(data,(function(value){return __assign({},value)}))},setCode:function(newCode){newCode&&currentCode.set(newCode)},getCode:function(){return currentCode.get()},add:function(code,items){var langData=data[code];langData||(data[code]=langData={}),each$j(items,(function(translation,name){langData[name.toLowerCase()]=translation}))},translate:function(text){var str,langData=getLanguageData().getOr({}),toString=function(obj){return isFunction(obj)?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj},isEmpty=function(text){return""===text||null==text},getLangData=function(text){var textstr=toString(text);return get$9(langData,textstr.toLowerCase()).map(toString).getOr(textstr)},removeContext=function(str){return str.replace(/{context:\w+}$/,"")};if(isEmpty(text))return"";if(isObject(str=text)&&has$2(str,"raw"))return toString(text.raw);if(function(str){return isArray$1(str)&&str.length>1}(text)){var values_1=text.slice(1);return removeContext(getLangData(text[0]).replace(/\{([0-9]+)\}/g,(function($1,$2){return has$2(values_1,$2)?toString(values_1[$2]):$1})))}return removeContext(getLangData(text))},isRtl:function(){return getLanguageData().bind((function(items){return get$9(items,"_dir")})).exists((function(dir){return"rtl"===dir}))},hasCode:function(code){return has$2(data,code)}},AddOnManager=function(){var items=[],urls={},lookup={},_listeners=[],runListeners=function(name,state){var matchedListeners=filter$4(_listeners,(function(listener){return listener.name===name&&listener.state===state}));each$k(matchedListeners,(function(listener){return listener.callback()}))},dependencies=function(name){var result;return lookup[name]&&(result=lookup[name].dependencies),result||[]},createUrl=function(baseUrl,dep){return"object"==typeof dep?dep:"string"==typeof baseUrl?{prefix:"",resource:dep,suffix:""}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},load=function(name,addOnUrl,success,scope,failure){if(!urls[name]){var urlString="string"==typeof addOnUrl?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;0!==urlString.indexOf("/")&&-1===urlString.indexOf("://")&&(urlString=AddOnManager.baseURL+"/"+urlString),urls[name]=urlString.substring(0,urlString.lastIndexOf("/"));var done=function(){runListeners(name,"loaded"),function(name,addOnUrl,success,scope){var deps=dependencies(name);each$k(deps,(function(dep){var newUrl=createUrl(addOnUrl,dep);load(newUrl.resource,newUrl,void 0,void 0)})),success&&(scope?success.call(scope):success.call(ScriptLoader))}(name,addOnUrl,success,scope)};lookup[name]?done():ScriptLoader.ScriptLoader.add(urlString,done,scope,failure)}},waitFor=function(name,callback,state){void 0===state&&(state="added"),has$2(lookup,name)&&"added"===state||has$2(urls,name)&&"loaded"===state?callback():_listeners.push({name:name,state:state,callback:callback})};return{items:items,urls:urls,lookup:lookup,_listeners:_listeners,get:function(name){if(lookup[name])return lookup[name].instance},dependencies:dependencies,requireLangPack:function(name,languages){!1!==AddOnManager.languageLoad&&waitFor(name,(function(){var language=I18n.getCode();!language||languages&&-1===(","+(languages||"")+",").indexOf(","+language+",")||ScriptLoader.ScriptLoader.add(urls[name]+"/langs/"+language+".js")}),"loaded")},add:function(id,addOn,dependencies){var addOnConstructor=addOn;return items.push(addOnConstructor),lookup[id]={instance:addOnConstructor,dependencies:dependencies},runListeners(id,"added"),addOnConstructor},remove:function(name){delete urls[name],delete lookup[name]},createUrl:createUrl,addComponents:function(pluginName,scripts){var pluginUrl=urls[pluginName];each$k(scripts,(function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)}))},load:load,waitFor:waitFor}};AddOnManager.languageLoad=!0,AddOnManager.baseURL="",AddOnManager.PluginManager=AddOnManager(),AddOnManager.ThemeManager=AddOnManager();var value=function(){var subject=function(doRevoke){var subject=Cell(Optional.none()),revoke=function(){return subject.get().each(doRevoke)};return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}}(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},first=function(fn,rate){var timer=null;return{cancel:function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];isNull(timer)&&(timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate))}}},last=function(fn,rate){var timer=null,cancel=function(){isNull(timer)||(clearTimeout(timer),timer=null)};return{cancel:cancel,throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate)}}},read$4=function(element,attr){var value=get$6(element,attr);return void 0===value||""===value?[]:value.split(" ")},supports=function(element){return void 0!==element.dom.classList},add$2=function(element,clazz){return function(element,attr,id){var nu=read$4(element,attr).concat([id]);return set$1(element,attr,nu.join(" ")),!0}(element,"class",clazz)},remove$4=function(element,clazz){return function(element,attr,id){var nu=filter$4(read$4(element,attr),(function(v){return v!==id}));return nu.length>0?set$1(element,attr,nu.join(" ")):remove$6(element,attr),!1}(element,"class",clazz)},add$1=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$2(element,clazz)},cleanClass=function(element){0===(supports(element)?element.dom.classList:function(element){return read$4(element,"class")}(element)).length&&remove$6(element,"class")},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},descendants$1=function(scope,predicate){var result=[];return each$k(children(scope),(function(x){predicate(x)&&(result=result.concat([x])),result=result.concat(descendants$1(x,predicate))})),result},descendants=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map$3(base.querySelectorAll(selector),SugarElement.fromDom)}(selector,scope)},annotation=constant("mce-annotation"),dataAnnotation=constant("data-mce-annotation"),dataAnnotationId=constant("data-mce-annotation-uid"),identify=function(editor,annotationName){var rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),root=SugarElement.fromDom(editor.getBody()),selector=annotationName.fold((function(){return"."+annotation()}),(function(an){return"["+dataAnnotation()+'="'+an+'"]'})),newStart=child$1(start,rng.startOffset).getOr(start),closest=closest$2(newStart,selector,(function(n){return eq(n,root)})),getAttr=function(c,property){return function(element,key){var dom=element.dom;return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)}(c,property)?Optional.some(get$6(c,property)):Optional.none()};return closest.bind((function(c){return getAttr(c,""+dataAnnotationId()).bind((function(uid){return getAttr(c,""+dataAnnotation()).map((function(name){var elements=findMarkers(editor,uid);return{uid:uid,name:name,elements:elements}}))}))}))},findMarkers=function(editor,uid){var body=SugarElement.fromDom(editor.getBody());return descendants(body,"["+dataAnnotationId()+'="'+uid+'"]')},setup$n=function(editor,_registry){var changeCallbacks=Cell({}),initData=function(){return{listeners:[],previous:value()}},withCallbacks=function(name,f){updateCallbacks(name,(function(data){return f(data),data}))},updateCallbacks=function(name,f){var callbackMap=changeCallbacks.get(),outputData=f(get$9(callbackMap,name).getOrThunk(initData));callbackMap[name]=outputData,changeCallbacks.set(callbackMap)},onNodeChange=last((function(){var callbackMap=changeCallbacks.get(),annotations=sort(keys(callbackMap));each$k(annotations,(function(name){updateCallbacks(name,(function(data){var prev=data.previous.get();return identify(editor,Optional.some(name)).fold((function(){prev.isSome()&&(!function(name){withCallbacks(name,(function(data){each$k(data.listeners,(function(f){return f(!1,name)}))}))}(name),data.previous.clear())}),(function(_a){var uid=_a.uid,name=_a.name,elements=_a.elements;is$1(prev,uid)||(!function(name,uid,elements){withCallbacks(name,(function(data){each$k(data.listeners,(function(f){return f(!0,name,{uid:uid,nodes:map$3(elements,(function(elem){return elem.dom}))})}))}))}(name,uid,elements),data.previous.set(uid))})),{previous:data.previous,listeners:data.listeners}}))}))}),30);editor.on("remove",(function(){onNodeChange.cancel()})),editor.on("NodeChange",(function(){onNodeChange.throttle()}));return{addListener:function(name,f){updateCallbacks(name,(function(data){return{previous:data.previous,listeners:data.listeners.concat([f])}}))}}},setup$m=function(editor,registry){editor.on("init",(function(){editor.serializer.addNodeFilter("span",(function(spans){each$k(spans,(function(span){(function(span){return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup)})(span).each((function(settings){!1===settings.persistent&&span.unwrap()}))}))}))}))},unique=0,generate=function(prefix){var time=(new Date).getTime();return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},set=function(element,content){var html,div,docDom=owner$1(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),contentElements=(html=content,(div=(docDom||document).createElement("div")).innerHTML=html,children(SugarElement.fromDom(div)));append(fragment,contentElements),empty(element),append$1(element,fragment)},clone$1=function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))},shallow=function(original){return clone$1(original,!1)},deep$1=function(original){return clone$1(original,!0)},TextWalker=function(startNode,rootNode,isBoundary){void 0===isBoundary&&(isBoundary=never);var walker=new DomTreeWalker(startNode,rootNode),walk=function(direction){var next;do{next=walker[direction]()}while(next&&!isText$7(next)&&!isBoundary(next));return Optional.from(next).filter(isText$7)};return{current:function(){return Optional.from(walker.current()).filter(isText$7)},next:function(){return walk("next")},prev:function(){return walk("prev")},prev2:function(){return walk("prev2")}}},TextSeeker=function(dom,isBoundary){var isBlockBoundary=isBoundary||function(node){return dom.isBlock(node)||isBr$5(node)||isContentEditableFalse$b(node)},walk=function(node,offset,walker,process){if(isText$7(node)){var newOffset=process(node,offset,node.data);if(-1!==newOffset)return Optional.some({container:node,offset:newOffset})}return walker().bind((function(next){return walk(next.container,next.offset,walker,process)}))};return{backwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,(function(){return walker.prev().map((function(prev){return{container:prev,offset:prev.length}}))}),process).getOrNull()},forwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,(function(){return walker.next().map((function(next){return{container:next,offset:0}}))}),process).getOrNull()}}},round$2=Math.round,clone=function(rect){return rect?{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},collapse=function(rect,toStart){return rect=clone(rect),toStart||(rect.left=rect.left+rect.width),rect.right=rect.left,rect.width=0,rect},isValidOverflow=function(overflowY,rect1,rect2){return overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2},isAbove$1=function(rect1,rect2){var halfHeight=Math.min(rect2.height/2,rect1.height/2);return rect1.bottom-halfHeight<rect2.top||!(rect1.top>rect2.bottom)&&isValidOverflow(rect2.top-rect1.bottom,rect1,rect2)},isBelow$1=function(rect1,rect2){return rect1.top>rect2.bottom||!(rect1.bottom<rect2.top)&&isValidOverflow(rect2.bottom-rect1.top,rect1,rect2)},containsXY=function(rect,clientX,clientY){return clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom},getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset===startOffset+1?startContainer.childNodes[startOffset]:null},getNode$1=function(container,offset){if(isElement$5(container)&&container.hasChildNodes()){var childNodes=container.childNodes;return childNodes[function(value,min,max){return Math.min(Math.max(value,min),max)}(offset,0,childNodes.length-1)]}return container},extendingChars=new RegExp("[Ì-Í¯Ò-ÒÒ-ÒÖ-Ö½Ö¿×-××-××Ø-ØÙ-ÙÙ°Û-ÛÛ-Û¤Û§-Û¨Ûª-Û­ÜÜ°-ÝÞ¦-Þ°ß«-ß³à -à à -à £à ¥-à §à ©-à ­à¡-à¡à££-à¤à¤ºà¤¼à¥-à¥à¥à¥-à¥à¥¢-à¥£à¦à¦¼à¦¾à§-à§à§à§à§¢-à§£à¨-à¨à¨¼à©-à©à©-à©à©-à©à©à©°-à©±à©µàª-àªàª¼à«-à«à«-à«à«à«¢-à«£à¬à¬¼à¬¾à¬¿à­-à­à­à­à­à­¢-à­£à®à®¾à¯à¯à¯à°à°¾-à±à±-à±à±-à±à±-à±à±¢-à±£à²à²¼à²¿à³à³à³-à³à³-à³à³¢-à³£à´à´¾àµ-àµàµàµàµ¢-àµ£à·à·à·-à·à·à·à¸±à¸´-à¸ºà¹-à¹àº±àº´-àº¹àº»-àº¼à»-à»à¼-à¼à¼µà¼·à¼¹à½±-à½¾à¾-à¾à¾-à¾à¾-à¾à¾-à¾¼à¿á­-á°á²-á·á¹-áºá½-á¾á-áá-á á±-á´áá-áááá-áá-áá²-á´á-áá²-á³á´-áµá·-á½áá-ááá -á á¢©á¤ -á¤¢á¤§-á¤¨á¤²á¤¹-á¤»á¨-á¨á¨á©á©-á©á© á©¢á©¥-á©¬á©³-á©¼á©¿áª°-áª½áª¾á¬-á¬á¬´á¬¶-á¬ºá¬¼á­á­«-á­³á®-á®á®¢-á®¥á®¨-á®©á®«-á®­á¯¦á¯¨-á¯©á¯­á¯¯-á¯±á°¬-á°³á°¶-á°·á³-á³á³-á³ á³¢-á³¨á³­á³´á³¸-á³¹á·-á·µá·¼-á·¿â-ââ-ââ-â â¡â¢-â¤â¥-â°â³¯-â³±âµ¿â· -â·¿ãª-ã­ã®-ã¯ã-ãê¯ê°-ê²ê´-ê½ê-êê°-ê±ê ê ê ê ¥-ê ¦ê£ê£ -ê£±ê¤¦-ê¤­ê¥-ê¥ê¦-ê¦ê¦³ê¦¶-ê¦¹ê¦¼ê§¥ê¨©-ê¨®ê¨±-ê¨²ê¨µ-ê¨¶ê©ê©ê©¼êª°êª²-êª´êª·-êª¸êª¾-êª¿ê«ê«¬-ê«­ê«¶ê¯¥ê¯¨ê¯­ï¬ï¸-ï¸ï¸ -ï¸¯ï¾-ï¾]"),isExtendingChar=function(ch){return"string"==typeof ch&&ch.charCodeAt(0)>=768&&extendingChars.test(ch)},isElement$3=isElement$5,isCaretCandidate$2=isCaretCandidate$3,isBlock$1=matchStyleValues("display","block table"),isFloated=matchStyleValues("float","left right"),isValidElementCaretCandidate=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}}(isElement$3,isCaretCandidate$2,not(isFloated)),isNotPre=not(matchStyleValues("white-space","pre pre-line pre-wrap")),isText$4=isText$7,isBr$2=isBr$5,nodeIndex$1=DOMUtils.nodeIndex,resolveIndex$1=function(container,offset){return offset<0&&isElement$5(container)&&container.hasChildNodes()?void 0:getNode$1(container,offset)},createRange$1=function(doc){return"createRange"in doc?doc.createRange():DOMUtils.DOM.createRng()},isWhiteSpace$1=function(chr){return chr&&/[\r\n\t ]/.test(chr)},isRange=function(rng){return!!rng.setStart&&!!rng.setEnd},isHiddenWhiteSpaceRange=function(range){var container=range.startContainer,offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$7(container)){var text=container.data;if(isWhiteSpace$1(text[offset-1])||isWhiteSpace$1(text[offset+1]))return!0}return!1},isZeroRect=function(r){return 0===r.left&&0===r.right&&0===r.top&&0===r.bottom},getBoundingClientRect$1=function(item){var clientRect,clientRects=item.getClientRects();return clientRect=clientRects.length>0?clone(clientRects[0]):clone(item.getBoundingClientRect()),!isRange(item)&&isBr$2(item)&&isZeroRect(clientRect)?function(brNode){var doc=brNode.ownerDocument,rng=createRange$1(doc),nbsp$1=doc.createTextNode("Â "),parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode),rng.setStart(nbsp$1,0),rng.setEnd(nbsp$1,1);var clientRect=clone(rng.getBoundingClientRect());return parentNode.removeChild(nbsp$1),clientRect}(item):isZeroRect(clientRect)&&isRange(item)?function(rng){var sc=rng.startContainer,ec=rng.endContainer,so=rng.startOffset,eo=rng.endOffset;if(sc===ec&&isText$7(ec)&&0===so&&1===eo){var newRng=rng.cloneRange();return newRng.setEndAfter(ec),getBoundingClientRect$1(newRng)}return null}(item):clientRect},collapseAndInflateWidth=function(clientRect,toStart){var newClientRect=collapse(clientRect,toStart);return newClientRect.width=1,newClientRect.right=newClientRect.left+1,newClientRect},getCaretPositionClientRects=function(caretPosition){var clientRects=[],addUniqueAndValidRect=function(clientRect){var rect1,rect2;0!==clientRect.height&&(clientRects.length>0&&(rect1=clientRect,rect2=clientRects[clientRects.length-1],rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right)||clientRects.push(clientRect))},addCharacterOffset=function(container,offset){var range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset]))return clientRects;if(isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1)),clientRects}offset>0&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!0)))},container=caretPosition.container(),offset=caretPosition.offset();if(isText$4(container))return addCharacterOffset(container,offset),clientRects;if(isElement$3(container))if(caretPosition.isAtEnd()){var node=resolveIndex$1(container,offset);isText$4(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr$2(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1))}else{node=resolveIndex$1(container,offset);if(isText$4(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1)),clientRects;var beforeNode=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);isValidElementCaretCandidate(beforeNode)&&!isBr$2(beforeNode)&&(isBlock$1(beforeNode)||isBlock$1(node)||!isValidElementCaretCandidate(node))&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(beforeNode),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!0))}return clientRects},CaretPosition=function(container,offset,clientRects){var getClientRects=function(){return clientRects||(clientRects=getCaretPositionClientRects(CaretPosition(container,offset))),clientRects};return{container:constant(container),offset:constant(offset),toRange:function(){var range=createRange$1(container.ownerDocument);return range.setStart(container,offset),range.setEnd(container,offset),range},getClientRects:getClientRects,isVisible:function(){return getClientRects().length>0},isAtStart:function(){return isText$4(container),0===offset},isAtEnd:function(){return isText$4(container)?offset>=container.data.length:offset>=container.childNodes.length},isEqual:function(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()},getNode:function(before){return resolveIndex$1(container,before?offset-1:offset)}}};CaretPosition.fromRangeStart=function(range){return CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node)+1)},CaretPosition.before=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node))},CaretPosition.isAbove=function(pos1,pos2){return lift2(head(pos2.getClientRects()),last$2(pos1.getClientRects()),isAbove$1).getOr(!1)},CaretPosition.isBelow=function(pos1,pos2){return lift2(last$2(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(!1)},CaretPosition.isAtStart=function(pos){return!!pos&&pos.isAtStart()},CaretPosition.isAtEnd=function(pos){return!!pos&&pos.isAtEnd()},CaretPosition.isTextPosition=function(pos){return!!pos&&isText$7(pos.container())},CaretPosition.isElementPosition=function(pos){return!1===CaretPosition.isTextPosition(pos)};var HDirection,trimEmptyTextNode$1=function(dom,node){isText$7(node)&&0===node.data.length&&dom.remove(node)},rangeInsertNode=function(dom,rng,node){isDocumentFragment(node)?function(dom,rng,frag){var firstChild=Optional.from(frag.firstChild),lastChild=Optional.from(frag.lastChild);rng.insertNode(frag),firstChild.each((function(child){return trimEmptyTextNode$1(dom,child.previousSibling)})),lastChild.each((function(child){return trimEmptyTextNode$1(dom,child.nextSibling)}))}(dom,rng,node):function(dom,rng,node){rng.insertNode(node),trimEmptyTextNode$1(dom,node.previousSibling),trimEmptyTextNode$1(dom,node.nextSibling)}(dom,rng,node)},isText$3=isText$7,isBogus=isBogus$2,nodeIndex=DOMUtils.nodeIndex,normalizedParent=function(node){var parentNode=node.parentNode;return isBogus(parentNode)?normalizedParent(parentNode):parentNode},getChildNodes=function(node){return node?reduce(node.childNodes,(function(result,node){return isBogus(node)&&"BR"!==node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result}),[]):[]},equal=function(a){return function(b){return a===b}},createPathItem=function(node){return(isText$3(node)?"text()":node.nodeName.toLowerCase())+"["+function(node){var nodes,index;nodes=getChildNodes(normalizedParent(node)),index=findIndex$1(nodes,equal(node),node),nodes=nodes.slice(0,index+1);var numTextFragments=reduce(nodes,(function(result,node,i){return isText$3(node)&&isText$3(nodes[i-1])&&result++,result}),0);return nodes=filter$2(nodes,matchNodeNames([node.nodeName])),(index=findIndex$1(nodes,equal(node),node))-numTextFragments}(node)+"]"},create$6=function(root,caretPosition){var container,offset,outputOffset,childNodes,parents,path=[];return container=caretPosition.container(),offset=caretPosition.offset(),isText$3(container)?outputOffset=function(node,offset){for(;(node=node.previousSibling)&&isText$3(node);)offset+=node.data.length;return offset}(container,offset):(offset>=(childNodes=container.childNodes).length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]),path.push(createPathItem(container)),parents=function(root,node,predicate){var parents=[];for(node=node.parentNode;!(node===root||predicate&&predicate(node));node=node.parentNode)parents.push(node);return parents}(root,container),parents=filter$2(parents,not(isBogus$2)),(path=path.concat(map$1(parents,(function(node){return createPathItem(node)})))).reverse().join("/")+","+outputOffset},resolve$2=function(root,path){var offset;if(!path)return null;var parts=path.split(","),paths=parts[0].split("/");offset=parts.length>1?parts[1]:"before";var container=reduce(paths,(function(result,value){var match=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);return match?("text()"===match[1]&&(match[1]="#text"),function(node,name,index){var nodes=getChildNodes(node);return nodes=filter$2(nodes,(function(node,index){return!isText$3(node)||!isText$3(nodes[index-1])})),(nodes=filter$2(nodes,matchNodeNames([name])))[index]}(result,match[1],parseInt(match[2],10))):null}),root);return container?isText$3(container)?function(container,offset){for(var dataLen,node=container,targetOffset=0;isText$3(node);){if(dataLen=node.data.length,offset>=targetOffset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText$3(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return isText$3(container)&&offset>container.data.length&&(offset=container.data.length),CaretPosition(container,offset)}(container,parseInt(offset,10)):(offset="after"===offset?nodeIndex(container)+1:nodeIndex(container),CaretPosition(container.parentNode,offset)):null},isContentEditableFalse$9=isContentEditableFalse$b,getPoint=function(dom,trim,normalized,rng,start){var childNodes,container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],after=0,root=dom.getRoot();for(isText$7(container)?point.push(normalized?function(trim,container,offset){var node,trimmedOffset;for(trimmedOffset=trim(container.data.slice(0,offset)).length,node=container.previousSibling;node&&isText$7(node);node=node.previousSibling)trimmedOffset+=trim(node.data).length;return trimmedOffset}(trim,container,offset):offset):(offset>=(childNodes=container.childNodes).length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after));container&&container!==root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point},findIndex=function(dom,name,element){var count=0;return Tools.each(dom.select(name),(function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!==element&&void count++})),count},moveEndPoint$1=function(rng,start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"],offset=rng[prefix+"Offset"],isElement$5(container)&&"TR"===container.nodeName&&(container=(childNodes=container.childNodes)[Math.min(start?offset:offset-1,childNodes.length-1)])&&(offset=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,offset))},normalizeTableCellSelection=function(rng){return moveEndPoint$1(rng,!0),moveEndPoint$1(rng,!1),rng},findSibling=function(node,offset){var sibling;if(isElement$5(node)&&(node=getNode$1(node,offset),isContentEditableFalse$9(node)))return node;if(isCaretContainer$2(node)){if(isText$7(node)&&isCaretContainerBlock$1(node)&&(node=node.parentNode),sibling=node.previousSibling,isContentEditableFalse$9(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse$9(sibling))return sibling}},getOffsetBookmark=function(trim,normalized,selection){var element=selection.getNode(),name=element?element.nodeName:null,rng=selection.getRng();if(isContentEditableFalse$9(element)||"IMG"===name)return{name:name,index:findIndex(selection.dom,name,element)};var sibling=function(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset)}(rng);return sibling?{name:name=sibling.tagName,index:findIndex(selection.dom,name,sibling)}:function(trim,selection,normalized,rng){var dom=selection.dom,bookmark={};return bookmark.start=getPoint(dom,trim,normalized,rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(dom,trim,normalized,rng,!1)),isRangeInCaretContainerBlock(rng)&&(bookmark.isFakeCaret=!0),bookmark}(trim,selection,normalized,rng)},createBookmarkSpan=function(dom,id,filled){var args={"data-mce-type":"bookmark",id:id,style:"overflow:hidden;line-height:0px"};return filled?dom.create("span",args,"&#xFEFF;"):dom.create("span",args)},getPersistentBookmark=function(selection,filled){var dom=selection.dom,rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),element=selection.getNode(),name=element.nodeName;if("IMG"===name)return{name:name,index:findIndex(dom,name,element)};var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(!1);var endBookmarkNode=createBookmarkSpan(dom,id+"_end",filled);rangeInsertNode(dom,rng2,endBookmarkNode)}(rng=normalizeTableCellSelection(rng)).collapse(!0);var startBookmarkNode=createBookmarkSpan(dom,id+"_start",filled);return rangeInsertNode(dom,rng,startBookmarkNode),selection.moveToBookmark({id:id,keep:!0}),{id:id}},getBookmark$2=function(selection,type,normalized){return 2===type?getOffsetBookmark(trim$2,normalized,selection):3===type?function(selection){var rng=selection.getRng();return{start:create$6(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$6(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng))}}(selection):type?function(selection){return{rng:selection.getRng()}}(selection):getPersistentBookmark(selection,!1)},getUndoBookmark=curry(getOffsetBookmark,identity,!0),DOM$9=DOMUtils.DOM,getBodySetting=function(editor,name,defaultValue){var value=editor.getParam(name,defaultValue);if(-1!==value.indexOf("=")){var bodyObj=editor.getParam(name,"","hash");return get$9(bodyObj,editor.id).getOr(defaultValue)}return value},getContentSecurityPolicy=function(editor){return editor.getParam("content_security_policy","")},getForcedRootBlock=function(editor){if(editor.getParam("force_p_newlines",!1))return"p";var block=editor.getParam("forced_root_block","p");return!1===block?"":!0===block?"p":block},getForcedRootBlockAttrs=function(editor){return editor.getParam("forced_root_block_attrs",{})},isAutomaticUploadsEnabled=function(editor){return editor.getParam("automatic_uploads",!0,"boolean")},shouldReuseFileName=function(editor){return editor.getParam("images_reuse_filename",!1,"boolean")},getIconPackName=function(editor){return editor.getParam("icons","","string")},getImageUploadUrl=function(editor){return editor.getParam("images_upload_url","","string")},getImageUploadBasePath=function(editor){return editor.getParam("images_upload_base_path","","string")},getImagesUploadCredentials=function(editor){return editor.getParam("images_upload_credentials",!1,"boolean")},getImagesUploadHandler=function(editor){return editor.getParam("images_upload_handler",null,"function")},shouldUseContentCssCors=function(editor){return editor.getParam("content_css_cors",!1,"boolean")},getReferrerPolicy=function(editor){return editor.getParam("referrer_policy","","string")},getLanguageCode=function(editor){return editor.getParam("language","en","string")},shouldIndentUseMargin=function(editor){return editor.getParam("indent_use_margin",!1)},getFontCss=function(editor){var fontCss=editor.getParam("font_css",[]);return isArray$1(fontCss)?fontCss:map$3(fontCss.split(","),trim$4)},getObjectResizing=function(editor){var selector=editor.getParam("object_resizing");return!1!==selector&&!Env.iOS&&(isString$1(selector)?selector:"table,img,figure.image,div,video,iframe")},getEventRoot=function(editor){return editor.getParam("event_root")},getTheme=function(editor){return editor.getParam("theme")},shouldValidate=function(editor){return editor.getParam("validate")},isInlineBoundariesEnabled=function(editor){return!1!==editor.getParam("inline_boundaries")},hasContentCssCors=function(editor){return editor.getParam("content_css_cors")},getPlugins=function(editor){return editor.getParam("plugins","","string")},isElement$2=isElement$5,isText$2=isText$7,removeNode$1=function(node){var parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},trimCount=function(text){var trimmedText=trim$2(text);return{count:text.length-trimmedText.length,text:trimmedText}},deleteZwspChars=function(caretContainer){for(var idx;-1!==(idx=caretContainer.data.lastIndexOf("\ufeff"));)caretContainer.deleteData(idx,1)},removeUnchanged=function(caretContainer,pos){return remove$2(caretContainer),pos},removeElementAndReposition=function(caretContainer,pos){var parentNode=pos.container(),newPosition=function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Optional.none():Optional.some(r)}(from(parentNode.childNodes),caretContainer).map((function(index){return index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos})).getOr(pos);return remove$2(caretContainer),newPosition},removeTextCaretContainer=function(caretContainer,pos){return isText$2(caretContainer)&&pos.container()===caretContainer?function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset()));return(before.text+after.text).length>0?(deleteZwspChars(caretContainer),CaretPosition(caretContainer,pos.offset()-before.count)):pos}(caretContainer,pos):removeUnchanged(caretContainer,pos)},removeAndReposition=function(container,pos){return CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):function(caretContainer,pos){return pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos)}(container,pos)},remove$2=function(caretContainerNode){isElement$2(caretContainerNode)&&isCaretContainer$2(caretContainerNode)&&(hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode$1(caretContainerNode)),isText$2(caretContainerNode)&&(deleteZwspChars(caretContainerNode),0===caretContainerNode.data.length&&removeNode$1(caretContainerNode))},browser$2=detect().browser,isContentEditableFalse$8=isContentEditableFalse$b,isMedia$1=isMedia$2,isTableCell$3=isTableCell$5,getAbsoluteClientRect=function(root,element,before){var scrollX,scrollY,clientRect=collapse(element.getBoundingClientRect(),before);if("BODY"===root.tagName){var docElm=root.ownerDocument.documentElement;scrollX=root.scrollLeft||docElm.scrollLeft,scrollY=root.scrollTop||docElm.scrollTop}else{var rootRect=root.getBoundingClientRect();scrollX=root.scrollLeft-rootRect.left,scrollY=root.scrollTop-rootRect.top}clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1;var margin=element.offsetWidth-element.clientWidth;return margin>0&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect},FakeCaret=function(editor,root,isBlock,hasFocus){var cursorInterval,caretContainerNode,lastVisualCaret=value(),rootBlock=getForcedRootBlock(editor),caretBlock=rootBlock.length>0?rootBlock:"p",hide=function(){!function(root){for(var fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),"*[contentEditable=false],video,audio,embed,object"),i=0;i<fakeCaretTargetNodes.length;i++){var data,node=fakeCaretTargetNodes[i].dom,sibling=node.previousSibling;endsWithCaretContainer$1(sibling)&&(1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1)),sibling=node.nextSibling,startsWithCaretContainer$1(sibling)&&(1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1))}}(root),caretContainerNode&&(remove$2(caretContainerNode),caretContainerNode=null),lastVisualCaret.on((function(caretState){DomQuery(caretState.caret).remove(),lastVisualCaret.clear()})),cursorInterval&&(Delay.clearInterval(cursorInterval),cursorInterval=void 0)},startBlink=function(){cursorInterval=Delay.setInterval((function(){hasFocus()?DomQuery("div.mce-visual-caret",root).toggleClass("mce-visual-caret-hidden"):DomQuery("div.mce-visual-caret",root).addClass("mce-visual-caret-hidden")}),500)};return{show:function(before,element){var rng;if(hide(),isTableCell$3(element))return null;if(!isBlock(element))return caretContainerNode=function(node,before){var textNode=node.ownerDocument.createTextNode("\ufeff"),parentNode=node.parentNode;if(before){if(sibling=node.previousSibling,isText$6(sibling)){if(isCaretContainer$2(sibling))return sibling;if(endsWithCaretContainer$1(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{var sibling=node.nextSibling;if(isText$6(sibling)){if(isCaretContainer$2(sibling))return sibling;if(startsWithCaretContainer$1(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode}(element,before),rng=element.ownerDocument.createRange(),isInlineFakeCaretTarget(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng;caretContainerNode=insertBlock$1(caretBlock,element,before);var clientRect=getAbsoluteClientRect(root,element,before);DomQuery(caretContainerNode).css("top",clientRect.top);var caret=DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(__assign({},clientRect)).appendTo(root)[0];return lastVisualCaret.set({caret:caret,element:element,before:before}),before&&DomQuery(caret).addClass("mce-visual-caret-before"),startBlink(),(rng=element.ownerDocument.createRange()).setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0),rng},hide:hide,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},reposition:function(){lastVisualCaret.on((function(caretState){var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);DomQuery(caretState.caret).css(__assign({},clientRect))}))},destroy:function(){return Delay.clearInterval(cursorInterval)}}},isFakeCaretTableBrowser=function(){return browser$2.isIE()||browser$2.isEdge()||browser$2.isFirefox()},isInlineFakeCaretTarget=function(node){return isContentEditableFalse$8(node)||isMedia$1(node)},isFakeCaretTarget=function(node){return isInlineFakeCaretTarget(node)||isTable$3(node)&&isFakeCaretTableBrowser()},isContentEditableFalse$7=isContentEditableFalse$b,isMedia=isMedia$2,isBlockLike=matchStyleValues("display","block table table-cell table-caption list-item"),isCaretContainer=isCaretContainer$2,isCaretContainerBlock=isCaretContainerBlock$1,isElement$1=isElement$5,isCaretCandidate$1=isCaretCandidate$3,isForwards=function(direction){return direction>0},isBackwards=function(direction){return direction<0},skipCaretContainers=function(walk,shallow){for(var node;node=walk(shallow);)if(!isCaretContainerBlock(node))return node;return null},findNode$1=function(node,direction,predicateFn,rootNode,shallow){var walker=new DomTreeWalker(node,rootNode),isCefOrCaretContainer=isContentEditableFalse$7(node)||isCaretContainerBlock(node);if(isBackwards(direction)){if(isCefOrCaretContainer&&predicateFn(node=skipCaretContainers(walker.prev.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.prev.bind(walker),shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if(isCefOrCaretContainer&&predicateFn(node=skipCaretContainers(walker.next.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.next.bind(walker),shallow);)if(predicateFn(node))return node}return null},getParentBlock$2=function(node,rootNode){for(;node&&node!==rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null},isInSameBlock=function(caretPosition1,caretPosition2,rootNode){return getParentBlock$2(caretPosition1.container(),rootNode)===getParentBlock$2(caretPosition2.container(),rootNode)},getChildNodeAtRelativeOffset=function(relativeOffset,caretPosition){if(!caretPosition)return null;var container=caretPosition.container(),offset=caretPosition.offset();return isElement$1(container)?container.childNodes[offset+relativeOffset]:null},beforeAfter=function(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range},isNodesInSameBlock=function(root,node1,node2){return getParentBlock$2(node1,root)===getParentBlock$2(node2,root)},lean=function(left,root,node){for(var siblingName=left?"previousSibling":"nextSibling";node&&node!==root;){var sibling=node[siblingName];if(isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse$7(sibling)||isMedia(sibling)){if(isNodesInSameBlock(root,sibling,node))return sibling;break}if(isCaretCandidate$1(sibling))break;node=node.parentNode}return null},before$2=curry(beforeAfter,!0),after$2=curry(beforeAfter,!1),normalizeRange=function(direction,root,range){var node,leanLeft=curry(lean,!0,root),leanRight=curry(lean,!1,root),container=range.startContainer,offset=range.startOffset;if(isCaretContainerBlock$1(container)){isElement$1(container)||(container=container.parentNode);var location_1=container.getAttribute("data-mce-caret");if("before"===location_1&&(node=container.nextSibling,isFakeCaretTarget(node)))return before$2(node);if("after"===location_1&&(node=container.previousSibling,isFakeCaretTarget(node)))return after$2(node)}if(!range.collapsed)return range;if(isText$7(container)){if(isCaretContainer(container)){if(1===direction){if(node=leanRight(container))return before$2(node);if(node=leanLeft(container))return after$2(node)}if(-1===direction){if(node=leanLeft(container))return after$2(node);if(node=leanRight(container))return before$2(node)}return range}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container))?before$2(node):range;if(startsWithCaretContainer$1(container)&&offset<=1)return-1===direction&&(node=leanLeft(container))?after$2(node):range;if(offset===container.data.length)return(node=leanRight(container))?before$2(node):range;if(0===offset)return(node=leanLeft(container))?after$2(node):range}return range},getRelativeCefElm=function(forward,caretPosition){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,caretPosition)).filter(isContentEditableFalse$7)},getNormalizedRangeEndPoint=function(direction,root,range){var normalizedRange=normalizeRange(direction,root,range);return-1===direction?CaretPosition.fromRangeStart(normalizedRange):CaretPosition.fromRangeEnd(normalizedRange)},getElementFromPosition=function(pos){return Optional.from(pos.getNode()).map(SugarElement.fromDom)},getVisualCaretPosition=function(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition},isMoveInsideSameBlock=function(from,to){var inSameBlock=isInSameBlock(from,to);return!(inSameBlock||!isBr$5(from.getNode()))||inSameBlock};!function(HDirection){HDirection[HDirection.Backwards=-1]="Backwards",HDirection[HDirection.Forwards=1]="Forwards"}(HDirection||(HDirection={}));var expected,isContentEditableFalse$6=isContentEditableFalse$b,isText$1=isText$7,isElement=isElement$5,isBr$1=isBr$5,isCaretCandidate=isCaretCandidate$3,isAtomic=function(node){return isAtomicInline(node)||function(node){return!!isNonUiContentEditableFalse(node)&&!0!==foldl(from(node.getElementsByTagName("*")),(function(result,elm){return result||isContentEditableTrue$3(elm)}),!1)}(node)},isEditableCaretCandidate=isEditableCaretCandidate$1,nodeAtIndex=function(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null},getCaretCandidatePosition=function(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$1(node.previousSibling))return CaretPosition.before(node);if(isText$1(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$1(node.nextSibling))return CaretPosition.after(node);if(isText$1(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr$1(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)},findCaretPosition$1=function(direction,startPos,root){var node,nextNode,innerNode,caretPosition;if(!isElement(root)||!startPos)return null;if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){if(caretPosition=CaretPosition.after(root.lastChild),isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement(root.lastChild))return isBr$1(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition}else caretPosition=startPos;var container=caretPosition.container(),offset=caretPosition.offset();if(isText$1(container)){if(isBackwards(direction)&&offset>0)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&offset>0&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode))?isText$1(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText$1(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate(nextNode)))return isBr$1(nextNode)?function(root,nextNode){var nextSibling=nextNode.nextSibling;return nextSibling&&isCaretCandidate(nextSibling)?isText$1(nextSibling)?CaretPosition(nextSibling,0):CaretPosition.before(nextSibling):findCaretPosition$1(HDirection.Forwards,CaretPosition.after(nextNode),root)}(root,nextNode):!isAtomic(nextNode)&&(innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode))?isText$1(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText$1(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=nextNode||caretPosition.getNode()}if((isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=findNode$1(node,direction,always,root,!0),isEditableCaretCandidate(node,root)))return getCaretCandidatePosition(direction,node);nextNode=findNode$1(node,direction,isEditableCaretCandidate,root);var rootContentEditableFalseElm=last$1(filter$4(function(node,root){for(var parents=[];node&&node!==root;)parents.push(node),node=node.parentNode;return parents}(container,root),isContentEditableFalse$6));return!rootContentEditableFalseElm||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm)},CaretWalker=function(root){return{next:function(caretPosition){return findCaretPosition$1(HDirection.Forwards,caretPosition,root)},prev:function(caretPosition){return findCaretPosition$1(HDirection.Backwards,caretPosition,root)}}},isBeforeOrStart=function(position){return CaretPosition.isTextPosition(position)?0===position.offset():isCaretCandidate$3(position.getNode())},isAfterOrEnd=function(position){if(CaretPosition.isTextPosition(position)){var container=position.container();return position.offset()===container.data.length}return isCaretCandidate$3(position.getNode(!0))},isBeforeAfterSameElement=function(from,to){return!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(!0)},shouldSkipPosition=function(forward,from,to){return forward?!isBeforeAfterSameElement(from,to)&&(position=from,!(!CaretPosition.isTextPosition(position)&&isBr$5(position.getNode())))&&isAfterOrEnd(from)&&isBeforeOrStart(to):!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to);var position},fromPosition=function(forward,root,pos){var walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos))},navigate=function(forward,root,from){return fromPosition(forward,root,from).bind((function(to){return isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)?fromPosition(forward,root,to):Optional.some(to)}))},navigateIgnore=function(forward,root,from,ignoreFilter){return navigate(forward,root,from).bind((function(pos){return ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos)}))},positionIn=function(forward,element){var node,startNode=forward?element.firstChild:element.lastChild;return isText$7(startNode)?Optional.some(CaretPosition(startNode,forward?0:startNode.data.length)):startNode?isCaretCandidate$3(startNode)?Optional.some(forward?CaretPosition.before(startNode):isBr$5(node=startNode)?CaretPosition.before(node):CaretPosition.after(node)):function(forward,root,start){var position=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,position)}(forward,element,startNode):Optional.none()},nextPosition=curry(fromPosition,!0),prevPosition=curry(fromPosition,!1),firstPositionIn=curry(positionIn,!0),lastPositionIn=curry(positionIn,!1),isCaretNode=function(node){return isElement$5(node)&&"_mce_caret"===node.id},getParentCaretContainer=function(body,node){for(;node&&node!==body;){if("_mce_caret"===node.id)return node;node=node.parentNode}return null},isPathBookmark=function(bookmark){return Tools.isArray(bookmark.start)},addBogus=function(dom,node){return isElement$5(node)&&dom.isBlock(node)&&!node.innerHTML&&!Env.ie&&(node.innerHTML='<br data-mce-bogus="1" />'),node},tryFindRangePosition=function(node,rng){return lastPositionIn(node).fold(never,(function(pos){return rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),!0}))},padEmptyCaretContainer=function(root,node,rng){return!(!function(node){return!1===node.hasChildNodes()}(node)||!getParentCaretContainer(root,node))&&(function(node,rng){var textNode=node.ownerDocument.createTextNode("\ufeff");node.appendChild(textNode),rng.setStart(textNode,0),rng.setEnd(textNode,0)}(node,rng),!0)},setEndPoint=function(dom,start,bookmark,rng){var i,node,offset,children,point=bookmark[start?"start":"end"],root=dom.getRoot();if(point){for(offset=point[0],node=root,i=point.length-1;i>=1;i--){if(children=node.childNodes,padEmptyCaretContainer(root,node,rng))return!0;if(point[i]>children.length-1)return!!padEmptyCaretContainer(root,node,rng)||tryFindRangePosition(node,rng);node=children[point[i]]}3===node.nodeType&&(offset=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0},isValidTextNode=function(node){return isText$7(node)&&node.data.length>0},restoreEndPoint=function(dom,suffix,bookmark){var node,idx,next,prev,container,offset,marker=dom.get(bookmark.id+"_"+suffix),keep=bookmark.keep;if(marker){if(node=marker.parentNode,"start"===suffix?(keep?marker.hasChildNodes()?(node=marker.firstChild,idx=1):isValidTextNode(marker.nextSibling)?(node=marker.nextSibling,idx=0):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,idx=marker.previousSibling.data.length):(node=marker.parentNode,idx=dom.nodeIndex(marker)+1):idx=dom.nodeIndex(marker),container=node,offset=idx):(keep?marker.hasChildNodes()?(node=marker.firstChild,idx=1):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,idx=marker.previousSibling.data.length):(node=marker.parentNode,idx=dom.nodeIndex(marker)):idx=dom.nodeIndex(marker),container=node,offset=idx),!keep){for(prev=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),(function(node){isText$7(node)&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))}));marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,!0);prev&&next&&prev.nodeType===next.nodeType&&isText$7(prev)&&!Env.opera&&(idx=prev.nodeValue.length,prev.appendData(next.nodeValue),dom.remove(next),container=prev,offset=idx)}return Optional.some(CaretPosition(container,offset))}return Optional.none()},resolve$1=function(selection,bookmark){var dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark))return function(dom,bookmark){var rng=dom.createRng();return setEndPoint(dom,!0,bookmark,rng)&&setEndPoint(dom,!1,bookmark,rng)?Optional.some(rng):Optional.none()}(dom,bookmark);if(function(bookmark){return isString$1(bookmark.start)}(bookmark))return Optional.some(function(dom,bookmark){var pos,rng=dom.createRng();return pos=resolve$2(dom.getRoot(),bookmark.start),rng.setStart(pos.container(),pos.offset()),pos=resolve$2(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng}(dom,bookmark));if(function(bookmark){return has$2(bookmark,"id")}(bookmark))return function(dom,bookmark){var startPos=restoreEndPoint(dom,"start",bookmark),endPos=restoreEndPoint(dom,"end",bookmark);return lift2(startPos,endPos.or(startPos),(function(spos,epos){var rng=dom.createRng();return rng.setStart(addBogus(dom,spos.container()),spos.offset()),rng.setEnd(addBogus(dom,epos.container()),epos.offset()),rng}))}(dom,bookmark);if(function(bookmark){return has$2(bookmark,"name")}(bookmark))return function(dom,bookmark){return Optional.from(dom.select(bookmark.name)[bookmark.index]).map((function(elm){var rng=dom.createRng();return rng.selectNode(elm),rng}))}(dom,bookmark);if(function(bookmark){return has$2(bookmark,"rng")}(bookmark))return Optional.some(bookmark.rng)}return Optional.none()},getBookmark$1=function(selection,type,normalized){return getBookmark$2(selection,type,normalized)},moveToBookmark=function(selection,bookmark){resolve$1(selection,bookmark).each((function(rng){selection.setRng(rng)}))},isBookmarkNode$1=function(node){return isElement$5(node)&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},isNbsp=(expected="Â ",function(actual){return expected===actual}),isWhiteSpace=function(chr){return""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr)},isContent=function(chr){return!isWhiteSpace(chr)&&!isNbsp(chr)},isNode=function(node){return!!node.nodeType},moveStart=function(dom,selection,rng){var offset=rng.startOffset,container=rng.startContainer;if((container!==rng.endContainer||!function(node){return node&&/^(IMG)$/.test(node.nodeName)}(container.childNodes[offset]))&&isElement$5(container)){var nodes=container.childNodes,walker=void 0;offset<nodes.length?(container=nodes[offset],walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))):(container=nodes[nodes.length-1],(walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))).next(!0));for(var node=walker.current();node;node=walker.next())if(isText$7(node)&&!isWhiteSpaceNode$1(node))return rng.setStart(node,0),void selection.setRng(rng)}},getNonWhiteSpaceSibling=function(node,next,inc){if(node){var nextName=next?"nextSibling":"previousSibling";for(node=inc?node:node[nextName];node;node=node[nextName])if(isElement$5(node)||!isWhiteSpaceNode$1(node))return node}},isTextBlock$1=function(editor,name){return isNode(name)&&(name=name.nodeName),!!editor.schema.getTextBlockElements()[name.toLowerCase()]},isValid=function(ed,parent,child){return ed.schema.isValidChild(parent,child)},isWhiteSpaceNode$1=function(node,allowSpaces){if(void 0===allowSpaces&&(allowSpaces=!1),isNonNullable(node)&&isText$7(node)){var data=allowSpaces?node.data.replace(/ /g,"Â "):node.data;return isWhitespaceText(data)}return!1},replaceVars=function(value,vars){return isFunction(value)?value=value(vars):isNonNullable(vars)&&(value=value.replace(/%(\w+)/g,(function(str,name){return vars[name]||str}))),value},isEq$5=function(str1,str2){return str2=str2||"",str1=""+((str1=str1||"").nodeName||str1),str2=""+(str2.nodeName||str2),str1.toLowerCase()===str2.toLowerCase()},normalizeStyleValue=function(dom,value,name){return"color"!==name&&"backgroundColor"!==name||(value=dom.toHex(value)),"fontWeight"===name&&700===value&&(value="bold"),"fontFamily"===name&&(value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+value},getStyle=function(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name)},getTextDecoration=function(dom,node){var decoration;return dom.getParent(node,(function(n){return(decoration=dom.getStyle(n,"text-decoration"))&&"none"!==decoration})),decoration},getParents$2=function(dom,node,selector){return dom.getParents(node,selector,dom.getRoot())},areSimilarFormats=function(editor,formatName,otherFormatName){var validKeys=["inline","block","selector","attributes","styles","classes"],filterObj=function(format){return filter$3(format,(function(_,key){return exists(validKeys,(function(validKey){return validKey===key}))}))};return exists(editor.formatter.get(formatName),(function(fmt1){var filteredFmt1=filterObj(fmt1);return exists(editor.formatter.get(otherFormatName),(function(fmt2){var filteredFmt2=filterObj(fmt2);return function(a1,a2,eq){return void 0===eq&&(eq=eqAny),eqRecord(eq).eq(a1,a2)}(filteredFmt1,filteredFmt2)}))}))},isBlockFormat=function(format){return hasNonNullableKey(format,"block")},isSelectorFormat=function(format){return hasNonNullableKey(format,"selector")},isInlineFormat=function(format){return hasNonNullableKey(format,"inline")},shouldExpandToSelector=function(format){return isSelectorFormat(format)&&!1!==format.expand&&!isInlineFormat(format)},isBookmarkNode=isBookmarkNode$1,getParents$1=getParents$2,isWhiteSpaceNode=isWhiteSpaceNode$1,isTextBlock=isTextBlock$1,findParentContentEditable=function(dom,node){for(var parent=node;parent;){if(isElement$5(parent)&&dom.getContentEditable(parent))return"false"===dom.getContentEditable(parent)?parent:node;parent=parent.parentNode}return node},walkText=function(start,node,offset,predicate){for(var str=node.data,i=offset;start?i>=0:i<str.length;start?i--:i++)if(predicate(str.charAt(i)))return start?i+1:i;return-1},findSpace=function(start,node,offset){return walkText(start,node,offset,(function(c){return isNbsp(c)||isWhiteSpace(c)}))},findContent=function(start,node,offset){return walkText(start,node,offset,isContent)},findWordEndPoint=function(dom,body,container,offset,start,includeTrailingSpaces){var lastTextNode,rootNode=dom.getParent(container,dom.isBlock)||body,walk=function(container,offset,pred){var textSeeker=TextSeeker(dom),walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,(function(text,textOffset){return isBookmarkNode(text.parentNode)?-1:(lastTextNode=text,pred(start,text,textOffset))}),rootNode))};return walk(container,offset,findSpace).bind((function(result){return includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result)})).orThunk((function(){return lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none()}))},findSelectorEndPoint=function(dom,formatList,rng,container,siblingName){isText$7(container)&&isEmpty$3(container.data)&&container[siblingName]&&(container=container[siblingName]);for(var parents=getParents$1(dom,container),i=0;i<parents.length;i++)for(var y=0;y<formatList.length;y++){var curFormat=formatList[y];if((!isNonNullable(curFormat.collapsed)||curFormat.collapsed===rng.collapsed)&&(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)))return parents[i]}return container},findBlockEndPoint=function(editor,formatList,container,siblingName){var node=container,dom=editor.dom,root=dom.getRoot(),format=formatList[0];if(isBlockFormat(format)&&(node=format.wrapper?null:dom.getParent(container,format.block,root)),!node){var scopeRoot=dom.getParent(container,"LI,TD,TH");node=dom.getParent(isText$7(container)?container.parentNode:container,(function(node){return node!==root&&isTextBlock(editor,node)}),scopeRoot)}if(node&&isBlockFormat(format)&&format.wrapper&&(node=getParents$1(dom,node,"ul,ol").reverse()[0]||node),!node)for(node=container;node[siblingName]&&!dom.isBlock(node[siblingName])&&(node=node[siblingName],!isEq$5(node,"br")););return node||container},isAtBlockBoundary$1=function(dom,root,container,siblingName){var parent=container.parentNode;return!isNonNullable(container[siblingName])&&(!(parent!==root&&!isNullable(parent)&&!dom.isBlock(parent))||isAtBlockBoundary$1(dom,root,parent,siblingName))},findParentContainer=function(dom,formatList,container,offset,start){var node,parent=container,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot();if(isText$7(container)&&!isWhiteSpaceNode(container)&&(start?offset>0:offset<container.data.length))return container;for(;;){if(!formatList[0].block_expand&&dom.isBlock(parent))return parent;for(var sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){var allowSpaces=isText$7(sibling)&&!isAtBlockBoundary$1(dom,root,sibling,siblingName);if(!isBookmarkNode(sibling)&&(!isBr$5(node=sibling)||!node.getAttribute("data-mce-bogus")||node.nextSibling)&&!isWhiteSpaceNode(sibling,allowSpaces))return parent}if(parent===root||parent.parentNode===root){container=parent;break}parent=parent.parentNode}return container},isSelfOrParentBookmark=function(container){return isBookmarkNode(container.parentNode)||isBookmarkNode(container)},expandRng=function(editor,rng,formatList,includeTrailingSpace){void 0===includeTrailingSpace&&(includeTrailingSpace=!1);var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,dom=editor.dom,format=formatList[0];(isElement$5(startContainer)&&startContainer.hasChildNodes()&&(startContainer=getNode$1(startContainer,startOffset),isText$7(startContainer)&&(startOffset=0)),isElement$5(endContainer)&&endContainer.hasChildNodes()&&(endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1),isText$7(endContainer)&&(endOffset=endContainer.nodeValue.length)),startContainer=findParentContentEditable(dom,startContainer),endContainer=findParentContentEditable(dom,endContainer),isSelfOrParentBookmark(startContainer)&&(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode,startContainer=rng.collapsed?startContainer.previousSibling||startContainer:startContainer.nextSibling||startContainer,isText$7(startContainer)&&(startOffset=rng.collapsed?startContainer.length:0)),isSelfOrParentBookmark(endContainer)&&(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode,endContainer=rng.collapsed?endContainer.nextSibling||endContainer:endContainer.previousSibling||endContainer,isText$7(endContainer)&&(endOffset=rng.collapsed?0:endContainer.length)),rng.collapsed)&&(findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,!0,includeTrailingSpace).each((function(_a){var container=_a.container,offset=_a.offset;startContainer=container,startOffset=offset})),findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,!1,includeTrailingSpace).each((function(_a){var container=_a.container,offset=_a.offset;endContainer=container,endOffset=offset})));return(isInlineFormat(format)||format.block_expand)&&(isInlineFormat(format)&&isText$7(startContainer)&&0!==startOffset||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),isInlineFormat(format)&&isText$7(endContainer)&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1))),shouldExpandToSelector(format)&&(startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,"previousSibling"),endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,"nextSibling")),(isBlockFormat(format)||isSelectorFormat(format))&&(startContainer=findBlockEndPoint(editor,formatList,startContainer,"previousSibling"),endContainer=findBlockEndPoint(editor,formatList,endContainer,"nextSibling"),isBlockFormat(format)&&(dom.isBlock(startContainer)||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),dom.isBlock(endContainer)||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1)))),isElement$5(startContainer)&&(startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),isElement$5(endContainer)&&(endOffset=dom.nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},walk$2=function(dom,rng,callback){var startOffset=rng.startOffset,startContainer=getNode$1(rng.startContainer,startOffset),endOffset=rng.endOffset,endContainer=getNode$1(rng.endContainer,endOffset-1),exclude=function(nodes){var firstNode=nodes[0];isText$7(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length&&nodes.splice(0,1);var lastNode=nodes[nodes.length-1];return 0===endOffset&&nodes.length>0&&lastNode===endContainer&&isText$7(lastNode)&&nodes.splice(nodes.length-1,1),nodes},collectSiblings=function(node,name,endNode){for(var siblings=[];node&&node!==endNode;node=node[name])siblings.push(node);return siblings},findEndPoint=function(node,root){return dom.getParent(node,(function(node){return node.parentNode===root}),root)},walkBoundary=function(startNode,endNode,next){for(var siblingName=next?"nextSibling":"previousSibling",node=startNode,parent_1=node.parentNode;node&&node!==endNode;node=parent_1){parent_1=node.parentNode;var siblings_1=collectSiblings(node===startNode?node:node[siblingName],siblingName);siblings_1.length&&(next||siblings_1.reverse(),callback(exclude(siblings_1)))}};if(startContainer===endContainer)return callback(exclude([startContainer]));var ancestor=dom.findCommonAncestor(startContainer,endContainer);if(dom.isChildOf(startContainer,endContainer))return walkBoundary(startContainer,ancestor,!0);if(dom.isChildOf(endContainer,startContainer))return walkBoundary(endContainer,ancestor);var startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,!0);var siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint===endContainer?endPoint.nextSibling:endPoint);siblings.length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)},getRanges=function(selection){var ranges=[];if(selection)for(var i=0;i<selection.rangeCount;i++)ranges.push(selection.getRangeAt(i));return ranges},getCellsFromRanges=function(ranges){return filter$4(function(ranges){return bind(ranges,(function(range){var node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[]}))}(ranges),isTableCell$4)},getCellsFromElementOrRanges=function(ranges,element){var selectedCells=descendants(element,"td[data-mce-selected],th[data-mce-selected]");return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges)},getCellsFromEditor=function(editor){return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()))},getClosestTable=function(cell,isRoot){return ancestor$2(cell,"table",isRoot)},getFirstChildren=function(node){return firstChild(node).fold(constant([node]),(function(child){return[node].concat(getFirstChildren(child))}))},getLastChildren$1=function(node){return lastChild(node).fold(constant([node]),(function(child){return"br"===name(child)?prevSibling(child).map((function(sibling){return[node].concat(getLastChildren$1(sibling))})).getOr([]):[node].concat(getLastChildren$1(child))}))},hasAllContentsSelected=function(elm,rng){return lift2(function(rng){var sc=rng.startContainer,so=rng.startOffset;return isText$7(sc)?0===so?Optional.some(SugarElement.fromDom(sc)):Optional.none():Optional.from(sc.childNodes[so]).map(SugarElement.fromDom)}(rng),function(rng){var ec=rng.endContainer,eo=rng.endOffset;return isText$7(ec)?eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none():Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom)}(rng),(function(startNode,endNode){var start=find$3(getFirstChildren(elm),curry(eq,startNode)),end=find$3(getLastChildren$1(elm),curry(eq,endNode));return start.isSome()&&end.isSome()})).getOr(!1)},moveEndPoint=function(dom,rng,node,start){var root=node,walker=new DomTreeWalker(node,root),moveCaretBeforeOnEnterElementsMap=filter$3(dom.schema.getMoveCaretBeforeOnEnterElements(),(function(_,name){return!contains$3(["td","th","table"],name.toLowerCase())}));do{if(isText$7(node)&&0!==Tools.trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(moveCaretBeforeOnEnterElementsMap[node.nodeName])return void(start?rng.setStartBefore(node):"BR"===node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node))}while(node=start?walker.next():walker.prev());"BODY"===root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},hasAnyRanges=function(editor){var sel=editor.selection.getSel();return sel&&sel.rangeCount>0},runOnRanges=function(editor,executor){var fakeSelectionNodes=getCellsFromEditor(editor);fakeSelectionNodes.length>0?each$k(fakeSelectionNodes,(function(elem){var node=elem.dom,fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node),fakeNodeRng.setEndAfter(node),executor(fakeNodeRng,!0)})):executor(editor.selection.getRng(),!1)},preserve=function(selection,fillBookmark,executor){var bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark),selection.moveToBookmark(bookmark)},api$1=function(is,name){var getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()};return{get:function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText$8,"text"),get$2=function(element){return api$1.get(element)},context=function(editor,elem,wrapName,nodeName){return parent(elem).fold((function(){return"skipping"}),(function(parent){return"br"===nodeName||function(elem){return isText$8(elem)&&"\ufeff"===get$2(elem)}(elem)?"valid":function(elem){return isElement$6(elem)&&has(elem,annotation())}(elem)?"existing":isCaretNode(elem.dom)?"caret":isValid(editor,wrapName,nodeName)&&isValid(editor,name(parent),wrapName)?"valid":"invalid-child"}))},makeAnnotation=function(eDoc,_a,annotationName,decorate){var _b=_a.uid,uid=void 0===_b?generate("mce-annotation"):_b,data=function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}(_a,["uid"]),master=SugarElement.fromTag("span",eDoc);add$1(master,annotation()),set$1(master,""+dataAnnotationId(),uid),set$1(master,""+dataAnnotation(),annotationName);var _c=decorate(uid,data),_d=_c.attributes,attributes=void 0===_d?{}:_d,_e=_c.classes,classes=void 0===_e?[]:_e;return setAll$1(master,attributes),function(element,classes){each$k(classes,(function(x){add$1(element,x)}))}(master,classes),master},annotate=function(editor,rng,annotationName,decorate,data){var newWrappers=[],master=makeAnnotation(editor.getDoc(),data,annotationName,decorate),wrapper=value(),finishWrapper=function(){wrapper.clear()},processElements=function(elems){each$k(elems,processElement)},processElement=function(elem){switch(context(editor,elem,"span",name(elem))){case"invalid-child":finishWrapper();var children$1=children(elem);processElements(children$1),finishWrapper();break;case"valid":!function(element,wrapper){before$4(element,wrapper),append$1(wrapper,element)}(elem,wrapper.get().getOrThunk((function(){var nu=shallow(master);return newWrappers.push(nu),wrapper.set(nu),nu})))}};return walk$2(editor.dom,rng,(function(nodes){finishWrapper(),function(nodes){var elems=map$3(nodes,SugarElement.fromDom);processElements(elems)}(nodes)})),newWrappers},annotateWithBookmark=function(editor,name,settings,data){editor.undoManager.transact((function(){var selection=editor.selection,initialRng=selection.getRng(),hasFakeSelection=getCellsFromEditor(editor).length>0;if(initialRng.collapsed&&!hasFakeSelection&&function(editor,rng){var r=expandRng(editor,rng,[{inline:"span"}]);rng.setStart(r.startContainer,r.startOffset),rng.setEnd(r.endContainer,r.endOffset),editor.selection.setRng(rng)}(editor,initialRng),selection.getRng().collapsed&&!hasFakeSelection){var wrapper=makeAnnotation(editor.getDoc(),data,name,settings.decorate);set(wrapper,"Â "),selection.getRng().insertNode(wrapper.dom),selection.select(wrapper.dom)}else preserve(selection,!1,(function(){runOnRanges(editor,(function(selectionRng){annotate(editor,selectionRng,name,settings.decorate,data)}))}))}))},Annotator=function(editor){var annotations,registry=(annotations={},{register:function(name,settings){annotations[name]={name:name,settings:settings}},lookup:function(name){return get$9(annotations,name).map((function(a){return a.settings}))}});setup$m(editor,registry);var changes=setup$n(editor);return{register:function(name,settings){registry.register(name,settings)},annotate:function(name,data){registry.lookup(name).each((function(settings){annotateWithBookmark(editor,name,settings,data)}))},annotationChanged:function(name,callback){changes.addListener(name,callback)},remove:function(name){identify(editor,Optional.some(name)).each((function(_a){var elements=_a.elements;each$k(elements,unwrap)}))},getAll:function(name){var directory=function(editor,name){var body=SugarElement.fromDom(editor.getBody()),markers=descendants(body,"["+dataAnnotation()+'="'+name+'"]'),directory={};return each$k(markers,(function(m){var uid=get$6(m,dataAnnotationId()),nodesAlready=get$9(directory,uid).getOr([]);directory[uid]=nodesAlready.concat([m])})),directory}(editor,name);return map$2(directory,(function(elems){return map$3(elems,(function(elem){return elem.dom}))}))}}},BookmarkManager=function(selection){return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)}};BookmarkManager.isBookmarkNode=isBookmarkNode$1;var getContentEditableRoot$1=function(root,node){for(;node&&node!==root;){if(isContentEditableTrue$4(node)||isContentEditableFalse$b(node))return node;node=node.parentNode}return null},isXYWithinRange=function(clientX,clientY,range){if(range.collapsed)return!1;if(Env.browser.isIE()&&range.startOffset===range.endOffset-1&&range.startContainer===range.endContainer){var elm=range.startContainer.childNodes[range.startOffset];if(isElement$5(elm))return exists(elm.getClientRects(),(function(rect){return containsXY(rect,clientX,clientY)}))}return exists(range.getClientRects(),(function(rect){return containsXY(rect,clientX,clientY)}))},fireError=function(editor,errorType,error){return editor.fire(errorType,error)},fireFormatApply=function(editor,format,node,vars){return editor.fire("FormatApply",{format:format,node:node,vars:vars})},fireFormatRemove=function(editor,format,node,vars){return editor.fire("FormatRemove",{format:format,node:node,vars:vars})},VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}},isContentEditableFalse$5=isContentEditableFalse$b,ControlSelection=function(selection,editor){var selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop,startX,startY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight,dom=editor.dom,each=Tools.each,editableDoc=editor.getDoc(),rootDocument=document,abs=Math.abs,round=Math.round,rootElement=editor.getBody(),resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},isImage=function(elm){return elm&&("IMG"===elm.nodeName||editor.dom.is(elm,"figure.image"))},isMedia=function(elm){return isMedia$2(elm)||dom.hasClass(elm,"mce-preview-object")},contextMenuSelectImage=function(evt){var target=evt.target;(function(evt,range){if("longpress"===evt.type||0===evt.type.indexOf("touch")){var touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range)}return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range)})(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()&&editor.selection.select(target)},getResizeTargets=function(elm){return dom.is(elm,"figure.image")?[elm.querySelector("img")]:dom.hasClass(elm,"mce-preview-object")&&isNonNullable(elm.firstElementChild)?[elm,elm.firstElementChild]:[elm]},isResizable=function(elm){var selector=getObjectResizing(editor);return!!selector&&("false"!==elm.getAttribute("data-mce-resize")&&(elm!==editor.getBody()&&(dom.hasClass(elm,"mce-preview-object")?is$2(SugarElement.fromDom(elm.firstElementChild),selector):is$2(SugarElement.fromDom(elm),selector))))},setSizeProp=function(element,name,value){if(isNonNullable(value)){var targets=getResizeTargets(element);each$k(targets,(function(target){target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)?dom.setStyle(target,name,value):dom.setAttrib(target,name,""+value)}))}},setGhostElmSize=function(ghostElm,width,height){setSizeProp(ghostElm,"width",width),setSizeProp(ghostElm,"height",height)},resizeGhostElement=function(e){var deltaX,deltaY,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,((isImage(selectedElm)||isMedia(selectedElm))&&!1!==function(editor){return editor.getParam("resize_img_proportional",!0,"boolean")}(editor)?!VK.modifierPressed(e):VK.modifierPressed(e))&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),setGhostElmSize(selectedElmGhost,width,height),resizeHelperX=(resizeHelperX=selectedHandle.startPos.x+deltaX)>0?resizeHelperX:0,resizeHelperY=(resizeHelperY=selectedHandle.startPos.y+deltaY)>0?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",undefined+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",undefined+(startH-height)),(deltaX=rootElement.scrollWidth-startScrollWidth)+(deltaY=rootElement.scrollHeight-startScrollHeight)!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(!function(editor,target,width,height,origin){editor.fire("ObjectResizeStart",{target:target,width:width,height:height,origin:origin})}(editor,selectedElm,startW,startH,"corner-"+selectedHandle.name),resizeStarted=!0)},endGhostResize=function(){var wasResizeStarted=resizeStarted;resizeStarted=!1,wasResizeStarted&&(setSizeProp(selectedElm,"width",width),setSizeProp(selectedElm,"height",height)),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),dom.remove(resizeBackdrop),showResizeRect(selectedElm),wasResizeStarted&&(!function(editor,target,width,height,origin){editor.fire("ObjectResized",{target:target,width:width,height:height,origin:origin})}(editor,selectedElm,width,height,"corner-"+selectedHandle.name),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style"))),editor.nodeChanged()},showResizeRect=function(targetElm){unbindResizeHandleEvents();var position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top;selectedElm!==targetElm&&(hideResizeRect(),selectedElm=targetElm,width=height=0);var e=editor.fire("ObjectSelected",{target:targetElm}),selectedValue=dom.getAttrib(selectedElm,"data-mce-selected","1");isResizable(targetElm)&&!e.isDefaultPrevented()?each(resizeHandles,(function(handle,name){var handleElm,startDrag=function(e){var elm,target=getResizeTargets(selectedElm)[0];startX=e.screenX,startY=e.screenY,startW=target.clientWidth,startH=target.clientHeight,ratio=startH/startW,(selectedHandle=handle).name=name,selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,resizeBackdrop=dom.add(rootElement,"div",{class:"mce-resize-backdrop","data-mce-bogus":"all"}),dom.setStyles(resizeBackdrop,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}),selectedElmGhost=isMedia(elm=selectedElm)?dom.create("img",{src:Env.transparentSrc}):elm.cloneNode(!0),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable="false",dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),setGhostElmSize(selectedElmGhost,targetWidth,targetHeight),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)};(handleElm=dom.get("mceResizeHandle"+name))&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),11===Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",(function(e){e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)})),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2})})):hideResizeRect(),dom.getAttrib(selectedElm,"data-mce-selected")||selectedElm.setAttribute("data-mce-selected",selectedValue)},hideResizeRect=function(){unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute("data-mce-selected"),each$j(resizeHandles,(function(value,name){var handleElm=dom.get("mceResizeHandle"+name);handleElm&&(dom.unbind(handleElm),dom.remove(handleElm))}))},updateResizeRect=function(e){var controlElm,isChildOrEqual=function(node,parent){if(node)do{if(node===parent)return!0}while(node=node.parentNode)};resizeStarted||editor.removed||(each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),(function(img){img.removeAttribute("data-mce-selected")})),controlElm="mousedown"===e.type?e.target:selection.getNode(),isChildOrEqual(controlElm=dom.$(controlElm).closest("table,img,figure.image,hr,video,span.mce-preview-object")[0],rootElement)&&(disableGeckoResize(),isChildOrEqual(selection.getStart(!0),controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm))?showResizeRect(controlElm):hideResizeRect())},isWithinContentEditableFalse=function(elm){return isContentEditableFalse$5(getContentEditableRoot$1(editor.getBody(),elm))},unbindResizeHandleEvents=function(){each$j(resizeHandles,(function(handle){handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}))},disableGeckoResize=function(){try{editor.getDoc().execCommand("enableObjectResizing",!1,"false")}catch(ex){}};editor.on("init",(function(){if(disableGeckoResize(),Env.browser.isIE()||Env.browser.isEdge()){editor.on("mousedown click",(function(e){var target=e.target,nodeName=target.nodeName;resizeStarted||!/^(TABLE|IMG|HR)$/.test(nodeName)||isWithinContentEditableFalse(target)||(2!==e.button&&editor.selection.select(target,"TABLE"===nodeName),"mousedown"===e.type&&editor.nodeChanged())}));var handleMSControlSelect_1=function(e){var delayedSelect=function(node){Delay.setEditorTimeout(editor,(function(){return editor.selection.select(node)}))};if(isWithinContentEditableFalse(e.target)||isMedia$2(e.target))return e.preventDefault(),void delayedSelect(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"===e.target.tagName&&delayedSelect(e.target))};dom.bind(rootElement,"mscontrolselect",handleMSControlSelect_1),editor.on("remove",(function(){return dom.unbind(rootElement,"mscontrolselect",handleMSControlSelect_1)}))}var throttledUpdateResizeRect=Delay.throttle((function(e){editor.composing||updateResizeRect(e)}));editor.on("nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged",throttledUpdateResizeRect),editor.on("keyup compositionend",(function(e){selectedElm&&"TABLE"===selectedElm.nodeName&&throttledUpdateResizeRect(e)})),editor.on("hide blur",hideResizeRect),editor.on("contextmenu longpress",contextMenuSelectImage,!0)})),editor.on("remove",unbindResizeHandleEvents);return{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,destroy:function(){selectedElm=selectedElmGhost=resizeBackdrop=null}}},hasCeProperty=function(node){return isContentEditableTrue$4(node)||isContentEditableFalse$b(node)},fromPoint=function(clientX,clientY,doc){var rng,point,pointDoc=doc;if(pointDoc.caretPositionFromPoint)(point=pointDoc.caretPositionFromPoint(clientX,clientY))&&((rng=doc.createRange()).setStart(point.offsetNode,point.offset),rng.collapse(!0));else if(pointDoc.caretRangeFromPoint)rng=pointDoc.caretRangeFromPoint(clientX,clientY);else if(pointDoc.body.createTextRange){rng=pointDoc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=function(clientX,clientY,doc){var rects,element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange();if(element&&"HTML"!==element.tagName||(element=doc.body),rng.moveToElementText(element),(rects=(rects=Tools.toArray(rng.getClientRects())).sort((function(a,b){return(a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)))-Math.abs(Math.max(b.top-clientY,b.bottom-clientY))}))).length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null}(clientX,clientY,doc)}return function(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse$b(function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}(parentElement,rootNode,hasCeProperty))?null:rng}(rng,doc.body)}return rng},isEq$4=function(rng1,rng2){return rng1&&rng2&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset},hasParent$1=function(node,rootNode,predicate){return null!==function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}(node,rootNode,predicate)},hasParentWithName=function(node,rootNode,name){return hasParent$1(node,rootNode,(function(node){return node.nodeName===name}))},isTable=function(node){return node&&"TABLE"===node.nodeName},isTableCell$2=function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)},isCeFalseCaretContainer=function(node,rootNode){return isCaretContainer$2(node)&&!1===hasParent$1(node,rootNode,isCaretNode)},hasBrBeforeAfter=function(dom,node,left){for(var walker=new DomTreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());node=walker[left?"prev":"next"]();)if(isBr$5(node))return!0},findTextNodeRelative=function(dom,isAfterNode,collapsed,left,startNode){var lastInlineElement,node,body=dom.getRoot(),nonEmptyElementsMap=dom.schema.getNonEmptyElements(),parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&isBr$5(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer))return Optional.some(CaretPosition(startNode.parentNode,dom.nodeIndex(startNode)));for(var walker=new DomTreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCeFalseCaretContainer(node,body))return Optional.none();if(isText$7(node)&&node.nodeValue.length>0)return!1===hasParentWithName(node,body,"A")?Optional.some(CaretPosition(node,left?node.nodeValue.length:0)):Optional.none();if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return Optional.none();lastInlineElement=node}return collapsed&&lastInlineElement?Optional.some(CaretPosition(lastInlineElement,0)):Optional.none()},normalizeEndPoint=function(dom,collapsed,start,rng){var container,offset,node,directionLeft,body=dom.getRoot(),normalized=!1;container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"];var isAfterNode=isElement$5(container)&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements();if(directionLeft=start,isCaretContainer$2(container))return Optional.none();if(isElement$5(container)&&offset>container.childNodes.length-1&&(directionLeft=!1),isDocument$1(container)&&(container=body,offset=0),container===body){if(directionLeft&&(node=container.childNodes[offset>0?offset-1:0])){if(isCaretContainer$2(node))return Optional.none();if(nonEmptyElementsMap[node.nodeName]||isTable(node))return Optional.none()}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=isText$7(container)&&isAfterNode?container.data.length:0,!collapsed&&container===body.lastChild&&isTable(container))return Optional.none();if(function(body,node){for(;node&&node!==body;){if(isContentEditableFalse$b(node))return!0;node=node.parentNode}return!1}(body,container)||isCaretContainer$2(container))return Optional.none();if(container.hasChildNodes()&&!1===isTable(container)){node=container;var walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=!1;break}if(isText$7(node)&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell$2(node)){offset=dom.nodeIndex(node),container=node.parentNode,directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}return collapsed&&(isText$7(container)&&0===offset&&findTextNodeRelative(dom,isAfterNode,collapsed,!0,container).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),isElement$5(container)&&((node=container.childNodes[offset])||(node=container.childNodes[offset-1]),!node||!isBr$5(node)||function(node,name){return node.previousSibling&&node.previousSibling.nodeName===name}(node,"A")||hasBrBeforeAfter(dom,node,!1)||hasBrBeforeAfter(dom,node,!0)||findTextNodeRelative(dom,isAfterNode,collapsed,!0,node).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})))),directionLeft&&!collapsed&&isText$7(container)&&offset===container.nodeValue.length&&findTextNodeRelative(dom,isAfterNode,collapsed,!1,container).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),normalized?Optional.some(CaretPosition(container,offset)):Optional.none()},normalize$2=function(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange(),startPos=CaretPosition.fromRangeStart(rng);return normalizeEndPoint(dom,collapsed,!0,normRng).each((function(pos){collapsed&&CaretPosition.isAbove(startPos,pos)||normRng.setStart(pos.container(),pos.offset())})),collapsed||normalizeEndPoint(dom,collapsed,!1,normRng).each((function(pos){normRng.setEnd(pos.container(),pos.offset())})),collapsed&&normRng.collapse(!0),isEq$4(rng,normRng)?Optional.none():Optional.some(normRng)},splitText=function(node,offset){return node.splitText(offset)},split=function(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return startContainer===endContainer&&isText$7(startContainer)?startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=(endContainer=splitText(startContainer,startOffset)).previousSibling,endOffset>startOffset?(startContainer=endContainer=splitText(endContainer,endOffset-=startOffset).previousSibling,endOffset=endContainer.nodeValue.length,startOffset=0):endOffset=0):(isText$7(startContainer)&&startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),isText$7(endContainer)&&endOffset>0&&endOffset<endContainer.nodeValue.length&&(endOffset=(endContainer=splitText(endContainer,endOffset).previousSibling).nodeValue.length)),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},RangeUtils=function(dom){return{walk:function(rng,callback){return walk$2(dom,rng,callback)},split:split,normalize:function(rng){return normalize$2(dom,rng).fold(never,(function(normalizedRng){return rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset),rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset),!0}))}}};RangeUtils.compareRanges=isEq$4,RangeUtils.getCaretRangeFromPoint=fromPoint,RangeUtils.getSelectedNode=getSelectedNode,RangeUtils.getNode=getNode$1;var documentFocusInHandler,api=function(name,getOffset){var get=function(element){var r=getOffset(element);if(r<=0||null===r){var css=get$5(element,name);return parseFloat(css)||0}return r},aggregate=function(element,properties){return foldl(properties,(function(acc,property){var val=get$5(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0)};return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);var dom=element.dom;isSupported(dom)&&(dom.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:function(element,value,properties){var cumulativeInclusions=aggregate(element,properties);return value>cumulativeInclusions?value-cumulativeInclusions:0}}}("height",(function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),walkUp=function(navigation,doc){return navigation.view(doc).fold(constant([]),(function(f){var parent=navigation.owner(f),rest=walkUp(navigation,parent);return[f].concat(rest)}))},Navigation=Object.freeze({__proto__:null,view:function(doc){var _a;return(doc.dom===document?Optional.none():Optional.from(null===(_a=doc.dom.defaultView)||void 0===_a?void 0:_a.frameElement)).map(SugarElement.fromDom)},owner:function(element){return documentOrOwner(element)}}),find$1=function(element){var doc=SugarElement.fromDom(document),scroll=get$8(doc),frames=function(element,navigation){var d=navigation.owner(element);return walkUp(navigation,d)}(element,Navigation),offset=viewport(element),r=foldr(frames,(function(b,a){var loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top}}),{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top)},excludeFromDescend=function(element){return"textarea"===name(element)},markerInfo=function(element,cleanupFun){var pos=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)}(element),height=function(element){return api.get(element)}(element);return{element:element,bottom:pos.top+height,height:height,pos:pos,cleanup:cleanupFun}},createMarker=function(element,offset){var startPoint=function(element,offset){var children$1=children(element);if(0===children$1.length||excludeFromDescend(element))return{element:element,offset:offset};if(offset<children$1.length&&!excludeFromDescend(children$1[offset]))return{element:children$1[offset],offset:0};var last=children$1[children$1.length-1];return excludeFromDescend(last)?{element:element,offset:offset}:"img"===name(last)?{element:last,offset:1}:isText$8(last)?{element:last,offset:get$2(last).length}:{element:last,offset:children(last).length}}(element,offset),span=SugarElement.fromHtml('<span data-mce-bogus="all" style="display: inline-block;">\ufeff</span>');return before$4(startPoint.element,span),markerInfo(span,(function(){return remove$7(span)}))},withMarker=function(editor,f,rng,alignToTop){preserveWith(editor,(function(_s,_e){return applyWithMarker(editor,f,rng,alignToTop)}),rng)},withScrollEvents=function(editor,doc,f,marker,alignToTop){var data={elm:marker.element.dom,alignToTop:alignToTop};(function(editor,data){return editor.fire("ScrollIntoView",data).isDefaultPrevented()})(editor,data)||(f(doc,get$8(doc).top,marker,alignToTop),function(editor,data){editor.fire("AfterScrollIntoView",data)}(editor,data))},applyWithMarker=function(editor,f,rng,alignToTop){var body=SugarElement.fromDom(editor.getBody()),doc=SugarElement.fromDom(editor.getDoc());body.dom.offsetWidth;var marker=createMarker(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop),marker.cleanup()},withElement=function(editor,element,f,alignToTop){var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,function(element){return markerInfo(SugarElement.fromDom(element),noop)}(element),alignToTop)},preserveWith=function(editor,f,rng){var startElement=rng.startContainer,startOffset=rng.startOffset,endElement=rng.endContainer,endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));var newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset),newRng.setEnd(endElement,endOffset),editor.selection.setRng(rng)},scrollToMarker=function(marker,viewHeight,alignToTop,doc){var pos=marker.pos;if(alignToTop)to(pos.left,pos.top,doc);else{var y=pos.top-viewHeight+marker.height;to(pos.left,y,doc)}},intoWindowIfNeeded=function(doc,scrollTop,viewHeight,marker,alignToTop){var viewportBottom=viewHeight+scrollTop,markerTop=marker.pos.top,markerBottom=marker.bottom,largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop)scrollToMarker(marker,viewHeight,!1!==alignToTop,doc);else if(markerTop>viewportBottom){scrollToMarker(marker,viewHeight,largerThanViewport?!1!==alignToTop:!0===alignToTop,doc)}else markerBottom>viewportBottom&&!largerThanViewport&&scrollToMarker(marker,viewHeight,!0===alignToTop,doc)},intoWindow=function(doc,scrollTop,marker,alignToTop){var viewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop)},intoFrame=function(doc,scrollTop,marker,alignToTop){var frameViewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,frameViewHeight,marker,alignToTop);var op=find$1(marker.element),viewportBounds=getBounds(window);op.top<viewportBounds.y?intoView(marker.element,!1!==alignToTop):op.top>viewportBounds.bottom&&intoView(marker.element,!0===alignToTop)},rangeIntoWindow=function(editor,rng,alignToTop){return withMarker(editor,intoWindow,rng,alignToTop)},elementIntoWindow=function(editor,element,alignToTop){return withElement(editor,element,intoWindow,alignToTop)},rangeIntoFrame=function(editor,rng,alignToTop){return withMarker(editor,intoFrame,rng,alignToTop)},elementIntoFrame=function(editor,element,alignToTop){return withElement(editor,element,intoFrame,alignToTop)},scrollRangeIntoView=function(editor,rng,alignToTop){(editor.inline?rangeIntoWindow:rangeIntoFrame)(editor,rng,alignToTop)},hasFocus$1=function(element){var root=getRootNode(element).dom;return element.dom===root.activeElement},active=function(root){return void 0===root&&(root=SugarElement.fromDom(document)),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)},SimRange_create=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},adt$1=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ_getStart=(adt$1.before,adt$1.on,adt$1.after,function(situ){return situ.fold(identity,identity,identity)}),adt=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt.domRange,relative:adt.relative,exact:adt.exact,exactFromRange:function(simRange){return adt.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){var start=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ_getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return defaultView(start)},range:SimRange_create},browser$1=detect().browser,clamp$1=function(offset,element){var max=isText$8(element)?get$2(element).length:children(element).length+1;return offset>max?max:offset<0?0:offset},normalizeRng=function(rng){return SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish))},isOrContains=function(root,elm){return!isRestrictedNode(elm.dom)&&(contains$1(root,elm)||eq(root,elm))},isRngInRoot=function(root){return function(rng){return isOrContains(root,rng.start)&&isOrContains(root,rng.finish)}},shouldStore=function(editor){return!0===editor.inline||browser$1.isIE()},nativeRangeToSelectionRange=function(r){return SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset)},getBookmark=function(root){return function(win){var selection=win.getSelection();return(selection&&0!==selection.rangeCount?Optional.from(selection.getRangeAt(0)):Optional.none()).map(nativeRangeToSelectionRange)}(defaultView(root).dom).filter(isRngInRoot(root))},bookmarkToNativeRng=function(bookmark){var rng=document.createRange();try{return rng.setStart(bookmark.start.dom,bookmark.soffset),rng.setEnd(bookmark.finish.dom,bookmark.foffset),Optional.some(rng)}catch(_){return Optional.none()}},store=function(editor){var newBookmark=shouldStore(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark},getRng=function(editor){return(editor.bookmark?editor.bookmark:Optional.none()).bind((function(x){return function(root,bookmark){return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng)}(SugarElement.fromDom(editor.getBody()),x)})).bind(bookmarkToNativeRng)},FocusManager={isEditorUIElement:function(elm){var className=elm.className.toString();return-1!==className.indexOf("tox-")||-1!==className.indexOf("mce-")}},registerEditorEvents=function(editor,throttledStore){detect().browser.isIE()?function(editor){editor.on("focusout",(function(){store(editor)}))}(editor):function(editor,throttledStore){editor.on("mouseup touchend",(function(_e){throttledStore.throttle()}))}(editor,throttledStore),editor.on("keyup NodeChange",(function(e){(function(e){return"nodechange"===e.type&&e.selectionChange})(e)||store(editor)}))},register$3=function(editor){var throttledStore=first((function(){store(editor)}),0);editor.on("init",(function(){editor.inline&&function(editor,throttledStore){var mouseUpPage=function(){throttledStore.throttle()};DOMUtils.DOM.bind(document,"mouseup",mouseUpPage),editor.on("remove",(function(){DOMUtils.DOM.unbind(document,"mouseup",mouseUpPage)}))}(editor,throttledStore),registerEditorEvents(editor,throttledStore)})),editor.on("remove",(function(){throttledStore.cancel()}))},DOM$8=DOMUtils.DOM,isUIElement=function(editor,elm){var customSelector=function(editor){return editor.getParam("custom_ui_selector","","string")}(editor);return null!==DOM$8.getParent(elm,(function(elm){return function(elm){return FocusManager.isEditorUIElement(elm)}(elm)||!!customSelector&&editor.dom.is(elm,customSelector)}))},registerEvents$1=function(editorManager,e){var editor=e.editor;register$3(editor),editor.on("focusin",(function(){var focusedEditor=editorManager.focusedEditor;focusedEditor!==editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),editorManager.focusedEditor=editor,editor.fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0))})),editor.on("focusout",(function(){Delay.setEditorTimeout(editor,(function(){var focusedEditor=editorManager.focusedEditor;isUIElement(editor,function(editor){try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active(root).fold((function(){return document.body}),(function(x){return x.dom}))}catch(ex){return document.body}}(editor))||focusedEditor!==editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null)}))})),documentFocusInHandler||(documentFocusInHandler=function(e){var activeEditor=editorManager.activeEditor;activeEditor&&function(event){if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$6(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)}(e).each((function(target){target.ownerDocument===document&&(target===document.body||isUIElement(activeEditor,target)||editorManager.focusedEditor!==activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null))}))},DOM$8.bind(document,"focusin",documentFocusInHandler))},unregisterDocumentEvents=function(editorManager,e){editorManager.focusedEditor===e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM$8.unbind(document,"focusin",documentFocusInHandler),documentFocusInHandler=null)},getFocusInElement=function(root,rng){return function(rng){return rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none()}(rng).bind((function(node){return isTableSection(node)?Optional.some(node):!1===contains$1(root,node)?Optional.some(root):Optional.none()}))},normalizeSelection$1=function(editor,rng){getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind((function(elm){return firstPositionIn(elm.dom)})).fold((function(){editor.selection.normalize()}),(function(caretPos){return editor.selection.setRng(caretPos.toRange())}))},focusBody=function(body){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus()},hasElementFocus=function(elm){return hasFocus$1(elm)||(element=elm,active(getRootNode(element)).filter((function(e){return element.dom.contains(e.dom)}))).isSome();var element},hasFocus=function(editor){return editor.inline?function(editor){var rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody))}(editor):function(editor){return editor.iframeElement&&hasFocus$1(SugarElement.fromDom(editor.iframeElement))}(editor)},hasEditorOrUiFocus=function(editor){return hasFocus(editor)||function(editor){var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active(dos).filter((function(elem){return!(void 0!==(classList=elem.dom.classList)&&(classList.contains("tox-edit-area")||classList.contains("tox-edit-area__iframe")||classList.contains("mce-content-body")))&&isUIElement(editor,elem.dom);var classList})).isSome()}(editor)},activateEditor=function(editor){return editor.editorManager.setActive(editor)},focus=function(editor,skipFocus){editor.removed||(skipFocus?activateEditor(editor):function(editor){var selection=editor.selection,body=editor.getBody(),rng=selection.getRng();editor.quirks.refreshContentEditable(),void 0!==editor.bookmark&&!1===hasFocus(editor)&&getRng(editor).each((function(bookmarkRng){editor.selection.setRng(bookmarkRng),rng=bookmarkRng}));var contentEditableHost=function(editor,node){return editor.dom.getParent(node,(function(node){return"true"===editor.dom.getContentEditable(node)}))}(editor,selection.getNode());if(editor.$.contains(body,contentEditableHost))return focusBody(contentEditableHost),normalizeSelection$1(editor,rng),void activateEditor(editor);editor.inline||(Env.opera||focusBody(body),editor.getWin().focus()),(Env.gecko||editor.inline)&&(focusBody(body),normalizeSelection$1(editor,rng)),activateEditor(editor)}(editor))},getEndpointElement=function(root,rng,start,real,resolve){var container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map((function(elm){return real&&rng.collapsed?elm:child$1(elm,resolve(elm,offset)).getOr(elm)})).bind((function(elm){return isElement$6(elm)?Optional.some(elm):parent(elm).filter(isElement$6)})).map((function(elm){return elm.dom})).getOr(root)},getStart=function(root,rng,real){return getEndpointElement(root,rng,!0,real,(function(elm,offset){return Math.min(childNodesCount(elm),offset)}))},getEnd=function(root,rng,real){return getEndpointElement(root,rng,!1,real,(function(elm,offset){return offset>0?offset-1:offset}))},skipEmptyTextNodes=function(node,forwards){for(var orig=node;node&&isText$7(node)&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig},processRanges=function(editor,ranges){return map$3(ranges,(function(range){var evt=editor.fire("GetSelectionRange",{range:range});return evt.range!==range?evt.range:range}))},typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},walk$1=function(node,root,prev){var startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==root){var sibling=node[siblingName];if(sibling)return sibling;for(var parent_1=node.parent;parent_1&&parent_1!==root;parent_1=parent_1.parent)if(sibling=parent_1[siblingName])return sibling}},isEmptyTextNode=function(node){if(!isWhitespaceText(node.value))return!1;var parentNode=node.parent;return!parentNode||"span"===parentNode.name&&!parentNode.attr("style")||!/^[ ]+$/.test(node.value)},isNonEmptyElement=function(node){var isNamedAnchor="a"===node.name&&!node.attr("href")&&node.attr("id");return node.attr("name")||node.attr("id")&&!node.firstChild||node.attr("data-mce-bookmark")||isNamedAnchor},AstNode=function(){function AstNode(name,type){this.name=name,this.type=type,1===type&&(this.attributes=[],this.attributes.map={})}return AstNode.create=function(name,attrs){var node=new AstNode(name,typeLookup[name]||1);return attrs&&each$j(attrs,(function(value,attrName){node.attr(attrName,value)})),node},AstNode.prototype.replace=function(node){return node.parent&&node.remove(),this.insert(node,this),this.remove(),this},AstNode.prototype.attr=function(name,value){var attrs,self=this;if("string"!=typeof name)return null!=name&&each$j(name,(function(value,key){self.attr(key,value)})),self;if(attrs=self.attributes){if(void 0!==value){if(null===value){if(name in attrs.map){delete attrs.map[name];for(var i=attrs.length;i--;)if(attrs[i].name===name)return attrs.splice(i,1),self}return self}if(name in attrs.map){for(i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name:name,value:value});return attrs.map[name]=value,self}return attrs.map[name]}},AstNode.prototype.clone=function(){var selfAttrs,clone=new AstNode(this.name,this.type);if(selfAttrs=this.attributes){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];"id"!==selfAttr.name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value)}clone.attributes=cloneAttrs}return clone.value=this.value,clone.shortEnded=this.shortEnded,clone},AstNode.prototype.wrap=function(wrapper){return this.parent.insert(wrapper,this),wrapper.append(this),this},AstNode.prototype.unwrap=function(){for(var node=this.firstChild;node;){var next=node.next;this.insert(node,this,!0),node=next}this.remove()},AstNode.prototype.remove=function(){var parent=this.parent,next=this.next,prev=this.prev;return parent&&(parent.firstChild===this?(parent.firstChild=next,next&&(next.prev=null)):prev.next=next,parent.lastChild===this?(parent.lastChild=prev,prev&&(prev.next=null)):next.prev=prev,this.parent=this.next=this.prev=null),this},AstNode.prototype.append=function(node){node.parent&&node.remove();var last=this.lastChild;return last?(last.next=node,node.prev=last,this.lastChild=node):this.lastChild=this.firstChild=node,node.parent=this,node},AstNode.prototype.insert=function(node,refNode,before){node.parent&&node.remove();var parent=refNode.parent||this;return before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev.next=node,node.prev=refNode.prev,node.next=refNode,refNode.prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next.prev=node,node.next=refNode.next,node.prev=refNode,refNode.next=node),node.parent=parent,node},AstNode.prototype.getAll=function(name){for(var collection=[],node=this.firstChild;node;node=walk$1(node,this))node.name===name&&collection.push(node);return collection},AstNode.prototype.children=function(){for(var collection=[],node=this.firstChild;node;node=node.next)collection.push(node);return collection},AstNode.prototype.empty=function(){if(this.firstChild){for(var nodes=[],node=this.firstChild;node;node=walk$1(node,this))nodes.push(node);for(var i=nodes.length;i--;){(node=nodes[i]).parent=node.firstChild=node.lastChild=node.next=node.prev=null}}return this.firstChild=this.lastChild=null,this},AstNode.prototype.isEmpty=function(elements,whitespace,predicate){void 0===whitespace&&(whitespace={});var node=this.firstChild;if(isNonEmptyElement(this))return!1;if(node)do{if(1===node.type){if(node.attr("data-mce-bogus"))continue;if(elements[node.name])return!1;if(isNonEmptyElement(node))return!1}if(8===node.type)return!1;if(3===node.type&&!isEmptyTextNode(node))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(node.value))return!1;if(predicate&&predicate(node))return!1}while(node=walk$1(node,this));return!0},AstNode.prototype.walk=function(prev){return walk$1(this,null,prev)},AstNode}(),restoreDataUris=function(html,result){return html.replace(result.re,(function(imageId){return get$9(result.uris,imageId).getOr(imageId)}))},each$d=Tools.each,trim=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25},safeSvgDataUrlElements=["img","video"],isInvalidUri=function(settings,uri,tagName){return!settings.allow_html_data_urls&&(/^data:image\//i.test(uri)?function(allowSvgDataUrls,tagName){return isNonNullable(allowSvgDataUrls)?!allowSvgDataUrls:!isNonNullable(tagName)||!contains$3(safeSvgDataUrlElements,tagName)}(settings.allow_svg_data_urls,tagName)&&/^data:image\/svg\+xml/i.test(uri):/^data:/i.test(uri))},URI=function(){function URI(url,settings){url=trim(url),this.settings=settings||{};var baseUri=this.settings.base_uri,self=this;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))self.source=url;else{var isProtocolRelative=0===url.indexOf("//");if(0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+url),!/^[\w\-]*:?\/\//.test(url)){var baseUrl=this.settings.base_uri?this.settings.base_uri.path:new URI(document.location.href).directory;if(this.settings.base_uri&&""==this.settings.base_uri.protocol)url="//mce_host"+self.toAbsPath(baseUrl,url);else{var match=/([^#?]*)([#?]?.*)/.exec(url);url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,match[1])+match[2]}}url=url.replace(/@@/g,"(mce_at)");var urlMatch=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?(\[[a-zA-Z0-9:.%]+\]|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each$d(queryParts,(function(v,i){var part=urlMatch[i];part&&(part=part.replace(/\(mce_at\)/g,"@@")),self[v]=part})),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}}return URI.parseDataUri=function(uri){var type,uriComponents=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriComponents[0]);return matches&&(type=matches[1]),{type:type,data:uriComponents[1]}},URI.isDomSafe=function(uri,context,options){if(void 0===options&&(options={}),options.allow_script_urls)return!0;var decodedUri=Entities.decode(uri).replace(/[\s\u0000-\u001F]+/g,"");try{decodedUri=decodeURIComponent(decodedUri)}catch(ex){decodedUri=unescape(decodedUri)}return!/((java|vb)script|mhtml):/i.test(decodedUri)&&!isInvalidUri(options,decodedUri,context)},URI.getDocumentBaseUrl=function(loc){var baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl},URI.prototype.setPath=function(path){var pathMatch=/^(.*?)\/?(\w+)?$/.exec(path);this.path=pathMatch[0],this.directory=pathMatch[1],this.file=pathMatch[2],this.source="",this.getURI()},URI.prototype.toRelative=function(uri){var output;if("./"===uri)return uri;var relativeUri=new URI(uri,{base_uri:this});if("mce_host"!==relativeUri.host&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&""!==relativeUri.protocol)return relativeUri.getURI();var tu=this.getURI(),uu=relativeUri.getURI();return tu===uu||"/"===tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)===uu?tu:(output=this.toRelPath(this.path,relativeUri.path),relativeUri.query&&(output+="?"+relativeUri.query),relativeUri.anchor&&(output+="#"+relativeUri.anchor),output)},URI.prototype.toAbsolute=function(uri,noHost){var absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri))},URI.prototype.isSameOrigin=function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},URI.prototype.toRelPath=function(base,path){var i,l,breakPoint=0,out="",normalizedBase=base.substring(0,base.lastIndexOf("/")).split("/"),items=path.split("/");if(normalizedBase.length>=items.length)for(i=0,l=normalizedBase.length;i<l;i++)if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(normalizedBase.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!==breakPoint-1?"/"+items[i]:items[i];return out},URI.prototype.toAbsPath=function(base,path){var i,outPath,nb=0,o=[],tr=/\/$/.test(path)?"/":"",normalizedBase=base.split("/"),normalizedPath=path.split("/");for(each$d(normalizedBase,(function(k){k&&o.push(k)})),normalizedBase=o,i=normalizedPath.length-1,o=[];i>=0;i--)0!==normalizedPath[i].length&&"."!==normalizedPath[i]&&(".."!==normalizedPath[i]?nb>0?nb--:o.push(normalizedPath[i]):nb++);return 0!==(outPath=(i=normalizedBase.length-nb)<=0?reverse(o).join("/"):normalizedBase.slice(0,i).join("/")+"/"+reverse(o).join("/")).indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath},URI.prototype.getURI=function(noProtoHost){var s;return void 0===noProtoHost&&(noProtoHost=!1),this.source&&!noProtoHost||(s="",noProtoHost||(this.protocol?s+=this.protocol+"://":s+="//",this.userInfo&&(s+=this.userInfo+"@"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port)),this.path&&(s+=this.path),this.query&&(s+="?"+this.query),this.anchor&&(s+="#"+this.anchor),this.source=s),this.source},URI}(),filteredClobberElements=Tools.makeMap("button,fieldset,form,iframe,img,image,input,object,output,select,textarea"),findMatchingEndTagIndex=function(schema,html,startIndex){for(var startTagRegExp=/<([!?\/])?([A-Za-z0-9\-_:.]+)/g,endTagRegExp=/(?:\s(?:[^'">]+(?:"[^"]*"|'[^']*'))*[^"'>]*(?:"[^">]*|'[^'>]*)?|\s*|\/)>/g,shortEndedElements=schema.getShortEndedElements(),count=1,index=startIndex;0!==count;)for(startTagRegExp.lastIndex=index;;){var startMatch=startTagRegExp.exec(html);if(null===startMatch)return index;if("!"===startMatch[1]){index=startsWith(startMatch[2],"--")?findCommentEndIndex(html,!1,startMatch.index+"!--".length):findCommentEndIndex(html,!0,startMatch.index+1);break}endTagRegExp.lastIndex=startTagRegExp.lastIndex;var endMatch=endTagRegExp.exec(html);if(!isNull(endMatch)&&endMatch.index===startTagRegExp.lastIndex){"/"===startMatch[1]?count-=1:has$2(shortEndedElements,startMatch[2])||(count+=1),index=startTagRegExp.lastIndex+endMatch[0].length;break}}return index},findCommentEndIndex=function(html,isBogus,startIndex){void 0===startIndex&&(startIndex=0);var lcHtml=html.toLowerCase();if(-1!==lcHtml.indexOf("[if ",startIndex)&&function(html,startIndex){return/^\s*\[if [\w\W]+\]>.*<!\[endif\](--!?)?>/.test(html.substr(startIndex))}(lcHtml,startIndex)){var endIfIndex=lcHtml.indexOf("[endif]",startIndex);return lcHtml.indexOf(">",endIfIndex)}if(isBogus){var endIndex=lcHtml.indexOf(">",startIndex);return-1!==endIndex?endIndex:lcHtml.length}var endCommentRegexp=/--!?>/g;endCommentRegexp.lastIndex=startIndex;var match=endCommentRegexp.exec(html);return match?match.index+match[0].length:lcHtml.length},checkBogusAttribute=function(regExp,attrString){var matches=regExp.exec(attrString);if(matches){var name_1=matches[1],value=matches[2];return"string"==typeof name_1&&"data-mce-bogus"===name_1.toLowerCase()?value:null}return null},SaxParser=function(settings,schema){var _a;void 0===schema&&(schema=Schema());var doc=null!==(_a=(settings=settings||{}).document)&&void 0!==_a?_a:document,form=doc.createElement("form");!1!==settings.fix_self_closing&&(settings.fix_self_closing=!0);var comment=settings.comment?settings.comment:noop,cdata=settings.cdata?settings.cdata:noop,text=settings.text?settings.text:noop,start=settings.start?settings.start:noop,end=settings.end?settings.end:noop,pi=settings.pi?settings.pi:noop,doctype=settings.doctype?settings.doctype:noop,parseInternal=function(base64Extract,format){void 0===format&&(format="html");for(var matches,value,endRegExp,attrList,i,textData,name,isInternalElement,isShortEnded,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,attrValue,html=base64Extract.html,index=0,stack=[],idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,action,formaction,poster,xlink:href"),parsingMode="html"===format?0:1,processEndTag=function(name){var pos,i;for(pos=stack.length;pos--&&stack[pos].name!==name;);if(pos>=0){for(i=stack.length-1;i>=pos;i--)(name=stack[i]).valid&&end(name.name);stack.length=pos}},processText=function(value,raw){return text(restoreDataUris(value,base64Extract),raw)},processComment=function(value){""!==value&&(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3).toLowerCase()||(value=" "+value),comment(restoreDataUris(value,base64Extract)))},processMalformedComment=function(value,startIndex){var startTag=value||"",isBogus=!startsWith(startTag,"--"),endIndex=findCommentEndIndex(html,isBogus,startIndex);return value=html.substr(startIndex,endIndex-startIndex),processComment(isBogus?startTag+value:value),endIndex+1},parseAttribute=function(tagName,name,value,val2,val3){if(value=function(value){return restoreDataUris(value,base64Extract)}((name=name.toLowerCase())in fillAttrsMap?name:decode(value||val2||val3||"")),validate&&!isInternalElement&&!1===function(name){return 0===name.indexOf("data-")||0===name.indexOf("aria-")}(name)){var attrRule=validAttributesMap[name];if(!attrRule&&validAttributePatterns){for(var i_1=validAttributePatterns.length;i_1--&&!(attrRule=validAttributePatterns[i_1]).pattern.test(name););-1===i_1&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}("name"===name||"id"===name)&&tagName in filteredClobberElements&&(value in doc||value in form)||filteredUrlAttrs[name]&&!URI.isDomSafe(value,tagName,settings)||isInternalElement&&(name in filteredUrlAttrs||0===name.indexOf("on"))||(attrList.map[name]=value,attrList.push({name:name,value:value}))},tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)--!?>)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\w\\W]*?)>)|(?:!(--)?)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_:.]*)(\\s(?:[^'\">]+(?:\"[^\"]*\"|'[^']*'))*[^\"'>]*(?:\"[^\">]*|'[^'>]*)?|\\s*|\\/)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements(),processHtml=html+">";matches=tokenRegExp.exec(processHtml);){var matchText=matches[0];if(index<matches.index&&processText(decode(html.substr(index,matches.index-index))),value=matches[7])":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),processEndTag(value);else if(value=matches[8]){if(matches.index+matchText.length>html.length){processText(decode(html.substr(matches.index))),index=matches.index+matchText.length;continue}":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),isShortEnded=value in shortEndedElements,fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value&&processEndTag(value);var bogusValue=checkBogusAttribute(attrRegExp,matches[9]);if(null!==bogusValue){if("all"===bogusValue){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}if(!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[9])?((isInternalElement=-1!==attribsValue.indexOf("data-mce-type"))&&removeInternalElements&&(isValidElement=!1),(attrList=[]).map={},attribsValue.replace(attrRegExp,(function(match,name,val,val2,val3){return parseAttribute(value,name,val,val2,val3),""}))):(attrList=[]).map={},validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,elementRule.removeEmptyAttrs&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)name=(attr=attributesForced[i]).name,"{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)(name=(attr=attributesDefault[i]).name)in attrList.map||("{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););-1===i&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&start(value,attrList,isShortEnded)}else isValidElement=!1;if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matchText.length,(matches=endRegExp.exec(html))?(isValidElement&&(textData=html.substr(index,matches.index-index)),index=matches.index+matches[0].length):(textData=html.substr(index),index=html.length),isValidElement&&(textData.length>0&&processText(textData,!0),end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")===attribsValue.length-1?isValidElement&&end(value):stack.push({name:value,valid:isValidElement}))}else if(value=matches[1])processComment(value);else if(value=matches[2]){if(!(1===parsingMode||settings.preserve_cdata||stack.length>0&&schema.isValidChild(stack[stack.length-1].name,"#cdata"))){index=processMalformedComment("",matches.index+2),tokenRegExp.lastIndex=index;continue}cdata(value)}else if(value=matches[3])doctype(value);else{if((value=matches[4])||"<!"===matchText){index=processMalformedComment(value,matches.index+matchText.length),tokenRegExp.lastIndex=index;continue}if(value=matches[5]){if(1!==parsingMode){index=processMalformedComment("?",matches.index+2),tokenRegExp.lastIndex=index;continue}pi(value,matches[6])}}index=matches.index+matchText.length}for(index<html.length&&processText(decode(html.substr(index))),i=stack.length-1;i>=0;i--)(value=stack[i]).valid&&end(value.name)};return{parse:function(html,format){void 0===format&&(format="html"),parseInternal(function(html){for(var matches,dataImageUri=/data:[^;]+;base64,([a-z0-9\+\/=\s]+)/gi,chunks=[],uris={},prefix=generate("img"),index=0,count=0;matches=dataImageUri.exec(html);){var uri=matches[0],imageId=prefix+"_"+count++;uris[imageId]=uri,index<matches.index&&chunks.push(html.substr(index,matches.index-index)),chunks.push(imageId),index=matches.index+uri.length}var re=new RegExp(prefix+"_[0-9]+","g");return 0===index?{prefix:prefix,uris:uris,html:html,re:re}:(index<html.length&&chunks.push(html.substr(index)),{prefix:prefix,uris:uris,html:chunks.join(""),re:re})}(html),format)}}};SaxParser.findEndTag=findMatchingEndTagIndex;var trimInternal=function(serializer,html){for(var matches,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,schema=serializer.schema,content=function(tempAttrs,html){var trimContentRegExp=new RegExp(["\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html.replace(trimContentRegExp,"")}(serializer.getTempAttrs(),html),shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);){var index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=void 0;endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex),bogusAllRegExp.lastIndex=index-matchLength}return trim$2(content)},trimExternal=trimInternal,getContentFromBody=function(editor,args,format,body){var content,defaultedArgs=function(args,format){return __assign(__assign({},args),{format:format,get:!0,getInner:!0})}(args,format),updatedArgs=args.no_events?defaultedArgs:editor.fire("BeforeGetContent",defaultedArgs);return content="raw"===updatedArgs.format?Tools.trim(trimExternal(editor.serializer,body.innerHTML)):"text"===updatedArgs.format?editor.dom.isEmpty(body)?"":trim$2(body.innerText||body.textContent):"tree"===updatedArgs.format?editor.serializer.serialize(body,updatedArgs):function(editor,html){var blockName=getForcedRootBlock(editor),emptyRegExp=new RegExp("^(<"+blockName+"[^>]*>(&nbsp;|&#160;|\\s|Â |<br \\/>|)<\\/"+blockName+">[\r\n]*|<br \\/>[\r\n]*)$");return html.replace(emptyRegExp,"")}(editor,editor.serializer.serialize(body,updatedArgs)),contains$3(["text","tree"],updatedArgs.format)||isWsPreserveElement(SugarElement.fromDom(body))?updatedArgs.content=content:updatedArgs.content=Tools.trim(content),updatedArgs.no_events?updatedArgs.content:editor.fire("GetContent",updatedArgs).content},each$c=Tools.each,ElementUtils=function(dom){return{compare:function(node1,node2){if(node1.nodeName!==node2.nodeName)return!1;var getAttribs=function(node){var attribs={};return each$c(dom.getAttribs(node),(function(attr){var name=attr.nodeName.toLowerCase();0!==name.indexOf("_")&&"style"!==name&&0!==name.indexOf("data-")&&(attribs[name]=dom.getAttrib(node,name))})),attribs},compareObjects=function(obj1,obj2){var value,name;for(name in obj1)if(has$2(obj1,name)){if(void 0===(value=obj2[name]))return!1;if(obj1[name]!==value)return!1;delete obj2[name]}for(name in obj2)if(has$2(obj2,name))return!1;return!0};return!!compareObjects(getAttribs(node1),getAttribs(node2))&&(!!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))&&(!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2)))}}},makeMap$1=Tools.makeMap,Writer=function(settings){var html=[],indent=(settings=settings||{}).indent,indentBefore=makeMap$1(settings.indent_before||""),indentAfter=makeMap$1(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"===settings.element_format;return{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n"),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},end:function(name){var value;html.push("</",name,">"),indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},text:function(text,raw){text.length>0&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("\x3c!--",text,"--\x3e")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}},HtmlSerializer=function(settings,schema){void 0===schema&&(schema=Schema());var writer=Writer(settings);(settings=settings||{}).validate=!("validate"in settings)||settings.validate;return{serialize:function(node){var validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)do{walk(node)}while(node=node.next)}};writer.reset();var walk=function(node){var handler=handlers[node.type];if(handler)handler(node);else{var name_1=node.name,isEmpty=node.shortEnded,attrs=node.attributes;if(validate&&attrs&&attrs.length>1){var sortedAttrs=[];sortedAttrs.map={};var elementRule=schema.getElementRule(node.name);if(elementRule){for(var i=0,l=elementRule.attributesOrder.length;i<l;i++){if((attrName=elementRule.attributesOrder[i])in attrs.map){var attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue})}}for(i=0,l=attrs.length;i<l;i++){var attrName;if(!((attrName=attrs[i].name)in sortedAttrs.map)){attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue})}}attrs=sortedAttrs}}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)do{walk(node)}while(node=node.next);writer.end(name_1)}}};return 1!==node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}},nonInheritableStyles=new Set;each$k(["margin","margin-left","margin-right","margin-top","margin-bottom","padding","padding-left","padding-right","padding-top","padding-bottom","border","border-width","border-style","border-color","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","float","position","left","right","top","bottom","z-index","display","transform","width","max-width","min-width","height","max-height","min-height","overflow","overflow-x","overflow-y","text-overflow","vertical-align","transition","transition-delay","transition-duration","transition-property","transition-timing-function"],(function(style){nonInheritableStyles.add(style)}));var shorthandStyleProps=["font","text-decoration","text-emphasis"],getStyleProps=function(dom,node){return keys(dom.parseStyle(dom.getAttrib(node,"style")))},hasInheritableStyles=function(dom,node){return forall(getStyleProps(dom,node),(function(style){return!function(style){return nonInheritableStyles.has(style)}(style)}))},hasStyleConflict=function(dom,node,parentNode){var nodeStyleProps=getStyleProps(dom,node),parentNodeStyleProps=getStyleProps(dom,parentNode),valueMismatch=function(prop){var nodeValue=dom.getStyle(node,prop),parentValue=dom.getStyle(parentNode,prop);return isNotEmpty(nodeValue)&&isNotEmpty(parentValue)&&nodeValue!==parentValue};return exists(nodeStyleProps,(function(nodeStyleProp){var propExists=function(props){return exists(props,(function(prop){return prop===nodeStyleProp}))};if(!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)){var longhandProps=filter$4(parentNodeStyleProps,(function(style){return exists(shorthandStyleProps,(function(prop){return startsWith(style,prop)}))}));return exists(longhandProps,valueMismatch)}return valueMismatch(nodeStyleProp)}))},isChar=function(forward,predicate,pos){return Optional.from(pos.container()).filter(isText$7).exists((function(text){var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta))}))},isBeforeSpace=curry(isChar,!0,isWhiteSpace),isAfterSpace=curry(isChar,!1,isWhiteSpace),isEmptyText=function(pos){var container=pos.container();return isText$7(container)&&(0===container.data.length||isZwsp(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode))},matchesElementPosition=function(before,predicate){return function(pos){return Optional.from(getChildNodeAtRelativeOffset(before?0:-1,pos)).filter(predicate).isSome()}},isImageBlock=function(node){return isImg(node)&&"block"===get$5(SugarElement.fromDom(node),"display")},isCefNode=function(node){return isContentEditableFalse$b(node)&&!function(node){return isElement$5(node)&&"all"===node.getAttribute("data-mce-bogus")}(node)},isBeforeImageBlock=matchesElementPosition(!0,isImageBlock),isAfterImageBlock=matchesElementPosition(!1,isImageBlock),isBeforeMedia=matchesElementPosition(!0,isMedia$2),isAfterMedia=matchesElementPosition(!1,isMedia$2),isBeforeTable=matchesElementPosition(!0,isTable$3),isAfterTable=matchesElementPosition(!1,isTable$3),isBeforeContentEditableFalse=matchesElementPosition(!0,isCefNode),isAfterContentEditableFalse=matchesElementPosition(!1,isCefNode),removeTrailingBr=function(elm){var allBrs=descendants(elm,"br"),brs=filter$4(function(elm){for(var children=[],rawNode=elm.dom;rawNode;)children.push(SugarElement.fromDom(rawNode)),rawNode=rawNode.lastChild;return children}(elm).slice(-1),isBr$4);allBrs.length===brs.length&&each$k(brs,remove$7)},fillWithPaddingBr=function(elm){empty(elm),append$1(elm,SugarElement.fromHtml('<br data-mce-bogus="1">'))},trimBlockTrailingBr=function(elm){lastChild(elm).each((function(lastChild){prevSibling(lastChild).each((function(lastChildPrevSibling){isBlock$2(elm)&&isBr$4(lastChild)&&isBlock$2(lastChildPrevSibling)&&remove$7(lastChild)}))}))},parentsUntil=function(start,root,predicate){return contains$1(root,start)?function(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret}(start,(function(elm){return predicate(elm)||eq(elm,root)})).slice(0,-1):[]},parents=function(start,root){return parentsUntil(start,root,never)},parentsAndSelf=function(start,root){return[start].concat(parents(start,root))},navigateIgnoreEmptyTextNodes=function(forward,root,from){return navigateIgnore(forward,root,from,isEmptyText)},getClosestBlock$1=function(root,pos){return find$3(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2)},isAtBeforeAfterBlockBoundary=function(forward,root,pos){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((function(newPos){return getClosestBlock$1(root,pos).fold((function(){return!1===isInSameBlock(newPos,pos,root.dom)}),(function(fromBlock){return!1===isInSameBlock(newPos,pos,root.dom)&&contains$1(fromBlock,SugarElement.fromDom(newPos.container()))}))}))},isAtBlockBoundary=function(forward,root,pos){return getClosestBlock$1(root,pos).fold((function(){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((function(newPos){return!1===isInSameBlock(newPos,pos,root.dom)}))}),(function(parent){return navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone()}))},isAtStartOfBlock=curry(isAtBlockBoundary,!1),isAtEndOfBlock=curry(isAtBlockBoundary,!0),isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,!1),isAfterBlock=curry(isAtBeforeAfterBlockBoundary,!0),isBr=function(pos){return getElementFromPosition(pos).exists(isBr$4)},findBr=function(forward,root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2),scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr)},isBeforeBr$1=function(root,pos){return getElementFromPosition(pos).exists(isBr$4)||findBr(!0,root,pos).isSome()},isAfterBr=function(root,pos){return function(pos){return Optional.from(pos.getNode(!0)).map(SugarElement.fromDom)}(pos).exists(isBr$4)||findBr(!1,root,pos).isSome()},findPreviousBr=curry(findBr,!1),findNextBr=curry(findBr,!0),isInMiddleOfText=function(pos){return CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd()},getClosestBlock=function(root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);return head(parentBlocks).getOr(root)},hasSpaceBefore=function(root,pos){return isInMiddleOfText(pos)?isAfterSpace(pos):isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos).dom,pos).exists(isAfterSpace)},hasSpaceAfter=function(root,pos){return isInMiddleOfText(pos)?isBeforeSpace(pos):isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos).dom,pos).exists(isBeforeSpace)},isInPre=function(pos){return getElementFromPosition(pos).bind((function(elm){return closest$3(elm,isElement$6)})).exists((function(elm){return function(value){return contains$3(["pre","pre-wrap"],value)}(get$5(elm,"white-space"))}))},isAtLineBoundary=function(root,pos){return function(root,pos){return prevPosition(root.dom,pos).isNone()}(root,pos)||function(root,pos){return nextPosition(root.dom,pos).isNone()}(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr$1(root,pos)},needsToBeNbspLeft=function(root,pos){return!isInPre(pos)&&(isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos))},needsToBeNbspRight=function(root,pos){return!isInPre(pos)&&(isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr$1(root,pos)||hasSpaceAfter(root,pos))},needsToBeNbsp=function(root,pos){return needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,function(pos){var container=pos.container(),offset=pos.offset();return isText$7(container)&&offset<container.data.length?CaretPosition(container,offset+1):pos}(pos))},isNbspAt=function(text,offset){return isNbsp(text.charAt(offset))},hasNbsp=function(pos){var container=pos.container();return isText$7(container)&&contains$2(container.data,"Â ")},normalizeNbspInMiddleOfTextNode=function(node){var text=node.data,newText=function(text){var chars=text.split("");return map$3(chars,(function(chr,i){return isNbsp(chr)&&i>0&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])?" ":chr})).join("")}(text);return newText!==text&&(node.data=newText,!0)},normalizeNbsps=function(root,pos){return Optional.some(pos).filter(hasNbsp).bind((function(pos){var container=pos.container();return function(root,node){var text=node.data,firstPos=CaretPosition(node,0);return!(!isNbspAt(text,0)||needsToBeNbsp(root,firstPos)||(node.data=" "+text.slice(1),0))}(root,container)||normalizeNbspInMiddleOfTextNode(container)||function(root,node){var text=node.data,lastPos=CaretPosition(node,text.length-1);return!(!isNbspAt(text,text.length-1)||needsToBeNbsp(root,lastPos)||(node.data=text.slice(0,-1)+" ",0))}(root,container)?Optional.some(pos):Optional.none()}))},normalizeNbspsInEditor=function(editor){var root=SugarElement.fromDom(editor.getBody());editor.selection.isCollapsed()&&normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng())).each((function(pos){editor.selection.setRng(pos.toRange())}))},normalize$1=function(node,offset,count){if(0!==count){var elm=SugarElement.fromDom(node),root=ancestor$3(elm,isBlock$2).getOr(elm),whitespace=node.data.slice(offset,offset+count),isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,CaretPosition(node,node.data.length)),isStartOfContent=0===offset&&needsToBeNbspLeft(root,CaretPosition(node,0));node.replaceData(offset,count,function(content,isStartOfContent,isEndOfContent){return foldl(content,(function(acc,c){return isWhiteSpace(c)||isNbsp(c)?acc.previousCharIsSpace||""===acc.str&&isStartOfContent||acc.str.length===content.length-1&&isEndOfContent?{previousCharIsSpace:!1,str:acc.str+"Â "}:{previousCharIsSpace:!0,str:acc.str+" "}:{previousCharIsSpace:!1,str:acc.str+c}}),{previousCharIsSpace:!1,str:""}).str}(whitespace,isStartOfContent,isEndOfContent))}},normalizeWhitespaceAfter=function(node,offset){var content=node.data.slice(offset),whitespaceCount=content.length-lTrim(content).length;normalize$1(node,offset,whitespaceCount)},normalizeWhitespaceBefore=function(node,offset){var content=node.data.slice(0,offset),whitespaceCount=content.length-rTrim(content).length;normalize$1(node,offset-whitespaceCount,whitespaceCount)},mergeTextNodes=function(prevNode,nextNode,normalizeWhitespace,mergeToPrev){void 0===mergeToPrev&&(mergeToPrev=!0);var whitespaceOffset=rTrim(prevNode.data).length,newNode=mergeToPrev?prevNode:nextNode,removeNode=mergeToPrev?nextNode:prevNode;return mergeToPrev?newNode.appendData(removeNode.data):newNode.insertData(0,removeNode.data),remove$7(SugarElement.fromDom(removeNode)),normalizeWhitespace&&normalizeWhitespaceAfter(newNode,whitespaceOffset),newNode},reposition=function(elm,pos){return function(pos,elm){var container=pos.container(),offset=pos.offset();return!1===CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()}(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos},getPreviousSiblingCaretPosition=function(elm){return isCaretCandidate$3(elm.previousSibling)?Optional.some((node=elm.previousSibling,isText$7(node)?CaretPosition(node,node.data.length):CaretPosition.after(node))):elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();var node},getNextSiblingCaretPosition=function(elm){return isCaretCandidate$3(elm.nextSibling)?Optional.some((node=elm.nextSibling,isText$7(node)?CaretPosition(node,0):CaretPosition.before(node))):elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();var node},findCaretPositionBackwards=function(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk((function(){return getNextSiblingCaretPosition(elm)})).orThunk((function(){return function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return prevPosition(rootElement,startPosition).fold((function(){return nextPosition(rootElement,CaretPosition.after(elm))}),Optional.some)}(rootElement,elm)}))},findCaretPositionForward=function(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk((function(){return getPreviousSiblingCaretPosition(elm)})).orThunk((function(){return function(rootElement,elm){return nextPosition(rootElement,CaretPosition.after(elm)).fold((function(){return prevPosition(rootElement,CaretPosition.before(elm))}),Optional.some)}(rootElement,elm)}))},findCaretPosOutsideElmAfterDelete=function(forward,rootElement,elm){return function(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm)}(forward,rootElement,elm).map(curry(reposition,elm))},setSelection$1=function(editor,forward,pos){pos.fold((function(){editor.focus()}),(function(pos){editor.selection.setRng(pos.toRange(),forward)}))},isBlock=function(editor,elm){return elm&&has$2(editor.schema.getBlockElements(),name(elm))},paddEmptyBlock=function(elm){if(isEmpty$2(elm)){var br=SugarElement.fromHtml('<br data-mce-bogus="1">');return empty(elm),append$1(elm,br),Optional.some(CaretPosition.before(br.dom))}return Optional.none()},deleteNormalized=function(elm,afterDeletePosOpt,normalizeWhitespace){var oa,ob,oc,f,prevTextOpt=prevSibling(elm).filter(isText$8),nextTextOpt=nextSibling(elm).filter(isText$8);return remove$7(elm),(oa=prevTextOpt,ob=nextTextOpt,oc=afterDeletePosOpt,f=function(prev,next,pos){var prevNode=prev.dom,nextNode=next.dom,offset=prevNode.data.length;return mergeTextNodes(prevNode,nextNode,normalizeWhitespace),pos.container()===nextNode?CaretPosition(prevNode,offset):pos},oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()).orThunk((function(){return normalizeWhitespace&&(prevTextOpt.each((function(elm){return normalizeWhitespaceBefore(elm.dom,elm.dom.length)})),nextTextOpt.each((function(elm){return normalizeWhitespaceAfter(elm.dom,0)}))),afterDeletePosOpt}))},deleteElement$2=function(editor,forward,elm,moveCaret){void 0===moveCaret&&(moveCaret=!0);var rawNode,afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom),parentBlock=ancestor$3(elm,curry(isBlock,editor),(rawNode=editor.getBody(),function(elm){return elm.dom===rawNode})),normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,function(editor,element){return has$2(editor.schema.getTextInlineElements(),name(element))}(editor,elm));editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),editor.selection.setCursorLocation()):parentBlock.bind(paddEmptyBlock).fold((function(){moveCaret&&setSelection$1(editor,forward,normalizedAfterDeletePos)}),(function(paddPos){moveCaret&&setSelection$1(editor,forward,Optional.some(paddPos))}))},getTableCells=function(table){return descendants(table,"td,th")},tableCellRng=function(start,end){return{start:start,end:end}},deleteAction=Adt_generate([{singleCellTable:["rng","cell"]},{fullTable:["table"]},{partialTable:["cells","outsideDetails"]},{multiTable:["startTableCells","endTableCells","betweenRng"]}]),getClosestCell$1=function(container,isRoot){return closest$2(SugarElement.fromDom(container),"td,th",isRoot)},isExpandedCellRng=function(cellRng){return!eq(cellRng.start,cellRng.end)},getTableFromCellRng=function(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind((function(startParentTable){return getClosestTable(cellRng.end,isRoot).bind((function(endParentTable){return b=eq(startParentTable,endParentTable),a=startParentTable,b?Optional.some(a):Optional.none();var b,a}))}))},getTableSelectionFromCellRng=function(isRoot){return function(cellRng){return getTableFromCellRng(cellRng,isRoot).map((function(table){return function(rng,table,cells){return{rng:rng,table:table,cells:cells}}(cellRng,table,getTableCells(table))}))}},getTableSelections=function(cellRng,selectionDetails,rng,isRoot){if(rng.collapsed||!cellRng.forall(isExpandedCellRng))return Optional.none();if(selectionDetails.isSameTable){var sameTableSelection=cellRng.bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:sameTableSelection,end:sameTableSelection})}var startCell=getClosestCell$1(rng.startContainer,isRoot),endCell=getClosestCell$1(rng.endContainer,isRoot),startTableSelection=startCell.bind(function(isRoot){return function(startCell){return getClosestTable(startCell,isRoot).bind((function(table){return last$2(getTableCells(table)).map((function(endCell){return tableCellRng(startCell,endCell)}))}))}}(isRoot)).bind(getTableSelectionFromCellRng(isRoot)),endTableSelection=endCell.bind(function(isRoot){return function(endCell){return getClosestTable(endCell,isRoot).bind((function(table){return head(getTableCells(table)).map((function(startCell){return tableCellRng(startCell,endCell)}))}))}}(isRoot)).bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:startTableSelection,end:endTableSelection})},getCellIndex=function(cells,cell){return findIndex$2(cells,(function(x){return eq(x,cell)}))},getSelectedCells=function(tableSelection){return lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),(function(startIndex,endIndex){return tableSelection.cells.slice(startIndex,endIndex+1)}))},isSingleCellTableContentSelected=function(optCellRng,rng,isRoot){return optCellRng.exists((function(cellRng){return function(cellRng,isRoot){return!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists((function(table){var rows=table.dom.rows;return 1===rows.length&&1===rows[0].cells.length}))}(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng)}))},unselectCells=function(rng,selectionDetails){var startTable=selectionDetails.startTable,endTable=selectionDetails.endTable,otherContentRng=rng.cloneRange();return startTable.each((function(table){return otherContentRng.setStartAfter(table.dom)})),endTable.each((function(table){return otherContentRng.setEndBefore(table.dom)})),otherContentRng},getActionFromRange=function(root,rng){var isRoot=function(root){return function(cur){return eq(root,cur)}}(root),optCellRng=function(rng,isRoot){var startCell=getClosestCell$1(rng.startContainer,isRoot),endCell=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng)}(rng,isRoot),selectionDetails=function(rng,isRoot){var getTable=function(node){return getClosestTable(SugarElement.fromDom(node),isRoot)},startTable=getTable(rng.startContainer),endTable=getTable(rng.endContainer),isStartInTable=startTable.isSome(),isEndInTable=endTable.isSome(),isSameTable=lift2(startTable,endTable,eq).getOr(!1);return{startTable:startTable,endTable:endTable,isStartInTable:isStartInTable,isEndInTable:isEndInTable,isSameTable:isSameTable,isMultiTable:!isSameTable&&isStartInTable&&isEndInTable}}(rng,isRoot);return isSingleCellTableContentSelected(optCellRng,rng,isRoot)?optCellRng.map((function(cellRng){return deleteAction.singleCellTable(rng,cellRng.start)})):selectionDetails.isMultiTable?function(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind((function(_a){var start=_a.start,end=_a.end,startTableSelectedCells=start.bind(getSelectedCells).getOr([]),endTableSelectedCells=end.bind(getSelectedCells).getOr([]);if(startTableSelectedCells.length>0&&endTableSelectedCells.length>0){var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.multiTable(startTableSelectedCells,endTableSelectedCells,otherContentRng))}return Optional.none()}))}(optCellRng,selectionDetails,rng,isRoot):function(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind((function(_a){var start=_a.start,end=_a.end;return start.or(end)})).bind((function(tableSelection){var isSameTable=selectionDetails.isSameTable,selectedCells=getSelectedCells(tableSelection).getOr([]);if(isSameTable&&tableSelection.cells.length===selectedCells.length)return Optional.some(deleteAction.fullTable(tableSelection.table));if(selectedCells.length>0){if(isSameTable)return Optional.some(deleteAction.partialTable(selectedCells,Optional.none()));var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.partialTable(selectedCells,Optional.some(__assign(__assign({},selectionDetails),{rng:otherContentRng}))))}return Optional.none()}))}(optCellRng,selectionDetails,rng,isRoot)},freefallRtl=function(root){var element;return(8===type(element=root)||"#comment"===name(element)?prevSibling(root):lastChild(root)).bind(freefallRtl).orThunk((function(){return Optional.some(root)}))},cleanCells=function(cells){return each$k(cells,(function(cell){remove$6(cell,"contenteditable"),fillWithPaddingBr(cell)}))},deleteContentInsideCell=function(editor,cell,rng,isFirstCellInSelection){var insideTableRng=rng.cloneRange();isFirstCellInSelection?(insideTableRng.setStart(rng.startContainer,rng.startOffset),insideTableRng.setEndAfter(cell.dom.lastChild)):(insideTableRng.setStartBefore(cell.dom.firstChild),insideTableRng.setEnd(rng.endContainer,rng.endOffset)),deleteCellContents(editor,insideTableRng,cell,!1)},collapseAndRestoreCellSelection=function(editor){var selectedCells=getCellsFromEditor(editor),selectedNode=SugarElement.fromDom(editor.selection.getNode());isTableCell$5(selectedNode.dom)&&isEmpty$2(selectedNode)?editor.selection.setCursorLocation(selectedNode.dom,0):editor.selection.collapse(!0),selectedCells.length>1&&exists(selectedCells,(function(cell){return eq(cell,selectedNode)}))&&set$1(selectedNode,"data-mce-selected","1")},emptySingleTableCells=function(editor,cells,outsideDetails){var editorRng=editor.selection.getRng(),cellsToClean=outsideDetails.bind((function(_a){var rng=_a.rng,isStartInTable=_a.isStartInTable,outsideBlock=function(editor,container){return Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom)}(editor,isStartInTable?rng.endContainer:rng.startContainer);rng.deleteContents(),function(editor,startInTable,emptyBlock){emptyBlock.each((function(block){startInTable?remove$7(block):(fillWithPaddingBr(block),editor.selection.setCursorLocation(block.dom,0))}))}(editor,isStartInTable,outsideBlock.filter(isEmpty$2));var endPointCell=isStartInTable?cells[0]:cells[cells.length-1];return deleteContentInsideCell(editor,endPointCell,editorRng,isStartInTable),isEmpty$2(endPointCell)?Optional.none():Optional.some(isStartInTable?cells.slice(1):cells.slice(0,-1))})).getOr(cells);return cleanCells(cellsToClean),collapseAndRestoreCellSelection(editor),!0},emptyMultiTableCells=function(editor,startTableCells,endTableCells,betweenRng){var rng=editor.selection.getRng(),startCell=startTableCells[0],endCell=endTableCells[endTableCells.length-1];deleteContentInsideCell(editor,startCell,rng,!0),deleteContentInsideCell(editor,endCell,rng,!1);var startTableCellsToClean=isEmpty$2(startCell)?startTableCells:startTableCells.slice(1),endTableCellsToClean=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);return cleanCells(startTableCellsToClean.concat(endTableCellsToClean)),betweenRng.deleteContents(),collapseAndRestoreCellSelection(editor),!0},deleteCellContents=function(editor,rng,cell,moveSelection){void 0===moveSelection&&(moveSelection=!0),rng.deleteContents();var element,lastNode=freefallRtl(cell).getOr(cell),lastBlock=SugarElement.fromDom(editor.dom.getParent(lastNode.dom,editor.dom.isBlock));if(isEmpty$2(lastBlock)&&(fillWithPaddingBr(lastBlock),moveSelection&&editor.selection.setCursorLocation(lastBlock.dom,0)),!eq(cell,lastBlock)){var additionalCleanupNodes=is$1(parent(lastBlock),cell)?[]:parent(element=lastBlock).map(children).map((function(elements){return filter$4(elements,(function(x){return!eq(element,x)}))})).getOr([]);each$k(additionalCleanupNodes.concat(children(cell)),(function(node){eq(node,lastBlock)||contains$1(node,lastBlock)||!isEmpty$2(node)||remove$7(node)}))}return!0},deleteTableElement=function(editor,table){return deleteElement$2(editor,!1,table),!0},deleteTableRange=function(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold((function(){return function(editor,rootElm,rng){return getActionFromRange(rootElm,rng).map((function(action){return action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor))}))}(editor,rootElm,rng)}),(function(caption){return function(editor,caption){return emptyElement(editor,caption)}(editor,caption)})).getOr(!1)},getParentCell=function(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),isTableCell$4)},getParentCaption=function(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),(tag="caption",function(e){return isElement$6(e)&&name(e)===tag}));var tag},emptyElement=function(editor,elm){return fillWithPaddingBr(elm),editor.selection.setCursorLocation(elm.dom,0),Optional.some(!0)},deleteCaretInsideCaption=function(editor,rootElm,forward,fromCaption,from){return navigate(forward,editor.getBody(),from).bind((function(to){return function(fromCaption,forward,from,to){return firstPositionIn(fromCaption.dom).bind((function(first){return lastPositionIn(fromCaption.dom).map((function(last){return forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first)}))})).getOr(!0)}(fromCaption,forward,from,to)?function(editor,elm){return emptyElement(editor,elm)}(editor,fromCaption):function(rootElm,fromCaption,to){return getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).map((function(toCaption){return!1===eq(toCaption,fromCaption)}))}(rootElm,fromCaption,to)})).or(Optional.some(!0))},deleteCaretCells=function(editor,forward,rootElm,startElm){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind((function(fromCell){return isEmpty$2(fromCell)?emptyElement(editor,fromCell):function(editor,rootElm,forward,fromCell,from){return navigate(forward,editor.getBody(),from).bind((function(to){return getParentCell(rootElm,SugarElement.fromDom(to.getNode())).map((function(toCell){return!1===eq(toCell,fromCell)}))}))}(editor,rootElm,forward,fromCell,from)})).getOr(!1)},isNearTable=function(forward,pos){return forward?isBeforeTable(pos):isAfterTable(pos)},deleteCaret$3=function(editor,forward,startElm){var rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold((function(){return deleteCaretCells(editor,forward,rootElm,startElm)||function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists((function(pos){return isNearTable(forward,pos)}))}(editor,forward)}),(function(fromCaption){return function(editor,forward,rootElm,fromCaption){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from)}(editor,forward,rootElm,fromCaption).getOr(!1)}))},backspaceDelete$9=function(editor,forward){var startElm=SugarElement.fromDom(editor.selection.getStart(!0)),cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&0===cells.length?deleteCaret$3(editor,forward,startElm):function(editor,startElm,selectedCells){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return 0!==selectedCells.length?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm)}(editor,startElm,cells)},normalizeBlockSelectionRange=function(rng){var startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return fromPosition(!1,rootNode,endPos).map((function(newEndPos){return!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)?function(sc,so,ec,eo){var rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng}(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng})).getOr(rng)},normalize=function(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng)},isListItemPadded=function(node){return node&&node.firstChild&&node.firstChild===node.lastChild&&function(node){return"Â "===node.data||isBr$5(node)}(node.firstChild)},trimListItems=function(elms){return elms.length>0&&(!(elm=elms[elms.length-1]).firstChild||isListItemPadded(elm))?elms.slice(0,-1):elms;var elm},getParentLi=function(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&"LI"===parentBlock.nodeName?parentBlock:null},findLastOf=function(node,rootNode){var caretPos=CaretPosition.after(node),newCaretPos=CaretWalker(rootNode).prev(caretPos);return newCaretPos?newCaretPos.toRange():null},insertBefore$1=function(target,elms,rootNode){var parentElm=target.parentNode;return Tools.each(elms,(function(elm){parentElm.insertBefore(elm,target)})),function(node,rootNode){var caretPos=CaretPosition.before(node),newCaretPos=CaretWalker(rootNode).next(caretPos);return newCaretPos?newCaretPos.toRange():null}(target,rootNode)},insertAtCaret$1=function(serializer,dom,rng,fragment){var elm,domFragment=function(dom,serializer,fragment){var html=serializer.serialize(fragment);return function(domFragment){var firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&firstChild.parentNode.removeChild(firstChild),lastChild&&"mce_marker"===lastChild.id&&lastChild.parentNode.removeChild(lastChild),domFragment}(dom.createFragment(html))}(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),liElms=trimListItems((elm=domFragment.firstChild,filter$4(elm.childNodes,(function(child){return"LI"===child.nodeName})))),rootNode=dom.getRoot(),isAt=function(location){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=CaretWalker(dom.getRoot()),newPos=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos);return!newPos||getParentLi(dom,newPos.getNode())!==liTarget};return isAt(1)?insertBefore$1(liTarget,liElms,rootNode):isAt(2)?function(target,elms,rootNode,dom){return dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)}(liTarget,liElms,rootNode,dom):function(target,elms,rootNode,rng){var parts=function(parentNode,rng){var beforeRng=rng.cloneRange(),afterRng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),afterRng.setEndAfter(parentNode),[beforeRng.cloneContents(),afterRng.cloneContents()]}(target,rng),parentElm=target.parentNode;return parentElm.insertBefore(parts[0],target),Tools.each(elms,(function(li){parentElm.insertBefore(li,target)})),parentElm.insertBefore(parts[1],target),parentElm.removeChild(target),findLastOf(elms[elms.length-1],rootNode)}(liTarget,liElms,rootNode,rng)},isTableCell$1=isTableCell$5,deleteSelectedContent=function(editor){var dom=editor.dom,rng=normalize(editor.selection.getRng());editor.selection.setRng(rng);var startCell=dom.getParent(rng.startContainer,isTableCell$1);!function(dom,rng,cell){return null!==cell&&cell===dom.getParent(rng.endContainer,isTableCell$1)&&hasAllContentsSelected(SugarElement.fromDom(cell),rng)}(dom,rng,startCell)?editor.getDoc().execCommand("Delete",!1,null):deleteCellContents(editor,rng,SugarElement.fromDom(startCell))},insertHtmlAtCaret=function(editor,value,details){var parentNode,rng,node,selection=editor.selection,dom=editor.dom;/^ | $/.test(value)&&(value=function(dom,rng,html){var root=SugarElement.fromDom(dom.getRoot());return html=needsToBeNbspLeft(root,CaretPosition.fromRangeStart(rng))?html.replace(/^ /,"&nbsp;"):html.replace(/^&nbsp;/," "),needsToBeNbspRight(root,CaretPosition.fromRangeEnd(rng))?html.replace(/(&nbsp;| )(<br( \/)>)?$/,"&nbsp;"):html.replace(/&nbsp;(<br( \/)?>)?$/," ")}(dom,selection.getRng(),value));var parser=editor.parser,merge=details.merge,serializer=HtmlSerializer({validate:shouldValidate(editor)},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>',args=editor.fire("BeforeSetContent",{content:value,format:"html",selection:!0,paste:details.paste});if(args.isDefaultPrevented())editor.fire("SetContent",{content:args.content,format:"html",selection:!0,paste:details.paste});else{-1===(value=args.content).indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);var caretElement=(rng=selection.getRng()).startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&function(editor,node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}(editor,body.firstChild)&&dom.isEmpty(body.firstChild)&&((rng=dom.createRng()).setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||deleteSelectedContent(editor);var elm,parserArgs={context:(parentNode=selection.getNode()).nodeName.toLowerCase(),data:details.data,insert:!0},fragment=parser.parse(value,parserArgs);if(!0===details.paste&&function(schema,fragment){var firstChild=fragment.firstChild,lastChild=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),lastChild&&"mce_marker"===lastChild.attr("id")&&(lastChild=lastChild.prev),function(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node&&(node.isEmpty(nonEmptyElements)||function(schema,node){return schema.getBlockElements()[node.name]&&function(node){return node.firstChild&&node.firstChild===node.lastChild}(node)&&function(node){return"br"===node.name||"Â "===node.value}(node.firstChild)}(schema,node))}(schema,lastChild)&&(lastChild=lastChild.prev),!(!firstChild||firstChild!==lastChild||"ul"!==firstChild.name&&"ol"!==firstChild.name)}(editor.schema,fragment)&&function(dom,node){return!!getParentLi(dom,node)}(dom,parentNode))return rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment),selection.setRng(rng),void editor.fire("SetContent",args);if(function(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")}(fragment),"mce_marker"===(node=fragment.lastChild).attr("id")){var marker=node;for(node=node.prev;node;node=node.walk(!0))if(3===node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid){editor.selection.setContent(bookmarkHtml),parentNode=selection.getNode();var rootNode=editor.getBody();for(9===parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)parentNode=node,node=node.parentNode;value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,(function(){return serializer.serialize(fragment)})))),parentNode===rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else!function(editor,value,parentNode){if("all"===parentNode.getAttribute("data-mce-bogus"))parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);else{var node=parentNode.firstChild,node2=parentNode.lastChild;!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value)}}(editor,value=serializer.serialize(fragment),parentNode);!function(editor,merge){var textInlineElements=editor.schema.getTextInlineElements(),dom=editor.dom;if(merge){var root_1=editor.getBody(),elementUtils_1=ElementUtils(dom);Tools.each(dom.select("*[data-mce-fragment]"),(function(node){if(isNonNullable(textInlineElements[node.nodeName.toLowerCase()])&&hasInheritableStyles(dom,node))for(var parentNode=node.parentNode;isNonNullable(parentNode)&&parentNode!==root_1&&!hasStyleConflict(dom,node,parentNode);parentNode=parentNode.parentNode)if(elementUtils_1.compare(parentNode,node)){dom.remove(node,!0);break}}))}}(editor,merge),function(editor,marker){var nextRng,dom=editor.dom,selection=editor.selection;if(marker){selection.scrollIntoView(marker);var parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if("false"===dom.getContentEditable(parentEditableElm))return dom.remove(marker),void selection.select(parentEditableElm);var rng=dom.createRng(),node=marker.previousSibling;if(isText$7(node)){if(rng.setStart(node,node.nodeValue.length),!Env.ie){var node2=marker.nextSibling;isText$7(node2)&&(node.appendData(node2.data),node2.parentNode.removeChild(node2))}}else rng.setStartBefore(marker),rng.setEndBefore(marker);var parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)&&(editor.$(parentBlock).empty(),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isTableCell$1(parentBlock)||function(node){return!!node.getAttribute("data-mce-fragment")}(parentBlock)||!(nextRng=function(rng){var caretPos=CaretPosition.fromRangeStart(rng);if(caretPos=CaretWalker(editor.getBody()).next(caretPos))return caretPos.toRange()}(rng))?dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))),selection.setRng(rng)}}(editor,dom.get("mce_marker")),elm=editor.getBody(),Tools.each(elm.getElementsByTagName("*"),(function(elm){elm.removeAttribute("data-mce-fragment")})),function(dom,elm){Optional.from(dom.getParent(elm,"td,th")).map(SugarElement.fromDom).each(trimBlockTrailingBr)}(dom,selection.getStart()),editor.fire("SetContent",args),editor.addVisual()}},traverse=function(node,fn){fn(node),node.firstChild&&traverse(node.firstChild,fn),node.next&&traverse(node.next,fn)},filter$1=function(nodeFilters,attributeFilters,node){var matches=function(nodeFilters,attributeFilters,node){var nodeMatches={},attrMatches={},matches=[];for(var name_1 in node.firstChild&&traverse(node.firstChild,(function(node){each$k(nodeFilters,(function(filter){filter.name===node.name&&(nodeMatches[filter.name]?nodeMatches[filter.name].nodes.push(node):nodeMatches[filter.name]={filter:filter,nodes:[node]})})),each$k(attributeFilters,(function(filter){"string"==typeof node.attr(filter.name)&&(attrMatches[filter.name]?attrMatches[filter.name].nodes.push(node):attrMatches[filter.name]={filter:filter,nodes:[node]})}))})),nodeMatches)has$2(nodeMatches,name_1)&&matches.push(nodeMatches[name_1]);for(var name_2 in attrMatches)has$2(attrMatches,name_2)&&matches.push(attrMatches[name_2]);return matches}(nodeFilters,attributeFilters,node);each$k(matches,(function(match){each$k(match.filter.callbacks,(function(callback){callback(match.nodes,match.filter.name,{})}))}))},isTreeNode=function(content){return content instanceof AstNode},setEditorHtml=function(editor,html,noSelection){editor.dom.setHTML(editor.getBody(),html),!0!==noSelection&&function(editor){hasFocus(editor)&&firstPositionIn(editor.getBody()).each((function(pos){var node=pos.getNode(),caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange())}))}(editor)},setContentInternal=function(editor,content,args){var defaultedArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,content:isTreeNode(content)?"":content})}(args,content),updatedArgs=args.no_events?defaultedArgs:editor.fire("BeforeSetContent",defaultedArgs);return isTreeNode(content)||(content=updatedArgs.content),Optional.from(editor.getBody()).fold(constant(content),(function(body){return isTreeNode(content)?function(editor,body,content,args){filter$1(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:editor.validate},editor.schema).serialize(content);return args.content=isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html),setEditorHtml(editor,args.content,args.no_selection),args.no_events||editor.fire("SetContent",args),content}(editor,body,content,updatedArgs):function(editor,body,content,args){if(0===content.length||/^\s+$/.test(content)){var padd='<br data-mce-bogus="1">';"TABLE"===body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>");var forcedRootBlockName=getForcedRootBlock(editor);forcedRootBlockName&&editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content)):content||(content='<br data-mce-bogus="1">'),setEditorHtml(editor,content,args.no_selection),editor.fire("SetContent",args)}else"raw"!==args.format&&(content=HtmlSerializer({validate:editor.validate},editor.schema).serialize(editor.parser.parse(content,{isRootContent:!0,insert:!0}))),args.content=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content),setEditorHtml(editor,args.content,args.no_selection),args.no_events||editor.fire("SetContent",args);return args.content}(editor,body,content,updatedArgs)}))},sibling=function(scope,predicate){return function(scope,predicate){var element=scope.dom;return element.parentNode?child(SugarElement.fromDom(element.parentNode),(function(x){return!eq(scope,x)&&predicate(x)})):Optional.none()}(scope,predicate).isSome()},ensureIsRoot=function(isRoot){return isFunction(isRoot)?isRoot:never},closest$1=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk((function(){return stop(scope)?Optional.none():function(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()}(scope,transform,stop)}))},isEq$3=isEq$5,matchesUnInheritedFormatSelector=function(ed,node,name){var formatList=ed.formatter.get(name);if(formatList)for(var i=0;i<formatList.length;i++){var format=formatList[i];if(isSelectorFormat(format)&&!1===format.inherit&&ed.dom.is(node,format.selector))return!0}return!1},matchParents=function(editor,node,name,vars,similar){var root=editor.dom.getRoot();return node!==root&&(node=editor.dom.getParent(node,(function(node){return!!matchesUnInheritedFormatSelector(editor,node,name)||(node.parentNode===root||!!matchNode(editor,node,name,vars,!0))})),!!matchNode(editor,node,name,vars,similar))},matchName$1=function(dom,node,format){return!!isEq$3(node,format.inline)||(!!isEq$3(node,format.block)||(format.selector?1===node.nodeType&&dom.is(node,format.selector):void 0))},matchItems=function(dom,node,format,itemName,similar,vars){var items=format[itemName];if(isFunction(format.onmatch))return format.onmatch(node,format,itemName);if(items)if(isUndefined(items.length)){for(var key in items)if(has$2(items,key)){var value="attributes"===itemName?dom.getAttrib(node,key):getStyle(dom,node,key),expectedValue=replaceVars(items[key],vars),isEmptyValue=isNullable(value)||isEmpty$3(value);if(isEmptyValue&&isNullable(expectedValue))continue;if(similar&&isEmptyValue&&!format.exact)return!1;if((!similar||format.exact)&&!isEq$3(value,normalizeStyleValue(dom,expectedValue,key)))return!1}}else for(var i=0;i<items.length;i++)if("attributes"===itemName?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i]))return!0;return!0},matchNode=function(ed,node,name,vars,similar){var formatList=ed.formatter.get(name),dom=ed.dom;if(formatList&&node)for(var i=0;i<formatList.length;i++){var format=formatList[i];if(matchName$1(ed.dom,node,format)&&matchItems(dom,node,format,"attributes",similar,vars)&&matchItems(dom,node,format,"styles",similar,vars)){var classes=format.classes;if(classes)for(var x=0;x<classes.length;x++)if(!ed.dom.hasClass(node,replaceVars(classes[x],vars)))return;return format}}},match$2=function(editor,name,vars,node,similar){if(node)return matchParents(editor,node,name,vars,similar);if(node=editor.selection.getNode(),matchParents(editor,node,name,vars,similar))return!0;var startNode=editor.selection.getStart();return!(startNode===node||!matchParents(editor,startNode,name,vars,similar))},closest=function(editor,names){var isRoot=function(elm){return eq(elm,SugarElement.fromDom(editor.getBody()))};return Optional.from(editor.selection.getStart(!0)).bind((function(rawElm){return closest$1(SugarElement.fromDom(rawElm),(function(elm){return findMap(names,(function(name){return function(elm,name){return matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none()}(elm,name)}))}),isRoot)})).getOrNull()},matchAllOnNode=function(editor,node,formatNames){return foldl(formatNames,(function(acc,name){var matchSimilar=function(editor,formatName){return exists(editor.formatter.get(formatName),(function(format){var isVariableValue=function(val){return val.length>1&&"%"===val.charAt(0)};return exists(["styles","attributes"],(function(key){return get$9(format,key).exists((function(field){var fieldValues=isArray$1(field)?field:values(field);return exists(fieldValues,isVariableValue)}))}))}))}(editor,name);return editor.formatter.matchNode(node,name,{},matchSimilar)?acc.concat([name]):acc}),[])},isCaretContainerEmpty=function(node){return function(node){for(var nodes=[];node;){if(3===node.nodeType&&"\ufeff"!==node.nodeValue||node.childNodes.length>1)return[];1===node.nodeType&&nodes.push(node),node=node.firstChild}return nodes}(node).length>0},findFirstTextNode=function(node){if(node){var walker=new DomTreeWalker(node,node);for(node=walker.current();node;node=walker.next())if(isText$7(node))return node}return null},createCaretContainer=function(fill){var caretContainer=SugarElement.fromTag("span");return setAll$1(caretContainer,{id:"_mce_caret","data-mce-bogus":"1","data-mce-type":"format-caret"}),fill&&append$1(caretContainer,SugarElement.fromText("\ufeff")),caretContainer},removeCaretContainerNode=function(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node))deleteElement$2(editor,!1,SugarElement.fromDom(node),moveCaret);else{var rng=selection.getRng(),block=dom.getParent(node,dom.isBlock),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,textNode=function(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);return textNode&&"\ufeff"===textNode.nodeValue.charAt(0)&&textNode.deleteData(0,1),textNode}(node);dom.remove(node,!0),startContainer===textNode&&startOffset>0&&rng.setStart(textNode,startOffset-1),endContainer===textNode&&endOffset>0&&rng.setEnd(textNode,endOffset-1),block&&dom.isEmpty(block)&&fillWithPaddingBr(SugarElement.fromDom(block)),selection.setRng(rng)}},removeCaretContainer=function(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(node)removeCaretContainerNode(editor,node,moveCaret);else if(!(node=getParentCaretContainer(editor.getBody(),selection.getStart())))for(;node=dom.get("_mce_caret");)removeCaretContainerNode(editor,node,!1)},appendNode=function(parentNode,node){return parentNode.appendChild(node),node},insertFormatNodesIntoCaretContainer=function(formatNodes,caretContainer){var innerMostFormatNode=foldr(formatNodes,(function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(!1))}),caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode("\ufeff"))},removeCaretFormat=function(editor,name,vars,similar){var hasContentAfter,node,formatNode,dom=editor.dom,selection=editor.selection,parents=[],rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset;for(node=container,3===container.nodeType&&(offset!==container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(matchNode(editor,node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter){var bookmark=selection.getBookmark();rng.collapse(!0);var expandedRng=expandRng(editor,rng,editor.formatter.get(name),!0);expandedRng=split(expandedRng),editor.formatter.remove(name,vars,expandedRng,similar),selection.moveToBookmark(bookmark)}else{var caretContainer=getParentCaretContainer(editor.getBody(),formatNode),newCaretContainer=createCaretContainer(!1).dom;!function(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,curry(isTextBlock$1,editor));block&&dom.isEmpty(block)?formatNode.parentNode.replaceChild(caretContainer,formatNode):(removeTrailingBr(SugarElement.fromDom(formatNode)),dom.isEmpty(formatNode)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode))}(editor,newCaretContainer,null!==caretContainer?caretContainer:formatNode);var cleanedFormatNode=function(editor,caretContainer,formatNode,name,vars,similar){var formatter=editor.formatter,dom=editor.dom,validFormats=filter$4(keys(formatter.get()),(function(formatName){return formatName!==name&&!contains$2(formatName,"removeformat")})),matchedFormats=matchAllOnNode(editor,formatNode,validFormats);if(filter$4(matchedFormats,(function(fmtName){return!areSimilarFormats(editor,fmtName,name)})).length>0){var clonedFormatNode=formatNode.cloneNode(!1);return dom.add(caretContainer,clonedFormatNode),formatter.remove(name,vars,clonedFormatNode,similar),dom.remove(clonedFormatNode),Optional.some(clonedFormatNode)}return Optional.none()}(editor,newCaretContainer,formatNode,name,vars,similar),caretTextNode=insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()),newCaretContainer);removeCaretContainerNode(editor,caretContainer,!1),selection.setCursorLocation(caretTextNode,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}},setup$k=function(editor){editor.on("mouseup keydown",(function(e){!function(editor,keyCode){var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,!1),8!==keyCode&&46!==keyCode||!selection.isCollapsed()||"\ufeff"!==selection.getStart().innerHTML||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart())),37!==keyCode&&39!==keyCode||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()))}(editor,e.keyCode)}))},isFormatElement=function(editor,element){var inlineElements=editor.schema.getTextInlineElements();return has$2(inlineElements,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom)},postProcessHooks={},filter=filter$2,each$b=each$i;!function(name,hook){postProcessHooks[name]||(postProcessHooks[name]=[]),postProcessHooks[name].push(hook)}("pre",(function(editor){var blocks,rng=editor.selection.getRng(),isPre=matchNodeNames(["pre"]);rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each$b(filter(filter(blocks,isPre),(function(pre){return isPre(pre.previousSibling)&&-1!==indexOf$1(blocks,pre.previousSibling)})),(function(pre){var pre1,pre2;pre1=pre.previousSibling,DomQuery(pre2=pre).remove(),DomQuery(pre1).append("<br><br>").append(pre2.childNodes)})))}));var each$a=Tools.each,isElementNode$1=function(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node)},findElementSibling=function(node,siblingName){for(var sibling=node;sibling;sibling=sibling[siblingName]){if(isText$7(sibling)&&isNotEmpty(sibling.data))return node;if(isElement$5(sibling)&&!isBookmarkNode$1(sibling))return sibling}return node},mergeSiblingsNodes=function(dom,prev,next){var elementUtils=ElementUtils(dom);if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(var sibling=prev.nextSibling;sibling&&sibling!==next;){var tmpSibling=sibling;sibling=sibling.nextSibling,prev.appendChild(tmpSibling)}return dom.remove(next),Tools.each(Tools.grep(next.childNodes),(function(node){prev.appendChild(node)})),prev}return next},mergeSiblings=function(dom,format,vars,node){if(node&&!1!==format.merge_siblings){var newNode=mergeSiblingsNodes(dom,getNonWhiteSpaceSibling(node),node);mergeSiblingsNodes(dom,newNode,getNonWhiteSpaceSibling(newNode,!0))}},processChildElements=function(node,filter,process){each$a(node.childNodes,(function(node){isElementNode$1(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))}))},hasStyle=function(dom,name){return function(node){return!(!node||!getStyle(dom,node,name))}},applyStyle=function(dom,name,value){return function(node){dom.setStyle(node,name,value),""===node.getAttribute("style")&&node.removeAttribute("style"),function(dom,node){"SPAN"===node.nodeName&&0===dom.getAttribs(node).length&&dom.remove(node,!0)}(dom,node)}},removeResult=Adt_generate([{keep:[]},{rename:["name"]},{removed:[]}]),MCE_ATTR_RE=/^(src|href|style)$/,each$9=Tools.each,isEq$2=isEq$5,isChildOfInlineParent=function(dom,node,parent){return dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent)},getContainer=function(ed,rng,start){var container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"];if(isElement$5(container)){var lastIdx=container.childNodes.length-1;!start&&offset&&offset--,container=container.childNodes[offset>lastIdx?lastIdx:offset]}return isText$7(container)&&start&&offset>=container.nodeValue.length&&(container=new DomTreeWalker(container,ed.getBody()).next()||container),isText$7(container)&&!start&&0===offset&&(container=new DomTreeWalker(container,ed.getBody()).prev()||container),container},normalizeTableSelection=function(node,start){var prop=start?"firstChild":"lastChild";if(function(node){return/^(TR|TH|TD)$/.test(node.nodeName)}(node)&&node[prop]){var childNode=node[prop];return"TR"===node.nodeName&&childNode[prop]||childNode}return node},wrap$1=function(dom,node,name,attrs){var wrapper=dom.create(name,attrs);return node.parentNode.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper},wrapWithSiblings=function(dom,node,next,name,attrs){var start=SugarElement.fromDom(node),wrapper=SugarElement.fromDom(dom.create(name,attrs)),siblings=next?nextSiblings(start):prevSiblings(start);return append(wrapper,siblings),next?(before$4(start,wrapper),prepend(wrapper,start)):(after$3(start,wrapper),append$1(wrapper,start)),wrapper.dom},find=function(dom,node,next,inc){var sibling=getNonWhiteSpaceSibling(node,next,inc);return isNullable(sibling)||"BR"===sibling.nodeName||dom.isBlock(sibling)},removeNode=function(ed,node,format){var rootBlockElm,parentNode=node.parentNode,dom=ed.dom,forcedRootBlock=getForcedRootBlock(ed);isBlockFormat(format)&&(forcedRootBlock?parentNode===dom.getRoot()&&(format.list_block&&isEq$2(node,format.list_block)||each$k(from(node.childNodes),(function(node){isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap$1(dom,node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=null}))):dom.isBlock(node)&&!dom.isBlock(parentNode)&&(find(dom,node,!1)||find(dom,node.firstChild,!0,!0)||node.insertBefore(dom.create("br"),node.firstChild),find(dom,node,!0)||find(dom,node.lastChild,!1,!0)||node.appendChild(dom.create("br")))),function(format){return isSelectorFormat(format)&&isInlineFormat(format)&&is$1(get$9(format,"mixed"),!0)}(format)&&!isEq$2(format.inline,node)||dom.remove(node,!0)},removeFormatInternal=function(ed,format,vars,node,compareNode){var stylesModified,dom=ed.dom;if(!function(dom,node,format){return!(!isInlineFormat(format)||!isEq$2(node,format.inline))||!(!isBlockFormat(format)||!isEq$2(node,format.block))||(isSelectorFormat(format)?isElement$5(node)&&dom.is(node,format.selector):void 0)}(dom,node,format)&&!function(node,format){return format.links&&"A"===node.nodeName}(node,format))return removeResult.keep();var elm=node;if(isInlineFormat(format)&&"all"===format.remove&&isArray$1(format.preserve_attributes)){var attrsToPreserve=filter$4(dom.getAttribs(elm),(function(attr){return contains$3(format.preserve_attributes,attr.name.toLowerCase())}));if(dom.removeAllAttribs(elm),each$k(attrsToPreserve,(function(attr){return dom.setAttrib(elm,attr.name,attr.value)})),attrsToPreserve.length>0)return removeResult.rename("span")}if("all"!==format.remove){each$9(format.styles,(function(value,name){value=normalizeStyleValue(dom,replaceVars(value,vars),name+""),isNumber(name)&&(name=value,compareNode=null),(format.remove_similar||!compareNode||isEq$2(getStyle(dom,compareNode,name),value))&&dom.setStyle(elm,name,""),stylesModified=!0})),stylesModified&&""===dom.getAttrib(elm,"style")&&(elm.removeAttribute("style"),elm.removeAttribute("data-mce-style")),each$9(format.attributes,(function(value,name){var valueOut;if(value=replaceVars(value,vars),isNumber(name)&&(name=value,compareNode=null),format.remove_similar||!compareNode||isEq$2(dom.getAttrib(compareNode,name),value)){if("class"===name&&(value=dom.getAttrib(elm,name))&&(valueOut="",each$k(value.split(/\s+/),(function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)})),valueOut))return void dom.setAttrib(elm,name,valueOut);if(MCE_ATTR_RE.test(name)&&elm.removeAttribute("data-mce-"+name),"style"===name&&matchNodeNames(["li"])(elm)&&"none"===dom.getStyle(elm,"list-style-type"))return elm.removeAttribute(name),void dom.setStyle(elm,"list-style-type","none");"class"===name&&elm.removeAttribute("className"),elm.removeAttribute(name)}})),each$9(format.classes,(function(value){value=replaceVars(value,vars),compareNode&&!dom.hasClass(compareNode,value)||dom.removeClass(elm,value)}));for(var attrs=dom.getAttribs(elm),i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(0!==attrName.indexOf("_")&&0!==attrName.indexOf("data-"))return removeResult.keep()}}return"none"!==format.remove?(removeNode(ed,elm,format),removeResult.removed()):removeResult.keep()},removeFormat$1=function(ed,format,vars,node,compareNode){return removeFormatInternal(ed,format,vars,node,compareNode).fold(never,(function(newName){return ed.dom.rename(node,newName),!0}),always)},removeFormatFromClone=function(editor,format,vars,clone){return removeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),(function(newName){return editor.dom.createFragment().appendChild(clone),editor.dom.rename(clone,newName)}),constant(null))},remove$1=function(ed,name,vars,node,similar){var formatList=ed.formatter.get(name),format=formatList[0],contentEditable=!0,dom=ed.dom,selection=ed.selection,splitToFormatRoot=function(container){var formatRoot=function(editor,container,name,vars,similar){var formatRoot;return each$k(getParents$2(editor.dom,container.parentNode).reverse(),(function(parent){if(!formatRoot&&"_start"!==parent.id&&"_end"!==parent.id){var format=matchNode(editor,parent,name,vars,similar);format&&!1!==format.split&&(formatRoot=parent)}})),formatRoot}(ed,container,name,vars,similar);return function(editor,formatList,formatRoot,container,target,split,format,vars){var clone,lastClone,firstClone,dom=editor.dom;if(formatRoot){for(var formatRootParent=formatRoot.parentNode,parent_1=container.parentNode;parent_1&&parent_1!==formatRootParent;parent_1=parent_1.parentNode){clone=dom.clone(parent_1,!1);for(var i=0;i<formatList.length&&null!==(clone=removeFormatFromClone(editor,formatList[i],vars,clone));i++);clone&&(lastClone&&clone.appendChild(lastClone),firstClone||(firstClone=clone),lastClone=clone)}!split||format.mixed&&dom.isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target),isInlineFormat(format)&&mergeSiblings(dom,format,0,lastClone))}return container}(ed,formatList,formatRoot,container,container,!0,format,vars)},removeNodeFormat=function(node){return exists(formatList,(function(fmt){return removeFormat$1(ed,fmt,vars,node,node)}))},process=function(node){var lastContentEditable=!0,hasContentEditableState=!1;isElement$5(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0);var children=from(node.childNodes);if(contentEditable&&!hasContentEditableState){var currentNodeMatches=removeNodeFormat(node)||exists(formatList,(function(f){return matchName$1(dom,node,f)})),parentNode=node.parentNode;!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&removeNodeFormat(parentNode)}if(format.deep&&children.length){for(var i=0;i<children.length;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}each$k(["underline","line-through","overline"],(function(decoration){isElement$5(node)&&ed.dom.getStyle(node,"text-decoration")===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration&&removeFormat$1(ed,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:decoration}},null,node)}))},unwrap=function(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return function(node){return isBookmarkNode$1(node)&&isElement$5(node)&&("_start"===node.id||"_end"===node.id)}(out)&&(out=out[start?"firstChild":"lastChild"]),isText$7(out)&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out},removeRngStyle=function(rng){var startContainer,endContainer,expandedRng=expandRng(ed,rng,formatList,rng.collapsed);if(format.split){if(expandedRng=split(expandedRng),(startContainer=getContainer(ed,expandedRng,!0))!==(endContainer=getContainer(ed,expandedRng))){if(startContainer=normalizeTableSelection(startContainer,!0),endContainer=normalizeTableSelection(endContainer,!1),isChildOfInlineParent(dom,startContainer,endContainer)){var marker=Optional.from(startContainer.firstChild).getOr(startContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!0,"span",{id:"_start","data-mce-type":"bookmark"})),void unwrap(!0)}if(isChildOfInlineParent(dom,endContainer,startContainer)){marker=Optional.from(endContainer.lastChild).getOr(endContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!1,"span",{id:"_end","data-mce-type":"bookmark"})),void unwrap(!1)}startContainer=wrap$1(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap$1(dom,endContainer,"span",{id:"_end","data-mce-type":"bookmark"});var newRng=dom.createRng();newRng.setStartAfter(startContainer),newRng.setEndBefore(endContainer),walk$2(dom,newRng,(function(nodes){each$k(nodes,(function(n){isBookmarkNode$1(n)||isBookmarkNode$1(n.parentNode)||splitToFormatRoot(n)}))})),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(!0),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,expandedRng.startOffset=dom.nodeIndex(startContainer),expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,expandedRng.endOffset=dom.nodeIndex(endContainer)+1}walk$2(dom,expandedRng,(function(nodes){each$k(nodes,process)}))};if(node){if(isNode(node)){var rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)}else removeRngStyle(node);fireFormatRemove(ed,name,node,vars)}else if("false"!==dom.getContentEditable(selection.getNode()))selection.isCollapsed()&&isInlineFormat(format)&&!getCellsFromEditor(ed).length?removeCaretFormat(ed,name,vars,similar):(preserve(selection,!0,(function(){runOnRanges(ed,removeRngStyle)})),isInlineFormat(format)&&match$2(ed,name,vars,selection.getStart())&&moveStart(dom,selection,selection.getRng()),ed.nodeChanged()),fireFormatRemove(ed,name,node,vars);else{node=selection.getNode();for(var i=0;i<formatList.length&&(!formatList[i].ceFalseOverride||!removeFormat$1(ed,formatList[i],vars,node,node));i++);fireFormatRemove(ed,name,node,vars)}},each$8=Tools.each,mergeWithChildren=function(editor,formatList,vars,node){each$8(formatList,(function(format){isInlineFormat(format)&&each$8(editor.dom.select(format.inline,node),(function(child){isElementNode$1(child)&&removeFormat$1(editor,format,vars,child,format.exact?child:null)})),function(dom,format,node){if(format.clear_child_styles){var selector=format.links?"*:not(a)":"*";each$a(dom.select(selector,node),(function(node){isElementNode$1(node)&&each$a(format.styles,(function(value,name){dom.setStyle(node,name,"")}))}))}}(editor.dom,format,node)}))},each$7=Tools.each,isElementNode=function(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node)},applyFormat$1=function(ed,name,vars,node){var formatList=ed.formatter.get(name),format=formatList[0],isCollapsed=!node&&ed.selection.isCollapsed(),dom=ed.dom,selection=ed.selection,setElementFormat=function(elm,fmt){if(void 0===fmt&&(fmt=format),isFunction(fmt.onformat)&&fmt.onformat(elm,fmt,vars,node),each$7(fmt.styles,(function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))})),fmt.styles){var styleVal=dom.getAttrib(elm,"style");styleVal&&dom.setAttrib(elm,"data-mce-style",styleVal)}each$7(fmt.attributes,(function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))})),each$7(fmt.classes,(function(value){value=replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)}))},applyNodeStyle=function(formatList,node){var found=!1;return each$7(formatList,(function(format){return!!isSelectorFormat(format)&&(isNonNullable(format.collapsed)&&format.collapsed!==isCollapsed?void 0:dom.is(node,format.selector)&&!isCaretNode(node)?(setElementFormat(node,format),found=!0,!1):void 0)})),found},createWrapElement=function(wrapName){if(isString$1(wrapName)){var wrapElm=dom.create(wrapName);return setElementFormat(wrapElm),wrapElm}return null},applyRngStyle=function(dom,rng,nodeSpecific){var newWrappers=[],contentEditable=!0,wrapName=format.inline||format.block,wrapElm=createWrapElement(wrapName);walk$2(dom,rng,(function(nodes){var currentWrapElm,process=function(node){var hasContentEditableState=!1,lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentNode=node.parentNode,parentName=parentNode.nodeName.toLowerCase();if(isElement$5(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),isBr$5(node)&&!function(editor,format,node,parentName){if(function(editor){return editor.getParam("format_empty_lines",!1,"boolean")}(editor)&&isInlineFormat(format)){var validBRParentElements=__assign(__assign({},editor.schema.getTextBlockElements()),{td:{},th:{},li:{},dt:{},dd:{},figcaption:{},caption:{},details:{},summary:{}}),hasCaretNodeSibling=sibling(SugarElement.fromDom(node),(function(sibling){return isCaretNode(sibling.dom)}));return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),!1)&&!hasCaretNodeSibling}return!1}(ed,format,node,parentName))return currentWrapElm=null,void(isBlockFormat(format)&&dom.remove(node));if(isBlockFormat(format)&&format.wrapper&&matchNode(ed,node,name,vars))currentWrapElm=null;else{if(contentEditable&&!hasContentEditableState&&isBlockFormat(format)&&!format.wrapper&&isTextBlock$1(ed,nodeName)&&isValid(ed,parentName,wrapName)){var elm=dom.rename(node,wrapName);return setElementFormat(elm),newWrappers.push(elm),void(currentWrapElm=null)}if(isSelectorFormat(format)){var found=applyNodeStyle(formatList,node);if(!found&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&(found=applyNodeStyle(formatList,parentNode)),!isInlineFormat(format)||found)return void(currentWrapElm=null)}!contentEditable||hasContentEditableState||!isValid(ed,wrapName,nodeName)||!isValid(ed,parentName,wrapName)||!nodeSpecific&&isText$7(node)&&isZwsp(node.data)||isCaretNode(node)||isInlineFormat(format)&&dom.isBlock(node)?(currentWrapElm=null,each$k(from(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=null):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,!1),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node))}};each$k(nodes,process)})),!0===format.links&&each$k(newWrappers,(function(node){var process=function(node){"A"===node.nodeName&&setElementFormat(node,format),each$k(from(node.childNodes),process)};process(node)})),each$k(newWrappers,(function(node){var childCount=function(node){var count=0;return each$k(node.childNodes,(function(node){(function(node){return isNonNullable(node)&&isText$7(node)&&0===node.length})(node)||isBookmarkNode$1(node)||count++})),count}(node);!(newWrappers.length>1)&&dom.isBlock(node)||0!==childCount?(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper)&&(format.exact||1!==childCount||(node=function(node){return find$3(node.childNodes,isElementNode).filter((function(child){return matchName$1(dom,child,format)})).map((function(child){var clone=dom.clone(child,!1);return setElementFormat(clone),dom.replace(clone,node,!0),dom.remove(child,!0),clone})).getOr(node)}(node)),mergeWithChildren(ed,formatList,vars,node),function(editor,format,name,vars,node){matchNode(editor,node.parentNode,name,vars)&&removeFormat$1(editor,format,vars,node)||format.merge_with_parents&&editor.dom.getParent(node.parentNode,(function(parent){if(matchNode(editor,parent,name,vars))return removeFormat$1(editor,format,vars,node),!0}))}(ed,format,name,vars,node),function(dom,format,vars,node){format.styles&&format.styles.backgroundColor&&processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"backgroundColor",replaceVars(format.styles.backgroundColor,vars)))}(dom,format,vars,node),function(dom,format,vars,node){var processTextDecorationsAndColor=function(n){if(1===n.nodeType&&n.parentNode&&1===n.parentNode.nodeType){var textDecoration=getTextDecoration(dom,n.parentNode);dom.getStyle(n,"color")&&textDecoration?dom.setStyle(n,"text-decoration",textDecoration):dom.getStyle(n,"text-decoration")===textDecoration&&dom.setStyle(n,"text-decoration",null)}};format.styles&&(format.styles.color||format.styles.textDecoration)&&(Tools.walk(node,processTextDecorationsAndColor,"childNodes"),processTextDecorationsAndColor(node))}(dom,format,0,node),function(dom,format,vars,node){!isInlineFormat(format)||"sub"!==format.inline&&"sup"!==format.inline||(processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"fontSize","")),dom.remove(dom.select("sup"===format.inline?"sub":"sup",node),!0))}(dom,format,0,node),mergeSiblings(dom,format,0,node)):dom.remove(node,!0)}))};if("false"!==dom.getContentEditable(selection.getNode())){if(format){if(node)if(isNode(node)){if(!applyNodeStyle(formatList,node)){var rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),applyRngStyle(dom,expandRng(ed,rng,formatList),!0)}}else applyRngStyle(dom,node,!0);else if(isCollapsed&&isInlineFormat(format)&&!getCellsFromEditor(ed).length)!function(editor,name,vars){var caretContainer,textNode,selection=editor.selection,selectionRng=selection.getRng(),offset=selectionRng.startOffset,text=selectionRng.startContainer.nodeValue;(caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart()))&&(textNode=findFirstTextNode(caretContainer));var ownerDocument,node,wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){var bookmark=selection.getBookmark();selectionRng.collapse(!0);var rng=expandRng(editor,selectionRng,editor.formatter.get(name));rng=split(rng),editor.formatter.apply(name,vars,rng),selection.moveToBookmark(bookmark)}else caretContainer&&"\ufeff"===textNode.nodeValue||(ownerDocument=editor.getDoc(),node=createCaretContainer(!0).dom,textNode=(caretContainer=ownerDocument.importNode(node,!0)).firstChild,selectionRng.insertNode(caretContainer),offset=1),editor.formatter.apply(name,vars,caretContainer),selection.setCursorLocation(textNode,offset)}(ed,name,vars);else{var curSelNode=selection.getNode(),firstFormat=formatList[0];ed.settings.forced_root_block||!firstFormat.defaultBlock||dom.getParent(curSelNode,dom.isBlock)||applyFormat$1(ed,firstFormat.defaultBlock),selection.setRng(normalize(selection.getRng())),preserve(selection,!0,(function(){runOnRanges(ed,(function(selectionRng,fake){var expandedRng=fake?selectionRng:expandRng(ed,selectionRng,formatList);applyRngStyle(dom,expandedRng,!1)}))})),moveStart(dom,selection,selection.getRng()),ed.nodeChanged()}!function(name,editor){each$b(postProcessHooks[name],(function(hook){hook(editor)}))}(name,ed)}fireFormatApply(ed,name,node,vars)}else{node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){var formatItem=formatList[i];if(formatItem.ceFalseOverride&&isSelectorFormat(formatItem)&&dom.is(node,formatItem.selector)){setElementFormat(node,formatItem);break}}fireFormatApply(ed,name,node,vars)}},hasVars=function(value){return has$2(value,"vars")},fallbackElement=function(editor){return editor.selection.getStart()},matchingNode=function(editor,parents,format,similar,vars){return findUntil$1(parents,(function(node){var matchingFormat=editor.formatter.matchNode(node,format,null!=vars?vars:{},similar);return!isUndefined(matchingFormat)}),(function(node){return!!matchesUnInheritedFormatSelector(editor,node,format)||!similar&&isNonNullable(editor.formatter.matchNode(node,format,vars,!0))}))},getParents=function(editor,elm){var element=null!=elm?elm:fallbackElement(editor);return filter$4(getParents$2(editor.dom,element),(function(node){return isElement$5(node)&&!isBogus$2(node)}))},updateAndFireChangeCallbacks=function(editor,elm,registeredCallbacks){var parents=getParents(editor,elm);each$j(registeredCallbacks,(function(data,format){var runIfChanged=function(spec){var match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:void 0),isSet=match.isSome();if(spec.state.get()!==isSet){spec.state.set(isSet);var node_1=match.getOr(elm);hasVars(spec)?spec.callback(isSet,{node:node_1,format:format,parents:parents}):each$k(spec.callbacks,(function(callback){return callback(isSet,{node:node_1,format:format,parents:parents})}))}};each$k([data.withSimilar,data.withoutSimilar],runIfChanged),each$k(data.withVars,runIfChanged)}))},formatChangedInternal=function(editor,registeredFormatListeners,formats,callback,similar,vars){return null===registeredFormatListeners.get()&&function(registeredFormatListeners,editor){registeredFormatListeners.set({}),editor.on("NodeChange",(function(e){updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get())})),editor.on("FormatApply FormatRemove",(function(e){var element=Optional.from(e.node).map((function(nodeOrRange){return isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer})).bind((function(node){return isElement$5(node)?Optional.some(node):Optional.from(node.parentElement)})).getOrThunk((function(){return fallbackElement(editor)}));updateAndFireChangeCallbacks(editor,element,registeredFormatListeners.get())}))}(registeredFormatListeners,editor),function(editor,registeredFormatListeners,formats,callback,similar,vars){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(","),(function(format){var group=get$9(formatChangeItems,format).getOrThunk((function(){var base={withSimilar:{state:Cell(!1),similar:!0,callbacks:[]},withoutSimilar:{state:Cell(!1),similar:!1,callbacks:[]},withVars:[]};return formatChangeItems[format]=base,base})),getCurrent=function(){var parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome()};if(isUndefined(vars)){var toAppendTo=similar?group.withSimilar:group.withoutSimilar;toAppendTo.callbacks.push(callback),1===toAppendTo.callbacks.length&&toAppendTo.state.set(getCurrent())}else group.withVars.push({state:Cell(getCurrent()),similar:similar,vars:vars,callback:callback})})),registeredFormatListeners.set(formatChangeItems)}(editor,registeredFormatListeners,formats,callback,similar,vars),{unbind:function(){return function(registeredFormatListeners,formats,callback){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(","),(function(format){return get$9(formatChangeItems,format).each((function(group){formatChangeItems[format]={withSimilar:__assign(__assign({},group.withSimilar),{callbacks:filter$4(group.withSimilar.callbacks,(function(cb){return cb!==callback}))}),withoutSimilar:__assign(__assign({},group.withoutSimilar),{callbacks:filter$4(group.withoutSimilar.callbacks,(function(cb){return cb!==callback}))}),withVars:filter$4(group.withVars,(function(item){return item.callback!==callback}))}}))})),registeredFormatListeners.set(formatChangeItems)}(registeredFormatListeners,formats,callback)}}},fromElements=function(elements,scope){var fragment=(scope||document).createDocumentFragment();return each$k(elements,(function(element){fragment.appendChild(element.dom)})),SugarElement.fromDom(fragment)},tableModel=function(element,width,rows){return{element:element,width:width,rows:rows}},tableRow=function(element,cells){return{element:element,cells:cells}},cellPosition=function(x,y){return{x:x,y:y}},getSpan=function(td,key){var value=parseInt(get$6(td,key),10);return isNaN(value)?1:value},cellExists=function(table,x,y){var rows=table.rows;return!!(rows[y]?rows[y].cells:[])[x]},getWidth=function(rows){return foldl(rows,(function(acc,row){return row.cells.length>acc?row.cells.length:acc}),0)},findElementPos=function(table,element){for(var rows=table.rows,y=0;y<rows.length;y++)for(var cells=rows[y].cells,x=0;x<cells.length;x++)if(eq(cells[x],element))return Optional.some(cellPosition(x,y));return Optional.none()},extractRows=function(table,sx,sy,ex,ey){for(var newRows=[],rows=table.rows,y=sy;y<=ey;y++){var cells=rows[y].cells,slice=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice))}return newRows},fromDom=function(tableElm){var table=tableModel(shallow(tableElm),0,[]);return each$k(descendants(tableElm,"tr"),(function(tr,y){each$k(descendants(tr,"td,th"),(function(td,x){!function(table,x,y,tr,td){for(var rowspan=getSpan(td,"rowspan"),colspan=getSpan(td,"colspan"),rows=table.rows,y2=y;y2<y+rowspan;y2++){rows[y2]||(rows[y2]=tableRow(deep$1(tr),[]));for(var x2=x;x2<x+colspan;x2++)rows[y2].cells[x2]=y2===y&&x2===x?td:shallow(td)}}(table,function(table,x,y){for(;cellExists(table,x,y);)x++;return x}(table,x,y),y,tr,td)}))})),tableModel(table.element,getWidth(table.rows),table.rows)},toDom=function(table){return function(table,rows){var tableElement=shallow(table.element),tableBody=SugarElement.fromTag("tbody");return append(tableBody,rows),append$1(tableElement,tableBody),tableElement}(table,function(table){return map$3(table.rows,(function(row){var cells=map$3(row.cells,(function(cell){var td=deep$1(cell);return remove$6(td,"colspan"),remove$6(td,"rowspan"),td})),tr=shallow(row.element);return append(tr,cells),tr}))}(table))},subsection=function(table,startElement,endElement){return findElementPos(table,startElement).bind((function(startPos){return findElementPos(table,endElement).map((function(endPos){return function(table,startPos,endPos){var sx=startPos.x,sy=startPos.y,ex=endPos.x,ey=endPos.y,newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows)}(table,startPos,endPos)}))}))},getFullySelectedListWrappers=function(parents,rng){return find$3(parents,(function(elm){return"li"===name(elm)&&hasAllContentsSelected(elm,rng)})).fold(constant([]),(function(_li){return function(parents){return find$3(parents,(function(elm){return"ul"===name(elm)||"ol"===name(elm)}))}(parents).map((function(listCont){var listElm=SugarElement.fromTag(name(listCont)),listStyles=filter$3(getAllRaw(listCont),(function(_style,name){return startsWith(name,"list-style")}));return setAll(listElm,listStyles),[SugarElement.fromTag("li"),listElm]})).getOr([])}))},getWrapElements=function(rootNode,rng){var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer),parents=parentsAndSelf(commonAnchorContainer,rootNode),wrapElements=filter$4(parents,(function(elm){return isInline$1(elm)||isHeading(elm)})),listWrappers=getFullySelectedListWrappers(parents,rng),allWrappers=wrapElements.concat(listWrappers.length?listWrappers:function(commonAnchorContainer){return isListItem(commonAnchorContainer)?parent(commonAnchorContainer).filter(isList).fold(constant([]),(function(listElm){return[commonAnchorContainer,listElm]})):isList(commonAnchorContainer)?[commonAnchorContainer]:[]}(commonAnchorContainer));return map$3(allWrappers,shallow)},emptyFragment=function(){return fromElements([])},getFragmentFromRange=function(rootNode,rng){return innerElm=SugarElement.fromDom(rng.cloneContents()),elms=getWrapElements(rootNode,rng),wrapped=foldl(elms,(function(acc,elm){return append$1(elm,acc),elm}),innerElm),elms.length>0?fromElements([wrapped]):wrapped;var innerElm,elms,wrapped},getTableFragment=function(rootNode,selectedTableCells){return(rootElm=rootNode,cell=selectedTableCells[0],ancestor$2(cell,"table",curry(eq,rootElm))).bind((function(tableElm){var firstCell=selectedTableCells[0],lastCell=selectedTableCells[selectedTableCells.length-1],fullTableModel=fromDom(tableElm);return subsection(fullTableModel,firstCell,lastCell).map((function(sectionedTableModel){return fromElements([toDom(sectionedTableModel)])}))})).getOrThunk(emptyFragment);var rootElm,cell},read$3=function(rootNode,ranges){var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):function(rootNode,ranges){return ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0])}(rootNode,ranges)},isCollapsibleWhitespace=function(text,index){return index>=0&&index<text.length&&isWhiteSpace(text.charAt(index))},getInnerText=function(bin,shouldTrim){var text=trim$2(bin.innerText);return shouldTrim?function(text){return text.replace(/^[ \f\n\r\t\v]+/,"")}(text):text},getSelectedContentInternal=function(editor,format,args){void 0===args&&(args={});var defaultedArgs=function(args,format){return __assign(__assign({},args),{format:format,get:!0,selection:!0})}(args,format),updatedArgs=editor.fire("BeforeGetContent",defaultedArgs);if(updatedArgs.isDefaultPrevented())return editor.fire("GetContent",updatedArgs),updatedArgs.content;if("text"===updatedArgs.format)return function(editor){return Optional.from(editor.selection.getRng()).map((function(rng){var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock)),body=editor.getBody(),contextNodeName=function(parentBlockOpt){return parentBlockOpt.map((function(block){return block.nodeName})).getOr("div").toLowerCase()}(parentBlockOpt),shouldTrimSpaces=Env.browser.isIE()&&"pre"!==contextNodeName,bin=editor.dom.add(body,contextNodeName,{"data-mce-bogus":"all",style:"overflow: hidden; opacity: 0;"},rng.cloneContents()),text=getInnerText(bin,shouldTrimSpaces),nonRenderedText=trim$2(bin.textContent);if(editor.dom.remove(bin),isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){var parentBlock=parentBlockOpt.getOr(body),parentBlockText=getInnerText(parentBlock,shouldTrimSpaces),textIndex=parentBlockText.indexOf(text);return-1===textIndex?text:(isCollapsibleWhitespace(parentBlockText,textIndex-1)?" ":"")+text+(isCollapsibleWhitespace(parentBlockText,textIndex+text.length)?" ":"")}return text})).getOr("")}(editor);updatedArgs.getInner=!0;var content=function(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create("body"),sel=editor.selection.getSel(),ranges=processRanges(editor,getRanges(sel)),fragment=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),ranges).dom:rng.cloneContents();return fragment&&tmpElm.appendChild(fragment),editor.selection.serializer.serialize(tmpElm,args)}(editor,updatedArgs);return"tree"===updatedArgs.format?content:(updatedArgs.content=editor.selection.isCollapsed()?"":content,editor.fire("GetContent",updatedArgs),updatedArgs.content)},getOuterHtml=function(elm){return isElement$5(elm)?elm.outerHTML:isText$7(elm)?Entities.encodeRaw(elm.data,!1):isComment(elm)?"\x3c!--"+elm.data+"--\x3e":""},insertAt=function(elm,html,index){var fragment=function(html){var node,container=document.createElement("div"),frag=document.createDocumentFragment();for(html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag}(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target)}else elm.appendChild(fragment)},write=function(fragments,elm){var left,right,size,vDown,vUp,buildScript,buildSnake,getMiddleSnake,script,currentFragments=map$3(from(elm.childNodes),getOuterHtml);return function(diff,elm){var index=0;each$k(diff,(function(action){0===action[0]?index++:1===action[0]?(insertAt(elm,action[1],index),index++):2===action[0]&&function(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target)}}(elm,index)}))}((right=fragments,size=(left=currentFragments).length+right.length+2,vDown=new Array(size),vUp=new Array(size),buildScript=function(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2)for(var i=start1,j=start2;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end1-start1>end2-start2?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j);else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}},buildSnake=function(start,diag,end1,end2){for(var end=start;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return function(start,end,diag){return{start:start,end:end,diag:diag}}(start,end,diag)},getMiddleSnake=function(start1,end1,start2,end2){var m=end1-start1,n=end2-start2;if(0===m||0===n)return null;var d,k,i,x,y,delta=m-n,sum=n+m,offset=(sum%2==0?sum:sum+1)/2;for(vDown[1+offset]=start1,vUp[1+offset]=end1+1,d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){for(i=k+offset,k===-d||k!==d&&vDown[i-1]<vDown[i+1]?vDown[i]=vDown[i+1]:vDown[i]=vDown[i-1]+1,y=(x=vDown[i])-start1+start2-k;x<end1&&y<end2&&left[x]===right[y];)vDown[i]=++x,++y;if(delta%2!=0&&delta-d<=k&&k<=delta+d&&vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){for(i=k+offset-delta,k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]?vUp[i]=vUp[i+1]-1:vUp[i]=vUp[i-1],y=(x=vUp[i]-1)-start1+start2-k;x>=start1&&y>=start2&&left[x]===right[y];)vUp[i]=x--,y--;if(delta%2==0&&-d<=k&&k<=d&&vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}},script=[],buildScript(0,left.length,0,right.length,script),script),elm),elm},lazyTempDocument=cached((function(){return document.implementation.createHTMLDocument("undo")})),createFromEditor=function(editor){var elm,fragments=(elm=editor.getBody(),filter$4(map$3(from(elm.childNodes),getOuterHtml),(function(item){return item.length>0}))),trimmedFragments=bind(fragments,(function(html){var trimmed=trimInternal(editor.serializer,html);return trimmed.length>0?[trimmed]:[]})),content=trimmedFragments.join("");return-1!==content.indexOf("</iframe>")?function(fragments){return{type:"fragmented",fragments:fragments,content:"",bookmark:null,beforeBookmark:null}}(trimmedFragments):function(content){return{type:"complete",fragments:null,content:content,bookmark:null,beforeBookmark:null}}(content)},applyToEditor=function(editor,level,before){var bookmark=before?level.beforeBookmark:level.bookmark;"fragmented"===level.type?write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw",no_selection:!isNonNullable(bookmark)||!isPathBookmark(bookmark)||!bookmark.isFakeCaret}),editor.selection.moveToBookmark(bookmark)},getLevelContent=function(level){return"fragmented"===level.type?level.fragments.join(""):level.content},getCleanLevelContent=function(level){var elm=SugarElement.fromTag("body",lazyTempDocument());return set(elm,getLevelContent(level)),each$k(descendants(elm,"*[data-mce-bogus]"),unwrap),elm.dom.innerHTML},isEq$1=function(level1,level2){return!(!level1||!level2)&&(!!function(level1,level2){return getLevelContent(level1)===getLevelContent(level2)}(level1,level2)||function(level1,level2){return getCleanLevelContent(level1)===getCleanLevelContent(level2)}(level1,level2))},isUnlocked=function(locks){return 0===locks.get()},setTyping=function(undoManager,typing,locks){isUnlocked(locks)&&(undoManager.typing=typing)},endTyping=function(undoManager,locks){undoManager.typing&&(setTyping(undoManager,!1,locks),undoManager.add())},makePlainAdaptor=function(editor){return{undoManager:{beforeChange:function(locks,beforeBookmark){return function(editor,locks,beforeBookmark){isUnlocked(locks)&&beforeBookmark.set(getUndoBookmark(editor.selection))}(editor,locks,beforeBookmark)},add:function(undoManager,index,locks,beforeBookmark,level,event){return function(editor,undoManager,index,locks,beforeBookmark,level,event){var currentLevel=createFromEditor(editor);if(level=level||{},level=Tools.extend(level,currentLevel),!1===isUnlocked(locks)||editor.removed)return null;var lastLevel=undoManager.data[index.get()];if(editor.fire("BeforeAddUndo",{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&isEq$1(lastLevel,level))return null;undoManager.data[index.get()]&&beforeBookmark.get().each((function(bm){undoManager.data[index.get()].beforeBookmark=bm}));var customUndoRedoLevels=function(editor){return editor.getParam("custom_undo_redo_levels",0,"number")}(editor);if(customUndoRedoLevels&&undoManager.data.length>customUndoRedoLevels){for(var i=0;i<undoManager.data.length-1;i++)undoManager.data[i]=undoManager.data[i+1];undoManager.data.length--,index.set(undoManager.data.length)}level.bookmark=getUndoBookmark(editor.selection),index.get()<undoManager.data.length-1&&(undoManager.data.length=index.get()+1),undoManager.data.push(level),index.set(undoManager.data.length-1);var args={level:level,lastLevel:lastLevel,originalEvent:event};return index.get()>0?(editor.setDirty(!0),editor.fire("AddUndo",args),editor.fire("change",args)):editor.fire("AddUndo",args),level}(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(undoManager,locks,index){return function(editor,undoManager,locks,index){var level;return undoManager.typing&&(undoManager.add(),undoManager.typing=!1,setTyping(undoManager,!1,locks)),index.get()>0&&(index.set(index.get()-1),level=undoManager.data[index.get()],applyToEditor(editor,level,!0),editor.setDirty(!0),editor.fire("Undo",{level:level})),level}(editor,undoManager,locks,index)},redo:function(index,data){return function(editor,index,data){var level;return index.get()<data.length-1&&(index.set(index.get()+1),level=data[index.get()],applyToEditor(editor,level,!1),editor.setDirty(!0),editor.fire("Redo",{level:level})),level}(editor,index,data)},clear:function(undoManager,index){return function(editor,undoManager,index){undoManager.data=[],index.set(0),undoManager.typing=!1,editor.fire("ClearUndos")}(editor,undoManager,index)},reset:function(undoManager){return function(undoManager){undoManager.clear(),undoManager.add()}(undoManager)},hasUndo:function(undoManager,index){return function(editor,undoManager,index){return index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0])}(editor,undoManager,index)},hasRedo:function(undoManager,index){return function(undoManager,index){return index.get()<undoManager.data.length-1&&!undoManager.typing}(undoManager,index)},transact:function(undoManager,locks,callback){return function(undoManager,locks,callback){return endTyping(undoManager,locks),undoManager.beforeChange(),undoManager.ignore(callback),undoManager.add()}(undoManager,locks,callback)},ignore:function(locks,callback){return function(locks,callback){try{locks.set(locks.get()+1),callback()}finally{locks.set(locks.get()-1)}}(locks,callback)},extra:function(undoManager,index,callback1,callback2){return function(editor,undoManager,index,callback1,callback2){if(undoManager.transact(callback1)){var bookmark=undoManager.data[index.get()].bookmark,lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,!0),undoManager.transact(callback2)&&(undoManager.data[index.get()-1].beforeBookmark=bookmark)}}(editor,undoManager,index,callback1,callback2)}},formatter:{match:function(name,vars,node,similar){return match$2(editor,name,vars,node,similar)},matchAll:function(names,vars){return function(editor,names,vars){var matchedFormatNames=[],checkedMap={},startElement=editor.selection.getStart();return editor.dom.getParent(startElement,(function(node){for(var i=0;i<names.length;i++){var name_1=names[i];!checkedMap[name_1]&&matchNode(editor,node,name_1,vars)&&(checkedMap[name_1]=!0,matchedFormatNames.push(name_1))}}),editor.dom.getRoot()),matchedFormatNames}(editor,names,vars)},matchNode:function(node,name,vars,similar){return matchNode(editor,node,name,vars,similar)},canApply:function(name){return function(editor,name){var formatList=editor.formatter.get(name),dom=editor.dom;if(formatList)for(var startNode=editor.selection.getStart(),parents=getParents$2(dom,startNode),x=formatList.length-1;x>=0;x--){var format=formatList[x];if(!isSelectorFormat(format)||isNonNullable(format.defaultBlock))return!0;for(var i=parents.length-1;i>=0;i--)if(dom.is(parents[i],format.selector))return!0}return!1}(editor,name)},closest:function(names){return closest(editor,names)},apply:function(name,vars,node){return applyFormat$1(editor,name,vars,node)},remove:function(name,vars,node,similar){return remove$1(editor,name,vars,node,similar)},toggle:function(name,vars,node){return function(editor,name,vars,node){var fmt=editor.formatter.get(name);!match$2(editor,name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?applyFormat$1(editor,name,vars,node):remove$1(editor,name,vars,node)}(editor,name,vars,node)},formatChanged:function(registeredFormatListeners,formats,callback,similar,vars){return formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars)}},editor:{getContent:function(args,format){return function(editor,args,format){return Optional.from(editor.getBody()).fold(constant("tree"===args.format?new AstNode("body",11):""),(function(body){return getContentFromBody(editor,args,format,body)}))}(editor,args,format)},setContent:function(content,args){return setContentInternal(editor,content,args)},insertContent:function(value,details){return insertHtmlAtCaret(editor,value,details)},addVisual:function(elm){return function(editor,elm){var dom=editor.dom,scope=isNonNullable(elm)?elm:editor.getBody();isUndefined(editor.hasVisual)&&(editor.hasVisual=function(editor){return editor.getParam("visual",!0,"boolean")}(editor)),each$k(dom.select("table,a",scope),(function(matchedElm){switch(matchedElm.nodeName){case"TABLE":var cls=function(editor){return editor.getParam("visual_table_class","mce-item-table","string")}(editor),value=dom.getAttrib(matchedElm,"border");value&&"0"!==value||!editor.hasVisual?dom.removeClass(matchedElm,cls):dom.addClass(matchedElm,cls);break;case"A":if(!dom.getAttrib(matchedElm,"href")){var value_1=dom.getAttrib(matchedElm,"name")||matchedElm.id,cls_1=function(editor){return editor.getParam("visual_anchor_class","mce-item-anchor","string")}(editor);value_1&&editor.hasVisual?dom.addClass(matchedElm,cls_1):dom.removeClass(matchedElm,cls_1)}}})),editor.fire("VisualAid",{element:elm,hasVisual:editor.hasVisual})}(editor,elm)}},selection:{getContent:function(format,args){return getSelectedContentInternal(editor,format,args)}},raw:{getModel:function(){return Optional.none()}}}},isRtc=function(editor){return has$2(editor.plugins,"rtc")},setup$i=function(editor){var editorCast=editor;return function(editor){return get$9(editor.plugins,"rtc").bind((function(rtcPlugin){return Optional.from(rtcPlugin.setup)}))}(editor).fold((function(){return editorCast.rtcInstance=makePlainAdaptor(editor),Optional.none()}),(function(setup){return editorCast.rtcInstance=function(){var nul=constant(null),empty=constant("");return{undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(void 0),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:empty,insertContent:noop,addVisual:noop},selection:{getContent:empty},raw:{getModel:constant(Optional.none())}}}(),Optional.some((function(){return setup().then((function(rtcEditor){return editorCast.rtcInstance=function(rtcEditor){var defaultVars=function(vars){return isObject(vars)?vars:{}},undoManager=rtcEditor.undoManager,formatter=rtcEditor.formatter,editor=rtcEditor.editor,selection=rtcEditor.selection,raw=rtcEditor.raw;return{undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:function(_undoManager,_locks,fn){return undoManager.transact(fn)},ignore:function(_locks,callback){return undoManager.ignore(callback)},extra:function(_undoManager,_index,callback1,callback2){return undoManager.extra(callback1,callback2)}},formatter:{match:function(name,vars,_node,similar){return formatter.match(name,defaultVars(vars),similar)},matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:function(name){return formatter.canApply(name)},closest:function(names){return formatter.closest(names)},apply:function(name,vars,_node){return formatter.apply(name,defaultVars(vars))},remove:function(name,vars,_node,_similar){return formatter.remove(name,defaultVars(vars))},toggle:function(name,vars,_node){return formatter.toggle(name,defaultVars(vars))},formatChanged:function(_rfl,formats,callback,similar,vars){return formatter.formatChanged(formats,callback,similar,vars)}},editor:{getContent:function(args,_format){return editor.getContent(args)},setContent:function(content,args){return editor.setContent(content,args)},insertContent:function(content,_details){return editor.insertContent(content)},addVisual:editor.addVisual},selection:{getContent:function(_format,args){return selection.getContent(args)}},raw:{getModel:function(){return Optional.some(raw.getRawModel())}}}}(rtcEditor),rtcEditor.rtc.isRemote}))}))}))},getRtcInstanceWithFallback=function(editor){return editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor)},getRtcInstanceWithError=function(editor){var rtcInstance=editor.rtcInstance;if(rtcInstance)return rtcInstance;throw new Error("Failed to get RTC instance not yet initialized.")},getContent$1=function(editor,args){return void 0===args&&(args={}),function(editor,format,args){return getRtcInstanceWithError(editor).selection.getContent(format,args)}(editor,args.format?args.format:"html",args)},removeEmpty=function(text){return 0===text.dom.length?(remove$7(text),Optional.none()):Optional.some(text)},mergeAndNormalizeText=function(outerNode,innerNode,rng,start){outerNode.bind((function(outer){return(start?normalizeWhitespaceBefore:normalizeWhitespaceAfter)(outer.dom,start?outer.dom.length:0),innerNode.filter(isText$8).map((function(inner){return function(outer,inner,rng,start){var outerElm=outer.dom,innerElm=inner.dom,oldLength=start?outerElm.length:innerElm.length;start?(mergeTextNodes(outerElm,innerElm,!1,!start),rng.setStart(innerElm,oldLength)):(mergeTextNodes(innerElm,outerElm,!1,!start),rng.setEnd(innerElm,oldLength))}(outer,inner,rng,start)}))})).orThunk((function(){return function(node,start){return node.filter((function(elm){return BookmarkManager.isBookmarkNode(elm.dom)})).bind(start?nextSibling:prevSibling)}(innerNode,start).or(innerNode).filter(isText$8).map((function(inner){return function(inner,start){parent(inner).each((function(root){var text=inner.dom;start&&needsToBeNbspLeft(root,CaretPosition(text,0))?normalizeWhitespaceAfter(text,0):!start&&needsToBeNbspRight(root,CaretPosition(text,text.length))&&normalizeWhitespaceBefore(text,text.length)}))}(inner,start)}))}))},setContent$1=function(editor,content,args){void 0===args&&(args={});var defaultedArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,selection:!0,content:content})}(args,content),updatedArgs=defaultedArgs;if(!defaultedArgs.no_events){var eventArgs=editor.fire("BeforeSetContent",defaultedArgs);if(eventArgs.isDefaultPrevented())return void editor.fire("SetContent",eventArgs);updatedArgs=eventArgs}updatedArgs.content=function(editor,args){if("raw"!==args.format){var rng=editor.selection.getRng(),contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock),contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{},node=editor.parser.parse(args.content,__assign(__assign({isRootContent:!0,forced_root_block:!1},contextArgs),args));return HtmlSerializer({validate:editor.validate},editor.schema).serialize(node)}return args.content}(editor,updatedArgs);var rng=editor.selection.getRng();!function(rng,fragment){var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom),lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents(),rng.insertNode(fragment);var prevText=firstChild.bind(prevSibling).filter(isText$8).bind(removeEmpty),nextText=lastChild.bind(nextSibling).filter(isText$8).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,!0),mergeAndNormalizeText(nextText,lastChild,rng,!1),rng.collapse(!1)}(rng,rng.createContextualFragment(updatedArgs.content)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng),updatedArgs.no_events||editor.fire("SetContent",updatedArgs)},deleteFromCallbackMap=function(callbackMap,selector,callback){if(callbackMap&&has$2(callbackMap,selector)){var newCallbacks=filter$4(callbackMap[selector],(function(cb){return cb!==callback}));0===newCallbacks.length?delete callbackMap[selector]:callbackMap[selector]=newCallbacks}};var merger,lookup,isNativeIeSelection=function(rng){return!!rng.select},isAttachedToDom=function(node){return!(!node||!node.ownerDocument)&&contains$1(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node))},EditorSelection=function(dom,win,serializer,editor){var selectedRange,explicitRange,selectorChangedWithUnbind=function SelectorChanged(dom,editor){var selectorChangedData,currentSelectors,findMatchingNode=function(selector,nodes){return find$3(nodes,(function(node){return dom.is(node,selector)}))},getParents=function(elem){return dom.getParents(elem,null,dom.getRoot())};return{selectorChangedWithUnbind:function(selector,callback){return selectorChangedData||(selectorChangedData={},currentSelectors={},editor.on("NodeChange",(function(e){var node=e.element,parents=getParents(node),matchedSelectors={};Tools.each(selectorChangedData,(function(callbacks,selector){findMatchingNode(selector,parents).each((function(node){currentSelectors[selector]||(each$k(callbacks,(function(callback){callback(!0,{node:node,selector:selector,parents:parents})})),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks}))})),Tools.each(currentSelectors,(function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],Tools.each(callbacks,(function(callback){callback(!1,{node:node,selector:selector,parents:parents})})))}))}))),selectorChangedData[selector]||(selectorChangedData[selector]=[]),selectorChangedData[selector].push(callback),findMatchingNode(selector,getParents(editor.selection.getStart())).each((function(){currentSelectors[selector]=selectorChangedData[selector]})),{unbind:function(){deleteFromCallbackMap(selectorChangedData,selector,callback),deleteFromCallbackMap(currentSelectors,selector,callback)}}}}}(dom,editor).selectorChangedWithUnbind,setContent=function(content,args){return setContent$1(editor,content,args)},collapse=function(toStart){var rng=getRng$1();rng.collapse(!!toStart),setRng(rng)},getSel=function(){return win.getSelection?win.getSelection():win.document.selection},getRng$1=function(){var selection,rng,elm,tryCompareBoundaryPoints=function(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}},doc=win.document;if(void 0!==editor.bookmark&&!1===hasFocus(editor)){var bookmark=getRng(editor);if(bookmark.isSome())return bookmark.map((function(r){return processRanges(editor,[r])[0]})).getOr(doc.createRange())}try{(selection=getSel())&&!isRestrictedNode(selection.anchorNode)&&(rng=selection.rangeCount>0?selection.getRangeAt(0):selection.createRange?selection.createRange():doc.createRange(),rng=processRanges(editor,[rng])[0])}catch(ex){}return rng||(rng=doc.createRange?doc.createRange():doc.body.createTextRange()),rng.setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(elm=dom.getRoot(),rng.setStart(elm,0),rng.setEnd(elm,0)),selectedRange&&explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)?rng=explicitRange:(selectedRange=null,explicitRange=null)),rng},setRng=function(rng,forward){var node;if(function(rng){return!!rng&&(!!isNativeIeSelection(rng)||isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer))}(rng)){var ieRange=isNativeIeSelection(rng)?rng:null;if(ieRange){explicitRange=null;try{ieRange.select()}catch(ex){}}else{var sel=getSel();if(rng=editor.fire("SetSelectionRange",{range:rng,forward:forward}).range,sel){explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}!1===forward&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}rng.collapsed||rng.startContainer!==rng.endContainer||!sel.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset])&&"IMG"===node.tagName&&(sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),sel.anchorNode===rng.startContainer&&sel.focusNode===rng.endContainer||sel.setBaseAndExtent(node,0,node,1)),editor.fire("AfterSetSelectionRange",{range:rng,forward:forward})}}},isForward=function(){var sel=getSel(),anchorNode=null==sel?void 0:sel.anchorNode,focusNode=null==sel?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode))return!0;var anchorRange=dom.createRng();anchorRange.setStart(anchorNode,sel.anchorOffset),anchorRange.collapse(!0);var focusRange=dom.createRng();return focusRange.setStart(focusNode,sel.focusOffset),focusRange.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0},exports={bookmarkManager:null,controlSelection:null,dom:dom,win:win,serializer:serializer,editor:editor,collapse:collapse,setCursorLocation:function(node,offset){var rng=dom.createRng();isNonNullable(node)&&isNonNullable(offset)?(rng.setStart(node,offset),rng.setEnd(node,offset),setRng(rng),collapse(!1)):(moveEndPoint(dom,rng,editor.getBody(),!0),setRng(rng))},getContent:function(args){return getContent$1(editor,args)},setContent:setContent,getBookmark:function(type,normalized){return bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){return function(dom,node,content){return Optional.from(node).map((function(node){var idx=dom.nodeIndex(node),rng=dom.createRng();return rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(moveEndPoint(dom,rng,node,!0),moveEndPoint(dom,rng,node,!1)),rng}))}(dom,node,content).each(setRng),node},isCollapsed:function(){var rng=getRng$1(),sel=getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},isForward:isForward,setNode:function(elm){return setContent(dom.getOuterHTML(elm)),elm},getNode:function(){return function(root,rng){var elm,startContainer,endContainer;if(!rng)return root;startContainer=rng.startContainer,endContainer=rng.endContainer;var startOffset=rng.startOffset,endOffset=rng.endOffset;return elm=rng.commonAncestorContainer,!rng.collapsed&&(startContainer===endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(elm=startContainer.childNodes[startOffset]),3===startContainer.nodeType&&3===endContainer.nodeType&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer))?startContainer:elm&&3===elm.nodeType?elm.parentNode:elm}(editor.getBody(),getRng$1())},getSel:getSel,setRng:setRng,getRng:getRng$1,getStart:function(real){return getStart(editor.getBody(),getRng$1(),real)},getEnd:function(real){return getEnd(editor.getBody(),getRng$1(),real)},getSelectedBlocks:function(startElm,endElm){return function(dom,rng,startElm,endElm){var node,selectedBlocks=[],root=dom.getRoot();if(startElm=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock),endElm=dom.getParent(endElm||getEnd(root,rng,rng.collapsed),dom.isBlock),startElm&&startElm!==root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!==endElm){node=startElm;for(var walker=new DomTreeWalker(startElm,root);(node=walker.next())&&node!==endElm;)dom.isBlock(node)&&selectedBlocks.push(node)}return endElm&&startElm!==endElm&&endElm!==root&&selectedBlocks.push(endElm),selectedBlocks}(dom,getRng$1(),startElm,endElm)},normalize:function(){var rng=getRng$1(),sel=getSel();if(!(getRanges(sel).length>1)&&hasAnyRanges(editor)){var normRng=normalize$2(dom,rng);return normRng.each((function(normRng){setRng(normRng,isForward())})),normRng.getOr(rng)}return rng},selectorChanged:function(selector,callback){return selectorChangedWithUnbind(selector,callback),exports},selectorChangedWithUnbind:selectorChangedWithUnbind,getScrollContainer:function(){for(var scrollContainer,node=dom.getRoot();node&&"BODY"!==node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){isNonNullable(elm)?function(editor,element,alignToTop){(editor.inline?elementIntoWindow:elementIntoFrame)(editor,element,alignToTop)}(editor,elm,alignToTop):scrollRangeIntoView(editor,getRng$1(),alignToTop)},placeCaretAt:function(clientX,clientY){return setRng(fromPoint(clientX,clientY,editor.getDoc()))},getBoundingClientRect:function(){var rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy:function(){win=selectedRange=explicitRange=null,controlSelection.destroy()}},bookmarkManager=BookmarkManager(exports),controlSelection=ControlSelection(exports,editor);return exports.bookmarkManager=bookmarkManager,exports.controlSelection=controlSelection,exports},addFontToSpansFilter=function(domParser,styles,fontSizes){domParser.addNodeFilter("font",(function(nodes){each$k(nodes,(function(node){var props=styles.parse(node.attr("style")),color=node.attr("color"),face=node.attr("face"),size=node.attr("size");color&&(props.color=color),face&&(props["font-family"]=face),size&&(props["font-size"]=fontSizes[parseInt(node.attr("size"),10)-1]),node.name="span",node.attr("style",styles.serialize(props)),function(node,names){each$k(names,(function(name){node.attr(name,null)}))}(node,["color","face","size"])}))}))},addFilters=function(domParser,settings){var styles=Styles();settings.convert_fonts_to_spans&&addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values)),function(domParser,styles){domParser.addNodeFilter("strike",(function(nodes){each$k(nodes,(function(node){var props=styles.parse(node.attr("style"));props["text-decoration"]="line-through",node.name="span",node.attr("style",styles.serialize(props))}))}))}(domParser,styles)},parseDataUri=function(uri){var type,uriParts=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriParts[0]);return matches&&(type=matches[1]),{type:type,data:uriParts[1]}},buildBlob=function(type,data){var str;try{str=atob(data)}catch(e){return Optional.none()}for(var arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);return Optional.some(new Blob([arr],{type:type}))},uriToBlob=function(url){return 0===url.indexOf("blob:")?function(url){return new promiseObj((function(resolve,reject){var rejectWithError=function(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.")};try{var xhr_1=new XMLHttpRequest;xhr_1.open("GET",url,!0),xhr_1.responseType="blob",xhr_1.onload=function(){200===xhr_1.status?resolve(xhr_1.response):rejectWithError()},xhr_1.onerror=rejectWithError,xhr_1.send()}catch(ex){rejectWithError()}}))}(url):0===url.indexOf("data:")?(uri=url,new promiseObj((function(resolve){var _a=parseDataUri(uri),type=_a.type,data=_a.data;buildBlob(type,data).fold((function(){return resolve(new Blob([]))}),resolve)}))):null;var uri},count$1=0,uniqueId=function(prefix){return(prefix||"blobid")+count$1++},imageToBlobInfo=function(blobCache,img,resolve,reject){var base64,blobInfo;if(0!==img.src.indexOf("blob:")){var _a=parseDataUri(img.src),data=_a.data,type=_a.type;base64=data,(blobInfo=blobCache.getByData(base64,type))?resolve({image:img,blobInfo:blobInfo}):uriToBlob(img.src).then((function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})}),(function(err){reject(err)}))}else(blobInfo=blobCache.getByUri(img.src))?resolve({image:img,blobInfo:blobInfo}):uriToBlob(img.src).then((function(blob){(function(blob){return new promiseObj((function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)}))})(blob).then((function(dataUri){base64=parseDataUri(dataUri).data,blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})}))}),(function(err){reject(err)}))},ImageScanner=function(uploadStatus,blobCache){var cachedPromises={};return{findAll:function(elm,predicate){predicate||(predicate=always);var images=filter$4(function(elm){return elm?from(elm.getElementsByTagName("img")):[]}(elm),(function(img){var src=img.src;return!!Env.fileApi&&(!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src===Env.transparentSrc)&&(0===src.indexOf("blob:")?!uploadStatus.isUploaded(src)&&predicate(img):0===src.indexOf("data:")&&predicate(img)))))})),promises=map$3(images,(function(img){if(void 0!==cachedPromises[img.src])return new promiseObj((function(resolve){cachedPromises[img.src].then((function(imageInfo){if("string"==typeof imageInfo)return imageInfo;resolve({image:img,blobInfo:imageInfo.blobInfo})}))}));var newPromise=new promiseObj((function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject)})).then((function(result){return delete cachedPromises[result.image.src],result})).catch((function(error){return delete cachedPromises[img.src],error}));return cachedPromises[img.src]=newPromise,newPromise}));return promiseObj.all(promises)}}},paddEmptyNode=function(settings,args,blockElements,node){(settings.padd_empty_with_br||args.insert)&&blockElements[node.name]?node.empty().append(new AstNode("br",1)).shortEnded=!0:node.empty().append(new AstNode("#text",3)).value="Â "},hasOnlyChild=function(node,name){return node&&node.firstChild&&node.firstChild===node.lastChild&&node.firstChild.name===name},isEmpty=function(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,(function(node){return function(schema,node){var rule=schema.getElementRule(node.name);return rule&&rule.paddEmpty}(schema,node)}))},registerBase64ImageFilter=function(parser,settings){var blobCache=settings.blob_cache,processImage=function(img){var inputSrc=img.attr("src");(function(img){return img.attr("src")===Env.transparentSrc||isNonNullable(img.attr("data-mce-placeholder"))})(img)||function(img){return isNonNullable(img.attr("data-mce-bogus"))}(img)||function(uri){var matches=/data:([^;]+);base64,([a-z0-9\+\/=\s]+)/i.exec(uri);return matches?Optional.some({type:matches[1],data:decodeURIComponent(matches[2])}):Optional.none()}(inputSrc).filter((function(){return function(img,settings){if(settings.images_dataimg_filter){var imgElem_1=new Image;return imgElem_1.src=img.attr("src"),each$j(img.attributes.map,(function(value,key){imgElem_1.setAttribute(key,value)})),settings.images_dataimg_filter(imgElem_1)}return!0}(img,settings)})).bind((function(_a){var type=_a.type,data=_a.data;return Optional.from(blobCache.getByData(data,type)).orThunk((function(){return buildBlob(type,data).map((function(blob){var blobInfo=blobCache.create(uniqueId(),blob,data);return blobCache.add(blobInfo),blobInfo}))}))})).each((function(blobInfo){img.attr("src",blobInfo.blobUri())}))};blobCache&&parser.addAttributeFilter("src",(function(nodes){return each$k(nodes,processImage)}))},makeMap=Tools.makeMap,each$6=Tools.each,explode$2=Tools.explode,extend$4=Tools.extend,DomParser=function(settings,schema){void 0===schema&&(schema=Schema());var nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};(settings=settings||{}).validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body";var filterNode=function(node){var name=node.name;name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]);for(var i=attributeFilters.length;i--;){var list,attrName=attributeFilters[i].name;if(attrName in node.attributes.map)(list=matchedAttributes[attrName])?list.push(node):matchedAttributes[attrName]=[node]}return node},exports={schema:schema,addAttributeFilter:function(name,callback){each$6(explode$2(name),(function(name){var i;for(i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name:name,callbacks:[callback]})}))},getAttributeFilters:function(){return[].concat(attributeFilters)},addNodeFilter:function(name,callback){each$6(explode$2(name),(function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)}))},getNodeFilters:function(){var out=[];for(var name_1 in nodeFilters)has$2(nodeFilters,name_1)&&out.push({name:name_1,callbacks:nodeFilters[name_1]});return out},filterNode:filterNode,parse:function(html,args){var nodes,i,l,fi,fl,list,name,node,invalidChildren=[];args=args||{},matchedNodes={},matchedAttributes={};var blockElements=extend$4(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,rootBlockName=function(name){return!1===name?"":!0===name?"p":name}("forced_root_block"in args?args.forced_root_block:settings.forced_root_block),whiteSpaceElements=schema.getWhiteSpaceElements(),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/,isInWhiteSpacePreservedElement=has$2(whiteSpaceElements,args.context)||has$2(whiteSpaceElements,settings.root_name),createNode=function(name,type){var list,node=new AstNode(name,type);return name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),node},removeWhitespaceBefore=function(node){for(var blockElements=schema.getBlockElements(),textNode=node.prev;textNode&&3===textNode.type;){var textVal=textNode.value.replace(endWhiteSpaceRegExp,"");if(textVal.length>0)return void(textNode.value=textVal);var textNodeNext=textNode.next;if(textNodeNext){if(3===textNodeNext.type&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&"script"!==textNodeNext.name&&"style"!==textNodeNext.name){textNode=textNode.prev;continue}}var sibling=textNode.prev;textNode.remove(),textNode=sibling}},parser=SaxParser({validate:validate,document:settings.document,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,preserve_cdata:settings.preserve_cdata,self_closing_elements:function(input){var output={};for(var name_2 in input)"li"!==name_2&&"p"!==name_2&&(output[name_2]=input[name_2]);return output}(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;isInWhiteSpacePreservedElement||(text=text.replace(allWhiteSpaceRegExp," "),function(node,blockElements){return node&&(has$2(blockElements,node.name)||"br"===node.name)}(node.lastChild,blockElements)&&(text=text.replace(startWhiteSpaceRegExp,""))),0!==text.length&&((textNode=createNode("#text",3)).raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){node.append(createNode("#doctype",10)).value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var elementRule=validate?schema.getElementRule(name):{};if(elementRule){var newNode=createNode(elementRule.outputName||name,1);newNode.attributes=attrs,newNode.shortEnded=empty,node.append(newNode);var parent_2=children[node.name];parent_2&&children[newNode.name]&&!parent_2[newNode.name]&&invalidChildren.push(newNode);for(var attrFiltersLen=attributeFilters.length;attrFiltersLen--;){var attrName=attributeFilters[attrFiltersLen].name;attrName in attrs.map&&((list=matchedAttributes[attrName])?list.push(newNode):matchedAttributes[attrName]=[newNode])}blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,text,sibling,tempNode,elementRule=validate?schema.getElementRule(name):{};if(elementRule){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if((textNode=node.firstChild)&&3===textNode.type)if((text=textNode.value.replace(startWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling;if((textNode=node.lastChild)&&3===textNode.type)if((text=textNode.value.replace(endWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1),elementRule.removeEmpty&&isEmpty(schema,nonEmptyElements,whiteSpaceElements,node))return tempNode=node.parent,blockElements[node.name]?node.empty().remove():node.unwrap(),void(node=tempNode);elementRule.paddEmpty&&(function(node){return hasOnlyChild(node,"#text")&&"Â "===node.firstChild.value}(node)||isEmpty(schema,nonEmptyElements,whiteSpaceElements,node))&&paddEmptyNode(settings,args,blockElements,node),node=node.parent}}},schema),rootNode=node=new AstNode(args.context||settings.root_name,11);if(parser.parse(html,args.format),validate&&invalidChildren.length&&(args.context?args.invalid=!0:function(nodes){for(var nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhiteSpaceElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements(),removeOrUnwrapInvalidNode=function(node,originalNodeParent){if(void 0===originalNodeParent&&(originalNodeParent=node.parent),specialElements[node.name])node.empty().remove();else{for(var _i=0,children_1=node.children();_i<children_1.length;_i++){var childNode=children_1[_i];schema.isValidChild(originalNodeParent.name,childNode.name)||removeOrUnwrapInvalidNode(childNode,originalNodeParent)}node.unwrap()}},ni=0;ni<nodes.length;ni++){var node=nodes[ni],parent_1=void 0,newParent=void 0,tempNode=void 0;if(node.parent&&!node.fixed)if(textBlockElements[node.name]&&"li"===node.parent.name){for(var sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap()}else{var parents=[node];for(parent_1=node.parent;parent_1&&!schema.isValidChild(parent_1.name,node.name)&&!nonSplitableElements[parent_1.name];parent_1=parent_1.parent)parents.push(parent_1);if(parent_1&&parents.length>1)if(schema.isValidChild(parent_1.name,node.name)){parents.reverse();for(var currentNode=newParent=filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode;for(var childNode=parents[i].firstChild;childNode&&childNode!==parents[i+1];){var nextNode=childNode.next;tempNode.append(childNode),childNode=nextNode}currentNode=tempNode}isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)?parent_1.insert(node,parents[0],!0):(parent_1.insert(newParent,parents[0],!0),parent_1.insert(node,newParent)),parent_1=parents[0],(isEmpty(schema,nonEmptyElements,whitespaceElements,parent_1)||hasOnlyChild(parent_1,"br"))&&parent_1.empty().remove()}else removeOrUnwrapInvalidNode(node);else if(node.parent){if("li"===node.name){if((sibling=node.prev)&&("ul"===sibling.name||"ol"===sibling.name)){sibling.append(node);continue}if((sibling=node.next)&&("ul"===sibling.name||"ol"===sibling.name)){sibling.insert(node,sibling.firstChild,!0);continue}node.wrap(filterNode(new AstNode("ul",1)));continue}schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(filterNode(new AstNode("div",1))):removeOrUnwrapInvalidNode(node)}}}}(invalidChildren)),rootBlockName&&("body"===rootNode.name||args.isRootContent)&&function(){var node=rootNode.firstChild,rootBlockNode=null,trim=function(rootBlock){rootBlock&&((node=rootBlock.firstChild)&&3===node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),(node=rootBlock.lastChild)&&3===node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))};if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;){var next=node.next;3===node.type||1===node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?(rootBlockNode||((rootBlockNode=createNode(rootBlockName,1)).attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node)),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next}trim(rootBlockNode)}}(),!args.invalid){for(name in matchedNodes)if(has$2(matchedNodes,name)){for(list=nodeFilters[name],fi=(nodes=matchedNodes[name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if((list=attributeFilters[i]).name in matchedAttributes){for(fi=(nodes=matchedAttributes[list.name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode}};return function(parser,settings){var schema=parser.schema;settings.remove_trailing_brs&&parser.addNodeFilter("br",(function(nodes,_,args){var i,node,parent,lastParent,prev,prevName,elementRule,textNode,l=nodes.length,blockElements=Tools.extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),whiteSpaceElements=schema.getWhiteSpaceElements();for(blockElements.body=1,i=0;i<l;i++)if(parent=(node=nodes[i]).parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if("span"!==(prevName=prev.name)||"bookmark"!==prev.attr("data-mce-type")){"br"===prevName&&(node=null);break}prev=prev.prev}node&&(node.remove(),isEmpty(schema,nonEmptyElements,whiteSpaceElements,parent)&&(elementRule=schema.getElementRule(parent.name))&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,args,blockElements,parent)))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&(lastParent=parent,!blockElements[parent.name]);)parent=parent.parent;lastParent===parent&&!0!==settings.padd_empty_with_br&&((textNode=new AstNode("#text",3)).value="Â ",node.replace(textNode))}})),parser.addAttributeFilter("href",(function(nodes){var rel,newRel,i=nodes.length;if(!settings.allow_unsafe_link_target)for(;i--;){var node=nodes[i];"a"===node.name&&"_blank"===node.attr("target")&&node.attr("rel",(newRel=void 0,newRel=(rel=node.attr("rel"))?Tools.trim(rel):"",/\b(noopener)\b/g.test(newRel)?newRel:function(rel){return rel.split(" ").filter((function(p){return p.length>0})).concat(["noopener"]).sort().join(" ")}(newRel)))}})),settings.allow_html_in_named_anchor||parser.addAttributeFilter("id,name",(function(nodes){for(var sibling,prevSibling,parent,node,i=nodes.length;i--;)if("a"===(node=nodes[i]).name&&node.firstChild&&!node.attr("href")){parent=node.parent,sibling=node.lastChild;do{prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling}while(sibling)}})),settings.fix_list_elements&&parser.addNodeFilter("ul,ol",(function(nodes){for(var node,parentNode,i=nodes.length;i--;)if("ul"===(parentNode=(node=nodes[i]).parent).name||"ol"===parentNode.name)if(node.prev&&"li"===node.prev.name)node.prev.append(node);else{var li=new AstNode("li",1);li.attr("style","list-style-type: none"),node.wrap(li)}})),settings.validate&&schema.getValidClasses()&&parser.addAttributeFilter("class",(function(nodes){for(var validClasses=schema.getValidClasses(),i=nodes.length;i--;){for(var node=nodes[i],classList=node.attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++){var className=classList[ci],valid=!1,validClassesMap=validClasses["*"];validClassesMap&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className)}classValue.length||(classValue=null),node.attr("class",classValue)}})),registerBase64ImageFilter(parser,settings)}(exports,settings),function(domParser,settings){settings.inline_styles&&addFilters(domParser,settings)}(exports,settings),exports},process=function(editor,node,args){return function(editor,args){return editor&&editor.hasEventListeners("PreProcess")&&!args.no_events}(editor,args)?function(editor,node,args){var oldDoc,dom=editor.dom,clonedNode=node.cloneNode(!0),impl=document.implementation;if(impl.createHTMLDocument){var doc_1=impl.createHTMLDocument("");Tools.each("BODY"===clonedNode.nodeName?clonedNode.childNodes:[clonedNode],(function(node){doc_1.body.appendChild(doc_1.importNode(node,!0))})),clonedNode="BODY"!==clonedNode.nodeName?doc_1.body.firstChild:doc_1.body,oldDoc=dom.doc,dom.doc=doc_1}return function(editor,args){editor.fire("PreProcess",args)}(editor,__assign(__assign({},args),{node:clonedNode})),oldDoc&&(dom.doc=oldDoc),clonedNode}(editor,node,args):node},addTempAttr=function(htmlParser,tempAttrs,name){-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,(function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)})),tempAttrs.push(name))},toHtml=function(editor,settings,schema,rootNode,args){return function(editor,args,content){return!args.no_events&&editor?function(editor,args){return editor.fire("PostProcess",args)}(editor,__assign(__assign({},args),{content:content})).content:content}(editor,args,function(settings,schema,node){return HtmlSerializer(settings,schema).serialize(node)}(settings,schema,rootNode))},DomSerializerImpl=function(settings,editor){var tempAttrs=["data-mce-selected"],dom=editor&&editor.dom?editor.dom:DOMUtils.DOM,schema=editor&&editor.schema?editor.schema:Schema(settings);settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs;var htmlParser=DomParser(settings,schema);!function(htmlParser,settings,dom){htmlParser.addAttributeFilter("data-mce-tabindex",(function(nodes,name){for(var i=nodes.length;i--;){var node=nodes[i];node.attr("tabindex",node.attr("data-mce-tabindex")),node.attr(name,null)}})),htmlParser.addAttributeFilter("src,href,style",(function(nodes,name){for(var internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope,i=nodes.length;i--;){var node=nodes[i],value=node.attr(internalName);void 0!==value?(node.attr(name,value.length>0?value:null),node.attr(internalName,null)):(value=node.attr(name),"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,value.length>0?value:null))}})),htmlParser.addAttributeFilter("class",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i],value=node.attr("class");value&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",value.length>0?value:null))}})),htmlParser.addAttributeFilter("data-mce-type",(function(nodes,name,args){for(var i=nodes.length;i--;){var node=nodes[i];"bookmark"!==node.attr("data-mce-type")||args.cleanup||(Optional.from(node.firstChild).exists((function(firstChild){return!isZwsp(firstChild.value)}))?node.unwrap():node.remove())}})),htmlParser.addNodeFilter("noscript",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i].firstChild;node&&(node.value=Entities.decode(node.value))}})),htmlParser.addNodeFilter("script,style",(function(nodes,name){for(var trim=function(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")},i=nodes.length;i--;){var node=nodes[i],value=node.firstChild?node.firstChild.value:"";if("script"===name){var type=node.attr("type");type&&node.attr("type","mce-no/type"===type?null:type.replace(/^mce\-/,"")),"xhtml"===settings.element_format&&value.length>0&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")}else"xhtml"===settings.element_format&&value.length>0&&(node.firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")}})),htmlParser.addNodeFilter("#comment",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];settings.preserve_cdata&&0===node.value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=dom.decode(node.value.replace(/^\[CDATA\[|\]\]$/g,""))):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))}})),htmlParser.addNodeFilter("xml:namespace,input",(function(nodes,name){for(var i=nodes.length;i--;){var node=nodes[i];7===node.type?node.remove():1===node.type&&("input"!==name||node.attr("type")||node.attr("type","text"))}})),htmlParser.addAttributeFilter("data-mce-type",(function(nodes){each$k(nodes,(function(node){"format-caret"===node.attr("data-mce-type")&&(node.isEmpty(htmlParser.schema.getNonEmptyElements())?node.remove():node.unwrap())}))})),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize,data-mce-placeholder",(function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}))}(htmlParser,settings,dom);return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,parserArgs){void 0===parserArgs&&(parserArgs={});var args=__assign({format:"html"},parserArgs),targetNode=process(editor,node,args),html=function(dom,node,args){var html=trim$2(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html)}(dom,targetNode,args),rootNode=function(htmlParser,html,args){var parserArgs=args.selection?__assign({forced_root_block:!1},args):args,rootNode=htmlParser.parse(html,parserArgs);return function(rootNode){var isBr=function(node){return node&&"br"===node.name},brNode1=rootNode.lastChild;if(isBr(brNode1)){var brNode2=brNode1.prev;isBr(brNode2)&&(brNode1.remove(),brNode2.remove())}}(rootNode),rootNode}(htmlParser,html,args);return"tree"===args.format?rootNode:toHtml(editor,settings,schema,rootNode,args)},addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters}},DomSerializer=function(settings,editor){var domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters}},getContent=function(editor,args){return void 0===args&&(args={}),function(editor,args,format){return getRtcInstanceWithFallback(editor).editor.getContent(args,format)}(editor,args,args.format?args.format:"html")},setContent=function(editor,content,args){return void 0===args&&(args={}),function(editor,content,args){return getRtcInstanceWithFallback(editor).editor.setContent(content,args)}(editor,content,args)},DOM$7=DOMUtils.DOM,safeDestroy=function(x){return Optional.from(x).each((function(x){return x.destroy()}))},remove=function(editor){if(!editor.removed){var _selectionOverrides=editor._selectionOverrides,editorUpload=editor.editorUpload,body=editor.getBody(),element=editor.getElement();body&&editor.save({is_removing:!0}),editor.removed=!0,editor.unbindAllNativeEvents(),editor.hasHiddenInput&&element&&DOM$7.remove(element.nextSibling),function(editor){editor.fire("remove")}(editor),editor.editorManager.remove(editor),!editor.inline&&body&&function(editor){DOM$7.setStyle(editor.id,"display",editor.orgDisplay)}(editor),function(editor){editor.fire("detach")}(editor),DOM$7.remove(editor.getContainer()),safeDestroy(_selectionOverrides),safeDestroy(editorUpload),editor.destroy()}},destroy=function(editor,automatic){var selection=editor.selection,dom=editor.dom;editor.destroyed||(automatic||editor.removed?(automatic||(editor.editorManager.off("beforeunload",editor._beforeUnload),editor.theme&&editor.theme.destroy&&editor.theme.destroy(),safeDestroy(selection),safeDestroy(dom)),function(editor){var form=editor.formElement;form&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM$7.unbind(form,"submit reset",editor.formEventDelegate))}(editor),function(editor){editor.contentAreaContainer=editor.formElement=editor.container=editor.editorContainer=null,editor.bodyElement=editor.contentDocument=editor.contentWindow=null,editor.iframeElement=editor.targetElm=null,editor.selection&&(editor.selection=editor.selection.win=editor.selection.dom=editor.selection.dom.doc=null)}(editor),editor.destroyed=!0):editor.remove())},deepMerge=(merger=function(old,nu){return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu},function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}),deprecatedSettings="autoresize_on_init,content_editable_state,convert_fonts_to_spans,inline_styles,padd_empty_with_br,block_elements,boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,tab_focus,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists".split(","),deprecatedPlugins="bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor".split(","),movedToPremiumPlugins="imagetools,toc".split(","),getDeprecatedSettings=function(settings){var settingNames=filter$4(deprecatedSettings,(function(setting){return has$2(settings,setting)})),forcedRootBlock=settings.forced_root_block;return!1!==forcedRootBlock&&""!==forcedRootBlock||settingNames.push("forced_root_block (false only)"),sort(settingNames)},getDeprecatedPlugins=function(settings){var plugins=Tools.makeMap(settings.plugins," "),hasPlugin=function(plugin){return has$2(plugins,plugin)},pluginNames=__spreadArray(__spreadArray([],filter$4(deprecatedPlugins,hasPlugin),!0),bind(movedToPremiumPlugins,(function(plugin){return hasPlugin(plugin)?[plugin+" (moving to premium)"]:[]})),!0);return sort(pluginNames)},deviceDetection=detect().deviceType,isTouch=deviceDetection.isTouch(),isPhone=deviceDetection.isPhone(),isTablet=deviceDetection.isTablet(),legacyMobilePlugins=["lists","autolink","autosave"],defaultTouchSettings={table_grid:!1,object_resizing:!1,resize:!1},normalizePlugins=function(plugins){var pluginNames=isArray$1(plugins)?plugins.join(" "):plugins,trimmedPlugins=map$3(isString$1(pluginNames)?pluginNames.split(" "):[],trim$4);return filter$4(trimmedPlugins,(function(item){return item.length>0}))},extractSections=function(keys,settings){var t,f,result=(f={},internalFilter(settings,(function(value,key){return contains$3(keys,key)}),objAcc(t={}),objAcc(f)),{t:t,f:f});return function(sections,settings){return{sections:constant(sections),settings:constant(settings)}}(result.t,result.f)},hasSection=function(sectionResult,name){return has$2(sectionResult.sections(),name)},getToolbarMode=function(settings,defaultVal){return get$9(settings,"toolbar_mode").orThunk((function(){return get$9(settings,"toolbar_drawer").map((function(val){return!1===val?"wrap":val}))})).getOr(defaultVal)},getDefaultMobileSettings=function(mobileSettings,isPhone){var defaultMobileSettings={resize:!1,toolbar_mode:getToolbarMode(mobileSettings,"scrolling"),toolbar_sticky:!1};return __assign(__assign(__assign({},defaultTouchSettings),defaultMobileSettings),isPhone?{menubar:!1}:{})},getExternalPlugins=function(overrideSettings,settings){var userDefinedExternalPlugins=settings.external_plugins?settings.external_plugins:{};return overrideSettings&&overrideSettings.external_plugins?Tools.extend({},overrideSettings.external_plugins,userDefinedExternalPlugins):userDefinedExternalPlugins},getPlatformPlugins=function(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins){return isMobileDevice&&function(sectionResult,name,theme){var section=sectionResult.sections();return hasSection(sectionResult,name)&&section[name].theme===theme}(sectionResult,"mobile","mobile")?filter$4(mobilePlugins,curry(contains$3,legacyMobilePlugins)):isMobileDevice&&hasSection(sectionResult,"mobile")?mobilePlugins:desktopPlugins},processPlugins=function(isMobileDevice,sectionResult,defaultOverrideSettings,settings){var forcedPlugins=normalizePlugins(defaultOverrideSettings.forced_plugins),desktopPlugins=normalizePlugins(settings.plugins),mobileConfig=function(sectionResult,name){return hasSection(sectionResult,name)?sectionResult.sections()[name]:{}}(sectionResult,"mobile"),mobilePlugins=mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins,combinedPlugins=function(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins))}(forcedPlugins,getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins));if(Env.browser.isIE()&&contains$3(combinedPlugins,"rtc"))throw new Error("RTC plugin is not supported on IE 11.");return Tools.extend(settings,{plugins:combinedPlugins.join(" ")})},combineSettings=function(isMobileDevice,isPhone,defaultSettings,defaultOverrideSettings,settings){var defaultDeviceSettings=isMobileDevice?{mobile:getDefaultMobileSettings(settings.mobile||{},isPhone)}:{},sectionResult=extractSections(["mobile"],deepMerge(defaultDeviceSettings,settings)),extendedSettings=Tools.extend(defaultSettings,defaultOverrideSettings,sectionResult.settings(),function(isMobileDevice,sectionResult){return isMobileDevice&&hasSection(sectionResult,"mobile")}(isMobileDevice,sectionResult)?function(sectionResult,name,defaults){void 0===defaults&&(defaults={});var sections=sectionResult.sections(),sectionSettings=get$9(sections,name).getOr({});return Tools.extend({},defaults,sectionSettings)}(sectionResult,"mobile"):{},{validate:!0,external_plugins:getExternalPlugins(defaultOverrideSettings,sectionResult.settings())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideSettings,extendedSettings)},getEditorSettings=function(editor,id,documentBaseUrl,defaultOverrideSettings,settings){var defaultSettings=function(settings,id,documentBaseUrl,isTouch,editor){var baseDefaults={id:id,theme:"silver",toolbar_mode:getToolbarMode(settings,"floating"),plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,inline_styles:!0,convert_fonts_to_spans:!0,indent:!0,indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:editor.convertURL,url_converter_scope:editor};return __assign(__assign({},baseDefaults),isTouch?defaultTouchSettings:{})}(settings,id,documentBaseUrl,isTouch,editor),finalSettings=combineSettings(isPhone||isTablet,isPhone,defaultSettings,defaultOverrideSettings,settings);return!1!==finalSettings.deprecation_warnings&&function(rawSettings,finalSettings){var deprecatedSettings=getDeprecatedSettings(rawSettings),deprecatedPlugins=getDeprecatedPlugins(finalSettings),hasDeprecatedPlugins=deprecatedPlugins.length>0,hasDeprecatedSettings=deprecatedSettings.length>0,isLegacyMobileTheme="mobile"===finalSettings.theme;if(hasDeprecatedPlugins||hasDeprecatedSettings||isLegacyMobileTheme){var themesMessage=isLegacyMobileTheme?"\n\nThemes:\n- mobile":"",pluginsMessage=hasDeprecatedPlugins?"\n\nPlugins:\n- "+deprecatedPlugins.join("\n- "):"",settingsMessage=hasDeprecatedSettings?"\n\nSettings:\n- "+deprecatedSettings.join("\n- "):"";console.warn("The following deprecated features are currently enabled, these will be removed in TinyMCE 6.0. See https://www.tiny.cloud/docs/release-notes/6.0-upcoming-changes/ for more information."+themesMessage+pluginsMessage+settingsMessage)}}(settings,finalSettings),finalSettings},getFiltered=function(predicate,editor,name){return Optional.from(editor.settings[name]).filter(predicate)},getParam=function(editor,name,defaultVal,type){var p,value=name in editor.settings?editor.settings[name]:defaultVal;return"hash"===type?function(value){var output={};return"string"==typeof value?each$k(value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),(function(val){var arr=val.split("=");arr.length>1?output[Tools.trim(arr[0])]=Tools.trim(arr[1]):output[Tools.trim(arr[0])]=Tools.trim(arr[0])})):output=value,output}(value):"string"===type?getFiltered(isString$1,editor,name).getOr(defaultVal):"number"===type?getFiltered(isNumber,editor,name).getOr(defaultVal):"boolean"===type?getFiltered(isBoolean,editor,name).getOr(defaultVal):"object"===type?getFiltered(isObject,editor,name).getOr(defaultVal):"array"===type?getFiltered(isArray$1,editor,name).getOr(defaultVal):"string[]"===type?getFiltered((p=isString$1,function(a){return isArray$1(a)&&forall(a,p)}),editor,name).getOr(defaultVal):"function"===type?getFiltered(isFunction,editor,name).getOr(defaultVal):value},IconManager=(lookup={},{add:function(id,iconPack){lookup[id]=iconPack},get:function(id){return lookup[id]?lookup[id]:{icons:{}}},has:function(id){return has$2(lookup,id)}}),getProp=function(propName,elm){return elm.dom[propName]},getComputedSizeProp=function(propName,elm){return parseInt(get$5(elm,propName),10)},getClientWidth=curry(getProp,"clientWidth"),getClientHeight=curry(getProp,"clientHeight"),getMarginTop=curry(getComputedSizeProp,"margin-top"),getMarginLeft=curry(getComputedSizeProp,"margin-left"),isXYInContentArea=function(editor,clientX,clientY){var element,bodyElm=SugarElement.fromDom(editor.getBody()),targetElm=editor.inline?bodyElm:(element=bodyElm,SugarElement.fromDom(documentOrOwner(element).dom.documentElement)),transposedPoint=function(inline,elm,clientX,clientY){var clientRect=function(elm){return elm.dom.getBoundingClientRect()}(elm);return{x:clientX-(inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0),y:clientY-(inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0)}}(editor.inline,targetElm,clientX,clientY);return function(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm),clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight}(targetElm,transposedPoint.x,transposedPoint.y)},isEditorAttachedToDom=function(editor){var node,rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return(node=rawContainer,Optional.from(node).map(SugarElement.fromDom)).map(inBody).getOr(!1)},NotificationManager=function(editor){var notifications=[],getImplementation=function(){var unimplemented,theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():{open:unimplemented=function(){throw new Error("Theme did not provide a NotificationManager implementation.")},close:unimplemented,reposition:unimplemented,getArgs:unimplemented}},getTopNotification=function(){return Optional.from(notifications[0])},reposition=function(){notifications.length>0&&getImplementation().reposition(notifications)},closeNotification=function(notification){findIndex$2(notifications,(function(otherNotification){return otherNotification===notification})).each((function(index){notifications.splice(index,1)}))},open=function(spec,fireEvent){if(void 0===fireEvent&&(fireEvent=!0),!editor.removed&&isEditorAttachedToDom(editor))return fireEvent&&editor.fire("BeforeOpenNotification",{notification:spec}),find$3(notifications,(function(notification){return a=getImplementation().getArgs(notification),b=spec,!(a.type!==b.type||a.text!==b.text||a.progressBar||a.timeout||b.progressBar||b.timeout);var a,b})).getOrThunk((function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,(function(){closeNotification(notification),reposition(),getTopNotification().fold((function(){return editor.focus()}),(function(top){return SugarElement.fromDom(top.getEl()).dom.focus()}))}));return function(notification){notifications.push(notification)}(notification),reposition(),editor.fire("OpenNotification",{notification:__assign({},notification)}),notification}))},getNotifications=constant(notifications);return function(editor){editor.on("SkinLoaded",(function(){var serviceMessage=function(editor){return editor.getParam("service_message")}(editor);serviceMessage&&open({text:serviceMessage,type:"warning",timeout:0},!1),reposition()})),editor.on("show ResizeEditor ResizeWindow NodeChange",(function(){Delay.requestAnimationFrame(reposition)})),editor.on("remove",(function(){each$k(notifications.slice(),(function(notification){getImplementation().close(notification)}))}))}(editor),{open:open,close:function(){getTopNotification().each((function(notification){getImplementation().close(notification),closeNotification(notification),reposition()}))},getNotifications:getNotifications}},PluginManager=AddOnManager.PluginManager,ThemeManager=AddOnManager.ThemeManager;var WindowManager=function(editor){var dialogs=[],getImplementation=function(){var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():function WindowManagerImpl(){var unimplemented=function(){throw new Error("Theme did not provide a WindowManager implementation.")};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented}}()},funcBind=function(scope,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f?f.apply(scope,args):void 0}},addDialog=function(dialog){dialogs.push(dialog),function(dialog){editor.fire("OpenWindow",{dialog:dialog})}(dialog)},closeDialog=function(dialog){!function(dialog){editor.fire("CloseWindow",{dialog:dialog})}(dialog),0===(dialogs=filter$4(dialogs,(function(otherDialog){return otherDialog!==dialog}))).length&&editor.focus()},storeSelectionAndOpenDialog=function(openDialog){editor.editorManager.setActive(editor),store(editor);var dialog=openDialog();return addDialog(dialog),dialog};return editor.on("remove",(function(){each$k(dialogs,(function(dialog){getImplementation().close(dialog)}))})),{open:function(args,params){return storeSelectionAndOpenDialog((function(){return getImplementation().open(args,params,closeDialog)}))},openUrl:function(args){return storeSelectionAndOpenDialog((function(){return getImplementation().openUrl(args,closeDialog)}))},alert:function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope||windowManagerImpl,callback))},confirm:function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope||windowManagerImpl,callback))},close:function(){Optional.from(dialogs[dialogs.length-1]).each((function(dialog){getImplementation().close(dialog),closeDialog(dialog)}))}}},displayNotification=function(editor,message){editor.notificationManager.open({type:"error",text:message})},displayError=function(editor,message){editor._skinLoaded?displayNotification(editor,message):editor.on("SkinLoaded",(function(){displayNotification(editor,message)}))},logError=function(editor,errorType,msg){fireError(editor,errorType,{message:msg}),console.error(msg)},createLoadError=function(type,url,name){return name?"Failed to load "+type+": "+name+" from url "+url:"Failed to load "+type+" url: "+url},pluginLoadError=function(editor,url,name){logError(editor,"PluginLoadError",createLoadError("plugin",url,name))},initError=function(message){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var console=window.console;console&&(console.error?console.error.apply(console,__spreadArray([message],x,!1)):console.log.apply(console,__spreadArray([message],x,!1)))},getContentCssUrls=function(editor){return transformToUrls(editor,function(editor){var contentCss=editor.getParam("content_css");return isString$1(contentCss)?map$3(contentCss.split(","),trim$4):isArray$1(contentCss)?contentCss:!1===contentCss||editor.inline?[]:["default"]}(editor))},transformToUrls=function(editor,cssLinks){var skinUrl=editor.editorManager.baseURL+"/skins/content",contentCssFile="content"+editor.editorManager.suffix+".css",inline=!0===editor.inline;return map$3(cssLinks,(function(url){return function(url){return/^[a-z0-9\-]+$/i.test(url)}(url)&&!inline?skinUrl+"/"+url+"/"+contentCssFile:editor.documentBaseURI.toAbsolute(url)}))},appendContentCssFromSettings=function(editor){editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),function(editor){return transformToUrls(editor,getFontCss(editor))}(editor))},UploadStatus=function(){var blobUriStatuses={},createStatus=function(status,resultUri){return{status:status,resultUri:resultUri}},hasBlobUri=function(blobUri){return blobUri in blobUriStatuses};return{hasBlobUri:hasBlobUri,getResultUri:function(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null},isPending:function(blobUri){return!!hasBlobUri(blobUri)&&1===blobUriStatuses[blobUri].status},isUploaded:function(blobUri){return!!hasBlobUri(blobUri)&&2===blobUriStatuses[blobUri].status},markPending:function(blobUri){blobUriStatuses[blobUri]=createStatus(1,null)},markUploaded:function(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(2,resultUri)},removeFailed:function(blobUri){delete blobUriStatuses[blobUri]},destroy:function(){blobUriStatuses={}}}},count=0,uuid=function(prefix){return prefix+count+++(rnd=function(){return Math.round(4294967295*Math.random()).toString(36)},"s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd());var rnd},Uploader=function(uploadStatus,settings){var pendingPromises={},defaultHandler=function(blobInfo,success,failure,progress){var xhr=new XMLHttpRequest;xhr.open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){if(xhr.status<200||xhr.status>=300)failure("HTTP Error: "+xhr.status);else{var path1,path2,json=JSON.parse(xhr.responseText);if(json&&"string"==typeof json.location)success((path1=settings.basePath,path2=json.location,path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2));else failure("Invalid JSON: "+xhr.responseText)}};var formData=new FormData;formData.append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)},handlerSuccess=function(blobInfo,url){return{url:url,blobInfo:blobInfo,status:!0}},handlerFailure=function(blobInfo,message,options){return{url:"",blobInfo:blobInfo,status:!1,error:{message:message,options:options}}},resolvePending=function(blobUri,result){Tools.each(pendingPromises[blobUri],(function(resolve){resolve(result)})),delete pendingPromises[blobUri]},uploadBlobs=function(blobInfos,openNotification){return blobInfos=Tools.grep(blobInfos,(function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri())})),promiseObj.all(Tools.map(blobInfos,(function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?function(blobInfo){var blobUri=blobInfo.blobUri();return new promiseObj((function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)}))}(blobInfo):function(blobInfo,handler,openNotification){return uploadStatus.markPending(blobInfo.blobUri()),new promiseObj((function(resolve){var notification;try{var closeNotification_1=function(){notification&&notification.close()};handler(blobInfo,(function(url){closeNotification_1(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))}),(function(error,options){var failureOptions=options||{};closeNotification_1(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error,failureOptions)),resolve(handlerFailure(blobInfo,error,failureOptions))}),(function(percent){percent<0||percent>100||Optional.from(notification).orThunk((function(){return Optional.from(openNotification).map(apply)})).each((function(n){notification=n,n.progressBar.value(percent)}))}))}catch(ex){resolve(handlerFailure(blobInfo,ex.message,{}))}}))}(blobInfo,settings.handler,openNotification)})))};return!1===isFunction(settings.handler)&&(settings.handler=defaultHandler),{upload:function(blobInfos,openNotification){return settings.url||settings.handler!==defaultHandler?uploadBlobs(blobInfos,openNotification):new promiseObj((function(resolve){resolve([])}))}}},openNotification=function(editor){return function(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}},createUploader=function(editor,uploadStatus){return Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)})},EditorUpload=function(editor){var uploader,imageScanner,blobCache=function(){var cache=[],toBlobInfo=function(o){if(!o.blob||!o.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");var mime,id=o.id||uuid("blobid"),name=o.name||id,blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+"."+(mime=blob.type,{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png","image/apng":"apng","image/avif":"avif","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"}[mime.toLowerCase()]||"dat")),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)}},findFirst=function(predicate){return find$3(cache,predicate).getOrUndefined()},get=function(id){return findFirst((function(cachedBlobInfo){return cachedBlobInfo.id()===id}))};return{create:function(o,blob,base64,name,filename){if(isString$1(o))return toBlobInfo({id:o,name:name,filename:filename,blob:blob,base64:base64});if(isObject(o))return toBlobInfo(o);throw new Error("Unknown input type")},add:function(blobInfo){get(blobInfo.id())||cache.push(blobInfo)},get:get,getByUri:function(blobUri){return findFirst((function(blobInfo){return blobInfo.blobUri()===blobUri}))},getByData:function(base64,type){return findFirst((function(blobInfo){return blobInfo.base64()===base64&&blobInfo.blob().type===type}))},findFirst:findFirst,removeByUri:function(blobUri){cache=filter$4(cache,(function(blobInfo){return blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)}))},destroy:function(){each$k(cache,(function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())})),cache=[]}}}(),uploadStatus=UploadStatus(),urlFilters=[],changeHandler=function(editor){var lastChangedLevel=Cell(null);return editor.on("change AddUndo",(function(e){lastChangedLevel.set(__assign({},e.level))})),{fireIfChanged:function(){var data=editor.undoManager.data;last$2(data).filter((function(level){return!isEq$1(lastChangedLevel.get(),level)})).each((function(level){editor.setDirty(!0),editor.fire("change",{level:level,lastLevel:get$a(data,data.length-2).getOrNull()})}))}}}(editor),aliveGuard=function(callback){return function(result){return editor.selection?callback(result):[]}},replaceString=function(content,search,replace){var index=0;do{-1!==(index=content.indexOf(search,index))&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1)}while(-1!==index);return content},replaceImageUrl=function(content,targetUrl,replacementUrl){var replacementString='src="'+replacementUrl+'"'+(replacementUrl===Env.transparentSrc?' data-mce-placeholder="1"':"");return content=replaceString(content,'src="'+targetUrl+'"',replacementString),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')},replaceUrlInUndoStack=function(targetUrl,replacementUrl){each$k(editor.undoManager.data,(function(level){"fragmented"===level.type?level.fragments=map$3(level.fragments,(function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl)})):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)}))},uploadImages=function(callback){return uploader||(uploader=createUploader(editor,uploadStatus)),scanForImages().then(aliveGuard((function(imageInfos){var blobInfos=map$3(imageInfos,(function(imageInfo){return imageInfo.blobInfo}));return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard((function(result){var imagesToRemove=[],filteredResult=map$3(result,(function(uploadInfo,index){var blobInfo=imageInfos[index].blobInfo,image=imageInfos[index].image;return uploadInfo.status&&function(editor){return editor.getParam("images_replace_blob_uris",!0,"boolean")}(editor)?(blobCache.removeByUri(image.src),isRtc(editor)||function(image,resultUri){var url,src=editor.convertURL(resultUri,"src");replaceUrlInUndoStack(image.src,resultUri),editor.$(image).attr({src:shouldReuseFileName(editor)?(url=resultUri,url+(-1===url.indexOf("?")?"?":"&")+(new Date).getTime()):resultUri,"data-mce-src":src})}(image,uploadInfo.url)):uploadInfo.error&&(uploadInfo.error.options.remove&&(replaceUrlInUndoStack(image.getAttribute("src"),Env.transparentSrc),imagesToRemove.push(image)),function(editor,message){displayError(editor,I18n.translate(["Failed to upload image: {0}",message]))}(editor,uploadInfo.error.message)),{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo:blobInfo}}));return filteredResult.length>0&&changeHandler.fireIfChanged(),imagesToRemove.length>0&&(isRtc(editor)?console.error("Removing images on failed uploads is currently unsupported for RTC"):editor.undoManager.transact((function(){each$k(imagesToRemove,(function(element){editor.dom.remove(element),blobCache.removeByUri(element.src)}))}))),callback&&callback(filteredResult),filteredResult})))})))},uploadImagesAuto=function(callback){if(isAutomaticUploadsEnabled(editor))return uploadImages(callback)},isValidDataUriImage=function(imgElm){return!1!==forall(urlFilters,(function(filter){return filter(imgElm)}))&&(0!==imgElm.getAttribute("src").indexOf("data:")||function(editor){return editor.getParam("images_dataimg_filter",always,"function")}(editor)(imgElm))},scanForImages=function(){return imageScanner||(imageScanner=ImageScanner(uploadStatus,blobCache)),imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard((function(result){return result=filter$4(result,(function(resultItem){return"string"!=typeof resultItem||(displayError(editor,resultItem),!1)})),isRtc(editor)||each$k(result,(function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")})),result})))},replaceBlobUris=function(content){return content.replace(/src="(blob:[^"]+)"/g,(function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';var blobInfo=blobCache.getByUri(blobUri);return blobInfo||(blobInfo=foldl(editor.editorManager.get(),(function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)}),null)),blobInfo?'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"':match}))};return editor.on("SetContent",(function(){isAutomaticUploadsEnabled(editor)?uploadImagesAuto():scanForImages()})),editor.on("RawSaveContent",(function(e){e.content=replaceBlobUris(e.content)})),editor.on("GetContent",(function(e){e.source_view||"raw"===e.format||"tree"===e.format||(e.content=replaceBlobUris(e.content))})),editor.on("PostRender",(function(){editor.parser.addNodeFilter("img",(function(images){each$k(images,(function(img){var src=img.attr("src");if(!blobCache.getByUri(src)){var resultUri=uploadStatus.getResultUri(src);resultUri&&img.attr("src",resultUri)}}))}))})),{blobCache:blobCache,addFilter:function(filter){urlFilters.push(filter)},uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:function(){blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null}}},FormatRegistry=function(editor){var formats={},register=function(name,format){name&&(isString$1(name)?(isArray$1(format)||(format=[format]),each$k(format,(function(format){isUndefined(format.deep)&&(format.deep=!isSelectorFormat(format)),isUndefined(format.split)&&(format.split=!isSelectorFormat(format)||isInlineFormat(format)),isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)&&(format.remove="none"),isSelectorFormat(format)&&isInlineFormat(format)&&(format.mixed=!0,format.block_expand=!0),isString$1(format.classes)&&(format.classes=format.classes.split(/\s+/))})),formats[name]=format):each$j(name,(function(format,name){register(name,format)})))};return register(function(dom){var formats={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table,audio,video",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img,audio,video",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table,audio,video",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all",preserve_attributes:["class","style"]}],italic:[{inline:"em",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all",preserve_attributes:["class","style"]}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all",preserve_attributes:["class","style"]}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all",preserve_attributes:["class","style"]},{inline:"s",remove:"all",preserve_attributes:["class","style"]}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},lineheight:{selector:"h1,h2,h3,h4,h5,h6,p,li,td,th,div",defaultBlock:"p",styles:{lineHeight:"%value"}},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:!0,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(node,_fmt,_itemName){return isElement$5(node)&&node.hasAttribute("href")},onformat:function(elm,_fmt,vars){Tools.each(vars,(function(value,key){dom.setAttrib(elm,key,value)}))}},lang:{inline:"span",clear_child_styles:!0,remove_similar:!0,attributes:{lang:"%value","data-mce-lang":function(vars){var _a;return null!==(_a=null==vars?void 0:vars.customValue)&&void 0!==_a?_a:null}}},removeformat:[{selector:"b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Tools.each("p h1 h2 h3 h4 h5 h6 div address pre dt dd samp".split(/\s/),(function(name){formats[name]={block:name,remove:"all"}})),formats}(editor.dom)),register(function(editor){return editor.getParam("formats")}(editor)),{get:function(name){return isNonNullable(name)?formats[name]:formats},has:function(name){return has$2(formats,name)},register:register,unregister:function(name){return name&&formats[name]&&delete formats[name],formats}}},each$5=Tools.each,dom=DOMUtils.DOM,parsedSelectorToHtml=function(ancestry,editor){var elm,item,fragment,schema=editor&&editor.schema||Schema({}),createElement=function(sItem){item="string"==typeof sItem?{name:sItem,classes:[],attrs:{}}:sItem;var elm=dom.create(item.name);return function(elm,item){item.classes.length&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)}(elm,item),elm},wrapInHtml=function(elm,ancestry,siblings){var parent,parentCandidate,ancestor=ancestry.length>0&&ancestry[0],ancestorName=ancestor&&ancestor.name,parentRequired=function(elm,candidate){var name="string"!=typeof elm?elm.nodeName.toLowerCase():elm,elmRule=schema.getElementRule(name),parentsRequired=elmRule&&elmRule.parentsRequired;return!(!parentsRequired||!parentsRequired.length)&&(candidate&&-1!==Tools.inArray(parentsRequired,candidate)?candidate:parentsRequired[0])}(elm,ancestorName);if(parentRequired)ancestorName===parentRequired?(parentCandidate=ancestry[0],ancestry=ancestry.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestry[0],ancestry=ancestry.slice(1);else if(!siblings)return elm;return parentCandidate&&(parent=createElement(parentCandidate)).appendChild(elm),siblings&&(parent||(parent=dom.create("div")).appendChild(elm),Tools.each(siblings,(function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm)}))),wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings)};return ancestry&&ancestry.length?(item=ancestry[0],elm=createElement(item),(fragment=dom.create("div")).appendChild(wrapInHtml(elm,ancestry.slice(1),item.siblings)),fragment):""},parseSelectorItem=function(item){var tagName,obj={classes:[],attrs:{}};return"*"!==(item=obj.selector=Tools.trim(item))&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,(function($0,$1,$2,$3,$4){switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}if("["===$3){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);m&&(obj.attrs[m[1]]=m[2])}return""}))),obj.name=tagName||"div",obj},getCssText=function(editor,format){var name,previewFrag,parentFontSize,previewCss="",previewStyles=function(editor){var style=editor.getParam("preview_styles","font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow");return isString$1(style)?style:""}(editor);if(""===previewStyles)return"";var removeVars=function(val){return val.replace(/%(\w+)/g,"")};if("string"==typeof format){if(!(format=editor.formatter.get(format)))return;format=format[0]}if("preview"in format){var previewOpt=get$9(format,"preview");if(is$1(previewOpt,!1))return"";previewStyles=previewOpt.getOr(previewStyles)}name=format.block||format.inline||"span";var selector,items=(selector=format.selector)&&"string"==typeof selector?(selector=(selector=selector.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),(function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=siblings.pop();return siblings.length&&(obj.siblings=siblings),obj})).reverse()):[];items.length?(items[0].name||(items[0].name=name),name=format.selector,previewFrag=parsedSelectorToHtml(items,editor)):previewFrag=parsedSelectorToHtml([name],editor);var previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;return each$5(format.styles,(function(value,name){var newValue=removeVars(value);newValue&&dom.setStyle(previewElm,name,newValue)})),each$5(format.attributes,(function(value,name){var newValue=removeVars(value);newValue&&dom.setAttrib(previewElm,name,newValue)})),each$5(format.classes,(function(value){var newValue=removeVars(value);dom.hasClass(previewElm,newValue)||dom.addClass(previewElm,newValue)})),editor.fire("PreviewFormats"),dom.setStyles(previewFrag,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewFrag),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each$5(previewStyles.split(" "),(function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"===name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"===dom.toHex(value).toLowerCase())||"color"===name&&"#000000"===dom.toHex(value).toLowerCase())){if("font-size"===name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=parseFloat(value)/(/%$/.test(value)?100:1)*parentFontSize+"px"}"border"===name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}})),editor.fire("AfterPreviewFormats"),dom.remove(previewFrag),previewCss},Formatter=function(editor){var formats=FormatRegistry(editor),formatChangeState=Cell(null);return function(editor){editor.addShortcut("meta+b","","Bold"),editor.addShortcut("meta+i","","Italic"),editor.addShortcut("meta+u","","Underline");for(var i=1;i<=6;i++)editor.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);editor.addShortcut("access+7","",["FormatBlock",!1,"p"]),editor.addShortcut("access+8","",["FormatBlock",!1,"div"]),editor.addShortcut("access+9","",["FormatBlock",!1,"address"])}(editor),setup$k(editor),{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:function(name,vars,node){!function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.apply(name,vars,node)}(editor,name,vars,node)},remove:function(name,vars,node,similar){!function(editor,name,vars,node,similar){getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar)}(editor,name,vars,node,similar)},toggle:function(name,vars,node){!function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.toggle(name,vars,node)}(editor,name,vars,node)},match:function(name,vars,node,similar){return function(editor,name,vars,node,similar){return getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar)}(editor,name,vars,node,similar)},closest:function(names){return function(editor,names){return getRtcInstanceWithError(editor).formatter.closest(names)}(editor,names)},matchAll:function(names,vars){return function(editor,names,vars){return getRtcInstanceWithError(editor).formatter.matchAll(names,vars)}(editor,names,vars)},matchNode:function(node,name,vars,similar){return function(editor,node,name,vars,similar){return getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar)}(editor,node,name,vars,similar)},canApply:function(name){return function(editor,name){return getRtcInstanceWithError(editor).formatter.canApply(name)}(editor,name)},formatChanged:function(formats,callback,similar,vars){return function(editor,registeredFormatListeners,formats,callback,similar,vars){return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars)}(editor,formatChangeState,formats,callback,similar,vars)},getCssText:curry(getCssText,editor)}},shouldIgnoreCommand=function(cmd){switch(cmd.toLowerCase()){case"undo":case"redo":case"mcerepaint":case"mcefocus":return!0;default:return!1}},UndoManager=function(editor){var beforeBookmark=value(),locks=Cell(0),index=Cell(0),undoManager={data:[],typing:!1,beforeChange:function(){!function(editor,locks,beforeBookmark){getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark)}(editor,locks,beforeBookmark)},add:function(level,event){return function(editor,undoManager,index,locks,beforeBookmark,level,event){return getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event)}(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(){return function(editor,undoManager,locks,index){return getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index)}(editor,undoManager,locks,index)},redo:function(){return function(editor,index,data){return getRtcInstanceWithError(editor).undoManager.redo(index,data)}(editor,index,undoManager.data)},clear:function(){!function(editor,undoManager,index){getRtcInstanceWithError(editor).undoManager.clear(undoManager,index)}(editor,undoManager,index)},reset:function(){!function(editor,undoManager){getRtcInstanceWithError(editor).undoManager.reset(undoManager)}(editor,undoManager)},hasUndo:function(){return function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index)}(editor,undoManager,index)},hasRedo:function(){return function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index)}(editor,undoManager,index)},transact:function(callback){return function(editor,undoManager,locks,callback){return getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback)}(editor,undoManager,locks,callback)},ignore:function(callback){!function(editor,locks,callback){getRtcInstanceWithError(editor).undoManager.ignore(locks,callback)}(editor,locks,callback)},extra:function(callback1,callback2){!function(editor,undoManager,index,callback1,callback2){getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2)}(editor,undoManager,index,callback1,callback2)}};return isRtc(editor)||function(editor,undoManager,locks){var isFirstTypedCharacter=Cell(!1),addNonTypingUndoLevel=function(e){setTyping(undoManager,!1,locks),undoManager.add({},e)};editor.on("init",(function(){undoManager.add()})),editor.on("BeforeExecCommand",(function(e){var cmd=e.command;shouldIgnoreCommand(cmd)||(endTyping(undoManager,locks),undoManager.beforeChange())})),editor.on("ExecCommand",(function(e){var cmd=e.command;shouldIgnoreCommand(cmd)||addNonTypingUndoLevel(e)})),editor.on("ObjectResizeStart cut",(function(){undoManager.beforeChange()})),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("dragend",addNonTypingUndoLevel),editor.on("keyup",(function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter.get()&&undoManager.typing&&!1===isEq$1(createFromEditor(editor),undoManager.data[0])&&(!1===editor.isDirty()&&(editor.setDirty(!0),editor.fire("change",{level:undoManager.data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter.set(!1),editor.nodeChanged()))})),editor.on("keydown",(function(e){var keyCode=e.keyCode;if(!e.isDefaultPrevented())if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode)undoManager.typing&&addNonTypingUndoLevel(e);else{var modKey=e.ctrlKey&&!e.altKey||e.metaKey;!(keyCode<16||keyCode>20)||224===keyCode||91===keyCode||undoManager.typing||modKey||(undoManager.beforeChange(),setTyping(undoManager,!0,locks),undoManager.add({},e),isFirstTypedCharacter.set(!0))}})),editor.on("mousedown",(function(e){undoManager.typing&&addNonTypingUndoLevel(e)})),editor.on("input",(function(e){var event;e.inputType&&("insertReplacementText"===e.inputType||"insertText"===(event=e).inputType&&null===event.data||function(event){return"insertFromPaste"===event.inputType||"insertFromDrop"===event.inputType}(e))&&addNonTypingUndoLevel(e)})),editor.on("AddUndo Undo Redo ClearUndos",(function(e){e.isDefaultPrevented()||editor.nodeChanged()}))}(editor,undoManager,locks),function(editor){editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo")}(editor),undoManager},nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]),isKeyboardEvent=function(e){return"keydown"===e.type||"keyup"===e.type},isDeleteEvent=function(e){var keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE},setup$g=function(editor){var dom=editor.dom,rootBlock=getForcedRootBlock(editor),placeholder=function(editor){return editor.getParam("placeholder",DOM$9.getAttrib(editor.getElement(),"placeholder"),"string")}(editor),updatePlaceholder=function(e,initial){if(!function(e){if(isKeyboardEvent(e)){var keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains$3(nonTypingKeycodes,keyCode))}return!1}(e)){var body=editor.getBody(),showPlaceholder=!function(e){return isKeyboardEvent(e)&&!(isDeleteEvent(e)||"keyup"===e.type&&229===e.keyCode)}(e)&&function(dom,rootElm,forcedRootBlock){if(isEmpty$2(SugarElement.fromDom(rootElm),!1)){var isForcedRootBlockFalse=""===forcedRootBlock,firstElement=rootElm.firstElementChild;return!firstElement||!dom.getStyle(rootElm.firstElementChild,"padding-left")&&!dom.getStyle(rootElm.firstElementChild,"padding-right")&&(isForcedRootBlockFalse?!dom.isBlock(firstElement):forcedRootBlock===firstElement.nodeName.toLowerCase())}return!1}(dom,body,rootBlock);(""!==dom.getAttrib(body,"data-mce-placeholder")!==showPlaceholder||initial)&&(dom.setAttrib(body,"data-mce-placeholder",showPlaceholder?placeholder:null),dom.setAttrib(body,"aria-placeholder",showPlaceholder?placeholder:null),function(editor,state){editor.fire("PlaceholderToggle",{state:state})}(editor,showPlaceholder),editor.on(showPlaceholder?"keydown":"keyup",updatePlaceholder),editor.off(showPlaceholder?"keyup":"keydown",updatePlaceholder))}};placeholder&&editor.on("init",(function(e){updatePlaceholder(e,!0),editor.on("change SetContent ExecCommand",updatePlaceholder),editor.on("paste",(function(e){return Delay.setEditorTimeout(editor,(function(){return updatePlaceholder(e)}))}))}))},strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,isInlineTarget=function(editor,elm){return is$2(SugarElement.fromDom(elm),function(editor){return editor.getParam("inline_boundaries_selector","a[href],code,.mce-annotation","string")}(editor))},isRtl=function(element){return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||(text=element.textContent,strongRtl.test(text));var text},findRootInline=function(isInlineTarget,rootNode,pos){var parents=function(isInlineTarget,rootNode,pos){return filter$4(DOMUtils.DOM.getParents(pos.container(),"*",rootNode),isInlineTarget)}(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1])},normalizePosition=function(forward,pos){if(!pos)return pos;var container=pos.container(),offset=pos.offset();return forward?isCaretContainerInline(container)?isText$7(container.nextSibling)?CaretPosition(container.nextSibling,0):CaretPosition.after(container):isBeforeInline(pos)?CaretPosition(container,offset+1):pos:isCaretContainerInline(container)?isText$7(container.previousSibling)?CaretPosition(container.previousSibling,container.previousSibling.data.length):CaretPosition.before(container):isAfterInline(pos)?CaretPosition(container,offset-1):pos},normalizeForwards=curry(normalizePosition,!0),normalizeBackwards=curry(normalizePosition,!1),isTextBlockOrListItem=function(element){return isTextBlock$2(element)||isListItem(element)},getParentBlock$1=function(rootNode,elm){return contains$1(rootNode,elm)?closest$3(elm,isTextBlockOrListItem,function(rootNode){return function(elm){return eq(rootNode,SugarElement.fromDom(elm.dom.parentNode))}}(rootNode)):Optional.none()},paddEmptyBody=function(editor){editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),function(editor){var body=editor.getBody(),node=body.firstChild&&editor.dom.isBlock(body.firstChild)?body.firstChild:body;editor.selection.setCursorLocation(node,0)}(editor))},blockBoundary=function(from,to){return{from:from,to:to}},getBlockPosition=function(rootNode,pos){var rootElm=SugarElement.fromDom(rootNode),containerElm=SugarElement.fromDom(pos.container());return getParentBlock$1(rootElm,containerElm).map((function(block){return function(block,position){return{block:block,position:position}}(block,pos)}))},readFromRange=function(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng)),toBlockPos=fromBlockPos.bind((function(blockPos){return fromPosition(forward,rootNode,blockPos.position).bind((function(to){return getBlockPosition(rootNode,to).map((function(blockPos){return function(rootNode,forward,blockPosition){return isBr$5(blockPosition.position.getNode())&&!1===isEmpty$2(blockPosition.block)?positionIn(!1,blockPosition.block.dom).bind((function(lastPositionInBlock){return lastPositionInBlock.isEqual(blockPosition.position)?fromPosition(forward,rootNode,lastPositionInBlock).bind((function(to){return getBlockPosition(rootNode,to)})):Optional.some(blockPosition)})).getOr(blockPosition):blockPosition}(rootNode,forward,blockPos)}))}))}));return lift2(fromBlockPos,toBlockPos,blockBoundary).filter((function(blockBoundary){return function(blockBoundary){return!1===eq(blockBoundary.from.block,blockBoundary.to.block)}(blockBoundary)&&function(blockBoundary){return parent(blockBoundary.from.block).bind((function(parent1){return parent(blockBoundary.to.block).filter((function(parent2){return eq(parent1,parent2)}))})).isSome()}(blockBoundary)&&function(blockBoundary){return!1===isContentEditableFalse$b(blockBoundary.from.block.dom)&&!1===isContentEditableFalse$b(blockBoundary.to.block.dom)}(blockBoundary)}))},getChildrenUntilBlockBoundary=function(block){var children$1=children(block);return findIndex$2(children$1,isBlock$2).fold(constant(children$1),(function(index){return children$1.slice(0,index)}))},extractChildren=function(block){var children=getChildrenUntilBlockBoundary(block);return each$k(children,remove$7),children},removeEmptyRoot=function(rootNode,block){var parents=parentsAndSelf(block,rootNode);return find$3(parents.reverse(),(function(element){return isEmpty$2(element)})).each(remove$7)},nestedBlockMerge=function(rootNode,fromBlock,toBlock,insertionPoint){if(isEmpty$2(toBlock))return fillWithPaddingBr(toBlock),firstPositionIn(toBlock.dom);0===filter$4(prevSiblings(insertionPoint),(function(el){return!isEmpty$2(el)})).length&&isEmpty$2(fromBlock)&&before$4(insertionPoint,SugarElement.fromTag("br"));var position=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom));return each$k(extractChildren(fromBlock),(function(child){before$4(insertionPoint,child)})),removeEmptyRoot(rootNode,fromBlock),position},sidelongBlockMerge=function(rootNode,fromBlock,toBlock){if(isEmpty$2(toBlock))return remove$7(toBlock),isEmpty$2(fromBlock)&&fillWithPaddingBr(fromBlock),firstPositionIn(fromBlock.dom);var position=lastPositionIn(toBlock.dom);return each$k(extractChildren(fromBlock),(function(child){append$1(toBlock,child)})),removeEmptyRoot(rootNode,fromBlock),position},getInsertionPoint=function(fromBlock,toBlock){return contains$1(toBlock,fromBlock)?function(toBlock,block){var parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1])}(toBlock,fromBlock):Optional.none()},trimBr=function(first,block){positionIn(first,block.dom).map((function(position){return position.getNode()})).map(SugarElement.fromDom).filter(isBr$4).each(remove$7)},mergeBlockInto=function(rootNode,fromBlock,toBlock){return trimBr(!0,fromBlock),trimBr(!1,toBlock),getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock))},mergeBlocks=function(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2)},backspaceDelete$8=function(editor,forward){var rootNode=SugarElement.fromDom(editor.getBody()),position=function(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none()}(rootNode.dom,forward,editor.selection.getRng()).bind((function(blockBoundary){return mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block)}));return position.each((function(pos){editor.selection.setRng(pos.toRange())})),position.isSome()},isRawNodeInTable=function(root,rawNode){var node=SugarElement.fromDom(rawNode),isRoot=curry(eq,root);return ancestor$3(node,isTableCell$4,isRoot).isSome()},isEverythingSelected=function(root,rng){var noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone(),noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!function(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer)}(root,rng)&&noPrevious&&noNext},deleteRange$1=function(editor){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?function(editor){return editor.setContent(""),editor.selection.setCursorLocation(),!0}(editor):function(rootNode,selection){var rng=selection.getRng();return lift2(getParentBlock$1(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$1(rootNode,SugarElement.fromDom(rng.endContainer)),(function(block1,block2){return!1===eq(block1,block2)&&(rng.deleteContents(),mergeBlocks(rootNode,!0,block1,block2).each((function(pos){selection.setRng(pos.toRange())})),!0)})).getOr(!1)}(rootNode,editor.selection)},backspaceDelete$7=function(editor,_forward){return!editor.selection.isCollapsed()&&deleteRange$1(editor)},isContentEditableTrue$2=isContentEditableTrue$4,isContentEditableFalse$4=isContentEditableFalse$b,showCaret=function(direction,editor,node,before,scrollIntoView){return Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView))},selectNode=function(editor,node){return editor.fire("BeforeObjectSelected",{target:node}).isDefaultPrevented()?Optional.none():Optional.some(function(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng}(node))},renderCaretAtRange=function(editor,range,scrollIntoView){var normalizedRange=normalizeRange(1,editor.getBody(),range),caretPosition=CaretPosition.fromRangeStart(normalizedRange),caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode))return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),!1);var caretPositionBeforeNode=caretPosition.getNode(!0);if(isInlineFakeCaretTarget(caretPositionBeforeNode))return showCaret(1,editor,caretPositionBeforeNode,!1,!1);var ceRoot=editor.dom.getParent(caretPosition.getNode(),(function(node){return isContentEditableFalse$4(node)||isContentEditableTrue$2(node)}));return isInlineFakeCaretTarget(ceRoot)?showCaret(1,editor,ceRoot,!1,scrollIntoView):Optional.none()},renderRangeCaret=function(editor,range,scrollIntoView){return range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range},isBeforeBoundary=function(pos){return isBeforeContentEditableFalse(pos)||isBeforeMedia(pos)},isAfterBoundary=function(pos){return isAfterContentEditableFalse(pos)||isAfterMedia(pos)},deleteContentAndShowCaret=function(editor,range,node,direction,forward,peekCaretPosition){return showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,!0).each((function(caretRange){if(range.collapsed){var deleteRange=range.cloneRange();forward?deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset):deleteRange.setStart(caretRange.endContainer,caretRange.endOffset),deleteRange.deleteContents()}else range.deleteContents();editor.selection.setRng(caretRange)})),function(dom,node){isText$7(node)&&0===node.data.length&&dom.remove(node)}(editor.dom,node),!0},backspaceDelete$6=function(editor,forward){return function(editor,forward){var range=editor.selection.getRng();if(!isText$7(range.commonAncestorContainer))return!1;var direction=forward?HDirection.Forwards:HDirection.Backwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev),isBeforeFn=forward?isBeforeBoundary:isAfterBoundary,caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),nextCaretPosition=normalizePosition(forward,getNextPosFn(caretPosition));if(!nextCaretPosition||!isMoveInsideSameBlock(caretPosition,nextCaretPosition))return!1;if(isBeforeFn(nextCaretPosition))return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,nextCaretPosition);var peekCaretPosition=getNextPosFn(nextCaretPosition);return!!(peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition))&&deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition)}(editor,forward)},DeleteAction=Adt_generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),deleteEmptyBlockOrMoveToCef=function(root,forward,from,to){var toCefElm=to.getNode(!1===forward);return getParentBlock$1(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map((function(blockElm){return isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm)})).orThunk((function(){return Optional.some(DeleteAction.moveToElement(toCefElm))}))},findCefPosition=function(root,forward,from){return fromPosition(forward,root,from).bind((function(to){return node=to.getNode(),isTableCell$4(SugarElement.fromDom(node))||isListItem(SugarElement.fromDom(node))||function(root,forward,from,to){var inSameBlock=function(elm){return isInline$1(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root)};return getRelativeCefElm(!forward,from).fold((function(){return getRelativeCefElm(forward,to).fold(never,inSameBlock)}),inSameBlock)}(root,forward,from,to)?Optional.none():forward&&isContentEditableFalse$b(to.getNode())||!1===forward&&isContentEditableFalse$b(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(root,forward,from,to):forward&&isAfterContentEditableFalse(from)||!1===forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.moveToPosition(to)):Optional.none();var node}))},getContentEditableAction=function(root,forward,from){return function(forward,from){var elm=from.getNode(!1===forward),caretLocation=forward?"after":"before";return isElement$5(elm)&&elm.getAttribute("data-mce-caret")===caretLocation}(forward,from)?function(forward,elm){return forward&&isContentEditableFalse$b(elm.nextSibling)?Optional.some(DeleteAction.moveToElement(elm.nextSibling)):!1===forward&&isContentEditableFalse$b(elm.previousSibling)?Optional.some(DeleteAction.moveToElement(elm.previousSibling)):Optional.none()}(forward,from.getNode(!1===forward)).fold((function(){return findCefPosition(root,forward,from)}),Optional.some):findCefPosition(root,forward,from).bind((function(deleteAction){return function(root,from,deleteAction){return deleteAction.fold((function(elm){return Optional.some(DeleteAction.remove(elm))}),(function(elm){return Optional.some(DeleteAction.moveToElement(elm))}),(function(to){return isInSameBlock(from,to,root)?Optional.none():Optional.some(DeleteAction.moveToPosition(to))}))}(root,from,deleteAction)}))},getAncestorCe=function(editor,node){return Optional.from(getContentEditableRoot$1(editor.getBody(),node))},backspaceDeleteCaret=function(editor,forward){var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold((function(){return function(root,forward,rng){var normalizedRange=normalizeRange(forward?1:-1,root,rng),from=CaretPosition.fromRangeStart(normalizedRange),rootElement=SugarElement.fromDom(root);return!1===forward&&isAfterContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode(!0))):forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode())):!1===forward&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from)?findPreviousBr(rootElement,from).map((function(br){return DeleteAction.remove(br.getNode())})):forward&&isAfterContentEditableFalse(from)&&isBeforeBr$1(rootElement,from)?findNextBr(rootElement,from).map((function(br){return DeleteAction.remove(br.getNode())})):getContentEditableAction(root,forward,from)}(editor.getBody(),forward,editor.selection.getRng()).exists((function(deleteAction){return deleteAction.fold(function(editor,forward){return function(element){return editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0}}(editor,forward),function(editor,forward){return function(element){var pos=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(pos.toRange()),!0}}(editor,forward),function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),!0}}(editor))}))}),always)},backspaceDeleteRange=function(editor,forward){var selectedNode=editor.selection.getNode();return!(!isContentEditableFalse$b(selectedNode)||isTableCell$5(selectedNode))&&getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b).fold((function(){var rootElement;return rootElement=SugarElement.fromDom(editor.getBody()),each$k(descendants(rootElement,".mce-offscreen-selection"),remove$7),deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode())),paddEmptyBody(editor),!0}),always)},paddEmptyElement=function(editor){var dom=editor.dom,selection=editor.selection,ceRoot=getContentEditableRoot$1(editor.getBody(),selection.getNode());if(isContentEditableTrue$4(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){var br=dom.create("br",{"data-mce-bogus":"1"});dom.setHTML(ceRoot,""),ceRoot.appendChild(br),selection.setRng(CaretPosition.before(br).toRange())}return!0},backspaceDelete$5=function(editor,forward){return editor.selection.isCollapsed()?backspaceDeleteCaret(editor,forward):backspaceDeleteRange(editor,forward)},backspaceDelete$4=function(editor,forward){return!!editor.selection.isCollapsed()&&function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter((function(pos){return forward?isBeforeImageBlock(pos):isAfterImageBlock(pos)})).bind((function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos))})).exists((function(elm){return editor.selection.select(elm),!0}))}(editor,forward)},isText=isText$7,startsWithCaretContainer=function(node){return isText(node)&&"\ufeff"===node.data[0]},endsWithCaretContainer=function(node){return isText(node)&&"\ufeff"===node.data[node.data.length-1]},createZwsp=function(node){return node.ownerDocument.createTextNode("\ufeff")},insertInline=function(before,node){return before?function(node){if(isText(node.previousSibling))return endsWithCaretContainer(node.previousSibling)||node.previousSibling.appendData("\ufeff"),node.previousSibling;if(isText(node))return startsWithCaretContainer(node)||node.insertData(0,"\ufeff"),node;var newNode=createZwsp(node);return node.parentNode.insertBefore(newNode,node),newNode}(node):function(node){if(isText(node.nextSibling))return startsWithCaretContainer(node.nextSibling)||node.nextSibling.insertData(0,"\ufeff"),node.nextSibling;if(isText(node))return endsWithCaretContainer(node)||node.appendData("\ufeff"),node;var newNode=createZwsp(node);return node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode),newNode}(node)},insertInlineBefore=curry(insertInline,!0),insertInlineAfter=curry(insertInline,!1),insertInlinePos=function(pos,before){return isText$7(pos.container())?insertInline(before,pos.container()):insertInline(before,pos.getNode())},isPosCaretContainer=function(pos,caret){var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode)},renderCaret=function(caret,location){return location.fold((function(element){remove$2(caret.get());var text=insertInlineBefore(element);return caret.set(text),Optional.some(CaretPosition(text,text.length-1))}),(function(element){return firstPositionIn(element).map((function(pos){if(isPosCaretContainer(pos,caret))return CaretPosition(caret.get(),1);remove$2(caret.get());var text=insertInlinePos(pos,!0);return caret.set(text),CaretPosition(text,1)}))}),(function(element){return lastPositionIn(element).map((function(pos){if(isPosCaretContainer(pos,caret))return CaretPosition(caret.get(),caret.get().length-1);remove$2(caret.get());var text=insertInlinePos(pos,!1);return caret.set(text),CaretPosition(text,text.length-1)}))}),(function(element){remove$2(caret.get());var text=insertInlineAfter(element);return caret.set(text),Optional.some(CaretPosition(text,1))}))},evaluateUntil=function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome())return result}return Optional.none()},Location=Adt_generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),rescope$1=function(rootNode,node){var parentBlock=getParentBlock$2(node,rootNode);return parentBlock||rootNode},before=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((function(){return nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((function(inline){return Location.before(inline)}))}),Optional.none)},isNotInsideFormatCaretContainer=function(rootNode,elm){return null===getParentCaretContainer(rootNode,elm)},findInsideRootInline=function(isInlineTarget,rootNode,pos){return findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode))},start$1=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((function(inline){return prevPosition(inline,nPos).isNone()?Optional.some(Location.start(inline)):Optional.none()}))},end=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((function(inline){return nextPosition(inline,nPos).isNone()?Optional.some(Location.end(inline)):Optional.none()}))},after=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((function(){return prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((function(inline){return Location.after(inline)}))}),Optional.none)},isValidLocation=function(location){return!1===isRtl(getElement(location))},readLocation=function(isInlineTarget,rootNode,pos){return evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]).filter(isValidLocation)},getElement=function(location){return location.fold(identity,identity,identity,identity)},getName=function(location){return location.fold(constant("before"),constant("start"),constant("end"),constant("after"))},outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after)},inside=function(location){return location.fold(Location.start,Location.start,Location.end,Location.end)},betweenInlines=function(forward,isInlineTarget,rootNode,from,to,location){return lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),(function(fromInline,toInline){return fromInline!==toInline&&function(rootNode,node1,node2){var block1=getParentBlock$2(node1,rootNode),block2=getParentBlock$2(node2,rootNode);return block1&&block1===block2}(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location})).getOr(location)},skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(always,(function(fromLocation){return location2=toLocation,!(getName(location1=fromLocation)===getName(location2)&&getElement(location1)===getElement(location2));var location1,location2}))},findLocationSimple=function(forward,location){return forward?location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none):location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end))},findLocation$1=function(forward,isInlineTarget,rootNode,pos){var from=normalizePosition(forward,pos),fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk((function(){return function(forward,isInlineTarget,rootNode,fromLocation,pos){var from=normalizePosition(forward,pos);return fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward)).fold((function(){return fromLocation.map(outside)}),(function(to){return readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation))})).filter(isValidLocation)}(forward,isInlineTarget,rootNode,fromLocation,pos)}))};curry(findLocation$1,!1),curry(findLocation$1,!0);var BreakType,moveRel=function(forward,selection,pos){var delta=forward?1:-1;return selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange()),selection.getSel().modify("move",forward?"forward":"backward","word"),!0},moveByWord=function(forward,editor){var rng=editor.selection.getRng(),pos=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);return!!function(editor){return isFunction(editor.selection.getSel().modify)}(editor)&&(forward&&isBeforeInline(pos)?moveRel(!0,editor.selection,pos):!(forward||!isAfterInline(pos))&&moveRel(!1,editor.selection,pos))};!function(BreakType){BreakType[BreakType.Br=0]="Br",BreakType[BreakType.Block=1]="Block",BreakType[BreakType.Wrap=2]="Wrap",BreakType[BreakType.Eol=3]="Eol"}(BreakType||(BreakType={}));var VDirection,flip=function(direction,positions){return direction===HDirection.Backwards?reverse(positions):positions},walk=function(direction,caretWalker,pos){return direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos)},getBreakType=function(scope,direction,currentPos,nextPos){return isBr$5(nextPos.getNode(direction===HDirection.Forwards))?BreakType.Br:!1===isInSameBlock(currentPos,nextPos)?BreakType.Block:BreakType.Wrap},getPositionsUntil=function(predicate,direction,scope,start){for(var caretWalker=CaretWalker(scope),currentPos=start,positions=[];currentPos;){var nextPos=walk(direction,caretWalker,currentPos);if(!nextPos)break;if(isBr$5(nextPos.getNode(!1)))return direction===HDirection.Forwards?{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)}:{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};if(nextPos.isVisible()){if(predicate(currentPos,nextPos)){var breakType=getBreakType(0,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType:breakType,breakAt:Optional.some(nextPos)}}positions.push(nextPos),currentPos=nextPos}else currentPos=nextPos}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()}},getAdjacentLinePositions=function(direction,getPositionsUntilBreak,scope,start){return getPositionsUntilBreak(scope,start).breakAt.map((function(pos){var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions)})).getOr([])},findClosestHorizontalPositionFromPoint=function(positions,x){return foldl(positions,(function(acc,newPos){return acc.fold((function(){return Optional.some(newPos)}),(function(lastPos){return lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),(function(lastRect,newRect){var lastDist=Math.abs(x-lastRect.left);return Math.abs(x-newRect.left)<=lastDist?newPos:lastPos})).or(acc)}))}),Optional.none())},findClosestHorizontalPosition=function(positions,pos){return head(pos.getClientRects()).bind((function(targetRect){return findClosestHorizontalPositionFromPoint(positions,targetRect.left)}))},getPositionsUntilPreviousLine=curry(getPositionsUntil,CaretPosition.isAbove,-1),getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1),getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine),getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine),getNodeClientRects=function(node){var toArrayWithNode=function(clientRects){return map$3(clientRects,(function(rect){var clientRect=clone(rect);return clientRect.node=node,clientRect}))};if(isElement$5(node))return toArrayWithNode(node.getClientRects());if(isText$7(node)){var rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())}},getClientRects=function(nodes){return bind(nodes,getNodeClientRects)};!function(VDirection){VDirection[VDirection.Up=-1]="Up",VDirection[VDirection.Down=1]="Down"}(VDirection||(VDirection={}));var customEventRootDelegates,beforeUnloadDelegate,walkUntil$1=function(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition){var line=0,result=[],add=function(node){var clientRects=getClientRects([node]);-1===direction&&(clientRects=clientRects.reverse());for(var i=0;i<clientRects.length;i++){var clientRect=clientRects[i];if(!isBeflowFn(clientRect,targetClientRect)){if(result.length>0&&isAboveFn(clientRect,last$1(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}},targetClientRect=last$1(caretPosition.getClientRects());if(!targetClientRect)return result;var node=caretPosition.getNode();return add(node),function(direction,root,predicateFn,node){for(;node=findNode$1(node,direction,isEditableCaretCandidate$1,root);)if(predicateFn(node))return}(direction,root,add,node),result},upUntil=curry(walkUntil$1,VDirection.Up,isAbove$1,isBelow$1),downUntil=curry(walkUntil$1,VDirection.Down,isBelow$1,isAbove$1),isAboveLine=function(lineNumber){return function(clientRect){return function(lineNumber,clientRect){return clientRect.line>lineNumber}(lineNumber,clientRect)}},isLine=function(lineNumber){return function(clientRect){return function(lineNumber,clientRect){return clientRect.line===lineNumber}(lineNumber,clientRect)}},isContentEditableFalse$3=isContentEditableFalse$b,findNode=findNode$1,distanceToRectLeft=function(clientRect,clientX){return Math.abs(clientRect.left-clientX)},distanceToRectRight=function(clientRect,clientX){return Math.abs(clientRect.right-clientX)},isInsideX=function(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right},isInsideY=function(clientY,clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom},findClosestClientRect=function(clientRects,clientX,allowInside){return void 0===allowInside&&(allowInside=always),reduce(clientRects,(function(oldClientRect,clientRect){if(isInsideX(clientX,clientRect))return allowInside(clientRect)?clientRect:oldClientRect;if(isInsideX(clientX,oldClientRect))return allowInside(oldClientRect)?oldClientRect:clientRect;var oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));return newDistance===oldDistance&&hasNonNullableKey(clientRect,"node")&&isContentEditableFalse$3(clientRect.node)||newDistance<oldDistance?clientRect:oldClientRect}))},walkUntil=function(direction,root,predicateFn,startNode,includeChildren){var node=findNode(startNode,direction,isEditableCaretCandidate$1,root,!includeChildren);do{if(!node||predicateFn(node))return}while(node=findNode(node,direction,isEditableCaretCandidate$1,root))},closestFakeCaret=function(root,clientX,clientY){var fakeTargetNodeRects=getClientRects(function(root){return filter$4(from(root.getElementsByTagName("*")),isFakeCaretTarget)}(root)),targetNodeRects=filter$4(fakeTargetNodeRects,curry(isInsideY,clientY)),checkInside=function(clientRect){return!isTable$3(clientRect.node)&&!isMedia$2(clientRect.node)},closestNodeRect=findClosestClientRect(targetNodeRects,clientX,checkInside);if(closestNodeRect){var includeChildren=checkInside(closestNodeRect);if((closestNodeRect=findClosestClientRect(function(root,targetNodeRect,includeChildren){void 0===includeChildren&&(includeChildren=!0);var clientRects=[],collect=function(checkPosFn,node){var lineRects=filter$4(getClientRects([node]),(function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}));return clientRects=clientRects.concat(lineRects),0===lineRects.length};return clientRects.push(targetNodeRect),walkUntil(VDirection.Up,root,curry(collect,isAbove$1),targetNodeRect.node,includeChildren),walkUntil(VDirection.Down,root,curry(collect,isBelow$1),targetNodeRect.node,includeChildren),clientRects}(root,closestNodeRect,includeChildren),clientX,checkInside))&&isFakeCaretTarget(closestNodeRect.node))return function(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}(closestNodeRect,clientX)}return null},moveToRange=function(editor,rng){editor.selection.setRng(rng),scrollRangeIntoView(editor,editor.selection.getRng())},renderRangeCaretOpt=function(editor,range,scrollIntoView){return Optional.some(renderRangeCaret(editor,range,scrollIntoView))},moveHorizontally=function(editor,direction,range,isBefore,isAfter,isElement){var forwards=direction===HDirection.Forwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev),isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){var node=getSelectedNode(range);if(isElement(node))return showCaret(direction,editor,node,direction===HDirection.Backwards,!1)}var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition))return selectNode(editor,caretPosition.getNode(!forwards));var nextCaretPosition=normalizePosition(forwards,getNextPosFn(caretPosition)),rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition)return rangeIsInContainerBlock?Optional.some(range):Optional.none();if(isBeforeFn(nextCaretPosition))return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,!1);var peekCaretPosition=getNextPosFn(nextCaretPosition);return peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)?showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,!1):rangeIsInContainerBlock?renderRangeCaretOpt(editor,nextCaretPosition.toRange(),!1):Optional.none()},moveVertically=function(editor,direction,range,isBefore,isAfter,isElement){var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),caretClientRect=last$1(caretPosition.getClientRects()),forwards=direction===VDirection.Down;if(!caretClientRect)return Optional.none();var currentNode,linePositions=(forwards?downUntil:upUntil)(editor.getBody(),isAboveLine(1),caretPosition),nextLinePositions=filter$4(linePositions,isLine(1)),clientX=caretClientRect.left,nextLineRect=findClosestClientRect(nextLinePositions,clientX);if(nextLineRect&&isElement(nextLineRect.node)){var dist1=Math.abs(clientX-nextLineRect.left),dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,!1)}if(currentNode=isBefore(caretPosition)?caretPosition.getNode():isAfter(caretPosition)?caretPosition.getNode(!0):getSelectedNode(range)){var caretPositions=function(direction,root,predicateFn,node){var walkFn,isBelowFn,isAboveFn,caretPosition,caretWalker=CaretWalker(root),result=[],line=0,getClientRect=function(caretPosition){return last$1(caretPosition.getClientRects())};1===direction?(walkFn=caretWalker.next,isBelowFn=isBelow$1,isAboveFn=isAbove$1,caretPosition=CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=isAbove$1,isAboveFn=isBelow$1,caretPosition=CaretPosition.before(node));var targetClientRect=getClientRect(caretPosition);do{if(caretPosition.isVisible()){var rect=getClientRect(caretPosition);if(!isAboveFn(rect,targetClientRect)){result.length>0&&isBelowFn(rect,last$1(result))&&line++;var clientRect=clone(rect);if(clientRect.position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}}}while(caretPosition=walkFn(caretPosition));return result}(direction,editor.getBody(),isAboveLine(1),currentNode),closestNextLineRect=findClosestClientRect(filter$4(caretPositions,isLine(1)),clientX);if(closestNextLineRect)return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1);if(closestNextLineRect=last$1(filter$4(caretPositions,isLine(0))))return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1)}return 0===nextLinePositions.length?getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map((function(pos){return renderRangeCaret(editor,pos.toRange(),!1)})):Optional.none()},getLineEndPoint=function(editor,forward){var rng=editor.selection.getRng(),body=editor.getBody();if(forward){var from=CaretPosition.fromRangeEnd(rng),result=getPositionsUntilNextLine(body,from);return last$2(result.positions)}from=CaretPosition.fromRangeStart(rng),result=getPositionsUntilPreviousLine(body,from);return head(result.positions)},moveToLineEndPoint$3=function(editor,forward,isElementPosition){return getLineEndPoint(editor,forward).filter(isElementPosition).exists((function(pos){return editor.selection.setRng(pos.toRange()),!0}))},setCaretPosition=function(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)},setSelected=function(state,elm){state?elm.setAttribute("data-mce-selected","inline-boundary"):elm.removeAttribute("data-mce-selected")},renderCaretLocation=function(editor,caret,location){return renderCaret(caret,location).map((function(pos){return setCaretPosition(editor,pos),location}))},safeRemoveCaretContainer=function(editor,caret){if(editor.selection.isCollapsed()&&!0!==editor.composing&&caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());CaretPosition.isTextPosition(pos)&&!1===function(pos){return isBeforeInline(pos)||isAfterInline(pos)}(pos)&&(setCaretPosition(editor,removeAndReposition(caret.get(),pos)),caret.set(null))}},move$2=function(editor,caret,forward){return!!isInlineBoundariesEnabled(editor)&&function(editor,caret,forward){var rootNode=editor.getBody(),from=CaretPosition.fromRangeStart(editor.selection.getRng()),isInlineTarget$1=curry(isInlineTarget,editor);return findLocation$1(forward,isInlineTarget$1,rootNode,from).bind((function(location){return renderCaretLocation(editor,caret,location)}))}(editor,caret,forward).isSome()},moveWord=function(forward,editor,_caret){return!!isInlineBoundariesEnabled(editor)&&moveByWord(forward,editor)},setupSelectedState=function(editor){var caret=Cell(null),isInlineTarget$1=curry(isInlineTarget,editor);return editor.on("NodeChange",(function(e){!isInlineBoundariesEnabled(editor)||Env.browser.isIE()&&e.initial||(function(isInlineTarget,dom,elms){var inlineBoundaries=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected="inline-boundary"]'),(function(e){return e.dom})),selectedInlines=filter$4(inlineBoundaries,isInlineTarget),targetInlines=filter$4(elms,isInlineTarget);each$k(difference(selectedInlines,targetInlines),curry(setSelected,!1)),each$k(difference(targetInlines,selectedInlines),curry(setSelected,!0))}(isInlineTarget$1,editor.dom,e.parents),safeRemoveCaretContainer(editor,caret),function(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=filter$4(elms,isInlineTarget);each$k(inlines,(function(_inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind((function(location){return renderCaretLocation(editor,caret,location)}))}))}}(isInlineTarget$1,editor,caret,e.parents))})),caret},moveNextWord=curry(moveWord,!0),movePrevWord=curry(moveWord,!1),moveToLineEndPoint$2=function(editor,forward,caret){if(isInlineBoundariesEnabled(editor)){var linePoint=getLineEndPoint(editor,forward).getOrThunk((function(){var rng=editor.selection.getRng();return forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng)}));return readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists((function(loc){var outsideLoc=outside(loc);return renderCaret(caret,outsideLoc).exists((function(pos){return setCaretPosition(editor,pos),!0}))}))}return!1},setCaretLocation=function(editor,caret){return function(location){return renderCaret(caret,location).exists((function(pos){return setCaretPosition(editor,pos),!0}))}},deleteFromTo=function(editor,caret,from,to){var rootNode=editor.getBody(),isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore((function(){editor.selection.setRng(function(from,to){var range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range}(from,to)),editor.execCommand("Delete"),readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor,caret))})),editor.nodeChanged()},backspaceDeleteCollapsed=function(editor,caret,forward,from){var rootNode=function(rootNode,node){return getParentBlock$2(node,rootNode)||rootNode}(editor.getBody(),from.container()),isInlineTarget$1=curry(isInlineTarget,editor),fromLocation=readLocation(isInlineTarget$1,rootNode,from);return fromLocation.bind((function(location){return forward?location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none):location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))))})).map(setCaretLocation(editor,caret)).getOrThunk((function(){var toPosition=navigate(forward,rootNode,from),toLocation=toPosition.bind((function(pos){return readLocation(isInlineTarget$1,rootNode,pos)}));return lift2(fromLocation,toLocation,(function(){return findRootInline(isInlineTarget$1,rootNode,from).exists((function(elm){return!!function(elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),(function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos);return nextPosition(elm,normalizedFirstPos).forall((function(pos){return pos.isEqual(normalizedLastPos)}))})).getOr(!0)}(elm)&&(deleteElement$2(editor,forward,SugarElement.fromDom(elm)),!0)}))})).orThunk((function(){return toLocation.bind((function(_){return toPosition.map((function(to){return forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from),!0}))}))})).getOr(!1)}))},backspaceDelete$3=function(editor,caret,forward){if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from)}return!1},hasOnlyOneChild=function(elm){return 1===childNodesCount(elm)},deleteLastPosition=function(forward,editor,target,parentInlines){var isFormatElement$1=curry(isFormatElement,editor),formatNodes=map$3(filter$4(parentInlines,isFormatElement$1),(function(elm){return elm.dom}));if(0===formatNodes.length)deleteElement$2(editor,forward,target);else{var pos=function(targetNode,formatNodes){var caretContainer=createCaretContainer(!1),innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);return before$4(SugarElement.fromDom(targetNode),caretContainer),remove$7(SugarElement.fromDom(targetNode)),CaretPosition(innerMost,0)}(target.dom,formatNodes);editor.selection.setRng(pos.toRange())}},deleteCaret$1=function(editor,forward){var rootElm=SugarElement.fromDom(editor.getBody()),startElm=SugarElement.fromDom(editor.selection.getStart()),parentInlines=filter$4(function(rootElm,startElm){var parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,isBlock$2).fold(constant(parents),(function(index){return parents.slice(0,index)}))}(rootElm,startElm),hasOnlyOneChild);return last$2(parentInlines).exists((function(target){var element,fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return!(!function(forward,fromPos,elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),(function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos),normalizedFromPos=normalizePosition(!1,fromPos);return forward?nextPosition(elm,normalizedFromPos).exists((function(nextPos){return nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos)})):prevPosition(elm,normalizedFromPos).exists((function(prevPos){return prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos)}))})).getOr(!0)}(forward,fromPos,target.dom)||(element=target,isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom)))&&(deleteLastPosition(forward,editor,target,parentInlines),!0)}))},backspaceDelete$2=function(editor,forward){return!!editor.selection.isCollapsed()&&deleteCaret$1(editor,forward)},deleteElement=function(editor,forward,element){return editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0},backspaceDelete$1=function(editor,forward){return editor.selection.isCollapsed()?function(editor,forward){var isNearMedia=forward?isBeforeMedia:isAfterMedia,direction=forward?HDirection.Forwards:HDirection.Backwards,fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());return isNearMedia(fromPos)?deleteElement(editor,forward,fromPos.getNode(!forward)):Optional.from(normalizePosition(forward,fromPos)).filter((function(pos){return isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos)})).exists((function(pos){return deleteElement(editor,forward,pos.getNode(!forward))}))}(editor,forward):function(editor,forward){var selectedNode=editor.selection.getNode();return!!isMedia$2(selectedNode)&&deleteElement(editor,forward,selectedNode)}(editor,forward)},parseIndentValue=function(value){var number=parseInt(value,10);return isNaN(number)?0:number},getIndentStyleName=function(useMargin,element){return(useMargin||"table"===name(element)?"margin":"padding")+("rtl"===get$5(element,"direction")?"-right":"-left")},canOutdent=function(editor){var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||function(editor,blocks){return forall(blocks,(function(block){var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block),intentValue=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0);return"false"!==editor.dom.getContentEditable(block.dom)&&intentValue>0}))}(editor,blocks))},isListComponent=function(el){return isList(el)||isListItem(el)},getBlocksToIndent=function(editor){return filter$4((nodes=editor.selection.getSelectedBlocks(),map$3(nodes,SugarElement.fromDom)),(function(el){return!isListComponent(el)&&!function(el){return parent(el).exists(isListComponent)}(el)&&closest$3(el,(function(elm){return isContentEditableTrue$4(elm.dom)||isContentEditableFalse$b(elm.dom)})).exists((function(elm){return isContentEditableTrue$4(elm.dom)}))}));var nodes},handle=function(editor,command){var dom=editor.dom,selection=editor.selection,formatter=editor.formatter,indentation=function(editor){return editor.getParam("indentation","40px","string")}(editor),indentUnit=/[a-z%]+$/i.exec(indentation)[0],indentValue=parseInt(indentation,10),useMargin=shouldIndentUseMargin(editor),forcedRootBlock=getForcedRootBlock(editor);editor.queryCommandState("InsertUnorderedList")||editor.queryCommandState("InsertOrderedList")||""!==forcedRootBlock||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each$k(getBlocksToIndent(editor),(function(block){!function(dom,command,useMargin,value,unit,element){var indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element));if("outdent"===command){var styleValue=Math.max(0,parseIndentValue(element.style[indentStyleName])-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:"")}else styleValue=parseIndentValue(element.style[indentStyleName])+value+unit,dom.setStyle(element,indentStyleName,styleValue)}(dom,command,useMargin,indentValue,indentUnit,block.dom)}))},backspaceDelete=function(editor,_forward){if(editor.selection.isCollapsed()&&canOutdent(editor)){var dom=editor.dom,rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),block=dom.getParent(rng.startContainer,dom.isBlock);if(null!==block&&isAtStartOfBlock(SugarElement.fromDom(block),pos))return handle(editor,"outdent"),!0}return!1},nativeCommand=function(editor,command){editor.getDoc().execCommand(command,!1,null)},setup$f=function(editor,caret){editor.addCommand("delete",(function(){!function(editor,caret){backspaceDelete(editor)||backspaceDelete$5(editor,!1)||backspaceDelete$6(editor,!1)||backspaceDelete$3(editor,caret,!1)||backspaceDelete$8(editor,!1)||backspaceDelete$9(editor)||backspaceDelete$4(editor,!1)||backspaceDelete$1(editor,!1)||backspaceDelete$7(editor)||backspaceDelete$2(editor,!1)||(nativeCommand(editor,"Delete"),paddEmptyBody(editor))}(editor,caret)})),editor.addCommand("forwardDelete",(function(){!function(editor,caret){backspaceDelete$5(editor,!0)||backspaceDelete$6(editor,!0)||backspaceDelete$3(editor,caret,!0)||backspaceDelete$8(editor,!0)||backspaceDelete$9(editor)||backspaceDelete$4(editor,!0)||backspaceDelete$1(editor,!0)||backspaceDelete$7(editor)||backspaceDelete$2(editor,!0)||nativeCommand(editor,"ForwardDelete")}(editor,caret)}))},getTouch=function(event){return void 0===event.touches||1!==event.touches.length?Optional.none():Optional.some(event.touches[0])},setup$e=function(editor){var startData=value(),longpressFired=Cell(!1),debounceLongpress=last((function(e){editor.fire("longpress",__assign(__assign({},e),{type:"longpress"})),longpressFired.set(!0)}),400);editor.on("touchstart",(function(e){getTouch(e).each((function(touch){debounceLongpress.cancel();var data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e),longpressFired.set(!1),startData.set(data)}))}),!0),editor.on("touchmove",(function(e){debounceLongpress.cancel(),getTouch(e).each((function(touch){startData.on((function(data){(function(touch,data){var distX=Math.abs(touch.clientX-data.x),distY=Math.abs(touch.clientY-data.y);return distX>5||distY>5})(touch,data)&&(startData.clear(),longpressFired.set(!1),editor.fire("longpresscancel"))}))}))}),!0),editor.on("touchend touchcancel",(function(e){debounceLongpress.cancel(),"touchcancel"!==e.type&&startData.get().filter((function(data){return data.target.isEqualNode(e.target)})).each((function(){longpressFired.get()?e.preventDefault():editor.fire("tap",__assign(__assign({},e),{type:"tap"}))}))}),!0)},isBlockElement=function(blockElements,node){return has$2(blockElements,node.nodeName)},isValidTarget=function(blockElements,node){return!!isText$7(node)||!!isElement$5(node)&&(!isBlockElement(blockElements,node)&&!isBookmarkNode$1(node))},shouldRemoveTextNode=function(blockElements,node){if(isText$7(node)){if(0===node.nodeValue.length)return!0;if(/^\s+$/.test(node.nodeValue)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling)))return!0}return!1},addRootBlocks=function(editor){var rootBlockNode,tempNode,wrapped,dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements(),node=selection.getStart(),rootNode=editor.getBody(),forcedRootBlock=getForcedRootBlock(editor);if(node&&isElement$5(node)&&forcedRootBlock){var rootNodeName=rootNode.nodeName.toLowerCase();if(schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())&&!function(blockElements,root,node){return exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),(function(elm){return isBlockElement(blockElements,elm.dom)}))}(blockElements,rootNode,node)){var rng=selection.getRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,restoreSelection=hasFocus(editor);for(node=rootNode.firstChild;node;)if(isValidTarget(blockElements,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node,node=node.nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,getForcedRootBlockAttrs(editor)),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),tempNode=node,node=node.nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;wrapped&&restoreSelection&&(rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng),editor.nodeChanged())}}},showBlockCaretContainer=function(editor,blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.selection.scrollIntoView(blockCaretContainer))},handleBlockContainer=function(editor,e){var blockCaretContainer=function(editor){return descendant(SugarElement.fromDom(editor.getBody()),"*[data-mce-caret]").map((function(elm){return elm.dom})).getOrNull()}(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(editor,blockCaretContainer)):void(hasContent(blockCaretContainer)&&(showBlockCaretContainer(editor,blockCaretContainer),editor.undoManager.add()))},isContentEditableFalse$2=isContentEditableFalse$b,exitPreBlock=function(editor,direction,range){var caretWalker=CaretWalker(editor.getBody()),getVisualCaretPosition$1=curry(getVisualCaretPosition,1===direction?caretWalker.next:caretWalker.prev);if(range.collapsed&&function(editor){return""!==getForcedRootBlock(editor)}(editor)){var pre=editor.dom.getParent(range.startContainer,"PRE");if(!pre)return;if(!getVisualCaretPosition$1(CaretPosition.fromRangeStart(range))){var newBlock=function(editor){var textBlock=editor.dom.create(getForcedRootBlock(editor));return(!Env.ie||Env.ie>=11)&&(textBlock.innerHTML='<br data-mce-bogus="1">'),textBlock}(editor);1===direction?editor.$(pre).after(newBlock):editor.$(pre).before(newBlock),editor.selection.select(newBlock,!0),editor.selection.collapse()}}},getHorizontalRange=function(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return function(direction,editor,range){return moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$2)}(direction,editor,range).orThunk((function(){return exitPreBlock(editor,direction,range),Optional.none()}))},getVerticalRange=function(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return function(direction,editor,range){return moveVertically(editor,direction,range,(function(caretPosition){return isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition)}),(function(caretPosition){return isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition)}),isContentEditableFalse$2)}(direction,editor,range).orThunk((function(){return exitPreBlock(editor,direction,range),Optional.none()}))},moveH$2=function(editor,forward){return getHorizontalRange(editor,forward).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveV$3=function(editor,down){return getVerticalRange(editor,down).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveToLineEndPoint$1=function(editor,forward){return moveToLineEndPoint$3(editor,forward,forward?isAfterContentEditableFalse:isBeforeContentEditableFalse)},isTarget=function(node){return contains$3(["figcaption"],name(node))},rangeBefore=function(target){var rng=document.createRange();return rng.setStartBefore(target.dom),rng.setEndBefore(target.dom),rng},insertElement=function(root,elm,forward){forward?append$1(root,elm):prepend(root,elm)},insertEmptyLine=function(root,rootBlockName,attrs,forward){return""===rootBlockName?function(root,forward){var br=SugarElement.fromTag("br");return insertElement(root,br,forward),rangeBefore(br)}(root,forward):function(root,forward,blockName,attrs){var block=SugarElement.fromTag(blockName),br=SugarElement.fromTag("br");return setAll$1(block,attrs),append$1(block,br),insertElement(root,block,forward),rangeBefore(br)}(root,forward,rootBlockName,attrs)},isAtFirstOrLastLine=function(root,forward,pos){return forward?function(scope,pos){return getPositionsUntilNextLine(scope,pos).breakAt.isNone()}(root.dom,pos):function(scope,pos){return getPositionsUntilPreviousLine(scope,pos).breakAt.isNone()}(root.dom,pos)},moveCaretToNewEmptyLine=function(editor,forward){var root=SugarElement.fromDom(editor.getBody()),pos=CaretPosition.fromRangeStart(editor.selection.getRng()),rootBlock=getForcedRootBlock(editor),rootBlockAttrs=getForcedRootBlockAttrs(editor);return function(pos,root){var isRoot=curry(eq,root);return closest$3(SugarElement.fromDom(pos.container()),isBlock$2,isRoot).filter(isTarget)}(pos,root).exists((function(){if(isAtFirstOrLastLine(root,forward,pos)){var rng=insertEmptyLine(root,rootBlock,rootBlockAttrs,forward);return editor.selection.setRng(rng),!0}return!1}))},moveV$2=function(editor,forward){return!!editor.selection.isCollapsed()&&moveCaretToNewEmptyLine(editor,forward)},match$1=function(patterns,evt){return bind(function(patterns){return map$3(patterns,(function(pattern){return __assign({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:noop},pattern)}))}(patterns),(function(pattern){return function(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey}(pattern,evt)?[pattern]:[]}))},action=function(f){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];return function(){return f.apply(null,x)}},execute=function(patterns,evt){return find$3(match$1(patterns,evt),(function(pattern){return pattern.action()}))},moveH$1=function(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveV$1=function(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveToLineEndPoint=function(editor,forward){return moveToLineEndPoint$3(editor,forward,forward?isAfterMedia:isBeforeMedia)},getClosestCell=function(getYAxisValue,isTargetCorner,table,x,y){var cells=descendants(SugarElement.fromDom(table),"td,th,caption").map((function(e){return e.dom}));return function(corners,x,y){return foldl(corners,(function(acc,newCorner){return acc.fold((function(){return Optional.some(newCorner)}),(function(oldCorner){var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y)),newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner)}))}),Optional.none())}(filter$4(function(getYAxisValue,tds){return bind(tds,(function(td){var rect=function(rect,delta){return{left:rect.left-delta,top:rect.top-delta,right:rect.right+2*delta,bottom:rect.bottom+2*delta,width:rect.width+delta,height:rect.height+delta}}(clone(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}]}))}(getYAxisValue,cells),(function(corner){return isTargetCorner(corner,y)})),x,y).map((function(corner){return corner.cell}))},getClosestCellAbove=curry(getClosestCell,(function(rect){return rect.bottom}),(function(corner,y){return corner.y<y})),getClosestCellBelow=curry(getClosestCell,(function(rect){return rect.top}),(function(corner,y){return corner.y>y})),findClosestPositionInAboveCell=function(table,pos){return head(pos.getClientRects()).bind((function(rect){return getClosestCellAbove(table,rect.left,rect.top)})).bind((function(cell){return findClosestHorizontalPosition(lastPositionIn(scope=cell).map((function(pos){return getPositionsUntilPreviousLine(scope,pos).positions.concat(pos)})).getOr([]),pos);var scope}))},findClosestPositionInBelowCell=function(table,pos){return last$2(pos.getClientRects()).bind((function(rect){return getClosestCellBelow(table,rect.left,rect.top)})).bind((function(cell){return findClosestHorizontalPosition(firstPositionIn(scope=cell).map((function(pos){return[pos].concat(getPositionsUntilNextLine(scope,pos).positions)})).getOr([]),pos);var scope}))},isAtTableCellLine=function(getPositionsUntil,scope,pos){var lineInfo=getPositionsUntil(scope,pos);return function(lineInfo){return lineInfo.breakType===BreakType.Wrap&&0===lineInfo.positions.length}(lineInfo)||!isBr$5(pos.getNode())&&function(lineInfo){return lineInfo.breakType===BreakType.Br&&1===lineInfo.positions.length}(lineInfo)?!function(getPositionsUntil,scope,lineInfo){return lineInfo.breakAt.exists((function(breakPos){return getPositionsUntil(scope,breakPos).breakAt.isSome()}))}(getPositionsUntil,scope,lineInfo):lineInfo.breakAt.isNone()},isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine),isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine),navigateHorizontally=function(editor,forward,table,_td){var rng=editor.selection.getRng(),direction=forward?1:-1;return!(!isFakeCaretTableBrowser()||!function(forward,rng,table){var caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists((function(pos){return pos.isEqual(caretPos)}))}(forward,rng,table))&&(showCaret(direction,editor,table,!forward,!1).each((function(newRng){moveToRange(editor,newRng)})),!0)},getTable=function(previous,pos){var node=pos.getNode(previous);return isElement$5(node)&&"TABLE"===node.nodeName?Optional.some(node):Optional.none()},moveCaret=function(editor,down,pos){var table=getTable(!!down,pos),last=!1===down;table.fold((function(){return moveToRange(editor,pos.toRange())}),(function(table){return positionIn(last,editor.getBody()).filter((function(lastPos){return lastPos.isEqual(pos)})).fold((function(){return moveToRange(editor,pos.toRange())}),(function(_){return function(down,editor,table,pos){var forcedRootBlock=getForcedRootBlock(editor);forcedRootBlock?editor.undoManager.transact((function(){var element=SugarElement.fromTag(forcedRootBlock);setAll$1(element,getForcedRootBlockAttrs(editor)),append$1(element,SugarElement.fromTag("br")),down?after$3(SugarElement.fromDom(table),element):before$4(SugarElement.fromDom(table),element);var rng=editor.dom.createRng();rng.setStart(element.dom,0),rng.setEnd(element.dom,0),moveToRange(editor,rng)})):moveToRange(editor,pos.toRange())}(down,editor,table,pos)}))}))},navigateVertically=function(editor,down,table,td){var rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){var newPos=function(root,table,start){return findClosestPositionInAboveCell(table,start).orThunk((function(){return head(start.getClientRects()).bind((function(rect){return findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left)}))})).getOr(CaretPosition.before(table))}(root,table,pos);return moveCaret(editor,down,newPos),!0}if(down&&isAtLastTableCellLine(td,pos)){newPos=function(root,table,start){return findClosestPositionInBelowCell(table,start).orThunk((function(){return head(start.getClientRects()).bind((function(rect){return findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left)}))})).getOr(CaretPosition.after(table))}(root,table,pos);return moveCaret(editor,down,newPos),!0}return!1},move$1=function(editor,forward,mover){return Optional.from(editor.dom.getParent(editor.selection.getNode(),"td,th")).bind((function(td){return Optional.from(editor.dom.getParent(td,"table")).map((function(table){return mover(editor,forward,table,td)}))})).getOr(!1)},moveH=function(editor,forward){return move$1(editor,forward,navigateHorizontally)},moveV=function(editor,forward){return move$1(editor,forward,navigateVertically)},setup$b=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){var os=detect().os;execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$2,editor,!1)},{keyCode:VK.UP,action:action(moveV$3,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$3,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH,editor,!0)},{keyCode:VK.LEFT,action:action(moveH,editor,!1)},{keyCode:VK.UP,action:action(moveV,editor,!1)},{keyCode:VK.DOWN,action:action(moveV,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$1,editor,!1)},{keyCode:VK.UP,action:action(moveV$1,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$1,editor,!0)},{keyCode:VK.RIGHT,action:action(move$2,editor,caret,!0)},{keyCode:VK.LEFT,action:action(move$2,editor,caret,!1)},{keyCode:VK.RIGHT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$2,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$2,editor,!0)}],evt).each((function(_){evt.preventDefault()}))}(editor,caret,evt)}))},setup$a=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){execute([{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,!1)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,caret,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$1,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,!0)}],evt).each((function(_){evt.preventDefault()}))}(editor,caret,evt)})),editor.on("keyup",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,evt){execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)}],evt)}(editor,evt)}))},moveToCaretPosition=function(editor,root){var node,lastNode=root,dom=editor.dom,moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(root){if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=function(node){for(;node;){if(1===node.nodeType||3===node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}}(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode("Â "),root.firstChild)}var rng=dom.createRng();if(root.normalize(),root.hasChildNodes()){for(var walker=new DomTreeWalker(root,root);node=walker.current();){if(isText$7(node)){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else isBr$5(root)?root.nextSibling&&dom.isBlock(root.nextSibling)?(rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)}},getParentBlock=function(editor){return Optional.from(editor.dom.getParent(editor.selection.getStart(!0),editor.dom.isBlock))},hasParent=function(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName},isListBlock=function(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName)},getContainerBlock=function(containerBlock){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock},isFirstOrLastLi=function(containerBlock,parentBlock,first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&!isElement$5(node);)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock},insert$3=function(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var dom=editor.dom,rng=editor.selection.getRng();if(containerBlock!==editor.getBody()){var elm;isListBlock(elm=containerBlock)&&isListBlock(elm.parentNode)&&(newBlockName="LI");var newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR");if(isFirstOrLastLi(containerBlock,parentBlock,!0)&&isFirstOrLastLi(containerBlock,parentBlock,!1))if(hasParent(containerBlock,"LI")){var containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent),!function(elm){var _a;return(null===(_a=elm.parentNode)||void 0===_a?void 0:_a.firstChild)===elm}(containerBlock)?dom.remove(containerBlock):dom.remove(containerBlockParent)}else dom.replace(newBlock,containerBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!0))hasParent(containerBlock,"LI")?(dom.insertAfter(newBlock,getContainerBlock(containerBlock)),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(newBlock,containerBlock),dom.remove(parentBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!1))dom.insertAfter(newBlock,getContainerBlock(containerBlock)),dom.remove(parentBlock);else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();"LI"===newBlockName&&function(elm,name){return elm.firstChild&&elm.firstChild.nodeName===name}(fragment,"LI")?(newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock)):(dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock)),dom.remove(parentBlock)}moveToCaretPosition(editor,newBlock)}},isEmptyAnchor=function(dom,elm){return elm&&"A"===elm.nodeName&&dom.isEmpty(elm)},emptyBlock=function(elm){elm.innerHTML='<br data-mce-bogus="1">'},containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName},canSplitBlock=function(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)},normalizeZwspOffset=function(start,container,offset){return!1===isText$7(container)?offset:start?1===offset&&"\ufeff"===container.data.charAt(offset-1)?0:offset:offset===container.data.length-1&&"\ufeff"===container.data.charAt(offset)?container.data.length:offset},getEditableRoot=function(dom,node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root},setForcedBlockAttrs=function(editor,node){var forcedRootBlockName=getForcedRootBlock(editor);forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()&&function(editor,node,forcedRootBlockAttrs){var dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each((function(attrStyles){var currentStyles=getAllRaw(SugarElement.fromDom(node)),newStyles=__assign(__assign({},currentStyles),attrStyles);dom.setStyles(node,newStyles)}));var attrClassesOpt=Optional.from(forcedRootBlockAttrs.class).map((function(attrClasses){return attrClasses.split(/\s+/)})),currentClassesOpt=Optional.from(node.className).map((function(currentClasses){return filter$4(currentClasses.split(/\s+/),(function(clazz){return""!==clazz}))}));lift2(attrClassesOpt,currentClassesOpt,(function(attrClasses,currentClasses){var filteredClasses=filter$4(currentClasses,(function(clazz){return!contains$3(attrClasses,clazz)})),newClasses=__spreadArray(__spreadArray([],attrClasses,!0),filteredClasses,!0);dom.setAttrib(node,"class",newClasses.join(" "))}));var appliedAttrs=["style","class"],remainingAttrs=filter$3(forcedRootBlockAttrs,(function(_,attrs){return!contains$3(appliedAttrs,attrs)}));dom.setAttribs(node,remainingAttrs)}(editor,node,getForcedRootBlockAttrs(editor))},insert$2=function(editor,evt){var tmpRng,container,offset,parentBlock,newBlock,fragment,containerBlock,parentBlockName,newBlockName,isAfterLastNodeInContainer,dom=editor.dom,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),rng=editor.selection.getRng(),createNewBlock=function(name){var block,clonedNode,caretNode,node=container,textInlineElements=schema.getTextInlineElements();if(caretNode=block=name||"TABLE"===parentBlockName||"HR"===parentBlockName?dom.create(name||newBlockName):parentBlock.cloneNode(!1),!1===function(editor){return editor.getParam("keep_styles",!0)}(editor))dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);else do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node))continue;clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?(clonedNode.appendChild(block.firstChild),block.appendChild(clonedNode)):(caretNode=clonedNode,block.appendChild(clonedNode))}}while((node=node.parentNode)&&node!==editableRoot);return setForcedBlockAttrs(editor,block),emptyBlock(caretNode),block},isCaretAtStartOrEndOfBlock=function(start){var node,name,normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$7(container)&&(start?normalizedOffset>0:normalizedOffset<container.nodeValue.length))return!1;if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&isElement$5(container)&&container===parentBlock.firstChild)return!0;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;var walker=new DomTreeWalker(container,parentBlock);for(isText$7(container)&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!==container.nodeValue.length||walker.next());node=walker.current();){if(isElement$5(node)){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return!1}else if(isText$7(node)&&!isWhitespaceText(node.nodeValue))return!1;start?walker.prev():walker.next()}return!0},insertNewBlockAfter=function(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!==containerBlockName?createNewBlock(newBlockName):createNewBlock(),function(editor){return editor.getParam("end_container_on_empty_block",!1)}(editor)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(editor,newBlock)};normalize$2(dom,rng).each((function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)})),container=rng.startContainer,offset=rng.startOffset,newBlockName=getForcedRootBlock(editor);var shiftKey=!(!evt||!evt.shiftKey),ctrlKey=!(!evt||!evt.ctrlKey);isElement$5(container)&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&isText$7(container)?container.nodeValue.length:0);var editableRoot=getEditableRoot(dom,container);if(editableRoot){(newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=function(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P",dom=editor.dom,editableRoot=getEditableRoot(dom,container);if(!(parentBlock=dom.getParent(container,dom.isBlock))||!canSplitBlock(dom,parentBlock)){if(rootBlockName=(parentBlock=parentBlock||editableRoot)===editor.getBody()||function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}(parentBlock)?parentBlock.nodeName.toLowerCase():parentBlock.parentNode.nodeName.toLowerCase(),!parentBlock.hasChildNodes())return newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!==parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)startNode=node,node=node.previousSibling;if(startNode&&editor.schema.isValidChild(rootBlockName,blockName.toLowerCase())){for(newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container}(editor,newBlockName,rng,container,offset)),parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"";"LI"!==containerBlockName||ctrlKey||(parentBlock=containerBlock,containerBlock=containerBlock.parentNode,parentBlockName=containerBlockName),/^(LI|DT|DD)$/.test(parentBlockName)&&dom.isEmpty(parentBlock)?insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName):newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",isCaretContainerBlock$1(parentBlock)?(newBlock=showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock)):isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),moveToCaretPosition(editor,containerAndSiblingName(parentBlock,"HR")?newBlock:parentBlock)):((tmpRng=function(rng){var newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng}(rng).cloneRange()).setEndAfter(parentBlock),function(fragment){each$k(descendants$1(SugarElement.fromDom(fragment),isText$8),(function(text){var rawNode=text.dom;rawNode.nodeValue=trim$2(rawNode.nodeValue)}))}(fragment=tmpRng.extractContents()),function(node){do{isText$7(node)&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild}while(node)}(fragment),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),function(dom,nonEmptyElementsMap,block){var i,node=block,firstChilds=[];if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;isElement$5(node)&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]&&firstChilds.push(node)}for(i=firstChilds.length;i--;)(!(node=firstChilds[i]).hasChildNodes()||node.firstChild===node.lastChild&&""===node.firstChild.nodeValue||isEmptyAnchor(dom,node))&&dom.remove(node)}}(dom,nonEmptyElementsMap,newBlock),function(dom,block){block.normalize();var lastChild=block.lastChild;lastChild&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br")}(dom,parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):(setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock))),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock:newBlock}))}},moveSelectionToBr=function(editor,brElm,extraBr){var rng=editor.dom.createRng();extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)},insertBrAtCaret=function(editor,evt){var brElm,extraBr,selection=editor.selection,dom=editor.dom,rng=selection.getRng();normalize$2(dom,rng).each((function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)}));var offset=rng.startOffset,container=rng.startContainer;if(1===container.nodeType&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3===container.nodeType?container.nodeValue.length:0}var parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=!(!evt||!evt.ctrlKey);"LI"!==containerBlockName||isControlKey||(parentBlock=containerBlock),container&&3===container.nodeType&&offset>=container.nodeValue.length&&(function(schema,container,parentBlock){for(var node,walker=new DomTreeWalker(container,parentBlock),nonEmptyElementsMap=schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0)return!0}(editor.schema,container,parentBlock)||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rangeInsertNode(dom,rng,brElm),moveSelectionToBr(editor,brElm,extraBr),editor.undoManager.add()},insertBrBefore=function(editor,inline){var br=SugarElement.fromTag("br");before$4(SugarElement.fromDom(inline),br),editor.undoManager.add()},insertBrAfter=function(editor,inline){hasBrAfter(editor.getBody(),inline)||after$3(SugarElement.fromDom(inline),SugarElement.fromTag("br"));var br=SugarElement.fromTag("br");after$3(SugarElement.fromDom(inline),br),moveSelectionToBr(editor,br.dom,!1),editor.undoManager.add()},hasBrAfter=function(rootNode,startNode){return pos=CaretPosition.after(startNode),!!isBr$5(pos.getNode())||nextPosition(rootNode,CaretPosition.after(startNode)).map((function(pos){return isBr$5(pos.getNode())})).getOr(!1);var pos},isAnchorLink=function(elm){return elm&&"A"===elm.nodeName&&"href"in elm},isInsideAnchor=function(location){return location.fold(never,isAnchorLink,isAnchorLink,never)},insertBrOutsideAnchor=function(editor,location){location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop)},insert$1=function(editor,evt){var anchorLocation=function(editor){var isInlineTarget$1=curry(isInlineTarget,editor),position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor)}(editor);anchorLocation.isSome()?anchorLocation.each(curry(insertBrOutsideAnchor,editor)):insertBrAtCaret(editor,evt)},matchesSelector=function(editor,selector){return getParentBlock(editor).filter((function(parentBlock){return selector.length>0&&is$2(SugarElement.fromDom(parentBlock),selector)})).isSome()},newLineAction=Adt_generate([{br:[]},{block:[]},{none:[]}]),shouldBlockNewLine=function(editor,_shiftKey){return function(editor){return matchesSelector(editor,function(editor){return editor.getParam("no_newline_selector","")}(editor))}(editor)},isBrMode=function(requiredState){return function(editor,_shiftKey){return""===getForcedRootBlock(editor)===requiredState}},inListBlock=function(requiredState){return function(editor,_shiftKey){return function(editor){return getParentBlock(editor).filter((function(elm){return isListItem(SugarElement.fromDom(elm))})).isSome()}(editor)===requiredState}},inBlock=function(blockName,requiredState){return function(editor,_shiftKey){return function(editor){return getParentBlock(editor).fold(constant(""),(function(parentBlock){return parentBlock.nodeName.toUpperCase()}))}(editor)===blockName.toUpperCase()===requiredState}},inPreBlock=function(requiredState){return inBlock("pre",requiredState)},shouldPutBrInPre=function(requiredState){return function(editor,_shiftKey){return function(editor){return editor.getParam("br_in_pre",!0)}(editor)===requiredState}},inBrContext=function(editor,_shiftKey){return function(editor){return matchesSelector(editor,function(editor){return editor.getParam("br_newline_selector",".mce-toc h2,figcaption,caption")}(editor))}(editor)},hasShiftKey=function(_editor,shiftKey){return shiftKey},canInsertIntoEditableRoot=function(editor){var forcedRootBlock=getForcedRootBlock(editor),rootEditable=function(dom,node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root}(editor.dom,editor.selection.getStart());return rootEditable&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock||"P")},match=function(predicates,action){return function(editor,shiftKey){return foldl(predicates,(function(res,p){return res&&p(editor,shiftKey)}),!0)?Optional.some(action):Optional.none()}},insert=function(editor,evt){(function(editor,evt){return evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inBlock("summary",!0)],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1),hasShiftKey],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1)],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0),hasShiftKey],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0)],newLineAction.br()),match([inListBlock(!0),hasShiftKey],newLineAction.br()),match([inListBlock(!0)],newLineAction.block()),match([isBrMode(!0),hasShiftKey,canInsertIntoEditableRoot],newLineAction.block()),match([isBrMode(!0)],newLineAction.br()),match([inBrContext],newLineAction.br()),match([isBrMode(!1),hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block())],[editor,!(!evt||!evt.shiftKey)]).getOr(newLineAction.none())})(editor,evt).fold((function(){insert$1(editor,evt)}),(function(){insert$2(editor,evt)}),noop)},setup$9=function(editor){editor.on("keydown",(function(event){event.keyCode===VK.ENTER&&function(editor,event){var undoManager;event.isDefaultPrevented()||(event.preventDefault(),(undoManager=editor.undoManager).typing&&(undoManager.typing=!1,undoManager.add()),editor.undoManager.transact((function(){!1===editor.selection.isCollapsed()&&editor.execCommand("Delete"),insert(editor,event)})))}(editor,event)}))},setup$8=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,!0,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,!1,caret)}],evt).each((function(_){evt.preventDefault()}))}(editor,caret,evt)}))},browser=detect().browser,setup$7=function(editor){!function(editor){var keypressThrotter=first((function(){editor.composing||normalizeNbspsInEditor(editor)}),0);browser.isIE()&&(editor.on("keypress",(function(_e){keypressThrotter.throttle()})),editor.on("remove",(function(_e){keypressThrotter.cancel()})))}(editor),editor.on("input",(function(e){!1===e.isComposing&&normalizeNbspsInEditor(editor)}))},platform=detect(),stopImmediatePropagation=function(e){return e.stopImmediatePropagation()},isPageUpDown=function(evt){return evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN},setNodeChangeBlocker=function(blocked,editor,block){block&&!blocked.get()?editor.on("NodeChange",stopImmediatePropagation,!0):!block&&blocked.get()&&editor.off("NodeChange",stopImmediatePropagation),blocked.set(block)},setup$6=function(editor,caret){if(!platform.os.isOSX()){var blocked=Cell(!1);editor.on("keydown",(function(evt){isPageUpDown(evt)&&setNodeChangeBlocker(blocked,editor,!0)})),editor.on("keyup",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,!1,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,!0,caret)}],evt)}(editor,caret,evt),isPageUpDown(evt)&&blocked.get()&&(setNodeChangeBlocker(blocked,editor,!1),editor.nodeChanged())}))}},insertTextAtPosition=function(text,pos){var container=pos.container(),offset=pos.offset();return isText$7(container)?(container.insertData(offset,text),Optional.some(CaretPosition(container,offset+text.length))):getElementFromPosition(pos).map((function(elm){var textNode=SugarElement.fromText(text);return pos.isAtEnd()?after$3(elm,textNode):before$4(elm,textNode),CaretPosition(textNode.dom,text.length)}))},insertNbspAtPosition=curry(insertTextAtPosition,"Â "),insertSpaceAtPosition=curry(insertTextAtPosition," "),insertInlineBoundarySpaceOrNbsp=function(root,pos){return function(checkPos){return function(root,pos){return!isInPre(pos)&&(isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos))}(root,checkPos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos)}},insertSpaceOrNbspAtSelection=function(editor){var pos=CaretPosition.fromRangeStart(editor.selection.getRng()),root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){var isInlineTarget$1=curry(isInlineTarget,editor),caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(function(root){return function(location){return location.fold((function(element){return prevPosition(root.dom,CaretPosition.before(element))}),(function(element){return firstPositionIn(element)}),(function(element){return lastPositionIn(element)}),(function(element){return nextPosition(root.dom,CaretPosition.after(element))}))}}(root)).bind(insertInlineBoundarySpaceOrNbsp(root,pos)).exists(function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),editor.nodeChanged(),!0}}(editor))}return!1},setup$5=function(editor){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,evt){execute([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)}],evt).each((function(_){evt.preventDefault()}))}(editor,evt)}))},registerKeyboardOverrides=function(editor){var caret=setupSelectedState(editor);return function(editor){editor.on("keyup compositionstart",curry(handleBlockContainer,editor))}(editor),setup$b(editor,caret),setup$a(editor,caret),setup$9(editor),setup$5(editor),setup$7(editor),setup$8(editor,caret),setup$6(editor,caret),caret},NodeChange=function(){function NodeChange(editor){var lastRng;this.lastPath=[],this.editor=editor;var self=this;"onselectionchange"in editor.getDoc()||editor.on("NodeChange click mouseup keyup focus",(function(e){var nativeRng=editor.selection.getRng(),fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};"nodechange"!==e.type&&isEq$4(fakeRng,lastRng)||editor.fire("SelectionChange"),lastRng=fakeRng})),editor.on("contextmenu",(function(){editor.fire("SelectionChange")})),editor.on("SelectionChange",(function(){var startElm=editor.selection.getStart(!0);!startElm||!Env.range&&editor.selection.isCollapsed()||hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})})),editor.on("mouseup",(function(e){!e.isDefaultPrevented()&&hasAnyRanges(editor)&&("IMG"===editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,(function(){editor.nodeChanged()})):editor.nodeChanged())}))}return NodeChange.prototype.nodeChanged=function(args){var node,parents,root,selection=this.editor.selection;this.editor.initialized&&selection&&!this.editor.getParam("disable_nodechange")&&!this.editor.mode.isReadOnly()&&(root=this.editor.getBody(),(node=selection.getStart(!0)||root).ownerDocument===this.editor.getDoc()&&this.editor.dom.isChildOf(node,root)||(node=root),parents=[],this.editor.dom.getParent(node,(function(node){if(node===root)return!0;parents.push(node)})),(args=args||{}).element=node,args.parents=parents,this.editor.fire("NodeChange",args))},NodeChange.prototype.isSameElementPath=function(startElm){var i,currentPath=this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0&&currentPath[i]===this.lastPath[i];i--);if(-1===i)return this.lastPath=currentPath,!0}return this.lastPath=currentPath,!1},NodeChange}(),setup$3=function(editor){!function(editor){editor.on("click",(function(e){editor.dom.getParent(e.target,"details")&&e.preventDefault()}))}(editor),function(editor){editor.parser.addNodeFilter("details",(function(elms){each$k(elms,(function(details){details.attr("data-mce-open",details.attr("open")),details.attr("open","open")}))})),editor.serializer.addNodeFilter("details",(function(elms){each$k(elms,(function(details){var open=details.attr("data-mce-open");details.attr("open",isString$1(open)?open:null),details.attr("data-mce-open",null)}))}))}(editor)},isTextBlockNode=function(node){return isElement$5(node)&&isTextBlock$2(SugarElement.fromDom(node))},setup$2=function(editor){editor.on("click",(function(e){e.detail>=3&&function(editor){var rng=editor.selection.getRng(),startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng);if(CaretPosition.isElementPosition(startPos)){var container=startPos.container();isTextBlockNode(container)&&firstPositionIn(container).each((function(pos){return rng.setStart(pos.container(),pos.offset())}))}CaretPosition.isElementPosition(endPos)&&(container=startPos.container(),isTextBlockNode(container)&&lastPositionIn(container).each((function(pos){return rng.setEnd(pos.container(),pos.offset())})));editor.selection.setRng(normalize(rng))}(editor)}))},getAbsolutePosition=function(elm){var clientRect=elm.getBoundingClientRect(),doc=elm.ownerDocument,docElem=doc.documentElement,win=doc.defaultView;return{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft}},calc=function(editor,event){return bodyPosition=function(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0}}(editor),scrollPosition=function(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}}(editor),{pageX:(mousePosition=function(editor,event){if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),scrollPosition=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll}(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top}}return{left:event.pageX,top:event.pageY}}(editor,event)).left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top};var bodyPosition,scrollPosition,mousePosition},isContentEditableFalse$1=isContentEditableFalse$b,isContentEditableTrue$1=isContentEditableTrue$4,createGhost=function(editor,elm,width,height){var dom=editor.dom,clonedElm=elm.cloneNode(!0);dom.setStyles(clonedElm,{width:width,height:height}),dom.setAttrib(clonedElm,"data-mce-selected",null);var ghostElm=dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return dom.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:width,height:height}),dom.setStyles(clonedElm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(clonedElm),ghostElm},removeElement=function(elm){elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},start=function(state,editor){return function(e){if(function(e){return 0===e.button}(e)){var ceElm=find$3(editor.dom.getParents(e.target),function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}}(isContentEditableFalse$1,isContentEditableTrue$1)).getOr(null);if(rootElm=editor.getBody(),isContentEditableFalse$1(elm=ceElm)&&elm!==rootElm){var elmPos=editor.dom.getPos(ceElm),bodyElm=editor.getBody(),docElm=editor.getDoc().documentElement;state.set({element:ceElm,dragging:!1,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight)})}}var rootElm,elm}},drop=function(state,editor){return function(e){state.on((function(state){if(state.dragging){if(function(editor,targetElement,dragElement){return targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&!isContentEditableFalse$1(targetElement)}(editor,(selection=editor.selection,3===(startContainer=selection.getSel().getRangeAt(0).startContainer).nodeType?startContainer.parentNode:startContainer),state.element)){var targetClone_1=(elm=state.element,(cloneElm=elm.cloneNode(!0)).removeAttribute("data-mce-selected"),cloneElm);editor.fire("drop",{clientX:e.clientX,clientY:e.clientY}).isDefaultPrevented()||editor.undoManager.transact((function(){removeElement(state.element),editor.insertContent(editor.dom.getOuterHTML(targetClone_1)),editor._selectionOverrides.hideFakeCaret()}))}editor.fire("dragend")}var elm,cloneElm,selection,startContainer})),removeDragState(state)}},removeDragState=function(state){state.on((function(state){removeElement(state.ghost)})),state.clear()},bindFakeDragEvents=function(editor){var state=value(),pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start(state,editor),dragHandler=function(state,editor){var throttledPlaceCaretAt=Delay.throttle((function(clientX,clientY){editor._selectionOverrides.hideFakeCaret(),editor.selection.placeCaretAt(clientX,clientY)}),0);return editor.on("remove",throttledPlaceCaretAt.stop),function(e){return state.on((function(state){var ghostElm,bodyElm,movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){if(editor.fire("dragstart",{target:state.element}).isDefaultPrevented())return;state.dragging=!0,editor.focus()}if(state.dragging){var targetPos=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5}}(state,calc(editor,e));ghostElm=state.ghost,bodyElm=editor.getBody(),ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm),function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px"}(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY),throttledPlaceCaretAt(e.clientX,e.clientY)}}))}}(state,editor),dropHandler=drop(state,editor),dragEndHandler=function(state,editor){return function(){state.on((function(state){state.dragging&&editor.fire("dragend")})),removeDragState(state)}}(state,editor);editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",(function(){pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)})),editor.on("keydown",(function(e){e.keyCode===VK.ESC&&dragEndHandler()}))},init$2=function(editor){bindFakeDragEvents(editor),function(editor){editor.on("drop",(function(e){var realTarget=void 0!==e.clientX?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;(isContentEditableFalse$1(realTarget)||"false"===editor.dom.getContentEditableParent(realTarget))&&e.preventDefault()}))}(editor),function(editor){return editor.getParam("block_unsupported_drop",!0,"boolean")}(editor)&&function(editor){var preventFileDrop=function(e){if(!e.isDefaultPrevented()){var dataTransfer=e.dataTransfer;dataTransfer&&(contains$3(dataTransfer.types,"Files")||dataTransfer.files.length>0)&&(e.preventDefault(),"drop"===e.type&&displayError(editor,"Dropped file type is not supported"))}},preventFileDropIfUIElement=function(e){isUIElement(editor,e.target)&&preventFileDrop(e)},setup=function(){var pageDom=DOMUtils.DOM,dom=editor.dom,doc=document,editorRoot=editor.inline?editor.getBody():editor.getDoc(),eventNames=["drop","dragover"];each$k(eventNames,(function(name){pageDom.bind(doc,name,preventFileDropIfUIElement),dom.bind(editorRoot,name,preventFileDrop)})),editor.on("remove",(function(){each$k(eventNames,(function(name){pageDom.unbind(doc,name,preventFileDropIfUIElement),dom.unbind(editorRoot,name,preventFileDrop)}))}))};editor.on("init",(function(){Delay.setEditorTimeout(editor,setup,0)}))}(editor)},isContentEditableTrue=isContentEditableTrue$4,isContentEditableFalse=isContentEditableFalse$b,getContentEditableRoot=function(editor,node){return getContentEditableRoot$1(editor.getBody(),node)},SelectionOverrides=function(editor){var selectedElement,selection=editor.selection,dom=editor.dom,isBlock=dom.isBlock,rootNode=editor.getBody(),fakeCaret=FakeCaret(editor,rootNode,isBlock,(function(){return hasFocus(editor)})),realSelectionId="sel-"+dom.uniqueId(),isFakeSelectionTargetElement=function(node){return node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode)},isNearFakeSelectionElement=function(pos){return isBeforeContentEditableFalse(pos)||isAfterContentEditableFalse(pos)||isBeforeMedia(pos)||isAfterMedia(pos)},setRange=function(range){range&&selection.setRng(range)},getRange=selection.getRng,showCaret=function(direction,node,before,scrollIntoView){return void 0===scrollIntoView&&(scrollIntoView=!0),editor.fire("ShowCaret",{target:node,direction:direction,before:before}).isDefaultPrevented()?null:(scrollIntoView&&selection.scrollIntoView(node,-1===direction),fakeCaret.show(before,node))},isWithinCaretContainer=function(node){return isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node)},isRangeInCaretContainer=function(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer)},normalizeShortEndedElementSelection=function(rng){var shortEndedElements=editor.schema.getShortEndedElements(),newRng=dom.createRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return has$2(shortEndedElements,startContainer.nodeName.toLowerCase())?0===startOffset?newRng.setStartBefore(startContainer):newRng.setStartAfter(startContainer):newRng.setStart(startContainer,startOffset),has$2(shortEndedElements,endContainer.nodeName.toLowerCase())?0===endOffset?newRng.setEndBefore(endContainer):newRng.setEndAfter(endContainer):newRng.setEnd(endContainer,endOffset),newRng},selectElement=function(elm){var targetClone=elm.cloneNode(!0),e=editor.fire("ObjectSelected",{target:elm,targetClone:targetClone});if(e.isDefaultPrevented())return null;var range=function(node,targetClone,origTargetClone){var $=editor.$,$realSelectionContainer=descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).fold((function(){return $([])}),(function(elm){return $([elm.dom])}));0===$realSelectionContainer.length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId)).appendTo(editor.getBody());var newRange=dom.createRng();targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all">Â </p>').append(targetClone),newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild),newRange.setEndAfter(targetClone)):($realSelectionContainer.empty().append("Â ").append(targetClone).append("Â "),newRange.setStart($realSelectionContainer[0].firstChild,1),newRange.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),$realSelectionContainer[0].focus();var sel=selection.getSel();return sel.removeAllRanges(),sel.addRange(newRange),newRange}(elm,e.targetClone,targetClone),nodeElm=SugarElement.fromDom(elm);return each$k(descendants(SugarElement.fromDom(editor.getBody()),"*[data-mce-selected]"),(function(elm){eq(nodeElm,elm)||remove$6(elm,"data-mce-selected")})),dom.getAttrib(elm,"data-mce-selected")||elm.setAttribute("data-mce-selected","1"),selectedElement=elm,hideFakeCaret(),range},setElementSelection=function(range,forward){if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1,caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range),beforeNode=caretPosition.getNode(!forward);if(isFakeCaretTarget(beforeNode))return showCaret(dir,beforeNode,!!forward&&!caretPosition.isAtEnd(),!1);var afterNode=caretPosition.getNode(forward);if(isFakeCaretTarget(afterNode))return showCaret(dir,afterNode,!forward&&!caretPosition.isAtEnd(),!1)}return null}var startContainer=range.startContainer,startOffset=range.startOffset,endOffset=range.endOffset;if(3===startContainer.nodeType&&0===startOffset&&isContentEditableFalse(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1!==startContainer.nodeType)return null;if(endOffset===startOffset+1&&startContainer===range.endContainer){var node=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(node))return selectElement(node)}return null},removeElementSelection=function(){selectedElement&&selectedElement.removeAttribute("data-mce-selected"),descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).each(remove$7),selectedElement=null},hideFakeCaret=function(){fakeCaret.hide()};return Env.ceFalse&&!isRtc(editor)&&function(){editor.on("mouseup",(function(e){var range=getRange();range.collapsed&&isXYInContentArea(editor,e.clientX,e.clientY)&&renderCaretAtRange(editor,range,!1).each(setRange)})),editor.on("click",(function(e){var contentEditableRoot=getContentEditableRoot(editor,e.target);contentEditableRoot&&(isContentEditableFalse(contentEditableRoot)&&(e.preventDefault(),editor.focus()),isContentEditableTrue(contentEditableRoot)&&dom.isChildOf(contentEditableRoot,selection.getNode())&&removeElementSelection())})),editor.on("blur NewBlock",removeElementSelection),editor.on("ResizeWindow FullscreenStateChanged",fakeCaret.reposition);var hasBetterMouseTarget=function(targetNode,caretNode){var node1,node2,targetBlock=dom.getParent(targetNode,isBlock),caretBlock=dom.getParent(caretNode,isBlock);return!isNullable(targetBlock)&&(!(targetNode===caretBlock||!dom.isChildOf(targetBlock,caretBlock)||!1!==isContentEditableFalse(getContentEditableRoot(editor,targetBlock)))||!dom.isChildOf(caretBlock,targetBlock)&&(node1=targetBlock,node2=caretBlock,!(dom.getParent(node1,isBlock)===dom.getParent(node2,isBlock)))&&function(elm){var start=elm.firstChild;if(isNullable(start))return!1;var startPos=CaretPosition.before(start);if(isBr$5(startPos.getNode())&&1===elm.childNodes.length)return!isNearFakeSelectionElement(startPos);var newPos=CaretWalker(elm).next(startPos);return newPos&&!isNearFakeSelectionElement(newPos)}(targetBlock))};editor.on("tap",(function(e){var targetElm=e.target,contentEditableRoot=getContentEditableRoot(editor,targetElm);isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):isFakeSelectionTargetElement(targetElm)&&selectNode(editor,targetElm).each(setElementSelection)}),!0),editor.on("mousedown",(function(e){var targetElm=e.target;if((targetElm===rootNode||"HTML"===targetElm.nodeName||dom.isChildOf(targetElm,rootNode))&&!1!==isXYInContentArea(editor,e.clientX,e.clientY)){var contentEditableRoot=getContentEditableRoot(editor,targetElm);if(contentEditableRoot)isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):(removeElementSelection(),isContentEditableTrue(contentEditableRoot)&&e.shiftKey||isXYWithinRange(e.clientX,e.clientY,selection.getRng())||(hideFakeCaret(),selection.placeCaretAt(e.clientX,e.clientY)));else if(isFakeSelectionTargetElement(targetElm))selectNode(editor,targetElm).each(setElementSelection);else if(!1===isFakeCaretTarget(targetElm)){removeElementSelection(),hideFakeCaret();var fakeCaretInfo=closestFakeCaret(rootNode,e.clientX,e.clientY);if(fakeCaretInfo&&!hasBetterMouseTarget(targetElm,fakeCaretInfo.node)){e.preventDefault();var range=showCaret(1,fakeCaretInfo.node,fakeCaretInfo.before,!1);setRange(range),editor.getBody().focus()}}}})),editor.on("keypress",(function(e){VK.modifierPressed(e)||isContentEditableFalse(selection.getNode())&&e.preventDefault()})),editor.on("GetSelectionRange",(function(e){var rng=e.range;if(selectedElement){if(!selectedElement.parentNode)return void(selectedElement=null);(rng=rng.cloneRange()).selectNode(selectedElement),e.range=rng}})),editor.on("SetSelectionRange",(function(e){e.range=normalizeShortEndedElementSelection(e.range);var rng=setElementSelection(e.range,e.forward);rng&&(e.range=rng)})),editor.on("AfterSetSelectionRange",(function(e){var node,rng=e.range,parentNode=rng.startContainer.parentNode;isRangeInCaretContainer(rng)||"mcepastebin"===parentNode.id||hideFakeCaret(),node=parentNode,dom.hasClass(node,"mce-offscreen-selection")||removeElementSelection()})),editor.on("copy",(function(e){var container,clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&&e.clipboardData&&!Env.ie){var realSelectionElement=(container=dom.get(realSelectionId))?container.getElementsByTagName("*")[0]:container;realSelectionElement&&(e.preventDefault(),clipboardData.clearData(),clipboardData.setData("text/html",realSelectionElement.outerHTML),clipboardData.setData("text/plain",realSelectionElement.outerText||realSelectionElement.innerText))}})),init$2(editor),function(editor){var renderFocusCaret=first((function(){if(!editor.removed&&editor.getBody().contains(document.activeElement)){var rng=editor.selection.getRng();if(rng.collapsed){var caretRange=renderRangeCaret(editor,rng,!1);editor.selection.setRng(caretRange)}}}),0);editor.on("focus",(function(){renderFocusCaret.throttle()})),editor.on("blur",(function(){renderFocusCaret.cancel()}))}(editor),function(editor){editor.on("init",(function(){editor.on("focusin",(function(e){var target=e.target;if(isMedia$2(target)){var ceRoot=getContentEditableRoot$1(editor.getBody(),target),node=isContentEditableFalse$b(ceRoot)?ceRoot:target;editor.selection.getNode()!==node&&selectNode(editor,node).each((function(rng){return editor.selection.setRng(rng)}))}}))}))}(editor)}(),{showCaret:showCaret,showBlockCaretContainer:function(blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),setRange(getRange()),selection.scrollIntoView(blockCaretContainer))},hideFakeCaret:hideFakeCaret,destroy:function(){fakeCaret.destroy(),selectedElement=null}}},Quirks=function(editor){var getAttributeApplyFunction,isSelectionAcrossElements,each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalDataType=isIE?"Text":"URL",setEditorCommandState=function(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}},isDefaultPrevented=function(e){return e.isDefaultPrevented()},emptyEditorWhenDeleting=function(){var serializeRng=function(rng){var body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})};editor.on("keydown",(function(e){var isCollapsed,body,keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)){if(isCollapsed=editor.selection.isCollapsed(),body=editor.getBody(),isCollapsed&&!dom.isEmpty(body))return;if(!isCollapsed&&!function(rng){var selection=serializeRng(rng),allRng=dom.createRng();return allRng.selectNode(editor.getBody()),selection===serializeRng(allRng)}(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}}))},selectAll=function(){editor.shortcuts.add("meta+a",null,"SelectAll")},documentElementEditingFocus=function(){editor.inline||dom.bind(editor.getDoc(),"mousedown mouseup",(function(e){var rng;if(e.target===editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"===e.type){if(isCaretContainer$2(rng.startContainer))return;selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)}))},focusBody=function(){Range.prototype.getClientRects||editor.on("mousedown",(function(e){if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){var body_1=editor.getBody();body_1.blur(),Delay.setEditorTimeout(editor,(function(){body_1.focus()}))}}))},selectControlElements=function(){editor.on("click",(function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"===target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))}))},disableBackspaceIntoATable=function(){editor.on("keydown",(function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng().startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}}))},setGeckoEditingOptions=function(){(function(editor){return editor.getParam("readonly")})(editor)||editor.on("BeforeExecCommand mousedown",(function(){setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),getObjectResizing(editor)||setEditorCommandState("enableObjectResizing",!1)}))},addBrAfterLastLinks=function(){editor.on("SetContent ExecCommand",(function(e){"setcontent"!==e.type&&"mceInsertLink"!==e.command||each(dom.select("a"),(function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}}))}))},showBrokenImageIcon=function(){editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")},restoreFocusOnKeyDown=function(){editor.inline||editor.on("keydown",(function(){document.activeElement===document.body&&editor.getWin().focus()}))},bodyHeight=function(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",(function(e){var rng;if("HTML"===e.target.nodeName){if(Env.ie>11)return void editor.getBody().focus();rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged()}})))},blockCmdArrowNavigation=function(){Env.mac&&editor.on("keydown",(function(e){!VK.metaKeyPressed(e)||e.shiftKey||37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37===e.keyCode?"backward":"forward","lineboundary"))}))},tapLinksAndImages=function(){editor.on("click",(function(e){var elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)})),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")},blockFormSubmitInsideEditor=function(){editor.on("init",(function(){editor.dom.bind(editor.getBody(),"submit",(function(e){e.preventDefault()}))}))},ieInternalDragAndDrop=function(){editor.on("dragstart",(function(e){!function(e){var selectionHtml,internalContent;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"===e.target.tagName&&selection.select(e.target),(selectionHtml=editor.selection.getContent()).length>0&&(internalContent="data:text/mce-internal,"+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,internalContent)))}(e)})),editor.on("drop",(function(e){if(!isDefaultPrevented(e)){var internalContent=function(e){var internalContent;return e.dataTransfer&&(internalContent=e.dataTransfer.getData(mceInternalDataType))&&internalContent.indexOf("data:text/mce-internal,")>=0?(internalContent=internalContent.substr("data:text/mce-internal,".length).split(","),{id:unescape(internalContent[0]),html:unescape(internalContent[1])}):null}(e);if(internalContent&&internalContent.id!==editor.id){e.preventDefault();var rng=fromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng),content=internalContent.html,internal=!0,editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content:content,internal:internal}):editor.execCommand("mceInsertContent",!1,content)}}var content,internal}))},refreshContentEditable=noop;return isRtc(editor)?(isWebKit&&(documentElementEditingFocus(),selectControlElements(),blockFormSubmitInsideEditor(),selectAll(),Env.iOS&&(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages())),isGecko&&(focusBody(),setGeckoEditingOptions(),showBrokenImageIcon(),blockCmdArrowNavigation())):(editor.on("keydown",(function(e){var rng,parent;if(!isDefaultPrevented(e)&&e.keyCode===VK.BACKSPACE){var container=(rng=selection.getRng()).startContainer,offset=rng.startOffset,root=dom.getRoot();if(parent=container,rng.collapsed&&0===offset){for(;parent&&parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),(rng=dom.createRng()).setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}}})),emptyEditorWhenDeleting(),Env.windowsPhone||editor.on("keyup focusin mouseup",(function(e){VK.modifierPressed(e)||selection.normalize()}),!0),isWebKit&&(documentElementEditingFocus(),selectControlElements(),getForcedRootBlock(editor)&&editor.on("init",(function(){setEditorCommandState("DefaultParagraphSeparator",getForcedRootBlock(editor))})),blockFormSubmitInsideEditor(),disableBackspaceIntoATable(),parser.addNodeFilter("br",(function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"===nodes[i].attr("class")&&nodes[i].remove()})),Env.iOS?(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages()):selectAll()),Env.ie>=11&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),setEditorCommandState("AutoUrlDetect",!1),ieInternalDragAndDrop()),isGecko&&(editor.on("keydown",(function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng().startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"===node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}})),focusBody(),getAttributeApplyFunction=function(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,(function(attr){target.setAttributeNode(attr.cloneNode(!0))})))}},isSelectionAcrossElements=function(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock)},editor.on("keypress",(function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8===e.keyCode||46===e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1})),dom.bind(editor.getDoc(),"cut",(function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,(function(){applyAttributes()})))})),setGeckoEditingOptions(),addBrAfterLastLinks(),showBrokenImageIcon(),blockCmdArrowNavigation(),disableBackspaceIntoATable())),{refreshContentEditable:refreshContentEditable,isHidden:function(){if(!isGecko||editor.removed)return!1;var sel=editor.selection.getSel();return!sel||!sel.rangeCount||0===sel.rangeCount}}},DOM$6=DOMUtils.DOM,getRootName=function(editor){return editor.inline?editor.getElement().nodeName.toLowerCase():void 0},removeUndefined=function(obj){return filter$3(obj,(function(v){return!1===isUndefined(v)}))},mkParserSettings=function(editor){var settings=editor.settings,blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:settings.allow_conditional_comments,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_html_in_named_anchor:settings.allow_html_in_named_anchor,allow_script_urls:settings.allow_script_urls,allow_unsafe_link_target:settings.allow_unsafe_link_target,convert_fonts_to_spans:settings.convert_fonts_to_spans,fix_list_elements:settings.fix_list_elements,font_size_legacy_values:settings.font_size_legacy_values,forced_root_block:settings.forced_root_block,forced_root_block_attrs:settings.forced_root_block_attrs,padd_empty_with_br:settings.padd_empty_with_br,preserve_cdata:settings.preserve_cdata,remove_trailing_brs:settings.remove_trailing_brs,inline_styles:settings.inline_styles,root_name:getRootName(editor),validate:!0,blob_cache:blobCache,document:editor.getDoc(),images_dataimg_filter:settings.images_dataimg_filter})},moveSelectionToFirstCaretPosition=function(editor){var root=editor.dom.getRoot();editor.inline||hasAnyRanges(editor)&&editor.selection.getStart(!0)!==root||firstPositionIn(root).each((function(pos){var node=pos.getNode(),caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;Env.browser.isIE()?function(editor,rng){var root=SugarElement.fromDom(editor.getBody()),newBookmark=(shouldStore(editor)?Optional.from(rng):Optional.none()).map(nativeRangeToSelectionRange).filter(isRngInRoot(root));editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark}(editor,caretPos.toRange()):editor.selection.setRng(caretPos.toRange())}))},initEditor=function(editor){editor.bindPendingEventDelegates(),editor.initialized=!0,function(editor){editor.fire("Init")}(editor),editor.focus(!0),moveSelectionToFirstCaretPosition(editor),editor.nodeChanged({initial:!0}),editor.execCallback("init_instance_callback",editor),function(editor){editor.settings.auto_focus&&Delay.setEditorTimeout(editor,(function(){var focusEditor;(focusEditor=!0===editor.settings.auto_focus?editor:editor.editorManager.get(editor.settings.auto_focus)).destroyed||focusEditor.focus()}),100)}(editor)},getStyleSheetLoader$1=function(editor){return editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader},loadContentCss=function(editor){var styleSheetLoader=getStyleSheetLoader$1(editor),fontCss=getFontCss(editor),css=editor.contentCSS,removeCss=function(){styleSheetLoader.unloadAll(css),editor.inline||editor.ui.styleSheetLoader.unloadAll(fontCss)},loaded=function(){editor.removed?removeCss():editor.on("remove",removeCss)};if(editor.contentStyles.length>0){var contentCssText_1="";Tools.each(editor.contentStyles,(function(style){contentCssText_1+=style+"\r\n"})),editor.dom.addStyle(contentCssText_1)}var allStylesheets=promiseObj.all(function(editor,css,framedFonts){var promises=[new promiseObj((function(resolve,reject){return getStyleSheetLoader$1(editor).loadAll(css,resolve,reject)}))];return editor.inline?promises:promises.concat([new promiseObj((function(resolve,reject){return editor.ui.styleSheetLoader.loadAll(framedFonts,resolve,reject)}))])}(editor,css,fontCss)).then(loaded).catch(loaded);return editor.settings.content_style&&function(editor,text){var body=SugarElement.fromDom(editor.getBody()),container=getStyleContainer(getRootNode(body)),style=SugarElement.fromTag("style");set$1(style,"type","text/css"),append$1(style,SugarElement.fromText(text)),append$1(container,style),editor.on("remove",(function(){remove$7(style)}))}(editor,editor.settings.content_style),allStylesheets},preInit=function(editor){var settings=editor.settings,doc=editor.getDoc(),body=editor.getBody();!function(editor){editor.fire("PreInit")}(editor),settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM$6.setAttrib(body,"spellcheck","false")),editor.quirks=Quirks(editor),function(editor){editor.fire("PostRender")}(editor);var directionality=function(editor){return editor.getParam("directionality",I18n.isRtl()?"rtl":void 0)}(editor);void 0!==directionality&&(body.dir=directionality),settings.protect&&editor.on("BeforeSetContent",(function(e){Tools.each(settings.protect,(function(pattern){e.content=e.content.replace(pattern,(function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"}))}))})),editor.on("SetContent",(function(){editor.addVisual(editor.getBody())})),editor.on("compositionstart compositionend",(function(e){editor.composing="compositionstart"===e.type}))},initEditorWithInitialContent=function(editor){!0!==editor.removed&&(!function(editor){isRtc(editor)||editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"})}(editor),initEditor(editor))},initContentBody=function(editor,skipWrite){var settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc();settings.inline||(editor.getElement().style.visibility=editor.orgVisibility),skipWrite||editor.inline||(doc.open(),doc.write(editor.iframeHTML),doc.close()),editor.inline&&(DOM$6.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=document,editor.contentWindow=window,editor.bodyElement=targetElm,editor.contentAreaContainer=targetElm);var body=editor.getBody();body.disabled=!0,editor.readonly=!!settings.readonly,editor.readonly||(editor.inline&&"static"===DOM$6.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable=editor.getParam("content_editable_state",!0)),body.disabled=!1,editor.editorUpload=EditorUpload(editor),editor.schema=Schema(settings),editor.dom=DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:function(){return editor.inline},schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:function(e){editor.fire("SetAttrib",e)}}),editor.parser=function(editor){var parser=DomParser(mkParserSettings(editor),editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",(function(nodes,name){for(var node,value,i=nodes.length,dom=editor.dom,internalName="data-mce-"+name;i--;)if((value=(node=nodes[i]).attr(name))&&!node.attr(internalName)){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?((value=dom.serializeStyle(dom.parseStyle(value),node.name)).length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name))}})),parser.addNodeFilter("script",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i],type=node.attr("type")||"no/type";0!==type.indexOf("mce-")&&node.attr("type","mce-"+type)}})),editor.settings.preserve_cdata&&parser.addNodeFilter("#cdata",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];node.type=8,node.name="#comment",node.value="[CDATA["+editor.dom.encode(node.value)+"]]"}})),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",(function(nodes){for(var i=nodes.length,nonEmptyElements=editor.schema.getNonEmptyElements();i--;){var node=nodes[i];node.isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&(node.append(new AstNode("br",1)).shortEnded=!0)}})),parser}(editor),editor.serializer=DomSerializer(function(editor){var settings=editor.settings;return __assign(__assign({},mkParserSettings(editor)),removeUndefined({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope,element_format:settings.element_format,entities:settings.entities,entity_encoding:settings.entity_encoding,indent:settings.indent,indent_after:settings.indent_after,indent_before:settings.indent_before,block_elements:settings.block_elements,boolean_attributes:settings.boolean_attributes,custom_elements:settings.custom_elements,extended_valid_elements:settings.extended_valid_elements,invalid_elements:settings.invalid_elements,invalid_styles:settings.invalid_styles,move_caret_before_on_enter_elements:settings.move_caret_before_on_enter_elements,non_empty_elements:settings.non_empty_elements,schema:settings.schema,self_closing_elements:settings.self_closing_elements,short_ended_elements:settings.short_ended_elements,special:settings.special,text_block_elements:settings.text_block_elements,text_inline_elements:settings.text_inline_elements,valid_children:settings.valid_children,valid_classes:settings.valid_classes,valid_elements:settings.valid_elements,valid_styles:settings.valid_styles,verify_html:settings.verify_html,whitespace_elements:settings.whitespace_elements}))}(editor),editor),editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor),editor.annotator=Annotator(editor),editor.formatter=Formatter(editor),editor.undoManager=UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=SelectionOverrides(editor),setup$e(editor),setup$3(editor),isRtc(editor)||setup$2(editor);var caret=function(editor){return isRtc(editor)?Cell(null):registerKeyboardOverrides(editor)}(editor);setup$f(editor,caret),function(editor){getForcedRootBlock(editor)&&editor.on("NodeChange",curry(addRootBlocks,editor))}(editor),setup$g(editor);var setupRtcThunk=setup$i(editor);preInit(editor),setupRtcThunk.fold((function(){loadContentCss(editor).then((function(){return initEditorWithInitialContent(editor)}))}),(function(setupRtc){editor.setProgressState(!0),loadContentCss(editor).then((function(){setupRtc().then((function(_rtcMode){editor.setProgressState(!1),initEditorWithInitialContent(editor)}),(function(err){editor.notificationManager.open({type:"error",text:String(err)}),initEditorWithInitialContent(editor)}))}))}))},DOM$5=DOMUtils.DOM,getIframeHtml=function(editor){var iframeHTML=function(editor){return editor.getParam("doctype","<!DOCTYPE html>")}(editor)+"<html><head>";(function(editor){return editor.getParam("document_base_url","")})(editor)!==editor.documentBaseUrl&&(iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';var bodyId=function(editor){return getBodySetting(editor,"body_id","tinymce")}(editor),bodyClass=function(editor){return getBodySetting(editor,"body_class","")}(editor),translatedAriaText=editor.translate(function(editor){return editor.getParam("iframe_aria_text","Rich Text Area. Press ALT-0 for help.","string")}(editor));return getContentSecurityPolicy(editor)&&(iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+getContentSecurityPolicy(editor)+'" />'),iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'" aria-label="'+translatedAriaText+'"><br></body></html>'},createIframe=function(editor,o){var id,title,customAttrs,iframe,iframeTitle=editor.translate("Rich Text Area"),ifr=(id=editor.id,title=iframeTitle,o.height,customAttrs=function(editor){return editor.getParam("iframe_attrs",{})}(editor),iframe=SugarElement.fromTag("iframe"),setAll$1(iframe,customAttrs),setAll$1(iframe,{id:id+"_ifr",frameBorder:"0",allowTransparency:"true",title:title}),add$1(iframe,"tox-edit-area__iframe"),iframe).dom;ifr.onload=function(){ifr.onload=null,editor.fire("load")};var isDomainRelaxed=function(editor,ifr){if(document.domain!==window.location.hostname&&Env.browser.isIE()){var bodyUuid=uuid("mce");editor[bodyUuid]=function(){initContentBody(editor)};var domainRelaxUrl='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);document.close();ed.'+bodyUuid+"(true);})()";return DOM$5.setAttrib(ifr,"src",domainRelaxUrl),!0}return!1}(editor,ifr);return editor.contentAreaContainer=o.iframeContainer,editor.iframeElement=ifr,editor.iframeHTML=getIframeHtml(editor),DOM$5.add(o.iframeContainer,ifr),isDomainRelaxed},DOM$4=DOMUtils.DOM,initPlugin=function(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin),pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,"");if(plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)){if(Tools.each(PluginManager.dependencies(plugin),(function(dep){initPlugin(editor,initializedPlugins,dep)})),editor.plugins[plugin])return;try{var pluginInstance=new Plugin(editor,pluginUrl,editor.$);editor.plugins[plugin]=pluginInstance,pluginInstance.init&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}catch(e){!function(editor,name,err){var message=I18n.translate(["Failed to initialize plugin: {0}",name]);fireError(editor,"PluginLoadError",{message:message}),initError(message,err),displayError(editor,message)}(editor,plugin,e)}}},trimLegacyPrefix=function(name){return name.replace(/^\-/,"")},createThemeFalseResult=function(element){return{editorContainer:element,iframeContainer:element,api:{}}},renderThemeFalse=function(editor){var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):function(targetElement){var iframeContainer=DOM$4.create("div");return DOM$4.insertAfter(iframeContainer,targetElement),createThemeFalseResult(iframeContainer)}(targetElement)},renderThemeUi=function(editor){var elm=editor.getElement();return editor.orgDisplay=elm.style.display,isString$1(getTheme(editor))?function(editor){return editor.theme.renderUI()}(editor):isFunction(getTheme(editor))?function(editor){var elm=editor.getElement(),info=getTheme(editor)(editor,elm);return info.editorContainer.nodeType&&(info.editorContainer.id=info.editorContainer.id||editor.id+"_parent"),info.iframeContainer&&info.iframeContainer.nodeType&&(info.iframeContainer.id=info.iframeContainer.id||editor.id+"_iframecontainer"),info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight,info}(editor):renderThemeFalse(editor)},init=function(editor){editor.fire("ScriptsLoaded"),function(editor){var iconPackName=Tools.trim(getIconPackName(editor)),currentIcons=editor.ui.registry.getAll().icons,loadIcons=__assign(__assign({},IconManager.get("default").icons),IconManager.get(iconPackName).icons);each$j(loadIcons,(function(svgData,icon){has$2(currentIcons,icon)||editor.ui.registry.addIcon(icon,svgData)}))}(editor),function(editor){var theme=getTheme(editor);if(isString$1(theme)){editor.settings.theme=trimLegacyPrefix(theme);var Theme=ThemeManager.get(theme);editor.theme=new Theme(editor,ThemeManager.urls[theme]),editor.theme.init&&editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,""),editor.$)}else editor.theme={}}(editor),function(editor){var initializedPlugins=[];Tools.each(getPlugins(editor).split(/[ ,]/),(function(name){initPlugin(editor,initializedPlugins,trimLegacyPrefix(name))}))}(editor);var renderInfo=renderThemeUi(editor);!function(editor,api){var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),disable:Optional.from(api.disable).getOr(noop),isDisabled:Optional.from(api.isDisabled).getOr(never),enable:function(){editor.mode.isReadOnly()||Optional.from(api.enable).map(call)}};editor.ui=__assign(__assign({},editor.ui),uiApiFacade)}(editor,Optional.from(renderInfo.api).getOr({}));var boxInfo={editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer};return editor.editorContainer=boxInfo.editorContainer?boxInfo.editorContainer:null,appendContentCssFromSettings(editor),editor.inline?initContentBody(editor):function(editor,boxInfo){var isDomainRelaxed=createIframe(editor,boxInfo);boxInfo.editorContainer&&(DOM$5.get(boxInfo.editorContainer).style.display=editor.orgDisplay,editor.hidden=DOM$5.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM$5.setAttrib(editor.id,"aria-hidden","true"),isDomainRelaxed||initContentBody(editor)}(editor,boxInfo)},DOM$3=DOMUtils.DOM,hasSkipLoadPrefix=function(name){return"-"===name.charAt(0)},loadLanguage=function(scriptLoader,editor){var languageCode=getLanguageCode(editor),languageUrl=function(editor){return editor.getParam("language_url","","string")}(editor);if(!1===I18n.hasCode(languageCode)&&"en"!==languageCode){var url_1=""!==languageUrl?languageUrl:editor.editorManager.baseURL+"/langs/"+languageCode+".js";scriptLoader.add(url_1,noop,void 0,(function(){!function(editor,url,name){logError(editor,"LanguageLoadError",createLoadError("language",url,name))}(editor,url_1,languageCode)}))}},getIconsUrlMetaFromName=function(editor,name,suffix){return Optional.from(name).filter((function(name){return name.length>0&&!IconManager.has(name)})).map((function(name){return{url:editor.editorManager.baseURL+"/icons/"+name+"/icons"+suffix+".js",name:Optional.some(name)}}))},loadIcons=function(scriptLoader,editor,suffix){var defaultIconsUrl=getIconsUrlMetaFromName(editor,"default",suffix),customIconsUrl=function(editor){return Optional.from(function(editor){return editor.getParam("icons_url","","string")}(editor)).filter((function(url){return url.length>0})).map((function(url){return{url:url,name:Optional.none()}}))}(editor).orThunk((function(){return getIconsUrlMetaFromName(editor,getIconPackName(editor),"")}));each$k(function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r}([defaultIconsUrl,customIconsUrl]),(function(urlMeta){scriptLoader.add(urlMeta.url,noop,void 0,(function(){!function(editor,url,name){logError(editor,"IconsLoadError",createLoadError("icons",url,name))}(editor,urlMeta.url,urlMeta.name.getOrUndefined())}))}))},loadScripts=function(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;!function(scriptLoader,editor,suffix,callback){var theme=getTheme(editor);if(isString$1(theme)){if(!hasSkipLoadPrefix(theme)&&!has$2(ThemeManager.urls,theme)){var themeUrl=function(editor){return editor.getParam("theme_url")}(editor);themeUrl?ThemeManager.load(theme,editor.documentBaseURI.toAbsolute(themeUrl)):ThemeManager.load(theme,"themes/"+theme+"/theme"+suffix+".js")}scriptLoader.loadQueue((function(){ThemeManager.waitFor(theme,callback)}))}else callback()}(scriptLoader,editor,suffix,(function(){loadLanguage(scriptLoader,editor),loadIcons(scriptLoader,editor,suffix),function(editor,suffix){Tools.each(function(editor){return editor.getParam("external_plugins")}(editor),(function(url,name){PluginManager.load(name,url,noop,void 0,(function(){pluginLoadError(editor,url,name)})),editor.settings.plugins+=" "+name})),Tools.each(getPlugins(editor).split(/[ ,]/),(function(plugin){if((plugin=Tools.trim(plugin))&&!PluginManager.urls[plugin])if(hasSkipLoadPrefix(plugin)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,(function(depPlugin){var defaultSettings={prefix:"plugins/",resource:depPlugin,suffix:"/plugin"+suffix+".js"},dep=PluginManager.createUrl(defaultSettings,depPlugin);PluginManager.load(dep.resource,dep,noop,void 0,(function(){pluginLoadError(editor,dep.prefix+dep.resource+dep.suffix,dep.resource)}))}))}else{var url_2={prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"};PluginManager.load(plugin,url_2,noop,void 0,(function(){pluginLoadError(editor,url_2.prefix+url_2.resource+url_2.suffix,plugin)}))}}))}(editor,suffix),scriptLoader.loadQueue((function(){editor.removed||init(editor)}),editor,(function(){editor.removed||init(editor)}))}))},render=function(editor){var id=editor.id;I18n.setCode(getLanguageCode(editor));var readyHandler=function(){DOM$3.unbind(window,"ready",readyHandler),editor.render()};if(EventUtils.Event.domLoaded){if(editor.getElement()&&Env.contentEditable){var element=SugarElement.fromDom(editor.getElement()),snapshot=function(element){return foldl(element.dom.attributes,(function(acc,attr){return acc[attr.name]=attr.value,acc}),{})}(element);editor.on("remove",(function(){eachr(element.dom.attributes,(function(attr){return remove$6(element,attr.name)})),setAll$1(element,snapshot)})),editor.ui.styleSheetLoader=function(element,editor){return instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)})}(element,editor),!function(editor){return editor.getParam("inline")}(editor)?(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden"):editor.inline=!0;var form=editor.getElement().form||DOM$3.getParent(id,"form");form&&(editor.formElement=form,function(editor){return editor.getParam("hidden_input")}(editor)&&!isTextareaOrInput(editor.getElement())&&(DOM$3.insertAfter(DOM$3.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=function(e){editor.fire(e.type,e)},DOM$3.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",(function(){editor.resetContent()})),!function(editor){return editor.getParam("submit_patch")}(editor)||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)})),editor.windowManager=WindowManager(editor),editor.notificationManager=NotificationManager(editor),function(editor){return"xml"===editor.getParam("encoding")}(editor)&&editor.on("GetContent",(function(e){e.save&&(e.content=DOM$3.encode(e.content))})),function(editor){return editor.getParam("add_form_submit_trigger")}(editor)&&editor.on("submit",(function(){editor.initialized&&editor.save()})),function(editor){return editor.getParam("add_unload_trigger")}(editor)&&(editor._beforeUnload=function(){!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),loadScripts(editor,editor.suffix)}}else DOM$3.bind(window,"ready",readyHandler)},addVisual=function(editor,elm){return function(editor,elm){return getRtcInstanceWithError(editor).editor.addVisual(elm)}(editor,elm)},legacyPropNames={"font-size":"size","font-family":"face"},getSpecifiedFontProp=function(propName,rootElm,elm){return closest$1(SugarElement.fromDom(elm),(function(elm){return function(elm){return getRaw(elm,propName).orThunk((function(){return"font"===name(elm)?get$9(legacyPropNames,propName).bind((function(legacyPropName){return getOpt(elm,legacyPropName)})):Optional.none()}))}(elm)}),(function(elm){return eq(SugarElement.fromDom(rootElm),elm)}))},getFontProp=function(propName){return function(rootElm,elm){return Optional.from(elm).map(SugarElement.fromDom).filter(isElement$6).bind((function(element){return getSpecifiedFontProp(propName,rootElm,element.dom).or(function(propName,elm){return Optional.from(DOMUtils.DOM.getStyle(elm,propName,!0))}(propName,element.dom))})).getOr("")}},getFontSize=getFontProp("font-size"),getFontFamily=compose((function(fontFamily){return fontFamily.replace(/[\'\"\\]/g,"").replace(/,\s+/g,",")}),getFontProp("font-family")),findFirstCaretElement=function(editor){return firstPositionIn(editor.getBody()).map((function(caret){var container=caret.container();return isText$7(container)?container.parentNode:container}))},bindRange=function(editor,binder){return function(editor){return Optional.from(editor.selection.getRng()).bind((function(rng){var root=editor.getBody();return rng.startContainer===root&&0===rng.startOffset?Optional.none():Optional.from(editor.selection.getStart(!0))}))}(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$6).bind(binder)},mapRange=function(editor,mapper){return bindRange(editor,compose1(Optional.some,mapper))},fromFontSizeNumber=function(editor,value){if(/^[0-9.]+$/.test(value)){var fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){var fontSizes=function(editor){return Tools.explode(editor.getParam("font_size_style_values","xx-small,x-small,small,medium,large,x-large,xx-large"))}(editor),fontClasses=function(editor){return Tools.explode(editor.getParam("font_size_classes",""))}(editor);return fontClasses?fontClasses[fontSizeNumber-1]||value:fontSizes[fontSizeNumber-1]||value}return value}return value},normalizeFontNames=function(font){var fonts=font.split(/\s*,\s*/);return map$3(fonts,(function(font){return-1===font.indexOf(" ")||startsWith(font,'"')||startsWith(font,"'")?font:"'"+font+"'"})).join(",")},insertAtCaret=function(editor,value){var result=function(value){if("string"!=typeof value){var details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details:details}}return{content:value,details:{}}}(value);!function(editor,value,details){getRtcInstanceWithFallback(editor).editor.insertContent(value,details)}(editor,result.content,result.details)},each$4=Tools.each,map=Tools.map,inArray=Tools.inArray,EditorCommands=function(){function EditorCommands(editor){this.commands={state:{},exec:{},value:{}},this.editor=editor,this.setupCommands(editor)}return EditorCommands.prototype.execCommand=function(command,ui,value,args){var func,state=!1,self=this;if(!self.editor.removed){var editor;if("mcefocus"!==command.toLowerCase()&&(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus?(editor=self.editor,getRng(editor).each((function(rng){return editor.selection.setRng(rng)}))):self.editor.focus()),(args=self.editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value})).isDefaultPrevented())return!1;var customCommand=command.toLowerCase();if(func=self.commands.exec[customCommand])return func(customCommand,ui,value),self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;if(each$4(this.editor.plugins,(function(p){if(p.execCommand&&p.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),state=!0,!1})),state)return state;if(self.editor.theme&&self.editor.theme.execCommand&&self.editor.theme.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;try{state=self.editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0)}},EditorCommands.prototype.queryCommandState=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.state[command])return func(command);try{return this.editor.getDoc().queryCommandState(command)}catch(ex){}return!1}},EditorCommands.prototype.queryCommandValue=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.value[command])return func(command);try{return this.editor.getDoc().queryCommandValue(command)}catch(ex){}}},EditorCommands.prototype.addCommands=function(commandList,type){void 0===type&&(type="exec");var self=this;each$4(commandList,(function(callback,command){each$4(command.toLowerCase().split(","),(function(command){self.commands[type][command]=callback}))}))},EditorCommands.prototype.addCommand=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.exec[command]=function(command,ui,value,args){return callback.call(scope||_this.editor,ui,value,args)}},EditorCommands.prototype.queryCommandSupported=function(command){if(command=command.toLowerCase(),this.commands.exec[command])return!0;try{return this.editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1},EditorCommands.prototype.addQueryStateHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.state[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.addQueryValueHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.value[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.hasCustomCommand=function(command){return command=command.toLowerCase(),!!this.commands.exec[command]},EditorCommands.prototype.execNativeCommand=function(command,ui,value){return void 0===ui&&(ui=!1),void 0===value&&(value=null),this.editor.getDoc().execCommand(command,ui,value)},EditorCommands.prototype.isFormatMatch=function(name){return this.editor.formatter.match(name)},EditorCommands.prototype.toggleFormat=function(name,value){this.editor.formatter.toggle(name,value),this.editor.nodeChanged()},EditorCommands.prototype.storeSelection=function(type){this.selectionBookmark=this.editor.selection.getBookmark(type)},EditorCommands.prototype.restoreSelection=function(){this.editor.selection.moveToBookmark(this.selectionBookmark)},EditorCommands.prototype.setupCommands=function(editor){var self=this;this.addCommands({"mceResetDesignMode,mceBeginUndoLevel":noop,"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},mceFocus:function(_command,_ui,value){focus(editor,value)},"Cut,Copy,Paste":function(command){var failed,doc=editor.getDoc();try{self.execNativeCommand(command)}catch(ex){failed=!0}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");Env.mac&&(msg=msg.replace(/Ctrl\+/g,"â+")),editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(editor.selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),"a");elm&&editor.dom.remove(elm,!0)}else editor.formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"===align&&(align="justify"),each$4("left,center,right,justify".split(","),(function(name){align!==name&&editor.formatter.remove("align"+name)})),"none"!==align&&self.toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){var listParent;self.execNativeCommand(command);var listElm=editor.dom.getParent(editor.selection.getNode(),"ol,ul");listElm&&(listParent=listElm.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(self.storeSelection(),editor.dom.split(listParent,listElm),self.restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){self.toggleFormat(command)},"ForeColor,HiliteColor":function(command,ui,value){self.toggleFormat(command,{value:value})},FontName:function(command,ui,value){!function(editor,value){var font=fromFontSizeNumber(editor,value);editor.formatter.toggle("fontname",{value:normalizeFontNames(font)}),editor.nodeChanged()}(editor,value)},FontSize:function(command,ui,value){!function(editor,value){editor.formatter.toggle("fontsize",{value:fromFontSizeNumber(editor,value)}),editor.nodeChanged()}(editor,value)},LineHeight:function(command,ui,value){!function(editor,lineHeight){editor.formatter.toggle("lineheight",{value:String(lineHeight)}),editor.nodeChanged()}(editor,value)},Lang:function(command,ui,lang){self.toggleFormat(command,{value:lang.code,customValue:lang.customCode})},RemoveFormat:function(command){editor.formatter.remove(command)},mceBlockQuote:function(){self.toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return self.toggleFormat(value||"p")},mceCleanup:function(){var bookmark=editor.selection.getBookmark();editor.setContent(editor.getContent()),editor.selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||editor.selection.getNode();node!==editor.getBody()&&(self.storeSelection(),editor.dom.remove(node,!0),self.restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;editor.dom.getParent(editor.selection.getNode(),(function(node){if(1===node.nodeType&&counter++===value)return editor.selection.select(node),!1}),editor.getBody())},mceSelectNode:function(command,ui,value){editor.selection.select(value)},mceInsertContent:function(command,ui,value){insertAtCaret(editor,value)},mceInsertRawHTML:function(command,ui,value){editor.selection.setContent("tiny_mce_marker");var content=editor.getContent();editor.setContent(content.replace(/tiny_mce_marker/g,(function(){return value})))},mceInsertNewLine:function(command,ui,value){insert(editor,value)},mceToggleFormat:function(command,ui,value){self.toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){handle(editor,command)},mceRepaint:noop,InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,editor.selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){"string"==typeof value&&(value={href:value});var anchor=editor.dom.getParent(editor.selection.getNode(),"a");value.href=value.href.replace(/ /g,"%20"),anchor&&value.href||editor.formatter.remove("link"),value.href&&editor.formatter.apply("link",value,anchor)},selectAll:function(){var editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$4);if(editingHost){var rng=editor.dom.createRng();rng.selectNodeContents(editingHost),editor.selection.setRng(rng)}},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){return insert$1(editor,value),!0}});var alignStates=function(name){return function(){var selection=editor.selection,nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks(),matches=map(nodes,(function(node){return!!editor.formatter.matchNode(node,name)}));return-1!==inArray(matches,!0)}};self.addCommands({JustifyLeft:alignStates("alignleft"),JustifyCenter:alignStates("aligncenter"),JustifyRight:alignStates("alignright"),JustifyFull:alignStates("alignjustify"),"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return self.isFormatMatch(command)},mceBlockQuote:function(){return self.isFormatMatch("blockquote")},Outdent:function(){return canOutdent(editor)},"InsertUnorderedList,InsertOrderedList":function(command){var list=editor.dom.getParent(editor.selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),self.addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}}),self.addQueryValueHandler("FontName",(function(){return function(editor){return mapRange(editor,(function(elm){return getFontFamily(editor.getBody(),elm.dom)})).getOr("")}(editor)}),this),self.addQueryValueHandler("FontSize",(function(){return function(editor){return mapRange(editor,(function(elm){return getFontSize(editor.getBody(),elm.dom)})).getOr("")}(editor)}),this),self.addQueryValueHandler("LineHeight",(function(){return function(editor){return mapRange(editor,(function(elm){var root=SugarElement.fromDom(editor.getBody());return closest$1(elm,(function(elm){return getRaw(elm,"line-height")}),curry(eq,root)).getOrThunk((function(){var lineHeight=parseFloat(get$5(elm,"line-height")),fontSize=parseFloat(get$5(elm,"font-size"));return String(lineHeight/fontSize)}))})).getOr("")}(editor)}),this)},EditorCommands}(),toggleClass=function(elm,cls,state){var element,clazz;has(elm,cls)&&!1===state?(clazz=cls,supports(element=elm)?element.dom.classList.remove(clazz):remove$4(element,clazz),cleanClass(element)):state&&add$1(elm,cls)},setEditorCommandState=function(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,String(state))}catch(ex){}},setContentEditable=function(elm,state){elm.dom.contentEditable=state?"true":"false"},toggleReadOnly=function(editor,state){var body=SugarElement.fromDom(editor.getBody());toggleClass(body,"mce-content-readonly",state),state?(editor.selection.controlSelection.hideResizeRect(),editor._selectionOverrides.hideFakeCaret(),function(editor){Optional.from(editor.selection.getNode()).each((function(elm){elm.removeAttribute("data-mce-selected")}))}(editor),editor.readonly=!0,setContentEditable(body,!1),each$k(descendants(body,'*[contenteditable="true"]'),(function(elm){set$1(elm,"data-mce-contenteditable","true"),setContentEditable(elm,!1)}))):(editor.readonly=!1,setContentEditable(body,!0),function(elm){each$k(descendants(elm,'*[data-mce-contenteditable="true"]'),(function(elm){remove$6(elm,"data-mce-contenteditable"),setContentEditable(elm,!0)}))}(body),setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),hasEditorOrUiFocus(editor)&&editor.focus(),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.nodeChanged())},isReadOnly=function(editor){return editor.readonly},registerFilters=function(editor){editor.parser.addAttributeFilter("contenteditable",(function(nodes){isReadOnly(editor)&&each$k(nodes,(function(node){node.attr("data-mce-contenteditable",node.attr("contenteditable")),node.attr("contenteditable","false")}))})),editor.serializer.addAttributeFilter("data-mce-contenteditable",(function(nodes){isReadOnly(editor)&&each$k(nodes,(function(node){node.attr("contenteditable",node.attr("data-mce-contenteditable"))}))})),editor.serializer.addTempAttr("data-mce-contenteditable")},processReadonlyEvents=function(editor,e){if(function(e){return"click"===e.type}(e)&&!VK.metaKeyPressed(e)){var elm=SugarElement.fromDom(e.target);(function(editor,elm){return closest$2(elm,"a",(function(elm){return eq(elm,SugarElement.fromDom(editor.getBody()))})).bind((function(a){return getOpt(a,"href")}))})(editor,elm).each((function(href){if(e.preventDefault(),/^#/.test(href)){var targetEl=editor.dom.select(href+',[name="'+((startsWith(str=href,prefix="#")?function(str,numChars){return str.substring(numChars)}(str,prefix.length):str)+'"]'));targetEl.length&&editor.selection.scrollIntoView(targetEl[0],!0)}else window.open(href,"_blank","rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes");var str,prefix}))}},nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel"," "),EventDispatcher=function(){function EventDispatcher(settings){this.bindings={},this.settings=settings||{},this.scope=this.settings.scope||this,this.toggleEvent=this.settings.toggleEvent||never}return EventDispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},EventDispatcher.prototype.fire=function(name,args){var lcName=name.toLowerCase(),event=normalize$3(lcName,args||{},this.scope);this.settings.beforeFire&&this.settings.beforeFire(event);var handlers=this.bindings[lcName];if(handlers)for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(!callback.removed){if(callback.once&&this.off(lcName,callback.func),event.isImmediatePropagationStopped())return event;if(!1===callback.func.call(this.scope,event))return event.preventDefault(),event}}return event},EventDispatcher.prototype.on=function(name,callback,prepend,extra){if(!1===callback&&(callback=never),callback){var wrappedCallback={func:callback,removed:!1};extra&&Tools.extend(wrappedCallback,extra);for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];handlers||(handlers=[],this.toggleEvent(currentName,!0)),handlers=prepend?__spreadArray([wrappedCallback],handlers,!0):__spreadArray(__spreadArray([],handlers,!0),[wrappedCallback],!1),this.bindings[currentName]=handlers}}return this},EventDispatcher.prototype.off=function(name,callback){var _this=this;if(name)for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];if(!currentName)return each$j(this.bindings,(function(_value,bindingName){_this.toggleEvent(bindingName,!1),delete _this.bindings[bindingName]})),this;if(handlers){if(callback){var filteredHandlers=partition(handlers,(function(handler){return handler.func===callback}));handlers=filteredHandlers.fail,this.bindings[currentName]=handlers,each$k(filteredHandlers.pass,(function(handler){handler.removed=!0}))}else handlers.length=0;handlers.length||(this.toggleEvent(name,!1),delete this.bindings[currentName])}}else each$j(this.bindings,(function(_value,name){_this.toggleEvent(name,!1)})),this.bindings={};return this},EventDispatcher.prototype.once=function(name,callback,prepend){return this.on(name,callback,prepend,{once:!0})},EventDispatcher.prototype.has=function(name){return name=name.toLowerCase(),!(!this.bindings[name]||0===this.bindings[name].length)},EventDispatcher}(),getEventDispatcher=function(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher},Observable={fire:function(name,args,bubble){if(this.removed&&"remove"!==name&&"detach"!==name)return args;var dispatcherArgs=getEventDispatcher(this).fire(name,args);if(!1!==bubble&&this.parent)for(var parent_1=this.parent();parent_1&&!dispatcherArgs.isPropagationStopped();)parent_1.fire(name,dispatcherArgs,!1),parent_1=parent_1.parent();return dispatcherArgs},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}},DOM$2=DOMUtils.DOM,getEventTarget=function(editor,eventName){if("selectionchange"===eventName)return editor.getDoc();if(!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName))return editor.getDoc().documentElement;var eventRoot=getEventRoot(editor);return eventRoot?(editor.eventRoot||(editor.eventRoot=DOM$2.select(eventRoot)[0]),editor.eventRoot):editor.getBody()},fireEvent=function(editor,eventName,e){!function(editor){return!editor.hidden&&!isReadOnly(editor)}(editor)?isReadOnly(editor)&&processReadonlyEvents(editor,e):editor.fire(eventName,e)},bindEventDelegate=function(editor,eventName){var delegate;if(editor.delegates||(editor.delegates={}),!editor.delegates[eventName]&&!editor.removed){var eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",(function(){editor.editorManager.activeEditor||customEventRootDelegates&&(each$j(customEventRootDelegates,(function(_value,name){editor.dom.unbind(getEventTarget(editor,name))})),customEventRootDelegates=null)}))),customEventRootDelegates[eventName])return;delegate=function(e){for(var target=e.target,editors=editor.editorManager.get(),i=editors.length;i--;){var body=editors[i].getBody();(body===target||DOM$2.isChildOf(target,body))&&fireEvent(editors[i],eventName,e)}},customEventRootDelegates[eventName]=delegate,DOM$2.bind(eventRootElm,eventName,delegate)}else delegate=function(e){fireEvent(editor,eventName,e)},DOM$2.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}},EditorObservable=__assign(__assign({},Observable),{bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,(function(name){bindEventDelegate(self,name)}))},toggleNativeEvent:function(name,state){"focus"!==name&&"blur"!==name&&(this.removed||(state?this.initialized?bindEventDelegate(this,name):this._pendingNativeEvents?this._pendingNativeEvents.push(name):this._pendingNativeEvents=[name]:this.initialized&&(this.dom.unbind(getEventTarget(this,name),name,this.delegates[name]),delete this.delegates[name])))},unbindAllNativeEvents:function(){var self=this,body=self.getBody(),dom=self.dom;self.delegates&&(each$j(self.delegates,(function(value,name){self.dom.unbind(getEventTarget(self,name),name,value)})),delete self.delegates),!self.inline&&body&&dom&&(body.onload=null,dom.unbind(self.getWin()),dom.unbind(self.getDoc())),dom&&(dom.unbind(body),dom.unbind(self.getContainer()))}}),defaultModes=["design","readonly"],switchToMode=function(editor,activeMode,availableModes,mode){var oldMode=availableModes[activeMode.get()],newMode=availableModes[mode];try{newMode.activate()}catch(e){return void console.error("problem while activating editor mode "+mode+":",e)}oldMode.deactivate(),oldMode.editorReadOnly!==newMode.editorReadOnly&&toggleReadOnly(editor,newMode.editorReadOnly),activeMode.set(mode),function(editor,mode){editor.fire("SwitchMode",{mode:mode})}(editor,mode)},create$4=function(editor){var activeMode=Cell("design"),availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:!1},readonly:{activate:noop,deactivate:noop,editorReadOnly:!0}});return function(editor){editor.serializer?registerFilters(editor):editor.on("PreInit",(function(){registerFilters(editor)}))}(editor),function(editor){editor.on("ShowCaret",(function(e){isReadOnly(editor)&&e.preventDefault()})),editor.on("ObjectSelected",(function(e){isReadOnly(editor)&&e.preventDefault()}))}(editor),{isReadOnly:function(){return isReadOnly(editor)},set:function(mode){return function(editor,availableModes,activeMode,mode){if(mode!==activeMode.get()){if(!has$2(availableModes,mode))throw new Error("Editor mode '"+mode+"' is invalid");editor.initialized?switchToMode(editor,activeMode,availableModes,mode):editor.on("init",(function(){return switchToMode(editor,activeMode,availableModes,mode)}))}}(editor,availableModes.get(),activeMode,mode)},get:function(){return activeMode.get()},register:function(mode,api){availableModes.set(function(availableModes,mode,api){var _a;if(contains$3(defaultModes,mode))throw new Error("Cannot override default mode "+mode);return __assign(__assign({},availableModes),((_a={})[mode]=__assign(__assign({},api),{deactivate:function(){try{api.deactivate()}catch(e){console.error("problem while deactivating editor mode "+mode+":",e)}}}),_a))}(availableModes.get(),mode,api))}}},each$3=Tools.each,explode$1=Tools.explode,keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access"),parseShortcut=function(pattern){var key,shortcut={};each$3(explode$1(pattern.toLowerCase(),"+"),(function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}));var id=[shortcut.keyCode];for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut},Shortcuts=function(){function Shortcuts(editor){this.shortcuts={},this.pendingPatterns=[],this.editor=editor;var self=this;editor.on("keyup keypress keydown",(function(e){!self.hasModifier(e)&&!self.isFunctionKey(e)||e.isDefaultPrevented()||(each$3(self.shortcuts,(function(shortcut){if(self.matchShortcut(e,shortcut))return self.pendingPatterns=shortcut.subpatterns.slice(0),"keydown"===e.type&&self.executeShortcutAction(shortcut),!0})),self.matchShortcut(e,self.pendingPatterns[0])&&(1===self.pendingPatterns.length&&"keydown"===e.type&&self.executeShortcutAction(self.pendingPatterns[0]),self.pendingPatterns.shift()))}))}return Shortcuts.prototype.add=function(pattern,desc,cmdFunc,scope){var self=this,func=self.normalizeCommandFunc(cmdFunc);return each$3(explode$1(Tools.trim(pattern)),(function(pattern){var shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut})),!0},Shortcuts.prototype.remove=function(pattern){var shortcut=this.createShortcut(pattern);return!!this.shortcuts[shortcut.id]&&(delete this.shortcuts[shortcut.id],!0)},Shortcuts.prototype.normalizeCommandFunc=function(cmdFunc){var self=this,cmd=cmdFunc;return"string"==typeof cmd?function(){self.editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)?function(){self.editor.execCommand(cmd[0],cmd[1],cmd[2])}:cmd},Shortcuts.prototype.createShortcut=function(pattern,desc,cmdFunc,scope){var shortcuts=Tools.map(explode$1(pattern,">"),parseShortcut);return shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor}),Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)})},Shortcuts.prototype.hasModifier=function(e){return e.altKey||e.ctrlKey||e.metaKey},Shortcuts.prototype.isFunctionKey=function(e){return"keydown"===e.type&&e.keyCode>=112&&e.keyCode<=123},Shortcuts.prototype.matchShortcut=function(e,shortcut){return!!shortcut&&(shortcut.ctrl===e.ctrlKey&&shortcut.meta===e.metaKey&&(shortcut.alt===e.altKey&&shortcut.shift===e.shiftKey&&(!!(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode)&&(e.preventDefault(),!0))))},Shortcuts.prototype.executeShortcutAction=function(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null},Shortcuts}(),registry=function(){var bridge=function(){var buttons={},menuItems={},popups={},icons={},contextMenus={},contextToolbars={},sidebars={},add=function(collection,type){return function(name,spec){return collection[name.toLowerCase()]=__assign(__assign({},spec),{type:type})}};return{addButton:add(buttons,"button"),addGroupToolbarButton:add(buttons,"grouptoolbarbutton"),addToggleButton:add(buttons,"togglebutton"),addMenuButton:add(buttons,"menubutton"),addSplitButton:add(buttons,"splitbutton"),addMenuItem:add(menuItems,"menuitem"),addNestedMenuItem:add(menuItems,"nestedmenuitem"),addToggleMenuItem:add(menuItems,"togglemenuitem"),addAutocompleter:add(popups,"autocompleter"),addContextMenu:add(contextMenus,"contextmenu"),addContextToolbar:add(contextToolbars,"contexttoolbar"),addContextForm:add(contextToolbars,"contextform"),addSidebar:add(sidebars,"sidebar"),addIcon:function(name,svgData){return icons[name.toLowerCase()]=svgData},getAll:function(){return{buttons:buttons,menuItems:menuItems,icons:icons,popups:popups,contextMenus:contextMenus,contextToolbars:contextToolbars,sidebars:sidebars}}}}();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,getAll:bridge.getAll}},DOM$1=DOMUtils.DOM,extend$3=Tools.extend,each$2=Tools.each,resolve=Tools.resolve,ie=Env.ie,Editor=function(){function Editor(id,settings,editorManager){var _this=this;this.plugins={},this.contentCSS=[],this.contentStyles=[],this.loadedCSS={},this.isNotDirty=!1,this.editorManager=editorManager,this.documentBaseUrl=editorManager.documentBaseURL,extend$3(this,EditorObservable),this.settings=getEditorSettings(this,id,this.documentBaseUrl,editorManager.defaultSettings,settings),this.settings.suffix&&(editorManager.suffix=this.settings.suffix),this.suffix=editorManager.suffix,this.settings.base_url&&editorManager._setBaseUrl(this.settings.base_url),this.baseUri=editorManager.baseURI,this.settings.referrer_policy&&(ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy),DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy)),AddOnManager.languageLoad=this.settings.language_load,AddOnManager.baseURL=editorManager.baseURL,this.id=id,this.setDirty(!1),this.documentBaseURI=new URI(this.settings.document_base_url,{base_uri:this.baseUri}),this.baseURI=this.baseUri,this.inline=!!this.settings.inline,this.shortcuts=new Shortcuts(this),this.editorCommands=new EditorCommands(this),this.settings.cache_suffix&&(Env.cacheSuffix=this.settings.cache_suffix.replace(/^[\?\&]+/,"")),this.ui={registry:registry(),styleSheetLoader:void 0,show:noop,hide:noop,enable:noop,disable:noop,isDisabled:never};var modeInstance=create$4(this);this.mode=modeInstance,this.setMode=modeInstance.set,editorManager.fire("SetupEditor",{editor:this}),this.execCallback("setup",this),this.$=DomQuery.overrideDefaults((function(){return{context:_this.inline?_this.getBody():_this.getDoc(),element:_this.getBody()}}))}return Editor.prototype.render=function(){render(this)},Editor.prototype.focus=function(skipFocus){this.execCommand("mceFocus",!1,skipFocus)},Editor.prototype.hasFocus=function(){return hasFocus(this)},Editor.prototype.execCallback=function(name){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var scope,self=this,callback=self.settings[name];if(callback)return self.callbackLookup&&(scope=self.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=(scope=callback.replace(/\.\w+$/,""))?resolve(scope):0,callback=resolve(callback),self.callbackLookup=self.callbackLookup||{},self.callbackLookup[name]={func:callback,scope:scope}),callback.apply(scope||self,x)},Editor.prototype.translate=function(text){return I18n.translate(text)},Editor.prototype.getParam=function(name,defaultVal,type){return getParam(this,name,defaultVal,type)},Editor.prototype.hasPlugin=function(name,loaded){return!!contains$3(getPlugins(this).split(/[ ,]/),name)&&(!loaded||void 0!==PluginManager.get(name))},Editor.prototype.nodeChanged=function(args){this._nodeChangeDispatcher.nodeChanged(args)},Editor.prototype.addCommand=function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},Editor.prototype.addQueryStateHandler=function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},Editor.prototype.addQueryValueHandler=function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},Editor.prototype.addShortcut=function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},Editor.prototype.execCommand=function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},Editor.prototype.queryCommandState=function(cmd){return this.editorCommands.queryCommandState(cmd)},Editor.prototype.queryCommandValue=function(cmd){return this.editorCommands.queryCommandValue(cmd)},Editor.prototype.queryCommandSupported=function(cmd){return this.editorCommands.queryCommandSupported(cmd)},Editor.prototype.show=function(){this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable="true":(DOM$1.show(this.getContainer()),DOM$1.hide(this.id)),this.load(),this.fire("show"))},Editor.prototype.hide=function(){var doc=this.getDoc();this.hidden||(ie&&doc&&!this.inline&&doc.execCommand("SelectAll"),this.save(),this.inline?(this.getBody().contentEditable="false",this===this.editorManager.focusedEditor&&(this.editorManager.focusedEditor=null)):(DOM$1.hide(this.getContainer()),DOM$1.setStyle(this.id,"display",this.orgDisplay)),this.hidden=!0,this.fire("hide"))},Editor.prototype.isHidden=function(){return!!this.hidden},Editor.prototype.setProgressState=function(state,time){this.fire("ProgressState",{state:state,time:time})},Editor.prototype.load=function(args){var html,elm=this.getElement();if(this.removed)return"";if(elm){(args=args||{}).load=!0;var value=isTextareaOrInput(elm)?elm.value:elm.innerHTML;return html=this.setContent(value,args),args.element=elm,args.no_events||this.fire("LoadContent",args),args.element=elm=null,html}},Editor.prototype.save=function(args){var html,form,self=this,elm=self.getElement();if(elm&&self.initialized&&!self.removed)return(args=args||{}).save=!0,args.element=elm,args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"===args.format&&self.fire("RawSaveContent",args),html=args.content,isTextareaOrInput(elm)?elm.value=html:(!args.is_removing&&self.inline||(elm.innerHTML=html),(form=DOM$1.getParent(self.id,"form"))&&each$2(form.elements,(function(elm){if(elm.name===self.id)return elm.value=html,!1}))),args.element=elm=null,!1!==args.set_dirty&&self.setDirty(!1),html},Editor.prototype.setContent=function(content,args){return setContent(this,content,args)},Editor.prototype.getContent=function(args){return getContent(this,args)},Editor.prototype.insertContent=function(content,args){args&&(content=extend$3({content:content},args)),this.execCommand("mceInsertContent",!1,content)},Editor.prototype.resetContent=function(initialContent){void 0===initialContent?setContent(this,this.startContent,{format:"raw"}):setContent(this,initialContent),this.undoManager.reset(),this.setDirty(!1),this.nodeChanged()},Editor.prototype.isDirty=function(){return!this.isNotDirty},Editor.prototype.setDirty=function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!==oldState&&this.fire("dirty")},Editor.prototype.getContainer=function(){return this.container||(this.container=DOM$1.get(this.editorContainer||this.id+"_parent")),this.container},Editor.prototype.getContentAreaContainer=function(){return this.contentAreaContainer},Editor.prototype.getElement=function(){return this.targetElm||(this.targetElm=DOM$1.get(this.id)),this.targetElm},Editor.prototype.getWin=function(){var elm;return this.contentWindow||(elm=this.iframeElement)&&(this.contentWindow=elm.contentWindow),this.contentWindow},Editor.prototype.getDoc=function(){var win;return this.contentDocument||(win=this.getWin())&&(this.contentDocument=win.document),this.contentDocument},Editor.prototype.getBody=function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null)},Editor.prototype.convertURL=function(url,name,elm){var settings=this.settings;return settings.urlconverter_callback?this.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"===elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?this.documentBaseURI.toRelative(url):url=this.documentBaseURI.toAbsolute(url,settings.remove_script_host)},Editor.prototype.addVisual=function(elm){addVisual(this,elm)},Editor.prototype.remove=function(){remove(this)},Editor.prototype.destroy=function(automatic){destroy(this,automatic)},Editor.prototype.uploadImages=function(callback){return this.editorUpload.uploadImages(callback)},Editor.prototype._scanForImages=function(){return this.editorUpload.scanForImages()},Editor.prototype.addButton=function(){throw new Error("editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead")},Editor.prototype.addSidebar=function(){throw new Error("editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead")},Editor.prototype.addMenuItem=function(){throw new Error("editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead")},Editor.prototype.addContextToolbar=function(){throw new Error("editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead")},Editor}(),DOM=DOMUtils.DOM,explode=Tools.explode,each$1=Tools.each,extend$2=Tools.extend,instanceCounter=0,boundGlobalEvents=!1,legacyEditors=[],editors=[],globalEventDelegate=function(e){var type=e.type;each$1(EditorManager.get(),(function(editor){switch(type){case"scroll":editor.fire("ScrollWindow",e);break;case"resize":editor.fire("ResizeWindow",e)}}))},toggleGlobalEvents=function(state){state!==boundGlobalEvents&&(state?DomQuery(window).on("resize scroll",globalEventDelegate):DomQuery(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)},removeEditorFromList=function(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++)if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break}return editors=filter$4(editors,(function(editor){return targetEditor!==editor})),EditorManager.activeEditor===targetEditor&&(EditorManager.activeEditor=editors.length>0?editors[0]:null),EditorManager.focusedEditor===targetEditor&&(EditorManager.focusedEditor=null),oldEditors.length!==editors.length},isQuirksMode="CSS1Compat"!==document.compatMode,EditorManager=__assign(__assign({},Observable),{baseURI:null,baseURL:null,defaultSettings:{},documentBaseURL:null,suffix:null,$:DomQuery,majorVersion:"5",minorVersion:"10.4",releaseDate:"2022-04-27",editors:legacyEditors,i18n:I18n,activeEditor:null,focusedEditor:null,settings:{},setup:function(){var baseURL,documentBaseURL,suffix="";documentBaseURL=URI.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/"));var editorManager,preInit=window.tinymce||window.tinyMCEPreInit;if(preInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++){var src;if(""!==(src=scripts[i].src||"")){var srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!==srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}}if(!baseURL&&document.currentScript)-1!==(src=document.currentScript.src).indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"))}this.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),this.documentBaseURL=documentBaseURL,this.baseURI=new URI(this.baseURL),this.suffix=suffix,(editorManager=this).on("AddEditor",curry(registerEvents$1,editorManager)),editorManager.on("RemoveEditor",curry(unregisterDocumentEvents,editorManager))},overrideDefaults:function(defaultSettings){var baseUrl=defaultSettings.base_url;baseUrl&&this._setBaseUrl(baseUrl);var suffix=defaultSettings.suffix;defaultSettings.suffix&&(this.suffix=suffix),this.defaultSettings=defaultSettings;var pluginBaseUrls=defaultSettings.plugin_base_urls;void 0!==pluginBaseUrls&&each$j(pluginBaseUrls,(function(pluginBaseUrl,pluginName){AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl}))},init:function(settings){var result,self=this,invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu"," "),createId=function(elm){var id=elm.id;return id||(id=get$9(elm,"name").filter((function(name){return!DOM.get(name)})).getOrThunk(DOM.uniqueId),elm.setAttribute("id",id)),id},hasClass=function(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)},provideResults=function(editors){result=editors},initEditors=function(){var targets,initCount=0,editors=[],createEditor=function(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor),editor.on("init",(function(){++initCount===targets.length&&provideResults(editors)})),editor.targetElm=editor.targetElm||targetElm,editor.render()};DOM.unbind(window,"ready",initEditors),function(name){var callback=settings[name];if(callback)callback.apply(self,[])}("onpageload"),targets=DomQuery.unique(function(settings){var targets=[];if(Env.browser.isIE()&&Env.browser.version.major<11)return initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(isQuirksMode)return initError("Failed to initialize the editor as the document is not in standards mode. TinyMCE requires standards mode."),[];if(settings.types)return each$1(settings.types,(function(type){targets=targets.concat(DOM.select(type.selector))})),targets;if(settings.selector)return DOM.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":var l=settings.elements||"";l.length>0&&each$1(explode(l),(function(id){var elm=DOM.get(id);elm?targets.push(elm):each$1(document.forms,(function(f){each$1(f.elements,(function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM.setAttrib(e,"id",id),targets.push(e))}))}))}));break;case"textareas":case"specific_textareas":each$1(DOM.select("textarea"),(function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)}))}return targets}(settings)),settings.types?each$1(settings.types,(function(type){Tools.each(targets,(function(elm){return!DOM.is(elm,type.selector)||(createEditor(createId(elm),extend$2({},settings,type),elm),!1)}))})):(Tools.each(targets,(function(elm){var editor;(editor=self.get(elm.id))&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0,editor=null)})),0===(targets=Tools.grep(targets,(function(elm){return!self.get(elm.id)}))).length?provideResults([]):each$1(targets,(function(elm){!function(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets}(settings,elm)?createEditor(createId(elm),settings,elm):initError("Could not initialize inline editor on invalid inline target element",elm)})))};return self.settings=settings,DOM.bind(window,"ready",initEditors),new promiseObj((function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}}))},get:function(id){return 0===arguments.length?editors.slice(0):isString$1(id)?find$3(editors,(function(editor){return editor.id===id})).getOr(null):isNumber(id)&&editors[id]?editors[id]:null},add:function(editor){var self=this;return legacyEditors[editor.id]===editor||(null===self.get(editor.id)&&("length"!==editor.id&&(legacyEditors[editor.id]=editor),legacyEditors.push(editor),editors.push(editor)),toggleGlobalEvents(!0),self.activeEditor=editor,self.fire("AddEditor",{editor:editor}),beforeUnloadDelegate||(beforeUnloadDelegate=function(e){var event=self.fire("BeforeUnload");if(event.returnValue)return e.preventDefault(),e.returnValue=event.returnValue,event.returnValue},window.addEventListener("beforeunload",beforeUnloadDelegate))),editor},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var i,editor,self=this;if(selector){if(!isString$1(selector))return editor=selector,isNull(self.get(editor.id))?null:(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor:editor}),0===editors.length&&window.removeEventListener("beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(editors.length>0),editor);each$1(DOM.select(selector),(function(elm){(editor=self.get(elm.id))&&self.remove(editor)}))}else for(i=editors.length-1;i>=0;i--)self.remove(editors[i])},execCommand:function(cmd,ui,value){var editor=this.get(value);switch(cmd){case"mceAddEditor":return this.get(value)||new Editor(value,this.settings,this).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(this.execCommand("mceAddEditor",!1,value),!0)}return!!this.activeEditor&&this.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each$1(editors,(function(editor){editor.save()}))},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!==editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor},_setBaseUrl:function(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)}});EditorManager.setup();var tasks,resultFns,extendClass,initializing,min$1=Math.min,max$1=Math.max,round$1=Math.round,relativePosition=function(rect,targetRect,rel){var x=targetRect.x,y=targetRect.y,w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,relChars=(rel||"").split("");return"b"===relChars[0]&&(y+=targetH),"r"===relChars[1]&&(x+=targetW),"c"===relChars[0]&&(y+=round$1(targetH/2)),"c"===relChars[1]&&(x+=round$1(targetW/2)),"b"===relChars[3]&&(y-=h),"r"===relChars[4]&&(x-=w),"c"===relChars[3]&&(y-=round$1(h/2)),"c"===relChars[4]&&(x-=round$1(w/2)),create$2(x,y,w,h)},create$2=function(x,y,w,h){return{x:x,y:y,w:w,h:h}},Rect={inflate:function(rect,w,h){return create$2(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h)},relativePosition:relativePosition,findBestRelativePosition:function(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++)if((pos=relativePosition(rect,targetRect,rels[i])).x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null},intersect:function(rect,cropRect){var x1=max$1(rect.x,cropRect.x),y1=max$1(rect.y,cropRect.y),x2=min$1(rect.x+rect.w,cropRect.x+cropRect.w),y2=min$1(rect.y+rect.h,cropRect.y+cropRect.h);return x2-x1<0||y2-y1<0?null:create$2(x1,y1,x2-x1,y2-y1)},clamp:function(rect,clampRect,fixedSize){var x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max$1(0,clampRect.x-x1),underflowY1=max$1(0,clampRect.y-y1),overflowX2=max$1(0,x2-cx2),overflowY2=max$1(0,y2-cy2);return x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),create$2(x1,y1,(x2-=overflowX2)-x1,(y2-=overflowY2)-y1)},create:create$2,fromClientRect:function(clientRect){return create$2(clientRect.left,clientRect.top,clientRect.width,clientRect.height)}},Resource=(tasks={},resultFns={},{load:function(id,url){var loadErrMsg='Script at URL "'+url+'" failed to load',runErrMsg='Script at URL "'+url+"\" did not call `tinymce.Resource.add('"+id+"', data)` within 1 second";if(void 0!==tasks[id])return tasks[id];var task=new promiseObj((function(resolve,reject){var waiter=function(resolveCb,rejectCb,timeout){void 0===timeout&&(timeout=1e3);var done=!1,timer=null,complete=function(completer){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||(done=!0,null!==timer&&(clearTimeout(timer),timer=null),completer.apply(null,args))}},resolve=complete(resolveCb),reject=complete(rejectCb);return{start:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||null!==timer||(timer=setTimeout((function(){return reject.apply(null,args)}),timeout))},resolve:resolve,reject:reject}}(resolve,reject);resultFns[id]=waiter.resolve,ScriptLoader.ScriptLoader.loadScript(url,(function(){return waiter.start(runErrMsg)}),(function(){return waiter.reject(loadErrMsg)}))}));return tasks[id]=task,task},add:function(id,data){void 0!==resultFns[id]&&(resultFns[id](data),delete resultFns[id]),tasks[id]=promiseObj.resolve(data)}}),each=Tools.each,extend$1=Tools.extend,Class=function(){};Class.extend=extendClass=function(props){var _super=this.prototype,Class=function(){var i,mixins,mixin,self=this;if(!initializing&&(self.init&&self.init.apply(self,arguments),mixins=self.Mixins))for(i=mixins.length;i--;)(mixin=mixins[i]).init&&mixin.init.apply(self,arguments)},dummy=function(){return this};initializing=!0;var prototype=new this;return initializing=!1,props.Mixins&&(each(props.Mixins,(function(mixin){for(var name_1 in mixin)"init"!==name_1&&(props[name_1]=mixin[name_1])})),_super.Mixins&&(props.Mixins=_super.Mixins.concat(props.Mixins))),props.Methods&&each(props.Methods.split(","),(function(name){props[name]=dummy})),props.Properties&&each(props.Properties.split(","),(function(name){var fieldName="_"+name;props[name]=function(value){return void 0!==value?(this[fieldName]=value,this):this[fieldName]}})),props.Statics&&each(props.Statics,(function(func,name){Class[name]=func})),props.Defaults&&_super.Defaults&&(props.Defaults=extend$1({},_super.Defaults,props.Defaults)),each$j(props,(function(member,name){"function"==typeof member&&_super[name]?prototype[name]=function(name,fn){return function(){var self=this,tmp=self._super;self._super=_super[name];var ret=fn.apply(self,arguments);return self._super=tmp,ret}}(name,member):prototype[name]=member})),Class.prototype=prototype,Class.constructor=Class,Class.extend=extendClass,Class};var localStorage,min=Math.min,max=Math.max,round=Math.round,JSONUtils={serialize:function(obj){var data=JSON.stringify(obj);return isString$1(data)?data.replace(/[\u0080-\uFFFF]/g,(function(match){var hexCode=match.charCodeAt(0).toString(16);return"\\u"+"0000".substring(hexCode.length)+hexCode})):data},parse:function(text){try{return JSON.parse(text)}catch(ex){}}},JSONP={callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=void 0!==settings.count?settings.count:self.count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"}),self.count++}},XHR=__assign(__assign({},Observable),{send:function(settings){var xhr,count=0,ready=function(){!settings.async||4===xhr.readyState||count++>1e4?(settings.success&&count<1e4&&200===xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,count>1e4?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):Delay.setTimeout(ready,10)};if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=!1!==settings.async,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings:settings}),(xhr=new XMLHttpRequest).overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,(function(header){xhr.setRequestHeader(header.key,header.value)})),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),(xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr).send(settings.data),!settings.async)return ready();Delay.setTimeout(ready,10)}}),extend=Tools.extend,JSONRequest=function(){function JSONRequest(settings){this.settings=extend({},settings),this.count=0}return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype.send=function(args){var ecb=args.error,scb=args.success,xhrArgs=extend(this.settings,args);xhrArgs.success=function(c,x){void 0===(c=JSONUtils.parse(c))&&(c={error:"JSON Parse error."}),c.error?ecb.call(xhrArgs.error_scope||xhrArgs.scope,c.error,x):scb.call(xhrArgs.success_scope||xhrArgs.scope,c.result)},xhrArgs.error=function(ty,x){ecb&&ecb.call(xhrArgs.error_scope||xhrArgs.scope,ty,x)},xhrArgs.data=JSONUtils.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),xhrArgs.content_type="application/json",XHR.send(xhrArgs)},JSONRequest}();try{var test="__storage_test__";(localStorage=window.localStorage).setItem(test,test),localStorage.removeItem(test)}catch(e){localStorage=function(){var data={},keys=[],storage={getItem:function(key){return data[key]||null},setItem:function(key,value){keys.push(key),data[key]=String(value)},key:function(index){return keys[index]},removeItem:function(key){keys=keys.filter((function(k){return k===key})),delete data[key]},clear:function(){keys=[],data={}},length:0};return Object.defineProperty(storage,"length",{get:function(){return keys.length},configurable:!1,enumerable:!1}),storage}()}var publicApi={geom:{Rect:Rect},util:{Promise:promiseObj,Delay:Delay,Tools:Tools,VK:VK,URI:URI,Class:Class,EventDispatcher:EventDispatcher,Observable:Observable,I18n:I18n,XHR:XHR,JSON:JSONUtils,JSONRequest:JSONRequest,JSONP:JSONP,LocalStorage:localStorage,Color:function(value){var self={},r=0,g=0,b=0,parse=function(value){var matches;return"object"==typeof value?"r"in value?(r=value.r,g=value.g,b=value.b):"v"in value&&function(hue,saturation,brightness){if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0!==saturation){var side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round(255*(r+match)),g=round(255*(g+match)),b=round(255*(b+match))}else r=g=b=round(255*brightness)}(value.h,value.s,value.v):(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16)),r=r<0?0:r>255?255:r,g=g<0?0:g>255?255:g,b=b<0?0:b>255?255:b,self};return value&&parse(value),self.toRgb=function(){return{r:r,g:g,b:b}},self.toHsv=function(){return function(r,g,b){var s,v;v=0;var minRGB=min(r/=255,min(g/=255,b/=255)),maxRGB=max(r,max(g,b));return minRGB===maxRGB?{h:0,s:0,v:100*(v=minRGB)}:(s=(maxRGB-minRGB)/maxRGB,v=maxRGB,{h:round(60*((r===minRGB?3:b===minRGB?1:5)-(r===minRGB?g-b:b===minRGB?r-g:b-r)/(maxRGB-minRGB))),s:round(100*s),v:round(100*v)})}(r,g,b)},self.toHex=function(){var hex=function(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val};return"#"+hex(r)+hex(g)+hex(b)},self.parse=parse,self},ImageUploader:function(editor){var uploadStatus=UploadStatus(),uploader=createUploader(editor,uploadStatus);return{upload:function(blobInfos,showNotification){return void 0===showNotification&&(showNotification=!0),uploader.upload(blobInfos,showNotification?openNotification(editor):void 0)}}}},dom:{EventUtils:EventUtils,Sizzle:Sizzle,DomQuery:DomQuery,TreeWalker:DomTreeWalker,TextSeeker:TextSeeker,DOMUtils:DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,StyleSheetLoader:StyleSheetLoader,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:AstNode,Schema:Schema,SaxParser:SaxParser,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},Env:Env,AddOnManager:AddOnManager,Annotator:Annotator,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:PluginManager,ThemeManager:ThemeManager,IconManager:IconManager,Resource:Resource,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac},tinymce=Tools.extend(EditorManager,publicApi);!function(tinymce){window.tinymce=tinymce,window.tinyMCE=tinymce}(tinymce),function(tinymce){if("object"==typeof module)try{module.exports=tinymce}catch(_){}}(tinymce)}(),function(){"use strict";var isType$1=function(type){return function(value){return function(x){var t=typeof x;return null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t}(value)===type}},isSimpleType=function(type){return function(value){return typeof value===type}},eq$1=function(t){return function(a){return t===a}},isString=isType$1("string"),isObject=isType$1("object"),isArray=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),isArrayOf=function(value,pred){if(isArray(value)){for(var i=0,len=value.length;i<len;++i)if(!pred(value[i]))return!1;return!0}return!1},noop=function(){},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},constant$1=function(value){return function(){return value}},identity$1=function(x){return x},tripleEquals=function(a,b){return a===b};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var not=function(f){return function(t){return!f(t)}},die=function(msg){return function(){throw new Error(msg)}},never=constant$1(!1),always=constant$1(!0),global$g=tinymce.util.Tools.resolve("tinymce.ThemeManager"),__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}var call,id,none=function(){return NONE},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity$1,getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant$1(null),getOrUndefined:constant$1(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant$1("none()")},some=function(a){var constant_a=constant$1(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},contains$2=function(xs,x){return rawIndexOf(xs,x)>-1},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return!0}return!1},range$2=function(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r},chunk$1=function(array,size){for(var r=[],i=0;i<array.length;i+=size){var s=nativeSlice.call(array,i,i+size);r.push(s)}return r},map$2=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$1=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i)}},partition$3=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter$2=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return function(xs,f){for(var i=xs.length-1;i>=0;i--)f(xs[i],i)}(xs,(function(x,i){acc=f(acc,x,i)})),acc},foldl=function(xs,f,acc){return each$1(xs,(function(x,i){acc=f(acc,x,i)})),acc},find$5=function(xs,pred){return function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()}(xs,pred,never)},findIndex$1=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind$3=function(xs,f){return flatten(map$2(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){if(!0!==pred(xs[i],i))return!1}return!0},reverse=function(xs){var r=nativeSlice.call(xs,0);return r.reverse(),r},difference=function(a1,a2){return filter$2(a1,(function(x){return!contains$2(a2,x)}))},mapToObject=function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},pure$2=function(x){return[x]},sort=function(xs,comparator){var copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy},get$f=function(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get$f(xs,0)},last$2=function(xs){return get$f(xs,xs.length-1)},from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,each=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},map$1=function(obj,f){return tupleMap(obj,(function(x,i){return{k:i,v:f(x,i)}}))},tupleMap=function(obj,f){var r={};return each(obj,(function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v})),r},filter$1=function(obj,pred){var t={};return function(obj,pred,onTrue,onFalse){each(obj,(function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)}))}(obj,pred,function(r){return function(x,i){r[i]=x}}(t),noop),t},mapToArray=function(obj,f){var r=[];return each(obj,(function(value,name){r.push(f(value,name))})),r},find$4=function(obj,pred){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x=obj[i];if(pred(x,i,obj))return Optional.some(x)}return Optional.none()},values=function(obj){return mapToArray(obj,identity$1)},get$e=function(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none()},has$2=function(obj,key){return hasOwnProperty.call(obj,key)},hasNonNullableKey=function(obj,key){return has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key]},is$1=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists((function(left){return comparator(left,rhs)}))},cat=function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},someIf=function(b,a){return b?Optional.some(a):Optional.none()},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},contains$1=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return checkRange(str,prefix,0)},endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length)},trim$1=function(r){return function(s){return s.replace(r,"")}}(/^\s+|\s+$/g),isNotEmpty=function(s){return s.length>0},isSupported$1=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},fromDom=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},SugarElement={fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom(node)},fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}};"undefined"!=typeof window?window:Function("return this;")();var SimpleResultType,name$2=function(element){return element.dom.nodeName.toLowerCase()},isType=function(t){return function(element){return function(element){return element.dom.nodeType}(element)===t}},isElement$2=isType(1),isText$1=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),cached=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},unknown$3=function(){return nu$d(0,0)},nu$d=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$d,detect:function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown$3():function(regexes,agent){var r=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}}(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu$d(group(1),group(2))}(versionRegexes,cleanedAgent)},unknown:unknown$3},detect$3=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$5(candidates,(function(candidate){return candidate.search(agent)}))},normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return contains$1(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant$1(browsers),oses:constant$1(oses)},nu$c=function(info){var current=info.current,version=info.version,isBrowser=function(name){return function(){return current===name}};return{current:current,version:version,isEdge:isBrowser("Edge"),isChrome:isBrowser("Chrome"),isIE:isBrowser("IE"),isOpera:isBrowser("Opera"),isFirefox:isBrowser("Firefox"),isSafari:isBrowser("Safari")}},Browser={unknown:function(){return nu$c({current:void 0,version:Version.unknown()})},nu:nu$c,edge:constant$1("Edge"),chrome:constant$1("Chrome"),ie:constant$1("IE"),opera:constant$1("Opera"),firefox:constant$1("Firefox"),safari:constant$1("Safari")},nu$b=function(info){var current=info.current,version=info.version,isOS=function(name){return function(){return current===name}};return{current:current,version:version,isWindows:isOS("Windows"),isiOS:isOS("iOS"),isAndroid:isOS("Android"),isOSX:isOS("OSX"),isLinux:isOS("Linux"),isSolaris:isOS("Solaris"),isFreeBSD:isOS("FreeBSD"),isChromeOS:isOS("ChromeOS")}},OperatingSystem={unknown:function(){return nu$b({current:void 0,version:Version.unknown()})},nu:nu$b,windows:constant$1("Windows"),ios:constant$1("iOS"),android:constant$1("Android"),linux:constant$1("Linux"),osx:constant$1("OSX"),solaris:constant$1("Solaris"),freebsd:constant$1("FreeBSD"),chromeos:constant$1("ChromeOS")},PlatformDetection_detect=function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=userAgentDataOpt.bind((function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,(function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$5(browsers,(function(browser){var _a;return lcBrand===(null===(_a=browser.brand)||void 0===_a?void 0:_a.toLowerCase())})).map((function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}}))}))}(browsers,userAgentData)})).orThunk((function(){return function(browsers,userAgent){return detect$3(browsers,userAgent).map((function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}}))}(browsers,userAgent)})).fold(Browser.unknown,Browser.nu),os=function(oses,userAgent){return detect$3(oses,userAgent).map((function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}}))}(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant$1(isiPad),isiPhone:constant$1(isiPhone),isTablet:constant$1(isTablet),isPhone:constant$1(isPhone),isTouch:constant$1(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant$1(iOSwebview),isDesktop:constant$1(isDesktop)}}(os,browser,userAgent,mediaMatch);return{browser:browser,os:os,deviceType:deviceType}},mediaMatch=function(query){return window.matchMedia(query).matches},platform=cached((function(){return PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)})),detect$1=function(){return platform()},is=function(element,selector){var dom=element.dom;if(1!==dom.nodeType)return!1;var elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},bypassSelector=function(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount},eq=function(e1,e2){return e1.dom===e2.dom},ieContains=function(e1,e2){return function(a,b){return function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY)}(e1.dom,e2.dom)},contains=function(e1,e2){return detect$1().browser.isIE()?ieContains(e1,e2):function(e1,e2){var d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)}(e1,e2)},owner$4=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument(dos)?dos:owner$4(dos)},documentElement=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement)},defaultView=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},offsetParent=function(element){return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom)},children=function(element){return map$2(element.dom.childNodes,SugarElement.fromDom)},child$2=function(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},spot=function(element,offset){return{element:element,offset:offset}},leaf=function(element,offset){var cs=children(element);return cs.length>0&&offset<cs.length?spot(cs[offset],0):spot(element,offset)},isShadowRoot=function(dos){return isDocumentFragment(dos)&&isNonNullable(dos.dom.host)},supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported=constant$1(supported),getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getContentContainer=function(dos){return isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body)},getShadowRoot=function(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none()},getShadowHost=function(e){return SugarElement.fromDom(e.dom.host)},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},inBody=function(element){var dom=isText$1(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var fbc,fab,doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold((function(){return doc.body.contains(dom)}),(fbc=inBody,fab=getShadowHost,function(a){return fbc(fab(a))}))},body=function(){return getBody(SugarElement.fromDom(document))},getBody=function(doc){var b=doc.dom.body;if(null==b)throw new Error("Body is not available yet");return SugarElement.fromDom(b)},rawSet=function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$8=function(element,key,value){rawSet(element.dom,key,value)},setAll$1=function(element,attrs){var dom=element.dom;each(attrs,(function(v,k){rawSet(dom,k,v)}))},get$d=function(element,key){var v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=function(element,key){return Optional.from(get$d(element,key))},has$1=function(element,key){var dom=element.dom;return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)},remove$7=function(element,key){element.dom.removeAttribute(key)},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported$1(dom)&&dom.style.setProperty(property,value)},internalRemove=function(dom,property){isSupported$1(dom)&&dom.style.removeProperty(property)},set$7=function(element,property,value){var dom=element.dom;internalSet(dom,property,value)},setAll=function(element,css){var dom=element.dom;each(css,(function(v,k){internalSet(dom,k,v)}))},setOptions=function(element,css){var dom=element.dom;each(css,(function(v,k){v.fold((function(){internalRemove(dom,k)}),(function(value){internalSet(dom,k,value)}))}))},get$c=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){var dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((function(r){return r.length>0}))},getAllRaw=function(element){var css={},dom=element.dom;if(isSupported$1(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css},isValidValue=function(tag,property,value){var element=SugarElement.fromTag(tag);return set$7(element,property,value),getRaw(element,property).isSome()},remove$6=function(element,property){var dom=element.dom;internalRemove(dom,property),is$1(getOpt(element,"style").map(trim$1),"")&&remove$7(element,"style")},reflow=function(e){return e.dom.offsetWidth},Dimension=function(name,getOffset){var get=function(element){var r=getOffset(element);if(r<=0||null===r){var css=get$c(element,name);return parseFloat(css)||0}return r},aggregate=function(element,properties){return foldl(properties,(function(acc,property){var val=get$c(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0)};return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);var dom=element.dom;isSupported$1(dom)&&(dom.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:function(element,value,properties){var cumulativeInclusions=aggregate(element,properties);return value>cumulativeInclusions?value-cumulativeInclusions:0}}},api$3=Dimension("height",(function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),get$b=function(element){return api$3.get(element)},getOuter$2=function(element){return api$3.getOuter(element)},r$1=function(left,top){return{left:left,top:top,translate:function(x,y){return r$1(left+x,top+y)}}},SugarPosition=r$1,firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},absolute$3=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport$1(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)},viewport$1=function(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?function(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)}(dom):SugarPosition(0,0)},api$2=Dimension("width",(function(element){return element.dom.offsetWidth})),get$a=function(element){return api$2.get(element)},getOuter$1=function(element){return api$2.getOuter(element)},fromRawEvent$1=function(rawEvent){var target=SugarElement.fromDom(function(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$2(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)}(rawEvent).getOr(rawEvent.target)),stop=function(){return rawEvent.stopPropagation()},prevent=function(){return rawEvent.preventDefault()},kill=compose(prevent,stop);return function(target,x,y,stop,prevent,kill,raw){return{target:target,x:x,y:y,stop:stop,prevent:prevent,kill:kill,raw:raw}}(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent)},binder=function(element,event,filter,handler,useCapture){var wrapped=function(filter,handler){return function(rawEvent){filter(rawEvent)&&handler(fromRawEvent$1(rawEvent))}}(filter,handler);return element.dom.addEventListener(event,wrapped,useCapture),{unbind:curry(unbind,element,event,wrapped,useCapture)}},unbind=function(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture)},before$2=function(marker,element){parent(marker).each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},after$2=function(marker,element){(function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)})(marker).fold((function(){parent(marker).each((function(v){append$2(v,element)}))}),(function(v){before$2(v,element)}))},prepend$1=function(parent,element){(function(element){return child$2(element,0)})(parent).fold((function(){append$2(parent,element)}),(function(v){parent.dom.insertBefore(element.dom,v.dom)}))},append$2=function(parent,element){parent.dom.appendChild(element.dom)},append$1=function(parent,elements){each$1(elements,(function(x){append$2(parent,x)}))},empty=function(element){element.dom.textContent="",each$1(children(element),(function(rogue){remove$5(rogue)}))},remove$5=function(element){var dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=function(wrapper){var marker,children$1=children(wrapper);children$1.length>0&&(marker=wrapper,each$1(children$1,(function(x){before$2(marker,x)}))),remove$5(wrapper)},get$9=function(_DOC){var doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y)},to=function(x,y,_DOC){var win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollTo(x,y)},bounds$1=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},getBounds$3=function(_win){var win=void 0===_win?window:_win,doc=win.document,scroll=get$9(SugarElement.fromDom(doc));return function(_win){var win=void 0===_win?window:_win;return detect$1().browser.isFirefox()?Optional.none():Optional.from(win.visualViewport)}(win).fold((function(){var html=win.document.documentElement,width=html.clientWidth,height=html.clientHeight;return bounds$1(scroll.left,scroll.top,width,height)}),(function(visualViewport){return bounds$1(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)}))},walkUp=function(navigation,doc){return navigation.view(doc).fold(constant$1([]),(function(f){var parent=navigation.owner(f),rest=walkUp(navigation,parent);return[f].concat(rest)}))},Navigation=Object.freeze({__proto__:null,view:function(doc){var _a;return(doc.dom===document?Optional.none():Optional.from(null===(_a=doc.dom.defaultView)||void 0===_a?void 0:_a.frameElement)).map(SugarElement.fromDom)},owner:function(element){return owner$4(element)}}),find$2=function(element){var doc=SugarElement.fromDom(document),scroll=get$9(doc);return function(element,navigation){var d=navigation.owner(element),paths=walkUp(navigation,d);return Optional.some(paths)}(element,Navigation).fold(curry(absolute$3,element),(function(frames){var offset=viewport$1(element),r=foldr(frames,(function(b,a){var loc=viewport$1(a);return{left:b.left+loc.left,top:b.top+loc.top}}),{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top)}))},bounds=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},box$1=function(element){var xy=absolute$3(element),w=getOuter$1(element),h=getOuter$2(element);return bounds(xy.left,xy.top,w,h)},absolute$2=function(element){var position=find$2(element),width=getOuter$1(element),height=getOuter$2(element);return bounds(position.left,position.top,width,height)},win=function(){return getBounds$3(window)},value$3=function(o){return{isValue:always,isError:never,getOr:constant$1(o),getOrThunk:constant$1(o),getOrDie:constant$1(o),or:function(_opt){return value$3(o)},orThunk:function(_f){return value$3(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$3(f(o))},mapError:function(_f){return value$3(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}},error$1=function(message){return{isValue:never,isError:always,getOr:identity$1,getOrThunk:function(f){return f()},getOrDie:function(){return die(String(message))()},or:identity$1,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error$1(message)},mapError:function(f){return error$1(f(message))},each:noop,bind:function(_f){return error$1(message)},exists:never,forall:always,toOptional:Optional.none}},Result={value:value$3,error:error$1,fromOption:function(opt,err){return opt.fold((function(){return error$1(err)}),value$3)}};!function(SimpleResultType){SimpleResultType[SimpleResultType.Error=0]="Error",SimpleResultType[SimpleResultType.Value=1]="Value"}(SimpleResultType||(SimpleResultType={}));var fold$1=function(res,onError,onValue){return res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue)},svalue=function(v){return{stype:SimpleResultType.Value,svalue:v}},serror=function(e){return{stype:SimpleResultType.Error,serror:e}},SimpleResult_fromResult=function(res){return res.fold(serror,svalue)},SimpleResult_toResult=function(res){return fold$1(res,Result.error,Result.value)},SimpleResult_svalue=svalue,SimpleResult_partition=function(results){var values=[],errors=[];return each$1(results,(function(obj){fold$1(obj,(function(err){return errors.push(err)}),(function(val){return values.push(val)}))})),{values:values,errors:errors}},SimpleResult_serror=serror,SimpleResult_bind=function(res,f){return res.stype===SimpleResultType.Value?f(res.svalue):res},SimpleResult_bindError=function(res,f){return res.stype===SimpleResultType.Error?f(res.serror):res},SimpleResult_map=function(res,f){return res.stype===SimpleResultType.Value?{stype:SimpleResultType.Value,svalue:f(res.svalue)}:res},SimpleResult_mapError=function(res,f){return res.stype===SimpleResultType.Error?{stype:SimpleResultType.Error,serror:f(res.serror)}:res},SimpleResult_fold=fold$1,field$2=function(key,newKey,presence,prop){return{tag:"field",key:key,newKey:newKey,presence:presence,prop:prop}},fold=function(value,ifField,ifCustom){switch(value.tag){case"field":return ifField(value.key,value.newKey,value.presence,value.prop);case"custom":return ifCustom(value.newKey,value.instantiator)}},baseMerge=function(merger){return function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}},deepMerge=baseMerge((function(old,nu){return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu})),merge$1=baseMerge((function(old,nu){return nu})),defaultedThunk=function(fallbackThunk){return{tag:"defaultedThunk",process:fallbackThunk}},defaulted$1=function(fallback){return defaultedThunk(constant$1(fallback))},mergeWithThunk=function(baseThunk){return{tag:"mergeWithThunk",process:baseThunk}},mergeErrors$1=function(errors){return compose(SimpleResult_serror,flatten)(errors)},ResultCombine_consolidateArr=function(objects){var partitions=SimpleResult_partition(objects);return partitions.errors.length>0?mergeErrors$1(partitions.errors):SimpleResult_svalue(partitions.values)},formatObj=function(input){return isObject(input)&&keys(input).length>100?" removed due to size":JSON.stringify(input,null,2)},nu$a=function(path,getErrorInfo){return SimpleResult_serror([{path:path,getErrorInfo:getErrorInfo}])},value$2=function(validator){return{extract:function(path,val){return SimpleResult_bindError(validator(val),(function(err){return function(path,err){return nu$a(path,constant$1(err))}(path,err)}))},toString:constant$1("val")}},anyValue$1=value$2(SimpleResult_svalue),requiredAccess=function(path,obj,key,bundle){return get$e(obj,key).fold((function(){return function(path,key,obj){return nu$a(path,(function(){return'Could not find valid *required* value for "'+key+'" in '+formatObj(obj)}))}(path,key,obj)}),bundle)},fallbackAccess=function(obj,key,fallback,bundle){return bundle(get$e(obj,key).getOrThunk((function(){return fallback(obj)})))},extractField=function(field,path,obj,key,prop){var bundle=function(av){return prop.extract(path.concat([key]),av)},bundleAsOption=function(optValue){return optValue.fold((function(){return SimpleResult_svalue(Optional.none())}),(function(ov){var result=prop.extract(path.concat([key]),ov);return SimpleResult_map(result,Optional.some)}))};switch(field.tag){case"required":return requiredAccess(path,obj,key,bundle);case"defaultedThunk":return fallbackAccess(obj,key,field.process,bundle);case"option":return function(obj,key,bundle){return bundle(get$e(obj,key))}(obj,key,bundleAsOption);case"defaultedOptionThunk":return function(obj,key,fallback,bundle){return bundle(get$e(obj,key).map((function(val){return!0===val?fallback(obj):val})))}(obj,key,field.process,bundleAsOption);case"mergeWithThunk":return fallbackAccess(obj,key,constant$1({}),(function(v){var result=deepMerge(field.process(obj),v);return bundle(result)}))}},valueThunk=function(getDelegate){return{extract:function(path,val){return getDelegate().extract(path,val)},toString:function(){return getDelegate().toString()}}},getSetKeys=function(obj){return keys(filter$1(obj,isNonNullable))},objOfOnly=function(fields){var delegate=objOf(fields),fieldNames=foldr(fields,(function(acc,value){return fold(value,(function(key){var _a;return deepMerge(acc,((_a={})[key]=!0,_a))}),constant$1(acc))}),{});return{extract:function(path,o){var keys=isBoolean(o)?[]:getSetKeys(o),extra=filter$2(keys,(function(k){return!hasNonNullableKey(fieldNames,k)}));return 0===extra.length?delegate.extract(path,o):function(path,unsupported){return nu$a(path,(function(){return"There are unsupported fields: ["+unsupported.join(", ")+"] specified"}))}(path,extra)},toString:delegate.toString}},objOf=function(values){return{extract:function(path,o){return function(path,obj,fields){for(var success={},errors=[],_i=0,fields_1=fields;_i<fields_1.length;_i++){var field=fields_1[_i];fold(field,(function(key,newKey,presence,prop){var result=extractField(presence,path,obj,key,prop);SimpleResult_fold(result,(function(err){errors.push.apply(errors,err)}),(function(res){success[newKey]=res}))}),(function(newKey,instantiator){success[newKey]=instantiator(obj)}))}return errors.length>0?SimpleResult_serror(errors):SimpleResult_svalue(success)}(path,o,values)},toString:function(){return"obj{\n"+map$2(values,(function(value){return fold(value,(function(key,_okey,_presence,prop){return key+" -> "+prop.toString()}),(function(newKey,_instantiator){return"state("+newKey+")"}))})).join("\n")+"}"}}},arrOf=function(prop){return{extract:function(path,array){var results=map$2(array,(function(a,i){return prop.extract(path.concat(["["+i+"]"]),a)}));return ResultCombine_consolidateArr(results)},toString:function(){return"array("+prop.toString()+")"}}},oneOf=function(props){return{extract:function(path,val){for(var errors=[],_i=0,props_1=props;_i<props_1.length;_i++){var res=props_1[_i].extract(path,val);if(res.stype===SimpleResultType.Value)return res;errors.push(res)}return ResultCombine_consolidateArr(errors)},toString:function(){return"oneOf("+map$2(props,(function(prop){return prop.toString()})).join(", ")+")"}}},setOf$1=function(validator,prop){return{extract:function(path,o){var keys$1=keys(o),validatedKeys=function(path,keys){return arrOf(value$2(validator)).extract(path,keys)}(path,keys$1);return SimpleResult_bind(validatedKeys,(function(validKeys){var schema=map$2(validKeys,(function(vk){return field$2(vk,vk,{tag:"required",process:{}},prop)}));return objOf(schema).extract(path,o)}))},toString:function(){return"setOf("+prop.toString()+")"}}},arrOfObj=compose(arrOf,objOf),anyValue=constant$1(anyValue$1),typedValue=function(validator,expectedType){return value$2((function(a){var actualType=typeof a;return validator(a)?SimpleResult_svalue(a):SimpleResult_serror("Expected type: "+expectedType+" but got: "+actualType)}))},number=typedValue(isNumber,"number"),string=typedValue(isString,"string"),boolean=typedValue(isBoolean,"boolean"),functionProcessor=typedValue(isFunction,"function"),isPostMessageable=function(val){if(Object(val)!==val)return!0;switch({}.toString.call(val).slice(8,-1)){case"Boolean":case"Number":case"String":case"Date":case"RegExp":case"Blob":case"FileList":case"ImageData":case"ImageBitmap":case"ArrayBuffer":return!0;case"Array":case"Object":return Object.keys(val).every((function(prop){return isPostMessageable(val[prop])}));default:return!1}},postMessageable=value$2((function(a){return isPostMessageable(a)?SimpleResult_svalue(a):SimpleResult_serror("Expected value to be acceptable for sending via postMessage")})),chooseFrom=function(path,input,branches,ch){return get$e(branches,ch).fold((function(){return function(path,branches,branch){return nu$a(path,(function(){return'The chosen schema: "'+branch+'" did not exist in branches: '+formatObj(branches)}))}(path,branches,ch)}),(function(vp){return vp.extract(path.concat(["branch: "+ch]),input)}))},choose$2=function(key,branches){return{extract:function(path,input){return get$e(input,key).fold((function(){return function(path,key){return nu$a(path,(function(){return'Choice schema did not contain choice key: "'+key+'"'}))}(path,key)}),(function(chosen){return chooseFrom(path,input,branches,chosen)}))},toString:function(){return"chooseOn("+key+"). Possible values: "+keys(branches)}}},valueOf=function(validator){return value$2((function(v){return validator(v).fold(SimpleResult_serror,SimpleResult_svalue)}))},setOf=function(validator,prop){return setOf$1((function(v){return SimpleResult_fromResult(validator(v))}),prop)},asRaw=function(label,prop,obj){return SimpleResult_toResult(function(label,prop,obj){var res=prop.extract([label],obj);return SimpleResult_mapError(res,(function(errs){return{input:obj,errors:errs}}))}(label,prop,obj))},getOrDie=function(extraction){return extraction.fold((function(errInfo){throw new Error(formatError(errInfo))}),identity$1)},asRawOrDie$1=function(label,prop,obj){return getOrDie(asRaw(label,prop,obj))},formatError=function(errInfo){return"Errors: \n"+(errors=errInfo.errors,es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant$1("... (only showing first ten failures)")}]):errors,map$2(es,(function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()}))).join("\n")+"\n\nInput object: "+formatObj(errInfo.input);var errors,es},choose$1=function(key,branches){return choose$2(key,map$1(branches,objOf))},field$1=field$2,customField=function(newKey,instantiator){return{tag:"custom",newKey:newKey,instantiator:instantiator}},validateEnum=function(values){return valueOf((function(value){return contains$2(values,value)?Result.value(value):Result.error('Unsupported value: "'+value+'", choose one of "'+values.join(", ")+'".')}))},required$1=function(key){return field$1(key,key,{tag:"required",process:{}},anyValue())},requiredOf=function(key,schema){return field$1(key,key,{tag:"required",process:{}},schema)},requiredNumber=function(key){return requiredOf(key,number)},requiredString=function(key){return requiredOf(key,string)},requiredStringEnum=function(key,values){return field$1(key,key,{tag:"required",process:{}},validateEnum(values))},requiredFunction=function(key){return requiredOf(key,functionProcessor)},requiredObjOf=function(key,objSchema){return field$1(key,key,{tag:"required",process:{}},objOf(objSchema))},requiredArrayOfObj=function(key,objFields){return field$1(key,key,{tag:"required",process:{}},arrOfObj(objFields))},requiredArrayOf=function(key,schema){return field$1(key,key,{tag:"required",process:{}},arrOf(schema))},option=function(key){return field$1(key,key,{tag:"option",process:{}},anyValue())},optionOf=function(key,schema){return field$1(key,key,{tag:"option",process:{}},schema)},optionNumber=function(key){return optionOf(key,number)},optionString=function(key){return optionOf(key,string)},optionFunction=function(key){return optionOf(key,functionProcessor)},optionArrayOf=function(key,schema){return optionOf(key,arrOf(schema))},optionObjOf=function(key,objSchema){return optionOf(key,objOf(objSchema))},defaulted=function(key,fallback){return field$1(key,key,defaulted$1(fallback),anyValue())},defaultedOf=function(key,fallback,schema){return field$1(key,key,defaulted$1(fallback),schema)},defaultedNumber=function(key,fallback){return defaultedOf(key,fallback,number)},defaultedString=function(key,fallback){return defaultedOf(key,fallback,string)},defaultedStringEnum=function(key,fallback,values){return defaultedOf(key,fallback,validateEnum(values))},defaultedBoolean=function(key,fallback){return defaultedOf(key,fallback,boolean)},defaultedFunction=function(key,fallback){return defaultedOf(key,fallback,functionProcessor)},defaultedArrayOf=function(key,fallback,schema){return defaultedOf(key,fallback,arrOf(schema))},defaultedObjOf=function(key,fallback,objSchema){return defaultedOf(key,fallback,objOf(objSchema))},Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},Adt_generate=function(cases){if(!isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$1(cases,(function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);var match=function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(function(reqKey){return contains$2(branchKeys,reqKey)})))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)};return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);var target=foldArgs[count];return target.apply(null,args)},match:match,log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}})),adt};Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var _a$2,exclude=function(obj,fields){return function(obj,fields){var r={};return each(obj,(function(v,k){contains$2(fields,k)||(r[k]=v)})),r}(obj,fields)},wrap$1=function(key,value){return function(key,value){var _a;return(_a={})[key]=value,_a}(key,value)},wrapAll=function(keyvalues){return function(keyvalues){var r={};return each$1(keyvalues,(function(kv){r[kv.key]=kv.value})),r}(keyvalues)},consolidate=function(objs,base){var errors,partitions=function(results){var errors=[],values=[];return each$1(results,(function(result){result.fold((function(err){errors.push(err)}),(function(value){values.push(value)}))})),{errors:errors,values:values}}(objs);return partitions.errors.length>0?(errors=partitions.errors,Result.error(flatten(errors))):function(values,base){return 0===values.length?Result.value(base):Result.value(deepMerge(base,merge$1.apply(void 0,values)))}(partitions.values,base)},ensureIsRoot=function(isRoot){return isFunction(isRoot)?isRoot:never},ancestor$2=function(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()},closest$4=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk((function(){return stop(scope)?Optional.none():ancestor$2(scope,transform,stop)}))},isSource=function(component,simulatedEvent){return eq(component.element,simulatedEvent.event.target)},defaultEventHandler={can:always,abort:never,run:noop},nu$9=function(parts){if(!hasNonNullableKey(parts,"can")&&!hasNonNullableKey(parts,"abort")&&!hasNonNullableKey(parts,"run"))throw new Error("EventHandler defined by: "+JSON.stringify(parts,null,2)+" does not have can, abort, or run!");return __assign(__assign({},defaultEventHandler),parts)},fuse$1=function(handlers){return{can:function(handlers,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return foldl(handlers,(function(acc,handler){return acc&&f(handler).apply(void 0,args)}),!0)}}(handlers,(function(handler){return handler.can})),abort:function(handlers,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return foldl(handlers,(function(acc,handler){return acc||f(handler).apply(void 0,args)}),!1)}}(handlers,(function(handler){return handler.abort})),run:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];each$1(handlers,(function(handler){handler.run.apply(void 0,args)}))}}},constant=constant$1,touchstart=constant("touchstart"),touchmove=constant("touchmove"),touchend=constant("touchend"),touchcancel=constant("touchcancel"),mousedown=constant("mousedown"),mousemove=constant("mousemove"),mouseout=constant("mouseout"),mouseup=constant("mouseup"),mouseover=constant("mouseover"),focusin=constant("focusin"),focusout=constant("focusout"),keydown=constant("keydown"),keyup=constant("keyup"),input=constant("input"),change=constant("change"),click=constant("click"),transitioncancel=constant("transitioncancel"),transitionend=constant("transitionend"),transitionstart=constant("transitionstart"),selectstart=constant("selectstart"),prefixName=function(name){return constant$1("alloy."+name)},alloy={tap:prefixName("tap")},focus$4=prefixName("focus"),postBlur=prefixName("blur.post"),postPaste=prefixName("paste.post"),receive=prefixName("receive"),execute$5=prefixName("execute"),focusItem=prefixName("focus.item"),tap=alloy.tap,longpress=prefixName("longpress"),sandboxClose=prefixName("sandbox.close"),typeaheadCancel=prefixName("typeahead.cancel"),systemInit=prefixName("system.init"),documentTouchmove=prefixName("system.touchmove"),documentTouchend=prefixName("system.touchend"),windowScroll=prefixName("system.scroll"),windowResize=prefixName("system.resize"),attachedToDom=prefixName("system.attached"),detachedFromDom=prefixName("system.detached"),dismissRequested=prefixName("system.dismissRequested"),repositionRequested=prefixName("system.repositionRequested"),focusShifted=prefixName("focusmanager.shifted"),slotVisibility=prefixName("slotcontainer.visibility"),changeTab=prefixName("change.tab"),dismissTab=prefixName("dismiss.tab"),highlight$1=prefixName("highlight"),dehighlight$1=prefixName("dehighlight"),emit=function(component,event){dispatchWith(component,component.element,event,{})},emitWith=function(component,event,properties){dispatchWith(component,component.element,event,properties)},emitExecute=function(component){emit(component,execute$5())},dispatch=function(component,target,event){dispatchWith(component,target,event,{})},dispatchWith=function(component,target,event,properties){var data=__assign({target:target},properties);component.getSystem().triggerEvent(event,target,data)},dispatchEvent=function(component,target,event,simulatedEvent){component.getSystem().triggerEvent(event,target,simulatedEvent.event)},derive$2=function(configs){return wrapAll(configs)},abort=function(name,predicate){return{key:name,value:nu$9({abort:predicate})}},preventDefault=function(name){return{key:name,value:nu$9({run:function(component,simulatedEvent){simulatedEvent.event.prevent()}})}},run$1=function(name,handler){return{key:name,value:nu$9({run:handler})}},runActionExtra=function(name,action,extra){return{key:name,value:nu$9({run:function(component,simulatedEvent){action.apply(void 0,[component,simulatedEvent].concat(extra))}})}},runOnSourceName=function(name){return function(handler){return{key:name,value:nu$9({run:function(component,simulatedEvent){isSource(component,simulatedEvent)&&handler(component,simulatedEvent)}})}}},redirectToPart=function(name,detail,partName){return function(name,uid){return run$1(name,(function(component,simulatedEvent){component.getSystem().getByUid(uid).each((function(redirectee){dispatchEvent(redirectee,redirectee.element,name,simulatedEvent)}))}))}(name,detail.partUids[partName])},runWithTarget=function(name,f){return run$1(name,(function(component,simulatedEvent){var ev=simulatedEvent.event,target=component.getSystem().getByDom(ev.target).getOrThunk((function(){return closest$4(ev.target,(function(el){return component.getSystem().getByDom(el).toOptional()}),never).getOr(component)}));f(component,target,simulatedEvent)}))},cutter=function(name){return run$1(name,(function(component,simulatedEvent){simulatedEvent.cut()}))},stopper=function(name){return run$1(name,(function(component,simulatedEvent){simulatedEvent.stop()}))},runOnSource=function(name,f){return runOnSourceName(name)(f)},runOnAttached=runOnSourceName(attachedToDom()),runOnDetached=runOnSourceName(detachedFromDom()),runOnInit=runOnSourceName(systemInit()),runOnExecute$1=function(name){return function(handler){return run$1(name,handler)}}(execute$5()),get$7=function(element){return element.dom.innerHTML},set$5=function(element,content){var html,div,docDom=owner$4(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),contentElements=(html=content,(div=(docDom||document).createElement("div")).innerHTML=html,children(SugarElement.fromDom(div)));append$1(fragment,contentElements),empty(element),append$2(element,fragment)},shallow=function(original){return function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))}(original,!1)},getHtml=function(element){return isShadowRoot(element)?"#shadow-root":function(element){var container=SugarElement.fromTag("div"),clone=SugarElement.fromDom(element.dom.cloneNode(!0));return append$2(container,clone),get$7(container)}(shallow(element))},element=function(elem){return getHtml(elem)},events$i=derive$2([function(name,predicate){return{key:name,value:nu$9({can:predicate})}}(focus$4(),(function(component,simulatedEvent){var event=simulatedEvent.event,originator=event.originator,target=event.target;return!function(component,originator,target){return eq(originator,component.element)&&!eq(originator,target)}(component,originator,target)||(console.warn(focus$4()+" did not get interpreted by the desired target. \nOriginator: "+element(originator)+"\nTarget: "+element(target)+"\nCheck the "+focus$4()+" event handlers"),!1)}))]),DefaultEvents=Object.freeze({__proto__:null,events:events$i}),unique=0,generate$6=function(prefix){var time=(new Date).getTime();return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},prefix$1=constant$1("alloy-id-"),idAttr$1=constant$1("data-alloy-id"),prefix=prefix$1(),idAttr=idAttr$1(),writeOnly=function(elem,uid){Object.defineProperty(elem.dom,idAttr,{value:uid,writable:!0})},read$1=function(elem){var id=isElement$2(elem)?elem.dom[idAttr]:null;return Optional.from(id)},generate$5=function(prefix){return generate$6(prefix)},make$8=identity$1,NoContextApi=function(getComp){var getMessage=function(event){return"The component must be in a context to execute: "+event+(getComp?"\n"+element(getComp().element)+" is not in context.":"")},fail=function(event){return function(){throw new Error(getMessage(event))}},warn=function(event){return function(){console.warn(getMessage(event))}};return{debugInfo:constant$1("fake"),triggerEvent:warn("triggerEvent"),triggerFocus:warn("triggerFocus"),triggerEscape:warn("triggerEscape"),broadcast:warn("broadcast"),broadcastOn:warn("broadcastOn"),broadcastEvent:warn("broadcastEvent"),build:fail("build"),addToWorld:fail("addToWorld"),removeFromWorld:fail("removeFromWorld"),addToGui:fail("addToGui"),removeFromGui:fail("removeFromGui"),getByUid:fail("getByUid"),getByDom:fail("getByDom"),isConnected:never}},singleton$1=NoContextApi(),cleanParameters=function(parameters){return map$2(parameters,(function(p){return endsWith(p,"/*")?p.substring(0,p.length-"/*".length):p}))},markAsExtraApi=function(f,extraName){var delegate=f.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:extraName,parameters:cleanParameters(parameters)}},f},premadeTag=generate$6("alloy-premade"),premade$1=function(comp){return wrap$1(premadeTag,comp)},makeApi=function(f){return function(f,apiFunction){var delegate=apiFunction.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:cleanParameters(parameters.slice(1))}},f}((function(component){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];return f.apply(void 0,__spreadArray([component.getApis(),component],rest,!1))}),f)},NoState={init:function(){return nu$8({readState:constant$1("No State required")})}},nu$8=function(spec){return spec},byInnerKey=function(data,tuple){var r={};return each(data,(function(detail,key){each(detail,(function(value,indexKey){var chain=get$e(r,indexKey).getOr([]);r[indexKey]=chain.concat([tuple(key,value)])}))})),r},nu$7=function(s){return{classes:isUndefined(s.classes)?[]:s.classes,attributes:isUndefined(s.attributes)?{}:s.attributes,styles:isUndefined(s.styles)?{}:s.styles}},getCurried=function(descHandler){return descHandler.cHandler},behaviourTuple=function(name,handler){return{name:name,handler:handler}},groupByEvents=function(info,behaviours,base){var behaviourEvents=__assign(__assign({},base),function(behaviours,info){var r={};return each$1(behaviours,(function(behaviour){r[behaviour.name()]=behaviour.handlers(info)})),r}(behaviours,info));return byInnerKey(behaviourEvents,behaviourTuple)},assemble=function(rawHandler){var handler=function(handler){return isFunction(handler)?{can:always,abort:never,run:handler}:handler}(rawHandler);return function(component,simulatedEvent){for(var rest=[],_i=2;_i<arguments.length;_i++)rest[_i-2]=arguments[_i];var args=[component,simulatedEvent].concat(rest);handler.abort.apply(void 0,args)?simulatedEvent.stop():handler.can.apply(void 0,args)&&handler.run.apply(void 0,args)}},fuse=function(tuples,eventOrder,eventName){var order=eventOrder[eventName];return order?function(label,keyName,array,order){try{var sorted=sort(array,(function(a,b){var aKey=a[keyName],bKey=b[keyName],aIndex=order.indexOf(aKey),bIndex=order.indexOf(bKey);if(-1===aIndex)throw new Error("The ordering for "+label+" does not have an entry for "+aKey+".\nOrder specified: "+JSON.stringify(order,null,2));if(-1===bIndex)throw new Error("The ordering for "+label+" does not have an entry for "+bKey+".\nOrder specified: "+JSON.stringify(order,null,2));return aIndex<bIndex?-1:bIndex<aIndex?1:0}));return Result.value(sorted)}catch(err){return Result.error([err])}}("Event: "+eventName,"name",tuples,order).map((function(sortedTuples){var handlers=map$2(sortedTuples,(function(tuple){return tuple.handler}));return fuse$1(handlers)})):function(eventName,tuples){return Result.error(["The event ("+eventName+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(map$2(tuples,(function(c){return c.name})),null,2)])}(eventName,tuples)},combineGroups=function(byEventName,eventOrder){var r=mapToArray(byEventName,(function(tuples,eventName){return(1===tuples.length?Result.value(tuples[0].handler):fuse(tuples,eventOrder,eventName)).map((function(handler){var assembled=assemble(handler),purpose=tuples.length>1?filter$2(eventOrder[eventName],(function(o){return exists(tuples,(function(t){return t.name===o}))})).join(" > "):tuples[0].name;return wrap$1(eventName,function(handler,purpose){return{handler:handler,purpose:purpose}}(assembled,purpose))}))}));return consolidate(r,{})},baseBehaviour="alloy.base.behaviour",schema$z=objOf([field$1("dom","dom",{tag:"required",process:{}},objOf([required$1("tag"),defaulted("styles",{}),defaulted("classes",[]),defaulted("attributes",{}),option("value"),option("innerHtml")])),required$1("components"),required$1("uid"),defaulted("events",{}),defaulted("apis",{}),field$1("eventOrder","eventOrder",function(base){return mergeWithThunk(constant$1(base))}((_a$2={},_a$2[execute$5()]=["disabling",baseBehaviour,"toggling","typeaheadevents"],_a$2[focus$4()]=[baseBehaviour,"focusing","keying"],_a$2[systemInit()]=[baseBehaviour,"disabling","toggling","representing"],_a$2[input()]=[baseBehaviour,"representing","streaming","invalidating"],_a$2[detachedFromDom()]=[baseBehaviour,"representing","item-events","tooltipping"],_a$2[mousedown()]=["focusing",baseBehaviour,"item-type-events"],_a$2[touchstart()]=["focusing",baseBehaviour,"item-type-events"],_a$2[mouseover()]=["item-type-events","tooltipping"],_a$2[receive()]=["receiving","reflecting","tooltipping"],_a$2)),anyValue()),option("domModification")]),toEvents=function(info){return info.events},read=function(element,attr){var value=get$d(element,attr);return void 0===value||""===value?[]:value.split(" ")},supports=function(element){return void 0!==element.dom.classList},add$3=function(element,clazz){return function(element,attr,id){var nu=read(element,attr).concat([id]);return set$8(element,attr,nu.join(" ")),!0}(element,"class",clazz)},remove$3=function(element,clazz){return function(element,attr,id){var nu=filter$2(read(element,attr),(function(v){return v!==id}));return nu.length>0?set$8(element,attr,nu.join(" ")):remove$7(element,attr),!1}(element,"class",clazz)},add$2=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$3(element,clazz)},cleanClass=function(element){0===(supports(element)?element.dom.classList:function(element){return read(element,"class")}(element)).length&&remove$7(element,"class")},remove$2=function(element,clazz){supports(element)?element.dom.classList.remove(clazz):remove$3(element,clazz);cleanClass(element)},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},add$1=function(element,classes){each$1(classes,(function(x){add$2(element,x)}))},remove$1=function(element,classes){each$1(classes,(function(x){remove$2(element,x)}))},get$5=function(element){return element.dom.value},set$4=function(element,value){if(void 0===value)throw new Error("Value.set was undefined");element.dom.value=value},generateFrom=function(spec,all){return function(spec,all){var schema=map$2(all,(function(a){return optionObjOf(a.name(),[required$1("config"),defaulted("state",NoState)])})),validated=asRaw("component.behaviours",objOf(schema),spec.behaviours).fold((function(errInfo){throw new Error(formatError(errInfo)+"\nComplete spec:\n"+JSON.stringify(spec,null,2))}),identity$1);return{list:all,data:map$1(validated,(function(optBlobThunk){var output=optBlobThunk.map((function(blob){return{config:blob.config,state:blob.state.init(blob.config)}}));return constant$1(output)}))}}(spec,all)},generate$4=function(spec){var all=function(spec){var behaviours=get$e(spec,"behaviours").getOr({});return bind$3(keys(behaviours),(function(name){var behaviour=behaviours[name];return isNonNullable(behaviour)?[behaviour.me]:[]}))}(spec);return generateFrom(spec,all)},getDomDefinition=function(info,bList,bData){var detail,defnA,mod,definition=__assign(__assign({},(detail=info).dom),{uid:detail.uid,domChildren:map$2(detail.components,(function(comp){return comp.element}))}),infoModification=function(detail){return detail.domModification.fold((function(){return nu$7({})}),nu$7)}(info),baseModification={"alloy.base.modification":infoModification},modification=bList.length>0?function(info,baseMod,behaviours,base){var modsByBehaviour=__assign({},baseMod);each$1(behaviours,(function(behaviour){modsByBehaviour[behaviour.name()]=behaviour.exhibit(info,base)}));var byAspect=byInnerKey(modsByBehaviour,(function(name,modification){return{name:name,modification:modification}})),combineObjects=function(objects){return foldr(objects,(function(b,a){return __assign(__assign({},a.modification),b)}),{})},combinedClasses=foldr(byAspect.classes,(function(b,a){return a.modification.concat(b)}),[]),combinedAttributes=combineObjects(byAspect.attributes),combinedStyles=combineObjects(byAspect.styles);return nu$7({classes:combinedClasses,attributes:combinedAttributes,styles:combinedStyles})}(bData,baseModification,bList,definition):infoModification;return mod=modification,__assign(__assign({},defnA=definition),{attributes:__assign(__assign({},defnA.attributes),mod.attributes),styles:__assign(__assign({},defnA.styles),mod.styles),classes:defnA.classes.concat(mod.classes)})},getEvents=function(info,bList,bData){var baseEvents={"alloy.base.behaviour":toEvents(info)};return function(info,eventOrder,behaviours,base){var byEventName=groupByEvents(info,behaviours,base);return combineGroups(byEventName,eventOrder)}(bData,info.eventOrder,bList,baseEvents).getOrDie()},build$2=function(spec){var getMe=function(){return me},systemApi=Cell(singleton$1),info=getOrDie(function(spec){return asRaw("custom.definition",schema$z,spec)}(spec)),bBlob=generate$4(spec),bList=function(bData){return bData.list}(bBlob),bData=function(bData){return bData.data}(bBlob),item=function(definition){var subject=SugarElement.fromTag(definition.tag);setAll$1(subject,definition.attributes),add$1(subject,definition.classes),setAll(subject,definition.styles),definition.innerHtml.each((function(html){return set$5(subject,html)}));var children=definition.domChildren;return append$1(subject,children),definition.value.each((function(value){set$4(subject,value)})),definition.uid,writeOnly(subject,definition.uid),subject}(getDomDefinition(info,bList,bData)),events=getEvents(info,bList,bData),subcomponents=Cell(info.components),me={uid:spec.uid,getSystem:systemApi.get,config:function(behaviour){var b=bData;return(isFunction(b[behaviour.name()])?b[behaviour.name()]:function(){throw new Error("Could not find "+behaviour.name()+" in "+JSON.stringify(spec,null,2))})()},hasConfigured:function(behaviour){return isFunction(bData[behaviour.name()])},spec:spec,readState:function(behaviourName){return bData[behaviourName]().map((function(b){return b.state.readState()})).getOr("not enabled")},getApis:function(){return info.apis},connect:function(newApi){systemApi.set(newApi)},disconnect:function(){systemApi.set(NoContextApi(getMe))},element:item,syncComponents:function(){var children$1=children(item),subs=bind$3(children$1,(function(child){return systemApi.get().getByDom(child).fold((function(){return[]}),pure$2)}));subcomponents.set(subs)},components:subcomponents.get,events:events};return me},buildFromSpec=function(userSpec){var _a=make$8(userSpec),specEvents=_a.events,spec=__rest(_a,["events"]),components=function(spec){var components=get$e(spec,"components").getOr([]);return map$2(components,build$1)}(spec),completeSpec=__assign(__assign({},spec),{events:__assign(__assign({},DefaultEvents),specEvents),components:components});return Result.value(build$2(completeSpec))},text=function(textContent){var element=SugarElement.fromText(textContent);return external$2({element:element})},external$2=function(spec){var extSpec=asRawOrDie$1("external.component",objOfOnly([required$1("element"),option("uid")]),spec),systemApi=Cell(NoContextApi()),uid=extSpec.uid.getOrThunk((function(){return generate$5("external")}));writeOnly(extSpec.element,uid);var me={uid:uid,getSystem:systemApi.get,config:Optional.none,hasConfigured:never,connect:function(newApi){systemApi.set(newApi)},disconnect:function(){systemApi.set(NoContextApi((function(){return me})))},getApis:function(){return{}},element:extSpec.element,spec:spec,readState:constant$1("No state"),syncComponents:noop,components:constant$1([]),events:{}};return premade$1(me)},uids=generate$5,build$1=function(spec){return function(spec){return get$e(spec,premadeTag)}(spec).getOrThunk((function(){var userSpecWithUid=function(spec){return has$2(spec,"uid")}(spec)?spec:__assign({uid:uids("")},spec);return buildFromSpec(userSpecWithUid).getOrDie()}))},premade=premade$1;function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}var EventConfiguration,ancestor$1=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest$3=function(scope,predicate,isRoot){return ClosestOrAncestor((function(s,test){return test(s)}),ancestor$1,scope,predicate,isRoot)},closest$2=function(scope,predicate,isRoot){return closest$3(scope,predicate,isRoot).isSome()},ancestor=function(scope,selector,isRoot){return ancestor$1(scope,(function(e){return is(e,selector)}),isRoot)},child=function(scope,selector){return function(scope,predicate){return find$5(scope.dom.childNodes,(function(node){return predicate(SugarElement.fromDom(node))})).map(SugarElement.fromDom)}(scope,(function(e){return is(e,selector)}))},descendant=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)}(selector,scope)},closest$1=function(scope,selector,isRoot){return ClosestOrAncestor((function(element,selector){return is(element,selector)}),ancestor,scope,selector,isRoot)},manager=function(){var ariaId=generate$6("aria-owns");return{id:ariaId,link:function(elem){set$8(elem,"aria-owns",ariaId)},unlink:function(elem){remove$7(elem,"aria-owns")}}},isAriaPartOf=function(component,queryElem){return function(queryElem){return closest$3(queryElem,(function(elem){if(!isElement$2(elem))return!1;var id=get$d(elem,"id");return void 0!==id&&id.indexOf("aria-owns")>-1})).bind((function(dep){var id=get$d(dep,"id"),dos=getRootNode(dep);return descendant(dos,'[aria-owns="'+id+'"]')}))}(queryElem).exists((function(owner){return isPartOf$1(component,owner)}))},isPartOf$1=function(component,queryElem){return closest$2(queryElem,(function(el){return eq(el,component.element)}),never)||isAriaPartOf(component,queryElem)};!function(EventConfiguration){EventConfiguration[EventConfiguration.STOP=0]="STOP",EventConfiguration[EventConfiguration.NORMAL=1]="NORMAL",EventConfiguration[EventConfiguration.LOGGING=2]="LOGGING"}(EventConfiguration||(EventConfiguration={}));var eventConfig=Cell({}),processEvent=function(eventName,initialTarget,f){switch(get$e(eventConfig.get(),eventName).orThunk((function(){var patterns=keys(eventConfig.get());return findMap(patterns,(function(p){return eventName.indexOf(p)>-1?Optional.some(eventConfig.get()[p]):Optional.none()}))})).getOr(EventConfiguration.NORMAL)){case EventConfiguration.NORMAL:return f(noLogger());case EventConfiguration.LOGGING:var logger=function(eventName,initialTarget){var sequence=[],startTime=(new Date).getTime();return{logEventCut:function(_name,target,purpose){sequence.push({outcome:"cut",target:target,purpose:purpose})},logEventStopped:function(_name,target,purpose){sequence.push({outcome:"stopped",target:target,purpose:purpose})},logNoParent:function(_name,target,purpose){sequence.push({outcome:"no-parent",target:target,purpose:purpose})},logEventNoHandlers:function(_name,target){sequence.push({outcome:"no-handlers-left",target:target})},logEventResponse:function(_name,target,purpose){sequence.push({outcome:"response",purpose:purpose,target:target})},write:function(){var finishTime=(new Date).getTime();contains$2(["mousemove","mouseover","mouseout",systemInit()],eventName)||console.log(eventName,{event:eventName,time:finishTime-startTime,target:initialTarget.dom,sequence:map$2(sequence,(function(s){return contains$2(["cut","stopped","response"],s.outcome)?"{"+s.purpose+"} "+s.outcome+" at ("+element(s.target)+")":s.outcome}))})}}}(eventName,initialTarget),output=f(logger);return logger.write(),output;case EventConfiguration.STOP:return!0}},path=["alloy/data/Fields","alloy/debugging/Debugging"],monitorEvent=function(eventName,initialTarget,f){return processEvent(eventName,initialTarget,f)},noLogger=constant$1({logEventCut:noop,logEventStopped:noop,logNoParent:noop,logEventNoHandlers:noop,logEventResponse:noop,write:noop}),menuFields=constant$1([required$1("menu"),required$1("selectedMenu")]),itemFields=constant$1([required$1("item"),required$1("selectedItem")]);constant$1(objOf(itemFields().concat(menuFields())));var itemSchema$3=constant$1(objOf(itemFields())),_initSize=requiredObjOf("initSize",[required$1("numColumns"),required$1("numRows")]),tieredMenuMarkers=function(){return requiredObjOf("markers",[required$1("backgroundMenu")].concat(menuFields()).concat(itemFields()))},markers$1=function(required){return requiredObjOf("markers",map$2(required,required$1))},onPresenceHandler=function(label,fieldName,presence){return function(){var err=new Error;if(void 0!==err.stack){var lines=err.stack.split("\n");return find$5(lines,(function(line){return line.indexOf("alloy")>0&&!exists(path,(function(p){return line.indexOf(p)>-1}))})).getOr("unknown")}}(),field$1(fieldName,fieldName,presence,valueOf((function(f){return Result.value((function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f.apply(void 0,args)}))})))},onHandler=function(fieldName){return onPresenceHandler(0,fieldName,defaulted$1(noop))},onKeyboardHandler=function(fieldName){return onPresenceHandler(0,fieldName,defaulted$1(Optional.none))},onStrictHandler=function(fieldName){return onPresenceHandler(0,fieldName,{tag:"required",process:{}})},onStrictKeyboardHandler=function(fieldName){return onPresenceHandler(0,fieldName,{tag:"required",process:{}})},output$1=function(name,value){return customField(name,constant$1(value))},snapshot=function(name){return customField(name,identity$1)},initSize=constant$1(_initSize),nu$6=function(x,y,bubble,direction,placement,boundsRestriction,labelPrefix,alwaysFit){return void 0===alwaysFit&&(alwaysFit=!1),{x:x,y:y,bubble:bubble,direction:direction,placement:placement,restriction:boundsRestriction,label:labelPrefix+"-"+placement,alwaysFit:alwaysFit}},adt$a=Adt_generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),southeast$3=adt$a.southeast,southwest$3=adt$a.southwest,northeast$3=adt$a.northeast,northwest$3=adt$a.northwest,south$3=adt$a.south,north$3=adt$a.north,east$3=adt$a.east,west$3=adt$a.west,cycleBy=function(value,delta,min,max){var r=value+delta;return r>max?min:r<min?max:r},clamp$1=function(value,min,max){return Math.min(Math.max(value,min),max)},boundsRestriction=function(anchor,restrictions){return mapToObject(["left","right","top","bottom"],(function(dir){return get$e(restrictions,dir).map((function(restriction){return function(anchor,restriction){switch(restriction){case 1:return anchor.x;case 0:return anchor.x+anchor.width;case 2:return anchor.y;case 3:return anchor.y+anchor.height}}(anchor,restriction)}))}))},eastX$1=function(anchor){return anchor.x},middleX$1=function(anchor,element){return anchor.x+anchor.width/2-element.width/2},westX$1=function(anchor,element){return anchor.x+anchor.width-element.width},northY$2=function(anchor,element){return anchor.y-element.height},southY$2=function(anchor){return anchor.y+anchor.height},centreY$1=function(anchor,element){return anchor.y+anchor.height/2-element.height/2},southeast$2=function(anchor,element,bubbles){return nu$6(eastX$1(anchor),southY$2(anchor),bubbles.southeast(),southeast$3(),"southeast",boundsRestriction(anchor,{left:1,top:3}),"layout")},southwest$2=function(anchor,element,bubbles){return nu$6(westX$1(anchor,element),southY$2(anchor),bubbles.southwest(),southwest$3(),"southwest",boundsRestriction(anchor,{right:0,top:3}),"layout")},northeast$2=function(anchor,element,bubbles){return nu$6(eastX$1(anchor),northY$2(anchor,element),bubbles.northeast(),northeast$3(),"northeast",boundsRestriction(anchor,{left:1,bottom:2}),"layout")},northwest$2=function(anchor,element,bubbles){return nu$6(westX$1(anchor,element),northY$2(anchor,element),bubbles.northwest(),northwest$3(),"northwest",boundsRestriction(anchor,{right:0,bottom:2}),"layout")},north$2=function(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),northY$2(anchor,element),bubbles.north(),north$3(),"north",boundsRestriction(anchor,{bottom:2}),"layout")},south$2=function(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),southY$2(anchor),bubbles.south(),south$3(),"south",boundsRestriction(anchor,{top:3}),"layout")},east$2=function(anchor,element,bubbles){return nu$6(function(anchor){return anchor.x+anchor.width}(anchor),centreY$1(anchor,element),bubbles.east(),east$3(),"east",boundsRestriction(anchor,{left:0}),"layout")},west$2=function(anchor,element,bubbles){return nu$6(function(anchor,element){return anchor.x-element.width}(anchor,element),centreY$1(anchor,element),bubbles.west(),west$3(),"west",boundsRestriction(anchor,{right:1}),"layout")},all$1=function(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2,east$2,west$2]},allRtl$1=function(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2,east$2,west$2]},aboveOrBelow=function(){return[northeast$2,northwest$2,southeast$2,southwest$2,north$2,south$2]},aboveOrBelowRtl=function(){return[northwest$2,northeast$2,southwest$2,southeast$2,north$2,south$2]},belowOrAbove=function(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2]},belowOrAboveRtl=function(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2]},ActiveReceiving=Object.freeze({__proto__:null,events:function(receiveConfig){return derive$2([run$1(receive(),(function(component,message){var channelMap=receiveConfig.channels,channels=keys(channelMap),receivingData=message,targetChannels=function(channels,message){return message.universal?channels:filter$2(channels,(function(ch){return contains$2(message.channels,ch)}))}(channels,receivingData);each$1(targetChannels,(function(ch){var channelInfo=channelMap[ch],channelSchema=channelInfo.schema,data=asRawOrDie$1("channel["+ch+"] data\nReceiver: "+element(component.element),channelSchema,receivingData.data);channelInfo.onReceive(component,data)}))}))])}}),ReceivingSchema=[requiredOf("channels",setOf(Result.value,objOfOnly([onStrictHandler("onReceive"),defaulted("schema",anyValue())])))],loadEvent=function(bConfig,bState,f){return runOnInit((function(component,_simulatedEvent){f(component,bConfig,bState)}))},wrapApi=function(bName,apiFunction,apiName){return function(f,apiName,apiFunction){var delegate=apiFunction.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:apiName,parameters:cleanParameters(parameters.slice(0,1).concat(parameters.slice(3)))}},f}((function(component){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];var args=[component].concat(rest);return component.config({name:constant$1(bName)}).fold((function(){throw new Error("We could not find any behaviour configuration for: "+bName+". Using API: "+apiName)}),(function(info){var rest=Array.prototype.slice.call(args,1);return apiFunction.apply(void 0,[component,info.config,info.state].concat(rest))}))}),apiName,apiFunction)},revokeBehaviour=function(name){return{key:name,value:void 0}},doCreate=function(configSchema,schemaSchema,name,active,apis,extra,state){var getConfig=function(info){return hasNonNullableKey(info,name)?info[name]():Optional.none()},wrappedApis=map$1(apis,(function(apiF,apiName){return wrapApi(name,apiF,apiName)})),wrappedExtra=map$1(extra,(function(extraF,extraName){return markAsExtraApi(extraF,extraName)})),me=__assign(__assign(__assign({},wrappedExtra),wrappedApis),{revoke:curry(revokeBehaviour,name),config:function(spec){var prepared=asRawOrDie$1(name+"-config",configSchema,spec);return{key:name,value:{config:prepared,me:me,configAsRaw:cached((function(){return asRawOrDie$1(name+"-config",configSchema,spec)})),initialConfig:spec,state:state}}},schema:constant$1(schemaSchema),exhibit:function(info,base){return lift2(getConfig(info),get$e(active,"exhibit"),(function(behaviourInfo,exhibitor){return exhibitor(base,behaviourInfo.config,behaviourInfo.state)})).getOrThunk((function(){return nu$7({})}))},name:constant$1(name),handlers:function(info){return getConfig(info).map((function(behaviourInfo){return get$e(active,"events").getOr((function(){return{}}))(behaviourInfo.config,behaviourInfo.state)})).getOr({})}});return me},derive$1=function(capabilities){return wrapAll(capabilities)},simpleSchema=objOfOnly([required$1("fields"),required$1("name"),defaulted("active",{}),defaulted("apis",{}),defaulted("state",NoState),defaulted("extra",{})]),create$7=function(data){var value=asRawOrDie$1("Creating behaviour: "+data.name,simpleSchema,data);return function(schema,name,active,apis,extra,state){var key,objSchema,configSchema=objOfOnly(schema),schemaSchema=optionObjOf(name,[(key="config",objSchema=schema,optionOf(key,objOfOnly(objSchema)))]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state)}(value.fields,value.name,value.active,value.apis,value.extra,value.state)},modeSchema=objOfOnly([required$1("branchKey"),required$1("branches"),required$1("name"),defaulted("active",{}),defaulted("apis",{}),defaulted("state",NoState),defaulted("extra",{})]),createModes=function(data){var value=asRawOrDie$1("Creating behaviour: "+data.name,modeSchema,data);return function(modes,name,active,apis,extra,state){var configSchema=modes,schemaSchema=optionObjOf(name,[optionOf("config",modes)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state)}(choose$1(value.branchKey,value.branches),value.name,value.active,value.apis,value.extra,value.state)},revoke=constant$1(void 0),Receiving=create$7({fields:ReceivingSchema,name:"receiving",active:ActiveReceiving}),ActivePosition=Object.freeze({__proto__:null,exhibit:function(base,posConfig){return nu$7({classes:[],styles:posConfig.useFixed()?{}:{position:"relative"}})}}),getDocument=function(){return SugarElement.fromDom(document)},focus$3=function(element){return element.dom.focus()},hasFocus=function(element){var root=getRootNode(element).dom;return element.dom===root.activeElement},active=function(root){return void 0===root&&(root=getDocument()),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)},search=function(element){return active(getRootNode(element)).filter((function(e){return element.dom.contains(e.dom)}))},preserve$1=function(f,container){var dos=getRootNode(container),refocus=active(dos).bind((function(focused){var predicate,descend,hasFocus=function(elem){return eq(focused,elem)};return hasFocus(container)?Optional.some(container):(predicate=hasFocus,(descend=function(node){for(var i=0;i<node.childNodes.length;i++){var child_1=SugarElement.fromDom(node.childNodes[i]);if(predicate(child_1))return Optional.some(child_1);var res=descend(node.childNodes[i]);if(res.isSome())return res}return Optional.none()})(container.dom))})),result=f(container);return refocus.each((function(oldFocus){active(dos).filter((function(newFocus){return eq(newFocus,oldFocus)})).fold((function(){focus$3(oldFocus)}),noop)})),result},NuPositionCss=function(position,left,top,right,bottom){var toPx=function(num){return num+"px"};return{position:position,left:left.map(toPx),top:top.map(toPx),right:right.map(toPx),bottom:bottom.map(toPx)}},applyPositionCss=function(element,position){setOptions(element,function(position){return __assign(__assign({},position),{position:Optional.some(position.position)})}(position))},adt$9=Adt_generate([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),positionWithDirection=function(posName,decision,x,y,width,height){var decisionRect=decision.rect,decisionX=decisionRect.x-x,decisionY=decisionRect.y-y,decisionRight=width-(decisionX+decisionRect.width),decisionBottom=height-(decisionY+decisionRect.height),left=Optional.some(decisionX),top=Optional.some(decisionY),right=Optional.some(decisionRight),bottom=Optional.some(decisionBottom),none=Optional.none();return function(subject,southeast,southwest,northeast,northwest,south,north,east,west){return subject.fold(southeast,southwest,northeast,northwest,south,north,east,west)}(decision.direction,(function(){return NuPositionCss(posName,left,top,none,none)}),(function(){return NuPositionCss(posName,none,top,right,none)}),(function(){return NuPositionCss(posName,left,none,none,bottom)}),(function(){return NuPositionCss(posName,none,none,right,bottom)}),(function(){return NuPositionCss(posName,left,top,none,none)}),(function(){return NuPositionCss(posName,left,none,none,bottom)}),(function(){return NuPositionCss(posName,left,top,none,none)}),(function(){return NuPositionCss(posName,none,top,right,none)}))},reposition=function(origin,decision){return origin.fold((function(){var decisionRect=decision.rect;return NuPositionCss("absolute",Optional.some(decisionRect.x),Optional.some(decisionRect.y),Optional.none(),Optional.none())}),(function(x,y,width,height){return positionWithDirection("absolute",decision,x,y,width,height)}),(function(x,y,width,height){return positionWithDirection("fixed",decision,x,y,width,height)}))},toBox=function(origin,element){var rel=curry(find$2,element),position=origin.fold(rel,rel,(function(){var scroll=get$9();return find$2(element).translate(-scroll.left,-scroll.top)})),width=getOuter$1(element),height=getOuter$2(element);return bounds(position.left,position.top,width,height)},viewport=function(origin,getBounds){return getBounds.fold((function(){return origin.fold(win,win,bounds)}),(function(b){return origin.fold(b,b,(function(){var bounds$1=b(),pos=translate$2(origin,bounds$1.x,bounds$1.y);return bounds(pos.left,pos.top,bounds$1.width,bounds$1.height)}))}))},translate$2=function(origin,x,y){var pos=SugarPosition(x,y);return origin.fold(constant$1(pos),constant$1(pos),(function(){var outerScroll=get$9();return pos.translate(-outerScroll.left,-outerScroll.top)}))};adt$9.none;var AttributeValue,relative$1=adt$9.relative,fixed$1=adt$9.fixed,box=function(anchorBox,origin){return function(anchorBox,origin){return{anchorBox:anchorBox,origin:origin}}(anchorBox,origin)},getPlacement=function(element){return getOpt(element,"data-alloy-placement")},adt$8=Adt_generate([{fit:["reposition"]},{nofit:["reposition","visibleW","visibleH","isVisible"]}]),attempt=function(candidate,width,height,bounds$1){var bubble=candidate.bubble,bubbleOffset=bubble.offset,adjustedBounds=function(bounds$1,restriction,bubbleOffset){var applyRestriction=function(dir,current){return restriction[dir].map((function(pos){var isVerticalAxis="top"===dir||"bottom"===dir,offset=isVerticalAxis?bubbleOffset.top:bubbleOffset.left,newPos=("left"===dir||"top"===dir?Math.max:Math.min)(pos,current)+offset;return isVerticalAxis?clamp$1(newPos,bounds$1.y,bounds$1.bottom):clamp$1(newPos,bounds$1.x,bounds$1.right)})).getOr(current)},adjustedLeft=applyRestriction("left",bounds$1.x),adjustedTop=applyRestriction("top",bounds$1.y),adjustedRight=applyRestriction("right",bounds$1.right),adjustedBottom=applyRestriction("bottom",bounds$1.bottom);return bounds(adjustedLeft,adjustedTop,adjustedRight-adjustedLeft,adjustedBottom-adjustedTop)}(bounds$1,candidate.restriction,bubbleOffset),newX=candidate.x+bubbleOffset.left,newY=candidate.y+bubbleOffset.top,box=bounds(newX,newY,width,height),_a=function(box,bounds){var boundsX=bounds.x,boundsY=bounds.y,boundsRight=bounds.right,boundsBottom=bounds.bottom,x=box.x,y=box.y,right=box.right,bottom=box.bottom,width=box.width,height=box.height;return{originInBounds:x>=boundsX&&x<=boundsRight&&y>=boundsY&&y<=boundsBottom,sizeInBounds:right<=boundsRight&&right>=boundsX&&bottom<=boundsBottom&&bottom>=boundsY,visibleW:Math.min(width,x>=boundsX?boundsRight-x:right-boundsX),visibleH:Math.min(height,y>=boundsY?boundsBottom-y:bottom-boundsY)}}(box,adjustedBounds),originInBounds=_a.originInBounds,sizeInBounds=_a.sizeInBounds,visibleW=_a.visibleW,visibleH=_a.visibleH,fits=originInBounds&&sizeInBounds,fittedBox=fits?box:function(box,bounds$1){var boundsX=bounds$1.x,boundsY=bounds$1.y,boundsRight=bounds$1.right,boundsBottom=bounds$1.bottom,x=box.x,y=box.y,width=box.width,height=box.height,maxX=Math.max(boundsX,boundsRight-width),maxY=Math.max(boundsY,boundsBottom-height),restrictedX=clamp$1(x,boundsX,maxX),restrictedY=clamp$1(y,boundsY,maxY),restrictedWidth=Math.min(restrictedX+width,boundsRight)-restrictedX,restrictedHeight=Math.min(restrictedY+height,boundsBottom)-restrictedY;return bounds(restrictedX,restrictedY,restrictedWidth,restrictedHeight)}(box,adjustedBounds),isPartlyVisible=fittedBox.width>0&&fittedBox.height>0,_b=function(direction,box,bounds){var upAvailable=constant$1(box.bottom-bounds.y),downAvailable=constant$1(bounds.bottom-box.y),maxHeight=function(subject,south,middle,north){return subject.fold(south,south,north,north,south,north,middle,middle)}(direction,downAvailable,downAvailable,upAvailable),westAvailable=constant$1(box.right-bounds.x),eastAvailable=constant$1(bounds.right-box.x);return{maxWidth:function(subject,east,middle,west){return subject.fold(east,west,east,west,middle,middle,east,west)}(direction,eastAvailable,eastAvailable,westAvailable),maxHeight:maxHeight}}(candidate.direction,fittedBox,bounds$1),maxWidth=_b.maxWidth,reposition={rect:fittedBox,maxHeight:_b.maxHeight,maxWidth:maxWidth,direction:candidate.direction,placement:candidate.placement,classes:{on:bubble.classesOn,off:bubble.classesOff},layout:candidate.label,testY:newY};return fits||candidate.alwaysFit?adt$8.fit(reposition):adt$8.nofit(reposition,visibleW,visibleH,isPartlyVisible)},singleton=function(doRevoke){var subject=Cell(Optional.none()),revoke=function(){return subject.get().each(doRevoke)};return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}},destroyable=function(){return singleton((function(s){return s.destroy()}))},unbindable=function(){return singleton((function(s){return s.unbind()}))},value$1=function(){var subject=singleton(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},filter=always,bind=function(element,event,handler){return function(element,event,filter,handler){return binder(element,event,filter,handler,!1)}(element,event,filter,handler)},capture=function(element,event,handler){return function(element,event,filter,handler){return binder(element,event,filter,handler,!0)}(element,event,filter,handler)},fromRawEvent=fromRawEvent$1,properties=["top","bottom","right","left"],timerAttr="data-alloy-transition-timer",isTransitioning$1=function(element,transition){return function(element,classes){return forall(classes,(function(clazz){return has(element,clazz)}))}(element,transition.classes)},hasChanges=function(position,intermediate){var round=function(value){return parseFloat(value).toFixed(3)};return find$4(intermediate,(function(value,key){var lhs,rhs,comparator,newValue=position[key].map(round),val=value.map(round);return void 0===comparator&&(comparator=tripleEquals),!lift2(lhs=newValue,rhs=val,comparator).getOr(lhs.isNone()&&rhs.isNone())})).isSome()},setupTransitionListeners=function(element,transition){var timer,transitionEnd=unbindable(),transitionCancel=unbindable(),isSourceTransition=function(e){var _a,pseudoElement=null!==(_a=e.raw.pseudoElement)&&void 0!==_a?_a:"";return eq(e.target,element)&&!isNotEmpty(pseudoElement)&&contains$2(properties,e.raw.propertyName)},transitionDone=function(e){if(isNullable(e)||isSourceTransition(e)){transitionEnd.clear(),transitionCancel.clear();var type=null==e?void 0:e.raw.type;(isNullable(type)||type===transitionend())&&(clearTimeout(timer),remove$7(element,timerAttr),remove$1(element,transition.classes))}},transitionStarted=function(){transitionEnd.set(bind(element,transitionend(),transitionDone)),transitionCancel.set(bind(element,transitioncancel(),transitionDone))};if("ontransitionstart"in element.dom)var transitionStart_1=bind(element,transitionstart(),(function(e){isSourceTransition(e)&&(transitionStart_1.unbind(),transitionStarted())}));else transitionStarted();var duration=function(element){var get=function(name){var style=get$c(element,name),times=isString(style)?style.split(/\s*,\s*/):[];return filter$2(times,isNotEmpty)},parse=function(value){if(isString(value)&&/^[\d.]+/.test(value)){var num=parseFloat(value);return endsWith(value,"ms")?num:1e3*num}return 0},delay=get("transition-delay"),duration=get("transition-duration");return foldl(duration,(function(acc,dur,i){var time=parse(delay[i])+parse(dur);return Math.max(acc,time)}),0)}(element);requestAnimationFrame((function(){timer=setTimeout(transitionDone,duration+17),set$8(element,timerAttr,timer)}))},applyTransitionCss=function(element,origin,position,transition,decision,lastPlacement){var shouldTransition=function(transition,decision,lastPlacement){return lastPlacement.exists((function(placer){var mode=transition.mode;return"all"===mode||placer[mode]!==decision[mode]}))}(transition,decision,lastPlacement);if(shouldTransition||isTransitioning$1(element,transition)){set$7(element,"position",position.position);var rect=toBox(origin,element),intermediatePosition_1=reposition(origin,__assign(__assign({},decision),{rect:rect})),intermediateCssOptions=mapToObject(properties,(function(prop){return intermediatePosition_1[prop]}));hasChanges(position,intermediateCssOptions)&&(setOptions(element,intermediateCssOptions),shouldTransition&&function(element,transition){add$1(element,transition.classes),getOpt(element,timerAttr).each((function(timerId){clearTimeout(parseInt(timerId,10)),remove$7(element,timerAttr)})),setupTransitionListeners(element,transition)}(element,transition),reflow(element))}else remove$1(element,transition.classes)},layout=function(anchorBox,element,bubbles,options){remove$6(element,"max-height"),remove$6(element,"max-width");var p,elementBox={width:getOuter$1(p=element),height:getOuter$2(p)};return function(element,candidates,anchorBox,elementBox,bubbles,bounds){var panelWidth=elementBox.width,panelHeight=elementBox.height,attemptBestFit=function(layout,reposition,visibleW,visibleH,isVisible){var next=layout(anchorBox,elementBox,bubbles,element,bounds),attemptLayout=attempt(next,panelWidth,panelHeight,bounds);return attemptLayout.fold(constant$1(attemptLayout),(function(newReposition,newVisibleW,newVisibleH,newIsVisible){return(isVisible===newIsVisible?newVisibleH>visibleH||newVisibleW>visibleW:!isVisible&&newIsVisible)?attemptLayout:adt$8.nofit(reposition,visibleW,visibleH,isVisible)}))};return foldl(candidates,(function(b,a){var bestNext=curry(attemptBestFit,a);return b.fold(constant$1(b),bestNext)}),adt$8.nofit({rect:anchorBox,maxHeight:elementBox.height,maxWidth:elementBox.width,direction:southeast$3(),placement:"southeast",classes:{on:[],off:[]},layout:"none",testY:anchorBox.y},-1,-1,!1)).fold(identity$1,identity$1)}(element,options.preference,anchorBox,elementBox,bubbles,options.bounds)},setPlacement=function(element,decision){!function(element,placement){set$8(element,"data-alloy-placement",placement)}(element,decision.placement)},setMaxHeight=function(element,maxHeight){!function(element,value){var absMax=api$3.max(element,value,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]);set$7(element,"max-height",absMax+"px")}(element,Math.floor(maxHeight))},anchored=constant$1((function(element,available){setMaxHeight(element,available),setAll(element,{"overflow-x":"hidden","overflow-y":"auto"})})),expandable$1=constant$1((function(element,available){setMaxHeight(element,available)})),defaultOr=function(options,key,dephault){return void 0===options[key]?dephault:options[key]},go=function(anchorBox,element,bubble,options){var decision=layout(anchorBox,element,bubble,options);return function(element,decision,options){var positionCss=reposition(options.origin,decision);options.transition.each((function(transition){applyTransitionCss(element,options.origin,positionCss,transition,decision,options.lastPlacement)})),applyPositionCss(element,positionCss)}(element,decision,options),setPlacement(element,decision),function(element,decision){var classInfo=decision.classes;remove$1(element,classInfo.off),add$1(element,classInfo.on)}(element,decision),function(element,decision,options){(0,options.maxHeightFunction)(element,decision.maxHeight)}(element,decision,options),function(element,decision,options){(0,options.maxWidthFunction)(element,decision.maxWidth)}(element,decision,options),{layout:decision.layout,placement:decision.placement}},allAlignments=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right","inset"],nu$5=function(xOffset,yOffset,classes,insetModifier){void 0===insetModifier&&(insetModifier=1);var insetXOffset=xOffset*insetModifier,insetYOffset=yOffset*insetModifier,getClasses=function(prop){return get$e(classes,prop).getOr([])},make=function(xDelta,yDelta,alignmentsOn){var alignmentsOff=difference(allAlignments,alignmentsOn);return{offset:SugarPosition(xDelta,yDelta),classesOn:bind$3(alignmentsOn,getClasses),classesOff:bind$3(alignmentsOff,getClasses)}};return{southeast:function(){return make(-xOffset,yOffset,["top","alignLeft"])},southwest:function(){return make(xOffset,yOffset,["top","alignRight"])},south:function(){return make(-xOffset/2,yOffset,["top","alignCentre"])},northeast:function(){return make(-xOffset,-yOffset,["bottom","alignLeft"])},northwest:function(){return make(xOffset,-yOffset,["bottom","alignRight"])},north:function(){return make(-xOffset/2,-yOffset,["bottom","alignCentre"])},east:function(){return make(xOffset,-yOffset/2,["valignCentre","left"])},west:function(){return make(-xOffset,-yOffset/2,["valignCentre","right"])},insetNortheast:function(){return make(insetXOffset,insetYOffset,["top","alignLeft","inset"])},insetNorthwest:function(){return make(-insetXOffset,insetYOffset,["top","alignRight","inset"])},insetNorth:function(){return make(-insetXOffset/2,insetYOffset,["top","alignCentre","inset"])},insetSoutheast:function(){return make(insetXOffset,-insetYOffset,["bottom","alignLeft","inset"])},insetSouthwest:function(){return make(-insetXOffset,-insetYOffset,["bottom","alignRight","inset"])},insetSouth:function(){return make(-insetXOffset/2,-insetYOffset,["bottom","alignCentre","inset"])},insetEast:function(){return make(-insetXOffset,-insetYOffset/2,["valignCentre","right","inset"])},insetWest:function(){return make(insetXOffset,-insetYOffset/2,["valignCentre","left","inset"])}}},fallback=function(){return nu$5(0,0,{})},nu$4=identity$1,onDirection=function(isLtr,isRtl){return function(element){return"rtl"===getDirection(element)?isRtl:isLtr}},getDirection=function(element){return"rtl"===get$c(element,"direction")?"rtl":"ltr"};!function(AttributeValue){AttributeValue.TopToBottom="toptobottom",AttributeValue.BottomToTop="bottomtotop"}(AttributeValue||(AttributeValue={}));var Attribute="data-alloy-vertical-dir",isBottomToTopDir=function(el){return closest$2(el,(function(current){return isElement$2(current)&&get$d(current,"data-alloy-vertical-dir")===AttributeValue.BottomToTop}))},schema$y=function(){return optionObjOf("layouts",[required$1("onLtr"),required$1("onRtl"),option("onBottomLtr"),option("onBottomRtl")])},get$4=function(elem,info,defaultLtr,defaultRtl,defaultBottomLtr,defaultBottomRtl,dirElement){var isBottomToTop=dirElement.map(isBottomToTopDir).getOr(!1),customLtr=info.layouts.map((function(ls){return ls.onLtr(elem)})),customRtl=info.layouts.map((function(ls){return ls.onRtl(elem)})),ltr=isBottomToTop?info.layouts.bind((function(ls){return ls.onBottomLtr.map((function(f){return f(elem)}))})).or(customLtr).getOr(defaultBottomLtr):customLtr.getOr(defaultLtr),rtl=isBottomToTop?info.layouts.bind((function(ls){return ls.onBottomRtl.map((function(f){return f(elem)}))})).or(customRtl).getOr(defaultBottomRtl):customRtl.getOr(defaultRtl);return onDirection(ltr,rtl)(elem)},HotspotAnchor=[required$1("hotspot"),option("bubble"),defaulted("overrides",{}),schema$y(),output$1("placement",(function(component,anchorInfo,origin){var hotspot=anchorInfo.hotspot,anchorBox=toBox(origin,hotspot.element),layouts=get$4(component.element,anchorInfo,belowOrAbove(),belowOrAboveRtl(),aboveOrBelow(),aboveOrBelowRtl(),Optional.some(anchorInfo.hotspot.element));return Optional.some(nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()}))}))],MakeshiftAnchor=[required$1("x"),required$1("y"),defaulted("height",0),defaulted("width",0),defaulted("bubble",fallback()),defaulted("overrides",{}),schema$y(),output$1("placement",(function(component,anchorInfo,origin){var pos=translate$2(origin,anchorInfo.x,anchorInfo.y),anchorBox=bounds(pos.left,pos.top,anchorInfo.width,anchorInfo.height),layouts=get$4(component.element,anchorInfo,all$1(),allRtl$1(),all$1(),allRtl$1(),Optional.none());return Optional.some(nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble,overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()}))}))],adt$7=Adt_generate([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),toFixed=function(pos){return pos.fold(identity$1,(function(point,scrollLeft,scrollTop){return point.translate(-scrollLeft,-scrollTop)}))},toAbsolute=function(pos){return pos.fold(identity$1,identity$1)},sum=function(points){return foldl(points,(function(b,a){return b.translate(a.left,a.top)}),SugarPosition(0,0))},sumAsAbsolute=function(positions){var points=map$2(positions,toAbsolute);return sum(points)},screen=adt$7.screen,absolute$1=adt$7.absolute,getRootPoint=function(component,origin,anchorInfo){var doc=owner$4(component.element),outerScroll=get$9(doc),offset=function(component,origin,anchorInfo){var win=defaultView(anchorInfo.root).dom;return Optional.from(win.frameElement).map(SugarElement.fromDom).filter((function(frame){var frameOwner=owner$4(frame),compOwner=owner$4(component.element);return eq(frameOwner,compOwner)})).map(absolute$3)}(component,0,anchorInfo).getOr(outerScroll);return absolute$1(offset,outerScroll.left,outerScroll.top)},getBox=function(left,top,width,height){var point=screen(SugarPosition(left,top));return Optional.some(function(point,width,height){return{point:point,width:width,height:height}}(point,width,height))},calcNewAnchor=function(optBox,rootPoint,anchorInfo,origin,elem){return optBox.map((function(box){var onNone,onRelative,onFixed,points=[rootPoint,box.point],topLeft=(onNone=function(){return sumAsAbsolute(points)},onRelative=function(){return sumAsAbsolute(points)},onFixed=function(){return function(positions){var points=map$2(positions,toFixed);return sum(points)}(points)},origin.fold(onNone,onRelative,onFixed)),anchorBox=function(x,y,width,height){return{x:x,y:y,width:width,height:height}}(topLeft.left,topLeft.top,box.width,box.height),layoutsLtr=anchorInfo.showAbove?aboveOrBelow():belowOrAbove(),layoutsRtl=anchorInfo.showAbove?aboveOrBelowRtl():belowOrAboveRtl(),layouts=get$4(elem,anchorInfo,layoutsLtr,layoutsRtl,layoutsLtr,layoutsRtl,Optional.none());return nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()})}))},NodeAnchor=[required$1("node"),required$1("root"),option("bubble"),schema$y(),defaulted("overrides",{}),defaulted("showAbove",!1),output$1("placement",(function(component,anchorInfo,origin){var rootPoint=getRootPoint(component,0,anchorInfo);return anchorInfo.node.filter(inBody).bind((function(target){var rect=target.dom.getBoundingClientRect(),nodeBox=getBox(rect.left,rect.top,rect.width,rect.height),elem=anchorInfo.node.getOr(component.element);return calcNewAnchor(nodeBox,rootPoint,anchorInfo,origin,elem)}))}))],SimRange_create=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},adt$6=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ_getStart=(adt$6.before,adt$6.on,adt$6.after,function(situ){return situ.fold(identity$1,identity$1,identity$1)}),adt$5=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt$5.domRange,relative:adt$5.relative,exact:adt$5.exact,exactFromRange:function(simRange){return adt$5.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){var start=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ_getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return defaultView(start)},range:SimRange_create},relativeToNative=function(win,startSitu,finishSitu){var rng,range=win.document.createRange();return rng=range,startSitu.fold((function(e){rng.setStartBefore(e.dom)}),(function(e,o){rng.setStart(e.dom,o)}),(function(e){rng.setStartAfter(e.dom)})),function(rng,situ){situ.fold((function(e){rng.setEndBefore(e.dom)}),(function(e,o){rng.setEnd(e.dom,o)}),(function(e){rng.setEndAfter(e.dom)}))}(range,finishSitu),range},exactToNative=function(win,start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},toRect=function(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height}},adt$4=Adt_generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),fromRange=function(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset)},diagnose=function(win,selection){return function(win,ranges){var rng=ranges.ltr();return rng.collapsed?ranges.rtl().filter((function(rev){return!1===rev.collapsed})).map((function(rev){return adt$4.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)})).getOrThunk((function(){return fromRange(0,adt$4.ltr,rng)})):fromRange(0,adt$4.ltr,rng)}(0,function(win,selection){return selection.match({domRange:function(rng){return{ltr:constant$1(rng),rtl:Optional.none}},relative:function(startSitu,finishSitu){return{ltr:cached((function(){return relativeToNative(win,startSitu,finishSitu)})),rtl:cached((function(){return Optional.some(relativeToNative(win,finishSitu,startSitu))}))}},exact:function(start,soffset,finish,foffset){return{ltr:cached((function(){return exactToNative(win,start,soffset,finish,foffset)})),rtl:cached((function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset))}))}}})}(win,selection))},asLtrRange=function(win,selection){return diagnose(win,selection).match({ltr:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},rtl:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(finish.dom,foffset),rng.setEnd(start.dom,soffset),rng}})};adt$4.ltr,adt$4.rtl;var FocusInsideModes,api=function(is,name){var getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()};return{get:function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText$1,"text"),getOption=function(element){return api.getOption(element)},elementsWithCursorPosition=["img","br"],isCursorPosition=function(elem){return getOption(elem).filter((function(text){return 0!==text.trim().length||text.indexOf("Â ")>-1})).isSome()||contains$2(elementsWithCursorPosition,name$2(elem))},descendantRtl=function(scope,predicate){var descend=function(element){for(var children$1=children(element),i=children$1.length-1;i>=0;i--){var child=children$1[i];if(predicate(child))return Optional.some(child);var res=descend(child);if(res.isSome())return res}return Optional.none()};return descend(scope)},descendants=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map$2(base.querySelectorAll(selector),SugarElement.fromDom)}(selector,scope)},after=function(start,soffset,finish,foffset){var r=function(start,soffset,finish,foffset){var rng=owner$4(start).dom.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng}(start,soffset,finish,foffset),same=eq(start,finish)&&soffset===foffset;return r.collapsed&&!same},readRange=function(selection){if(selection.rangeCount>0){var firstRng=selection.getRangeAt(0),lastRng=selection.getRangeAt(selection.rangeCount-1);return Optional.some(SimRange_create(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(lastRng.endContainer),lastRng.endOffset))}return Optional.none()},doGetExact=function(selection){if(null===selection.anchorNode||null===selection.focusNode)return readRange(selection);var anchor=SugarElement.fromDom(selection.anchorNode),focus_1=SugarElement.fromDom(selection.focusNode);return after(anchor,selection.anchorOffset,focus_1,selection.focusOffset)?Optional.some(SimRange_create(anchor,selection.anchorOffset,focus_1,selection.focusOffset)):readRange(selection)},getExact=function(win){return function(win){return Optional.from(win.getSelection())}(win).filter((function(sel){return sel.rangeCount>0})).bind(doGetExact)},getFirstRect=function(win,selection){return function(rng){var rects=rng.getClientRects(),rect=rects.length>0?rects[0]:rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none()}(asLtrRange(win,selection))},getBounds$1=function(win,selection){return function(rng){var rect=rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none()}(asLtrRange(win,selection))},point$1=function(element,offset){return{element:element,offset:offset}},descendOnce$1=function(element,offset){var children$1=children(element);if(0===children$1.length)return point$1(element,offset);if(offset<children$1.length)return point$1(children$1[offset],0);var last=children$1[children$1.length-1],len=isText$1(last)?function(element){return api.get(element)}(last).length:children(last).length;return point$1(last,len)},descendOnce=function(element,offset){return isText$1(element)?point$1(element,offset):descendOnce$1(element,offset)},getAnchorSelection=function(win,anchorInfo){return anchorInfo.getSelection.getOrThunk((function(){return function(){return getExact(win)}}))().map((function(sel){var modStart=descendOnce(sel.start,sel.soffset),modFinish=descendOnce(sel.finish,sel.foffset);return SimSelection.range(modStart.element,modStart.offset,modFinish.element,modFinish.offset)}))},SelectionAnchor=[option("getSelection"),required$1("root"),option("bubble"),schema$y(),defaulted("overrides",{}),defaulted("showAbove",!1),output$1("placement",(function(component,anchorInfo,origin){var win=defaultView(anchorInfo.root).dom,rootPoint=getRootPoint(component,0,anchorInfo),selectionBox=getAnchorSelection(win,anchorInfo).bind((function(sel){return getBounds$1(win,SimSelection.exactFromRange(sel)).orThunk((function(){var x=SugarElement.fromText("\ufeff");before$2(sel.start,x);var rect=getFirstRect(win,SimSelection.exact(x,0,x,1));return remove$5(x),rect})).bind((function(rawRect){return getBox(rawRect.left,rawRect.top,rawRect.width,rawRect.height)}))})),elem=getAnchorSelection(win,anchorInfo).bind((function(sel){return isElement$2(sel.start)?Optional.some(sel.start):function(element){return parent(element)}(sel.start)})).getOr(component.element);return calcNewAnchor(selectionBox,rootPoint,anchorInfo,origin,elem)}))],eastX=function(anchor){return anchor.x+anchor.width},westX=function(anchor,element){return anchor.x-element.width},northY$1=function(anchor,element){return anchor.y-element.height+anchor.height},southY$1=function(anchor){return anchor.y},southeast$1=function(anchor,element,bubbles){return nu$6(eastX(anchor),southY$1(anchor),bubbles.southeast(),southeast$3(),"southeast",boundsRestriction(anchor,{left:0,top:2}),"link-layout")},southwest$1=function(anchor,element,bubbles){return nu$6(westX(anchor,element),southY$1(anchor),bubbles.southwest(),southwest$3(),"southwest",boundsRestriction(anchor,{right:1,top:2}),"link-layout")},northeast$1=function(anchor,element,bubbles){return nu$6(eastX(anchor),northY$1(anchor,element),bubbles.northeast(),northeast$3(),"northeast",boundsRestriction(anchor,{left:0,bottom:3}),"link-layout")},northwest$1=function(anchor,element,bubbles){return nu$6(westX(anchor,element),northY$1(anchor,element),bubbles.northwest(),northwest$3(),"northwest",boundsRestriction(anchor,{right:1,bottom:3}),"link-layout")},all=function(){return[southeast$1,southwest$1,northeast$1,northwest$1]},allRtl=function(){return[southwest$1,southeast$1,northwest$1,northeast$1]},SubmenuAnchor=[required$1("item"),schema$y(),defaulted("overrides",{}),output$1("placement",(function(component,submenuInfo,origin){var anchorBox=toBox(origin,submenuInfo.item.element),layouts=get$4(component.element,submenuInfo,all(),allRtl(),all(),allRtl(),Optional.none());return Optional.some(nu$4({anchorBox:anchorBox,bubble:fallback(),overrides:submenuInfo.overrides,layouts:layouts,placer:Optional.none()}))}))],AnchorSchema=choose$1("type",{selection:SelectionAnchor,node:NodeAnchor,hotspot:HotspotAnchor,submenu:SubmenuAnchor,makeshift:MakeshiftAnchor}),TransitionSchema=[requiredArrayOf("classes",string),defaultedStringEnum("mode","all",["all","layout","placement"])],PositionSchema=[defaulted("useFixed",never),option("getBounds")],PlacementSchema=[requiredOf("anchor",AnchorSchema),optionObjOf("transition",TransitionSchema)],place=function(component,origin,anchoring,getBounds,placee,lastPlace,transition){return function(anchor,element,bubble,layouts,lastPlacement,getBounds,overrideOptions,transition){var maxHeightFunction=defaultOr(overrideOptions,"maxHeightFunction",anchored()),maxWidthFunction=defaultOr(overrideOptions,"maxWidthFunction",noop),anchorBox=anchor.anchorBox,origin=anchor.origin,options={bounds:viewport(origin,getBounds),origin:origin,preference:layouts,maxHeightFunction:maxHeightFunction,maxWidthFunction:maxWidthFunction,lastPlacement:lastPlacement,transition:transition};return go(anchorBox,element,bubble,options)}(box(anchoring.anchorBox,origin),placee.element,anchoring.bubble,anchoring.layouts,lastPlace,getBounds,anchoring.overrides,transition)},positionWithin=function(component,posConfig,posState,placee,placementSpec,boxElement){var boundsBox=boxElement.map(box$1);return positionWithinBounds(component,posConfig,posState,placee,placementSpec,boundsBox)},positionWithinBounds=function(component,posConfig,posState,placee,placementSpec,bounds){var placeeDetail=asRawOrDie$1("placement.info",objOf(PlacementSchema),placementSpec),anchorage=placeeDetail.anchor,element=placee.element,placeeState=posState.get(placee.uid);preserve$1((function(){set$7(element,"position","fixed");var oldVisibility=getRaw(element,"visibility");set$7(element,"visibility","hidden");var html,origin=posConfig.useFixed()?(html=document.documentElement,fixed$1(0,0,html.clientWidth,html.clientHeight)):function(component){var position=absolute$3(component.element),bounds=component.element.dom.getBoundingClientRect();return relative$1(position.left,position.top,bounds.width,bounds.height)}(component),placer=anchorage.placement,getBounds=bounds.map(constant$1).or(posConfig.getBounds);placer(component,anchorage,origin).each((function(anchoring){var newState=anchoring.placer.getOr(place)(component,origin,anchoring,getBounds,placee,placeeState,placeeDetail.transition);posState.set(placee.uid,newState)})),oldVisibility.fold((function(){remove$6(element,"visibility")}),(function(vis){set$7(element,"visibility",vis)})),getRaw(element,"left").isNone()&&getRaw(element,"top").isNone()&&getRaw(element,"right").isNone()&&getRaw(element,"bottom").isNone()&&is$1(getRaw(element,"position"),"fixed")&&remove$6(element,"position")}),element)},PositionApis=Object.freeze({__proto__:null,position:function(component,posConfig,posState,placee,placementSpec){positionWithin(component,posConfig,posState,placee,placementSpec,Optional.none())},positionWithin:positionWithin,positionWithinBounds:positionWithinBounds,getMode:function(component,pConfig,_pState){return pConfig.useFixed()?"fixed":"absolute"},reset:function(component,pConfig,posState,placee){var element=placee.element;each$1(["position","left","right","top","bottom"],(function(prop){return remove$6(element,prop)})),function(element){remove$7(element,"data-alloy-placement")}(element),posState.clear(placee.uid)}}),PositioningState=Object.freeze({__proto__:null,init:function(){var state={};return nu$8({readState:function(){return state},clear:function(id){isNonNullable(id)?delete state[id]:state={}},set:function(id,data){state[id]=data},get:function(id){return get$e(state,id)}})}}),Positioning=create$7({fields:PositionSchema,name:"positioning",active:ActivePosition,apis:PositionApis,state:PositioningState}),fireDetaching=function(component){emit(component,detachedFromDom());var children=component.components();each$1(children,fireDetaching)},fireAttaching=function(component){var children=component.components();each$1(children,fireAttaching),emit(component,attachedToDom())},attach$1=function(parent,child){append$2(parent.element,child.element)},replaceChildren=function(component,newChildren){var subs=component.components();!function(component){each$1(component.components(),(function(childComp){return remove$5(childComp.element)})),empty(component.element),component.syncComponents()}(component);var deleted=difference(subs,newChildren);each$1(deleted,(function(comp){fireDetaching(comp),component.getSystem().removeFromWorld(comp)})),each$1(newChildren,(function(childComp){childComp.getSystem().isConnected()?attach$1(component,childComp):(component.getSystem().addToWorld(childComp),attach$1(component,childComp),inBody(component.element)&&fireAttaching(childComp)),component.syncComponents()}))},attach=function(parent,child){attachWith(parent,child,append$2)},attachWith=function(parent,child,insertion){parent.getSystem().addToWorld(child),insertion(parent.element,child.element),inBody(parent.element)&&fireAttaching(child),parent.syncComponents()},doDetach=function(component){fireDetaching(component),remove$5(component.element),component.getSystem().removeFromWorld(component)},detach=function(component){var parent$1=parent(component.element).bind((function(p){return component.getSystem().getByDom(p).toOptional()}));doDetach(component),parent$1.each((function(p){p.syncComponents()}))},detachChildren=function(component){var subs=component.components();each$1(subs,doDetach),empty(component.element),component.syncComponents()},attachSystem=function(element,guiSystem){attachSystemWith(element,guiSystem,append$2)},attachSystemWith=function(element,guiSystem,inserter){inserter(element,guiSystem.element);var children$1=children(guiSystem.element);each$1(children$1,(function(child){guiSystem.getByDom(child).each(fireAttaching)}))},detachSystem=function(guiSystem){var children$1=children(guiSystem.element);each$1(children$1,(function(child){guiSystem.getByDom(child).each(fireDetaching)})),remove$5(guiSystem.element)},rebuild=function(sandbox,sConfig,sState,data){sState.get().each((function(_data){detachChildren(sandbox)}));var point=sConfig.getAttachPoint(sandbox);attach(point,sandbox);var built=sandbox.getSystem().build(data);return attach(sandbox,built),sState.set(built),built},open$1=function(sandbox,sConfig,sState,data){var newState=rebuild(sandbox,sConfig,sState,data);return sConfig.onOpen(sandbox,newState),newState},close$1=function(sandbox,sConfig,sState){sState.get().each((function(data){detachChildren(sandbox),detach(sandbox),sConfig.onClose(sandbox,data),sState.clear()}))},isOpen$1=function(_sandbox,_sConfig,sState){return sState.isOpen()},cloak=function(sandbox,sConfig,_sState){var sink=sConfig.getAttachPoint(sandbox);set$7(sandbox.element,"position",Positioning.getMode(sink)),function(sandbox,cssKey,attr,newValue){getRaw(sandbox.element,cssKey).fold((function(){remove$7(sandbox.element,attr)}),(function(v){set$8(sandbox.element,attr,v)})),set$7(sandbox.element,cssKey,newValue)}(sandbox,"visibility",sConfig.cloakVisibilityAttr,"hidden")},decloak=function(sandbox,sConfig,_sState){(function(element){return exists(["top","left","right","bottom"],(function(pos){return getRaw(element,pos).isSome()}))})(sandbox.element)||remove$6(sandbox.element,"position"),function(sandbox,cssKey,attr){getOpt(sandbox.element,attr).fold((function(){return remove$6(sandbox.element,cssKey)}),(function(oldValue){return set$7(sandbox.element,cssKey,oldValue)}))}(sandbox,"visibility",sConfig.cloakVisibilityAttr)},SandboxApis=Object.freeze({__proto__:null,cloak:cloak,decloak:decloak,open:open$1,openWhileCloaked:function(sandbox,sConfig,sState,data,transaction){cloak(sandbox,sConfig),open$1(sandbox,sConfig,sState,data),transaction(),decloak(sandbox,sConfig)},close:close$1,isOpen:isOpen$1,isPartOf:function(sandbox,sConfig,sState,queryElem){return isOpen$1(0,0,sState)&&sState.get().exists((function(data){return sConfig.isPartOf(sandbox,data,queryElem)}))},getState:function(_sandbox,_sConfig,sState){return sState.get()},setContent:function(sandbox,sConfig,sState,data){return sState.get().map((function(){return rebuild(sandbox,sConfig,sState,data)}))}}),ActiveSandbox=Object.freeze({__proto__:null,events:function(sandboxConfig,sandboxState){return derive$2([run$1(sandboxClose(),(function(sandbox,_simulatedEvent){close$1(sandbox,sandboxConfig,sandboxState)}))])}}),SandboxSchema=[onHandler("onOpen"),onHandler("onClose"),required$1("isPartOf"),required$1("getAttachPoint"),defaulted("cloakVisibilityAttr","data-precloak-visibility")],Sandboxing=create$7({fields:SandboxSchema,name:"sandboxing",active:ActiveSandbox,apis:SandboxApis,state:Object.freeze({__proto__:null,init:function(){var contents=value$1(),readState=constant$1("not-implemented");return nu$8({readState:readState,isOpen:contents.isSet,clear:contents.clear,set:contents.set,get:contents.get})}})}),dismissPopups=constant$1("dismiss.popups"),repositionPopups=constant$1("reposition.popups"),mouseReleased=constant$1("mouse.released"),schema$x=objOfOnly([defaulted("isExtraPart",never),optionObjOf("fireEventInstead",[defaulted("event",dismissRequested())])]),receivingChannel$1=function(rawSpec){var _a,detail=asRawOrDie$1("Dismissal",schema$x,rawSpec);return(_a={})[dismissPopups()]={schema:objOfOnly([required$1("target")]),onReceive:function(sandbox,data){Sandboxing.isOpen(sandbox)&&(Sandboxing.isPartOf(sandbox,data.target)||detail.isExtraPart(sandbox,data.target)||detail.fireEventInstead.fold((function(){return Sandboxing.close(sandbox)}),(function(fe){return emit(sandbox,fe.event)})))}},_a},schema$w=objOfOnly([optionObjOf("fireEventInstead",[defaulted("event",repositionRequested())]),requiredFunction("doReposition")]),receivingChannel=function(rawSpec){var _a,detail=asRawOrDie$1("Reposition",schema$w,rawSpec);return(_a={})[repositionPopups()]={onReceive:function(sandbox){Sandboxing.isOpen(sandbox)&&detail.fireEventInstead.fold((function(){return detail.doReposition(sandbox)}),(function(fe){return emit(sandbox,fe.event)}))}},_a},onLoad$5=function(component,repConfig,repState){repConfig.store.manager.onLoad(component,repConfig,repState)},onUnload$2=function(component,repConfig,repState){repConfig.store.manager.onUnload(component,repConfig,repState)},RepresentApis=Object.freeze({__proto__:null,onLoad:onLoad$5,onUnload:onUnload$2,setValue:function(component,repConfig,repState,data){repConfig.store.manager.setValue(component,repConfig,repState,data)},getValue:function(component,repConfig,repState){return repConfig.store.manager.getValue(component,repConfig,repState)},getState:function(component,repConfig,repState){return repState}}),ActiveRepresenting=Object.freeze({__proto__:null,events:function(repConfig,repState){var es=repConfig.resetOnDom?[runOnAttached((function(comp,_se){onLoad$5(comp,repConfig,repState)})),runOnDetached((function(comp,_se){onUnload$2(comp,repConfig,repState)}))]:[loadEvent(repConfig,repState,onLoad$5)];return derive$2(es)}}),memory$1=function(){var data=Cell(null);return nu$8({set:data.set,get:data.get,isNotSet:function(){return null===data.get()},clear:function(){data.set(null)},readState:function(){return{mode:"memory",value:data.get()}}})},dataset=function(){var dataByValue=Cell({}),dataByText=Cell({});return nu$8({readState:function(){return{mode:"dataset",dataByValue:dataByValue.get(),dataByText:dataByText.get()}},lookup:function(itemString){return get$e(dataByValue.get(),itemString).orThunk((function(){return get$e(dataByText.get(),itemString)}))},update:function(items){var currentDataByValue=dataByValue.get(),currentDataByText=dataByText.get(),newDataByValue={},newDataByText={};each$1(items,(function(item){newDataByValue[item.value]=item,get$e(item,"meta").each((function(meta){get$e(meta,"text").each((function(text){newDataByText[text]=item}))}))})),dataByValue.set(__assign(__assign({},currentDataByValue),newDataByValue)),dataByText.set(__assign(__assign({},currentDataByText),newDataByText))},clear:function(){dataByValue.set({}),dataByText.set({})}})},RepresentState=Object.freeze({__proto__:null,memory:memory$1,dataset:dataset,manual:function(){return nu$8({readState:noop})},init:function(spec){return spec.store.manager.state(spec)}}),setValue$2=function(component,repConfig,repState,data){var store=repConfig.store;repState.update([data]),store.setValue(component,data),repConfig.onSetValue(component,data)},DatasetStore=[option("initialValue"),required$1("getFallbackEntry"),required$1("getDataKey"),required$1("setValue"),output$1("manager",{setValue:setValue$2,getValue:function(component,repConfig,repState){var store=repConfig.store,key=store.getDataKey(component);return repState.lookup(key).getOrThunk((function(){return store.getFallbackEntry(key)}))},onLoad:function(component,repConfig,repState){repConfig.store.initialValue.each((function(data){setValue$2(component,repConfig,repState,data)}))},onUnload:function(component,repConfig,repState){repState.clear()},state:dataset})],ManualStore=[required$1("getValue"),defaulted("setValue",noop),option("initialValue"),output$1("manager",{setValue:function(component,repConfig,_repState,data){repConfig.store.setValue(component,data),repConfig.onSetValue(component,data)},getValue:function(component,repConfig,_repState){return repConfig.store.getValue(component)},onLoad:function(component,repConfig,_repState){repConfig.store.initialValue.each((function(data){repConfig.store.setValue(component,data)}))},onUnload:noop,state:NoState.init})],MemoryStore=[option("initialValue"),output$1("manager",{setValue:function(component,repConfig,repState,data){repState.set(data),repConfig.onSetValue(component,data)},getValue:function(component,repConfig,repState){return repState.get()},onLoad:function(component,repConfig,repState){repConfig.store.initialValue.each((function(initVal){repState.isNotSet()&&repState.set(initVal)}))},onUnload:function(component,repConfig,repState){repState.clear()},state:memory$1})],RepresentSchema=[defaultedOf("store",{mode:"memory"},choose$1("mode",{memory:MemoryStore,manual:ManualStore,dataset:DatasetStore})),onHandler("onSetValue"),defaulted("resetOnDom",!1)],Representing=create$7({fields:RepresentSchema,name:"representing",active:ActiveRepresenting,apis:RepresentApis,extra:{setValueFrom:function(component,source){var value=Representing.getValue(source);Representing.setValue(component,value)}},state:RepresentState}),field=function(name,forbidden){return defaultedObjOf(name,{},map$2(forbidden,(function(f){return key=f.name(),message="Cannot configure "+f.name()+" for "+name,field$1(key,key,{tag:"option",process:{}},value$2((function(_v){return SimpleResult_serror("The field: "+key+" is forbidden. "+message)})));var key,message})).concat([customField("dump",identity$1)]))},get$2=function(data){return data.dump},augment=function(data,original){return __assign(__assign({},derive$1(original)),data.dump)},SketchBehaviours_field=field,SketchBehaviours_augment=augment,adt$3=Adt_generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),isSubstituted=function(spec){return has$2(spec,"uiType")},scan=function(owner,detail,compSpec,placeholders){return isSubstituted(compSpec)&&"placeholder"===compSpec.uiType?function(owner,detail,compSpec,placeholders){return owner.exists((function(o){return o!==compSpec.owner}))?adt$3.single(!0,constant$1(compSpec)):get$e(placeholders,compSpec.name).fold((function(){throw new Error("Unknown placeholder component: "+compSpec.name+"\nKnown: ["+keys(placeholders)+"]\nNamespace: "+owner.getOr("none")+"\nSpec: "+JSON.stringify(compSpec,null,2))}),(function(newSpec){return newSpec.replace()}))}(owner,0,compSpec,placeholders):adt$3.single(!1,constant$1(compSpec))},substitute=function(owner,detail,compSpec,placeholders){return scan(owner,0,compSpec,placeholders).fold((function(req,valueThunk){var value=isSubstituted(compSpec)?valueThunk(detail,compSpec.config,compSpec.validated):valueThunk(detail),childSpecs=get$e(value,"components").getOr([]),substituted=bind$3(childSpecs,(function(c){return substitute(owner,detail,c,placeholders)}));return[__assign(__assign({},value),{components:substituted})]}),(function(req,valuesThunk){if(isSubstituted(compSpec)){var values=valuesThunk(detail,compSpec.config,compSpec.validated);return compSpec.validated.preprocess.getOr(identity$1)(values)}return valuesThunk(detail)}))},substitutePlaces=function(owner,detail,components,placeholders){var ps=map$1(placeholders,(function(ph,name){return replacements=ph,called=!1,{name:constant$1(label=name),required:function(){return replacements.fold((function(req,_){return req}),(function(req,_){return req}))},used:function(){return called},replace:function(){if(called)throw new Error("Trying to use the same placeholder more than once: "+label);return called=!0,replacements}};var label,replacements,called})),outcome=function(owner,detail,components,placeholders){return bind$3(components,(function(c){return substitute(owner,detail,c,placeholders)}))}(owner,detail,components,ps);return each(ps,(function(p){if(!1===p.used()&&p.required())throw new Error("Placeholder: "+p.name()+" was not found in components list\nNamespace: "+owner.getOr("none")+"\nComponents: "+JSON.stringify(detail.components,null,2))})),outcome},single$2=adt$3.single,multiple=adt$3.multiple,placeholder=constant$1("placeholder"),adt$2=Adt_generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),fFactory=defaulted("factory",{sketch:identity$1}),fSchema=defaulted("schema",[]),fName=required$1("name"),fPname=field$1("pname","pname",defaultedThunk((function(typeSpec){return"<alloy."+generate$6(typeSpec.name)+">"})),anyValue()),fGroupSchema=customField("schema",(function(){return[option("preprocess")]})),fDefaults=defaulted("defaults",constant$1({})),fOverrides=defaulted("overrides",constant$1({})),requiredSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]),externalSpec=objOf([fFactory,fSchema,fName,fDefaults,fOverrides]),optionalSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]),groupSpec=objOf([fFactory,fGroupSchema,fName,required$1("unit"),fPname,fDefaults,fOverrides]),asNamedPart=function(part){return part.fold(Optional.some,Optional.none,Optional.some,Optional.some)},name$1=function(part){var get=function(data){return data.name};return part.fold(get,get,get,get)},convert=function(adtConstructor,partSchema){return function(spec){var data=asRawOrDie$1("Converting part type",partSchema,spec);return adtConstructor(data)}},required=convert(adt$2.required,requiredSpec),external$1=convert(adt$2.external,externalSpec),optional=convert(adt$2.optional,optionalSpec),group=convert(adt$2.group,groupSpec),original=constant$1("entirety"),PartType=Object.freeze({__proto__:null,required:required,external:external$1,optional:optional,group:group,asNamedPart:asNamedPart,name:name$1,asCommon:function(part){return part.fold(identity$1,identity$1,identity$1,identity$1)},original:original}),combine=function(detail,data,partSpec,partValidated){return deepMerge(data.defaults(detail,partSpec,partValidated),partSpec,{uid:detail.partUids[data.name]},data.overrides(detail,partSpec,partValidated))},generate$3=function(owner,parts){var r={};return each$1(parts,(function(part){asNamedPart(part).each((function(np){var g=doGenerateOne(owner,np.pname);r[np.name]=function(config){var validated=asRawOrDie$1("Part: "+np.name+" in "+owner,objOf(np.schema),config);return __assign(__assign({},g),{config:config,validated:validated})}}))})),r},doGenerateOne=function(owner,pname){return{uiType:placeholder(),owner:owner,name:pname}},generateOne$1=function(owner,pname,config){return{uiType:placeholder(),owner:owner,name:pname,config:config,validated:{}}},schemas=function(parts){return bind$3(parts,(function(part){return part.fold(Optional.none,Optional.some,Optional.none,Optional.none).map((function(data){return requiredObjOf(data.name,data.schema.concat([snapshot(original())]))})).toArray()}))},names=function(parts){return map$2(parts,name$1)},substitutes=function(owner,detail,parts){return function(owner,detail,parts){var internals={},externals={};return each$1(parts,(function(part){part.fold((function(data){internals[data.pname]=single$2(!0,(function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated))}))}),(function(data){var partSpec=detail.parts[data.name];externals[data.name]=constant$1(data.factory.sketch(combine(detail,data,partSpec[original()]),partSpec))}),(function(data){internals[data.pname]=single$2(!1,(function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated))}))}),(function(data){internals[data.pname]=multiple(!0,(function(detail,_partSpec,_partValidated){var units=detail[data.name];return map$2(units,(function(u){return data.factory.sketch(deepMerge(data.defaults(detail,u,_partValidated),u,data.overrides(detail,u)))}))}))}))})),{internals:constant$1(internals),externals:constant$1(externals)}}(0,detail,parts)},components$1=function(owner,detail,internals){return substitutePlaces(Optional.some(owner),detail,detail.components,internals)},getPart=function(component,detail,partKey){var uid=detail.partUids[partKey];return component.getSystem().getByUid(uid).toOptional()},getPartOrDie=function(component,detail,partKey){return getPart(component,detail,partKey).getOrDie("Could not find part: "+partKey)},getParts=function(component,detail,partKeys){var r={},uids=detail.partUids,system=component.getSystem();return each$1(partKeys,(function(pk){r[pk]=constant$1(system.getByUid(uids[pk]))})),r},getAllParts=function(component,detail){var system=component.getSystem();return map$1(detail.partUids,(function(pUid,_k){return constant$1(system.getByUid(pUid))}))},getAllPartNames=function(detail){return keys(detail.partUids)},getPartsOrDie=function(component,detail,partKeys){var r={},uids=detail.partUids,system=component.getSystem();return each$1(partKeys,(function(pk){r[pk]=constant$1(system.getByUid(uids[pk]).getOrDie())})),r},defaultUids=function(baseUid,partTypes){var partNames=names(partTypes);return wrapAll(map$2(partNames,(function(pn){return{key:pn,value:baseUid+"-"+pn}})))},defaultUidsSchema=function(partTypes){return field$1("partUids","partUids",mergeWithThunk((function(spec){return defaultUids(spec.uid,partTypes)})),anyValue())},AlloyParts=Object.freeze({__proto__:null,generate:generate$3,generateOne:generateOne$1,schemas:schemas,names:names,substitutes:substitutes,components:components$1,defaultUids:defaultUids,defaultUidsSchema:defaultUidsSchema,getAllParts:getAllParts,getAllPartNames:getAllPartNames,getPart:getPart,getPartOrDie:getPartOrDie,getParts:getParts,getPartsOrDie:getPartsOrDie}),asRawOrDie=function(label,schema,spec,partSchemas,partUidsSchemas){var baseS=function(partSchemas,partUidsSchemas){return(partSchemas.length>0?[requiredObjOf("parts",partSchemas)]:[]).concat([required$1("uid"),defaulted("dom",{}),defaulted("components",[]),snapshot("originalSpec"),defaulted("debug.sketcher",{})]).concat(partUidsSchemas)}(partSchemas,partUidsSchemas);return asRawOrDie$1(label+" [SpecSchema]",objOfOnly(baseS.concat(schema)),spec)},composite$1=function(owner,schema,partTypes,factory,spec){var specWithUid=supplyUid(spec),partSchemas=schemas(partTypes),partUidsSchema=defaultUidsSchema(partTypes),detail=asRawOrDie(owner,schema,specWithUid,partSchemas,[partUidsSchema]),subs=substitutes(0,detail,partTypes);return factory(detail,components$1(owner,detail,subs.internals()),specWithUid,subs.externals())},supplyUid=function(spec){return function(spec){return has$2(spec,"uid")}(spec)?spec:__assign(__assign({},spec),{uid:generate$5("uid")})},singleSchema=objOfOnly([required$1("name"),required$1("factory"),required$1("configFields"),defaulted("apis",{}),defaulted("extraApis",{})]),compositeSchema=objOfOnly([required$1("name"),required$1("factory"),required$1("configFields"),required$1("partFields"),defaulted("apis",{}),defaulted("extraApis",{})]),single=function(rawConfig){var config=asRawOrDie$1("Sketcher for "+rawConfig.name,singleSchema,rawConfig),apis=map$1(config.apis,makeApi),extraApis=map$1(config.extraApis,(function(f,k){return markAsExtraApi(f,k)}));return __assign(__assign({name:config.name,configFields:config.configFields,sketch:function(spec){return function(owner,schema,factory,spec){var specWithUid=supplyUid(spec);return factory(asRawOrDie(owner,schema,specWithUid,[],[]),specWithUid)}(config.name,config.configFields,config.factory,spec)}},apis),extraApis)},composite=function(rawConfig){var config=asRawOrDie$1("Sketcher for "+rawConfig.name,compositeSchema,rawConfig),parts=generate$3(config.name,config.partFields),apis=map$1(config.apis,makeApi),extraApis=map$1(config.extraApis,(function(f,k){return markAsExtraApi(f,k)}));return __assign(__assign({name:config.name,partFields:config.partFields,configFields:config.configFields,sketch:function(spec){return composite$1(config.name,config.configFields,config.partFields,config.factory,spec)},parts:parts},apis),extraApis)},inside=function(target){return"input"===name$2(target)&&"radio"!==get$d(target,"type")||"textarea"===name$2(target)},ComposeApis=Object.freeze({__proto__:null,getCurrent:function(component,composeConfig,_composeState){return composeConfig.find(component)}}),ComposeSchema=[required$1("find")],Composing=create$7({fields:ComposeSchema,name:"composing",apis:ComposeApis}),nativeDisabled=["input","button","textarea","select"],onLoad$1=function(component,disableConfig,disableState){(disableConfig.disabled()?disable$1:enable$1)(component,disableConfig)},hasNative=function(component,config){return!0===config.useNative&&contains$2(nativeDisabled,name$2(component.element))},nativeDisable=function(component){set$8(component.element,"disabled","disabled")},nativeEnable=function(component){remove$7(component.element,"disabled")},ariaDisable=function(component){set$8(component.element,"aria-disabled","true")},ariaEnable=function(component){set$8(component.element,"aria-disabled","false")},disable$1=function(component,disableConfig,_disableState){disableConfig.disableClass.each((function(disableClass){add$2(component.element,disableClass)})),(hasNative(component,disableConfig)?nativeDisable:ariaDisable)(component),disableConfig.onDisabled(component)},enable$1=function(component,disableConfig,_disableState){disableConfig.disableClass.each((function(disableClass){remove$2(component.element,disableClass)})),(hasNative(component,disableConfig)?nativeEnable:ariaEnable)(component),disableConfig.onEnabled(component)},isDisabled=function(component,disableConfig){return hasNative(component,disableConfig)?function(component){return has$1(component.element,"disabled")}(component):function(component){return"true"===get$d(component.element,"aria-disabled")}(component)},DisableApis=Object.freeze({__proto__:null,enable:enable$1,disable:disable$1,isDisabled:isDisabled,onLoad:onLoad$1,set:function(component,disableConfig,disableState,disabled){(disabled?disable$1:enable$1)(component,disableConfig)}}),ActiveDisable=Object.freeze({__proto__:null,exhibit:function(base,disableConfig){return nu$7({classes:disableConfig.disabled()?disableConfig.disableClass.toArray():[]})},events:function(disableConfig,disableState){return derive$2([abort(execute$5(),(function(component,_simulatedEvent){return isDisabled(component,disableConfig)})),loadEvent(disableConfig,disableState,onLoad$1)])}}),DisableSchema=[defaultedFunction("disabled",never),defaulted("useNative",!0),option("disableClass"),onHandler("onDisabled"),onHandler("onEnabled")],Disabling=create$7({fields:DisableSchema,name:"disabling",active:ActiveDisable,apis:DisableApis}),dehighlightAllExcept=function(component,hConfig,hState,skip){var highlighted=descendants(component.element,"."+hConfig.highlightClass);each$1(highlighted,(function(h){exists(skip,(function(skipComp){return skipComp.element===h}))||(remove$2(h,hConfig.highlightClass),component.getSystem().getByDom(h).each((function(target){hConfig.onDehighlight(component,target),emit(target,dehighlight$1())})))}))},highlight=function(component,hConfig,hState,target){dehighlightAllExcept(component,hConfig,0,[target]),isHighlighted(component,hConfig,hState,target)||(add$2(target.element,hConfig.highlightClass),hConfig.onHighlight(component,target),emit(target,highlight$1()))},isHighlighted=function(component,hConfig,hState,queryTarget){return has(queryTarget.element,hConfig.highlightClass)},getByIndex=function(component,hConfig,hState,index){var items=descendants(component.element,"."+hConfig.itemClass);return Optional.from(items[index]).fold((function(){return Result.error(new Error("No element found with index "+index))}),component.getSystem().getByDom)},getFirst=function(component,hConfig,_hState){return descendant(component.element,"."+hConfig.itemClass).bind((function(e){return component.getSystem().getByDom(e).toOptional()}))},getLast=function(component,hConfig,_hState){var items=descendants(component.element,"."+hConfig.itemClass);return(items.length>0?Optional.some(items[items.length-1]):Optional.none()).bind((function(c){return component.getSystem().getByDom(c).toOptional()}))},getDelta$2=function(component,hConfig,hState,delta){var items=descendants(component.element,"."+hConfig.itemClass);return findIndex$1(items,(function(item){return has(item,hConfig.highlightClass)})).bind((function(selected){var dest=cycleBy(selected,delta,0,items.length-1);return component.getSystem().getByDom(items[dest]).toOptional()}))},getCandidates=function(component,hConfig,_hState){var items=descendants(component.element,"."+hConfig.itemClass);return cat(map$2(items,(function(i){return component.getSystem().getByDom(i).toOptional()})))},HighlightApis=Object.freeze({__proto__:null,dehighlightAll:function(component,hConfig,hState){return dehighlightAllExcept(component,hConfig,0,[])},dehighlight:function(component,hConfig,hState,target){isHighlighted(component,hConfig,hState,target)&&(remove$2(target.element,hConfig.highlightClass),hConfig.onDehighlight(component,target),emit(target,dehighlight$1()))},highlight:highlight,highlightFirst:function(component,hConfig,hState){getFirst(component,hConfig).each((function(firstComp){highlight(component,hConfig,hState,firstComp)}))},highlightLast:function(component,hConfig,hState){getLast(component,hConfig).each((function(lastComp){highlight(component,hConfig,hState,lastComp)}))},highlightAt:function(component,hConfig,hState,index){getByIndex(component,hConfig,hState,index).fold((function(err){throw err}),(function(firstComp){highlight(component,hConfig,hState,firstComp)}))},highlightBy:function(component,hConfig,hState,predicate){var candidates=getCandidates(component,hConfig);find$5(candidates,predicate).each((function(c){highlight(component,hConfig,hState,c)}))},isHighlighted:isHighlighted,getHighlighted:function(component,hConfig,_hState){return descendant(component.element,"."+hConfig.highlightClass).bind((function(e){return component.getSystem().getByDom(e).toOptional()}))},getFirst:getFirst,getLast:getLast,getPrevious:function(component,hConfig,hState){return getDelta$2(component,hConfig,0,-1)},getNext:function(component,hConfig,hState){return getDelta$2(component,hConfig,0,1)},getCandidates:getCandidates}),HighlightSchema=[required$1("highlightClass"),required$1("itemClass"),onHandler("onHighlight"),onHandler("onDehighlight")],Highlighting=create$7({fields:HighlightSchema,name:"highlighting",apis:HighlightApis}),BACKSPACE=[8],TAB=[9],ENTER=[13],ESCAPE=[27],SPACE=[32],LEFT=[37],UP=[38],RIGHT=[39],DOWN=[40],cyclePrev=function(values,index,predicate){var before=reverse(values.slice(0,index)),after=reverse(values.slice(index+1));return find$5(before.concat(after),predicate)},tryPrev=function(values,index,predicate){var before=reverse(values.slice(0,index));return find$5(before,predicate)},cycleNext=function(values,index,predicate){var before=values.slice(0,index),after=values.slice(index+1);return find$5(after.concat(before),predicate)},tryNext=function(values,index,predicate){var after=values.slice(index+1);return find$5(after,predicate)},inSet=function(keys){return function(event){var raw=event.raw;return contains$2(keys,raw.which)}},and=function(preds){return function(event){return forall(preds,(function(pred){return pred(event)}))}},isShift=function(event){return!0===event.raw.shiftKey},isControl=function(event){return!0===event.raw.ctrlKey},isNotShift=not(isShift),rule=function(matches,action){return{matches:matches,classification:action}},reportFocusShifting=function(component,prevFocus,newFocus){prevFocus.exists((function(p){return newFocus.exists((function(n){return eq(n,p)}))}))||emitWith(component,focusShifted(),{prevFocus:prevFocus,newFocus:newFocus})},dom$2=function(){var get=function(component){return search(component.element)};return{get:get,set:function(component,focusee){var prevFocus=get(component);component.getSystem().triggerFocus(focusee,component.element);var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus)}}},highlights=function(){var get=function(component){return Highlighting.getHighlighted(component).map((function(item){return item.element}))};return{get:get,set:function(component,element){var prevFocus=get(component);component.getSystem().getByDom(element).fold(noop,(function(item){Highlighting.highlight(component,item)}));var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus)}}};!function(FocusInsideModes){FocusInsideModes.OnFocusMode="onFocus",FocusInsideModes.OnEnterOrSpaceMode="onEnterOrSpace",FocusInsideModes.OnApiMode="onApi"}(FocusInsideModes||(FocusInsideModes={}));var initialState,typical=function(infoSchema,stateInit,getKeydownRules,getKeyupRules,optFocusIn){var processKey=function(component,simulatedEvent,getRules,keyingConfig,keyingState){var transitions,event,rules=getRules(component,simulatedEvent,keyingConfig,keyingState);return(transitions=rules,event=simulatedEvent.event,find$5(transitions,(function(t){return t.matches(event)})).map((function(t){return t.classification}))).bind((function(rule){return rule(component,simulatedEvent,keyingConfig,keyingState)}))},me={schema:function(){return infoSchema.concat([defaulted("focusManager",dom$2()),defaultedOf("focusInside","onFocus",valueOf((function(val){return contains$2(["onFocus","onEnterOrSpace","onApi"],val)?Result.value(val):Result.error("Invalid value for focusInside")}))),output$1("handler",me),output$1("state",stateInit),output$1("sendFocusIn",optFocusIn)])},processKey:processKey,toEvents:function(keyingConfig,keyingState){var onFocusHandler=keyingConfig.focusInside!==FocusInsideModes.OnFocusMode?Optional.none():optFocusIn(keyingConfig).map((function(focusIn){return run$1(focus$4(),(function(component,simulatedEvent){focusIn(component,keyingConfig,keyingState),simulatedEvent.stop()}))})),keyboardEvents=[run$1(keydown(),(function(component,simulatedEvent){processKey(component,simulatedEvent,getKeydownRules,keyingConfig,keyingState).fold((function(){!function(component,simulatedEvent){var isEnterOrSpace=inSet(SPACE.concat(ENTER))(simulatedEvent.event);keyingConfig.focusInside===FocusInsideModes.OnEnterOrSpaceMode&&isEnterOrSpace&&isSource(component,simulatedEvent)&&optFocusIn(keyingConfig).each((function(focusIn){focusIn(component,keyingConfig,keyingState),simulatedEvent.stop()}))}(component,simulatedEvent)}),(function(_){simulatedEvent.stop()}))})),run$1(keyup(),(function(component,simulatedEvent){processKey(component,simulatedEvent,getKeyupRules,keyingConfig,keyingState).each((function(_){simulatedEvent.stop()}))}))];return derive$2(onFocusHandler.toArray().concat(keyboardEvents))}};return me},create$5=function(cyclicField){var schema=[option("onEscape"),option("onEnter"),defaulted("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),defaulted("firstTabstop",0),defaulted("useTabstopAt",always),option("visibilitySelector")].concat([cyclicField]),isVisible=function(tabbingConfig,element){var target=tabbingConfig.visibilitySelector.bind((function(sel){return closest$1(element,sel)})).getOr(element);return get$b(target)>0},focusIn=function(component,tabbingConfig,_tabbingState){(function(component,tabbingConfig){var tabstops=descendants(component.element,tabbingConfig.selector),visibles=filter$2(tabstops,(function(elem){return isVisible(tabbingConfig,elem)}));return Optional.from(visibles[tabbingConfig.firstTabstop])})(component,tabbingConfig).each((function(target){tabbingConfig.focusManager.set(component,target)}))},goFromTabstop=function(component,tabstops,stopIndex,tabbingConfig,cycle){return cycle(tabstops,stopIndex,(function(elem){return function(tabbingConfig,element){return isVisible(tabbingConfig,element)&&tabbingConfig.useTabstopAt(element)}(tabbingConfig,elem)})).fold((function(){return tabbingConfig.cyclic?Optional.some(!0):Optional.none()}),(function(target){return tabbingConfig.focusManager.set(component,target),Optional.some(!0)}))},go=function(component,_simulatedEvent,tabbingConfig,cycle){var tabstops=descendants(component.element,tabbingConfig.selector);return function(component,tabbingConfig){return tabbingConfig.focusManager.get(component).bind((function(elem){return closest$1(elem,tabbingConfig.selector)}))}(component,tabbingConfig).bind((function(tabstop){return findIndex$1(tabstops,curry(eq,tabstop)).bind((function(stopIndex){return goFromTabstop(component,tabstops,stopIndex,tabbingConfig,cycle)}))}))},getKeydownRules=constant$1([rule(and([isShift,inSet(TAB)]),(function(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cyclePrev:tryPrev;return go(component,0,tabbingConfig,navigate)})),rule(inSet(TAB),(function(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cycleNext:tryNext;return go(component,0,tabbingConfig,navigate)})),rule(inSet(ESCAPE),(function(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEscape.bind((function(f){return f(component,simulatedEvent)}))})),rule(and([isNotShift,inSet(ENTER)]),(function(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEnter.bind((function(f){return f(component,simulatedEvent)}))}))]),getKeyupRules=constant$1([]);return typical(schema,NoState.init,getKeydownRules,getKeyupRules,(function(){return Optional.some(focusIn)}))},AcyclicType=create$5(customField("cyclic",never)),CyclicType=create$5(customField("cyclic",always)),defaultExecute=function(component,simulatedEvent,focused){return inside(focused)&&inSet(SPACE)(simulatedEvent.event)?Optional.none():function(component,_simulatedEvent,focused){return dispatch(component,focused,execute$5()),Optional.some(!0)}(component,0,focused)},stopEventForFirefox=function(_component,_simulatedEvent){return Optional.some(!0)},schema$v=[defaulted("execute",defaultExecute),defaulted("useSpace",!1),defaulted("useEnter",!0),defaulted("useControlEnter",!1),defaulted("useDown",!1)],execute$4=function(component,simulatedEvent,executeConfig){return executeConfig.execute(component,simulatedEvent,component.element)},ExecutionType=typical(schema$v,NoState.init,(function(component,_simulatedEvent,executeConfig,_executeState){var spaceExec=executeConfig.useSpace&&!inside(component.element)?SPACE:[],enterExec=executeConfig.useEnter?ENTER:[],downExec=executeConfig.useDown?DOWN:[],execKeys=spaceExec.concat(enterExec).concat(downExec);return[rule(inSet(execKeys),execute$4)].concat(executeConfig.useControlEnter?[rule(and([isControl,inSet(ENTER)]),execute$4)]:[])}),(function(component,_simulatedEvent,executeConfig,_executeState){return executeConfig.useSpace&&!inside(component.element)?[rule(inSet(SPACE),stopEventForFirefox)]:[]}),(function(){return Optional.none()})),flatgrid$1=function(){var dimensions=value$1();return nu$8({readState:function(){return dimensions.get().map((function(d){return{numRows:String(d.numRows),numColumns:String(d.numColumns)}})).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(numRows,numColumns){dimensions.set({numRows:numRows,numColumns:numColumns})},getNumRows:function(){return dimensions.get().map((function(d){return d.numRows}))},getNumColumns:function(){return dimensions.get().map((function(d){return d.numColumns}))}})},KeyingState=Object.freeze({__proto__:null,flatgrid:flatgrid$1,init:function(spec){return spec.state(spec)}}),useH=function(movement){return function(component,simulatedEvent,config,state){var move=movement(component.element);return use(move,component,simulatedEvent,config,state)}},west$1=function(moveLeft,moveRight){var movement=onDirection(moveLeft,moveRight);return useH(movement)},east$1=function(moveLeft,moveRight){var movement=onDirection(moveRight,moveLeft);return useH(movement)},useV=function(move){return function(component,simulatedEvent,config,state){return use(move,component,simulatedEvent,config,state)}},use=function(move,component,simulatedEvent,config,state){return config.focusManager.get(component).bind((function(focused){return move(component.element,focused,config,state)})).map((function(newFocus){return config.focusManager.set(component,newFocus),!0}))},north$1=useV,south$1=useV,move$1=useV,isVisible=function(element){return!function(dom){return dom.offsetWidth<=0&&dom.offsetHeight<=0}(element.dom)},locateVisible=function(container,current,selector){var candidates=descendants(container,selector);return function(candidates,predicate){return findIndex$1(candidates,predicate).map((function(index){return{index:index,candidates:candidates}}))}(filter$2(candidates,isVisible),(function(x){return eq(x,current)}))},findIndex=function(elements,target){return findIndex$1(elements,(function(elem){return eq(target,elem)}))},withGrid=function(values,index,numCols,f){return f(Math.floor(index/numCols),index%numCols).bind((function(address){var newIndex=address.row*numCols+address.column;return newIndex>=0&&newIndex<values.length?Optional.some(values[newIndex]):Optional.none()}))},cycleHorizontal$1=function(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,(function(oldRow,oldColumn){var colsInRow=oldRow===numRows-1?values.length-oldRow*numCols:numCols,newColumn=cycleBy(oldColumn,delta,0,colsInRow-1);return Optional.some({row:oldRow,column:newColumn})}))},cycleVertical$1=function(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,(function(oldRow,oldColumn){var newRow=cycleBy(oldRow,delta,0,numRows-1),colsInRow=newRow===numRows-1?values.length-newRow*numCols:numCols,newCol=clamp$1(oldColumn,0,colsInRow-1);return Optional.some({row:newRow,column:newCol})}))},schema$u=[required$1("selector"),defaulted("execute",defaultExecute),onKeyboardHandler("onEscape"),defaulted("captureTab",!1),initSize()],focusIn$3=function(component,gridConfig,_gridState){descendant(component.element,gridConfig.selector).each((function(first){gridConfig.focusManager.set(component,first)}))},doMove$2=function(cycle){return function(element,focused,gridConfig,gridState){return locateVisible(element,focused,gridConfig.selector).bind((function(identified){return cycle(identified.candidates,identified.index,gridState.getNumRows().getOr(gridConfig.initSize.numRows),gridState.getNumColumns().getOr(gridConfig.initSize.numColumns))}))}},handleTab=function(_component,_simulatedEvent,gridConfig){return gridConfig.captureTab?Optional.some(!0):Optional.none()},moveLeft$3=doMove$2((function(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,-1)})),moveRight$3=doMove$2((function(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,1)})),moveNorth$1=doMove$2((function(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,-1)})),moveSouth$1=doMove$2((function(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,1)})),getKeydownRules$4=constant$1([rule(inSet(LEFT),west$1(moveLeft$3,moveRight$3)),rule(inSet(RIGHT),east$1(moveLeft$3,moveRight$3)),rule(inSet(UP),north$1(moveNorth$1)),rule(inSet(DOWN),south$1(moveSouth$1)),rule(and([isShift,inSet(TAB)]),handleTab),rule(and([isNotShift,inSet(TAB)]),handleTab),rule(inSet(ESCAPE),(function(component,simulatedEvent,gridConfig){return gridConfig.onEscape(component,simulatedEvent)})),rule(inSet(SPACE.concat(ENTER)),(function(component,simulatedEvent,gridConfig,_gridState){return function(component,gridConfig){return gridConfig.focusManager.get(component).bind((function(elem){return closest$1(elem,gridConfig.selector)}))}(component,gridConfig).bind((function(focused){return gridConfig.execute(component,simulatedEvent,focused)}))}))]),getKeyupRules$4=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),FlatgridType=typical(schema$u,flatgrid$1,getKeydownRules$4,getKeyupRules$4,(function(){return Optional.some(focusIn$3)})),horizontal=function(container,selector,current,delta){var tryCycle=function(initial,index,candidates){var candidate,newIndex=cycleBy(index,delta,0,candidates.length-1);return newIndex===initial?Optional.none():(candidate=candidates[newIndex],"button"===name$2(candidate)&&"disabled"===get$d(candidate,"disabled")?tryCycle(initial,newIndex,candidates):Optional.from(candidates[newIndex]))};return locateVisible(container,current,selector).bind((function(identified){var index=identified.index,candidates=identified.candidates;return tryCycle(index,index,candidates)}))},schema$t=[required$1("selector"),defaulted("getInitial",Optional.none),defaulted("execute",defaultExecute),onKeyboardHandler("onEscape"),defaulted("executeOnMove",!1),defaulted("allowVertical",!0)],execute$2=function(component,simulatedEvent,flowConfig){return function(component,flowConfig){return flowConfig.focusManager.get(component).bind((function(elem){return closest$1(elem,flowConfig.selector)}))}(component,flowConfig).bind((function(focused){return flowConfig.execute(component,simulatedEvent,focused)}))},focusIn$2=function(component,flowConfig,_state){flowConfig.getInitial(component).orThunk((function(){return descendant(component.element,flowConfig.selector)})).each((function(first){flowConfig.focusManager.set(component,first)}))},moveLeft$2=function(element,focused,info){return horizontal(element,info.selector,focused,-1)},moveRight$2=function(element,focused,info){return horizontal(element,info.selector,focused,1)},doMove$1=function(movement){return function(component,simulatedEvent,flowConfig,flowState){return movement(component,simulatedEvent,flowConfig,flowState).bind((function(){return flowConfig.executeOnMove?execute$2(component,simulatedEvent,flowConfig):Optional.some(!0)}))}},doEscape=function(component,simulatedEvent,flowConfig){return flowConfig.onEscape(component,simulatedEvent)},getKeyupRules$3=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),FlowType=typical(schema$t,NoState.init,(function(_component,_se,flowConfig,_flowState){var westMovers=LEFT.concat(flowConfig.allowVertical?UP:[]),eastMovers=RIGHT.concat(flowConfig.allowVertical?DOWN:[]);return[rule(inSet(westMovers),doMove$1(west$1(moveLeft$2,moveRight$2))),rule(inSet(eastMovers),doMove$1(east$1(moveLeft$2,moveRight$2))),rule(inSet(ENTER),execute$2),rule(inSet(SPACE),execute$2),rule(inSet(ESCAPE),doEscape)]}),getKeyupRules$3,(function(){return Optional.some(focusIn$2)})),toCell=function(matrix,rowIndex,columnIndex){return Optional.from(matrix[rowIndex]).bind((function(row){return Optional.from(row[columnIndex]).map((function(cell){return{rowIndex:rowIndex,columnIndex:columnIndex,cell:cell}}))}))},cycleHorizontal=function(matrix,rowIndex,startCol,deltaCol){var colsInRow=matrix[rowIndex].length,newColIndex=cycleBy(startCol,deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex)},cycleVertical=function(matrix,colIndex,startRow,deltaRow){var nextRowIndex=cycleBy(startRow,deltaRow,0,matrix.length-1),colsInNextRow=matrix[nextRowIndex].length,nextColIndex=clamp$1(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex)},moveHorizontal=function(matrix,rowIndex,startCol,deltaCol){var colsInRow=matrix[rowIndex].length,newColIndex=clamp$1(startCol+deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex)},moveVertical=function(matrix,colIndex,startRow,deltaRow){var nextRowIndex=clamp$1(startRow+deltaRow,0,matrix.length-1),colsInNextRow=matrix[nextRowIndex].length,nextColIndex=clamp$1(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex)},schema$s=[requiredObjOf("selectors",[required$1("row"),required$1("cell")]),defaulted("cycles",!0),defaulted("previousSelector",Optional.none),defaulted("execute",defaultExecute)],focusIn$1=function(component,matrixConfig,_state){matrixConfig.previousSelector(component).orThunk((function(){var selectors=matrixConfig.selectors;return descendant(component.element,selectors.cell)})).each((function(cell){matrixConfig.focusManager.set(component,cell)}))},doMove=function(ifCycle,ifMove){return function(element,focused,matrixConfig){var move=matrixConfig.cycles?ifCycle:ifMove;return closest$1(focused,matrixConfig.selectors.row).bind((function(inRow){var cellsInRow=descendants(inRow,matrixConfig.selectors.cell);return findIndex(cellsInRow,focused).bind((function(colIndex){var allRows=descendants(element,matrixConfig.selectors.row);return findIndex(allRows,inRow).bind((function(rowIndex){var matrix=function(rows,matrixConfig){return map$2(rows,(function(row){return descendants(row,matrixConfig.selectors.cell)}))}(allRows,matrixConfig);return move(matrix,rowIndex,colIndex).map((function(next){return next.cell}))}))}))}))}},moveLeft=doMove((function(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,-1)}),(function(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,-1)})),moveRight=doMove((function(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,1)}),(function(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,1)})),moveNorth=doMove((function(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,-1)}),(function(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,-1)})),moveSouth=doMove((function(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,1)}),(function(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,1)})),getKeydownRules$2=constant$1([rule(inSet(LEFT),west$1(moveLeft,moveRight)),rule(inSet(RIGHT),east$1(moveLeft,moveRight)),rule(inSet(UP),north$1(moveNorth)),rule(inSet(DOWN),south$1(moveSouth)),rule(inSet(SPACE.concat(ENTER)),(function(component,simulatedEvent,matrixConfig){return search(component.element).bind((function(focused){return matrixConfig.execute(component,simulatedEvent,focused)}))}))]),getKeyupRules$2=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),MatrixType=typical(schema$s,NoState.init,getKeydownRules$2,getKeyupRules$2,(function(){return Optional.some(focusIn$1)})),schema$r=[required$1("selector"),defaulted("execute",defaultExecute),defaulted("moveOnTab",!1)],execute=function(component,simulatedEvent,menuConfig){return menuConfig.focusManager.get(component).bind((function(focused){return menuConfig.execute(component,simulatedEvent,focused)}))},focusIn=function(component,menuConfig,_state){descendant(component.element,menuConfig.selector).each((function(first){menuConfig.focusManager.set(component,first)}))},moveUp=function(element,focused,info){return horizontal(element,info.selector,focused,-1)},moveDown=function(element,focused,info){return horizontal(element,info.selector,focused,1)},getKeydownRules$1=constant$1([rule(inSet(UP),move$1(moveUp)),rule(inSet(DOWN),move$1(moveDown)),rule(and([isShift,inSet(TAB)]),(function(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveUp)(component,simulatedEvent,menuConfig,menuState):Optional.none()})),rule(and([isNotShift,inSet(TAB)]),(function(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveDown)(component,simulatedEvent,menuConfig,menuState):Optional.none()})),rule(inSet(ENTER),execute),rule(inSet(SPACE),execute)]),getKeyupRules$1=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),MenuType=typical(schema$r,NoState.init,getKeydownRules$1,getKeyupRules$1,(function(){return Optional.some(focusIn)})),schema$q=[onKeyboardHandler("onSpace"),onKeyboardHandler("onEnter"),onKeyboardHandler("onShiftEnter"),onKeyboardHandler("onLeft"),onKeyboardHandler("onRight"),onKeyboardHandler("onTab"),onKeyboardHandler("onShiftTab"),onKeyboardHandler("onUp"),onKeyboardHandler("onDown"),onKeyboardHandler("onEscape"),defaulted("stopSpaceKeyup",!1),option("focusIn")],SpecialType=typical(schema$q,NoState.init,(function(component,simulatedEvent,specialInfo){return[rule(inSet(SPACE),specialInfo.onSpace),rule(and([isNotShift,inSet(ENTER)]),specialInfo.onEnter),rule(and([isShift,inSet(ENTER)]),specialInfo.onShiftEnter),rule(and([isShift,inSet(TAB)]),specialInfo.onShiftTab),rule(and([isNotShift,inSet(TAB)]),specialInfo.onTab),rule(inSet(UP),specialInfo.onUp),rule(inSet(DOWN),specialInfo.onDown),rule(inSet(LEFT),specialInfo.onLeft),rule(inSet(RIGHT),specialInfo.onRight),rule(inSet(SPACE),specialInfo.onSpace),rule(inSet(ESCAPE),specialInfo.onEscape)]}),(function(component,simulatedEvent,specialInfo){return specialInfo.stopSpaceKeyup?[rule(inSet(SPACE),stopEventForFirefox)]:[]}),(function(specialInfo){return specialInfo.focusIn})),acyclic=AcyclicType.schema(),cyclic=CyclicType.schema(),flow=FlowType.schema(),flatgrid=FlatgridType.schema(),matrix=MatrixType.schema(),execution=ExecutionType.schema(),menu=MenuType.schema(),special=SpecialType.schema(),Keying=createModes({branchKey:"mode",branches:Object.freeze({__proto__:null,acyclic:acyclic,cyclic:cyclic,flow:flow,flatgrid:flatgrid,matrix:matrix,execution:execution,menu:menu,special:special}),name:"keying",active:{events:function(keyingConfig,keyingState){return keyingConfig.handler.toEvents(keyingConfig,keyingState)}},apis:{focusIn:function(component,keyConfig,keyState){keyConfig.sendFocusIn(keyConfig).fold((function(){component.getSystem().triggerFocus(component.element,component.element)}),(function(sendFocusIn){sendFocusIn(component,keyConfig,keyState)}))},setGridSize:function(component,keyConfig,keyState,numRows,numColumns){!function(keyState){return hasNonNullableKey(keyState,"setGridSize")}(keyState)?console.error("Layout does not support setGridSize"):keyState.setGridSize(numRows,numColumns)}},state:KeyingState}),insert=function(component,replaceConfig,insertion,childSpec){var child=component.getSystem().build(childSpec);attachWith(component,child,insertion)},remove=function(component,replaceConfig,replaceState,removee){var children=contents(component);find$5(children,(function(child){return eq(removee.element,child.element)})).each(detach)},contents=function(component,_replaceConfig){return component.components()},replaceAt=function(component,replaceConfig,replaceState,replaceeIndex,replacer){var children=contents(component);return Optional.from(children[replaceeIndex]).map((function(replacee){return remove(component,0,0,replacee),replacer.each((function(r){insert(component,0,(function(p,c){!function(parent,element,index){child$2(parent,index).fold((function(){append$2(parent,element)}),(function(v){before$2(v,element)}))}(p,c,replaceeIndex)}),r)})),replacee}))},Replacing=create$7({fields:[],name:"replacing",apis:Object.freeze({__proto__:null,append:function(component,replaceConfig,replaceState,appendee){insert(component,0,append$2,appendee)},prepend:function(component,replaceConfig,replaceState,prependee){insert(component,0,prepend$1,prependee)},remove:remove,replaceAt:replaceAt,replaceBy:function(component,replaceConfig,replaceState,replaceePred,replacer){var children=contents(component);return findIndex$1(children,replaceePred).bind((function(replaceeIndex){return replaceAt(component,0,0,replaceeIndex,replacer)}))},set:function(component,replaceConfig,replaceState,data){preserve$1((function(){var newChildren=map$2(data,component.getSystem().build);replaceChildren(component,newChildren)}),component.element)},contents:contents})}),config=function(name,eventHandlers){return{key:name,value:{config:{},me:function(name,eventHandlers){var events=derive$2(eventHandlers);return create$7({fields:[required$1("enabled")],name:name,active:{events:constant$1(events)}})}(name,eventHandlers),configAsRaw:constant$1({}),initialConfig:{},state:NoState}}},focus$2=function(component,focusConfig){focusConfig.ignore||(focus$3(component.element),focusConfig.onFocus(component))},FocusApis=Object.freeze({__proto__:null,focus:focus$2,blur:function(component,focusConfig){focusConfig.ignore||function(element){element.dom.blur()}(component.element)},isFocused:function(component){return hasFocus(component.element)}}),ActiveFocus=Object.freeze({__proto__:null,exhibit:function(base,focusConfig){var mod=focusConfig.ignore?{}:{attributes:{tabindex:"-1"}};return nu$7(mod)},events:function(focusConfig){return derive$2([run$1(focus$4(),(function(component,simulatedEvent){focus$2(component,focusConfig),simulatedEvent.stop()}))].concat(focusConfig.stopMousedown?[run$1(mousedown(),(function(_,simulatedEvent){simulatedEvent.event.prevent()}))]:[]))}}),FocusSchema=[onHandler("onFocus"),defaulted("stopMousedown",!1),defaulted("ignore",!1)],Focusing=create$7({fields:FocusSchema,name:"focusing",active:ActiveFocus,apis:FocusApis}),updateAriaState=function(component,toggleConfig,toggleState){var ariaInfo=toggleConfig.aria;ariaInfo.update(component,ariaInfo,toggleState.get())},updateClass=function(component,toggleConfig,toggleState){toggleConfig.toggleClass.each((function(toggleClass){toggleState.get()?add$2(component.element,toggleClass):remove$2(component.element,toggleClass)}))},toggle$2=function(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,!toggleState.get())},on=function(component,toggleConfig,toggleState){toggleState.set(!0),updateClass(component,toggleConfig,toggleState),updateAriaState(component,toggleConfig,toggleState)},off=function(component,toggleConfig,toggleState){toggleState.set(!1),updateClass(component,toggleConfig,toggleState),updateAriaState(component,toggleConfig,toggleState)},set$1=function(component,toggleConfig,toggleState,state){(state?on:off)(component,toggleConfig,toggleState)},onLoad=function(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,toggleConfig.selected)},ToggleApis=Object.freeze({__proto__:null,onLoad:onLoad,toggle:toggle$2,isOn:function(component,toggleConfig,toggleState){return toggleState.get()},on:on,off:off,set:set$1}),ActiveToggle=Object.freeze({__proto__:null,exhibit:function(){return nu$7({})},events:function(toggleConfig,toggleState){var bConfig,bState,executor,execute=(bConfig=toggleConfig,bState=toggleState,executor=toggle$2,runOnExecute$1((function(component){executor(component,bConfig,bState)}))),load=loadEvent(toggleConfig,toggleState,onLoad);return derive$2(flatten([toggleConfig.toggleOnExecute?[execute]:[],[load]]))}}),updateExpanded=function(component,ariaInfo,status){set$8(component.element,"aria-expanded",status)},ToggleSchema=[defaulted("selected",!1),option("toggleClass"),defaulted("toggleOnExecute",!0),defaultedOf("aria",{mode:"none"},choose$1("mode",{pressed:[defaulted("syncWithExpanded",!1),output$1("update",(function(component,ariaInfo,status){set$8(component.element,"aria-pressed",status),ariaInfo.syncWithExpanded&&updateExpanded(component,ariaInfo,status)}))],checked:[output$1("update",(function(component,ariaInfo,status){set$8(component.element,"aria-checked",status)}))],expanded:[output$1("update",updateExpanded)],selected:[output$1("update",(function(component,ariaInfo,status){set$8(component.element,"aria-selected",status)}))],none:[output$1("update",noop)]}))],Toggling=create$7({fields:ToggleSchema,name:"toggling",active:ActiveToggle,apis:ToggleApis,state:(initialState=!1,{init:function(){var cell=Cell(initialState);return{get:function(){return cell.get()},set:function(newState){return cell.set(newState)},clear:function(){return cell.set(initialState)},readState:function(){return cell.get()}}}})}),pointerEvents=function(){var onClick=function(component,simulatedEvent){simulatedEvent.stop(),emitExecute(component)};return[run$1(click(),onClick),run$1(tap(),onClick),cutter(touchstart()),cutter(mousedown())]},events$a=function(optAction){return derive$2(flatten([optAction.map((function(action){return runOnExecute$1((function(component,simulatedEvent){action(component),simulatedEvent.stop()}))})).toArray(),pointerEvents()]))},onHover=function(item){(search(item.element).isNone()||Focusing.isFocused(item))&&(Focusing.isFocused(item)||Focusing.focus(item),emitWith(item,"alloy.item-hover",{item:item}))},onFocus$1=function(item){emitWith(item,"alloy.item-focus",{item:item})},hover=constant$1("alloy.item-hover"),focus$1=constant$1("alloy.item-focus"),schema$p=[required$1("data"),required$1("components"),required$1("dom"),defaulted("hasSubmenu",!1),option("toggling"),SketchBehaviours_field("itemBehaviours",[Toggling,Focusing,Keying,Representing]),defaulted("ignoreFocus",!1),defaulted("domModification",{}),output$1("builder",(function(detail){return{dom:detail.dom,domModification:__assign(__assign({},detail.domModification),{attributes:__assign(__assign(__assign({role:detail.toggling.isSome()?"menuitemcheckbox":"menuitem"},detail.domModification.attributes),{"aria-haspopup":detail.hasSubmenu}),detail.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:SketchBehaviours_augment(detail.itemBehaviours,[detail.toggling.fold(Toggling.revoke,(function(tConfig){return Toggling.config(__assign({aria:{mode:"checked"}},tConfig))})),Focusing.config({ignore:detail.ignoreFocus,stopMousedown:detail.ignoreFocus,onFocus:function(component){onFocus$1(component)}}),Keying.config({mode:"execution"}),Representing.config({store:{mode:"memory",initialValue:detail.data}}),config("item-type-events",__spreadArray(__spreadArray([],pointerEvents(),!0),[run$1(mouseover(),onHover),run$1(focusItem(),Focusing.focus)],!1))]),components:detail.components,eventOrder:detail.eventOrder}})),defaulted("eventOrder",{})],schema$o=[required$1("dom"),required$1("components"),output$1("builder",(function(detail){return{dom:detail.dom,components:detail.components,events:derive$2([stopper(focusItem())])}}))],owner$2=constant$1("item-widget"),parts$h=constant$1([required({name:"widget",overrides:function(detail){return{behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(_component){return detail.data},setValue:noop}})])}}})]),schema$n=[required$1("uid"),required$1("data"),required$1("components"),required$1("dom"),defaulted("autofocus",!1),defaulted("ignoreFocus",!1),SketchBehaviours_field("widgetBehaviours",[Representing,Focusing,Keying]),defaulted("domModification",{}),defaultUidsSchema(parts$h()),output$1("builder",(function(detail){var subs=substitutes(owner$2(),detail,parts$h()),components=components$1(owner$2(),detail,subs.internals()),focusWidget=function(component){return getPart(component,detail,"widget").map((function(widget){return Keying.focusIn(widget),widget}))},onHorizontalArrow=function(component,simulatedEvent){return inside(simulatedEvent.event.target)?Optional.none():detail.autofocus?(simulatedEvent.setSource(component.element),Optional.none()):Optional.none()};return{dom:detail.dom,components:components,domModification:detail.domModification,events:derive$2([runOnExecute$1((function(component,simulatedEvent){focusWidget(component).each((function(_widget){simulatedEvent.stop()}))})),run$1(mouseover(),onHover),run$1(focusItem(),(function(component,_simulatedEvent){detail.autofocus?focusWidget(component):Focusing.focus(component)}))]),behaviours:SketchBehaviours_augment(detail.widgetBehaviours,[Representing.config({store:{mode:"memory",initialValue:detail.data}}),Focusing.config({ignore:detail.ignoreFocus,onFocus:function(component){onFocus$1(component)}}),Keying.config({mode:"special",focusIn:detail.autofocus?function(component){focusWidget(component)}:revoke(),onLeft:onHorizontalArrow,onRight:onHorizontalArrow,onEscape:function(component,simulatedEvent){return Focusing.isFocused(component)||detail.autofocus?detail.autofocus?(simulatedEvent.setSource(component.element),Optional.none()):Optional.none():(Focusing.focus(component),Optional.some(!0))}})])}}))],itemSchema$2=choose$1("type",{widget:schema$n,item:schema$p,separator:schema$o}),parts$g=constant$1([group({factory:{sketch:function(spec){var itemInfo=asRawOrDie$1("menu.spec item",itemSchema$2,spec);return itemInfo.builder(itemInfo)}},name:"items",unit:"item",defaults:function(detail,u){return has$2(u,"uid")?u:__assign(__assign({},u),{uid:generate$5("item")})},overrides:function(detail,u){return{type:u.type,ignoreFocus:detail.fakeFocus,domModification:{classes:[detail.markers.item]}}}})]),schema$m=constant$1([required$1("value"),required$1("items"),required$1("dom"),required$1("components"),defaulted("eventOrder",{}),field("menuBehaviours",[Highlighting,Representing,Composing,Keying]),defaultedOf("movement",{mode:"menu",moveOnTab:!0},choose$1("mode",{grid:[initSize(),output$1("config",(function(detail,movementInfo){return{mode:"flatgrid",selector:"."+detail.markers.item,initSize:{numColumns:movementInfo.initSize.numColumns,numRows:movementInfo.initSize.numRows},focusManager:detail.focusManager}}))],matrix:[output$1("config",(function(detail,movementInfo){return{mode:"matrix",selectors:{row:movementInfo.rowSelector,cell:"."+detail.markers.item},focusManager:detail.focusManager}})),required$1("rowSelector")],menu:[defaulted("moveOnTab",!0),output$1("config",(function(detail,movementInfo){return{mode:"menu",selector:"."+detail.markers.item,moveOnTab:movementInfo.moveOnTab,focusManager:detail.focusManager}}))]})),requiredOf("markers",itemSchema$3()),defaulted("fakeFocus",!1),defaulted("focusManager",dom$2()),onHandler("onHighlight")]),focus=constant$1("alloy.menu-focus"),Menu=composite({name:"Menu",configFields:schema$m(),partFields:parts$g(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.menuBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedItem,itemClass:detail.markers.item,onHighlight:detail.onHighlight}),Representing.config({store:{mode:"memory",initialValue:detail.value}}),Composing.config({find:Optional.some}),Keying.config(detail.movement.config(detail,detail.movement))]),events:derive$2([run$1(focus$1(),(function(menu,simulatedEvent){var event=simulatedEvent.event;menu.getSystem().getByDom(event.target).each((function(item){Highlighting.highlight(menu,item),simulatedEvent.stop(),emitWith(menu,focus(),{menu:menu,item:item})}))})),run$1(hover(),(function(menu,simulatedEvent){var item=simulatedEvent.event.item;Highlighting.highlight(menu,item)}))]),components:components,eventOrder:detail.eventOrder,domModification:{attributes:{role:"menu"}}}}}),trace=function(items,byItem,byMenu,finish){return get$e(byMenu,finish).bind((function(triggerItem){return get$e(items,triggerItem).bind((function(triggerMenu){var rest=trace(items,byItem,byMenu,triggerMenu);return Optional.some([triggerMenu].concat(rest))}))})).getOr([])},generate$2=function(menus,expansions){var items={};each(menus,(function(menuItems,menu){each$1(menuItems,(function(item){items[item]=menu}))}));var byItem=expansions,byMenu=tupleMap(expansions,(function(v,k){return{k:v,v:k}})),menuPaths=map$1(byMenu,(function(_triggerItem,submenu){return[submenu].concat(trace(items,byItem,byMenu,submenu))}));return map$1(items,(function(menu){return get$e(menuPaths,menu).getOr([menu])}))},extractPreparedMenu=function(prep){return"prepared"===prep.type?Optional.some(prep.menu):Optional.none()},LayeredState={init:function(){var expansions=Cell({}),menus=Cell({}),paths=Cell({}),primary=value$1(),directory=Cell({}),getTriggerData=function(menuValue,getItemByValue,path){return getPreparedMenu(menuValue).bind((function(menu){return function(menuValue){return find$4(expansions.get(),(function(v,_k){return v===menuValue}))}(menuValue).bind((function(triggeringItemValue){return getItemByValue(triggeringItemValue).map((function(triggeredItem){return{triggeredMenu:menu,triggeringItem:triggeredItem,triggeringPath:path}}))}))}))},getPreparedMenu=function(menuValue){return lookupMenu(menuValue).bind(extractPreparedMenu)},lookupMenu=function(menuValue){return get$e(menus.get(),menuValue)},lookupItem=function(itemValue){return get$e(expansions.get(),itemValue)};return{setMenuBuilt:function(menuName,built){var _a;menus.set(__assign(__assign({},menus.get()),((_a={})[menuName]={type:"prepared",menu:built},_a)))},setContents:function(sPrimary,sMenus,sExpansions,dir){primary.set(sPrimary),expansions.set(sExpansions),menus.set(sMenus),directory.set(dir);var sPaths=generate$2(dir,sExpansions);paths.set(sPaths)},expand:function(itemValue){return get$e(expansions.get(),itemValue).map((function(menu){var current=get$e(paths.get(),itemValue).getOr([]);return[menu].concat(current)}))},refresh:function(itemValue){return get$e(paths.get(),itemValue)},collapse:function(itemValue){return get$e(paths.get(),itemValue).bind((function(path){return path.length>1?Optional.some(path.slice(1)):Optional.none()}))},lookupMenu:lookupMenu,lookupItem:lookupItem,otherMenus:function(path){var menuValues=directory.get();return difference(keys(menuValues),path)},getPrimary:function(){return primary.get().bind(getPreparedMenu)},getMenus:function(){return menus.get()},clear:function(){expansions.set({}),menus.set({}),paths.set({}),primary.clear()},isClear:function(){return primary.get().isNone()},getTriggeringPath:function(itemValue,getItemByValue){var extraPath=filter$2(lookupItem(itemValue).toArray(),(function(menuValue){return getPreparedMenu(menuValue).isSome()}));return get$e(paths.get(),itemValue).bind((function(path){var revPath=reverse(extraPath.concat(path));return function(arr){for(var r=[],i=0;i<arr.length;i++){var x=arr[i];if(!x.isSome())return Optional.none();r.push(x.getOrDie())}return Optional.some(r)}(bind$3(revPath,(function(menuValue,menuIndex){return getTriggerData(menuValue,getItemByValue,revPath.slice(0,menuIndex+1)).fold((function(){return is$1(primary.get(),menuValue)?[]:[Optional.none()]}),(function(data){return[Optional.some(data)]}))})))}))}}},extractPreparedMenu:extractPreparedMenu},collapseItem$1=constant$1("collapse-item"),tieredMenu=single({name:"TieredMenu",configFields:[onStrictKeyboardHandler("onExecute"),onStrictKeyboardHandler("onEscape"),onStrictHandler("onOpenMenu"),onStrictHandler("onOpenSubmenu"),onHandler("onRepositionMenu"),onHandler("onCollapseMenu"),defaulted("highlightImmediately",!0),requiredObjOf("data",[required$1("primary"),required$1("menus"),required$1("expansions")]),defaulted("fakeFocus",!1),onHandler("onHighlight"),onHandler("onHover"),tieredMenuMarkers(),required$1("dom"),defaulted("navigateOnHover",!0),defaulted("stayInDom",!1),field("tmenuBehaviours",[Keying,Highlighting,Composing,Replacing]),defaulted("eventOrder",{})],apis:{collapseMenu:function(apis,tmenu){apis.collapseMenu(tmenu)},highlightPrimary:function(apis,tmenu){apis.highlightPrimary(tmenu)},repositionMenus:function(apis,tmenu){apis.repositionMenus(tmenu)}},factory:function(detail,_rawUiSpec){var ExpandHighlightDecision,submenuParentItems=value$1(),layeredState=LayeredState.init(),setup=function(container){var componentMap=function(container,primaryName,menus){return map$1(menus,(function(spec,name){var makeSketch=function(){return Menu.sketch(__assign(__assign({},spec),{value:name,markers:detail.markers,fakeFocus:detail.fakeFocus,onHighlight:detail.onHighlight,focusManager:detail.fakeFocus?highlights():dom$2()}))};return name===primaryName?{type:"prepared",menu:container.getSystem().build(makeSketch())}:{type:"notbuilt",nbMenu:makeSketch}}))}(container,detail.data.primary,detail.data.menus),directory=toDirectory();return layeredState.setContents(detail.data.primary,componentMap,detail.data.expansions,directory),layeredState.getPrimary()},getItemValue=function(item){return Representing.getValue(item).value},toDirectory=function(_container){return map$1(detail.data.menus,(function(data,_menuName){return bind$3(data.items,(function(item){return"separator"===item.type?[]:[item.data.value]}))}))},setActiveMenu=function(container,menu){Highlighting.highlight(container,menu),Highlighting.getHighlighted(menu).orThunk((function(){return Highlighting.getFirst(menu)})).each((function(item){dispatch(container,item.element,focusItem())}))},getMenus=function(state,menuValues){return cat(map$2(menuValues,(function(mv){return state.lookupMenu(mv).bind((function(prep){return"prepared"===prep.type?Optional.some(prep.menu):Optional.none()}))})))},closeOthers=function(container,state,path){var others=getMenus(state,state.otherMenus(path));each$1(others,(function(o){remove$1(o.element,[detail.markers.backgroundMenu]),detail.stayInDom||Replacing.remove(container,o)}))},updateAriaExpansions=function(container,path){var parentItems=function(container){return submenuParentItems.get().getOrThunk((function(){var r={},items=descendants(container.element,"."+detail.markers.item),parentItems=filter$2(items,(function(i){return"true"===get$d(i,"aria-haspopup")}));return each$1(parentItems,(function(i){container.getSystem().getByDom(i).each((function(itemComp){var key=getItemValue(itemComp);r[key]=itemComp}))})),submenuParentItems.set(r),r}))}(container);each(parentItems,(function(v,k){var expanded=contains$2(path,k);set$8(v.element,"aria-expanded",expanded)}))},updateMenuPath=function(container,state,path){return Optional.from(path[0]).bind((function(latestMenuName){return state.lookupMenu(latestMenuName).bind((function(menuPrep){if("notbuilt"===menuPrep.type)return Optional.none();var activeMenu=menuPrep.menu,rest=getMenus(state,path.slice(1));return each$1(rest,(function(r){add$2(r.element,detail.markers.backgroundMenu)})),inBody(activeMenu.element)||Replacing.append(container,premade(activeMenu)),remove$1(activeMenu.element,[detail.markers.backgroundMenu]),setActiveMenu(container,activeMenu),closeOthers(container,state,path),Optional.some(activeMenu)}))}))};!function(ExpandHighlightDecision){ExpandHighlightDecision[ExpandHighlightDecision.HighlightSubmenu=0]="HighlightSubmenu",ExpandHighlightDecision[ExpandHighlightDecision.HighlightParent=1]="HighlightParent"}(ExpandHighlightDecision||(ExpandHighlightDecision={}));var expandRight=function(container,item,decision){if(void 0===decision&&(decision=ExpandHighlightDecision.HighlightSubmenu),item.hasConfigured(Disabling)&&Disabling.isDisabled(item))return Optional.some(item);var value=getItemValue(item);return layeredState.expand(value).bind((function(path){return updateAriaExpansions(container,path),Optional.from(path[0]).bind((function(menuName){return layeredState.lookupMenu(menuName).bind((function(activeMenuPrep){var activeMenu=function(container,menuName,menuPrep){if("notbuilt"===menuPrep.type){var menu=container.getSystem().build(menuPrep.nbMenu());return layeredState.setMenuBuilt(menuName,menu),menu}return menuPrep.menu}(container,menuName,activeMenuPrep);return inBody(activeMenu.element)||Replacing.append(container,premade(activeMenu)),detail.onOpenSubmenu(container,item,activeMenu,reverse(path)),decision===ExpandHighlightDecision.HighlightSubmenu?(Highlighting.highlightFirst(activeMenu),updateMenuPath(container,layeredState,path)):(Highlighting.dehighlightAll(activeMenu),Optional.some(item))}))}))}))},collapseLeft=function(container,item){var value=getItemValue(item);return layeredState.collapse(value).bind((function(path){return updateAriaExpansions(container,path),updateMenuPath(container,layeredState,path).map((function(activeMenu){return detail.onCollapseMenu(container,item,activeMenu),activeMenu}))}))},keyOnItem=function(f){return function(container,simulatedEvent){return closest$1(simulatedEvent.getSource(),"."+detail.markers.item).bind((function(target){return container.getSystem().getByDom(target).toOptional().bind((function(item){return f(container,item).map(always)}))}))}},events=derive$2([run$1(focus(),(function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;layeredState.lookupItem(getItemValue(item)).each((function(){var menu=simulatedEvent.event.menu;Highlighting.highlight(sandbox,menu);var value=getItemValue(simulatedEvent.event.item);layeredState.refresh(value).each((function(path){return closeOthers(sandbox,layeredState,path)}))}))})),runOnExecute$1((function(component,simulatedEvent){var target=simulatedEvent.event.target;component.getSystem().getByDom(target).each((function(item){0===getItemValue(item).indexOf("collapse-item")&&collapseLeft(component,item),expandRight(component,item,ExpandHighlightDecision.HighlightSubmenu).fold((function(){detail.onExecute(component,item)}),noop)}))})),runOnAttached((function(container,_simulatedEvent){setup(container).each((function(primary){Replacing.append(container,premade(primary)),detail.onOpenMenu(container,primary),detail.highlightImmediately&&setActiveMenu(container,primary)}))}))].concat(detail.navigateOnHover?[run$1(hover(),(function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;!function(container,item){var value=getItemValue(item);layeredState.refresh(value).bind((function(path){return updateAriaExpansions(container,path),updateMenuPath(container,layeredState,path)}))}(sandbox,item),expandRight(sandbox,item,ExpandHighlightDecision.HighlightParent),detail.onHover(sandbox,item)}))]:[])),getActiveItem=function(container){return Highlighting.getHighlighted(container).bind(Highlighting.getHighlighted)},apis={collapseMenu:function(container){getActiveItem(container).each((function(currentItem){collapseLeft(container,currentItem)}))},highlightPrimary:function(container){layeredState.getPrimary().each((function(primary){setActiveMenu(container,primary)}))},repositionMenus:function(container){layeredState.getPrimary().bind((function(primary){return getActiveItem(container).bind((function(currentItem){var itemValue=getItemValue(currentItem),allMenus=values(layeredState.getMenus()),preparedMenus=cat(map$2(allMenus,LayeredState.extractPreparedMenu));return layeredState.getTriggeringPath(itemValue,(function(v){return function(_container,menus,itemValue){return findMap(menus,(function(menu){if(!menu.getSystem().isConnected())return Optional.none();var candidates=Highlighting.getCandidates(menu);return find$5(candidates,(function(c){return getItemValue(c)===itemValue}))}))}(0,preparedMenus,v)}))})).map((function(triggeringPath){return{primary:primary,triggeringPath:triggeringPath}}))})).fold((function(){(function(container){return Optional.from(container.components()[0]).filter((function(comp){return"menu"===get$d(comp.element,"role")}))})(container).each((function(primaryMenu){detail.onRepositionMenu(container,primaryMenu,[])}))}),(function(_a){var primary=_a.primary,triggeringPath=_a.triggeringPath;detail.onRepositionMenu(container,primary,triggeringPath)}))}};return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.tmenuBehaviours,[Keying.config({mode:"special",onRight:keyOnItem((function(container,item){return inside(item.element)?Optional.none():expandRight(container,item,ExpandHighlightDecision.HighlightSubmenu)})),onLeft:keyOnItem((function(container,item){return inside(item.element)?Optional.none():collapseLeft(container,item)})),onEscape:keyOnItem((function(container,item){return collapseLeft(container,item).orThunk((function(){return detail.onEscape(container,item).map((function(){return container}))}))})),focusIn:function(container,_keyInfo){layeredState.getPrimary().each((function(primary){dispatch(container,primary.element,focusItem())}))}}),Highlighting.config({highlightClass:detail.markers.selectedMenu,itemClass:detail.markers.menu}),Composing.config({find:function(container){return Highlighting.getHighlighted(container)}}),Replacing.config({})]),eventOrder:detail.eventOrder,apis:apis,events:events}},extraApis:{tieredData:function(primary,menus,expansions){return{primary:primary,menus:menus,expansions:expansions}},singleData:function(name,menu){return{primary:name,menus:wrap$1(name,menu),expansions:{}}},collapseItem:function(text){return{value:generate$6(collapseItem$1()),meta:{text:text}}}}}),InlineView=single({name:"InlineView",configFields:[required$1("lazySink"),onHandler("onShow"),onHandler("onHide"),optionFunction("onEscape"),field("inlineBehaviours",[Sandboxing,Representing,Receiving]),optionObjOf("fireDismissalEventInstead",[defaulted("event",dismissRequested())]),optionObjOf("fireRepositionEventInstead",[defaulted("event",repositionRequested())]),defaulted("getRelated",Optional.none),defaulted("isExtraPart",never),defaulted("eventOrder",Optional.none)],factory:function(detail,spec){var showWithin=function(sandbox,thing,placementSpec,boxElement){showWithinBounds(sandbox,thing,placementSpec,(function(){return boxElement.map((function(elem){return box$1(elem)}))}))},showWithinBounds=function(sandbox,thing,placementSpec,getBounds){var sink=detail.lazySink(sandbox).getOrDie();Sandboxing.openWhileCloaked(sandbox,thing,(function(){return Positioning.positionWithinBounds(sink,sandbox,placementSpec,getBounds())})),Representing.setValue(sandbox,Optional.some({mode:"position",config:placementSpec,getBounds:getBounds}))},showMenuWithinBounds=function(sandbox,placementSpec,menuSpec,getBounds){var menu=function(detail,menuSandbox,placementSpec,menuSpec,getBounds){var lazySink=function(){return detail.lazySink(menuSandbox)},layouts="horizontal"===menuSpec.type?{layouts:{onLtr:function(){return belowOrAbove()},onRtl:function(){return belowOrAboveRtl()}}}:{},getSubmenuLayouts=function(triggeringPaths){return function(triggeringPaths){return 2===triggeringPaths.length}(triggeringPaths)?layouts:{}};return tieredMenu.sketch({dom:{tag:"div"},data:menuSpec.data,markers:menuSpec.menu.markers,highlightImmediately:menuSpec.menu.highlightImmediately,onEscape:function(){return Sandboxing.close(menuSandbox),detail.onEscape.map((function(handler){return handler(menuSandbox)})),Optional.some(!0)},onExecute:function(){return Optional.some(!0)},onOpenMenu:function(tmenu,menu){Positioning.positionWithinBounds(lazySink().getOrDie(),menu,placementSpec,getBounds())},onOpenSubmenu:function(tmenu,item,submenu,triggeringPaths){var sink=lazySink().getOrDie();Positioning.position(sink,submenu,{anchor:__assign({type:"submenu",item:item},getSubmenuLayouts(triggeringPaths))})},onRepositionMenu:function(tmenu,primaryMenu,submenuTriggers){var sink=lazySink().getOrDie();Positioning.positionWithinBounds(sink,primaryMenu,placementSpec,getBounds()),each$1(submenuTriggers,(function(st){var submenuLayouts=getSubmenuLayouts(st.triggeringPath);Positioning.position(sink,st.triggeredMenu,{anchor:__assign({type:"submenu",item:st.triggeringItem},submenuLayouts)})}))}})}(detail,sandbox,placementSpec,menuSpec,getBounds);Sandboxing.open(sandbox,menu),Representing.setValue(sandbox,Optional.some({mode:"menu",menu:menu}))},reposition=function(sandbox){Sandboxing.isOpen(sandbox)&&Representing.getValue(sandbox).each((function(state){switch(state.mode){case"menu":Sandboxing.getState(sandbox).each(tieredMenu.repositionMenus);break;case"position":var sink=detail.lazySink(sandbox).getOrDie();Positioning.positionWithinBounds(sink,sandbox,state.config,state.getBounds())}}))},apis={setContent:function(sandbox,thing){Sandboxing.setContent(sandbox,thing)},showAt:function(sandbox,thing,placementSpec){showWithin(sandbox,thing,placementSpec,Optional.none())},showWithin:showWithin,showWithinBounds:showWithinBounds,showMenuAt:function(sandbox,placementSpec,menuSpec){showMenuWithinBounds(sandbox,placementSpec,menuSpec,Optional.none)},showMenuWithinBounds:showMenuWithinBounds,hide:function(sandbox){Sandboxing.isOpen(sandbox)&&(Representing.setValue(sandbox,Optional.none()),Sandboxing.close(sandbox))},getContent:function(sandbox){return Sandboxing.getState(sandbox)},reposition:reposition,isOpen:Sandboxing.isOpen};return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.inlineBehaviours,[Sandboxing.config({isPartOf:function(sandbox,data,queryElem){return isPartOf$1(data,queryElem)||function(sandbox,queryElem){return detail.getRelated(sandbox).exists((function(rel){return isPartOf$1(rel,queryElem)}))}(sandbox,queryElem)},getAttachPoint:function(sandbox){return detail.lazySink(sandbox).getOrDie()},onOpen:function(sandbox){detail.onShow(sandbox)},onClose:function(sandbox){detail.onHide(sandbox)}}),Representing.config({store:{mode:"memory",initialValue:Optional.none()}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1(__assign({isExtraPart:spec.isExtraPart},detail.fireDismissalEventInstead.map((function(fe){return{fireEventInstead:{event:fe.event}}})).getOr({})))),receivingChannel(__assign(__assign({},detail.fireRepositionEventInstead.map((function(fe){return{fireEventInstead:{event:fe.event}}})).getOr({})),{doReposition:reposition})))})]),eventOrder:detail.eventOrder,apis:apis}},apis:{showAt:function(apis,component,anchor,thing){apis.showAt(component,anchor,thing)},showWithin:function(apis,component,anchor,thing,boxElement){apis.showWithin(component,anchor,thing,boxElement)},showWithinBounds:function(apis,component,anchor,thing,bounds){apis.showWithinBounds(component,anchor,thing,bounds)},showMenuAt:function(apis,component,anchor,menuSpec){apis.showMenuAt(component,anchor,menuSpec)},showMenuWithinBounds:function(apis,component,anchor,menuSpec,bounds){apis.showMenuWithinBounds(component,anchor,menuSpec,bounds)},hide:function(apis,component){apis.hide(component)},isOpen:function(apis,component){return apis.isOpen(component)},getContent:function(apis,component){return apis.getContent(component)},setContent:function(apis,component,thing){apis.setContent(component,thing)},reposition:function(apis,component){apis.reposition(component)}}}),westEdgeX=function(anchor){return anchor.x},middleX=function(anchor,element){return anchor.x+anchor.width/2-element.width/2},eastEdgeX=function(anchor,element){return anchor.x+anchor.width-element.width},northY=function(anchor){return anchor.y},southY=function(anchor,element){return anchor.y+anchor.height-element.height},centreY=function(anchor,element){return anchor.y+anchor.height/2-element.height/2},southwest=function(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),southY(anchor,element),bubbles.insetSouthwest(),northwest$3(),"southwest",boundsRestriction(anchor,{right:0,bottom:3}),"layout-inset")},southeast=function(anchor,element,bubbles){return nu$6(westEdgeX(anchor),southY(anchor,element),bubbles.insetSoutheast(),northeast$3(),"southeast",boundsRestriction(anchor,{left:1,bottom:3}),"layout-inset")},northwest=function(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),northY(anchor),bubbles.insetNorthwest(),southwest$3(),"northwest",boundsRestriction(anchor,{right:0,top:2}),"layout-inset")},northeast=function(anchor,element,bubbles){return nu$6(westEdgeX(anchor),northY(anchor),bubbles.insetNortheast(),southeast$3(),"northeast",boundsRestriction(anchor,{left:1,top:2}),"layout-inset")},north=function(anchor,element,bubbles){return nu$6(middleX(anchor,element),northY(anchor),bubbles.insetNorth(),south$3(),"north",boundsRestriction(anchor,{top:2}),"layout-inset")},south=function(anchor,element,bubbles){return nu$6(middleX(anchor,element),southY(anchor,element),bubbles.insetSouth(),north$3(),"south",boundsRestriction(anchor,{bottom:3}),"layout-inset")},east=function(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),centreY(anchor,element),bubbles.insetEast(),west$3(),"east",boundsRestriction(anchor,{right:0}),"layout-inset")},west=function(anchor,element,bubbles){return nu$6(westEdgeX(anchor),centreY(anchor,element),bubbles.insetWest(),east$3(),"west",boundsRestriction(anchor,{left:1}),"layout-inset")},lookupPreserveLayout=function(lastPlacement){switch(lastPlacement){case"north":return north;case"northeast":return northeast;case"northwest":return northwest;case"south":return south;case"southeast":return southeast;case"southwest":return southwest;case"east":return east;case"west":return west}},preserve=function(anchor,element,bubbles,placee,bounds){return getPlacement(placee).map(lookupPreserveLayout).getOr(north)(anchor,element,bubbles,placee,bounds)},lookupFlippedLayout=function(lastPlacement){switch(lastPlacement){case"north":return south;case"northeast":return southeast;case"northwest":return southwest;case"south":return north;case"southeast":return northeast;case"southwest":return northwest;case"east":return west;case"west":return east}},flip$2=function(anchor,element,bubbles,placee,bounds){return getPlacement(placee).map(lookupFlippedLayout).getOr(north)(anchor,element,bubbles,placee,bounds)},global$f=tinymce.util.Tools.resolve("tinymce.util.Delay"),Button=single({name:"Button",factory:function(detail){var events=events$a(detail.action),tag=detail.dom.tag,lookupAttr=function(attr){return get$e(detail.dom,"attributes").bind((function(attrs){return get$e(attrs,attr)}))};return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events,behaviours:SketchBehaviours_augment(detail.buttonBehaviours,[Focusing.config({}),Keying.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:function(){if("button"===tag){var type=lookupAttr("type").getOr("button"),roleAttrs=lookupAttr("role").map((function(role){return{role:role}})).getOr({});return __assign({type:type},roleAttrs)}return{role:lookupAttr("role").getOr("button")}}()},eventOrder:detail.eventOrder}},configFields:[defaulted("uid",void 0),required$1("dom"),defaulted("components",[]),SketchBehaviours_field("buttonBehaviours",[Focusing,Keying]),option("action"),option("role"),defaulted("eventOrder",{})]}),record=function(spec){var uid=function(spec){return void 0!==spec.uid}(spec)&&hasNonNullableKey(spec,"uid")?spec.uid:generate$5("memento");return{get:function(anyInSystem){return anyInSystem.getSystem().getByUid(uid).getOrDie()},getOpt:function(anyInSystem){return anyInSystem.getSystem().getByUid(uid).toOptional()},asSpec:function(){return __assign(__assign({},spec),{uid:uid})}}},global$e=tinymce.util.Tools.resolve("tinymce.util.I18n"),rtlTransform={indent:!0,outdent:!0,"table-insert-column-after":!0,"table-insert-column-before":!0,"paste-column-after":!0,"paste-column-before":!0,"unordered-list":!0,"list-bull-circle":!0,"list-bull-default":!0,"list-bull-square":!0},defaultIcon=function(icons){return function(){return get$e(icons,"temporary-placeholder").getOr("!not found!")}},getIconName=function(name,icons){var lcName=name.toLowerCase();if(global$e.isRtl()){var rtlName=function(str,suffix){return endsWith(str,suffix)?str:function(str,suffix){return str+suffix}(str,suffix)}(lcName,"-rtl");return has$2(icons,rtlName)?rtlName:lcName}return lcName},lookupIcon=function(name,icons){return get$e(icons,getIconName(name,icons))},get$1=function(name,iconProvider){var icons=iconProvider();return lookupIcon(name,icons).getOrThunk(defaultIcon(icons))},addFocusableBehaviour=function(){return config("add-focusable",[runOnAttached((function(comp){child(comp.element,"svg").each((function(svg){return set$8(svg,"focusable","false")}))}))])},renderIcon$2=function(spec,iconName,icons,fallbackIcon){var _a,_b,rtlIconClasses=function(iconName){return!!global$e.isRtl()&&has$2(rtlTransform,iconName)}(iconName)?["tox-icon--flip"]:[],iconHtml=get$e(icons,getIconName(iconName,icons)).or(fallbackIcon).getOrThunk(defaultIcon(icons));return{dom:{tag:spec.tag,attributes:null!==(_a=spec.attributes)&&void 0!==_a?_a:{},classes:spec.classes.concat(rtlIconClasses),innerHtml:iconHtml},behaviours:derive$1(__spreadArray(__spreadArray([],null!==(_b=spec.behaviours)&&void 0!==_b?_b:[],!0),[addFocusableBehaviour()],!1))}},render$3=function(iconName,spec,iconProvider,fallbackIcon){return void 0===fallbackIcon&&(fallbackIcon=Optional.none()),renderIcon$2(spec,iconName,iconProvider(),fallbackIcon)},notificationIconMap={success:"checkmark",error:"warning",err:"error",warning:"warning",warn:"warning",info:"info"},Notification=single({name:"Notification",factory:function(detail){var iconNames,spec,iconProvider,icons,iconName,memBannerText=record({dom:{tag:"p",innerHtml:detail.translationProvider(detail.text)},behaviours:derive$1([Replacing.config({})])}),renderPercentBar=function(percent){return{dom:{tag:"div",classes:["tox-bar"],attributes:{style:"width: "+percent+"%"}}}},renderPercentText=function(percent){return{dom:{tag:"div",classes:["tox-text"],innerHtml:percent+"%"}}},memBannerProgress=record({dom:{tag:"div",classes:detail.progress?["tox-progress-bar","tox-progress-indicator"]:["tox-progress-bar"]},components:[{dom:{tag:"div",classes:["tox-bar-container"]},components:[renderPercentBar(0)]},renderPercentText(0)],behaviours:derive$1([Replacing.config({})])}),apis={updateProgress:function(comp,percent){comp.getSystem().isConnected()&&memBannerProgress.getOpt(comp).each((function(progress){Replacing.set(progress,[{dom:{tag:"div",classes:["tox-bar-container"]},components:[renderPercentBar(percent)]},renderPercentText(percent)])}))},updateText:function(comp,text$1){if(comp.getSystem().isConnected()){var banner=memBannerText.get(comp);Replacing.set(banner,[text(text$1)])}}},iconChoices=flatten([detail.icon.toArray(),detail.level.toArray(),detail.level.bind((function(level){return Optional.from(notificationIconMap[level])})).toArray()]),memButton=record(Button.sketch({dom:{tag:"button",classes:["tox-notification__dismiss","tox-button","tox-button--naked","tox-button--icon"]},components:[render$3("close",{tag:"div",classes:["tox-icon"],attributes:{"aria-label":detail.translationProvider("Close")}},detail.iconProvider)],action:function(comp){detail.onAction(comp)}})),components=[(iconNames=iconChoices,spec={tag:"div",classes:["tox-notification__icon"]},iconProvider=detail.iconProvider,icons=iconProvider(),iconName=find$5(iconNames,(function(name){return has$2(icons,getIconName(name,icons))})),renderIcon$2(spec,iconName.getOr("temporary-placeholder"),icons,Optional.none())),{dom:{tag:"div",classes:["tox-notification__body"]},components:[memBannerText.asSpec()],behaviours:derive$1([Replacing.config({})])}];return{uid:detail.uid,dom:{tag:"div",attributes:{role:"alert"},classes:detail.level.map((function(level){return["tox-notification","tox-notification--in","tox-notification--"+level]})).getOr(["tox-notification","tox-notification--in"])},behaviours:derive$1([Focusing.config({}),config("notification-events",[run$1(focusin(),(function(comp){memButton.getOpt(comp).each(Focusing.focus)}))])]),components:components.concat(detail.progress?[memBannerProgress.asSpec()]:[]).concat(detail.closeButton?[memButton.asSpec()]:[]),apis:apis}},configFields:[option("level"),required$1("progress"),required$1("icon"),required$1("onAction"),required$1("text"),required$1("iconProvider"),required$1("translationProvider"),defaultedBoolean("closeButton",!0)],apis:{updateProgress:function(apis,comp,percent){apis.updateProgress(comp,percent)},updateText:function(apis,comp,text){apis.updateText(comp,text)}}});function NotificationManagerImpl(editor,extras,uiMothership){var sharedBackstage=extras.backstage.shared;return{open:function(settings,closeCallback){var hideCloseButton=!settings.closeButton&&settings.timeout&&(settings.timeout>0||settings.timeout<0),close=function(){closeCallback(),InlineView.hide(notificationWrapper)},notification=build$1(Notification.sketch({text:settings.text,level:contains$2(["success","error","warning","warn","info"],settings.type)?settings.type:void 0,progress:!0===settings.progressBar,icon:Optional.from(settings.icon),closeButton:!hideCloseButton,onAction:close,iconProvider:sharedBackstage.providers.icons,translationProvider:sharedBackstage.providers.translate})),notificationWrapper=build$1(InlineView.sketch(__assign({dom:{tag:"div",classes:["tox-notifications-container"]},lazySink:sharedBackstage.getSink,fireDismissalEventInstead:{}},sharedBackstage.header.isPositionedAtTop()?{}:{fireRepositionEventInstead:{}})));uiMothership.add(notificationWrapper),settings.timeout>0&&global$f.setTimeout((function(){close()}),settings.timeout);var getBounds=function(){var contentArea=box$1(SugarElement.fromDom(editor.getContentAreaContainer())),win$1=win(),x=clamp$1(win$1.x,contentArea.x,contentArea.right),y=clamp$1(win$1.y,contentArea.y,contentArea.bottom),right=Math.max(contentArea.right,win$1.right),bottom=Math.max(contentArea.bottom,win$1.bottom);return Optional.some(bounds(x,y,right-x,bottom-y))};return{close:close,moveTo:function(x,y){InlineView.showAt(notificationWrapper,premade(notification),{anchor:{type:"makeshift",x:x,y:y}})},moveRel:function(element,rel){var notificationSpec=premade(notification),anchorOverrides={maxHeightFunction:expandable$1()};if("banner"!==rel&&isNonNullable(element)){var layoutDirection_1=function(rel){switch(rel){case"bc-bc":return south;case"tc-tc":return north;case"tc-bc":return north$2;case"bc-tc":default:return south$2}}(rel),nodeAnchor={type:"node",root:body(),node:Optional.some(SugarElement.fromDom(element)),overrides:anchorOverrides,layouts:{onRtl:function(){return[layoutDirection_1]},onLtr:function(){return[layoutDirection_1]}}};InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:nodeAnchor},getBounds)}else{var anchor=__assign(__assign({},sharedBackstage.anchors.banner()),{overrides:anchorOverrides});InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:anchor},getBounds)}},text:function(nuText){Notification.updateText(notification,nuText)},settings:settings,getEl:function(){return notification.element.dom},progressBar:{value:function(percent){Notification.updateProgress(notification,percent)}}}},close:function(notification){notification.close()},reposition:function(notifications){notifications.length>0&&each$1(notifications,(function(notification,index){0===index?notification.moveRel(null,"banner"):notification.moveRel(notifications[index-1].getEl(),"bc-tc")}))},getArgs:function(notification){return notification.settings}}}var ItemResponse,last=function(fn,rate){var timer=null,cancel=function(){isNull(timer)||(clearTimeout(timer),timer=null)};return{cancel:cancel,throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate)}}},global$d=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),repeatLeft=function(dom,node,offset,process,rootNode){var search=global$d(dom,(function(node){return function(dom,node){return dom.isBlock(node)||contains$2(["BR","IMG","HR","INPUT"],node.nodeName)||"false"===dom.getContentEditable(node)}(dom,node)}));return Optional.from(search.backwards(node,offset,process,rootNode))},create$4=function(editor,range){return detect(SugarElement.fromDom(editor.selection.getNode())).getOrThunk((function(){var wrapper=SugarElement.fromHtml('<span data-mce-autocompleter="1" data-mce-bogus="1"></span>',editor.getDoc());return append$2(wrapper,SugarElement.fromDom(range.extractContents())),range.insertNode(wrapper.dom),parent(wrapper).each((function(elm){return elm.dom.normalize()})),function(element){return descendantRtl(element,isCursorPosition)}(wrapper).map((function(last){editor.selection.setCursorLocation(last.dom,function(element){return"img"===name$2(element)?1:getOption(element).fold((function(){return children(element).length}),(function(v){return v.length}))}(last))})),wrapper}))},detect=function(elm){return closest$1(elm,"[data-mce-autocompleter]")},getText=function(rng){return rng.toString().replace(/\u00A0/g," ").replace(/\uFEFF/g,"")},isWhitespace=function(chr){return""!==chr&&-1!==" Â \f\n\r\t\v".indexOf(chr)},stripTriggerChar=function(text,triggerCh){return text.substring(triggerCh.length)},findStart=function(dom,initRange,ch,minChars){if(void 0===minChars&&(minChars=0),!(rng=initRange).collapsed||3!==rng.startContainer.nodeType)return Optional.none();var rng,root=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,(function(element,offset,text){return function(text,index,ch){var i;for(i=index-1;i>=0;i--){var char=text.charAt(i);if(isWhitespace(char))return Optional.none();if(char===ch)break}return Optional.some(i)}(text,offset,ch).getOr(offset)}),root).bind((function(spot){var range=initRange.cloneRange();if(range.setStart(spot.container,spot.offset),range.setEnd(initRange.endContainer,initRange.endOffset),range.collapsed)return Optional.none();var text=getText(range);return 0!==text.lastIndexOf(ch)||stripTriggerChar(text,ch).length<minChars?Optional.none():Optional.some({text:stripTriggerChar(text,ch),range:range,triggerChar:ch})}))},getContext=function(dom,initRange,ch,minChars){return void 0===minChars&&(minChars=0),detect(SugarElement.fromDom(initRange.startContainer)).fold((function(){return findStart(dom,initRange,ch,minChars)}),(function(elm){var range=dom.createRng();range.selectNode(elm.dom);var text=getText(range);return Optional.some({range:range,text:stripTriggerChar(text,ch),triggerChar:ch})}))},AutocompleterEditorEvents_setup=function(api,editor){editor.on("keypress compositionend",api.onKeypress.throttle),editor.on("remove",api.onKeypress.cancel);var redirectKeyToItem=function(item,e){emitWith(item,keydown(),{raw:e})};editor.on("keydown",(function(e){var getItem=function(){return api.getView().bind(Highlighting.getHighlighted)};8===e.which&&api.onKeypress.throttle(e),api.isActive()&&(27===e.which&&api.cancelIfNecessary(),api.isMenuOpen()?13===e.which?(getItem().each(emitExecute),e.preventDefault()):40===e.which?(getItem().fold((function(){api.getView().each(Highlighting.highlightFirst)}),(function(item){redirectKeyToItem(item,e)})),e.preventDefault(),e.stopImmediatePropagation()):37!==e.which&&38!==e.which&&39!==e.which||getItem().each((function(item){redirectKeyToItem(item,e),e.preventDefault(),e.stopImmediatePropagation()})):13!==e.which&&38!==e.which&&40!==e.which||api.cancelIfNecessary())})),editor.on("NodeChange",(function(e){api.isActive()&&!api.isProcessingAction()&&detect(SugarElement.fromDom(e.element)).isNone()&&api.cancelIfNecessary()}))},global$c=tinymce.util.Tools.resolve("tinymce.util.Promise"),point=function(container,offset){return{container:container,offset:offset}},toLast=function(node){if(function(node){return 3===node.nodeType}(node))return point(node,node.data.length);var children=node.childNodes;return children.length>0?toLast(children[children.length-1]):point(node,children.length)},toLeaf=function(node,offset){var children=node.childNodes;return children.length>0&&offset<children.length?toLeaf(children[offset],0):children.length>0&&function(node){return 1===node.nodeType}(node)&&children.length===offset?toLast(children[children.length-1]):point(node,offset)},isStartOfWord=function(dom){return function(rng){var leaf=toLeaf(rng.startContainer,rng.startOffset);return!function(dom,leaf){return repeatLeft(dom,leaf.container,leaf.offset,(function(element,offset){return 0===offset?-1:offset}),dom.getRoot()).filter((function(spot){var char=spot.container.data.charAt(spot.offset-1);return!isWhitespace(char)})).isSome()}(dom,leaf)}},lookup$2=function(editor,getDatabase){var database=getDatabase(),rng=editor.selection.getRng();return function(dom,initRange,database){return findMap(database.triggerChars,(function(ch){return getContext(dom,initRange,ch)}))}(editor.dom,rng,database).bind((function(context){return lookupWithContext(editor,getDatabase,context)}))},lookupWithContext=function(editor,getDatabase,context,fetchOptions){void 0===fetchOptions&&(fetchOptions={});var database=getDatabase(),startText=editor.selection.getRng().startContainer.nodeValue,autocompleters=filter$2(database.lookupByChar(context.triggerChar),(function(autocompleter){return context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk((function(){return isStartOfWord(editor.dom)}))(context.range,startText,context.text)}));if(0===autocompleters.length)return Optional.none();var lookupData=global$c.all(map$2(autocompleters,(function(ac){return ac.fetch(context.text,ac.maxResults,fetchOptions).then((function(results){return{matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn}}))})));return Optional.some({lookupData:lookupData,context:context})},separatorMenuItemSchema=objOf([requiredString("type"),optionString("text")]),autocompleterItemSchema=objOf([defaulted("type","autocompleteitem"),defaulted("active",!1),defaulted("disabled",!1),defaulted("meta",{}),requiredString("value"),optionString("text"),optionString("icon")]),autocompleterSchema=objOf([requiredString("type"),requiredString("ch"),defaultedNumber("minChars",1),defaulted("columns",1),defaultedNumber("maxResults",10),optionFunction("matches"),requiredFunction("fetch"),requiredFunction("onAction"),defaultedArrayOf("highlightOn",[],string)]),baseToolbarButtonFields=[defaultedBoolean("disabled",!1),optionString("tooltip"),optionString("icon"),optionString("text"),defaultedFunction("onSetup",(function(){return noop}))],toolbarButtonSchema=objOf([requiredString("type"),requiredFunction("onAction")].concat(baseToolbarButtonFields)),createToolbarButton=function(spec){return asRaw("toolbarbutton",toolbarButtonSchema,spec)},baseToolbarToggleButtonFields=[defaultedBoolean("active",!1)].concat(baseToolbarButtonFields),toggleButtonSchema=objOf(baseToolbarToggleButtonFields.concat([requiredString("type"),requiredFunction("onAction")])),createToggleButton=function(spec){return asRaw("ToggleButton",toggleButtonSchema,spec)},contextBarFields=[defaultedFunction("predicate",never),defaultedStringEnum("scope","node",["node","editor"]),defaultedStringEnum("position","selection",["node","selection","line"])],contextButtonFields=baseToolbarButtonFields.concat([defaulted("type","contextformbutton"),defaulted("primary",!1),requiredFunction("onAction"),customField("original",identity$1)]),contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaulted("type","contextformbutton"),defaulted("primary",!1),requiredFunction("onAction"),customField("original",identity$1)]),launchButtonFields=baseToolbarButtonFields.concat([defaulted("type","contextformbutton")]),launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaulted("type","contextformtogglebutton")]),toggleOrNormal=choose$1("type",{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields}),contextFormSchema=objOf([defaulted("type","contextform"),defaultedFunction("initValue",constant$1("")),optionString("label"),requiredArrayOf("commands",toggleOrNormal),optionOf("launch",choose$1("type",{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields)),contextToolbarSchema=objOf([defaulted("type","contexttoolbar"),requiredString("items")].concat(contextBarFields)),register$b=function(editor){var popups=editor.ui.registry.getAll().popups,dataset=map$1(popups,(function(popup){return(spec=popup,asRaw("Autocompleter",autocompleterSchema,spec)).fold((function(err){throw new Error(formatError(err))}),identity$1);var spec})),triggerChars=function(a){var all={};return each$1(a,(function(key){all[key]={}})),keys(all)}(mapToArray(dataset,(function(v){return v.ch}))),datasetValues=values(dataset);return{dataset:dataset,triggerChars:triggerChars,lookupByChar:function(ch){return filter$2(datasetValues,(function(dv){return dv.ch===ch}))}}};!function(ItemResponse){ItemResponse[ItemResponse.CLOSE_ON_EXECUTE=0]="CLOSE_ON_EXECUTE",ItemResponse[ItemResponse.BUBBLE_TO_SANDBOX=1]="BUBBLE_TO_SANDBOX"}(ItemResponse||(ItemResponse={}));var ToolbarMode,ItemResponse$1=ItemResponse,navClass="tox-menu-nav__js",presetClasses={normal:navClass,color:"tox-swatch"},textClass="tox-collection__item-label",activeClass="tox-collection__item--active",classForPreset=function(presets){return get$e(presetClasses,presets).getOr(navClass)},forMenu=function(presets){return"color"===presets?"tox-swatches":"tox-menu"},classes=function(presets){return{backgroundMenu:"tox-background-menu",selectedMenu:"tox-selected-menu",selectedItem:"tox-collection__item--active",hasIcons:"tox-menu--has-icons",menu:forMenu(presets),tieredMenu:"tox-tiered-menu"}},markers=function(presets){var menuClasses=classes(presets);return{backgroundMenu:menuClasses.backgroundMenu,selectedMenu:menuClasses.selectedMenu,menu:menuClasses.menu,selectedItem:menuClasses.selectedItem,item:classForPreset(presets)}},dom$1=function(hasIcons,columns,presets){var menuClasses=classes(presets);return{tag:"div",classes:flatten([[menuClasses.menu,"tox-menu-"+columns+"-column"],hasIcons?[menuClasses.hasIcons]:[]])}},components=[Menu.parts.items({})],part=function(hasIcons,columns,presets){var menuClasses=classes(presets);return{dom:{tag:"div",classes:flatten([[menuClasses.tieredMenu]])},markers:markers(presets)}},chunk=function(rowDom,numColumns){return function(items){var chunks=chunk$1(items,numColumns);return map$2(chunks,(function(c){return{dom:rowDom,components:c}}))}},preprocessCollection=function(items,isSeparator){var allSplits=[],currentSplit=[];return each$1(items,(function(item,i){isSeparator(item,i)?(currentSplit.length>0&&allSplits.push(currentSplit),currentSplit=[],has$2(item.dom,"innerHtml")&&currentSplit.push(item)):currentSplit.push(item)})),currentSplit.length>0&&allSplits.push(currentSplit),map$2(allSplits,(function(s){return{dom:{tag:"div",classes:["tox-collection__group"]},components:s}}))},forCollection=function(columns,initItems,_hasIcons){return{dom:{tag:"div",classes:["tox-menu","tox-collection"].concat(1===columns?["tox-collection--list"]:["tox-collection--grid"])},components:[Menu.parts.items({preprocess:function(items){return"auto"!==columns&&columns>1?chunk({tag:"div",classes:["tox-collection__group"]},columns)(items):preprocessCollection(items,(function(_item,i){return"separator"===initItems[i].type}))}})]}},menuHasIcons=function(xs){return exists(xs,(function(item){return"icon"in item&&void 0!==item.icon}))},handleError=function(error){return console.error(formatError(error)),console.log(error),Optional.none()},createHorizontalPartialMenuWithAlloyItems=function(value,_hasIcons,items,_columns,_presets){var initItems,structure=(initItems=items,{dom:{tag:"div",classes:["tox-collection","tox-collection--horizontal"]},components:[Menu.parts.items({preprocess:function(items){return preprocessCollection(items,(function(_item,i){return"separator"===initItems[i].type}))}})]});return{value:value,dom:structure.dom,components:structure.components,items:items}},createPartialMenuWithAlloyItems=function(value,hasIcons,items,columns,presets){var structure;return"color"===presets?{value:value,dom:(structure=function(columns){return{dom:{tag:"div",classes:["tox-menu","tox-swatches-menu"]},components:[{dom:{tag:"div",classes:["tox-swatches"]},components:[Menu.parts.items({preprocess:"auto"!==columns?chunk({tag:"div",classes:["tox-swatches__row"]},columns):identity$1})]}]}}(columns)).dom,components:structure.components,items:items}:"normal"===presets&&"auto"===columns?{value:value,dom:(structure=forCollection(columns,items)).dom,components:structure.components,items:items}:"normal"===presets&&1===columns?{value:value,dom:(structure=forCollection(1,items)).dom,components:structure.components,items:items}:"normal"===presets?{value:value,dom:(structure=forCollection(columns,items)).dom,components:structure.components,items:items}:"listpreview"===presets&&"auto"!==columns?{value:value,dom:(structure=function(columns){return{dom:{tag:"div",classes:["tox-menu","tox-collection","tox-collection--toolbar","tox-collection--toolbar-lg"]},components:[Menu.parts.items({preprocess:chunk({tag:"div",classes:["tox-collection__group"]},columns)})]}}(columns)).dom,components:structure.components,items:items}:{value:value,dom:dom$1(hasIcons,columns,presets),components:components,items:items}},cardImageFields=[requiredString("type"),requiredString("src"),optionString("alt"),defaultedArrayOf("classes",[],string)],cardImageSchema=objOf(cardImageFields),cardTextFields=[requiredString("type"),requiredString("text"),optionString("name"),defaultedArrayOf("classes",["tox-collection__item-label"],string)],cardTextSchema=objOf(cardTextFields),itemSchema$1=valueThunk((function(){return choose$2("type",{cardimage:cardImageSchema,cardtext:cardTextSchema,cardcontainer:cardContainerSchema})})),cardContainerSchema=objOf([requiredString("type"),defaultedString("direction","horizontal"),defaultedString("align","left"),defaultedString("valign","middle"),requiredArrayOf("items",itemSchema$1)]),commonMenuItemFields=[defaultedBoolean("disabled",!1),optionString("text"),optionString("shortcut"),field$1("value","value",defaultedThunk((function(){return generate$6("menuitem-value")})),anyValue()),defaulted("meta",{})],cardMenuItemSchema=objOf([requiredString("type"),optionString("label"),requiredArrayOf("items",itemSchema$1),defaultedFunction("onSetup",(function(){return noop})),defaultedFunction("onAction",noop)].concat(commonMenuItemFields)),choiceMenuItemSchema=objOf([requiredString("type"),defaultedBoolean("active",!1),optionString("icon")].concat(commonMenuItemFields)),baseFields=[requiredString("type"),requiredString("fancytype"),defaultedFunction("onAction",noop)],insertTableFields=[defaulted("initData",{})].concat(baseFields),colorSwatchFields=[defaultedObjOf("initData",{},[defaultedBoolean("allowCustomColors",!0),optionArrayOf("colors",anyValue())])].concat(baseFields),fancyMenuItemSchema=choose$1("fancytype",{inserttable:insertTableFields,colorswatch:colorSwatchFields}),menuItemSchema=objOf([requiredString("type"),defaultedFunction("onSetup",(function(){return noop})),defaultedFunction("onAction",noop),optionString("icon")].concat(commonMenuItemFields)),nestedMenuItemSchema=objOf([requiredString("type"),requiredFunction("getSubmenuItems"),defaultedFunction("onSetup",(function(){return noop})),optionString("icon")].concat(commonMenuItemFields)),toggleMenuItemSchema=objOf([requiredString("type"),optionString("icon"),defaultedBoolean("active",!1),defaultedFunction("onSetup",(function(){return noop})),requiredFunction("onAction")].concat(commonMenuItemFields)),detectSize=function(comp,margin,selectorClass){var descendants$1=descendants(comp.element,"."+selectorClass);if(descendants$1.length>0){var columnLength=findIndex$1(descendants$1,(function(c){var thisTop=c.dom.getBoundingClientRect().top,cTop=descendants$1[0].dom.getBoundingClientRect().top;return Math.abs(thisTop-cTop)>margin})).getOr(descendants$1.length);return Optional.some({numColumns:columnLength,numRows:Math.ceil(descendants$1.length/columnLength)})}return Optional.none()},namedEvents=function(name,handlers){return derive$1([config(name,handlers)])},SimpleBehaviours_unnamedEvents=function(handlers){return namedEvents(generate$6("unnamed-events"),handlers)},ExclusivityChannel=generate$6("tooltip.exclusive"),ShowTooltipEvent=generate$6("tooltip.show"),HideTooltipEvent=generate$6("tooltip.hide"),hideAllExclusive=function(component,_tConfig,_tState){component.getSystem().broadcastOn([ExclusivityChannel],{})},TooltippingApis=Object.freeze({__proto__:null,hideAllExclusive:hideAllExclusive,setComponents:function(component,tConfig,tState,specs){tState.getTooltip().each((function(tooltip){tooltip.getSystem().isConnected()&&Replacing.set(tooltip,specs)}))}}),ActiveTooltipping=Object.freeze({__proto__:null,events:function(tooltipConfig,state){var hide=function(comp){state.getTooltip().each((function(p){detach(p),tooltipConfig.onHide(comp,p),state.clearTooltip()})),state.clearTimer()};return derive$2(flatten([[run$1(ShowTooltipEvent,(function(comp){state.resetTimer((function(){!function(comp){if(!state.isShowing()){hideAllExclusive(comp);var sink=tooltipConfig.lazySink(comp).getOrDie(),popup=comp.getSystem().build({dom:tooltipConfig.tooltipDom,components:tooltipConfig.tooltipComponents,events:derive$2("normal"===tooltipConfig.mode?[run$1(mouseover(),(function(_){emit(comp,ShowTooltipEvent)})),run$1(mouseout(),(function(_){emit(comp,HideTooltipEvent)}))]:[]),behaviours:derive$1([Replacing.config({})])});state.setTooltip(popup),attach(sink,popup),tooltipConfig.onShow(comp,popup),Positioning.position(sink,popup,{anchor:tooltipConfig.anchor(comp)})}}(comp)}),tooltipConfig.delay)})),run$1(HideTooltipEvent,(function(comp){state.resetTimer((function(){hide(comp)}),tooltipConfig.delay)})),run$1(receive(),(function(comp,message){var receivingData=message;receivingData.universal||contains$2(receivingData.channels,ExclusivityChannel)&&hide(comp)})),runOnDetached((function(comp){hide(comp)}))],"normal"===tooltipConfig.mode?[run$1(focusin(),(function(comp){emit(comp,ShowTooltipEvent)})),run$1(postBlur(),(function(comp){emit(comp,HideTooltipEvent)})),run$1(mouseover(),(function(comp){emit(comp,ShowTooltipEvent)})),run$1(mouseout(),(function(comp){emit(comp,HideTooltipEvent)}))]:[run$1(highlight$1(),(function(comp,_se){emit(comp,ShowTooltipEvent)})),run$1(dehighlight$1(),(function(comp){emit(comp,HideTooltipEvent)}))]]))}}),TooltippingSchema=[required$1("lazySink"),required$1("tooltipDom"),defaulted("exclusive",!0),defaulted("tooltipComponents",[]),defaulted("delay",300),defaultedStringEnum("mode","normal",["normal","follow-highlight"]),defaulted("anchor",(function(comp){return{type:"hotspot",hotspot:comp,layouts:{onLtr:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2]),onRtl:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2])}}})),onHandler("onHide"),onHandler("onShow")],Tooltipping=create$7({fields:TooltippingSchema,name:"tooltipping",active:ActiveTooltipping,state:Object.freeze({__proto__:null,init:function(){var timer=value$1(),popup=value$1(),clearTimer=function(){timer.on(clearTimeout)},readState=constant$1("not-implemented");return nu$8({getTooltip:popup.get,isShowing:popup.isSet,setTooltip:popup.set,clearTooltip:popup.clear,clearTimer:clearTimer,resetTimer:function(f,delay){clearTimer(),timer.set(setTimeout(f,delay))},readState:readState})}}),apis:TooltippingApis}),global$b=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$a=tinymce.util.Tools.resolve("tinymce.EditorManager"),getHeightSetting=function(editor){return editor.getParam("height",Math.max(editor.getElement().offsetHeight,200))},getWidthSetting=function(editor){return editor.getParam("width",global$b.DOM.getStyle(editor.getElement(),"width"))},getMinWidthSetting=function(editor){return Optional.from(editor.getParam("min_width")).filter(isNumber)},getMinHeightSetting=function(editor){return Optional.from(editor.getParam("min_height")).filter(isNumber)},getMaxWidthSetting=function(editor){return Optional.from(editor.getParam("max_width")).filter(isNumber)},getMaxHeightSetting=function(editor){return Optional.from(editor.getParam("max_height")).filter(isNumber)},isMenubarEnabled=function(editor){return!1!==editor.getParam("menubar",!0,"boolean")},isToolbarEnabled=function(editor){var toolbar=editor.getParam("toolbar",!0),isToolbarTrue=!0===toolbar,isToolbarString=isString(toolbar),isToolbarObjectArray=isArray(toolbar)&&toolbar.length>0;return!isMultipleToolbars(editor)&&(isToolbarObjectArray||isToolbarString||isToolbarTrue)},getMultipleToolbarsSetting=function(editor){var toolbars=range$2(9,(function(num){return editor.getParam("toolbar"+(num+1),!1,"string")})),toolbarArray=filter$2(toolbars,(function(toolbar){return"string"==typeof toolbar}));return toolbarArray.length>0?Optional.some(toolbarArray):Optional.none()},isMultipleToolbars=function(editor){return getMultipleToolbarsSetting(editor).fold((function(){return editor.getParam("toolbar",[],"string[]").length>0}),always)};!function(ToolbarMode){ToolbarMode.default="wrap",ToolbarMode.floating="floating",ToolbarMode.sliding="sliding",ToolbarMode.scrolling="scrolling"}(ToolbarMode||(ToolbarMode={}));var ToolbarLocation,getToolbarMode=function(editor){return editor.getParam("toolbar_mode","","string")};!function(ToolbarLocation){ToolbarLocation.auto="auto",ToolbarLocation.top="top",ToolbarLocation.bottom="bottom"}(ToolbarLocation||(ToolbarLocation={}));var key,_a$1,getToolbarLocation=function(editor){return editor.getParam("toolbar_location",ToolbarLocation.auto,"string")},isToolbarLocationBottom=function(editor){return getToolbarLocation(editor)===ToolbarLocation.bottom},fixedContainerTarget=function(editor){if(!editor.inline)return Optional.none();var selector=function(editor){return editor.getParam("fixed_toolbar_container","","string")}(editor);if(selector.length>0)return descendant(body(),selector);var element=function(editor){return editor.getParam("fixed_toolbar_container_target")}(editor);return isNonNullable(element)?Optional.some(SugarElement.fromDom(element)):Optional.none()},useFixedContainer=function(editor){return editor.inline&&fixedContainerTarget(editor).isSome()},getUiContainer=function(editor){return fixedContainerTarget(editor).getOrThunk((function(){return getContentContainer(getRootNode(SugarElement.fromDom(editor.getElement())))}))},isDistractionFree=function(editor){return editor.inline&&!isMenubarEnabled(editor)&&!isToolbarEnabled(editor)&&!isMultipleToolbars(editor)},isStickyToolbar=function(editor){return(editor.getParam("toolbar_sticky",!1,"boolean")||editor.inline)&&!useFixedContainer(editor)&&!isDistractionFree(editor)},getMenus=function(editor){var menu=editor.getParam("menu");return menu?map$1(menu,(function(menu){return __assign(__assign({},menu),{items:menu.items})})):{}},getMenubar=function(editor){return editor.getParam("menubar")},getAnchorTop=function(editor){return editor.getParam("anchor_top","#top")},getAnchorBottom=function(editor){return editor.getParam("anchor_bottom","#bottom")},ReadOnlyDataSchema=objOf([(key="readonly",requiredOf(key,boolean))]),broadcastReadonly=function(uiComponents,readonly){var target=uiComponents.outerContainer.element;readonly&&(uiComponents.mothership.broadcastOn([dismissPopups()],{target:target}),uiComponents.uiMothership.broadcastOn([dismissPopups()],{target:target})),uiComponents.mothership.broadcastOn(["silver.readonly"],{readonly:readonly}),uiComponents.uiMothership.broadcastOn(["silver.readonly"],{readonly:readonly})},setupReadonlyModeSwitch=function(editor,uiComponents){editor.on("init",(function(){editor.mode.isReadOnly()&&broadcastReadonly(uiComponents,!0)})),editor.on("SwitchMode",(function(){return broadcastReadonly(uiComponents,editor.mode.isReadOnly())})),function(editor){return editor.getParam("readonly",!1,"boolean")}(editor)&&editor.setMode("readonly")},receivingConfig=function(){var _a;return Receiving.config({channels:(_a={},_a["silver.readonly"]={schema:ReadOnlyDataSchema,onReceive:function(comp,data){Disabling.set(comp,data.readonly)}},_a)})},DisablingConfigs_item=function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-collection__item--state-disabled"})},DisablingConfigs_button=function(disabled){return Disabling.config({disabled:disabled})},DisablingConfigs_splitButton=function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-tbtn--disabled"})},DisablingConfigs_toolbarButton=function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-tbtn--disabled",useNative:!1})},runWithApi=function(info,comp){var api=info.getApi(comp);return function(f){f(api)}},onControlAttached=function(info,editorOffCell){return runOnAttached((function(comp){runWithApi(info,comp)((function(api){var onDestroy=info.onSetup(api);isFunction(onDestroy)&&editorOffCell.set(onDestroy)}))}))},onControlDetached=function(getApi,editorOffCell){return runOnDetached((function(comp){return runWithApi(getApi,comp)(editorOffCell.get())}))},onMenuItemExecute=function(info,itemResponse){return runOnExecute$1((function(comp,simulatedEvent){runWithApi(info,comp)(info.onAction),info.triggersSubmenu||itemResponse!==ItemResponse$1.CLOSE_ON_EXECUTE||(emit(comp,sandboxClose()),simulatedEvent.stop())}))},menuItemEventOrder=((_a$1={})[execute$5()]=["disabling","alloy.base.behaviour","toggling","item-events"],_a$1),componentRenderPipeline=cat,renderCommonItem=function(spec,structure,itemResponse,providersbackstage){var editorOffCell=Cell(noop);return{type:"item",dom:structure.dom,components:componentRenderPipeline(structure.optComponents),data:spec.data,eventOrder:menuItemEventOrder,hasSubmenu:spec.triggersSubmenu,itemBehaviours:derive$1([config("item-events",[onMenuItemExecute(spec,itemResponse),onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),DisablingConfigs_item((function(){return spec.disabled||providersbackstage.isDisabled()})),receivingConfig(),Replacing.config({})].concat(spec.itemBehaviours))}},buildData=function(source){return{value:source.value,meta:__assign({text:source.text.getOr("")},source.meta)}},global$9=tinymce.util.Tools.resolve("tinymce.Env"),convertText=function(source){var replace=global$9.mac?{alt:"&#x2325;",ctrl:"&#x2303;",shift:"&#x21E7;",meta:"&#x2318;",access:"&#x2303;&#x2325;"}:{meta:"Ctrl",access:"Shift+Alt"},shortcut=source.split("+"),updated=map$2(shortcut,(function(segment){var search=segment.toLowerCase().trim();return has$2(replace,search)?replace[search]:segment}));return global$9.mac?updated.join(""):updated.join("+")},renderIcon$1=function(name,icons,classes){return void 0===classes&&(classes=["tox-collection__item-icon"]),render$3(name,{tag:"div",classes:classes},icons)},renderText=function(text$1){return{dom:{tag:"div",classes:[textClass]},components:[text(global$e.translate(text$1))]}},renderHtml=function(html,classes){return{dom:{tag:"div",classes:classes,innerHtml:html}}},renderStyledText=function(style,text$1){return{dom:{tag:"div",classes:[textClass]},components:[{dom:{tag:style.tag,styles:style.styles},components:[text(global$e.translate(text$1))]}]}},renderShortcut=function(shortcut){return{dom:{tag:"div",classes:["tox-collection__item-accessory"],innerHtml:convertText(shortcut)}}},renderCheckmark=function(icons){return renderIcon$1("checkmark",icons,["tox-collection__item-checkmark"])},renderColorStructure=function(item,providerBackstage,fallbackIcon){var icon,baseDom,itemText=item.ariaLabel,itemValue=item.value,iconSvg=item.iconContent.map((function(name){return function(name,iconProvider,fallbackIcon){var icons=iconProvider();return lookupIcon(name,icons).or(fallbackIcon).getOrThunk(defaultIcon(icons))}(name,providerBackstage.icons,fallbackIcon)}));return{dom:(icon=iconSvg.getOr(""),baseDom={tag:"div",attributes:itemText.map((function(text){return{title:providerBackstage.translate(text)}})).getOr({}),classes:["tox-swatch"]},__assign(__assign({},baseDom),"custom"===itemValue?{tag:"button",classes:__spreadArray(__spreadArray([],baseDom.classes,!0),["tox-swatches__picker-btn"],!1),innerHtml:icon}:"remove"===itemValue?{classes:__spreadArray(__spreadArray([],baseDom.classes,!0),["tox-swatch--remove"],!1),innerHtml:icon}:{attributes:__assign(__assign({},baseDom.attributes),{"data-mce-color":itemValue}),styles:{"background-color":itemValue}})),optComponents:[]}},renderItemDomStructure=function(ariaLabel){var domTitle=ariaLabel.map((function(label){return{attributes:{title:global$e.translate(label)}}})).getOr({});return __assign({tag:"div",classes:[navClass,"tox-collection__item"]},domTitle)},renderItemStructure=function(info,providersBackstage,renderIcons,fallbackIcon){return void 0===fallbackIcon&&(fallbackIcon=Optional.none()),"color"===info.presets?renderColorStructure(info,providersBackstage,fallbackIcon):function(info,providersBackstage,renderIcons,fallbackIcon){var iconSpec={tag:"div",classes:["tox-collection__item-icon"]},leftIcon=renderIcons?info.iconContent.map((function(iconName){return render$3(iconName,iconSpec,providersBackstage.icons,fallbackIcon)})).orThunk((function(){return Optional.some({dom:iconSpec})})):Optional.none(),checkmark=info.checkMark,textRender=Optional.from(info.meta).fold((function(){return renderText}),(function(meta){return has$2(meta,"style")?curry(renderStyledText,meta.style):renderText})),content=info.htmlContent.fold((function(){return info.textContent.map(textRender)}),(function(html){return Optional.some(renderHtml(html,[textClass]))}));return{dom:renderItemDomStructure(info.ariaLabel),optComponents:[leftIcon,content,info.shortcutContent.map(renderShortcut),checkmark,info.caret]}}(info,providersBackstage,renderIcons,fallbackIcon)},tooltipBehaviour=function(meta,sharedBackstage){return get$e(meta,"tooltipWorker").map((function(tooltipWorker){return[Tooltipping.config({lazySink:sharedBackstage.getSink,tooltipDom:{tag:"div",classes:["tox-tooltip-worker-container"]},tooltipComponents:[],anchor:function(comp){return{type:"submenu",item:comp,overrides:{maxHeightFunction:expandable$1}}},mode:"follow-highlight",onShow:function(component,_tooltip){tooltipWorker((function(elm){Tooltipping.setComponents(component,[external$2({element:SugarElement.fromDom(elm)})])}))}})]})).getOr([])},replaceText=function(text,matchText){var encoded=function(text){return global$b.DOM.encode(text)}(global$e.translate(text));if(matchText.length>0){var escapedMatchRegex=new RegExp(function(text){return text.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(matchText),"gi");return encoded.replace(escapedMatchRegex,(function(match){return'<span class="tox-autocompleter-highlight">'+match+"</span>"}))}return encoded},render$2=function(items,extras){return map$2(items,(function(item){switch(item.type){case"cardcontainer":return function(container,components){return{dom:{tag:"div",classes:["tox-collection__item-container","vertical"===container.direction?"tox-collection__item-container--column":"tox-collection__item-container--row","left"===container.align?"tox-collection__item-container--align-left":"tox-collection__item-container--align-right",function(){switch(container.valign){case"top":return"tox-collection__item-container--valign-top";case"middle":return"tox-collection__item-container--valign-middle";case"bottom":return"tox-collection__item-container--valign-bottom"}}()]},components:components}}(item,render$2(item.items,extras));case"cardimage":return function(src,classes,alt){return{dom:{tag:"img",classes:classes,attributes:{src:src,alt:alt.getOr("")}}}}(item.src,item.classes,item.alt);case"cardtext":var matchText=item.name.exists((function(name){return contains$2(extras.cardText.highlightOn,name)}))?Optional.from(extras.cardText.matchText).getOr(""):"";return renderHtml(replaceText(item.text,matchText),item.classes)}}))},parts$f=generate$3(owner$2(),parts$h()),hexColour=function(value){return{value:value}},shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longformRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,isHexString=function(hex){return shorthandRegex.test(hex)||longformRegex.test(hex)},normalizeHex=function(hex){return function(str,prefix){return startsWith(str,prefix)?function(str,numChars){return str.substring(numChars)}(str,prefix.length):str}(hex,"#").toUpperCase()},extractValues=function(hex){var longForm=function(hex){return{value:hex.value.replace(shorthandRegex,(function(m,r,g,b){return r+r+g+g+b+b}))}}(hex),splitForm=longformRegex.exec(longForm.value);return null===splitForm?["FFFFFF","FF","FF","FF"]:splitForm},toHex=function(component){var hex=component.toString(16);return(1===hex.length?"0"+hex:hex).toUpperCase()},fromRgba=function(rgbaColour){var value=toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue);return hexColour(value)},min=Math.min,max=Math.max,round$1=Math.round,rgbRegex=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/,rgbaRegex=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/,rgbaColour=function(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha}},isRgbaComponent=function(value){var num=parseInt(value,10);return num.toString()===value&&num>=0&&num<=255},fromHsv=function(hsv){var r,g,b,hue=(hsv.hue||0)%360,saturation=hsv.saturation/100,brightness=hsv.value/100;if(saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0===saturation)return r=g=b=round$1(255*brightness),rgbaColour(r,g,b,1);var side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}return r=round$1(255*(r+match)),g=round$1(255*(g+match)),b=round$1(255*(b+match)),rgbaColour(r,g,b,1)},fromHex=function(hexColour){var result=extractValues(hexColour),red=parseInt(result[1],16),green=parseInt(result[2],16),blue=parseInt(result[3],16);return rgbaColour(red,green,blue,1)},fromStringValues=function(red,green,blue,alpha){var r=parseInt(red,10),g=parseInt(green,10),b=parseInt(blue,10),a=parseFloat(alpha);return rgbaColour(r,g,b,a)},fromString=function(rgbaString){if("transparent"===rgbaString)return Optional.some(rgbaColour(0,0,0,0));var rgbMatch=rgbRegex.exec(rgbaString);if(null!==rgbMatch)return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],"1"));var rgbaMatch=rgbaRegex.exec(rgbaString);return null!==rgbaMatch?Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4])):Optional.none()},toString=function(rgba){return"rgba("+rgba.red+","+rgba.green+","+rgba.blue+","+rgba.alpha+")"},red=rgbaColour(255,0,0,1),fireResizeContent=function(editor,e){return editor.fire("ResizeContent",e)},hsvColour=function(hue,saturation,value){return{hue:hue,saturation:saturation,value:value}},fromRgb=function(rgbaColour){var s,h=0,v=0,r=rgbaColour.red/255,g=rgbaColour.green/255,b=rgbaColour.blue/255,minRGB=Math.min(r,Math.min(g,b)),maxRGB=Math.max(r,Math.max(g,b));return minRGB===maxRGB?hsvColour(0,0,100*(v=minRGB)):(h=60*((h=r===minRGB?3:b===minRGB?1:5)-(r===minRGB?g-b:b===minRGB?r-g:b-r)/(maxRGB-minRGB)),s=(maxRGB-minRGB)/maxRGB,v=maxRGB,hsvColour(Math.round(h),Math.round(100*s),Math.round(100*v)))},hsvToHex=function(hsv){return fromRgba(fromHsv(hsv))},anyToHex=function(color){return(hex=color,isHexString(hex)?Optional.some({value:normalizeHex(hex)}):Optional.none()).orThunk((function(){return fromString(color).map(fromRgba)})).getOrThunk((function(){var canvas=document.createElement("canvas");canvas.height=1,canvas.width=1;var canvasContext=canvas.getContext("2d");canvasContext.clearRect(0,0,canvas.width,canvas.height),canvasContext.fillStyle="#FFFFFF",canvasContext.fillStyle=color,canvasContext.fillRect(0,0,1,1);var rgba=canvasContext.getImageData(0,0,1,1).data,r=rgba[0],g=rgba[1],b=rgba[2],a=rgba[3];return fromRgba(rgbaColour(r,g,b,a))}));var hex},global$8=tinymce.util.Tools.resolve("tinymce.util.LocalStorage");var FocusMode,choiceItem="choiceitem",defaultColors=[{type:choiceItem,text:"Light Green",value:"#BFEDD2"},{type:choiceItem,text:"Light Yellow",value:"#FBEEB8"},{type:choiceItem,text:"Light Red",value:"#F8CAC6"},{type:choiceItem,text:"Light Purple",value:"#ECCAFA"},{type:choiceItem,text:"Light Blue",value:"#C2E0F4"},{type:choiceItem,text:"Green",value:"#2DC26B"},{type:choiceItem,text:"Yellow",value:"#F1C40F"},{type:choiceItem,text:"Red",value:"#E03E2D"},{type:choiceItem,text:"Purple",value:"#B96AD9"},{type:choiceItem,text:"Blue",value:"#3598DB"},{type:choiceItem,text:"Dark Turquoise",value:"#169179"},{type:choiceItem,text:"Orange",value:"#E67E23"},{type:choiceItem,text:"Dark Red",value:"#BA372A"},{type:choiceItem,text:"Dark Purple",value:"#843FA1"},{type:choiceItem,text:"Dark Blue",value:"#236FA1"},{type:choiceItem,text:"Light Gray",value:"#ECF0F1"},{type:choiceItem,text:"Medium Gray",value:"#CED4D9"},{type:choiceItem,text:"Gray",value:"#95A5A6"},{type:choiceItem,text:"Dark Gray",value:"#7E8C8D"},{type:choiceItem,text:"Navy Blue",value:"#34495E"},{type:choiceItem,text:"Black",value:"#000000"},{type:choiceItem,text:"White",value:"#ffffff"}],colorCache=function ColorCache(max){void 0===max&&(max=10);var list,storageString=global$8.getItem("tinymce-custom-colors"),localstorage=isString(storageString)?JSON.parse(storageString):[],cache=max-(list=localstorage).length<0?list.slice(0,max):list,remove=function(idx){cache.splice(idx,1)};return{add:function(key){(function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Optional.none():Optional.some(r)})(cache,key).each(remove),cache.unshift(key),cache.length>max&&cache.pop(),global$8.setItem("tinymce-custom-colors",JSON.stringify(cache))},state:function(){return cache.slice(0)}}}(10),hasCustomColors$1=function(editor){return!1!==editor.getParam("custom_colors")},getColors$2=function(editor){var unmapped=function(editor){return editor.getParam("color_map")}(editor);return void 0!==unmapped?function(colorMap){for(var colors=[],i=0;i<colorMap.length;i+=2)colors.push({text:colorMap[i+1],value:"#"+anyToHex(colorMap[i]).value,type:"choiceitem"});return colors}(unmapped):defaultColors},addColor=function(color){colorCache.add(color)},getColorCols$1=function(editor){return function(editor,defaultCols){return editor.getParam("color_cols",defaultCols,"number")}(editor,function(colors){return Math.max(5,Math.ceil(Math.sqrt(colors)))}(getColors$2(editor).length))},getAdditionalColors=function(hasCustom){var remove={type:"choiceitem",text:"Remove color",icon:"color-swatch-remove-color",value:"remove"};return hasCustom?[remove,{type:"choiceitem",text:"Custom color",icon:"color-picker",value:"custom"}]:[remove]},applyColor=function(editor,format,value,onChoice){"custom"===value?colorPickerDialog(editor)((function(colorOpt){colorOpt.each((function(color){addColor(color),editor.execCommand("mceApplyTextcolor",format,color),onChoice(color)}))}),"#000000"):"remove"===value?(onChoice(""),editor.execCommand("mceRemoveTextcolor",format)):(onChoice(value),editor.execCommand("mceApplyTextcolor",format,value))},getColors$1=function(colors,hasCustom){return colors.concat(map$2(colorCache.state(),(function(color){return{type:choiceItem,text:color,value:color}})).concat(getAdditionalColors(hasCustom)))},getFetch$1=function(colors,hasCustom){return function(callback){callback(getColors$1(colors,hasCustom))}},setIconColor=function(splitButtonApi,name,newColor){var id="forecolor"===name?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color";splitButtonApi.setIconFill(id,newColor)},registerTextColorButton=function(editor,name,format,tooltip,lastColor){editor.ui.registry.addSplitButton(name,{tooltip:tooltip,presets:"color",icon:"forecolor"===name?"text-color":"highlight-bg-color",select:function(value){return function(editor,format){var color;return editor.dom.getParents(editor.selection.getStart(),(function(elm){var value;(value=elm.style["forecolor"===format?"color":"background-color"])&&(color=color||value)})),Optional.from(color)}(editor,format).bind((function(currentRgb){return fromString(currentRgb).map((function(rgba){var currentHex=fromRgba(rgba).value;return contains$1(value.toLowerCase(),currentHex)}))})).getOr(!1)},columns:getColorCols$1(editor),fetch:getFetch$1(getColors$2(editor),hasCustomColors$1(editor)),onAction:function(_splitButtonApi){applyColor(editor,format,lastColor.get(),noop)},onItemAction:function(_splitButtonApi,value){applyColor(editor,format,value,(function(newColor){lastColor.set(newColor),function(editor,data){editor.fire("TextColorChange",data)}(editor,{name:name,color:newColor})}))},onSetup:function(splitButtonApi){setIconColor(splitButtonApi,name,lastColor.get());var handler=function(e){e.name===name&&setIconColor(splitButtonApi,e.name,e.color)};return editor.on("TextColorChange",handler),function(){editor.off("TextColorChange",handler)}}})},registerTextColorMenuItem=function(editor,name,format,text){editor.ui.registry.addNestedMenuItem(name,{text:text,icon:"forecolor"===name?"text-color":"highlight-bg-color",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"colorswatch",onAction:function(data){applyColor(editor,format,data.value,noop)}}]}})},colorPickerDialog=function(editor){return function(callback,value){var isValid=!1,initialData={colorpicker:value};editor.windowManager.open({title:"Color Picker",size:"normal",body:{type:"panel",items:[{type:"colorpicker",name:"colorpicker",label:"Color"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:initialData,onAction:function(_api,details){"hex-valid"===details.name&&(isValid=details.value)},onSubmit:function(api){var hex=api.getData().colorpicker;isValid?(callback(Optional.from(hex)),api.close()):editor.windowManager.alert(editor.translate(["Invalid hex color code: {0}",hex]))},onClose:noop,onCancel:function(){callback(Optional.none())}})}},createPartialChoiceMenu=function(value,items,onItemValueHandler,columns,presets,itemResponse,select,providersBackstage){var hasIcons=menuHasIcons(items),alloyItems=createChoiceItems(items,onItemValueHandler,columns,"color"!==presets?"normal":"color",itemResponse,select,providersBackstage);return createPartialMenuWithAlloyItems(value,hasIcons,alloyItems,columns,presets)},createChoiceItems=function(items,onItemValueHandler,columns,itemPresets,itemResponse,select,providersBackstage){return cat(map$2(items,(function(item){return"choiceitem"===item.type?(spec=item,asRaw("choicemenuitem",choiceMenuItemSchema,spec)).fold(handleError,(function(d){return Optional.some(function(spec,useText,presets,onItemValueHandler,isSelected,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var structure=renderItemStructure({presets:presets,textContent:useText?spec.text:Optional.none(),htmlContent:Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:useText?spec.shortcut:Optional.none(),checkMark:useText?Optional.some(renderCheckmark(providersBackstage.icons)):Optional.none(),caret:Optional.none(),value:spec.value},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},onAction:function(_api){return onItemValueHandler(spec.value)},onSetup:function(api){return api.setActive(isSelected),noop},triggersSubmenu:!1,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:"tox-collection__item--enabled",toggleOnExecute:!1,selected:spec.active}})}(d,1===columns,itemPresets,onItemValueHandler,select(item.value),itemResponse,providersBackstage,menuHasIcons(items)))})):Optional.none();var spec})))},deriveMenuMovement=function(columns,presets){var menuMarkers=markers(presets);return 1===columns?{mode:"menu",moveOnTab:!0}:"auto"===columns?{mode:"grid",selector:"."+menuMarkers.item,initSize:{numColumns:1,numRows:1}}:{mode:"matrix",rowSelector:"."+("color"===presets?"tox-swatches__row":"tox-collection__group")}},getColorItems=function(spec,backstage){var useCustomColors=spec.initData.allowCustomColors&&backstage.colorinput.hasCustomColors();return spec.initData.colors.fold((function(){return getColors$1(backstage.colorinput.getColors(),useCustomColors)}),(function(colors){return colors.concat(getAdditionalColors(useCustomColors))}))},cellOverEvent=generate$6("cell-over"),cellExecuteEvent=generate$6("cell-execute"),makeCell=function(row,col,labelId){var _a,emitExecute=function(c){return emitWith(c,cellExecuteEvent,{row:row,col:col})},onClick=function(c,se){se.stop(),emitExecute(c)};return build$1({dom:{tag:"div",attributes:(_a={role:"button"},_a["aria-labelledby"]=labelId,_a)},behaviours:derive$1([config("insert-table-picker-cell",[run$1(mouseover(),Focusing.focus),run$1(execute$5(),emitExecute),run$1(click(),onClick),run$1(tap(),onClick)]),Toggling.config({toggleClass:"tox-insert-table-picker__selected",toggleOnExecute:!1}),Focusing.config({onFocus:function(c){return emitWith(c,cellOverEvent,{row:row,col:col})}})])})},makeComponents=function(cells){return bind$3(cells,(function(cellRow){return map$2(cellRow,premade)}))},makeLabelText=function(row,col){return text(col+"x"+row)},fancyMenuItems={inserttable:function(spec){var sizeLabelId=generate$6("size-label"),cells=function(labelId,numRows,numCols){for(var cells=[],i=0;i<numRows;i++){for(var row=[],j=0;j<numCols;j++)row.push(makeCell(i,j,labelId));cells.push(row)}return cells}(sizeLabelId,10,10),emptyLabelText=makeLabelText(0,0),memLabel=record({dom:{tag:"span",classes:["tox-insert-table-picker__label"],attributes:{id:sizeLabelId}},components:[emptyLabelText],behaviours:derive$1([Replacing.config({})])});return{type:"widget",data:{value:generate$6("widget-id")},dom:{tag:"div",classes:["tox-fancymenuitem"]},autofocus:!0,components:[parts$f.widget({dom:{tag:"div",classes:["tox-insert-table-picker"]},components:makeComponents(cells).concat(memLabel.asSpec()),behaviours:derive$1([config("insert-table-picker",[runOnAttached((function(c){Replacing.set(memLabel.get(c),[emptyLabelText])})),runWithTarget(cellOverEvent,(function(c,t,e){var _a=e.event,row=_a.row,col=_a.col;!function(cells,selectedRow,selectedColumn,numRows,numColumns){for(var i=0;i<numRows;i++)for(var j=0;j<numColumns;j++)Toggling.set(cells[i][j],i<=selectedRow&&j<=selectedColumn)}(cells,row,col,10,10),Replacing.set(memLabel.get(c),[makeLabelText(row+1,col+1)])})),runWithTarget(cellExecuteEvent,(function(c,_,e){var _a=e.event,row=_a.row,col=_a.col;spec.onAction({numRows:row+1,numColumns:col+1}),emit(c,sandboxClose())}))]),Keying.config({initSize:{numRows:10,numColumns:10},mode:"flatgrid",selector:'[role="button"]'})])})]}},colorswatch:function(spec,backstage){var items=getColorItems(spec,backstage),columns=backstage.colorinput.getColorCols(),menuSpec=createPartialChoiceMenu(generate$6("menu-value"),items,(function(value){spec.onAction({value:value})}),columns,"color",ItemResponse$1.CLOSE_ON_EXECUTE,never,backstage.shared.providers),widgetSpec=__assign(__assign({},menuSpec),{markers:markers("color"),movement:deriveMenuMovement(columns,"color")});return{type:"widget",data:{value:generate$6("widget-id")},dom:{tag:"div",classes:["tox-fancymenuitem"]},autofocus:!0,components:[parts$f.widget(Menu.sketch(widgetSpec))]}}},autocomplete=function(spec,matchText,useText,presets,onItemValueHandler,itemResponse,sharedBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var structure=renderItemStructure({presets:presets,textContent:Optional.none(),htmlContent:useText?spec.text.map((function(text){return replaceText(text,matchText)})):Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:Optional.none(),checkMark:Optional.none(),caret:Optional.none(),value:spec.value},sharedBackstage.providers,renderIcons,spec.icon);return renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:constant$1({}),onAction:function(_api){return onItemValueHandler(spec.value,spec.meta)},onSetup:constant$1(noop),triggersSubmenu:!1,itemBehaviours:tooltipBehaviour(spec.meta,sharedBackstage)},structure,itemResponse,sharedBackstage.providers)},separator$3=function(spec){var innerHtml=spec.text.fold((function(){return{}}),(function(text){return{innerHtml:text}}));return{type:"separator",dom:__assign({tag:"div",classes:["tox-collection__item","tox-collection__group-heading"]},innerHtml),components:[]}},normal=function(spec,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var structure=renderItemStructure({presets:"normal",iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.none(),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},disabled:spec.disabled,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:[]},structure,itemResponse,providersBackstage)},nested=function(spec,itemResponse,providersBackstage,renderIcons,downwardsCaret){void 0===renderIcons&&(renderIcons=!0),void 0===downwardsCaret&&(downwardsCaret=!1);var icons,caret=downwardsCaret?(icons=providersBackstage.icons,renderIcon$1("chevron-down",icons,["tox-collection__item-caret"])):function(icons){return renderIcon$1("chevron-right",icons,["tox-collection__item-caret"])}(providersBackstage.icons),structure=renderItemStructure({presets:"normal",iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.some(caret),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},disabled:spec.disabled,onAction:noop,onSetup:spec.onSetup,triggersSubmenu:!0,itemBehaviours:[]},structure,itemResponse,providersBackstage)},toggle$1=function(spec,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var structure=renderItemStructure({iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,checkMark:Optional.some(renderCheckmark(providersBackstage.icons)),caret:Optional.none(),shortcutContent:spec.shortcut,presets:"normal",meta:spec.meta},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:"tox-collection__item--enabled",toggleOnExecute:!1,selected:spec.active}})},fancy=function(spec,backstage){return get$e(fancyMenuItems,spec.fancytype).map((function(render){return render(spec,backstage)}))},card=function(spec,itemResponse,sharedBackstage,extras){var structure={dom:renderItemDomStructure(spec.label),optComponents:[Optional.some({dom:{tag:"div",classes:["tox-collection__item-container","tox-collection__item-container--row"]},components:render$2(spec.items,extras)})]};return renderCommonItem({data:buildData(__assign({text:Optional.none()},spec)),disabled:spec.disabled,getApi:function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){Disabling.set(component,state),each$1(descendants(component.element,"*"),(function(elm){component.getSystem().getByDom(elm).each((function(comp){comp.hasConfigured(Disabling)&&Disabling.set(comp,state)}))}))}}},onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:Optional.from(extras.itemBehaviours).getOr([])},structure,itemResponse,sharedBackstage.providers)};!function(FocusMode){FocusMode[FocusMode.ContentFocus=0]="ContentFocus",FocusMode[FocusMode.UiFocus=1]="UiFocus"}(FocusMode||(FocusMode={}));var createMenuItemFromBridge=function(item,itemResponse,backstage,menuHasIcons,isHorizontalMenu){var spec,providersBackstage=backstage.shared.providers,parseForHorizontalMenu=function(menuitem){return isHorizontalMenu?__assign(__assign({},menuitem),{shortcut:Optional.none(),icon:menuitem.text.isSome()?Optional.none():menuitem.icon}):menuitem};switch(item.type){case"menuitem":return(spec=item,asRaw("menuitem",menuItemSchema,spec)).fold(handleError,(function(d){return Optional.some(normal(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons))}));case"nestedmenuitem":return function(spec){return asRaw("nestedmenuitem",nestedMenuItemSchema,spec)}(item).fold(handleError,(function(d){return Optional.some(nested(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons,isHorizontalMenu))}));case"togglemenuitem":return function(spec){return asRaw("togglemenuitem",toggleMenuItemSchema,spec)}(item).fold(handleError,(function(d){return Optional.some(toggle$1(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons))}));case"separator":return function(spec){return asRaw("separatormenuitem",separatorMenuItemSchema,spec)}(item).fold(handleError,(function(d){return Optional.some(separator$3(d))}));case"fancymenuitem":return function(spec){return asRaw("fancymenuitem",fancyMenuItemSchema,spec)}(item).fold(handleError,(function(d){return fancy(parseForHorizontalMenu(d),backstage)}));default:return console.error("Unknown item in general menu",item),Optional.none()}},createAutocompleteItems=function(items,matchText,onItemValueHandler,columns,itemResponse,sharedBackstage,highlightOn){var renderText=1===columns,renderIcons=!renderText||menuHasIcons(items);return cat(map$2(items,(function(item){switch(item.type){case"separator":return(spec=item,asRaw("Autocompleter.Separator",separatorMenuItemSchema,spec)).fold(handleError,(function(d){return Optional.some(separator$3(d))}));case"cardmenuitem":return function(spec){return asRaw("cardmenuitem",cardMenuItemSchema,spec)}(item).fold(handleError,(function(d){return Optional.some(card(__assign(__assign({},d),{onAction:function(api){d.onAction(api),onItemValueHandler(d.value,d.meta)}}),itemResponse,sharedBackstage,{itemBehaviours:tooltipBehaviour(d.meta,sharedBackstage),cardText:{matchText:matchText,highlightOn:highlightOn}}))}));case"autocompleteitem":default:return function(spec){return asRaw("Autocompleter.Item",autocompleterItemSchema,spec)}(item).fold(handleError,(function(d){return Optional.some(autocomplete(d,matchText,renderText,"normal",onItemValueHandler,itemResponse,sharedBackstage,renderIcons))}))}var spec})))},createPartialMenu=function(value,items,itemResponse,backstage,isHorizontalMenu){var hasIcons=menuHasIcons(items),alloyItems=cat(map$2(items,(function(item){var createItem=function(i){return createMenuItemFromBridge(i,itemResponse,backstage,function(i){return isHorizontalMenu?!has$2(i,"text"):hasIcons}(i),isHorizontalMenu)};return"nestedmenuitem"===item.type&&item.getSubmenuItems().length<=0?createItem(__assign(__assign({},item),{disabled:!0})):createItem(item)})));return(isHorizontalMenu?createHorizontalPartialMenuWithAlloyItems:createPartialMenuWithAlloyItems)(value,hasIcons,alloyItems,1,"normal")},createTieredDataFrom=function(partialMenu){return tieredMenu.singleData(partialMenu.value,partialMenu)},Autocompleter_register=function(editor,sharedBackstage){var activeAutocompleter=value$1(),processingAction=Cell(!1),autocompleter=build$1(InlineView.sketch({dom:{tag:"div",classes:["tox-autocompleter"]},components:[],fireDismissalEventInstead:{},inlineBehaviours:derive$1([config("dismissAutocompleter",[run$1(dismissRequested(),(function(){return cancelIfNecessary()}))])]),lazySink:sharedBackstage.getSink})),isActive=function(){return activeAutocompleter.get().isSome()},hideIfNecessary=function(){isActive()&&InlineView.hide(autocompleter)},cancelIfNecessary=function(){if(isActive()){var lastElement=activeAutocompleter.get().map((function(ac){return ac.element}));detect(lastElement.getOr(SugarElement.fromDom(editor.selection.getNode()))).each(unwrap),hideIfNecessary(),activeAutocompleter.clear(),processingAction.set(!1)}},getAutocompleters=cached((function(){return register$b(editor)})),display=function(ac,context,lookupData,items){ac.matchLength=context.text.length;var columns=findMap(lookupData,(function(ld){return Optional.from(ld.columns)})).getOr(1);InlineView.showAt(autocompleter,Menu.sketch(function(partialMenu,columns,focusMode,presets){var focusManager=focusMode===FocusMode.ContentFocus?highlights():dom$2(),movement=deriveMenuMovement(columns,presets),menuMarkers=markers(presets);return{dom:partialMenu.dom,components:partialMenu.components,items:partialMenu.items,value:partialMenu.value,markers:{selectedItem:menuMarkers.selectedItem,item:menuMarkers.item},movement:movement,fakeFocus:focusMode===FocusMode.ContentFocus,focusManager:focusManager,menuBehaviours:SimpleBehaviours_unnamedEvents("auto"!==columns?[]:[runOnAttached((function(comp,_se){detectSize(comp,4,menuMarkers.item).each((function(_a){var numColumns=_a.numColumns,numRows=_a.numRows;Keying.setGridSize(comp,numRows,numColumns)}))}))])}}(createPartialMenuWithAlloyItems("autocompleter-value",!0,items,columns,"normal"),columns,FocusMode.ContentFocus,"normal")),{anchor:{type:"node",root:SugarElement.fromDom(editor.getBody()),node:Optional.from(ac.element)}}),InlineView.getContent(autocompleter).each(Highlighting.highlightFirst)},load=function(fetchOptions){(function(fetchOptions){return activeAutocompleter.get().map((function(ac){return getContext(editor.dom,editor.selection.getRng(),ac.triggerChar).bind((function(newContext){return lookupWithContext(editor,getAutocompleters,newContext,fetchOptions)}))})).getOrThunk((function(){return lookup$2(editor,getAutocompleters)}))})(fetchOptions).fold(cancelIfNecessary,(function(lookupInfo){!function(context){if(!isActive()){var wrapper=create$4(editor,context.range);activeAutocompleter.set({triggerChar:context.triggerChar,element:wrapper,matchLength:context.text.length}),processingAction.set(!1)}}(lookupInfo.context),lookupInfo.lookupData.then((function(lookupData){activeAutocompleter.get().map((function(ac){var triggerChar,matches,columns,context=lookupInfo.context;if(ac.triggerChar===context.triggerChar){var combinedItems=(triggerChar=context.triggerChar,columns=findMap(matches=lookupData,(function(m){return Optional.from(m.columns)})).getOr(1),bind$3(matches,(function(match){var choices=match.items;return createAutocompleteItems(choices,match.matchText,(function(itemValue,itemMeta){var nr=editor.selection.getRng();getContext(editor.dom,nr,triggerChar).fold((function(){return console.error("Lost context. Cursor probably moved")}),(function(_a){var range=_a.range,autocompleterApi={hide:function(){cancelIfNecessary()},reload:function(fetchOptions){hideIfNecessary(),load(fetchOptions)}};processingAction.set(!0),match.onAction(autocompleterApi,range,itemValue,itemMeta),processingAction.set(!1)}))}),columns,ItemResponse$1.BUBBLE_TO_SANDBOX,sharedBackstage,match.highlightOn)})));combinedItems.length>0?display(ac,context,lookupData,combinedItems):context.text.length-ac.matchLength>=10?cancelIfNecessary():hideIfNecessary()}}))}))}))},autocompleterUiApi={onKeypress:last((function(e){27!==e.which&&load()}),50),cancelIfNecessary:cancelIfNecessary,isMenuOpen:function(){return InlineView.isOpen(autocompleter)},isActive:isActive,isProcessingAction:processingAction.get,getView:function(){return InlineView.getContent(autocompleter)}};!1===editor.hasPlugin("rtc")&&AutocompleterEditorEvents_setup(autocompleterUiApi,editor)},closest=function(scope,selector,isRoot){return closest$1(scope,selector,isRoot).isSome()},DelayedFunction=function(fun,delay){var ref=null;return{cancel:function(){null!==ref&&(clearTimeout(ref),ref=null)},schedule:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];ref=setTimeout((function(){fun.apply(null,args),ref=null}),delay)}}},getTouch=function(event){var raw=event.raw;return void 0===raw.touches||1!==raw.touches.length?Optional.none():Optional.some(raw.touches[0])},monitor=function(settings){var startData=value$1(),longpressFired=Cell(!1),longpress$1=DelayedFunction((function(event){settings.triggerEvent(longpress(),event),longpressFired.set(!0)}),400),handlers=wrapAll([{key:touchstart(),value:function(event){return getTouch(event).each((function(touch){longpress$1.cancel();var data={x:touch.clientX,y:touch.clientY,target:event.target};longpress$1.schedule(event),longpressFired.set(!1),startData.set(data)})),Optional.none()}},{key:touchmove(),value:function(event){return longpress$1.cancel(),getTouch(event).each((function(touch){startData.on((function(data){(function(touch,data){var distX=Math.abs(touch.clientX-data.x),distY=Math.abs(touch.clientY-data.y);return distX>5||distY>5})(touch,data)&&startData.clear()}))})),Optional.none()}},{key:touchend(),value:function(event){longpress$1.cancel();return startData.get().filter((function(data){return eq(data.target,event.target)})).map((function(_data){return longpressFired.get()?(event.prevent(),!1):settings.triggerEvent(tap(),event)}))}}]);return{fireIfReady:function(event,type){return get$e(handlers,type).bind((function(handler){return handler(event)}))}}},isFirefox=function(){return detect$1().browser.isFirefox()},setup$d=function(container,rawSettings){var settings=__assign({stopBackspace:!0},rawSettings),tapEvent=monitor(settings),simpleEvents=map$2(["touchstart","touchmove","touchend","touchcancel","gesturestart","mousedown","mouseup","mouseover","mousemove","mouseout","click"].concat(["selectstart","input","contextmenu","change","transitionend","transitioncancel","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),(function(type){return bind(container,type,(function(event){tapEvent.fireIfReady(event,type).each((function(tapStopped){tapStopped&&event.kill()})),settings.triggerEvent(type,event)&&event.kill()}))})),pasteTimeout=value$1(),onPaste=bind(container,"paste",(function(event){tapEvent.fireIfReady(event,"paste").each((function(tapStopped){tapStopped&&event.kill()})),settings.triggerEvent("paste",event)&&event.kill(),pasteTimeout.set(setTimeout((function(){settings.triggerEvent(postPaste(),event)}),0))})),onKeydown=bind(container,"keydown",(function(event){settings.triggerEvent("keydown",event)?event.kill():settings.stopBackspace&&function(event){return event.raw.which===BACKSPACE[0]&&!contains$2(["input","textarea"],name$2(event.target))&&!closest(event.target,'[contenteditable="true"]')}(event)&&event.prevent()})),onFocusIn=function(container,handler){return isFirefox()?capture(container,"focus",handler):bind(container,"focusin",handler)}(container,(function(event){settings.triggerEvent("focusin",event)&&event.kill()})),focusoutTimeout=value$1(),onFocusOut=function(container,handler){return isFirefox()?capture(container,"blur",handler):bind(container,"focusout",handler)}(container,(function(event){settings.triggerEvent("focusout",event)&&event.kill(),focusoutTimeout.set(setTimeout((function(){settings.triggerEvent(postBlur(),event)}),0))}));return{unbind:function(){each$1(simpleEvents,(function(e){e.unbind()})),onKeydown.unbind(),onFocusIn.unbind(),onFocusOut.unbind(),onPaste.unbind(),pasteTimeout.on(clearTimeout),focusoutTimeout.on(clearTimeout)}}},derive=function(rawEvent,rawTarget){var source=get$e(rawEvent,"target").getOr(rawTarget);return Cell(source)},adt$1=Adt_generate([{stopped:[]},{resume:["element"]},{complete:[]}]),doTriggerHandler=function(lookup,eventType,rawEvent,target,source,logger){var handler=lookup(eventType,target),simulatedEvent=function(event,source){var stopper=Cell(!1),cutter=Cell(!1);return{stop:function(){stopper.set(!0)},cut:function(){cutter.set(!0)},isStopped:stopper.get,isCut:cutter.get,event:event,setSource:source.set,getSource:source.get}}(rawEvent,source);return handler.fold((function(){return logger.logEventNoHandlers(eventType,target),adt$1.complete()}),(function(handlerInfo){var descHandler=handlerInfo.descHandler;return getCurried(descHandler)(simulatedEvent),simulatedEvent.isStopped()?(logger.logEventStopped(eventType,handlerInfo.element,descHandler.purpose),adt$1.stopped()):simulatedEvent.isCut()?(logger.logEventCut(eventType,handlerInfo.element,descHandler.purpose),adt$1.complete()):parent(handlerInfo.element).fold((function(){return logger.logNoParent(eventType,handlerInfo.element,descHandler.purpose),adt$1.complete()}),(function(parent){return logger.logEventResponse(eventType,handlerInfo.element,descHandler.purpose),adt$1.resume(parent)}))}))},doTriggerOnUntilStopped=function(lookup,eventType,rawEvent,rawTarget,source,logger){return doTriggerHandler(lookup,eventType,rawEvent,rawTarget,source,logger).fold(always,(function(parent){return doTriggerOnUntilStopped(lookup,eventType,rawEvent,parent,source,logger)}),never)},broadcast=function(listeners,rawEvent,_logger){var simulatedEvent=function(event){var stopper=Cell(!1);return{stop:function(){stopper.set(!0)},cut:noop,isStopped:stopper.get,isCut:never,event:event,setSource:die("Cannot set source of a broadcasted event"),getSource:die("Cannot get source of a broadcasted event")}}(rawEvent);return each$1(listeners,(function(listener){var descHandler=listener.descHandler;getCurried(descHandler)(simulatedEvent)})),simulatedEvent.isStopped()},triggerOnUntilStopped=function(lookup,eventType,rawEvent,rawTarget,logger){var source=derive(rawEvent,rawTarget);return doTriggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,source,logger)},EventRegistry=function(){var registry={};return{registerId:function(extraArgs,id,events){each(events,(function(v,k){var handlers=void 0!==registry[k]?registry[k]:{};handlers[id]=function(descHandler,extraArgs){return handler=curry.apply(void 0,[descHandler.handler].concat(extraArgs)),purpose=descHandler.purpose,{cHandler:handler,purpose:purpose};var handler,purpose}(v,extraArgs),registry[k]=handlers}))},unregisterId:function(id){each(registry,(function(handlersById,_eventName){has$2(handlersById,id)&&delete handlersById[id]}))},filterByType:function(type){return get$e(registry,type).map((function(handlers){return mapToArray(handlers,(function(f,id){return function(id,handler){return{id:id,descHandler:handler}}(id,f)}))})).getOr([])},find:function(isAboveRoot,type,target){return get$e(registry,type).bind((function(handlers){return closest$4(target,(function(elem){return function(handlers,elem){return read$1(elem).bind((function(id){return get$e(handlers,id)})).map((function(descHandler){return function(element,descHandler){return{element:element,descHandler:descHandler}}(elem,descHandler)}))}(handlers,elem)}),isAboveRoot)}))}}},Registry=function(){var events=EventRegistry(),components={},readOrTag=function(component){var elem=component.element;return read$1(elem).getOrThunk((function(){return function(label,elem){var id=generate$6(prefix+label);return writeOnly(elem,id),id}("uid-",component.element)}))},unregister=function(component){read$1(component.element).each((function(tagId){delete components[tagId],events.unregisterId(tagId)}))};return{find:function(isAboveRoot,type,target){return events.find(isAboveRoot,type,target)},filter:function(type){return events.filterByType(type)},register:function(component){var tagId=readOrTag(component);hasNonNullableKey(components,tagId)&&function(component,tagId){var conflict=components[tagId];if(conflict!==component)throw new Error('The tagId "'+tagId+'" is already used by: '+element(conflict.element)+"\nCannot use it for: "+element(component.element)+"\nThe conflicting element is"+(inBody(conflict.element)?" ":" not ")+"already in the DOM");unregister(component)}(component,tagId);var extraArgs=[component];events.registerId(extraArgs,tagId,component.events),components[tagId]=component},unregister:unregister,getById:function(id){return get$e(components,id)}}},Container=single({name:"Container",factory:function(detail){var _a=detail.dom,attributes=_a.attributes,domWithoutAttributes=__rest(_a,["attributes"]);return{uid:detail.uid,dom:__assign({tag:"div",attributes:__assign({role:"presentation"},attributes)},domWithoutAttributes),components:detail.components,behaviours:get$2(detail.containerBehaviours),events:detail.events,domModification:detail.domModification,eventOrder:detail.eventOrder}},configFields:[defaulted("components",[]),field("containerBehaviours",[]),defaulted("events",{}),defaulted("domModification",{}),defaulted("eventOrder",{})]}),takeover=function(root){var isAboveRoot=function(el){return parent(root.element).fold(always,(function(parent){return eq(el,parent)}))},registry=Registry(),lookup=function(eventName,target){return registry.find(isAboveRoot,eventName,target)},domEvents=setup$d(root.element,{triggerEvent:function(eventName,event){return monitorEvent(eventName,event.target,(function(logger){return function(lookup,eventType,rawEvent,logger){return triggerOnUntilStopped(lookup,eventType,rawEvent,rawEvent.target,logger)}(lookup,eventName,event,logger)}))}}),systemApi={debugInfo:constant$1("real"),triggerEvent:function(eventName,target,data){monitorEvent(eventName,target,(function(logger){return triggerOnUntilStopped(lookup,eventName,data,target,logger)}))},triggerFocus:function(target,originator){read$1(target).fold((function(){focus$3(target)}),(function(_alloyId){monitorEvent(focus$4(),target,(function(logger){return function(lookup,eventType,rawEvent,target,logger){var source=derive(rawEvent,target);doTriggerHandler(lookup,eventType,rawEvent,target,source,logger)}(lookup,focus$4(),{originator:originator,kill:noop,prevent:noop,target:target},target,logger),!1}))}))},triggerEscape:function(comp,simulatedEvent){systemApi.triggerEvent("keydown",comp.element,simulatedEvent.event)},getByUid:function(uid){return getByUid(uid)},getByDom:function(elem){return getByDom(elem)},build:build$1,addToGui:function(c){add(c)},removeFromGui:function(c){remove(c)},addToWorld:function(c){addToWorld(c)},removeFromWorld:function(c){removeFromWorld(c)},broadcast:function(message){broadcast$1(message)},broadcastOn:function(channels,message){broadcastOn(channels,message)},broadcastEvent:function(eventName,event){broadcastEvent(eventName,event)},isConnected:always},addToWorld=function(component){component.connect(systemApi),isText$1(component.element)||(registry.register(component),each$1(component.components(),addToWorld),systemApi.triggerEvent(systemInit(),component.element,{target:component.element}))},removeFromWorld=function(component){isText$1(component.element)||(each$1(component.components(),removeFromWorld),registry.unregister(component)),component.disconnect()},add=function(component){attach(root,component)},remove=function(component){detach(component)},broadcastData=function(data){var receivers=registry.filter(receive());each$1(receivers,(function(receiver){var descHandler=receiver.descHandler;getCurried(descHandler)(data)}))},broadcast$1=function(message){broadcastData({universal:!0,data:message})},broadcastOn=function(channels,message){broadcastData({universal:!1,channels:channels,data:message})},broadcastEvent=function(eventName,event){var listeners=registry.filter(eventName);return broadcast(listeners,event)},getByUid=function(uid){return registry.getById(uid).fold((function(){return Result.error(new Error('Could not find component with uid: "'+uid+'" in system.'))}),Result.value)},getByDom=function(elem){var uid=read$1(elem).getOr("not found");return getByUid(uid)};return addToWorld(root),{root:root,element:root.element,destroy:function(){domEvents.unbind(),remove$5(root.element)},add:add,remove:remove,getByUid:getByUid,getByDom:getByDom,addToWorld:addToWorld,removeFromWorld:removeFromWorld,broadcast:broadcast$1,broadcastOn:broadcastOn,broadcastEvent:broadcastEvent}},schema$l=constant$1([defaulted("prefix","form-field"),field("fieldBehaviours",[Composing,Representing])]),parts$e=constant$1([optional({schema:[required$1("dom")],name:"label"}),optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:spec.text}}}},schema:[required$1("text")],name:"aria-descriptor"}),required({factory:{sketch:function(spec){var excludeFactory=exclude(spec,["factory"]);return spec.factory.sketch(excludeFactory)}},schema:[required$1("factory")],name:"field"})]),FormField=composite({name:"FormField",configFields:schema$l(),partFields:parts$e(),factory:function(detail,components,_spec,_externals){var behaviours=augment(detail.fieldBehaviours,[Composing.config({find:function(container){return getPart(container,detail,"field")}}),Representing.config({store:{mode:"manual",getValue:function(field){return Composing.getCurrent(field).bind(Representing.getValue)},setValue:function(field,value){Composing.getCurrent(field).each((function(current){Representing.setValue(current,value)}))}}})]),events=derive$2([runOnAttached((function(component,_simulatedEvent){var ps=getParts(component,detail,["label","field","aria-descriptor"]);ps.field().each((function(field){var id=generate$6(detail.prefix);ps.label().each((function(label){set$8(label.element,"for",id),set$8(field.element,"id",id)})),ps["aria-descriptor"]().each((function(descriptor){var descriptorId=generate$6(detail.prefix);set$8(descriptor.element,"id",descriptorId),set$8(field.element,"aria-describedby",descriptorId)}))}))}))]),apis={getField:function(container){return getPart(container,detail,"field")},getLabel:function(container){return getPart(container,detail,"label")}};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:behaviours,events:events,apis:apis}},apis:{getField:function(apis,comp){return apis.getField(comp)},getLabel:function(apis,comp){return apis.getLabel(comp)}}}),ActiveTabstopping=Object.freeze({__proto__:null,exhibit:function(base,tabConfig){return nu$7({attributes:wrapAll([{key:tabConfig.tabAttr,value:"true"}])})}}),TabstopSchema=[defaulted("tabAttr","data-alloy-tabstop")],Tabstopping=create$7({fields:TabstopSchema,name:"tabstopping",active:ActiveTabstopping}),global$7=tinymce.util.Tools.resolve("tinymce.html.Entities"),renderFormFieldWith=function(pLabel,pField,extraClasses,extraBehaviours){var spec=renderFormFieldSpecWith(pLabel,pField,extraClasses,extraBehaviours);return FormField.sketch(spec)},renderFormFieldSpecWith=function(pLabel,pField,extraClasses,extraBehaviours){return{dom:renderFormFieldDomWith(extraClasses),components:pLabel.toArray().concat([pField]),fieldBehaviours:derive$1(extraBehaviours)}},renderFormFieldDomWith=function(extraClasses){return{tag:"div",classes:["tox-form__group"].concat(extraClasses)}},renderLabel$2=function(label,providersBackstage){return FormField.parts.label({dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}})},formChangeEvent=generate$6("form-component-change"),formCloseEvent=generate$6("form-close"),formCancelEvent=generate$6("form-cancel"),formActionEvent=generate$6("form-action"),formSubmitEvent=generate$6("form-submit"),formBlockEvent=generate$6("form-block"),formUnblockEvent=generate$6("form-unblock"),formTabChangeEvent=generate$6("form-tabchange"),formResizeEvent=generate$6("form-resize"),renderCollection=function(spec,providersBackstage){var _a,columns,presets,pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),runOnItem=function(f){return function(comp,se){closest$1(se.event.target,"[data-collection-item-value]").each((function(target){f(comp,se,target,get$d(target,"data-collection-item-value"))}))}},onClick=runOnItem((function(comp,se,tgt,itemValue){se.stop(),providersBackstage.isDisabled()||emitWith(comp,formActionEvent,{name:spec.name,value:itemValue})})),collectionEvents=[run$1(mouseover(),runOnItem((function(comp,se,tgt){focus$3(tgt)}))),run$1(click(),onClick),run$1(tap(),onClick),run$1(focusin(),runOnItem((function(comp,se,tgt){descendant(comp.element,"."+activeClass).each((function(currentActive){remove$2(currentActive,activeClass)})),add$2(tgt,activeClass)}))),run$1(focusout(),runOnItem((function(comp){descendant(comp.element,"."+activeClass).each((function(currentActive){remove$2(currentActive,activeClass)}))}))),runOnExecute$1(runOnItem((function(comp,se,tgt,itemValue){emitWith(comp,formActionEvent,{name:spec.name,value:itemValue})})))],iterCollectionItems=function(comp,applyAttributes){return map$2(descendants(comp.element,".tox-collection__item"),applyAttributes)},pField=FormField.parts.field({dom:{tag:"div",classes:["tox-collection"].concat(1!==spec.columns?["tox-collection--grid"]:["tox-collection--list"])},components:[],factory:{sketch:identity$1},behaviours:derive$1([Disabling.config({disabled:providersBackstage.isDisabled,onDisabled:function(comp){iterCollectionItems(comp,(function(childElm){add$2(childElm,"tox-collection__item--state-disabled"),set$8(childElm,"aria-disabled",!0)}))},onEnabled:function(comp){iterCollectionItems(comp,(function(childElm){remove$2(childElm,"tox-collection__item--state-disabled"),remove$7(childElm,"aria-disabled")}))}}),receivingConfig(),Replacing.config({}),Representing.config({store:{mode:"memory",initialValue:[]},onSetValue:function(comp,items){!function(comp,items){var htmlLines=map$2(items,(function(item){var itemText=global$e.translate(item.text),textContent=1===spec.columns?'<div class="tox-collection__item-label">'+itemText+"</div>":"",iconContent='<div class="tox-collection__item-icon">'+item.icon+"</div>",mapItemName={_:" "," - ":" ","-":" "},ariaLabel=itemText.replace(/\_| \- |\-/g,(function(match){return mapItemName[match]}));return'<div class="tox-collection__item'+(providersBackstage.isDisabled()?" tox-collection__item--state-disabled":"")+'" tabindex="-1" data-collection-item-value="'+global$7.encodeAllRaw(item.value)+'" title="'+ariaLabel+'" aria-label="'+ariaLabel+'">'+iconContent+textContent+"</div>"})),chunks="auto"!==spec.columns&&spec.columns>1?chunk$1(htmlLines,spec.columns):[htmlLines],html=map$2(chunks,(function(ch){return'<div class="tox-collection__group">'+ch.join("")+"</div>"}));set$5(comp.element,html.join(""))}(comp,items),"auto"===spec.columns&&detectSize(comp,5,"tox-collection__item").each((function(_a){var numRows=_a.numRows,numColumns=_a.numColumns;Keying.setGridSize(comp,numRows,numColumns)})),emit(comp,formResizeEvent)}}),Tabstopping.config({}),Keying.config((columns=spec.columns,presets="normal",1===columns?{mode:"menu",moveOnTab:!1,selector:".tox-collection__item"}:"auto"===columns?{mode:"flatgrid",selector:".tox-collection__item",initSize:{numColumns:1,numRows:1}}:{mode:"matrix",selectors:{row:"color"===presets?".tox-swatches__row":".tox-collection__group",cell:"color"===presets?".tox-swatch":".tox-collection__item"}})),config("collection-events",collectionEvents)]),eventOrder:(_a={},_a[execute$5()]=["disabling","alloy.base.behaviour","collection-events"],_a)});return renderFormFieldWith(pLabel,pField,["tox-form__group--collection"],[])},schema$k=constant$1([option("data"),defaulted("inputAttributes",{}),defaulted("inputStyles",{}),defaulted("tag","input"),defaulted("inputClasses",[]),onHandler("onSetValue"),defaulted("styles",{}),defaulted("eventOrder",{}),field("inputBehaviours",[Representing,Focusing]),defaulted("selectOnFocus",!0)]),focusBehaviours=function(detail){return derive$1([Focusing.config({onFocus:detail.selectOnFocus?function(component){var input=component.element,value=get$5(input);input.dom.setSelectionRange(0,value.length)}:noop})])},behaviours=function(detail){return __assign(__assign({},focusBehaviours(detail)),augment(detail.inputBehaviours,[Representing.config({store:__assign(__assign({mode:"manual"},detail.data.map((function(data){return{initialValue:data}})).getOr({})),{getValue:function(input){return get$5(input.element)},setValue:function(input,data){get$5(input.element)!==data&&set$4(input.element,data)}}),onSetValue:detail.onSetValue})]))},dom=function(detail){return{tag:detail.tag,attributes:__assign({type:"text"},detail.inputAttributes),styles:detail.inputStyles,classes:detail.inputClasses}},Input=single({name:"Input",configFields:schema$k(),factory:function(detail,_spec){return{uid:detail.uid,dom:dom(detail),components:[],behaviours:behaviours(detail),eventOrder:detail.eventOrder}}}),exports$1={},module={exports:exports$1};!function(define,exports,module,require){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).EphoxContactWrapper=factory()}(this,(function(){var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},promise={exports:{}};!function(module){!function(root){var setTimeoutFunc=setTimeout;function noop(){}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,Promise._immediateFn((function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)}))):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn((function(){self._handled||Promise._unhandledRejectionFn(self._value)}));for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn((function(value){done||(done=!0,resolve(self,value))}),(function(reason){done||(done=!0,reject(self,reason))}))}catch(ex){if(done)return;done=!0,reject(self,ex)}}Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise((function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])}))},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise((function(resolve){resolve(value)}))},Promise.reject=function(value){return new Promise((function(resolve,reject){reject(value)}))},Promise.race=function(values){return new Promise((function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)}))},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(commonjsGlobal)}(promise);var promisePolyfill=promise.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||promisePolyfill}}))}(void 0,exports$1,module);var HighlightOnOpen,Promise$1=module.exports.boltExport,nu$3=function(baseFn){var data=Optional.none(),callbacks=[],get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},isReady=function(){return data.isSome()},run=function(cbs){each$1(cbs,call)},call=function(cb){data.each((function(x){setTimeout((function(){cb(x)}),0)}))};return baseFn((function(x){isReady()||(data=Optional.some(x),run(callbacks),callbacks=[])})),{get:get,map:function(f){return nu$3((function(nCallback){get((function(data){nCallback(f(data))}))}))},isReady:isReady}},LazyValue={nu:nu$3,pure:function(a){return nu$3((function(callback){callback(a)}))}},errorReporter=function(err){setTimeout((function(){throw err}),0)},make$5=function(run){var get=function(callback){run().then(callback,errorReporter)};return{map:function(fab){return make$5((function(){return run().then(fab)}))},bind:function(aFutureB){return make$5((function(){return run().then((function(v){return aFutureB(v).toPromise()}))}))},anonBind:function(futureB){return make$5((function(){return run().then((function(){return futureB.toPromise()}))}))},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make$5((function(){return null===cache&&(cache=run()),cache}))},toPromise:run,get:get}},Future_nu=function(baseFn){return make$5((function(){return new Promise$1(baseFn)}))},Future_pure=function(a){return make$5((function(){return Promise$1.resolve(a)}))},ariaElements=["input","textarea"],isAriaElement=function(elem){var name=name$2(elem);return contains$2(ariaElements,name)},markValid=function(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);remove$2(elem,invalidConfig.invalidClass),invalidConfig.notify.each((function(notifyInfo){isAriaElement(component.element)&&set$8(component.element,"aria-invalid",!1),notifyInfo.getContainer(component).each((function(container){set$5(container,notifyInfo.validHtml)})),notifyInfo.onValid(component)}))},markInvalid=function(component,invalidConfig,invalidState,text){var elem=invalidConfig.getRoot(component).getOr(component.element);add$2(elem,invalidConfig.invalidClass),invalidConfig.notify.each((function(notifyInfo){isAriaElement(component.element)&&set$8(component.element,"aria-invalid",!0),notifyInfo.getContainer(component).each((function(container){set$5(container,text)})),notifyInfo.onInvalid(component,text)}))},query=function(component,invalidConfig,_invalidState){return invalidConfig.validator.fold((function(){return Future_pure(Result.value(!0))}),(function(validatorInfo){return validatorInfo.validate(component)}))},run=function(component,invalidConfig,invalidState){return invalidConfig.notify.each((function(notifyInfo){notifyInfo.onValidate(component)})),query(component,invalidConfig).map((function(valid){return component.getSystem().isConnected()?valid.fold((function(err){return markInvalid(component,invalidConfig,0,err),Result.error(err)}),(function(v){return markValid(component,invalidConfig),Result.value(v)})):Result.error("No longer in system")}))},InvalidateApis=Object.freeze({__proto__:null,markValid:markValid,markInvalid:markInvalid,query:query,run:run,isInvalid:function(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);return has(elem,invalidConfig.invalidClass)}}),ActiveInvalidate=Object.freeze({__proto__:null,events:function(invalidConfig,invalidState){return invalidConfig.validator.map((function(validatorInfo){return derive$2([run$1(validatorInfo.onEvent,(function(component){run(component,invalidConfig).get(identity$1)}))].concat(validatorInfo.validateOnLoad?[runOnAttached((function(component){run(component,invalidConfig).get(noop)}))]:[]))})).getOr({})}}),InvalidateSchema=[required$1("invalidClass"),defaulted("getRoot",Optional.none),optionObjOf("notify",[defaulted("aria","alert"),defaulted("getContainer",Optional.none),defaulted("validHtml",""),onHandler("onValid"),onHandler("onInvalid"),onHandler("onValidate")]),optionObjOf("validator",[required$1("validate"),defaulted("onEvent","input"),defaulted("validateOnLoad",!0)])],Invalidating=create$7({fields:InvalidateSchema,name:"invalidating",active:ActiveInvalidate,apis:InvalidateApis,extra:{validation:function(validator){return function(component){var v=Representing.getValue(component);return Future_pure(validator(v))}}}}),CouplingApis=Object.freeze({__proto__:null,getCoupled:function(component,coupleConfig,coupleState,name){return coupleState.getOrCreate(component,coupleConfig,name)}}),CouplingSchema=[requiredOf("others",setOf(Result.value,anyValue()))],Coupling=create$7({fields:CouplingSchema,name:"coupling",apis:CouplingApis,state:Object.freeze({__proto__:null,init:function(){var coupled={},readState=constant$1({});return nu$8({readState:readState,getOrCreate:function(component,coupleConfig,name){var available=keys(coupleConfig.others);if(available)return get$e(coupled,name).getOrThunk((function(){var spec=get$e(coupleConfig.others,name).getOrDie("No information found for coupled component: "+name)(component),built=component.getSystem().build(spec);return coupled[name]=built,built}));throw new Error("Cannot find coupled component: "+name+". Known coupled components: "+JSON.stringify(available,null,2))}})}})}),suffix=constant$1("sink"),partType$1=constant$1(optional({name:suffix(),overrides:constant$1({dom:{tag:"div"},behaviours:derive$1([Positioning.config({useFixed:always})]),events:derive$2([cutter(keydown()),cutter(mousedown()),cutter(click())])})}));!function(HighlightOnOpen){HighlightOnOpen[HighlightOnOpen.HighlightFirst=0]="HighlightFirst",HighlightOnOpen[HighlightOnOpen.HighlightNone=1]="HighlightNone"}(HighlightOnOpen||(HighlightOnOpen={}));var kernel,colorFn,_a,getAnchor=function(detail,component){var hotspot=detail.getHotspot(component).getOr(component),overrides=detail.getAnchorOverrides();return detail.layouts.fold((function(){return{type:"hotspot",hotspot:hotspot,overrides:overrides}}),(function(layouts){return{type:"hotspot",hotspot:hotspot,overrides:overrides,layouts:layouts}}))},open=function(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen){return function(detail,mapFetch,anchor,component,sandbox,externals,highlightOnOpen){var futureData=function(detail,mapFetch,component){return(0,detail.fetch)(component).map(mapFetch)}(detail,mapFetch,component),getLazySink=getSink(component,detail);return futureData.map((function(tdata){return tdata.bind((function(data){return Optional.from(tieredMenu.sketch(__assign(__assign({},externals.menu()),{uid:generate$5(""),data:data,highlightImmediately:highlightOnOpen===HighlightOnOpen.HighlightFirst,onOpenMenu:function(tmenu,menu){var sink=getLazySink().getOrDie();Positioning.position(sink,menu,{anchor:anchor}),Sandboxing.decloak(sandbox)},onOpenSubmenu:function(tmenu,item,submenu){var sink=getLazySink().getOrDie();Positioning.position(sink,submenu,{anchor:{type:"submenu",item:item}}),Sandboxing.decloak(sandbox)},onRepositionMenu:function(tmenu,primaryMenu,submenuTriggers){var sink=getLazySink().getOrDie();Positioning.position(sink,primaryMenu,{anchor:anchor}),each$1(submenuTriggers,(function(st){Positioning.position(sink,st.triggeredMenu,{anchor:{type:"submenu",item:st.triggeringItem}})}))},onEscape:function(){return Focusing.focus(component),Sandboxing.close(sandbox),Optional.some(!0)}})))}))}))}(detail,mapFetch,getAnchor(detail,hotspot),hotspot,sandbox,externals,highlightOnOpen).map((function(tdata){return tdata.fold((function(){Sandboxing.isOpen(sandbox)&&Sandboxing.close(sandbox)}),(function(data){Sandboxing.cloak(sandbox),Sandboxing.open(sandbox,data),onOpenSync(sandbox)})),sandbox}))},close=function(detail,mapFetch,component,sandbox,_externals,_onOpenSync,_highlightOnOpen){return Sandboxing.close(sandbox),Future_pure(sandbox)},togglePopup=function(detail,mapFetch,hotspot,externals,onOpenSync,highlightOnOpen){var sandbox=Coupling.getCoupled(hotspot,"sandbox");return(Sandboxing.isOpen(sandbox)?close:open)(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen)},matchWidth=function(hotspot,container,useMinWidth){var menu=Composing.getCurrent(container).getOr(container),buttonWidth=get$a(hotspot.element);useMinWidth?set$7(menu.element,"min-width",buttonWidth+"px"):function(element,h){api$2.set(element,h)}(menu.element,buttonWidth)},getSink=function(anyInSystem,sinkDetail){return anyInSystem.getSystem().getByUid(sinkDetail.uid+"-"+suffix()).map((function(internalSink){return function(){return Result.value(internalSink)}})).getOrThunk((function(){return sinkDetail.lazySink.fold((function(){return function(){return Result.error(new Error("No internal sink is specified, nor could an external sink be found"))}}),(function(lazySinkFn){return function(){return lazySinkFn(anyInSystem)}}))}))},doRepositionMenus=function(sandbox){Sandboxing.getState(sandbox).each((function(tmenu){tieredMenu.repositionMenus(tmenu)}))},makeSandbox$1=function(detail,hotspot,extras){var ariaOwner=manager(),lazySink=getSink(hotspot,detail);return{dom:{tag:"div",classes:detail.sandboxClasses,attributes:{id:ariaOwner.id,role:"listbox"}},behaviours:SketchBehaviours_augment(detail.sandboxBehaviours,[Representing.config({store:{mode:"memory",initialValue:hotspot}}),Sandboxing.config({onOpen:function(component,menu){var anchor=getAnchor(detail,hotspot);ariaOwner.link(hotspot.element),detail.matchWidth&&matchWidth(anchor.hotspot,menu,detail.useMinWidth),detail.onOpen(anchor,component,menu),void 0!==extras&&void 0!==extras.onOpen&&extras.onOpen(component,menu)},onClose:function(component,menu){ariaOwner.unlink(hotspot.element),void 0!==extras&&void 0!==extras.onClose&&extras.onClose(component,menu)},isPartOf:function(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(hotspot,queryElem)},getAttachPoint:function(){return lazySink().getOrDie()}}),Composing.config({find:function(sandbox){return Sandboxing.getState(sandbox).bind((function(menu){return Composing.getCurrent(menu)}))}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1({isExtraPart:never})),receivingChannel({doReposition:doRepositionMenus}))})])}},repositionMenus=function(comp){var sandbox=Coupling.getCoupled(comp,"sandbox");doRepositionMenus(sandbox)},sandboxFields=function(){return[defaulted("sandboxClasses",[]),SketchBehaviours_field("sandboxBehaviours",[Composing,Receiving,Sandboxing,Representing])]},schema$j=constant$1([required$1("dom"),required$1("fetch"),onHandler("onOpen"),onKeyboardHandler("onExecute"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),schema$y(),field("dropdownBehaviours",[Toggling,Coupling,Keying,Focusing]),required$1("toggleClass"),defaulted("eventOrder",{}),option("lazySink"),defaulted("matchWidth",!1),defaulted("useMinWidth",!1),option("role")].concat(sandboxFields())),parts$d=constant$1([external$1({schema:[tieredMenuMarkers()],name:"menu",defaults:function(detail){return{onExecute:detail.onExecute}}}),partType$1()]),Dropdown=composite({name:"Dropdown",configFields:schema$j(),partFields:parts$d(),factory:function(detail,components,_spec,externals){var _a,attr,switchToMenu=function(sandbox){Sandboxing.getState(sandbox).each((function(tmenu){tieredMenu.highlightPrimary(tmenu)}))},apis={expand:function(comp){Toggling.isOn(comp)||togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightNone).get(noop)},open:function(comp){Toggling.isOn(comp)||togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)},isOpen:Toggling.isOn,close:function(comp){Toggling.isOn(comp)&&togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)},repositionMenus:function(comp){Toggling.isOn(comp)&&repositionMenus(comp)}},triggerExecute=function(comp,_se){return emitExecute(comp),Optional.some(!0)};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.dropdownBehaviours,[Toggling.config({toggleClass:detail.toggleClass,aria:{mode:"expanded"}}),Coupling.config({others:{sandbox:function(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function(){return Toggling.on(hotspot)},onClose:function(){return Toggling.off(hotspot)}})}}}),Keying.config({mode:"special",onSpace:triggerExecute,onEnter:triggerExecute,onDown:function(comp,_se){if(Dropdown.isOpen(comp)){var sandbox=Coupling.getCoupled(comp,"sandbox");switchToMenu(sandbox)}else Dropdown.open(comp);return Optional.some(!0)},onEscape:function(comp,_se){return Dropdown.isOpen(comp)?(Dropdown.close(comp),Optional.some(!0)):Optional.none()}}),Focusing.config({})]),events:events$a(Optional.some((function(component){togglePopup(detail,identity$1,component,externals,switchToMenu,HighlightOnOpen.HighlightFirst).get(noop)}))),eventOrder:__assign(__assign({},detail.eventOrder),(_a={},_a[execute$5()]=["disabling","toggling","alloy.base.behaviour"],_a)),apis:apis,domModification:{attributes:__assign(__assign({"aria-haspopup":"true"},detail.role.fold((function(){return{}}),(function(role){return{role:role}}))),"button"===detail.dom.tag?{type:(attr="type",get$e(detail.dom,"attributes").bind((function(attrs){return get$e(attrs,attr)}))).getOr("button")}:{})}}},apis:{open:function(apis,comp){return apis.open(comp)},expand:function(apis,comp){return apis.expand(comp)},close:function(apis,comp){return apis.close(comp)},isOpen:function(apis,comp){return apis.isOpen(comp)},repositionMenus:function(apis,comp){return apis.repositionMenus(comp)}}}),ActiveUnselecting=Object.freeze({__proto__:null,events:function(){return derive$2([abort(selectstart(),always)])},exhibit:function(){return nu$7({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}),Unselecting=create$7({fields:[],name:"unselecting",active:ActiveUnselecting}),colorInputChangeEvent=generate$6("color-input-change"),colorSwatchChangeEvent=generate$6("color-swatch-change"),colorPickerCancelEvent=generate$6("color-picker-cancel"),renderColorInput=function(spec,sharedBackstage,colorInputBackstage){var pField=FormField.parts.field({factory:Input,inputClasses:["tox-textfield"],onSetValue:function(c){return Invalidating.run(c).get(noop)},inputBehaviours:derive$1([Disabling.config({disabled:sharedBackstage.providers.isDisabled}),receivingConfig(),Tabstopping.config({}),Invalidating.config({invalidClass:"tox-textbox-field-invalid",getRoot:function(comp){return parent(comp.element)},notify:{onValid:function(comp){var val=Representing.getValue(comp);emitWith(comp,colorInputChangeEvent,{color:val})}},validator:{validateOnLoad:!1,validate:function(input){var inputValue=Representing.getValue(input);if(0===inputValue.length)return Future_pure(Result.value(!0));var span=SugarElement.fromTag("span");set$7(span,"background-color",inputValue);var res=getRaw(span,"background-color").fold((function(){return Result.error("blah")}),(function(_){return Result.value(inputValue)}));return Future_pure(res)}}})]),selectOnFocus:!1}),pLabel=spec.label.map((function(label){return renderLabel$2(label,sharedBackstage.providers)})),emitSwatchChange=function(colorBit,value){emitWith(colorBit,colorSwatchChangeEvent,{value:value})},memColorButton=record(function(spec,sharedBackstage){return Dropdown.sketch({dom:spec.dom,components:spec.components,toggleClass:"mce-active",dropdownBehaviours:derive$1([DisablingConfigs_button(sharedBackstage.providers.isDisabled),receivingConfig(),Unselecting.config({}),Tabstopping.config({})]),layouts:spec.layouts,sandboxClasses:["tox-dialog__popups"],lazySink:sharedBackstage.getSink,fetch:function(comp){return Future_nu((function(callback){return spec.fetch(callback)})).map((function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6("menu-value"),items,(function(value){spec.onItemAction(comp,value)}),spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,never,sharedBackstage.providers),{movement:deriveMenuMovement(spec.columns,spec.presets)})))}))},parts:{menu:part(0,0,spec.presets)}})}({dom:{tag:"span",attributes:{"aria-label":sharedBackstage.providers.translate("Color swatch")}},layouts:{onRtl:function(){return[southwest$2,southeast$2,south$2]},onLtr:function(){return[southeast$2,southwest$2,south$2]}},components:[],fetch:getFetch$1(colorInputBackstage.getColors(),colorInputBackstage.hasCustomColors()),columns:colorInputBackstage.getColorCols(),presets:"color",onItemAction:function(comp,value){memColorButton.getOpt(comp).each((function(colorBit){"custom"===value?colorInputBackstage.colorPicker((function(valueOpt){valueOpt.fold((function(){return emit(colorBit,colorPickerCancelEvent)}),(function(value){emitSwatchChange(colorBit,value),addColor(value)}))}),"#ffffff"):emitSwatchChange(colorBit,"remove"===value?"":value)}))}},sharedBackstage));return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:pLabel.toArray().concat([{dom:{tag:"div",classes:["tox-color-input"]},components:[pField,memColorButton.asSpec()]}]),fieldBehaviours:derive$1([config("form-field-events",[run$1(colorInputChangeEvent,(function(comp,se){memColorButton.getOpt(comp).each((function(colorButton){set$7(colorButton.element,"background-color",se.event.color)})),emitWith(comp,formChangeEvent,{name:spec.name})})),run$1(colorSwatchChangeEvent,(function(comp,se){FormField.getField(comp).each((function(field){Representing.setValue(field,se.event.value),Composing.getCurrent(comp).each(Focusing.focus)}))})),run$1(colorPickerCancelEvent,(function(comp,_se){FormField.getField(comp).each((function(_field){Composing.getCurrent(comp).each(Focusing.focus)}))}))])])})},labelPart=optional({schema:[required$1("dom")],name:"label"}),edgePart=function(name){return optional({name:name+"-edge",overrides:function(detail){return detail.model.manager.edgeActions[name].fold((function(){return{}}),(function(a){return{events:derive$2([runActionExtra(touchstart(),(function(comp,se,d){return a(comp,d)}),[detail]),runActionExtra(mousedown(),(function(comp,se,d){return a(comp,d)}),[detail]),runActionExtra(mousemove(),(function(comp,se,det){det.mouseIsDown.get()&&a(comp,det)}),[detail])])}}))}})},tlEdgePart=edgePart("top-left"),tedgePart=edgePart("top"),trEdgePart=edgePart("top-right"),redgePart=edgePart("right"),brEdgePart=edgePart("bottom-right"),bedgePart=edgePart("bottom"),blEdgePart=edgePart("bottom-left"),ledgePart=edgePart("left"),thumbPart=required({name:"thumb",defaults:constant$1({dom:{styles:{position:"absolute"}}}),overrides:function(detail){return{events:derive$2([redirectToPart(touchstart(),detail,"spectrum"),redirectToPart(touchmove(),detail,"spectrum"),redirectToPart(touchend(),detail,"spectrum"),redirectToPart(mousedown(),detail,"spectrum"),redirectToPart(mousemove(),detail,"spectrum"),redirectToPart(mouseup(),detail,"spectrum")])}}}),spectrumPart=required({schema:[customField("mouseIsDown",(function(){return Cell(!1)}))],name:"spectrum",overrides:function(detail){var model=detail.model.manager,setValueFrom=function(component,simulatedEvent){return model.getValueFromEvent(simulatedEvent).map((function(value){return model.setValueFrom(component,detail,value)}))};return{behaviours:derive$1([Keying.config({mode:"special",onLeft:function(spectrum){return model.onLeft(spectrum,detail)},onRight:function(spectrum){return model.onRight(spectrum,detail)},onUp:function(spectrum){return model.onUp(spectrum,detail)},onDown:function(spectrum){return model.onDown(spectrum,detail)}}),Focusing.config({})]),events:derive$2([run$1(touchstart(),setValueFrom),run$1(touchmove(),setValueFrom),run$1(mousedown(),setValueFrom),run$1(mousemove(),(function(spectrum,se){detail.mouseIsDown.get()&&setValueFrom(spectrum,se)}))])}}}),SliderParts=[labelPart,ledgePart,redgePart,tedgePart,bedgePart,tlEdgePart,trEdgePart,blEdgePart,brEdgePart,thumbPart,spectrumPart],sliderChangeEvent=constant$1("slider.change.value"),getEventSource=function(simulatedEvent){var evt=simulatedEvent.event.raw;if(function(evt){return-1!==evt.type.indexOf("touch")}(evt)){var touchEvent=evt;return void 0!==touchEvent.touches&&1===touchEvent.touches.length?Optional.some(touchEvent.touches[0]).map((function(t){return SugarPosition(t.clientX,t.clientY)})):Optional.none()}var mouseEvent=evt;return void 0!==mouseEvent.clientX?Optional.some(mouseEvent).map((function(me){return SugarPosition(me.clientX,me.clientY)})):Optional.none()},minX=function(detail){return detail.model.minX},minY=function(detail){return detail.model.minY},min1X=function(detail){return detail.model.minX-1},min1Y=function(detail){return detail.model.minY-1},maxX=function(detail){return detail.model.maxX},maxY=function(detail){return detail.model.maxY},max1X=function(detail){return detail.model.maxX+1},max1Y=function(detail){return detail.model.maxY+1},range=function(detail,max,min){return max(detail)-min(detail)},xRange=function(detail){return range(detail,maxX,minX)},yRange=function(detail){return range(detail,maxY,minY)},halfX=function(detail){return xRange(detail)/2},halfY=function(detail){return yRange(detail)/2},step=function(detail){return detail.stepSize},snap=function(detail){return detail.snapToGrid},snapStart=function(detail){return detail.snapStart},rounded=function(detail){return detail.rounded},hasEdge=function(detail,edgeName){return void 0!==detail[edgeName+"-edge"]},hasLEdge=function(detail){return hasEdge(detail,"left")},hasREdge=function(detail){return hasEdge(detail,"right")},hasTEdge=function(detail){return hasEdge(detail,"top")},hasBEdge=function(detail){return hasEdge(detail,"bottom")},currentValue=function(detail){return detail.model.value.get()},xValue=function(x){return{x:x}},yValue=function(y){return{y:y}},xyValue=function(x,y){return{x:x,y:y}},fireSliderChange$3=function(component,value){emitWith(component,sliderChangeEvent(),{value:value})},reduceBy=function(value,min,max,step){return value<min?value:value>max?max:value===min?min-1:Math.max(min,value-step)},increaseBy=function(value,min,max,step){return value>max?value:value<min?min:value===max?max+1:Math.min(max,value+step)},capValue=function(value,min,max){return Math.max(min,Math.min(max,value))},findValueOf=function(args){var min=args.min,max=args.max,range=args.range,value=args.value,step=args.step,snap=args.snap,snapStart=args.snapStart,rounded=args.rounded,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,minBound=args.minBound,maxBound=args.maxBound,screenRange=args.screenRange,capMin=hasMinEdge?min-1:min,capMax=hasMaxEdge?max+1:max;if(value<minBound)return capMin;if(value>maxBound)return capMax;var offset=function(value,min,max){return Math.min(max,Math.max(value,min))-min}(value,minBound,maxBound),newValue=capValue(offset/screenRange*range+min,capMin,capMax);return snap&&newValue>=min&&newValue<=max?function(value,min,max,step,snapStart){return snapStart.fold((function(){var initValue=value-min,extraValue=Math.round(initValue/step)*step;return capValue(min+extraValue,min-1,max+1)}),(function(start){var remainder=(value-start)%step,adjustment=Math.round(remainder/step),rawSteps=Math.floor((value-start)/step),maxSteps=Math.floor((max-start)/step),r=start+Math.min(maxSteps,rawSteps+adjustment)*step;return Math.max(start,r)}))}(newValue,min,max,step,snapStart):rounded?Math.round(newValue):newValue},findOffsetOfValue$2=function(args){var min=args.min,max=args.max,range=args.range,value=args.value,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,maxBound=args.maxBound,maxOffset=args.maxOffset,centerMinEdge=args.centerMinEdge,centerMaxEdge=args.centerMaxEdge;return value<min?hasMinEdge?0:centerMinEdge:value>max?hasMaxEdge?maxBound:centerMaxEdge:(value-min)/range*maxOffset},getBounds=function(component){return component.element.dom.getBoundingClientRect()},getBoundsProperty=function(bounds,property){return bounds[property]},getMinXBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,"left")},getMaxXBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,"right")},getMinYBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,"top")},getMaxYBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,"bottom")},getXScreenRange=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,"width")},getYScreenRange=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,"height")},getCenterOffsetOf=function(componentMinEdge,componentMaxEdge,spectrumMinEdge){return(componentMinEdge+componentMaxEdge)/2-spectrumMinEdge},getXCenterOffSetOf=function(component,spectrum){var componentBounds=getBounds(component),spectrumBounds=getBounds(spectrum),componentMinEdge=getBoundsProperty(componentBounds,"left"),componentMaxEdge=getBoundsProperty(componentBounds,"right"),spectrumMinEdge=getBoundsProperty(spectrumBounds,"left");return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge)},getYCenterOffSetOf=function(component,spectrum){var componentBounds=getBounds(component),spectrumBounds=getBounds(spectrum),componentMinEdge=getBoundsProperty(componentBounds,"top"),componentMaxEdge=getBoundsProperty(componentBounds,"bottom"),spectrumMinEdge=getBoundsProperty(spectrumBounds,"top");return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge)},fireSliderChange$2=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue$2=function(x){return{x:x}},findValueOfOffset$1=function(spectrum,detail,left){var args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:left,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),maxBound:getMaxXBounds(spectrum),screenRange:getXScreenRange(spectrum)};return findValueOf(args)},handleMovement$2=function(direction){return function(spectrum,detail){return function(direction,spectrum,detail){var xValue=(direction>0?increaseBy:reduceBy)(currentValue(detail).x,minX(detail),maxX(detail),step(detail));return fireSliderChange$2(spectrum,sliderValue$2(xValue)),Optional.some(xValue)}(direction,spectrum,detail).map(always)}},findPositionOfValue$1=function(slider,spectrum,value,minEdge,maxEdge,detail){var offset=function(spectrum,detail,value,minEdge,maxEdge){var maxOffset=getXScreenRange(spectrum),centerMinEdge=minEdge.bind((function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum))})).getOr(0),centerMaxEdge=maxEdge.bind((function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum))})).getOr(maxOffset),args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:value,hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),minOffset:0,maxBound:getMaxXBounds(spectrum),maxOffset:maxOffset,centerMinEdge:centerMinEdge,centerMaxEdge:centerMaxEdge};return findOffsetOfValue$2(args)}(spectrum,detail,value,minEdge,maxEdge);return getMinXBounds(spectrum)-getMinXBounds(slider)+offset},onLeft$2=handleMovement$2(-1),onRight$2=handleMovement$2(1),onUp$2=Optional.none,onDown$2=Optional.none,edgeActions$2={"top-left":Optional.none(),top:Optional.none(),"top-right":Optional.none(),right:Optional.some((function(edge,detail){fireSliderChange$3(edge,xValue(max1X(detail)))})),"bottom-right":Optional.none(),bottom:Optional.none(),"bottom-left":Optional.none(),left:Optional.some((function(edge,detail){fireSliderChange$3(edge,xValue(min1X(detail)))}))},HorizontalModel=Object.freeze({__proto__:null,setValueFrom:function(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value),sliderVal=sliderValue$2(xValue);return fireSliderChange$2(spectrum,sliderVal),xValue},setToMin:function(spectrum,detail){var min=minX(detail);fireSliderChange$2(spectrum,sliderValue$2(min))},setToMax:function(spectrum,detail){var max=maxX(detail);fireSliderChange$2(spectrum,sliderValue$2(max))},findValueOfOffset:findValueOfOffset$1,getValueFromEvent:function(simulatedEvent){return getEventSource(simulatedEvent).map((function(p){return p.left}))},findPositionOfValue:findPositionOfValue$1,setPositionFromValue:function(slider,thumb,detail,edges){var value=currentValue(detail),pos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail),thumbRadius=get$a(thumb.element)/2;set$7(thumb.element,"left",pos-thumbRadius+"px")},onLeft:onLeft$2,onRight:onRight$2,onUp:onUp$2,onDown:onDown$2,edgeActions:edgeActions$2}),fireSliderChange$1=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue$1=function(y){return{y:y}},findValueOfOffset=function(spectrum,detail,top){var args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:top,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),maxBound:getMaxYBounds(spectrum),screenRange:getYScreenRange(spectrum)};return findValueOf(args)},handleMovement$1=function(direction){return function(spectrum,detail){return function(direction,spectrum,detail){var yValue=(direction>0?increaseBy:reduceBy)(currentValue(detail).y,minY(detail),maxY(detail),step(detail));return fireSliderChange$1(spectrum,sliderValue$1(yValue)),Optional.some(yValue)}(direction,spectrum,detail).map(always)}},findPositionOfValue=function(slider,spectrum,value,minEdge,maxEdge,detail){var offset=function(spectrum,detail,value,minEdge,maxEdge){var maxOffset=getYScreenRange(spectrum),centerMinEdge=minEdge.bind((function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum))})).getOr(0),centerMaxEdge=maxEdge.bind((function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum))})).getOr(maxOffset),args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:value,hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),minOffset:0,maxBound:getMaxYBounds(spectrum),maxOffset:maxOffset,centerMinEdge:centerMinEdge,centerMaxEdge:centerMaxEdge};return findOffsetOfValue$2(args)}(spectrum,detail,value,minEdge,maxEdge);return getMinYBounds(spectrum)-getMinYBounds(slider)+offset},onLeft$1=Optional.none,onRight$1=Optional.none,onUp$1=handleMovement$1(-1),onDown$1=handleMovement$1(1),edgeActions$1={"top-left":Optional.none(),top:Optional.some((function(edge,detail){fireSliderChange$3(edge,yValue(min1Y(detail)))})),"top-right":Optional.none(),right:Optional.none(),"bottom-right":Optional.none(),bottom:Optional.some((function(edge,detail){fireSliderChange$3(edge,yValue(max1Y(detail)))})),"bottom-left":Optional.none(),left:Optional.none()},VerticalModel=Object.freeze({__proto__:null,setValueFrom:function(spectrum,detail,value){var yValue=findValueOfOffset(spectrum,detail,value),sliderVal=sliderValue$1(yValue);return fireSliderChange$1(spectrum,sliderVal),yValue},setToMin:function(spectrum,detail){var min=minY(detail);fireSliderChange$1(spectrum,sliderValue$1(min))},setToMax:function(spectrum,detail){var max=maxY(detail);fireSliderChange$1(spectrum,sliderValue$1(max))},findValueOfOffset:findValueOfOffset,getValueFromEvent:function(simulatedEvent){return getEventSource(simulatedEvent).map((function(p){return p.top}))},findPositionOfValue:findPositionOfValue,setPositionFromValue:function(slider,thumb,detail,edges){var value=currentValue(detail),pos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail),thumbRadius=get$b(thumb.element)/2;set$7(thumb.element,"top",pos-thumbRadius+"px")},onLeft:onLeft$1,onRight:onRight$1,onUp:onUp$1,onDown:onDown$1,edgeActions:edgeActions$1}),fireSliderChange=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue=function(x,y){return{x:x,y:y}},handleMovement=function(direction,isVerticalMovement){return function(spectrum,detail){return function(direction,isVerticalMovement,spectrum,detail){var f=direction>0?increaseBy:reduceBy,xValue=isVerticalMovement?currentValue(detail).x:f(currentValue(detail).x,minX(detail),maxX(detail),step(detail)),yValue=isVerticalMovement?f(currentValue(detail).y,minY(detail),maxY(detail),step(detail)):currentValue(detail).y;return fireSliderChange(spectrum,sliderValue(xValue,yValue)),Optional.some(xValue)}(direction,isVerticalMovement,spectrum,detail).map(always)}},onLeft=handleMovement(-1,!1),onRight=handleMovement(1,!1),onUp=handleMovement(-1,!0),onDown=handleMovement(1,!0),edgeActions={"top-left":Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),min1Y(detail)))})),top:Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(halfX(detail),min1Y(detail)))})),"top-right":Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),min1Y(detail)))})),right:Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),halfY(detail)))})),"bottom-right":Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),max1Y(detail)))})),bottom:Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(halfX(detail),max1Y(detail)))})),"bottom-left":Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),max1Y(detail)))})),left:Optional.some((function(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),halfY(detail)))}))},TwoDModel=Object.freeze({__proto__:null,setValueFrom:function(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value.left),yValue=findValueOfOffset(spectrum,detail,value.top),val=sliderValue(xValue,yValue);return fireSliderChange(spectrum,val),val},setToMin:function(spectrum,detail){var mX=minX(detail),mY=minY(detail);fireSliderChange(spectrum,sliderValue(mX,mY))},setToMax:function(spectrum,detail){var mX=maxX(detail),mY=maxY(detail);fireSliderChange(spectrum,sliderValue(mX,mY))},getValueFromEvent:function(simulatedEvent){return getEventSource(simulatedEvent)},setPositionFromValue:function(slider,thumb,detail,edges){var value=currentValue(detail),xPos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail),yPos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail),thumbXRadius=get$a(thumb.element)/2,thumbYRadius=get$b(thumb.element)/2;set$7(thumb.element,"left",xPos-thumbXRadius+"px"),set$7(thumb.element,"top",yPos-thumbYRadius+"px")},onLeft:onLeft,onRight:onRight,onUp:onUp,onDown:onDown,edgeActions:edgeActions}),Slider=composite({name:"Slider",configFields:[defaulted("stepSize",1),defaulted("onChange",noop),defaulted("onChoose",noop),defaulted("onInit",noop),defaulted("onDragStart",noop),defaulted("onDragEnd",noop),defaulted("snapToGrid",!1),defaulted("rounded",!0),option("snapStart"),requiredOf("model",choose$1("mode",{x:[defaulted("minX",0),defaulted("maxX",100),customField("value",(function(spec){return Cell(spec.mode.minX)})),required$1("getInitialValue"),output$1("manager",HorizontalModel)],y:[defaulted("minY",0),defaulted("maxY",100),customField("value",(function(spec){return Cell(spec.mode.minY)})),required$1("getInitialValue"),output$1("manager",VerticalModel)],xy:[defaulted("minX",0),defaulted("maxX",100),defaulted("minY",0),defaulted("maxY",100),customField("value",(function(spec){return Cell({x:spec.mode.minX,y:spec.mode.minY})})),required$1("getInitialValue"),output$1("manager",TwoDModel)]})),field("sliderBehaviours",[Keying,Representing]),customField("mouseIsDown",(function(){return Cell(!1)}))],partFields:SliderParts,factory:function(detail,components,_spec,_externals){var _a,getThumb=function(component){return getPartOrDie(component,detail,"thumb")},getSpectrum=function(component){return getPartOrDie(component,detail,"spectrum")},getLeftEdge=function(component){return getPart(component,detail,"left-edge")},getRightEdge=function(component){return getPart(component,detail,"right-edge")},getTopEdge=function(component){return getPart(component,detail,"top-edge")},getBottomEdge=function(component){return getPart(component,detail,"bottom-edge")},modelDetail=detail.model,model=modelDetail.manager,refresh=function(slider,thumb){model.setPositionFromValue(slider,thumb,detail,{getLeftEdge:getLeftEdge,getRightEdge:getRightEdge,getTopEdge:getTopEdge,getBottomEdge:getBottomEdge,getSpectrum:getSpectrum})},setValue=function(slider,newValue){modelDetail.value.set(newValue);var thumb=getThumb(slider);refresh(slider,thumb)},choose=function(slider){var wasDown=detail.mouseIsDown.get();detail.mouseIsDown.set(!1),wasDown&&getPart(slider,detail,"thumb").each((function(thumb){var value=modelDetail.value.get();detail.onChoose(slider,thumb,value)}))},onDragStart=function(slider,simulatedEvent){simulatedEvent.stop(),detail.mouseIsDown.set(!0),detail.onDragStart(slider,getThumb(slider))},onDragEnd=function(slider,simulatedEvent){simulatedEvent.stop(),detail.onDragEnd(slider,getThumb(slider)),choose(slider)};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.sliderBehaviours,[Keying.config({mode:"special",focusIn:function(slider){return getPart(slider,detail,"spectrum").map(Keying.focusIn).map(always)}}),Representing.config({store:{mode:"manual",getValue:function(_){return modelDetail.value.get()}}}),Receiving.config({channels:(_a={},_a[mouseReleased()]={onReceive:choose},_a)})]),events:derive$2([run$1(sliderChangeEvent(),(function(slider,simulatedEvent){!function(slider,newValue){setValue(slider,newValue);var thumb=getThumb(slider);detail.onChange(slider,thumb,newValue),Optional.some(!0)}(slider,simulatedEvent.event.value)})),runOnAttached((function(slider,_simulatedEvent){var getInitial=modelDetail.getInitialValue();modelDetail.value.set(getInitial);var thumb=getThumb(slider);refresh(slider,thumb);var spectrum=getSpectrum(slider);detail.onInit(slider,thumb,spectrum,modelDetail.value.get())})),run$1(touchstart(),onDragStart),run$1(touchend(),onDragEnd),run$1(mousedown(),onDragStart),run$1(mouseup(),onDragEnd)]),apis:{resetToMin:function(slider){model.setToMin(slider,detail)},resetToMax:function(slider){model.setToMax(slider,detail)},setValue:setValue,refresh:refresh},domModification:{styles:{position:"relative"}}}},apis:{setValue:function(apis,slider,value){apis.setValue(slider,value)},resetToMin:function(apis,slider){apis.resetToMin(slider)},resetToMax:function(apis,slider){apis.resetToMax(slider)},refresh:function(apis,slider){apis.refresh(slider)}}}),fieldsUpdate=generate$6("rgb-hex-update"),sliderUpdate=generate$6("slider-update"),paletteUpdate=generate$6("palette-update"),schema$i=[field("formBehaviours",[Representing])],getPartName$1=function(name){return"<alloy.field."+name+">"},make$4=function(detail,components){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.formBehaviours,[Representing.config({store:{mode:"manual",getValue:function(form){var resPs=getAllParts(form,detail);return map$1(resPs,(function(resPThunk,pName){return resPThunk().bind((function(v){var o,e,opt=Composing.getCurrent(v);return o=opt,e=new Error("Cannot find a current component to extract the value from for form part '"+pName+"': "+element(v.element)),o.fold((function(){return Result.error(e)}),Result.value)})).map(Representing.getValue)}))},setValue:function(form,values){each(values,(function(newValue,key){getPart(form,detail,key).each((function(wrapper){Composing.getCurrent(wrapper).each((function(field){Representing.setValue(field,newValue)}))}))}))}}})]),apis:{getField:function(form,key){return getPart(form,detail,key).bind(Composing.getCurrent)}}}},Form={getField:makeApi((function(apis,component,key){return apis.getField(component,key)})),sketch:function(fSpec){var parts=function(){var record=[];return{field:function(name,config){return record.push(name),generateOne$1("form",getPartName$1(name),config)},record:constant$1(record)}}(),spec=fSpec(parts),partNames=parts.record(),fieldParts=map$2(partNames,(function(n){return required({name:n,pname:getPartName$1(n)})}));return composite$1("form",schema$i,fieldParts,make$4,spec)}},validInput=generate$6("valid-input"),invalidInput=generate$6("invalid-input"),validatingInput=generate$6("validating-input"),rgbFormFactory=function(translate,getClass,onValidHexx,onInvalidHexx){var invalidation=function(label,isValid){return Invalidating.config({invalidClass:getClass("invalid"),notify:{onValidate:function(comp){emitWith(comp,validatingInput,{type:label})},onValid:function(comp){emitWith(comp,validInput,{type:label,value:Representing.getValue(comp)})},onInvalid:function(comp){emitWith(comp,invalidInput,{type:label,value:Representing.getValue(comp)})}},validator:{validate:function(comp){var value=Representing.getValue(comp),res=isValid(value)?Result.value(!0):Result.error(translate("aria.input.invalid"));return Future_pure(res)},validateOnLoad:!1}})},renderTextField=function(isValid,name,label,description,data){var helptext=translate("colorcustom.rgb.range"),comps=[FormField.parts.label({dom:{tag:"label",innerHtml:label,attributes:{"aria-label":description}}}),FormField.parts.field({data:data,factory:Input,inputAttributes:__assign({type:"text"},"hex"===name?{"aria-live":"polite"}:{}),inputClasses:[getClass("textfield")],inputBehaviours:derive$1([invalidation(name,isValid),Tabstopping.config({})]),onSetValue:function(input){Invalidating.isInvalid(input)&&Invalidating.run(input).get(noop)}})],concats="hex"!==name?[FormField.parts["aria-descriptor"]({text:helptext})]:[];return{dom:{tag:"div",attributes:{role:"presentation"}},components:comps.concat(concats)}},copyRgbToForm=function(form,rgb){var red=rgb.red,green=rgb.green,blue=rgb.blue;Representing.setValue(form,{red:red,green:green,blue:blue})},memPreview=record({dom:{tag:"div",classes:[getClass("rgba-preview")],styles:{"background-color":"white"},attributes:{role:"presentation"}}}),updatePreview=function(anyInSystem,hex){memPreview.getOpt(anyInSystem).each((function(preview){set$7(preview.element,"background-color","#"+hex.value)}))};return single({factory:function(){var state={red:Cell(Optional.some(255)),green:Cell(Optional.some(255)),blue:Cell(Optional.some(255)),hex:Cell(Optional.some("ffffff"))},get=function(prop){return state[prop].get()},set=function(prop,value){state[prop].set(value)},setValueRgb=function(rgb){var red=rgb.red,green=rgb.green,blue=rgb.blue;set("red",Optional.some(red)),set("green",Optional.some(green)),set("blue",Optional.some(blue))},onInvalidInput=function(form,simulatedEvent){var data=simulatedEvent.event;"hex"!==data.type?set(data.type,Optional.none()):onInvalidHexx(form)},onValidRgb=function(form,prop,value){var val=parseInt(value,10);set(prop,Optional.some(val)),get("red").bind((function(red){return get("green").bind((function(green){return get("blue").map((function(blue){return rgbaColour(red,green,blue,1)}))}))})).each((function(rgb){var hex=function(form,rgba){var hex=fromRgba(rgba);return Form.getField(form,"hex").each((function(hexField){Focusing.isFocused(hexField)||Representing.setValue(form,{hex:hex.value})})),hex}(form,rgb);emitWith(form,fieldsUpdate,{hex:hex}),updatePreview(form,hex)}))},onValidInput=function(form,simulatedEvent){var data=simulatedEvent.event;!function(data){return"hex"===data.type}(data)?onValidRgb(form,data.type,data.value):function(form,value){onValidHexx(form);var hex=hexColour(value);set("hex",Optional.some(value));var rgb=fromHex(hex);copyRgbToForm(form,rgb),setValueRgb(rgb),emitWith(form,fieldsUpdate,{hex:hex}),updatePreview(form,hex)}(form,data.value)},formPartStrings=function(key){return{label:translate("colorcustom.rgb."+key+".label"),description:translate("colorcustom.rgb."+key+".description")}},redStrings=formPartStrings("red"),greenStrings=formPartStrings("green"),blueStrings=formPartStrings("blue"),hexStrings=formPartStrings("hex");return deepMerge(Form.sketch((function(parts){return{dom:{tag:"form",classes:[getClass("rgb-form")],attributes:{"aria-label":translate("aria.color.picker")}},components:[parts.field("red",FormField.sketch(renderTextField(isRgbaComponent,"red",redStrings.label,redStrings.description,255))),parts.field("green",FormField.sketch(renderTextField(isRgbaComponent,"green",greenStrings.label,greenStrings.description,255))),parts.field("blue",FormField.sketch(renderTextField(isRgbaComponent,"blue",blueStrings.label,blueStrings.description,255))),parts.field("hex",FormField.sketch(renderTextField(isHexString,"hex",hexStrings.label,hexStrings.description,"ffffff"))),memPreview.asSpec()],formBehaviours:derive$1([Invalidating.config({invalidClass:getClass("form-invalid")}),config("rgb-form-events",[run$1(validInput,onValidInput),run$1(invalidInput,onInvalidInput),run$1(validatingInput,onInvalidInput)])])}})),{apis:{updateHex:function(form,hex){Representing.setValue(form,{hex:hex.value}),function(form,hex){var rgb=fromHex(hex);copyRgbToForm(form,rgb),setValueRgb(rgb)}(form,hex),updatePreview(form,hex)}}})},name:"RgbForm",configFields:[],apis:{updateHex:function(apis,form,hex){apis.updateHex(form,hex)}},extraApis:{}})},paletteFactory=function(_translate,getClass){var spectrumPart=Slider.parts.spectrum({dom:{tag:"canvas",attributes:{role:"presentation"},classes:[getClass("sv-palette-spectrum")]}}),thumbPart=Slider.parts.thumb({dom:{tag:"div",attributes:{role:"presentation"},classes:[getClass("sv-palette-thumb")],innerHtml:"<div class="+getClass("sv-palette-inner-thumb")+' role="presentation"></div>'}}),setColour=function(canvas,rgba){var width=canvas.width,height=canvas.height,ctx=canvas.getContext("2d");if(null!==ctx){ctx.fillStyle=rgba,ctx.fillRect(0,0,width,height);var grdWhite=ctx.createLinearGradient(0,0,width,0);grdWhite.addColorStop(0,"rgba(255,255,255,1)"),grdWhite.addColorStop(1,"rgba(255,255,255,0)"),ctx.fillStyle=grdWhite,ctx.fillRect(0,0,width,height);var grdBlack=ctx.createLinearGradient(0,0,0,height);grdBlack.addColorStop(0,"rgba(0,0,0,0)"),grdBlack.addColorStop(1,"rgba(0,0,0,1)"),ctx.fillStyle=grdBlack,ctx.fillRect(0,0,width,height)}};return single({factory:function(_detail){var getInitialValue=constant$1({x:0,y:0}),sliderBehaviours=derive$1([Composing.config({find:Optional.some}),Focusing.config({})]);return Slider.sketch({dom:{tag:"div",attributes:{role:"presentation"},classes:[getClass("sv-palette")]},model:{mode:"xy",getInitialValue:getInitialValue},rounded:!1,components:[spectrumPart,thumbPart],onChange:function(slider,_thumb,value){emitWith(slider,paletteUpdate,{value:value})},onInit:function(_slider,_thumb,spectrum,_value){setColour(spectrum.element.dom,toString(red))},sliderBehaviours:sliderBehaviours})},name:"SaturationBrightnessPalette",configFields:[],apis:{setHue:function(_apis,slider,hue){!function(slider,hue){var canvas=slider.components()[0].element.dom,hsv=hsvColour(hue,100,100),rgba=fromHsv(hsv);setColour(canvas,toString(rgba))}(slider,hue)},setThumb:function(_apis,slider,hex){!function(slider,hex){var hsv=fromRgb(fromHex(hex));Slider.setValue(slider,{x:hsv.saturation,y:100-hsv.value})}(slider,hex)}},extraApis:{}})},makeFactory=function(translate,getClass){return single({name:"ColourPicker",configFields:[required$1("dom"),defaulted("onValidHex",noop),defaulted("onInvalidHex",noop)],factory:function(detail){var updates,rgbForm=rgbFormFactory(translate,getClass,detail.onValidHex,detail.onInvalidHex),sbPalette=paletteFactory(0,getClass),hueDegreesToSlider=function(hue){return 100-hue/360*100},state={paletteRgba:Cell(red),paletteHue:Cell(0)},memSlider=record(function(translate,getClass){var spectrum=Slider.parts.spectrum({dom:{tag:"div",classes:[getClass("hue-slider-spectrum")],attributes:{role:"presentation"}}}),thumb=Slider.parts.thumb({dom:{tag:"div",classes:[getClass("hue-slider-thumb")],attributes:{role:"presentation"}}});return Slider.sketch({dom:{tag:"div",classes:[getClass("hue-slider")],attributes:{role:"presentation"}},rounded:!1,model:{mode:"y",getInitialValue:constant$1({y:0})},components:[spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChange:function(slider,_thumb,value){emitWith(slider,sliderUpdate,{value:value})}})}(0,getClass)),memPalette=record(sbPalette.sketch({})),memRgb=record(rgbForm.sketch({})),updatePalette=function(anyInSystem,_hex,hue){memPalette.getOpt(anyInSystem).each((function(palette){sbPalette.setHue(palette,hue)}))},updateFields=function(anyInSystem,hex){memRgb.getOpt(anyInSystem).each((function(form){rgbForm.updateHex(form,hex)}))},updateSlider=function(anyInSystem,_hex,hue){memSlider.getOpt(anyInSystem).each((function(slider){Slider.setValue(slider,{y:hueDegreesToSlider(hue)})}))},updatePaletteThumb=function(anyInSystem,hex){memPalette.getOpt(anyInSystem).each((function(palette){sbPalette.setThumb(palette,hex)}))},runUpdates=function(anyInSystem,hex,hue,updates){!function(hex,hue){var rgba=fromHex(hex);state.paletteRgba.set(rgba),state.paletteHue.set(hue)}(hex,hue),each$1(updates,(function(update){update(anyInSystem,hex,hue)}))};return{uid:detail.uid,dom:detail.dom,components:[memPalette.asSpec(),memSlider.asSpec(),memRgb.asSpec()],behaviours:derive$1([config("colour-picker-events",[run$1(fieldsUpdate,(updates=[updatePalette,updateSlider,updatePaletteThumb],function(form,simulatedEvent){var hex=simulatedEvent.event.hex,hsv=function(hex){return fromRgb(fromHex(hex))}(hex);runUpdates(form,hex,hsv.hue,updates)})),run$1(paletteUpdate,function(){var updates=[updateFields];return function(form,simulatedEvent){var value=simulatedEvent.event.value,oldHue=state.paletteHue.get(),newHsv=hsvColour(oldHue,value.x,100-value.y),newHex=hsvToHex(newHsv);runUpdates(form,newHex,oldHue,updates)}}()),run$1(sliderUpdate,function(){var updates=[updatePalette,updateFields];return function(form,simulatedEvent){var hue=function(hue){return(100-hue)/100*360}(simulatedEvent.event.value.y),oldRgb=state.paletteRgba.get(),oldHsv=fromRgb(oldRgb),newHsv=hsvColour(hue,oldHsv.saturation,oldHsv.value),newHex=hsvToHex(newHsv);runUpdates(form,newHex,hue,updates)}}())]),Composing.config({find:function(comp){return memRgb.getOpt(comp)}}),Keying.config({mode:"acyclic"})])}}})},ComposingConfigs_self=function(){return Composing.config({find:Optional.some})},ComposingConfigs_memento=function(mem){return Composing.config({find:mem.getOpt})},ComposingConfigs_childAt=function(index){return Composing.config({find:function(comp){return child$2(comp.element,index).bind((function(element){return comp.getSystem().getByDom(element).toOptional()}))}})},english={"colorcustom.rgb.red.label":"R","colorcustom.rgb.red.description":"Red component","colorcustom.rgb.green.label":"G","colorcustom.rgb.green.description":"Green component","colorcustom.rgb.blue.label":"B","colorcustom.rgb.blue.description":"Blue component","colorcustom.rgb.hex.label":"#","colorcustom.rgb.hex.description":"Hex color code","colorcustom.rgb.range":"Range 0 to 255","colorcustom.sb.saturation":"Saturation","colorcustom.sb.brightness":"Brightness","colorcustom.sb.picker":"Saturation and Brightness Picker","colorcustom.sb.palette":"Saturation and Brightness Palette","colorcustom.sb.instructions":"Use arrow keys to select saturation and brightness, on x and y axes","colorcustom.hue.hue":"Hue","colorcustom.hue.slider":"Hue Slider","colorcustom.hue.palette":"Hue Palette","colorcustom.hue.instructions":"Use arrow keys to select a hue","aria.color.picker":"Color Picker","aria.input.invalid":"Invalid input"},translate$1=function(key){return function(key){return english[key]}(key)},global$6=tinymce.util.Tools.resolve("tinymce.Resource"),global$5=tinymce.util.Tools.resolve("tinymce.util.Tools"),processors=objOf([defaulted("preprocess",identity$1),defaulted("postprocess",identity$1)]),withComp=function(optInitialValue,getter,setter){return Representing.config(deepMerge({store:{mode:"manual",getValue:getter,setValue:setter}},optInitialValue.map((function(initialValue){return{store:{initialValue:initialValue}}})).getOr({})))},withElement=function(initialValue,getter,setter){return withComp(initialValue,(function(c){return getter(c.element)}),(function(c,v){return setter(c.element,v)}))},RepresentingConfigs_memento=function(mem,rawProcessors){var ps=asRawOrDie$1("RepresentingConfigs.memento processors",processors,rawProcessors);return Representing.config({store:{mode:"manual",getValue:function(comp){var other=mem.get(comp),rawValue=Representing.getValue(other);return ps.postprocess(rawValue)},setValue:function(comp,rawValue){var newValue=ps.preprocess(rawValue),other=mem.get(comp);Representing.setValue(other,newValue)}}})},RepresentingConfigs_withComp=withComp,RepresentingConfigs_domHtml=function(optInitialValue){return withElement(optInitialValue,get$7,set$5)},RepresentingConfigs_memory=function(initialValue){return Representing.config({store:{mode:"memory",initialValue:initialValue}})},renderDropZone=function(spec,providersBackstage){var stopper=function(_,se){se.stop()},sequence=function(actions){return function(comp,se){each$1(actions,(function(a){a(comp,se)}))}},onDrop=function(comp,se){if(!Disabling.isDisabled(comp)){var transferEvent=se.event.raw;handleFiles(comp,transferEvent.dataTransfer.files)}},onSelect=function(component,simulatedEvent){var input=simulatedEvent.event.raw.target;handleFiles(component,input.files)},handleFiles=function(component,files){Representing.setValue(component,function(files,providersBackstage){var allowedImageFileTypes=global$5.explode(providersBackstage.getSetting("images_file_types","jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp","string"));return filter$2(from(files),(function(file){return exists(allowedImageFileTypes,(function(type){return endsWith(file.name.toLowerCase(),"."+type.toLowerCase())}))}))}(files,providersBackstage)),emitWith(component,formChangeEvent,{name:spec.name})},memInput=record({dom:{tag:"input",attributes:{type:"file",accept:"image/*"},styles:{display:"none"}},behaviours:derive$1([config("input-file-events",[cutter(click()),cutter(tap())])])}),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),pField=FormField.parts.field({factory:{sketch:function(s){return{uid:s.uid,dom:{tag:"div",classes:["tox-dropzone-container"]},behaviours:derive$1([RepresentingConfigs_memory([]),ComposingConfigs_self(),Disabling.config({}),Toggling.config({toggleClass:"dragenter",toggleOnExecute:!1}),config("dropzone-events",[run$1("dragenter",sequence([stopper,Toggling.toggle])),run$1("dragleave",sequence([stopper,Toggling.toggle])),run$1("dragover",stopper),run$1("drop",sequence([stopper,onDrop])),run$1(change(),onSelect)])]),components:[{dom:{tag:"div",classes:["tox-dropzone"],styles:{}},components:[{dom:{tag:"p",innerHtml:providersBackstage.translate("Drop an image here")}},Button.sketch({dom:{tag:"button",innerHtml:providersBackstage.translate("Browse for an image"),styles:{position:"relative"},classes:["tox-button","tox-button--secondary"]},components:[memInput.asSpec()],action:function(comp){memInput.get(comp).element.dom.click()},buttonBehaviours:derive$1([Tabstopping.config({}),DisablingConfigs_button(providersBackstage.isDisabled),receivingConfig()])})]}]}}}});return renderFormFieldWith(pLabel,pField,["tox-form__group--stretched"],[])},beforeObject=generate$6("alloy-fake-before-tabstop"),afterObject=generate$6("alloy-fake-after-tabstop"),craftWithClasses=function(classes){return{dom:{tag:"div",styles:{width:"1px",height:"1px",outline:"none"},attributes:{tabindex:"0"},classes:classes},behaviours:derive$1([Focusing.config({ignore:!0}),Tabstopping.config({})])}},craft=function(spec){return{dom:{tag:"div",classes:["tox-navobj"]},components:[craftWithClasses([beforeObject]),spec,craftWithClasses([afterObject])],behaviours:derive$1([ComposingConfigs_childAt(1)])}},triggerTab=function(placeholder,shiftKey){emitWith(placeholder,keydown(),{raw:{which:9,shiftKey:shiftKey}})},onFocus=function(container,targetComp){var target=targetComp.element;has(target,beforeObject)?triggerTab(container,!0):has(target,afterObject)&&triggerTab(container,!1)},isPseudoStop=function(element){return closest(element,["."+beforeObject,"."+afterObject].join(","),never)},platformNeedsSandboxing=!(detect$1().browser.isIE()||detect$1().browser.isEdge()),renderIFrame=function(spec,providersBackstage){var isSandbox=platformNeedsSandboxing&&spec.sandboxed,attributes=__assign(__assign({},spec.label.map((function(title){return{title:title}})).getOr({})),isSandbox?{sandbox:"allow-scripts allow-same-origin"}:{}),sourcing=function(isSandbox){var cachedValue=Cell("");return{getValue:function(_frameComponent){return cachedValue.get()},setValue:function(frameComponent,html){if(isSandbox)set$8(frameComponent.element,"srcdoc",html);else{set$8(frameComponent.element,"src","javascript:''");var doc=frameComponent.element.dom.contentWindow.document;doc.open(),doc.write(html),doc.close()}cachedValue.set(html)}}}(isSandbox),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),pField=FormField.parts.field({factory:{sketch:function(newSpec){return craft({uid:newSpec.uid,dom:{tag:"iframe",attributes:attributes},behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),RepresentingConfigs_withComp(Optional.none(),sourcing.getValue,sourcing.setValue)])})}}});return renderFormFieldWith(pLabel,pField,["tox-form__group--stretched"],[])},create$3=function(width,height){return resize$3(document.createElement("canvas"),width,height)},clone=function(canvas){var tCanvas=create$3(canvas.width,canvas.height);return get2dContext(tCanvas).drawImage(canvas,0,0),tCanvas},get2dContext=function(canvas){return canvas.getContext("2d")},resize$3=function(canvas,width,height){return canvas.width=width,canvas.height=height,canvas},getWidth$1=function(image){return image.naturalWidth||image.width},getHeight$1=function(image){return image.naturalHeight||image.height},dataUriToBlob=function(uri){return new Promise$1((function(resolve,reject){(function(uri){var data=uri.split(","),matches=/data:([^;]+)/.exec(data[0]);if(!matches)return Optional.none();for(var mimetype=matches[1],base64=data[1],byteCharacters=atob(base64),bytesLength=byteCharacters.length,slicesCount=Math.ceil(bytesLength/1024),byteArrays=new Array(slicesCount),sliceIndex=0;sliceIndex<slicesCount;++sliceIndex){for(var begin=1024*sliceIndex,end=Math.min(begin+1024,bytesLength),bytes=new Array(end-begin),offset=begin,i=0;offset<end;++i,++offset)bytes[i]=byteCharacters[offset].charCodeAt(0);byteArrays[sliceIndex]=new Uint8Array(bytes)}return Optional.some(new Blob(byteArrays,{type:mimetype}))})(uri).fold((function(){reject("uri is not base64: "+uri)}),resolve)}))},canvasToBlob=function(canvas,type,quality){return type=type||"image/png",isFunction(HTMLCanvasElement.prototype.toBlob)?new Promise$1((function(resolve,reject){canvas.toBlob((function(blob){blob?resolve(blob):reject()}),type,quality)})):dataUriToBlob(canvas.toDataURL(type,quality))},blobToCanvas=function(blob){return function(blob){return new Promise$1((function(resolve,reject){var blobUrl=URL.createObjectURL(blob),image=new Image,removeListeners=function(){image.removeEventListener("load",loaded),image.removeEventListener("error",error)},loaded=function(){removeListeners(),resolve(image)},error=function(){removeListeners(),reject("Unable to load data of type "+blob.type+": "+blobUrl)};image.addEventListener("load",loaded),image.addEventListener("error",error),image.src=blobUrl,image.complete&&setTimeout(loaded,0)}))}(blob).then((function(image){revokeImageUrl(image);var canvas=create$3(getWidth$1(image),getHeight$1(image));return get2dContext(canvas).drawImage(image,0,0),canvas}))},revokeImageUrl=function(image){URL.revokeObjectURL(image.src)},create$2=function(getCanvas,blob,uri){var initialType=blob.type,getType=constant$1(initialType),toDataURL=constant$1(uri),toAdjustedDataURL=function(type,quality){return getCanvas.then((function(canvas){return function(canvas,type,quality){return type=type||"image/png",canvas.toDataURL(type,quality)}(canvas,type,quality)}))};return{getType:getType,toBlob:function(){return Promise$1.resolve(blob)},toDataURL:toDataURL,toBase64:function(){return uri.split(",")[1]},toAdjustedBlob:function(type,quality){return getCanvas.then((function(canvas){return canvasToBlob(canvas,type,quality)}))},toAdjustedDataURL:toAdjustedDataURL,toAdjustedBase64:function(type,quality){return toAdjustedDataURL(type,quality).then((function(dataurl){return dataurl.split(",")[1]}))},toCanvas:function(){return getCanvas.then(clone)}}},fromBlob=function(blob){return function(blob){return new Promise$1((function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)}))}(blob).then((function(uri){return create$2(blobToCanvas(blob),blob,uri)}))},fromCanvas=function(canvas,type){return canvasToBlob(canvas,type).then((function(blob){return create$2(Promise$1.resolve(canvas),blob,canvas.toDataURL())}))},clamp=function(value,min,max){var parsedValue="string"==typeof value?parseFloat(value):value;return parsedValue>max?parsedValue=max:parsedValue<min&&(parsedValue=min),parsedValue},DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],multiply=function(matrix1,matrix2){for(var val,col=[],out=new Array(25),i=0;i<5;i++){for(var j=0;j<5;j++)col[j]=matrix2[j+5*i];for(j=0;j<5;j++){val=0;for(var k=0;k<5;k++)val+=matrix1[j+5*k]*col[k];out[j+5*i]=val}}return out},colorFilter=function(ir,matrix){return ir.toCanvas().then((function(canvas){return applyColorFilter(canvas,ir.getType(),matrix)}))},applyColorFilter=function(canvas,type,matrix){var context=get2dContext(canvas),pixels=function(pixelsData,m){for(var r,g,b,a,data=pixelsData.data,m0=m[0],m1=m[1],m2=m[2],m3=m[3],m4=m[4],m5=m[5],m6=m[6],m7=m[7],m8=m[8],m9=m[9],m10=m[10],m11=m[11],m12=m[12],m13=m[13],m14=m[14],m15=m[15],m16=m[16],m17=m[17],m18=m[18],m19=m[19],i=0;i<data.length;i+=4)r=data[i],g=data[i+1],b=data[i+2],a=data[i+3],data[i]=r*m0+g*m1+b*m2+a*m3+m4,data[i+1]=r*m5+g*m6+b*m7+a*m8+m9,data[i+2]=r*m10+g*m11+b*m12+a*m13+m14,data[i+3]=r*m15+g*m16+b*m17+a*m18+m19;return pixelsData}(context.getImageData(0,0,canvas.width,canvas.height),matrix);return context.putImageData(pixels,0,0),fromCanvas(canvas,type)},applyConvoluteFilter=function(canvas,type,matrix){var context=get2dContext(canvas),pixelsIn=context.getImageData(0,0,canvas.width,canvas.height),pixelsOut=context.getImageData(0,0,canvas.width,canvas.height);return pixelsOut=function(pIn,pOut,aMatrix){for(var clamp=function(value,min,max){return value>max?value=max:value<min&&(value=min),value},side=Math.round(Math.sqrt(aMatrix.length)),halfSide=Math.floor(side/2),rgba=pIn.data,drgba=pOut.data,w=pIn.width,h=pIn.height,y=0;y<h;y++)for(var x=0;x<w;x++){for(var r=0,g=0,b=0,cy=0;cy<side;cy++)for(var cx=0;cx<side;cx++){var scx=clamp(x+cx-halfSide,0,w-1),innerOffset=4*(clamp(y+cy-halfSide,0,h-1)*w+scx),wt=aMatrix[cy*side+cx];r+=rgba[innerOffset]*wt,g+=rgba[innerOffset+1]*wt,b+=rgba[innerOffset+2]*wt}var offset=4*(y*w+x);drgba[offset]=clamp(r,0,255),drgba[offset+1]=clamp(g,0,255),drgba[offset+2]=clamp(b,0,255)}return pOut}(pixelsIn,pixelsOut,matrix),context.putImageData(pixelsOut,0,0),fromCanvas(canvas,type)},complexAdjustableColorFilter=function(matrixAdjustFn){return function(ir,adjust){return colorFilter(ir,matrixAdjustFn([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],adjust))}},invert$1=function(matrix){return function(ir){return colorFilter(ir,matrix)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0,0,0,0,0,1]),brightness$1=complexAdjustableColorFilter((function(matrix,value){return value=clamp(255*value,-255,255),multiply(matrix,[1,0,0,0,value,0,1,0,0,value,0,0,1,0,value,0,0,0,1,0,0,0,0,0,1])})),contrast$1=complexAdjustableColorFilter((function(matrix,value){var x;return value=clamp(value,-1,1),x=(value*=100)<0?127+value/100*127:127*(x=0===(x=value%1)?DELTA_INDEX[value]:DELTA_INDEX[Math.floor(value)]*(1-x)+DELTA_INDEX[Math.floor(value)+1]*x)+127,multiply(matrix,[x/127,0,0,0,.5*(127-x),0,x/127,0,0,.5*(127-x),0,0,x/127,0,.5*(127-x),0,0,0,1,0,0,0,0,0,1])})),colorize$1=function(ir,adjustR,adjustG,adjustB){return colorFilter(ir,function(matrix,adjustR,adjustG,adjustB){return adjustR=clamp(adjustR,0,2),adjustG=clamp(adjustG,0,2),adjustB=clamp(adjustB,0,2),multiply(matrix,[adjustR,0,0,0,0,0,adjustG,0,0,0,0,0,adjustB,0,0,0,0,0,1,0,0,0,0,0,1])}([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],adjustR,adjustG,adjustB))},sharpen$1=(kernel=[0,-1,0,-1,5,-1,0,-1,0],function(ir){return function(ir,matrix){return ir.toCanvas().then((function(canvas){return applyConvoluteFilter(canvas,ir.getType(),matrix)}))}(ir,kernel)}),gamma$1=(colorFn=function(color,value){return 255*Math.pow(color/255,1-value)},function(ir,value){return ir.toCanvas().then((function(canvas){return function(canvas,type,value){for(var context=get2dContext(canvas),lookup=new Array(256),i=0;i<lookup.length;i++)lookup[i]=colorFn(i,value);var pixels=function(pixelsData,lookupData){for(var data=pixelsData.data,i=0;i<data.length;i+=4)data[i]=lookupData[data[i]],data[i+1]=lookupData[data[i+1]],data[i+2]=lookupData[data[i+2]];return pixelsData}(context.getImageData(0,0,canvas.width,canvas.height),lookup);return context.putImageData(pixels,0,0),fromCanvas(canvas,type)}(canvas,ir.getType(),value)}))}),scale=function(image,dW,dH){var sW=getWidth$1(image),sH=getHeight$1(image),wRatio=dW/sW,hRatio=dH/sH,scaleCapped=!1;(wRatio<.5||wRatio>2)&&(wRatio=wRatio<.5?.5:2,scaleCapped=!0),(hRatio<.5||hRatio>2)&&(hRatio=hRatio<.5?.5:2,scaleCapped=!0);var scaled=_scale(image,wRatio,hRatio);return scaleCapped?scaled.then((function(tCanvas){return scale(tCanvas,dW,dH)})):scaled},_scale=function(image,wRatio,hRatio){return new Promise$1((function(resolve){var sW=getWidth$1(image),sH=getHeight$1(image),dW=Math.floor(sW*wRatio),dH=Math.floor(sH*hRatio),canvas=create$3(dW,dH);get2dContext(canvas).drawImage(image,0,0,sW,sH,0,0,dW,dH),resolve(canvas)}))},ceilWithPrecision=function(num,precision){void 0===precision&&(precision=2);var mul=Math.pow(10,precision),upper=Math.round(num*mul);return Math.ceil(upper/mul)},applyRotate=function(image,type,angle){var rad=(angle<0?360+angle:angle)*Math.PI/180,width=image.width,height=image.height,sin=Math.sin(rad),cos=Math.cos(rad),newWidth=ceilWithPrecision(Math.abs(width*cos)+Math.abs(height*sin)),newHeight=ceilWithPrecision(Math.abs(width*sin)+Math.abs(height*cos)),canvas=create$3(newWidth,newHeight),context=get2dContext(canvas);return context.translate(newWidth/2,newHeight/2),context.rotate(rad),context.drawImage(image,-width/2,-height/2),fromCanvas(canvas,type)},applyFlip=function(image,type,axis){var canvas=create$3(image.width,image.height),context=get2dContext(canvas);return"v"===axis?(context.scale(1,-1),context.drawImage(image,0,-canvas.height)):(context.scale(-1,1),context.drawImage(image,-canvas.width,0)),fromCanvas(canvas,type)},applyCrop=function(image,type,x,y,w,h){var canvas=create$3(w,h);return get2dContext(canvas).drawImage(image,-x,-y),fromCanvas(canvas,type)},invert=function(ir){return invert$1(ir)},sharpen=function(ir){return sharpen$1(ir)},gamma=function(ir,value){return gamma$1(ir,value)},brightness=function(ir,adjust){return brightness$1(ir,adjust)},contrast=function(ir,adjust){return contrast$1(ir,adjust)},flip=function(ir,axis){return function(ir,axis){return ir.toCanvas().then((function(canvas){return applyFlip(canvas,ir.getType(),axis)}))}(ir,axis)},crop=function(ir,x,y,w,h){return function(ir,x,y,w,h){return ir.toCanvas().then((function(canvas){return applyCrop(canvas,ir.getType(),x,y,w,h)}))}(ir,x,y,w,h)},resize$1=function(ir,w,h){return function(ir,w,h){return ir.toCanvas().then((function(canvas){return scale(canvas,w,h).then((function(newCanvas){return fromCanvas(newCanvas,ir.getType())}))}))}(ir,w,h)},rotate=function(ir,angle){return function(ir,angle){return ir.toCanvas().then((function(canvas){return applyRotate(canvas,ir.getType(),angle)}))}(ir,angle)},renderIcon=function(iconName,iconsProvider,behaviours){return render$3(iconName,{tag:"span",classes:["tox-icon","tox-tbtn__icon-wrap"],behaviours:behaviours},iconsProvider)},renderIconFromPack=function(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[])},renderReplacableIconFromPack=function(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[Replacing.config({})])},renderLabel$1=function(text,prefix,providersBackstage){return{dom:{tag:"span",innerHtml:providersBackstage.translate(text),classes:[prefix+"__select-label"]},behaviours:derive$1([Replacing.config({})])}},internalToolbarButtonExecute=generate$6("toolbar.button.execute"),toolbarButtonEventOrder=((_a={})[execute$5()]=["disabling","alloy.base.behaviour","toggling","toolbar-button-events"],_a),updateMenuText=generate$6("update-menu-text"),updateMenuIcon=generate$6("update-menu-icon"),renderCommonDropdown=function(spec,prefix,sharedBackstage){var editorOffCell=Cell(noop),optMemDisplayText=spec.text.map((function(text){return record(renderLabel$1(text,prefix,sharedBackstage.providers))})),optMemDisplayIcon=spec.icon.map((function(iconName){return record(renderReplacableIconFromPack(iconName,sharedBackstage.providers.icons))})),onLeftOrRightInMenu=function(comp,se){var dropdown=Representing.getValue(comp);return Focusing.focus(dropdown),emitWith(dropdown,"keydown",{raw:se.event.raw}),Dropdown.close(dropdown),Optional.some(!0)},role=spec.role.fold((function(){return{}}),(function(role){return{role:role}})),tooltipAttributes=spec.tooltip.fold((function(){return{}}),(function(tooltip){var translatedTooltip=sharedBackstage.providers.translate(tooltip);return{title:translatedTooltip,"aria-label":translatedTooltip}})),iconSpec=render$3("chevron-down",{tag:"div",classes:[prefix+"__select-chevron"]},sharedBackstage.providers.icons);return record(Dropdown.sketch(__assign(__assign(__assign({},spec.uid?{uid:spec.uid}:{}),role),{dom:{tag:"button",classes:[prefix,prefix+"--select"].concat(map$2(spec.classes,(function(c){return prefix+"--"+c}))),attributes:__assign({},tooltipAttributes)},components:componentRenderPipeline([optMemDisplayIcon.map((function(mem){return mem.asSpec()})),optMemDisplayText.map((function(mem){return mem.asSpec()})),Optional.some(iconSpec)]),matchWidth:!0,useMinWidth:!0,dropdownBehaviours:derive$1(__spreadArray(__spreadArray([],spec.dropdownBehaviours,!0),[DisablingConfigs_button((function(){return spec.disabled||sharedBackstage.providers.isDisabled()})),receivingConfig(),Unselecting.config({}),Replacing.config({}),config("dropdown-events",[onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),config("menubutton-update-display-text",[run$1(updateMenuText,(function(comp,se){optMemDisplayText.bind((function(mem){return mem.getOpt(comp)})).each((function(displayText){Replacing.set(displayText,[text(sharedBackstage.providers.translate(se.event.text))])}))})),run$1(updateMenuIcon,(function(comp,se){optMemDisplayIcon.bind((function(mem){return mem.getOpt(comp)})).each((function(displayIcon){Replacing.set(displayIcon,[renderReplacableIconFromPack(se.event.icon,sharedBackstage.providers.icons)])}))}))])],!1)),eventOrder:deepMerge(toolbarButtonEventOrder,{mousedown:["focusing","alloy.base.behaviour","item-type-events","normal-dropdown-events"]}),sandboxBehaviours:derive$1([Keying.config({mode:"special",onLeft:onLeftOrRightInMenu,onRight:onLeftOrRightInMenu})]),lazySink:sharedBackstage.getSink,toggleClass:prefix+"--active",parts:{menu:part(0,spec.columns,spec.presets)},fetch:function(comp){return Future_nu(curry(spec.fetch,comp))}}))).asSpec()},isSeparator$1=function(item){return"separator"===item.type},separator$2={type:"separator"},unwrapReferences=function(items,menuItems){var realItems=foldl(items,(function(acc,item){return function(item){return isString(item)}(item)?""===item?acc:"|"===item?acc.length>0&&!isSeparator$1(acc[acc.length-1])?acc.concat([separator$2]):acc:has$2(menuItems,item.toLowerCase())?acc.concat([menuItems[item.toLowerCase()]]):acc:acc.concat([item])}),[]);return realItems.length>0&&isSeparator$1(realItems[realItems.length-1])&&realItems.pop(),realItems},getFromItem=function(item,menuItems){return function(item){return has$2(item,"getSubmenuItems")}(item)?function(item,menuItems){var submenuItems=item.getSubmenuItems(),rest=expand(submenuItems,menuItems);return{item:item,menus:deepMerge(rest.menus,wrap$1(item.value,rest.items)),expansions:deepMerge(rest.expansions,wrap$1(item.value,item.value))}}(item,menuItems):{item:item,menus:{},expansions:{}}},expand=function(items,menuItems){var realItems=unwrapReferences(isString(items)?items.split(" "):items,menuItems);return foldr(realItems,(function(acc,item){var itemWithValue=function(item){if(isSeparator$1(item))return item;var itemValue=get$e(item,"value").getOrThunk((function(){return generate$6("generated-menu-item")}));return deepMerge({value:itemValue},item)}(item),newData=getFromItem(itemWithValue,menuItems);return{menus:deepMerge(acc.menus,newData.menus),items:[newData.item].concat(acc.items),expansions:deepMerge(acc.expansions,newData.expansions)}}),{menus:{},expansions:{},items:[]})},build=function(items,itemResponse,backstage,isHorizontalMenu){var primary=generate$6("primary-menu"),data=expand(items,backstage.shared.providers.menuItems());if(0===data.items.length)return Optional.none();var mainMenu=createPartialMenu(primary,data.items,itemResponse,backstage,isHorizontalMenu),submenus=map$1(data.menus,(function(menuItems,menuName){return createPartialMenu(menuName,menuItems,itemResponse,backstage,!1)})),menus=deepMerge(submenus,wrap$1(primary,mainMenu));return Optional.from(tieredMenu.tieredData(primary,menus,data.expansions))},getMenuButtonApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)},setActive:function(state){var elm=component.element;state?(add$2(elm,"tox-tbtn--enabled"),set$8(elm,"aria-pressed",!0)):(remove$2(elm,"tox-tbtn--enabled"),remove$7(elm,"aria-pressed"))},isActive:function(){return has(component.element,"tox-tbtn--enabled")}}},renderMenuButton=function(spec,prefix,backstage,role){return renderCommonDropdown({text:spec.text,icon:spec.icon,tooltip:spec.tooltip,role:role,fetch:function(_comp,callback){spec.fetch((function(items){callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))}))},onSetup:spec.onSetup,getApi:getMenuButtonApi,columns:1,presets:"normal",classes:[],dropdownBehaviours:[Tabstopping.config({})]},prefix,backstage.shared)},getFetch=function(items,getButton,backstage){var getMenuItemAction=function(item){return function(api){var newValue=!api.isActive();api.setActive(newValue),item.storage.set(newValue),backstage.shared.getSink().each((function(sink){getButton().getOpt(sink).each((function(orig){focus$3(orig.element),emitWith(orig,formActionEvent,{name:item.name,value:item.storage.get()})}))}))}},getMenuItemSetup=function(item){return function(api){api.setActive(item.storage.get())}};return function(success){success(map$2(items,(function(item){var text=item.text.fold((function(){return{}}),(function(text){return{text:text}}));return __assign(__assign({type:item.type,active:!1},text),{onAction:getMenuItemAction(item),onSetup:getMenuItemSetup(item)})})))}},renderCommonSpec=function(spec,actionOpt,extraBehaviours,dom,components,providersBackstage){void 0===extraBehaviours&&(extraBehaviours=[]);var action=actionOpt.fold((function(){return{}}),(function(action){return{action:action}})),common=__assign({buttonBehaviours:derive$1([DisablingConfigs_button((function(){return spec.disabled||providersBackstage.isDisabled()})),receivingConfig(),Tabstopping.config({}),config("button press",[preventDefault("click"),preventDefault("mousedown")])].concat(extraBehaviours)),eventOrder:{click:["button press","alloy.base.behaviour"],mousedown:["button press","alloy.base.behaviour"]}},action),domFinal=deepMerge(common,{dom:dom});return deepMerge(domFinal,{components:components})},renderIconButtonSpec=function(spec,action,providersBackstage,extraBehaviours){void 0===extraBehaviours&&(extraBehaviours=[]);var dom={tag:"button",classes:["tox-tbtn"],attributes:spec.tooltip.map((function(tooltip){return{"aria-label":providersBackstage.translate(tooltip),title:providersBackstage.translate(tooltip)}})).getOr({})},icon=spec.icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})),components=componentRenderPipeline([icon]);return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage)},renderIconButton=function(spec,action,providersBackstage,extraBehaviours){void 0===extraBehaviours&&(extraBehaviours=[]);var iconButtonSpec=renderIconButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours);return Button.sketch(iconButtonSpec)},renderButtonSpec=function(spec,action,providersBackstage,extraBehaviours,extraClasses){void 0===extraBehaviours&&(extraBehaviours=[]),void 0===extraClasses&&(extraClasses=[]);var translatedText=providersBackstage.translate(spec.text),icon=spec.icon?spec.icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})):Optional.none(),components=icon.isSome()?componentRenderPipeline([icon]):[],innerHtml=icon.isSome()?{}:{innerHtml:translatedText},classes=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],spec.primary||spec.borderless?["tox-button"]:["tox-button","tox-button--secondary"],!0),icon.isSome()?["tox-button--icon"]:[],!0),spec.borderless?["tox-button--naked"]:[],!0),extraClasses,!0),dom=__assign(__assign({tag:"button",classes:classes},innerHtml),{attributes:{title:translatedText}});return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage)},renderButton=function(spec,action,providersBackstage,extraBehaviours,extraClasses){void 0===extraBehaviours&&(extraBehaviours=[]),void 0===extraClasses&&(extraClasses=[]);var buttonSpec=renderButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours,extraClasses);return Button.sketch(buttonSpec)},getAction=function(name,buttonType){return function(comp){"custom"===buttonType?emitWith(comp,formActionEvent,{name:name,value:{}}):"submit"===buttonType?emit(comp,formSubmitEvent):"cancel"===buttonType?emit(comp,formCancelEvent):console.error("Unknown button type: ",buttonType)}},renderFooterButton=function(spec,buttonType,backstage){if(function(spec,buttonType){return"menu"===buttonType}(0,buttonType)){var menuButtonSpec=spec,fixedSpec=__assign(__assign({},spec),{onSetup:function(api){return api.setDisabled(spec.disabled),noop},fetch:getFetch(menuButtonSpec.items,(function(){return memButton_1}),backstage)}),memButton_1=record(renderMenuButton(fixedSpec,"tox-tbtn",backstage,Optional.none()));return memButton_1.asSpec()}if(function(spec,buttonType){return"custom"===buttonType||"cancel"===buttonType||"submit"===buttonType}(0,buttonType)){var action=getAction(spec.name,buttonType),buttonSpec=__assign(__assign({},spec),{borderless:!1});return renderButton(buttonSpec,action,backstage.shared.providers,[])}console.error("Unknown footer button type: ",buttonType)},renderDialogButton=function(spec,providersBackstage){var pLabel,pField,action=getAction(spec.name,"custom");return pLabel=Optional.none(),pField=FormField.parts.field(__assign({factory:Button},renderButtonSpec(spec,Optional.some(action),providersBackstage,[RepresentingConfigs_memory(""),ComposingConfigs_self()]))),renderFormFieldWith(pLabel,pField,[],[])},schema$h=constant$1([defaulted("field1Name","field1"),defaulted("field2Name","field2"),onStrictHandler("onLockedChange"),markers$1(["lockClass"]),defaulted("locked",!1),SketchBehaviours_field("coupledFieldBehaviours",[Composing,Representing])]),coupledPart=function(selfName,otherName){return required({factory:FormField,name:selfName,overrides:function(detail){return{fieldBehaviours:derive$1([config("coupled-input-behaviour",[run$1(input(),(function(me){(function(comp,detail,partName){return getPart(comp,detail,partName).bind(Composing.getCurrent)})(me,detail,otherName).each((function(other){getPart(me,detail,"lock").each((function(lock){Toggling.isOn(lock)&&detail.onLockedChange(me,other,lock)}))}))}))])])}}})},parts$c=constant$1([coupledPart("field1","field2"),coupledPart("field2","field1"),required({factory:Button,schema:[required$1("dom")],name:"lock",overrides:function(detail){return{buttonBehaviours:derive$1([Toggling.config({selected:detail.locked,toggleClass:detail.markers.lockClass,aria:{mode:"pressed"}})])}}})]),FormCoupledInputs=composite({name:"FormCoupledInputs",configFields:schema$h(),partFields:parts$c(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:SketchBehaviours_augment(detail.coupledFieldBehaviours,[Composing.config({find:Optional.some}),Representing.config({store:{mode:"manual",getValue:function(comp){var _a,parts=getPartsOrDie(comp,detail,["field1","field2"]);return(_a={})[detail.field1Name]=Representing.getValue(parts.field1()),_a[detail.field2Name]=Representing.getValue(parts.field2()),_a},setValue:function(comp,value){var parts=getPartsOrDie(comp,detail,["field1","field2"]);hasNonNullableKey(value,detail.field1Name)&&Representing.setValue(parts.field1(),value[detail.field1Name]),hasNonNullableKey(value,detail.field2Name)&&Representing.setValue(parts.field2(),value[detail.field2Name])}}})]),apis:{getField1:function(component){return getPart(component,detail,"field1")},getField2:function(component){return getPart(component,detail,"field2")},getLock:function(component){return getPart(component,detail,"lock")}}}},apis:{getField1:function(apis,component){return apis.getField1(component)},getField2:function(apis,component){return apis.getField2(component)},getLock:function(apis,component){return apis.getLock(component)}}}),parseSize=function(sizeText){var match=/^\s*(\d+(?:\.\d+)?)\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\s*$/.exec(sizeText);if(null!==match){var value=parseFloat(match[1]),unit=match[2];return Result.value({value:value,unit:unit})}return Result.error(sizeText)},convertUnit=function(size,unit){var inInch={"":96,px:96,pt:72,cm:2.54,pc:12,mm:25.4,in:1},supported=function(u){return has$2(inInch,u)};return size.unit===unit?Optional.some(size.value):supported(size.unit)&&supported(unit)?inInch[size.unit]===inInch[unit]?Optional.some(size.value):Optional.some(size.value/inInch[size.unit]*inInch[unit]):Optional.none()},noSizeConversion=function(_input){return Optional.none()},makeRatioConverter=function(currentFieldText,otherFieldText){var cValue=parseSize(currentFieldText).toOptional(),oValue=parseSize(otherFieldText).toOptional();return lift2(cValue,oValue,(function(cSize,oSize){return convertUnit(cSize,oSize.unit).map((function(val){return oSize.value/val})).map((function(r){return function(scale,unit){return function(size){return convertUnit(size,unit).map((function(value){return{value:value*scale,unit:unit}}))}}(r,oSize.unit)})).getOr(noSizeConversion)})).getOr(noSizeConversion)},renderSizeInput=function(spec,providersBackstage){var converter=noSizeConversion,ratioEvent=generate$6("ratio-event"),makeIcon=function(iconName){return render$3(iconName,{tag:"span",classes:["tox-icon","tox-lock-icon__"+iconName]},providersBackstage.icons)},pLock=FormCoupledInputs.parts.lock({dom:{tag:"button",classes:["tox-lock","tox-button","tox-button--naked","tox-button--icon"],attributes:{title:providersBackstage.translate(spec.label.getOr("Constrain proportions"))}},components:[makeIcon("lock"),makeIcon("unlock")],buttonBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Tabstopping.config({})])}),formGroup=function(components){return{dom:{tag:"div",classes:["tox-form__group"]},components:components}},getFieldPart=function(isField1){return FormField.parts.field({factory:Input,inputClasses:["tox-textfield"],inputBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Tabstopping.config({}),config("size-input-events",[run$1(focusin(),(function(component,_simulatedEvent){emitWith(component,ratioEvent,{isField1:isField1})})),run$1(change(),(function(component,_simulatedEvent){emitWith(component,formChangeEvent,{name:spec.name})}))])]),selectOnFocus:!1})},getLabel=function(label){return{dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}}},widthField=FormCoupledInputs.parts.field1(formGroup([FormField.parts.label(getLabel("Width")),getFieldPart(!0)])),heightField=FormCoupledInputs.parts.field2(formGroup([FormField.parts.label(getLabel("Height")),getFieldPart(!1)]));return FormCoupledInputs.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:[{dom:{tag:"div",classes:["tox-form__controls-h-stack"]},components:[widthField,heightField,formGroup([getLabel("&nbsp;"),pLock])]}],field1Name:"width",field2Name:"height",locked:!0,markers:{lockClass:"tox-locked"},onLockedChange:function(current,other,_lock){parseSize(Representing.getValue(current)).each((function(size){converter(size).each((function(newSize){Representing.setValue(other,function(size){var unit,unitDec={"":0,px:0,pt:1,mm:1,pc:2,ex:2,em:2,ch:2,rem:2,cm:3,in:4,"%":4},numText=size.value.toFixed((unit=size.unit)in unitDec?unitDec[unit]:1);return-1!==numText.indexOf(".")&&(numText=numText.replace(/\.?0*$/,"")),numText+size.unit}(newSize))}))}))},coupledFieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.disable),FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.disable),FormCoupledInputs.getLock(comp).each(Disabling.disable)},onEnabled:function(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.enable),FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.enable),FormCoupledInputs.getLock(comp).each(Disabling.enable)}}),receivingConfig(),config("size-input-events2",[run$1(ratioEvent,(function(component,simulatedEvent){var isField1=simulatedEvent.event.isField1,optCurrent=isField1?FormCoupledInputs.getField1(component):FormCoupledInputs.getField2(component),optOther=isField1?FormCoupledInputs.getField2(component):FormCoupledInputs.getField1(component),value1=optCurrent.map(Representing.getValue).getOr(""),value2=optOther.map(Representing.getValue).getOr("");converter=makeRatioConverter(value1,value2)}))])])})},internal={undo:constant$1(generate$6("undo")),redo:constant$1(generate$6("redo")),zoom:constant$1(generate$6("zoom")),back:constant$1(generate$6("back")),apply:constant$1(generate$6("apply")),swap:constant$1(generate$6("swap")),transform:constant$1(generate$6("transform")),tempTransform:constant$1(generate$6("temp-transform")),transformApply:constant$1(generate$6("transform-apply"))},saveState=constant$1("save-state"),disable=constant$1("disable"),enable=constant$1("enable"),external={formActionEvent:formActionEvent,saveState:saveState,disable:disable,enable:enable},renderEditPanel=function(imagePanel,providersBackstage){var createButton=function(text,action,disabled,primary){return record(renderButton({name:text,text:text,disabled:disabled,primary:primary,icon:Optional.none(),borderless:!1},action,providersBackstage))},createIconButton=function(icon,tooltip,action,disabled){return record(renderIconButton({name:icon,icon:Optional.some(icon),tooltip:Optional.some(tooltip),disabled:disabled,primary:!1,borderless:!1},action,providersBackstage))},disableAllComponents=function(comps,eventcomp){comps.map((function(mem){var component=mem.get(eventcomp);component.hasConfigured(Disabling)&&Disabling.disable(component)}))},enableAllComponents=function(comps,eventcomp){comps.map((function(mem){var component=mem.get(eventcomp);component.hasConfigured(Disabling)&&Disabling.enable(component)}))},panelDom={tag:"div",classes:["tox-image-tools__toolbar","tox-image-tools-edit-panel"]},noop$1=noop,emit$1=function(comp,event,data){emitWith(comp,event,data)},emitDisable=function(component){return emit(component,external.disable())},emitEnable=function(component){return emit(component,external.enable())},emitTransform=function(comp,transform){emitDisable(comp),emit$1(comp,internal.transform(),{transform:transform}),emitEnable(comp)},getBackSwap=function(anyInSystem){return function(){memContainer.getOpt(anyInSystem).each((function(container){Replacing.set(container,[ButtonPanel])}))}},emitTransformApply=function(comp,transform){emitDisable(comp),emit$1(comp,internal.transformApply(),{transform:transform,swap:getBackSwap(comp)}),emitEnable(comp)},createBackButton=function(){return createButton("Back",(function(button){return emit$1(button,internal.back(),{swap:getBackSwap(button)})}),!1,!1)},createSpacer=function(){return record({dom:{tag:"div",classes:["tox-spacer"]},behaviours:derive$1([Disabling.config({})])})},createApplyButton=function(){return createButton("Apply",(function(button){return emit$1(button,internal.apply(),{swap:getBackSwap(button)})}),!0,!0)},cropPanelComponents=[createBackButton(),createSpacer(),createButton("Apply",(function(button){emitTransformApply(button,(function(ir){var rect=imagePanel.getRect();return crop(ir,rect.x,rect.y,rect.w,rect.h)})),imagePanel.hideCrop()}),!1,!0)],CropPanel=Container.sketch({dom:panelDom,components:cropPanelComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-crop-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(cropPanelComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(cropPanelComponents,comp)}))])])}),memSize=record(renderSizeInput({name:"size",label:Optional.none(),constrain:!0,disabled:!1},providersBackstage)),resizePanelComponents=[createBackButton(),createSpacer(),memSize,createSpacer(),createButton("Apply",(function(button){memSize.getOpt(button).each((function(sizeInput){var value=Representing.getValue(sizeInput),transform=function(width,height){return function(ir){return resize$1(ir,width,height)}}(parseInt(value.width,10),parseInt(value.height,10));emitTransformApply(button,transform)}))}),!1,!0)],ResizePanel=Container.sketch({dom:panelDom,components:resizePanelComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-resize-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(resizePanelComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(resizePanelComponents,comp)}))])])}),makeValueTransform=function(transform,value){return function(ir){return transform(ir,value)}},horizontalFlip=makeValueTransform(flip,"h"),verticalFlip=makeValueTransform(flip,"v"),counterclockwiseRotate=makeValueTransform(rotate,-90),clockwiseRotate=makeValueTransform(rotate,90),flipRotateOnAction=function(comp,operation){!function(comp,transform){emitDisable(comp),emit$1(comp,internal.tempTransform(),{transform:transform}),emitEnable(comp)}(comp,operation)},flipRotateComponents=[createBackButton(),createSpacer(),createIconButton("flip-horizontally","Flip horizontally",(function(button){flipRotateOnAction(button,horizontalFlip)}),!1),createIconButton("flip-vertically","Flip vertically",(function(button){flipRotateOnAction(button,verticalFlip)}),!1),createIconButton("rotate-left","Rotate counterclockwise",(function(button){flipRotateOnAction(button,counterclockwiseRotate)}),!1),createIconButton("rotate-right","Rotate clockwise",(function(button){flipRotateOnAction(button,clockwiseRotate)}),!1),createSpacer(),createApplyButton()],FlipRotatePanel=Container.sketch({dom:panelDom,components:flipRotateComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-fliprotate-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(flipRotateComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(flipRotateComponents,comp)}))])])}),makeSlider=function(label,onChoose,min,value,max){var labelPart=Slider.parts.label({dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}}),spectrum=Slider.parts.spectrum({dom:{tag:"div",classes:["tox-slider__rail"],attributes:{role:"presentation"}}}),thumb=Slider.parts.thumb({dom:{tag:"div",classes:["tox-slider__handle"],attributes:{role:"presentation"}}});return record(Slider.sketch({dom:{tag:"div",classes:["tox-slider"],attributes:{role:"presentation"}},model:{mode:"x",minX:min,maxX:max,getInitialValue:constant$1({x:value})},components:[labelPart,spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChoose:onChoose}))},makeVariableSlider=function(label,transform,min,value,max){return makeSlider(label,(function(slider,_thumb,value){var valTransform=makeValueTransform(transform,value.x/100);emitTransform(slider,valTransform)}),min,value,max)},createVariableFilterPanel=function(label,transform,min,value,max){var filterPanelComponents=function(label,transform,min,value,max){return[createBackButton(),makeVariableSlider(label,transform,min,value,max),createApplyButton()]}(label,transform,min,value,max);return Container.sketch({dom:panelDom,components:filterPanelComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-filter-panel-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(filterPanelComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(filterPanelComponents,comp)}))])])})},filterPanelComponents=[createBackButton(),createSpacer(),createApplyButton()],FilterPanel=Container.sketch({dom:panelDom,components:filterPanelComponents.map((function(mem){return mem.asSpec()}))}),BrightnessPanel=createVariableFilterPanel("Brightness",brightness,-100,0,100),ContrastPanel=createVariableFilterPanel("Contrast",contrast,-100,0,100),GammaPanel=createVariableFilterPanel("Gamma",gamma,-100,0,100),makeColorTransform=function(red,green,blue){return function(ir){return function(ir,adjustR,adjustG,adjustB){return colorize$1(ir,adjustR,adjustG,adjustB)}(ir,red,green,blue)}},makeColorSlider=function(label){return makeSlider(label,(function(slider,_thumb,_value){var redOpt=memRed.getOpt(slider),blueOpt=memBlue.getOpt(slider),greenOpt=memGreen.getOpt(slider);redOpt.each((function(red){blueOpt.each((function(blue){greenOpt.each((function(green){var r=Representing.getValue(red).x/100,g=Representing.getValue(green).x/100,b=Representing.getValue(blue).x/100,transform=makeColorTransform(r,g,b);emitTransform(slider,transform)}))}))}))}),0,100,200)},memRed=makeColorSlider("R"),memGreen=makeColorSlider("G"),memBlue=makeColorSlider("B"),colorizePanelComponents=[createBackButton(),memRed,memGreen,memBlue,createApplyButton()],ColorizePanel=Container.sketch({dom:panelDom,components:colorizePanelComponents.map((function(mem){return mem.asSpec()}))}),getTransformPanelEvent=function(panel,transform,update){return function(button){emit$1(button,internal.swap(),{transform:transform,swap:function(){memContainer.getOpt(button).each((function(container){Replacing.set(container,[panel]),update(container)}))}})}},sharpenTransform=Optional.some(sharpen),invertTransform=Optional.some(invert),buttonPanelComponents=[createIconButton("crop","Crop",getTransformPanelEvent(CropPanel,Optional.none(),(function(_anyInSystem){imagePanel.showCrop()})),!1),createIconButton("resize","Resize",getTransformPanelEvent(ResizePanel,Optional.none(),(function(anyInSystem){memSize.getOpt(anyInSystem).each((function(sizeInput){var measurements=imagePanel.getMeasurements(),width=measurements.width,height=measurements.height;Representing.setValue(sizeInput,{width:width,height:height})}))})),!1),createIconButton("orientation","Orientation",getTransformPanelEvent(FlipRotatePanel,Optional.none(),noop$1),!1),createIconButton("brightness","Brightness",getTransformPanelEvent(BrightnessPanel,Optional.none(),noop$1),!1),createIconButton("sharpen","Sharpen",getTransformPanelEvent(FilterPanel,sharpenTransform,noop$1),!1),createIconButton("contrast","Contrast",getTransformPanelEvent(ContrastPanel,Optional.none(),noop$1),!1),createIconButton("color-levels","Color levels",getTransformPanelEvent(ColorizePanel,Optional.none(),noop$1),!1),createIconButton("gamma","Gamma",getTransformPanelEvent(GammaPanel,Optional.none(),noop$1),!1),createIconButton("invert","Invert",getTransformPanelEvent(FilterPanel,invertTransform,noop$1),!1)],ButtonPanel=Container.sketch({dom:panelDom,components:buttonPanelComponents.map((function(mem){return mem.asSpec()}))}),container=Container.sketch({dom:{tag:"div"},components:[ButtonPanel],containerBehaviours:derive$1([Replacing.config({})])}),memContainer=record(container);return{memContainer:memContainer,getApplyButton:function(anyInSystem){return memContainer.getOpt(anyInSystem).map((function(container){var panel=container.components()[0];return panel.components()[panel.components().length-1]}))}}},global$4=tinymce.util.Tools.resolve("tinymce.geom.Rect"),global$3=tinymce.util.Tools.resolve("tinymce.util.Observable"),global$2=tinymce.util.Tools.resolve("tinymce.util.VK"),updateWithTouchData=function(e){if(function(e){return isNonNullable(e.changedTouches)}(e))for(var keys="screenX screenY pageX pageY clientX clientY".split(" "),i=0;i<keys.length;i++)e[keys[i]]=e.changedTouches[0][keys[i]]};function DragHelper(id,settings){var _a,_b,_c,eventOverlay,downButton,startX,startY,handleEvents=[],overlayEvents=[],doc=null!==(_a=settings.document)&&void 0!==_a?_a:document,root=null!==(_b=settings.root)&&void 0!==_b?_b:doc,sugarDoc=SugarElement.fromDom(doc),handleElement=SugarElement.fromDom(root.getElementById(null!==(_c=settings.handle)&&void 0!==_c?_c:id)),start=function(e){var rawEvent=e.raw,docSize=function(doc){var max=Math.max,documentElement=doc.documentElement,body=doc.body,scrollWidth=max(documentElement.scrollWidth,body.scrollWidth),clientWidth=max(documentElement.clientWidth,body.clientWidth),offsetWidth=max(documentElement.offsetWidth,body.offsetWidth),scrollHeight=max(documentElement.scrollHeight,body.scrollHeight),clientHeight=max(documentElement.clientHeight,body.clientHeight);return{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<max(documentElement.offsetHeight,body.offsetHeight)?clientHeight:scrollHeight}}(doc);updateWithTouchData(rawEvent),e.prevent(),downButton=rawEvent.button,startX=rawEvent.screenX,startY=rawEvent.screenY;var cursor=get$c(handleElement,"cursor");eventOverlay=SugarElement.fromTag("div",doc),setAll(eventOverlay,{position:"absolute",top:"0",left:"0",width:docSize.width+"px",height:docSize.height+"px","z-index":"2147483647",opacity:"0.0001",cursor:cursor}),append$2(getBody(sugarDoc),eventOverlay),overlayEvents.push(bind(sugarDoc,"mousemove",drag),bind(sugarDoc,"touchmove",drag),bind(sugarDoc,"mouseup",stop),bind(sugarDoc,"touchend",stop)),settings.start(rawEvent)},drag=function(e){var rawEvent=e.raw;if(updateWithTouchData(rawEvent),rawEvent.button!==downButton)return stop(e);rawEvent.deltaX=rawEvent.screenX-startX,rawEvent.deltaY=rawEvent.screenY-startY,e.prevent(),settings.drag(rawEvent)},stop=function(e){updateWithTouchData(e.raw),each$1(overlayEvents,(function(e){return e.unbind()})),overlayEvents=[],remove$5(eventOverlay),settings.stop&&settings.stop(e.raw)};return handleEvents.push(bind(handleElement,"mousedown",start),bind(handleElement,"touchstart",start)),{destroy:function(){each$1(overlayEvents.concat(handleEvents),(function(e){return e.unbind()})),overlayEvents=[],handleEvents=[],isNonNullable(eventOverlay)&&remove$5(eventOverlay)}}}var count=0,CropRect_create=function(currentRect,viewPortRect,clampRect,containerElm,action){var dragHelpers,events=[],id="tox-crid-"+count++,container=SugarElement.fromDom(containerElm),handles=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],blockers=["top","right","bottom","left"],getRelativeRect=function(outerRect,innerRect){return{x:innerRect.x-outerRect.x,y:innerRect.y-outerRect.y,w:innerRect.w,h:innerRect.h}},moveRect=function(handle,startRect,deltaX,deltaY){var x=startRect.x+deltaX*handle.deltaX,y=startRect.y+deltaY*handle.deltaY,w=Math.max(20,startRect.w+deltaX*handle.deltaW),h=Math.max(20,startRect.h+deltaY*handle.deltaH),rect=currentRect=global$4.clamp({x:x,y:y,w:w,h:h},clampRect,"move"===handle.name);rect=getRelativeRect(clampRect,rect),instance.fire("updateRect",{rect:rect}),setInnerRect(rect)},repaint=function(rect){var updateElementRect=function(name,newRect){descendant(container,"#"+id+"-"+name).each((function(elm){setAll(elm,{left:newRect.x+"px",top:newRect.y+"px",width:Math.max(0,newRect.w)+"px",height:Math.max(0,newRect.h)+"px"})}))};each$1(handles,(function(handle){descendant(container,"#"+id+"-"+handle.name).each((function(elm){setAll(elm,{left:rect.w*handle.xMul+rect.x+"px",top:rect.h*handle.yMul+rect.y+"px"})}))})),updateElementRect("top",{x:viewPortRect.x,y:viewPortRect.y,w:viewPortRect.w,h:rect.y-viewPortRect.y}),updateElementRect("right",{x:rect.x+rect.w,y:rect.y,w:viewPortRect.w-rect.x-rect.w+viewPortRect.x,h:rect.h}),updateElementRect("bottom",{x:viewPortRect.x,y:rect.y+rect.h,w:viewPortRect.w,h:viewPortRect.h-rect.y-rect.h+viewPortRect.y}),updateElementRect("left",{x:viewPortRect.x,y:rect.y,w:rect.x-viewPortRect.x,h:rect.h}),updateElementRect("move",rect)},setRect=function(rect){repaint(currentRect=rect)},setInnerRect=function(rect){var outerRect,relativeRect;setRect((outerRect=clampRect,{x:(relativeRect=rect).x+outerRect.x,y:relativeRect.y+outerRect.y,w:relativeRect.w,h:relativeRect.h}))};!function(){var cropContainer=SugarElement.fromTag("div");setAll$1(cropContainer,{id:id,class:"tox-croprect-container",role:"grid","aria-dropeffect":"execute"}),append$2(container,cropContainer),each$1(blockers,(function(blocker){descendant(container,"#"+id).each((function(blockerElm){var cropBlocker=SugarElement.fromTag("div");setAll$1(cropBlocker,{id:id+"-"+blocker,class:"tox-croprect-block","data-mce-bogus":"all"}),set$7(cropBlocker,"display","none"),append$2(blockerElm,cropBlocker)}))})),each$1(handles,(function(handle){descendant(container,"#"+id).each((function(handleElm){var cropHandle=SugarElement.fromTag("div");setAll$1(cropHandle,{id:id+"-"+handle.name,"aria-label":handle.label,"aria-grabbed":"false","data-mce-bogus":"all",role:"gridcell",tabindex:"-1",title:handle.label}),add$1(cropHandle,["tox-croprect-handle","tox-croprect-handle-"+handle.name]),set$7(cropHandle,"display","none"),append$2(handleElm,cropHandle)}))})),dragHelpers=map$2(handles,(function(handle){var startRect;return DragHelper(id,{document:containerElm.ownerDocument,root:getRootNode(container).dom,handle:id+"-"+handle.name,start:function(){startRect=currentRect},drag:function(e){moveRect(handle,startRect,e.deltaX,e.deltaY)}})})),repaint(currentRect);var handleFocus=function(e){set$8(e.target,"aria-grabbed","focus"===e.raw.type?"true":"false")};events.push(bind(container,"focusin",handleFocus),bind(container,"focusout",handleFocus),bind(container,"keydown",(function(e){var activeHandle;each$1(handles,(function(handle){if(get$d(e.target,"id")===id+"-"+handle.name)return activeHandle=handle,!1}));var moveAndBlock=function(evt,handle,startRect,deltaX,deltaY){evt.stopPropagation(),evt.preventDefault(),moveRect(activeHandle,startRect,deltaX,deltaY)};switch(e.raw.keyCode){case global$2.LEFT:moveAndBlock(e,0,currentRect,-10,0);break;case global$2.RIGHT:moveAndBlock(e,0,currentRect,10,0);break;case global$2.UP:moveAndBlock(e,0,currentRect,0,-10);break;case global$2.DOWN:moveAndBlock(e,0,currentRect,0,10);break;case global$2.ENTER:case global$2.SPACEBAR:e.prevent(),action()}})))}();var instance=__assign(__assign({},global$3),{toggleVisibility:function(state){var selectors=__spreadArray(__spreadArray([],map$2(handles,(function(handle){return"#"+id+"-"+handle.name})),!0),map$2(blockers,(function(blocker){return"#"+id+"-"+blocker})),!0).join(","),elems=descendants(container,selectors);each$1(elems,state?function(elm){return remove$6(elm,"display")}:function(elm){return set$7(elm,"display","none")})},setClampRect:function(rect){clampRect=rect,repaint(currentRect)},setRect:setRect,getInnerRect:function(){return getRelativeRect(clampRect,currentRect)},setInnerRect:setInnerRect,setViewPortRect:function(rect){viewPortRect=rect,repaint(currentRect)},destroy:function(){each$1(dragHelpers,(function(helper){return helper.destroy()})),dragHelpers=[],each$1(events,(function(e){return e.unbind()})),events=[]}});return instance},renderImagePanel=function(initialUrl){var subject,memBg=record({dom:{tag:"div",classes:["tox-image-tools__image-bg"],attributes:{role:"presentation"}}}),zoomState=Cell(1),cropRect=(subject=destroyable(),__assign(__assign({},subject),{run:function(f){return subject.get().each(f)}})),rectState=Cell({x:0,y:0,w:1,h:1}),viewRectState=Cell({x:0,y:0,w:1,h:1}),repaintImg=function(anyInSystem,img){memContainer.getOpt(anyInSystem).each((function(panel){var zoom=zoomState.get(),panelW=get$a(panel.element),panelH=get$b(panel.element),width=img.dom.naturalWidth*zoom,height=img.dom.naturalHeight*zoom,left=Math.max(0,panelW/2-width/2),top=Math.max(0,panelH/2-height/2),css={left:left.toString()+"px",top:top.toString()+"px",width:width.toString()+"px",height:height.toString()+"px",position:"absolute"};setAll(img,css),memBg.getOpt(panel).each((function(bg){setAll(bg.element,css)})),cropRect.run((function(cRect){var rect=rectState.get();cRect.setRect({x:rect.x*zoom+left,y:rect.y*zoom+top,w:rect.w*zoom,h:rect.h*zoom}),cRect.setClampRect({x:left,y:top,w:width,h:height}),cRect.setViewPortRect({x:0,y:0,w:panelW,h:panelH})}))}))},updateSrc=function(anyInSystem,url){var image,img=SugarElement.fromTag("img");return set$8(img,"src",url),(image=img.dom,new global$c((function(resolve){var loaded=function(){image.removeEventListener("load",loaded),resolve(image)};image.complete?resolve(image):image.addEventListener("load",loaded)}))).then((function(){anyInSystem.getSystem().isConnected()&&memContainer.getOpt(anyInSystem).map((function(panel){var aImg=external$2({element:img});Replacing.replaceAt(panel,1,Optional.some(aImg));var lastViewRect=viewRectState.get(),viewRect={x:0,y:0,w:img.dom.naturalWidth,h:img.dom.naturalHeight};viewRectState.set(viewRect);var rect=global$4.inflate(viewRect,-20,-20);rectState.set(rect),lastViewRect.w===viewRect.w&&lastViewRect.h===viewRect.h||function(anyInSystem,img){memContainer.getOpt(anyInSystem).each((function(panel){var panelW=get$a(panel.element),panelH=get$b(panel.element),width=img.dom.naturalWidth,height=img.dom.naturalHeight,zoom=Math.min(panelW/width,panelH/height);zoom>=1?zoomState.set(1):zoomState.set(zoom)}))}(panel,img),repaintImg(panel,img)}))}))},container=Container.sketch({dom:{tag:"div",classes:["tox-image-tools__image"]},components:[memBg.asSpec(),{dom:{tag:"img",attributes:{src:initialUrl}}},{dom:{tag:"div"},behaviours:derive$1([config("image-panel-crop-events",[runOnAttached((function(comp){memContainer.getOpt(comp).each((function(container){var el=container.element.dom,cRect=CropRect_create({x:10,y:10,w:100,h:100},{x:0,y:0,w:200,h:200},{x:0,y:0,w:200,h:200},el,noop);cRect.toggleVisibility(!1),cRect.on("updateRect",(function(e){var rect=e.rect,zoom=zoomState.get(),newRect={x:Math.round(rect.x/zoom),y:Math.round(rect.y/zoom),w:Math.round(rect.w/zoom),h:Math.round(rect.h/zoom)};rectState.set(newRect)})),cropRect.set(cRect)}))})),runOnDetached((function(){cropRect.clear()}))])])}],containerBehaviours:derive$1([Replacing.config({}),config("image-panel-events",[runOnAttached((function(comp){updateSrc(comp,initialUrl)}))])])}),memContainer=record(container);return{memContainer:memContainer,updateSrc:updateSrc,zoom:function(anyInSystem,direction){var currentZoom=zoomState.get(),newZoom=direction>0?Math.min(2,currentZoom+.1):Math.max(.1,currentZoom-.1);zoomState.set(newZoom),memContainer.getOpt(anyInSystem).each((function(panel){var img=panel.components()[1].element;repaintImg(panel,img)}))},showCrop:function(){cropRect.run((function(cRect){cRect.toggleVisibility(!0)}))},hideCrop:function(){cropRect.run((function(cRect){cRect.toggleVisibility(!1)}))},getRect:function(){return rectState.get()},getMeasurements:function(){var viewRect=viewRectState.get();return{width:viewRect.w,height:viewRect.h}}}},createButton=function(innerHtml,icon,disabled,action,providersBackstage){return renderIconButton({name:innerHtml,icon:Optional.some(icon),disabled:disabled,tooltip:Optional.some(innerHtml),primary:!1,borderless:!1},action,providersBackstage)},setButtonEnabled=function(button,enabled){enabled?Disabling.enable(button):Disabling.disable(button)};var Delimiter,makeState=function(initialState){var blobState=Cell(initialState),tempState=value$1(),undoStack=function UndoStack(){var data=[],index=-1,canUndo=function(){return index>0},canRedo=function(){return-1!==index&&index<data.length-1};return{data:data,add:function(state){var removed=data.splice(++index);return data.push(state),{state:state,removed:removed}},undo:function(){if(canUndo())return data[--index]},redo:function(){if(canRedo())return data[++index]},canUndo:canUndo,canRedo:canRedo}}();undoStack.add(initialState);var setBlobState=function(state){blobState.set(state)},createState=function(blob){return{blob:blob,url:URL.createObjectURL(blob)}},destroyState=function(state){URL.revokeObjectURL(state.url)},destroyTempState=function(){tempState.on(destroyState),tempState.clear()},addBlobState=function(blob){var newState=createState(blob);setBlobState(newState);var states,removed=undoStack.add(newState).removed;return states=removed,global$5.each(states,destroyState),newState.url};return{getBlobState:function(){return blobState.get()},setBlobState:setBlobState,addBlobState:addBlobState,getTempState:function(){return tempState.get().getOrThunk(blobState.get)},updateTempState:function(blob){var newTempState=createState(blob);return destroyTempState(),tempState.set(newTempState),newTempState.url},addTempState:function(blob){var newState=createState(blob);return tempState.set(newState),newState.url},applyTempState:function(postApply){return tempState.get().fold(noop,(function(temp){addBlobState(temp.blob),postApply()}))},destroyTempState:destroyTempState,undo:function(){var currentState=undoStack.undo();return setBlobState(currentState),currentState.url},redo:function(){var currentState=undoStack.redo();return setBlobState(currentState),currentState.url},getHistoryStates:function(){return{undoEnabled:undoStack.canUndo(),redoEnabled:undoStack.canRedo()}}}},renderImageTools=function(detail,providersBackstage){var state=makeState(detail.currentState),updateButtonUndoStates=function(anyInSystem){var historyStates=state.getHistoryStates();sideBar.updateButtonUndoStates(anyInSystem,historyStates.undoEnabled,historyStates.redoEnabled),emitWith(anyInSystem,external.formActionEvent,{name:external.saveState(),value:historyStates.undoEnabled})},imageResultToBlob=function(ir){return ir.toBlob()},block=function(anyInSystem){emitWith(anyInSystem,external.formActionEvent,{name:external.disable(),value:{}})},unblock=function(anyInSystem){editPanel.getApplyButton(anyInSystem).each((function(applyButton){Disabling.enable(applyButton)})),emitWith(anyInSystem,external.formActionEvent,{name:external.enable(),value:{}})},updateSrc=function(anyInSystem,src){return block(anyInSystem),imagePanel.updateSrc(anyInSystem,src)},blobManipulate=function(anyInSystem,blob,filter,action,swap){block(anyInSystem),function(blob){return fromBlob(blob)}(blob).then(filter).then(imageResultToBlob).then(action).then((function(url){return updateSrc(anyInSystem,url)})).then((function(){updateButtonUndoStates(anyInSystem),swap(),unblock(anyInSystem)})).catch((function(err){console.log(err),anyInSystem.getSystem().isConnected()&&unblock(anyInSystem)}))},manipulate=function(anyInSystem,filter,swap){var blob=state.getBlobState().blob;blobManipulate(anyInSystem,blob,filter,(function(blob){return state.updateTempState(blob)}),swap)},destroyTempState=function(anyInSystem){var currentUrl=state.getBlobState().url;return state.destroyTempState(),updateButtonUndoStates(anyInSystem),currentUrl},imagePanel=renderImagePanel(detail.currentState.url),sideBar=function(providersBackstage){var memUndo=record(createButton("Undo","undo",!0,(function(button){emitWith(button,internal.undo(),{direction:1})}),providersBackstage)),memRedo=record(createButton("Redo","redo",!0,(function(button){emitWith(button,internal.redo(),{direction:1})}),providersBackstage));return{container:Container.sketch({dom:{tag:"div",classes:["tox-image-tools__toolbar","tox-image-tools__sidebar"]},components:[memUndo.asSpec(),memRedo.asSpec(),createButton("Zoom in","zoom-in",!1,(function(button){emitWith(button,internal.zoom(),{direction:1})}),providersBackstage),createButton("Zoom out","zoom-out",!1,(function(button){emitWith(button,internal.zoom(),{direction:-1})}),providersBackstage)]}),updateButtonUndoStates:function(anyInSystem,undoEnabled,redoEnabled){memUndo.getOpt(anyInSystem).each((function(undo){setButtonEnabled(undo,undoEnabled)})),memRedo.getOpt(anyInSystem).each((function(redo){setButtonEnabled(redo,redoEnabled)}))}}}(providersBackstage),editPanel=renderEditPanel(imagePanel,providersBackstage);return{dom:{tag:"div",attributes:{role:"presentation"}},components:[editPanel.memContainer.asSpec(),imagePanel.memContainer.asSpec(),sideBar.container],behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(){return state.getBlobState()}}}),config("image-tools-events",[run$1(internal.undo(),(function(anyInSystem,_simulatedEvent){var url=state.undo();updateSrc(anyInSystem,url).then((function(_oImg){unblock(anyInSystem),updateButtonUndoStates(anyInSystem)}))})),run$1(internal.redo(),(function(anyInSystem,_simulatedEvent){var url=state.redo();updateSrc(anyInSystem,url).then((function(_oImg){unblock(anyInSystem),updateButtonUndoStates(anyInSystem)}))})),run$1(internal.zoom(),(function(anyInSystem,simulatedEvent){var direction=simulatedEvent.event.direction;imagePanel.zoom(anyInSystem,direction)})),run$1(internal.back(),(function(anyInSystem,simulatedEvent){!function(anyInSystem){var currentUrl=destroyTempState(anyInSystem);updateSrc(anyInSystem,currentUrl).then((function(_oImg){unblock(anyInSystem)}))}(anyInSystem),(0,simulatedEvent.event.swap)(),imagePanel.hideCrop()})),run$1(internal.apply(),(function(anyInSystem,simulatedEvent){state.applyTempState((function(){destroyTempState(anyInSystem),(0,simulatedEvent.event.swap)()}))})),run$1(internal.transform(),(function(anyInSystem,simulatedEvent){return manipulate(anyInSystem,simulatedEvent.event.transform,noop)})),run$1(internal.tempTransform(),(function(anyInSystem,simulatedEvent){return function(anyInSystem,filter){var blob=state.getTempState().blob;blobManipulate(anyInSystem,blob,filter,(function(blob){return state.addTempState(blob)}),noop)}(anyInSystem,simulatedEvent.event.transform)})),run$1(internal.transformApply(),(function(anyInSystem,simulatedEvent){return function(anyInSystem,filter,swap){var blob=state.getBlobState().blob;blobManipulate(anyInSystem,blob,filter,(function(blob){var url=state.addBlobState(blob);return destroyTempState(anyInSystem),url}),swap)}(anyInSystem,simulatedEvent.event.transform,simulatedEvent.event.swap)})),run$1(internal.swap(),(function(anyInSystem,simulatedEvent){!function(anyInSystem){sideBar.updateButtonUndoStates(anyInSystem,!1,!1)}(anyInSystem);var transform=simulatedEvent.event.transform,swap=simulatedEvent.event.swap;transform.fold((function(){swap()}),(function(transform){manipulate(anyInSystem,transform,swap)}))}))]),ComposingConfigs_self()])}},isSingleListItem=function(item){return!has$2(item,"items")},fetchItems=function(dropdownComp,name,items,selectedValue){return map$2(items,(function(item){return isSingleListItem(item)?{type:"togglemenuitem",text:item.text,value:item.value,active:item.value===selectedValue,onAction:function(){Representing.setValue(dropdownComp,item.value),emitWith(dropdownComp,formChangeEvent,{name:name}),Focusing.focus(dropdownComp)}}:{type:"nestedmenuitem",text:item.text,getSubmenuItems:function(){return fetchItems(dropdownComp,name,item.items,selectedValue)}}}))},findItemByValue=function(items,value){return findMap(items,(function(item){return isSingleListItem(item)?someIf(item.value===value,item):findItemByValue(item.items,value)}))},HtmlSelect=single({name:"HtmlSelect",configFields:[required$1("options"),field("selectBehaviours",[Focusing,Representing]),defaulted("selectClasses",[]),defaulted("selectAttributes",{}),option("data")],factory:function(detail,_spec){var options=map$2(detail.options,(function(option){return{dom:{tag:"option",value:option.value,innerHtml:option.text}}})),initialValues=detail.data.map((function(v){return wrap$1("initialValue",v)})).getOr({});return{uid:detail.uid,dom:{tag:"select",classes:detail.selectClasses,attributes:detail.selectAttributes},components:options,behaviours:augment(detail.selectBehaviours,[Focusing.config({}),Representing.config({store:__assign({mode:"manual",getValue:function(select){return get$5(select.element)},setValue:function(select,newValue){find$5(detail.options,(function(opt){return opt.value===newValue})).isSome()&&set$4(select.element,newValue)}},initialValues)})])}}}),renderTextField=function(spec,providersBackstage){var pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),baseInputBehaviours=[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Keying.config({mode:"execution",useEnter:!0!==spec.multiline,useControlEnter:!0===spec.multiline,execute:function(comp){return emit(comp,formSubmitEvent),Optional.some(!0)}}),config("textfield-change",[run$1(input(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})})),run$1(postPaste(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}))]),Tabstopping.config({})],validatingBehaviours=spec.validation.map((function(vl){return Invalidating.config({getRoot:function(input){return parent(input.element)},invalidClass:"tox-invalid",validator:{validate:function(input){var v=Representing.getValue(input),result=vl.validator(v);return Future_pure(!0===result?Result.value(v):Result.error(result))},validateOnLoad:vl.validateOnLoad}})})).toArray(),placeholder=spec.placeholder.fold(constant$1({}),(function(p){return{placeholder:providersBackstage.translate(p)}})),inputMode=spec.inputMode.fold(constant$1({}),(function(mode){return{inputmode:mode}})),inputAttributes=__assign(__assign({},placeholder),inputMode),pField=FormField.parts.field({tag:!0===spec.multiline?"textarea":"input",inputAttributes:inputAttributes,inputClasses:[spec.classname],inputBehaviours:derive$1(flatten([baseInputBehaviours,validatingBehaviours])),selectOnFocus:!1,factory:Input}),extraClasses2=(spec.flex?["tox-form__group--stretched"]:[]).concat(spec.maximized?["tox-form-group--maximize"]:[]),extraBehaviours=[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()];return renderFormFieldWith(pLabel,pField,extraClasses2,extraBehaviours)},ActiveStreaming=Object.freeze({__proto__:null,events:function(streamConfig,streamState){var processor=streamConfig.stream.streams.setup(streamConfig,streamState);return derive$2([run$1(streamConfig.event,processor),runOnDetached((function(){return streamState.cancel()}))].concat(streamConfig.cancelEvent.map((function(e){return[run$1(e,(function(){return streamState.cancel()}))]})).getOr([])))}}),throttle=function(_config){var state=Cell(null);return nu$8({readState:function(){return{timer:null!==state.get()?"set":"unset"}},setTimer:function(t){state.set(t)},cancel:function(){var t=state.get();null!==t&&t.cancel()}})},StreamingState=Object.freeze({__proto__:null,throttle:throttle,init:function(spec){return spec.stream.streams.state(spec)}}),StreamingSchema=[requiredOf("stream",choose$1("mode",{throttle:[required$1("delay"),defaulted("stopEvent",!0),output$1("streams",{setup:function(streamInfo,streamState){var sInfo=streamInfo.stream,throttler=last(streamInfo.onStream,sInfo.delay);return streamState.setTimer(throttler),function(component,simulatedEvent){throttler.throttle(component,simulatedEvent),sInfo.stopEvent&&simulatedEvent.stop()}},state:throttle})]})),defaulted("event","input"),option("cancelEvent"),onStrictHandler("onStream")],Streaming=create$7({fields:StreamingSchema,name:"streaming",active:ActiveStreaming,state:StreamingState}),setValueFromItem=function(model,input,item){var itemData=Representing.getValue(item);Representing.setValue(input,itemData),setCursorAtEnd(input)},setSelectionOn=function(input,f){var el=input.element,value=get$5(el),node=el.dom;"number"!==get$d(el,"type")&&f(node,value)},setCursorAtEnd=function(input){setSelectionOn(input,(function(node,value){return node.setSelectionRange(value.length,value.length)}))},attemptSelectOver=function(model,input,item){if(model.selectsOver){var currentValue=Representing.getValue(input),inputDisplay_1=model.getDisplayText(currentValue),itemValue=Representing.getValue(item);return 0===model.getDisplayText(itemValue).indexOf(inputDisplay_1)?Optional.some((function(){setValueFromItem(0,input,item),function(input,startOffset){setSelectionOn(input,(function(node,value){return node.setSelectionRange(startOffset,value.length)}))}(input,inputDisplay_1.length)})):Optional.none()}return Optional.none()},itemExecute=constant$1("alloy.typeahead.itemexecute"),schema$g=constant$1([option("lazySink"),required$1("fetch"),defaulted("minChars",5),defaulted("responseTime",1e3),onHandler("onOpen"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),defaulted("layouts",Optional.none()),defaulted("eventOrder",{}),defaultedObjOf("model",{},[defaulted("getDisplayText",(function(itemData){return void 0!==itemData.meta&&void 0!==itemData.meta.text?itemData.meta.text:itemData.value})),defaulted("selectsOver",!0),defaulted("populateFromBrowse",!0)]),onHandler("onSetValue"),onKeyboardHandler("onExecute"),onHandler("onItemExecute"),defaulted("inputClasses",[]),defaulted("inputAttributes",{}),defaulted("inputStyles",{}),defaulted("matchWidth",!0),defaulted("useMinWidth",!1),defaulted("dismissOnBlur",!0),markers$1(["openClass"]),option("initialData"),field("typeaheadBehaviours",[Focusing,Representing,Streaming,Keying,Toggling,Coupling]),customField("previewing",(function(){return Cell(!0)}))].concat(schema$k()).concat(sandboxFields())),parts$b=constant$1([external$1({schema:[tieredMenuMarkers()],name:"menu",overrides:function(detail){return{fakeFocus:!0,onHighlight:function(menu,item){detail.previewing.get()?menu.getSystem().getByUid(detail.uid).each((function(input){attemptSelectOver(detail.model,input,item).fold((function(){return Highlighting.dehighlight(menu,item)}),(function(fn){return fn()}))})):menu.getSystem().getByUid(detail.uid).each((function(input){detail.model.populateFromBrowse&&setValueFromItem(detail.model,input,item)})),detail.previewing.set(!1)},onExecute:function(menu,item){return menu.getSystem().getByUid(detail.uid).toOptional().map((function(typeahead){return emitWith(typeahead,itemExecute(),{item:item}),!0}))},onHover:function(menu,item){detail.previewing.set(!1),menu.getSystem().getByUid(detail.uid).each((function(input){detail.model.populateFromBrowse&&setValueFromItem(detail.model,input,item)}))}}}})]),Typeahead=composite({name:"Typeahead",configFields:schema$g(),partFields:parts$b(),factory:function(detail,components,spec,externals){var navigateList=function(comp,simulatedEvent,highlighter){detail.previewing.set(!1);var sandbox=Coupling.getCoupled(comp,"sandbox");if(Sandboxing.isOpen(sandbox))Composing.getCurrent(sandbox).each((function(menu){Highlighting.getHighlighted(menu).fold((function(){highlighter(menu)}),(function(){dispatchEvent(sandbox,menu.element,"keydown",simulatedEvent)}))}));else{open(detail,mapFetch(comp),comp,sandbox,externals,(function(sandbox){Composing.getCurrent(sandbox).each(highlighter)}),HighlightOnOpen.HighlightFirst).get(noop)}},focusBehaviours$1=focusBehaviours(detail),mapFetch=function(comp){return function(tdata){return tdata.map((function(data){var menus=values(data.menus),items=bind$3(menus,(function(menu){return filter$2(menu.items,(function(item){return"item"===item.type}))}));return Representing.getState(comp).update(map$2(items,(function(item){return item.data}))),data}))}},behaviours=[Focusing.config({}),Representing.config({onSetValue:detail.onSetValue,store:__assign({mode:"dataset",getDataKey:function(comp){return get$5(comp.element)},getFallbackEntry:function(itemString){return{value:itemString,meta:{}}},setValue:function(comp,data){set$4(comp.element,detail.model.getDisplayText(data))}},detail.initialData.map((function(d){return wrap$1("initialValue",d)})).getOr({}))}),Streaming.config({stream:{mode:"throttle",delay:detail.responseTime,stopEvent:!1},onStream:function(component,_simulatedEvent){var sandbox=Coupling.getCoupled(component,"sandbox");if(Focusing.isFocused(component)&&get$5(component.element).length>=detail.minChars){var previousValue_1=Composing.getCurrent(sandbox).bind((function(menu){return Highlighting.getHighlighted(menu).map(Representing.getValue)}));detail.previewing.set(!0);open(detail,mapFetch(component),component,sandbox,externals,(function(_sandbox){Composing.getCurrent(sandbox).each((function(menu){previousValue_1.fold((function(){detail.model.selectsOver&&Highlighting.highlightFirst(menu)}),(function(pv){Highlighting.highlightBy(menu,(function(item){return Representing.getValue(item).value===pv.value})),Highlighting.getHighlighted(menu).orThunk((function(){return Highlighting.highlightFirst(menu),Optional.none()}))}))}))}),HighlightOnOpen.HighlightFirst).get(noop)}},cancelEvent:typeaheadCancel()}),Keying.config({mode:"special",onDown:function(comp,simulatedEvent){return navigateList(comp,simulatedEvent,Highlighting.highlightFirst),Optional.some(!0)},onEscape:function(comp){var sandbox=Coupling.getCoupled(comp,"sandbox");return Sandboxing.isOpen(sandbox)?(Sandboxing.close(sandbox),Optional.some(!0)):Optional.none()},onUp:function(comp,simulatedEvent){return navigateList(comp,simulatedEvent,Highlighting.highlightLast),Optional.some(!0)},onEnter:function(comp){var sandbox=Coupling.getCoupled(comp,"sandbox"),sandboxIsOpen=Sandboxing.isOpen(sandbox);if(sandboxIsOpen&&!detail.previewing.get())return Composing.getCurrent(sandbox).bind((function(menu){return Highlighting.getHighlighted(menu)})).map((function(item){return emitWith(comp,itemExecute(),{item:item}),!0}));var currentValue=Representing.getValue(comp);return emit(comp,typeaheadCancel()),detail.onExecute(sandbox,comp,currentValue),sandboxIsOpen&&Sandboxing.close(sandbox),Optional.some(!0)}}),Toggling.config({toggleClass:detail.markers.openClass,aria:{mode:"expanded"}}),Coupling.config({others:{sandbox:function(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function(){return Toggling.on(hotspot)},onClose:function(){return Toggling.off(hotspot)}})}}}),config("typeaheadevents",[runOnExecute$1((function(comp){var onOpenSync=noop;togglePopup(detail,mapFetch(comp),comp,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop)})),run$1(itemExecute(),(function(comp,se){var sandbox=Coupling.getCoupled(comp,"sandbox");setValueFromItem(detail.model,comp,se.event.item),emit(comp,typeaheadCancel()),detail.onItemExecute(comp,sandbox,se.event.item,Representing.getValue(comp)),Sandboxing.close(sandbox),setCursorAtEnd(comp)}))].concat(detail.dismissOnBlur?[run$1(postBlur(),(function(typeahead){var sandbox=Coupling.getCoupled(typeahead,"sandbox");search(sandbox.element).isNone()&&Sandboxing.close(sandbox)}))]:[]))];return{uid:detail.uid,dom:dom(deepMerge(detail,{inputAttributes:{role:"combobox","aria-autocomplete":"list","aria-haspopup":"true"}})),behaviours:__assign(__assign({},focusBehaviours$1),augment(detail.typeaheadBehaviours,behaviours)),eventOrder:detail.eventOrder}}}),wrap=function(delegate){return __assign(__assign({},delegate),{toCached:function(){return wrap(delegate.toCached())},bindFuture:function(f){return wrap(delegate.bind((function(resA){return resA.fold((function(err){return Future_pure(Result.error(err))}),(function(a){return f(a)}))})))},bindResult:function(f){return wrap(delegate.map((function(resA){return resA.bind(f)})))},mapResult:function(f){return wrap(delegate.map((function(resA){return resA.map(f)})))},mapError:function(f){return wrap(delegate.map((function(resA){return resA.mapError(f)})))},foldResult:function(whenError,whenValue){return delegate.map((function(res){return res.fold(whenError,whenValue)}))},withTimeout:function(timeout,errorThunk){return wrap(Future_nu((function(callback){var timedOut=!1,timer=setTimeout((function(){timedOut=!0,callback(Result.error(errorThunk()))}),timeout);delegate.get((function(result){timedOut||(clearTimeout(timer),callback(result))}))})))}})},nu$1=function(worker){return wrap(Future_nu(worker))},FutureResult_nu=nu$1,separator$1={type:"separator"},toMenuItem=function(target){return{type:"menuitem",value:target.url,text:target.title,meta:{attach:target.attach},onAction:noop}},staticMenuItem=function(title,url){return{type:"menuitem",value:url,text:title,meta:{attach:void 0},onAction:noop}},filteredTargets=function(type,targets){return function(targets){return map$2(targets,toMenuItem)}(function(type,targets){return filter$2(targets,(function(target){return target.type===type}))}(type,targets))},headerTargets=function(linkInfo){return filteredTargets("header",linkInfo.targets)},anchorTargets=function(linkInfo){return filteredTargets("anchor",linkInfo.targets)},anchorTargetTop=function(linkInfo){return Optional.from(linkInfo.anchorTop).map((function(url){return staticMenuItem("<top>",url)})).toArray()},anchorTargetBottom=function(linkInfo){return Optional.from(linkInfo.anchorBottom).map((function(url){return staticMenuItem("<bottom>",url)})).toArray()},filterByQuery=function(term,menuItems){var lowerCaseTerm=term.toLowerCase();return filter$2(menuItems,(function(item){var text=void 0!==item.meta&&void 0!==item.meta.text?item.meta.text:item.text;return contains$1(text.toLowerCase(),lowerCaseTerm)||contains$1(item.value.toLowerCase(),lowerCaseTerm)}))},getItems=function(fileType,input,urlBackstage){var urlInputValue=Representing.getValue(input),term=void 0!==urlInputValue.meta.text?urlInputValue.meta.text:urlInputValue.value;return urlBackstage.getLinkInformation().fold((function(){return[]}),(function(linkInfo){var items,history=filterByQuery(term,function(history){return map$2(history,(function(url){return staticMenuItem(url,url)}))}(urlBackstage.getHistory(fileType)));return"file"===fileType?(items=[history,filterByQuery(term,headerTargets(linkInfo)),filterByQuery(term,flatten([anchorTargetTop(linkInfo),anchorTargets(linkInfo),anchorTargetBottom(linkInfo)]))],foldl(items,(function(a,b){return 0===a.length||0===b.length?a.concat(b):a.concat(separator$1,b)}),[])):history}))},errorId=generate$6("aria-invalid"),make$2=function(render){return function(parts,spec,backstage){return get$e(spec,"name").fold((function(){return render(spec,backstage)}),(function(fieldName){return parts.field(fieldName,render(spec,backstage))}))}},factories={bar:make$2((function(spec,backstage){return function(spec,backstage){return{dom:{tag:"div",classes:["tox-bar","tox-form__controls-h-stack"]},components:map$2(spec.items,backstage.interpreter)}}(spec,backstage.shared)})),collection:make$2((function(spec,backstage){return renderCollection(spec,backstage.shared.providers)})),alertbanner:make$2((function(spec,backstage){return function(spec,providersBackstage){return Container.sketch({dom:{tag:"div",attributes:{role:"alert"},classes:["tox-notification","tox-notification--in","tox-notification--"+spec.level]},components:[{dom:{tag:"div",classes:["tox-notification__icon"]},components:[Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--naked","tox-button--icon"],innerHtml:get$1(spec.icon,providersBackstage.icons),attributes:{title:providersBackstage.translate(spec.iconTooltip)}},action:function(comp){emitWith(comp,formActionEvent,{name:"alert-banner",value:spec.url})},buttonBehaviours:derive$1([addFocusableBehaviour()])})]},{dom:{tag:"div",classes:["tox-notification__body"],innerHtml:providersBackstage.translate(spec.text)}}]})}(spec,backstage.shared.providers)})),input:make$2((function(spec,backstage){return function(spec,providersBackstage){return renderTextField({name:spec.name,multiline:!1,label:spec.label,inputMode:spec.inputMode,placeholder:spec.placeholder,flex:!1,disabled:spec.disabled,classname:"tox-textfield",validation:Optional.none(),maximized:spec.maximized},providersBackstage)}(spec,backstage.shared.providers)})),textarea:make$2((function(spec,backstage){return function(spec,providersBackstage){return renderTextField({name:spec.name,multiline:!0,label:spec.label,inputMode:Optional.none(),placeholder:spec.placeholder,flex:!0,disabled:spec.disabled,classname:"tox-textarea",validation:Optional.none(),maximized:spec.maximized},providersBackstage)}(spec,backstage.shared.providers)})),label:make$2((function(spec,backstage){return function(spec,backstageShared){var label={dom:{tag:"label",innerHtml:backstageShared.providers.translate(spec.label),classes:["tox-label"]}},comps=map$2(spec.items,backstageShared.interpreter);return{dom:{tag:"div",classes:["tox-form__group"]},components:[label].concat(comps),behaviours:derive$1([ComposingConfigs_self(),Replacing.config({}),RepresentingConfigs_domHtml(Optional.none()),Keying.config({mode:"acyclic"})])}}(spec,backstage.shared)})),iframe:function(render){return function(parts,spec,backstage){var iframeSpec=deepMerge(spec,{source:"dynamic"});return make$2(render)(parts,iframeSpec,backstage)}}((function(spec,backstage){return renderIFrame(spec,backstage.shared.providers)})),button:make$2((function(spec,backstage){return renderDialogButton(spec,backstage.shared.providers)})),checkbox:make$2((function(spec,backstage){return function(spec,providerBackstage){var repBehaviour=Representing.config({store:{mode:"manual",getValue:function(comp){return comp.element.dom.checked},setValue:function(comp,value){comp.element.dom.checked=value}}}),toggleCheckboxHandler=function(comp){return comp.element.dom.click(),Optional.some(!0)},pField=FormField.parts.field({factory:{sketch:identity$1},dom:{tag:"input",classes:["tox-checkbox__input"],attributes:{type:"checkbox"}},behaviours:derive$1([ComposingConfigs_self(),Disabling.config({disabled:function(){return spec.disabled||providerBackstage.isDisabled()}}),Tabstopping.config({}),Focusing.config({}),repBehaviour,Keying.config({mode:"special",onEnter:toggleCheckboxHandler,onSpace:toggleCheckboxHandler,stopSpaceKeyup:!0}),config("checkbox-events",[run$1(change(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}))])])}),pLabel=FormField.parts.label({dom:{tag:"span",classes:["tox-checkbox__label"],innerHtml:providerBackstage.translate(spec.label)},behaviours:derive$1([Unselecting.config({})])}),makeIcon=function(className){return render$3("checked"===className?"selected":"unselected",{tag:"span",classes:["tox-icon","tox-checkbox-icon__"+className]},providerBackstage.icons)},memIcons=record({dom:{tag:"div",classes:["tox-checkbox__icons"]},components:[makeIcon("checked"),makeIcon("unchecked")]});return FormField.sketch({dom:{tag:"label",classes:["tox-checkbox"]},components:[pField,memIcons.asSpec(),pLabel],fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providerBackstage.isDisabled()},disableClass:"tox-checkbox--disabled",onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()])})}(spec,backstage.shared.providers)})),colorinput:make$2((function(spec,backstage){return renderColorInput(spec,backstage.shared,backstage.colorinput)})),colorpicker:make$2((function(_spec){var getClass=function(key){return"tox-"+key},colourPickerFactory=makeFactory(translate$1,getClass),memPicker=record(colourPickerFactory.sketch({dom:{tag:"div",classes:[getClass("color-picker-container")],attributes:{role:"presentation"}},onValidHex:function(form){emitWith(form,formActionEvent,{name:"hex-valid",value:!0})},onInvalidHex:function(form){emitWith(form,formActionEvent,{name:"hex-valid",value:!1})}}));return{dom:{tag:"div"},components:[memPicker.asSpec()],behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(comp){var picker=memPicker.get(comp);return Composing.getCurrent(picker).bind((function(rgbForm){return Representing.getValue(rgbForm).hex})).map((function(hex){return"#"+hex})).getOr("")},setValue:function(comp,newValue){var m=/^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/.exec(newValue),picker=memPicker.get(comp);Composing.getCurrent(picker).fold((function(){console.log("Can not find form")}),(function(rgbForm){Representing.setValue(rgbForm,{hex:Optional.from(m[1]).getOr("")}),Form.getField(rgbForm,"hex").each((function(hexField){emit(hexField,input())}))}))}}}),ComposingConfigs_self()])}})),dropzone:make$2((function(spec,backstage){return renderDropZone(spec,backstage.shared.providers)})),grid:make$2((function(spec,backstage){return function(spec,backstage){return{dom:{tag:"div",classes:["tox-form__grid","tox-form__grid--"+spec.columns+"col"]},components:map$2(spec.items,backstage.interpreter)}}(spec,backstage.shared)})),listbox:make$2((function(spec,backstage){return function(spec,backstage){var providersBackstage=backstage.shared.providers,initialItem=head(spec.items).filter(isSingleListItem),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),listBoxWrap={dom:{tag:"div",classes:["tox-listboxfield"]},components:[FormField.parts.field({dom:{},factory:{sketch:function(sketchSpec){return renderCommonDropdown({uid:sketchSpec.uid,text:initialItem.map((function(item){return item.text})),icon:Optional.none(),tooltip:spec.label,role:Optional.none(),fetch:function(comp,callback){var items=fetchItems(comp,spec.name,spec.items,Representing.getValue(comp));callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))},onSetup:constant$1(noop),getApi:constant$1({}),columns:1,presets:"normal",classes:[],dropdownBehaviours:[Tabstopping.config({}),Representing.config({store:{mode:"manual",initialValue:initialItem.map((function(item){return item.value})).getOr(""),getValue:function(comp){return get$d(comp.element,"data-value")},setValue:function(comp,data){findItemByValue(spec.items,data).each((function(item){set$8(comp.element,"data-value",item.value),emitWith(comp,updateMenuText,{text:item.text})}))}}})]},"tox-listbox",backstage.shared)}}})]};return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:flatten([pLabel.toArray(),[listBoxWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:constant$1(spec.disabled),onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}})])})}(spec,backstage)})),selectbox:make$2((function(spec,backstage){return function(spec,providersBackstage){var translatedOptions=map$2(spec.items,(function(item){return{text:providersBackstage.translate(item.text),value:item.value}})),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),pField=FormField.parts.field({dom:{},selectAttributes:{size:spec.size},options:translatedOptions,factory:HtmlSelect,selectBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),Tabstopping.config({}),config("selectbox-change",[run$1(change(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}))])])}),chevron=spec.size>1?Optional.none():Optional.some(render$3("chevron-down",{tag:"div",classes:["tox-selectfield__icon-js"]},providersBackstage.icons)),selectWrap={dom:{tag:"div",classes:["tox-selectfield"]},components:flatten([[pField],chevron.toArray()])};return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:flatten([pLabel.toArray(),[selectWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()])})}(spec,backstage.shared.providers)})),sizeinput:make$2((function(spec,backstage){return renderSizeInput(spec,backstage.shared.providers)})),urlinput:make$2((function(spec,backstage){return function(spec,backstage,urlBackstage){var _a,providersBackstage=backstage.shared.providers,updateHistory=function(component){var urlEntry=Representing.getValue(component);urlBackstage.addToHistory(urlEntry.value,spec.filetype)},pField=FormField.parts.field({factory:Typeahead,dismissOnBlur:!0,inputClasses:["tox-textfield"],sandboxClasses:["tox-dialog__popups"],inputAttributes:{"aria-errormessage":errorId,type:"url"},minChars:0,responseTime:0,fetch:function(input){var items=getItems(spec.filetype,input,urlBackstage),tdata=build(items,ItemResponse$1.BUBBLE_TO_SANDBOX,backstage,!1);return Future_pure(tdata)},getHotspot:function(comp){return memUrlBox.getOpt(comp)},onSetValue:function(comp,_newValue){comp.hasConfigured(Invalidating)&&Invalidating.run(comp).get(noop)},typeaheadBehaviours:derive$1(flatten([urlBackstage.getValidationHandler().map((function(handler){return Invalidating.config({getRoot:function(comp){return parent(comp.element)},invalidClass:"tox-control-wrap--status-invalid",notify:{onInvalid:function(comp,err){memInvalidIcon.getOpt(comp).each((function(invalidComp){set$8(invalidComp.element,"title",providersBackstage.translate(err))}))}},validator:{validate:function(input){var urlEntry=Representing.getValue(input);return FutureResult_nu((function(completer){handler({type:spec.filetype,url:urlEntry.value},(function(validation){if("invalid"===validation.status){var err=Result.error(validation.message);completer(err)}else{var val=Result.value(validation.message);completer(val)}}))}))},validateOnLoad:!1}})})).toArray(),[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),Tabstopping.config({}),config("urlinput-events",flatten(["file"===spec.filetype?[run$1(input(),(function(comp){emitWith(comp,formChangeEvent,{name:spec.name})}))]:[],[run$1(change(),(function(comp){emitWith(comp,formChangeEvent,{name:spec.name}),updateHistory(comp)})),run$1(postPaste(),(function(comp){emitWith(comp,formChangeEvent,{name:spec.name}),updateHistory(comp)}))]]))]])),eventOrder:(_a={},_a[input()]=["streaming","urlinput-events","invalidating"],_a),model:{getDisplayText:function(itemData){return itemData.value},selectsOver:!1,populateFromBrowse:!1},markers:{openClass:"tox-textfield--popup-open"},lazySink:backstage.shared.getSink,parts:{menu:part(0,0,"normal")},onExecute:function(_menu,component,_entry){emitWith(component,formSubmitEvent,{})},onItemExecute:function(typeahead,_sandbox,_item,_value){updateHistory(typeahead),emitWith(typeahead,formChangeEvent,{name:spec.name})}}),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),memInvalidIcon=record(function(name,errId,icon,label){return void 0===icon&&(icon=name),void 0===label&&(label=name),render$3(icon,{tag:"div",classes:["tox-icon","tox-control-wrap__status-icon-"+name],attributes:__assign({title:providersBackstage.translate(label),"aria-live":"polite"},errId.fold((function(){return{}}),(function(id){return{id:id}})))},providersBackstage.icons)}("invalid",Optional.some(errorId),"warning")),memStatus=record({dom:{tag:"div",classes:["tox-control-wrap__status-icon-wrap"]},components:[memInvalidIcon.asSpec()]}),optUrlPicker=urlBackstage.getUrlPicker(spec.filetype),browseUrlEvent=generate$6("browser.url.event"),memUrlBox=record({dom:{tag:"div",classes:["tox-control-wrap"]},components:[pField,memStatus.asSpec()],behaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}})])}),memUrlPickerButton=record(renderButton({name:spec.name,icon:Optional.some("browse"),text:spec.label.getOr(""),disabled:spec.disabled,primary:!1,borderless:!0},(function(component){return emit(component,browseUrlEvent)}),providersBackstage,[],["tox-browse-url"]));return FormField.sketch({dom:renderFormFieldDomWith([]),components:pLabel.toArray().concat([{dom:{tag:"div",classes:["tox-form__controls-h-stack"]},components:flatten([[memUrlBox.asSpec()],optUrlPicker.map((function(){return memUrlPickerButton.asSpec()})).toArray()])}]),fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable),memUrlPickerButton.getOpt(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable),memUrlPickerButton.getOpt(comp).each(Disabling.enable)}}),receivingConfig(),config("url-input-events",[run$1(browseUrlEvent,(function(comp){Composing.getCurrent(comp).each((function(field){var componentData=Representing.getValue(field),urlData=__assign({fieldname:spec.name},componentData);optUrlPicker.each((function(picker){picker(urlData).get((function(chosenData){Representing.setValue(field,chosenData),emitWith(comp,formChangeEvent,{name:spec.name})}))}))}))}))])])})}(spec,backstage,backstage.urlinput)})),customeditor:make$2((function(spec){var editorApi=value$1(),memReplaced=record({dom:{tag:spec.tag}}),initialValue=value$1();return{dom:{tag:"div",classes:["tox-custom-editor"]},behaviours:derive$1([config("custom-editor-events",[runOnAttached((function(component){memReplaced.getOpt(component).each((function(ta){(!function(spec){return has$2(spec,"init")}(spec)?global$6.load(spec.scriptId,spec.scriptUrl).then((function(init){return init(ta.element.dom,spec.settings)})):spec.init(ta.element.dom)).then((function(ea){initialValue.on((function(cvalue){ea.setValue(cvalue)})),initialValue.clear(),editorApi.set(ea)}))}))}))]),Representing.config({store:{mode:"manual",getValue:function(){return editorApi.get().fold((function(){return initialValue.get().getOr("")}),(function(ed){return ed.getValue()}))},setValue:function(component,value){editorApi.get().fold((function(){initialValue.set(value)}),(function(ed){return ed.setValue(value)}))}}}),ComposingConfigs_self()]),components:[memReplaced.asSpec()]}})),htmlpanel:make$2((function(spec){return"presentation"===spec.presets?Container.sketch({dom:{tag:"div",classes:["tox-form__group"],innerHtml:spec.html}}):Container.sketch({dom:{tag:"div",classes:["tox-form__group"],innerHtml:spec.html,attributes:{role:"document"}},containerBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})})),imagetools:make$2((function(spec,backstage){return renderImageTools(spec,backstage.shared.providers)})),table:make$2((function(spec,backstage){return function(spec,providersBackstage){var rows,header,renderTh=function(text){return{dom:{tag:"th",innerHtml:providersBackstage.translate(text)}}},renderTd=function(text){return{dom:{tag:"td",innerHtml:providersBackstage.translate(text)}}},renderTr=function(row){return{dom:{tag:"tr"},components:map$2(row,renderTd)}};return{dom:{tag:"table",classes:["tox-dialog__table"]},components:[(header=spec.header,{dom:{tag:"thead"},components:[{dom:{tag:"tr"},components:map$2(header,renderTh)}]}),(rows=spec.cells,{dom:{tag:"tbody"},components:map$2(rows,renderTr)})],behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])}}(spec,backstage.shared.providers)})),panel:make$2((function(spec,backstage){return function(spec,backstage){return{dom:{tag:"div",classes:spec.classes},components:map$2(spec.items,backstage.shared.interpreter)}}(spec,backstage)}))},noFormParts={field:function(_name,spec){return spec}},interpretInForm=function(parts,spec,oldBackstage){var newBackstage=deepMerge(oldBackstage,{shared:{interpreter:function(childSpec){return interpretParts(parts,childSpec,newBackstage)}}});return interpretParts(parts,spec,newBackstage)},interpretParts=function(parts,spec,backstage){return get$e(factories,spec.type).fold((function(){return console.error('Unknown factory type "'+spec.type+'", defaulting to container: ',spec),spec}),(function(factory){return factory(parts,spec,backstage)}))},bubbleAlignments$2={valignCentre:[],alignCentre:[],alignLeft:[],alignRight:[],right:[],left:[],bottom:[],top:[]},getInlineDialogAnchor=function(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){var overrides={maxHeightFunction:expandable$1()};return function(){return lazyUseEditableAreaAnchor()?{type:"node",root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),bubble:nu$5(12,12,bubbleAlignments$2),layouts:{onRtl:function(){return[northeast]},onLtr:function(){return[northwest]}},overrides:overrides}:{type:"hotspot",hotspot:lazyAnchorbar(),bubble:nu$5(-12,12,bubbleAlignments$2),layouts:{onRtl:function(){return[southeast$2]},onLtr:function(){return[southwest$2]}},overrides:overrides}}},getBannerAnchor=function(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){return function(){return lazyUseEditableAreaAnchor()?{type:"node",root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),layouts:{onRtl:function(){return[north]},onLtr:function(){return[north]}}}:{type:"hotspot",hotspot:lazyAnchorbar(),layouts:{onRtl:function(){return[south$2]},onLtr:function(){return[south$2]}}}}},getCursorAnchor=function(editor,bodyElement){return function(){return{type:"selection",root:bodyElement(),getSelection:function(){var rng=editor.selection.getRng();return Optional.some(SimSelection.range(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset))}}}},getNodeAnchor$1=function(bodyElement){return function(element){return{type:"node",root:bodyElement(),node:element}}},getAnchors=function(editor,lazyAnchorbar,isToolbarTop){var useFixedToolbarContainer=useFixedContainer(editor),bodyElement=function(){return SugarElement.fromDom(editor.getBody())},contentAreaElement=function(){return SugarElement.fromDom(editor.getContentAreaContainer())},lazyUseEditableAreaAnchor=function(){return useFixedToolbarContainer||!isToolbarTop()};return{inlineDialog:getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),banner:getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),cursor:getCursorAnchor(editor,bodyElement),node:getNodeAnchor$1(bodyElement)}},colorPicker=function(editor){return function(callback,value){colorPickerDialog(editor)(callback,value)}},hasCustomColors=function(editor){return function(){return hasCustomColors$1(editor)}},getColors=function(editor){return function(){return getColors$2(editor)}},getColorCols=function(editor){return function(){return getColorCols$1(editor)}},ColorInputBackstage=function(editor){return{colorPicker:colorPicker(editor),hasCustomColors:hasCustomColors(editor),getColors:getColors(editor),getColorCols:getColorCols(editor)}},isDraggableModal=function(editor){return function(){return function(editor){return editor.getParam("draggable_modal",!1,"boolean")}(editor)}},DialogBackstage=function(editor){return{isDraggableModal:isDraggableModal(editor)}},defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",format:"bold"},{title:"Italic",format:"italic"},{title:"Underline",format:"underline"},{title:"Strikethrough",format:"strikethrough"},{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Align",items:[{title:"Left",format:"alignleft"},{title:"Center",format:"aligncenter"},{title:"Right",format:"alignright"},{title:"Justify",format:"alignjustify"}]}],mapFormats=function(userFormats){return foldl(userFormats,(function(acc,fmt){if(has$2(fmt,"items")){var result=mapFormats(fmt.items);return{customFormats:acc.customFormats.concat(result.customFormats),formats:acc.formats.concat([{title:fmt.title,items:result.formats}])}}if(function(format){return has$2(format,"inline")}(fmt)||function(format){return has$2(format,"block")}(fmt)||function(format){return has$2(format,"selector")}(fmt)){var formatNameWithPrefix="custom-"+(isString(fmt.name)?fmt.name:fmt.title.toLowerCase());return{customFormats:acc.customFormats.concat([{name:formatNameWithPrefix,format:fmt}]),formats:acc.formats.concat([{title:fmt.title,format:formatNameWithPrefix,icon:fmt.icon}])}}return __assign(__assign({},acc),{formats:acc.formats.concat(fmt)})}),{customFormats:[],formats:[]})},getStyleFormats=function(editor){return function(editor){return Optional.from(editor.getParam("style_formats")).filter(isArray)}(editor).map((function(userFormats){var registeredUserFormats=function(editor,userFormats){var result=mapFormats(userFormats),registerFormats=function(customFormats){each$1(customFormats,(function(fmt){editor.formatter.has(fmt.name)||editor.formatter.register(fmt.name,fmt.format)}))};return editor.formatter?registerFormats(result.customFormats):editor.on("init",(function(){registerFormats(result.customFormats)})),result.formats}(editor,userFormats);return function(editor){return editor.getParam("style_formats_merge",!1,"boolean")}(editor)?defaultStyleFormats.concat(registeredUserFormats):registeredUserFormats})).getOr(defaultStyleFormats)},processBasic=function(item,isSelectedFor,getPreviewFor){var formatterSpec={type:"formatter",isSelected:isSelectedFor(item.format),getStylePreview:getPreviewFor(item.format)};return deepMerge(item,formatterSpec)},register$8=function(editor,formats,isSelectedFor,getPreviewFor){var doEnrich=function(items){return map$2(items,(function(item){var keys$1=keys(item);if(hasNonNullableKey(item,"items")){var newItems=doEnrich(item.items);return deepMerge(function(item){return deepMerge(item,{type:"submenu"})}(item),{getStyleItems:constant$1(newItems)})}return hasNonNullableKey(item,"format")?function(item){return processBasic(item,isSelectedFor,getPreviewFor)}(item):1===keys$1.length&&contains$2(keys$1,"title")?deepMerge(item,{type:"separator"}):function(item){var formatName=isString(item.name)?item.name:generate$6(item.title),formatNameWithPrefix="custom-"+formatName,customSpec={type:"formatter",format:formatNameWithPrefix,isSelected:isSelectedFor(formatNameWithPrefix),getStylePreview:getPreviewFor(formatNameWithPrefix)},newItem=deepMerge(item,customSpec);return editor.formatter.register(formatName,newItem),newItem}(item)}))};return doEnrich(formats)},init$8=function(editor){var isSelectedFor=function(format){return function(){return editor.formatter.match(format)}},getPreviewFor=function(format){return function(){var fmt=editor.formatter.get(format);return void 0!==fmt?Optional.some({tag:fmt.length>0&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none()}},flatten=function(fmt){var subs=fmt.items;return void 0!==subs&&subs.length>0?bind$3(subs,flatten):[fmt.format]},settingsFormats=Cell([]),settingsFlattenedFormats=Cell([]),eventsFormats=Cell([]),eventsFlattenedFormats=Cell([]),replaceSettings=Cell(!1);editor.on("PreInit",(function(_e){var formats=getStyleFormats(editor),enriched=register$8(editor,formats,isSelectedFor,getPreviewFor);settingsFormats.set(enriched),settingsFlattenedFormats.set(bind$3(enriched,flatten))})),editor.on("addStyleModifications",(function(e){var modifications=register$8(editor,e.items,isSelectedFor,getPreviewFor);eventsFormats.set(modifications),replaceSettings.set(e.replace),eventsFlattenedFormats.set(bind$3(modifications,flatten))}));return{getData:function(){var fromSettings=replaceSettings.get()?[]:settingsFormats.get(),fromEvents=eventsFormats.get();return fromSettings.concat(fromEvents)},getFlattenedKeys:function(){var fromSettings=replaceSettings.get()?[]:settingsFlattenedFormats.get(),fromEvents=eventsFlattenedFormats.get();return fromSettings.concat(fromEvents)}}},trim=global$5.trim,hasContentEditableState=function(value){return function(node){if(function(node){return isNonNullable(node)&&1===node.nodeType}(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}},isContentEditableTrue=hasContentEditableState("true"),isContentEditableFalse=hasContentEditableState("false"),create=function(type,title,url,level,attach){return{type:type,title:title,url:url,level:level,attach:attach}},getElementText=function(elm){return elm.innerText||elm.textContent},isValidAnchor=function(elm){return function(elm){return elm&&"A"===elm.nodeName&&void 0!==(elm.id||elm.name)}(elm)&&isEditable(elm)},isHeader=function(elm){return elm&&/^(H[1-6])$/.test(elm.nodeName)},isEditable=function(elm){return function(node){for(;node=node.parentNode;){var value=node.contentEditable;if(value&&"inherit"!==value)return isContentEditableTrue(node)}return!1}(elm)&&!isContentEditableFalse(elm)},isValidHeader=function(elm){return isHeader(elm)&&isEditable(elm)},headerTarget=function(elm){var headerId=function(elm){return elm.id?elm.id:generate$6("h")}(elm);return create("header",getElementText(elm),"#"+headerId,function(elm){return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0}(elm),(function(){elm.id=headerId}))},anchorTarget=function(elm){var anchorId=elm.id||elm.name,anchorText=getElementText(elm);return create("anchor",anchorText||"#"+anchorId,"#"+anchorId,0,noop)},getTargetElements=function(elm){var selector,root;return selector="h1,h2,h3,h4,h5,h6,a:not([href])",root=elm,map$2(descendants(SugarElement.fromDom(root),selector),(function(element){return element.dom}))},hasTitle=function(target){return trim(target.title).length>0},LinkTargets_find=function(elm){var elms=getTargetElements(elm);return filter$2(function(elms){return map$2(filter$2(elms,isValidHeader),headerTarget)}(elms).concat(function(elms){return map$2(filter$2(elms,isValidAnchor),anchorTarget)}(elms)),hasTitle)},STORAGE_KEY="tinymce-url-history",isHttpUrl=function(url){return isString(url)&&/^https?/.test(url)},isRecordOfUrlArray=function(r){return isObject(r)&&find$4(r,(function(value){return!(isArray(a=value)&&a.length<=5&&forall(a,isHttpUrl));var a})).isNone()},getAllHistory=function(){var history,unparsedHistory=global$8.getItem(STORAGE_KEY);if(null===unparsedHistory)return{};try{history=JSON.parse(unparsedHistory)}catch(e){if(e instanceof SyntaxError)return console.log("Local storage "+STORAGE_KEY+" was not valid JSON",e),{};throw e}return isRecordOfUrlArray(history)?history:(console.log("Local storage "+STORAGE_KEY+" was not valid format",history),{})},getHistory=function(fileType){var history=getAllHistory();return get$e(history,fileType).getOr([])},addToHistory=function(url,fileType){if(isHttpUrl(url)){var history=getAllHistory(),items=get$e(history,fileType).getOr([]),itemsWithoutUrl=filter$2(items,(function(item){return item!==url}));history[fileType]=[url].concat(itemsWithoutUrl).slice(0,5),function(history){if(!isRecordOfUrlArray(history))throw new Error("Bad format for history:\n"+JSON.stringify(history));global$8.setItem(STORAGE_KEY,JSON.stringify(history))}(history)}},isTruthy=function(value){return!!value},makeMap=function(value){return map$1(global$5.makeMap(value,/[, ]/),isTruthy)},getPicker=function(editor){return Optional.from(function(editor){return editor.getParam("file_picker_callback")}(editor)).filter(isFunction)},getPickerSetting=function(editor,filetype){var pickerTypes=function(editor){var optFileTypes=Optional.some(function(editor){return editor.getParam("file_picker_types")}(editor)).filter(isTruthy),optLegacyTypes=Optional.some(function(editor){return editor.getParam("file_browser_callback_types")}(editor)).filter(isTruthy),optTypes=optFileTypes.or(optLegacyTypes).map(makeMap);return getPicker(editor).fold(never,(function(_picker){return optTypes.fold(always,(function(types){return keys(types).length>0&&types}))}))}(editor);return isBoolean(pickerTypes)?pickerTypes?getPicker(editor):Optional.none():pickerTypes[filetype]?getPicker(editor):Optional.none()},getTextSetting=function(value){return Optional.from(value).filter(isString).getOrUndefined()},UrlInputBackstage=function(editor){return{getHistory:getHistory,addToHistory:addToHistory,getLinkInformation:function(){return function(editor){return function(editor){return!1===editor.getParam("typeahead_urls")}(editor)?Optional.none():Optional.some({targets:LinkTargets_find(editor.getBody()),anchorTop:getTextSetting(getAnchorTop(editor)),anchorBottom:getTextSetting(getAnchorBottom(editor))})}(editor)},getValidationHandler:function(){return function(editor){return Optional.from(function(editor){var handler=editor.getParam("file_picker_validator_handler",void 0,"function");return void 0===handler?editor.getParam("filepicker_validator_handler",void 0,"function"):handler}(editor))}(editor)},getUrlPicker:function(filetype){return function(editor,filetype){return getPickerSetting(editor,filetype).map((function(picker){return function(entry){return Future_nu((function(completer){var meta=__assign({filetype:filetype,fieldname:entry.fieldname},Optional.from(entry.meta).getOr({}));picker.call(editor,(function(value,meta){if(!isString(value))throw new Error("Expected value to be string");if(void 0!==meta&&!isObject(meta))throw new Error("Expected meta to be a object");completer({value:value,meta:meta})}),entry.value,meta)}))}}))}(editor,filetype)}}},init$7=function(sink,editor,lazyAnchorbar){var contextMenuState=Cell(!1),toolbar=function(editor){var mode=Cell(isToolbarLocationBottom(editor)?"bottom":"top");return{isPositionedAtTop:function(){return"top"===mode.get()},getDockingMode:mode.get,setDockingMode:mode.set}}(editor),backstage={shared:{providers:{icons:function(){return editor.ui.registry.getAll().icons},menuItems:function(){return editor.ui.registry.getAll().menuItems},translate:global$e.translate,isDisabled:function(){return editor.mode.isReadOnly()||editor.ui.isDisabled()},getSetting:editor.getParam.bind(editor)},interpreter:function(s){return function(spec,backstage){return interpretParts(noFormParts,spec,backstage)}(s,backstage)},anchors:getAnchors(editor,lazyAnchorbar,toolbar.isPositionedAtTop),header:toolbar,getSink:function(){return Result.value(sink)}},urlinput:UrlInputBackstage(editor),styleselect:init$8(editor),colorinput:ColorInputBackstage(editor),dialog:DialogBackstage(editor),isContextMenuOpen:function(){return contextMenuState.get()},setContextMenuState:function(state){return contextMenuState.set(state)}};return backstage},parts$a=AlloyParts,partType=PartType,schema$f=constant$1([defaulted("shell",!1),required$1("makeItem"),defaulted("setupItem",noop),SketchBehaviours_field("listBehaviours",[Replacing])]),itemsPart=optional({name:"items",overrides:function(){return{behaviours:derive$1([Replacing.config({})])}}}),parts$9=constant$1([itemsPart]),name=constant$1("CustomList"),CustomList=composite({name:name(),configFields:schema$f(),partFields:parts$9(),factory:function(detail,components,_spec,_external){var extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components},getListContainer=function(component){return detail.shell?Optional.some(component):getPart(component,detail,"items")};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.listBehaviours,extra.behaviours),apis:{setItems:function(list,items){getListContainer(list).fold((function(){throw console.error("Custom List was defined to not be a shell, but no item container was specified in components"),new Error("Custom List was defined to not be a shell, but no item container was specified in components")}),(function(container){var itemComps=Replacing.contents(container),numListsRequired=items.length,numListsToAdd=numListsRequired-itemComps.length,itemsToAdd=numListsToAdd>0?range$2(numListsToAdd,(function(){return detail.makeItem()})):[],itemsToRemove=itemComps.slice(numListsRequired);each$1(itemsToRemove,(function(item){return Replacing.remove(container,item)})),each$1(itemsToAdd,(function(item){return Replacing.append(container,item)}));var builtLists=Replacing.contents(container);each$1(builtLists,(function(item,i){detail.setupItem(list,item,items[i],i)}))}))}}}},apis:{setItems:function(apis,list,items){apis.setItems(list,items)}}}),schema$e=constant$1([required$1("dom"),defaulted("shell",!0),field("toolbarBehaviours",[Replacing])]),parts$8=constant$1([optional({name:"groups",overrides:function(){return{behaviours:derive$1([Replacing.config({})])}}})]),Toolbar=composite({name:"Toolbar",configFields:schema$e(),partFields:parts$8(),factory:function(detail,components,_spec,_externals){var getGroupContainer=function(component){return detail.shell?Optional.some(component):getPart(component,detail,"groups")},extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.toolbarBehaviours,extra.behaviours),apis:{setGroups:function(toolbar,groups){getGroupContainer(toolbar).fold((function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")}),(function(container){Replacing.set(container,groups)}))}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)}}}),setup$a=noop,isDocked$2=never,getBehaviours$1=constant$1([]),StaticHeader=Object.freeze({__proto__:null,setup:setup$a,isDocked:isDocked$2,getBehaviours:getBehaviours$1}),getOffsetParent=function(element){return(is$1(getRaw(element,"position"),"fixed")?Optional.none():offsetParent(element)).orThunk((function(){var marker=SugarElement.fromTag("span");return parent(element).bind((function(parent){append$2(parent,marker);var offsetParent$1=offsetParent(marker);return remove$5(marker),offsetParent$1}))}))},getOrigin=function(element){return getOffsetParent(element).map(absolute$3).getOrThunk((function(){return SugarPosition(0,0)}))},morphAdt=Adt_generate([{static:[]},{absolute:["positionCss"]},{fixed:["positionCss"]}]),appear=function(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass),remove$2(elem,contextualInfo.fadeOutClass),add$2(elem,contextualInfo.fadeInClass),contextualInfo.onShow(component)},disappear=function(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass),remove$2(elem,contextualInfo.fadeInClass),add$2(elem,contextualInfo.fadeOutClass),contextualInfo.onHide(component)},isVisibleForModes=function(modes,box,viewport){return forall(modes,(function(mode){switch(mode){case"bottom":return function(box,viewport){return box.bottom<=viewport.bottom}(box,viewport);case"top":return function(box,viewport){return box.y>=viewport.y}(box,viewport)}}))},getPrior=function(elem,state){return state.getInitialPos().map((function(pos){return bounds(pos.bounds.x,pos.bounds.y,get$a(elem),get$b(elem))}))},revertToOriginal=function(elem,box,state){return state.getInitialPos().bind((function(position){switch(state.clearInitialPos(),position.position){case"static":return Optional.some(morphAdt.static());case"absolute":var offsetBox_1=getOffsetParent(elem).map(box$1).getOrThunk((function(){return box$1(body())}));return Optional.some(morphAdt.absolute(NuPositionCss("absolute",get$e(position.style,"left").map((function(_left){return box.x-offsetBox_1.x})),get$e(position.style,"top").map((function(_top){return box.y-offsetBox_1.y})),get$e(position.style,"right").map((function(_right){return offsetBox_1.right-box.right})),get$e(position.style,"bottom").map((function(_bottom){return offsetBox_1.bottom-box.bottom})))));default:return Optional.none()}}))},morphToFixed=function(elem,viewport,state){var box=box$1(elem);if(isVisibleForModes(state.getModes(),box,viewport))return Optional.none();!function(elem,box,state){state.setInitialPos({style:getAllRaw(elem),position:get$c(elem,"position")||"static",bounds:box})}(elem,box,state);var winBox=win(),left=box.x-winBox.x,top_1=viewport.y-winBox.y,bottom=winBox.bottom-viewport.bottom,isTop=box.y<=viewport.y;return Optional.some(morphAdt.fixed(NuPositionCss("fixed",Optional.some(left),isTop?Optional.some(top_1):Optional.none(),Optional.none(),isTop?Optional.none():Optional.some(bottom))))},getMorph=function(component,viewport,state){var elem=component.element;return is$1(getRaw(elem,"position"),"fixed")?function(elem,viewport,state){return getPrior(elem,state).filter((function(box){return isVisibleForModes(state.getModes(),box,viewport)})).bind((function(box){return revertToOriginal(elem,box,state)}))}(elem,viewport,state):morphToFixed(elem,viewport,state)},morphToStatic=function(component,config,state){state.setDocked(!1),each$1(["left","right","top","bottom","position"],(function(prop){return remove$6(component.element,prop)})),config.onUndocked(component)},morphToCoord=function(component,config,state,position){var isDocked="fixed"===position.position;state.setDocked(isDocked),applyPositionCss(component.element,position),(isDocked?config.onDocked:config.onUndocked)(component)},updateVisibility=function(component,config,state,viewport,morphToDocked){void 0===morphToDocked&&(morphToDocked=!1),config.contextual.each((function(contextInfo){contextInfo.lazyContext(component).each((function(box){var isVisible=function(box,viewport){return box.y<viewport.bottom&&box.bottom>viewport.y}(box,viewport);isVisible!==state.isVisible()&&(state.setVisible(isVisible),morphToDocked&&!isVisible?(add$1(component.element,[contextInfo.fadeOutClass]),contextInfo.onHide(component)):(isVisible?appear:disappear)(component,contextInfo))}))}))},resetInternal=function(component,config,state){var elem=component.element;state.setDocked(!1),function(component,state){var elem=component.element;return getPrior(elem,state).bind((function(box){return revertToOriginal(elem,box,state)}))}(component,state).each((function(morph){morph.fold((function(){return morphToStatic(component,config,state)}),(function(position){return morphToCoord(component,config,state,position)}),noop)})),state.setVisible(!0),config.contextual.each((function(contextInfo){remove$1(elem,[contextInfo.fadeInClass,contextInfo.fadeOutClass,contextInfo.transitionClass]),contextInfo.onShow(component)})),refresh$4(component,config,state)},refresh$4=function(component,config,state){component.getSystem().isConnected()&&function(component,config,state){var viewport=config.lazyViewport(component);state.isDocked()&&updateVisibility(component,config,state,viewport),getMorph(component,viewport,state).each((function(morph){morph.fold((function(){return morphToStatic(component,config,state)}),(function(position){return morphToCoord(component,config,state,position)}),(function(position){updateVisibility(component,config,state,viewport,!0),morphToCoord(component,config,state,position)}))}))}(component,config,state)},reset=function(component,config,state){state.isDocked()&&resetInternal(component,config,state)},DockingApis=Object.freeze({__proto__:null,refresh:refresh$4,reset:reset,isDocked:function(component,config,state){return state.isDocked()},getModes:function(component,config,state){return state.getModes()},setModes:function(component,config,state,modes){return state.setModes(modes)}}),ActiveDocking=Object.freeze({__proto__:null,events:function(dockInfo,dockState){return derive$2([runOnSource(transitionend(),(function(component,simulatedEvent){dockInfo.contextual.each((function(contextInfo){has(component.element,contextInfo.transitionClass)&&(remove$1(component.element,[contextInfo.transitionClass,contextInfo.fadeInClass]),(dockState.isVisible()?contextInfo.onShown:contextInfo.onHidden)(component));simulatedEvent.stop()}))})),run$1(windowScroll(),(function(component,_){refresh$4(component,dockInfo,dockState)})),run$1(windowResize(),(function(component,_){reset(component,dockInfo,dockState)}))])}}),DockingSchema=[optionObjOf("contextual",[requiredString("fadeInClass"),requiredString("fadeOutClass"),requiredString("transitionClass"),requiredFunction("lazyContext"),onHandler("onShow"),onHandler("onShown"),onHandler("onHide"),onHandler("onHidden")]),defaultedFunction("lazyViewport",win),defaultedArrayOf("modes",["top","bottom"],string),onHandler("onDocked"),onHandler("onUndocked")],Docking=create$7({fields:DockingSchema,name:"docking",active:ActiveDocking,apis:DockingApis,state:Object.freeze({__proto__:null,init:function(spec){var docked=Cell(!1),visible=Cell(!0),initialBounds=value$1(),modes=Cell(spec.modes);return nu$8({isDocked:docked.get,setDocked:docked.set,getInitialPos:initialBounds.get,setInitialPos:initialBounds.set,clearInitialPos:initialBounds.clear,isVisible:visible.get,setVisible:visible.set,getModes:modes.get,setModes:modes.set,readState:function(){return"docked:  "+docked.get()+", visible: "+visible.get()+", modes: "+modes.get().join(",")}})}})}),toolbarHeightChange=constant$1(generate$6("toolbar-height-change")),visibility={fadeInClass:"tox-editor-dock-fadein",fadeOutClass:"tox-editor-dock-fadeout",transitionClass:"tox-editor-dock-transition"},isDockedMode=function(header,mode){return contains$2(Docking.getModes(header),mode)},updateIframeContentFlow=function(header){var elm=header.element;parent(elm).each((function(parentElem){var padding="padding-"+Docking.getModes(header)[0];if(Docking.isDocked(header)){var parentWidth=get$a(parentElem);set$7(elm,"width",parentWidth+"px"),set$7(parentElem,padding,function(elm){return getOuter$2(elm)+(parseInt(get$c(elm,"margin-top"),10)||0)+(parseInt(get$c(elm,"margin-bottom"),10)||0)}(elm)+"px")}else remove$6(elm,"width"),remove$6(parentElem,padding)}))},updateSinkVisibility=function(sinkElem,visible){visible?(remove$2(sinkElem,visibility.fadeOutClass),add$1(sinkElem,[visibility.transitionClass,visibility.fadeInClass])):(remove$2(sinkElem,visibility.fadeInClass),add$1(sinkElem,[visibility.fadeOutClass,visibility.transitionClass]))},updateEditorClasses=function(editor,docked){var editorContainer=SugarElement.fromDom(editor.getContainer());docked?(add$2(editorContainer,"tox-tinymce--toolbar-sticky-on"),remove$2(editorContainer,"tox-tinymce--toolbar-sticky-off")):(add$2(editorContainer,"tox-tinymce--toolbar-sticky-off"),remove$2(editorContainer,"tox-tinymce--toolbar-sticky-on"))},getBehaviours=function(editor,sharedBackstage){var focusedElm=value$1(),lazySink=sharedBackstage.getSink,runOnSinkElement=function(f){lazySink().each((function(sink){return f(sink.element)}))},onDockingSwitch=function(comp){editor.inline||updateIframeContentFlow(comp),updateEditorClasses(editor,Docking.isDocked(comp)),comp.getSystem().broadcastOn([repositionPopups()],{}),lazySink().each((function(sink){return sink.getSystem().broadcastOn([repositionPopups()],{})}))},additionalBehaviours=editor.inline?[]:function(){var _a;return[Receiving.config({channels:(_a={},_a[toolbarHeightChange()]={onReceive:updateIframeContentFlow},_a)})]}();return __spreadArray([Focusing.config({}),Docking.config({contextual:__assign({lazyContext:function(comp){var headerHeight=getOuter$2(comp.element),container=editor.inline?editor.getContentAreaContainer():editor.getContainer(),box=box$1(SugarElement.fromDom(container)),boxHeight=box.height-headerHeight,topBound=box.y+(isDockedMode(comp,"top")?0:headerHeight);return Optional.some(bounds(box.x,topBound,box.width,boxHeight))},onShow:function(){runOnSinkElement((function(elem){return updateSinkVisibility(elem,!0)}))},onShown:function(comp){runOnSinkElement((function(elem){return remove$1(elem,[visibility.transitionClass,visibility.fadeInClass])})),focusedElm.get().each((function(elem){var headerElem,focusedElem,ownerDoc;headerElem=comp.element,ownerDoc=owner$4(focusedElem=elem),active(ownerDoc).filter((function(activeElm){return!eq(focusedElem,activeElm)})).filter((function(activeElm){return eq(activeElm,SugarElement.fromDom(ownerDoc.dom.body))||contains(headerElem,activeElm)})).each((function(){return focus$3(focusedElem)})),focusedElm.clear()}))},onHide:function(comp){(function(rootElm,lazySink){return search(rootElm).orThunk((function(){return lazySink().toOptional().bind((function(sink){return search(sink.element)}))}))})(comp.element,lazySink).fold(focusedElm.clear,focusedElm.set),runOnSinkElement((function(elem){return updateSinkVisibility(elem,!1)}))},onHidden:function(){runOnSinkElement((function(elem){return remove$1(elem,[visibility.transitionClass])}))}},visibility),lazyViewport:function(comp){var win$1=win(),offset=function(editor){return editor.getParam("toolbar_sticky_offset",0,"number")}(editor),top=win$1.y+(isDockedMode(comp,"top")?offset:0),height=win$1.height-(isDockedMode(comp,"bottom")?offset:0);return bounds(win$1.x,top,win$1.width,height)},modes:[sharedBackstage.header.getDockingMode()],onDocked:onDockingSwitch,onUndocked:onDockingSwitch})],additionalBehaviours,!0)},StickyHeader=Object.freeze({__proto__:null,setup:function(editor,sharedBackstage,lazyHeader){editor.inline||(sharedBackstage.header.isPositionedAtTop()||editor.on("ResizeEditor",(function(){lazyHeader().each(Docking.reset)})),editor.on("ResizeWindow ResizeEditor",(function(){lazyHeader().each(updateIframeContentFlow)})),editor.on("SkinLoaded",(function(){lazyHeader().each((function(comp){Docking.isDocked(comp)?Docking.reset(comp):Docking.refresh(comp)}))})),editor.on("FullscreenStateChanged",(function(){lazyHeader().each(Docking.reset)}))),editor.on("AfterScrollIntoView",(function(e){lazyHeader().each((function(header){Docking.refresh(header);var headerElem=header.element;isVisible(headerElem)&&function(e,containerHeader){var doc=owner$4(containerHeader),viewHeight=doc.dom.defaultView.innerHeight,scrollPos=get$9(doc),markerElement=SugarElement.fromDom(e.elm),markerPos=absolute$2(markerElement),markerHeight=get$b(markerElement),markerTop=markerPos.y,markerBottom=markerTop+markerHeight,editorHeaderPos=absolute$3(containerHeader),editorHeaderHeight=get$b(containerHeader),editorHeaderTop=editorHeaderPos.top,editorHeaderBottom=editorHeaderTop+editorHeaderHeight,editorHeaderDockedAtTop=Math.abs(editorHeaderTop-scrollPos.top)<2,editorHeaderDockedAtBottom=Math.abs(editorHeaderBottom-(scrollPos.top+viewHeight))<2;if(editorHeaderDockedAtTop&&markerTop<editorHeaderBottom)to(scrollPos.left,markerTop-editorHeaderHeight,doc);else if(editorHeaderDockedAtBottom&&markerBottom>editorHeaderTop){var y=markerTop-viewHeight+markerHeight+editorHeaderHeight;to(scrollPos.left,y,doc)}}(e,headerElem)}))})),editor.on("PostRender",(function(){updateEditorClasses(editor,!1)}))},isDocked:function(lazyHeader){return lazyHeader().map(Docking.isDocked).getOr(!1)},getBehaviours:getBehaviours}),groupToolbarButtonSchema=objOf([requiredString("type"),requiredOf("items",oneOf([arrOfObj([requiredString("name"),requiredArrayOf("items",string)]),string]))].concat(baseToolbarButtonFields)),baseMenuButtonFields=[optionString("text"),optionString("tooltip"),optionString("icon"),requiredFunction("fetch"),defaultedFunction("onSetup",(function(){return noop}))],MenuButtonSchema=objOf(__spreadArray([requiredString("type")],baseMenuButtonFields,!0)),createMenuButton=function(spec){return asRaw("menubutton",MenuButtonSchema,spec)},splitButtonSchema=objOf([requiredString("type"),optionString("tooltip"),optionString("icon"),optionString("text"),optionFunction("select"),requiredFunction("fetch"),defaultedFunction("onSetup",(function(){return noop})),defaultedStringEnum("presets","normal",["normal","color","listpreview"]),defaulted("columns",1),requiredFunction("onAction"),requiredFunction("onItemAction")]),SilverMenubar=single({factory:function(detail,spec){var apis={focus:Keying.focusIn,setMenus:function(comp,menus){var newMenus=map$2(menus,(function(m){var buttonSpec={type:"menubutton",text:m.text,fetch:function(callback){callback(m.getItems())}},internal=createMenuButton(buttonSpec).mapError((function(errInfo){return formatError(errInfo)})).getOrDie();return renderMenuButton(internal,"tox-mbtn",spec.backstage,Optional.some("menuitem"))}));Replacing.set(comp,newMenus)}};return{uid:detail.uid,dom:detail.dom,components:[],behaviours:derive$1([Replacing.config({}),config("menubar-events",[runOnAttached((function(component){detail.onSetup(component)})),run$1(mouseover(),(function(comp,se){descendant(comp.element,".tox-mbtn--active").each((function(activeButton){closest$1(se.event.target,".tox-mbtn").each((function(hoveredButton){eq(activeButton,hoveredButton)||comp.getSystem().getByDom(activeButton).each((function(activeComp){comp.getSystem().getByDom(hoveredButton).each((function(hoveredComp){Dropdown.expand(hoveredComp),Dropdown.close(activeComp),Focusing.focus(hoveredComp)}))}))}))}))})),run$1(focusShifted(),(function(comp,se){se.event.prevFocus.bind((function(prev){return comp.getSystem().getByDom(prev).toOptional()})).each((function(prev){se.event.newFocus.bind((function(nu){return comp.getSystem().getByDom(nu).toOptional()})).each((function(nu){Dropdown.isOpen(prev)&&(Dropdown.expand(nu),Dropdown.close(prev))}))}))}))]),Keying.config({mode:"flow",selector:".tox-mbtn",onEscape:function(comp){return detail.onEscape(comp),Optional.some(!0)}}),Tabstopping.config({})]),apis:apis,domModification:{attributes:{role:"menubar"}}}},name:"silver.Menubar",configFields:[required$1("dom"),required$1("uid"),required$1("onEscape"),required$1("backstage"),defaulted("onSetup",noop)],apis:{focus:function(apis,comp){apis.focus(comp)},setMenus:function(apis,comp,menus){apis.setMenus(comp,menus)}}}),getAnimationRoot=function(component,slideConfig){return slideConfig.getAnimationRoot.fold((function(){return component.element}),(function(get){return get(component)}))},getDimensionProperty=function(slideConfig){return slideConfig.dimension.property},getDimension=function(slideConfig,elem){return slideConfig.dimension.getDimension(elem)},disableTransitions=function(component,slideConfig){var root=getAnimationRoot(component,slideConfig);remove$1(root,[slideConfig.shrinkingClass,slideConfig.growingClass])},setShrunk=function(component,slideConfig){remove$2(component.element,slideConfig.openClass),add$2(component.element,slideConfig.closedClass),set$7(component.element,getDimensionProperty(slideConfig),"0px"),reflow(component.element)},setGrown=function(component,slideConfig){remove$2(component.element,slideConfig.closedClass),add$2(component.element,slideConfig.openClass),remove$6(component.element,getDimensionProperty(slideConfig))},doImmediateShrink=function(component,slideConfig,slideState,_calculatedSize){slideState.setCollapsed(),set$7(component.element,getDimensionProperty(slideConfig),getDimension(slideConfig,component.element)),reflow(component.element),disableTransitions(component,slideConfig),setShrunk(component,slideConfig),slideConfig.onStartShrink(component),slideConfig.onShrunk(component)},doStartShrink=function(component,slideConfig,slideState,calculatedSize){var size=calculatedSize.getOrThunk((function(){return getDimension(slideConfig,component.element)}));slideState.setCollapsed(),set$7(component.element,getDimensionProperty(slideConfig),size),reflow(component.element);var root=getAnimationRoot(component,slideConfig);remove$2(root,slideConfig.growingClass),add$2(root,slideConfig.shrinkingClass),setShrunk(component,slideConfig),slideConfig.onStartShrink(component)},doStartSmartShrink=function(component,slideConfig,slideState){var size=getDimension(slideConfig,component.element);("0px"===size?doImmediateShrink:doStartShrink)(component,slideConfig,slideState,Optional.some(size))},doStartGrow=function(component,slideConfig,slideState){var root=getAnimationRoot(component,slideConfig),wasShrinking=has(root,slideConfig.shrinkingClass),beforeSize=getDimension(slideConfig,component.element);setGrown(component,slideConfig);var fullSize=getDimension(slideConfig,component.element);(wasShrinking?function(){set$7(component.element,getDimensionProperty(slideConfig),beforeSize),reflow(component.element)}:function(){setShrunk(component,slideConfig)})(),remove$2(root,slideConfig.shrinkingClass),add$2(root,slideConfig.growingClass),setGrown(component,slideConfig),set$7(component.element,getDimensionProperty(slideConfig),fullSize),slideState.setExpanded(),slideConfig.onStartGrow(component)},isGrowing=function(component,slideConfig,_slideState){var root=getAnimationRoot(component,slideConfig);return!0===has(root,slideConfig.growingClass)},isShrinking=function(component,slideConfig,_slideState){var root=getAnimationRoot(component,slideConfig);return!0===has(root,slideConfig.shrinkingClass)},SlidingApis=Object.freeze({__proto__:null,refresh:function(component,slideConfig,slideState){if(slideState.isExpanded()){remove$6(component.element,getDimensionProperty(slideConfig));var fullSize=getDimension(slideConfig,component.element);set$7(component.element,getDimensionProperty(slideConfig),fullSize)}},grow:function(component,slideConfig,slideState){slideState.isExpanded()||doStartGrow(component,slideConfig,slideState)},shrink:function(component,slideConfig,slideState){slideState.isExpanded()&&doStartSmartShrink(component,slideConfig,slideState)},immediateShrink:function(component,slideConfig,slideState){slideState.isExpanded()&&doImmediateShrink(component,slideConfig,slideState)},hasGrown:function(component,slideConfig,slideState){return slideState.isExpanded()},hasShrunk:function(component,slideConfig,slideState){return slideState.isCollapsed()},isGrowing:isGrowing,isShrinking:isShrinking,isTransitioning:function(component,slideConfig,slideState){return isGrowing(component,slideConfig)||isShrinking(component,slideConfig)},toggleGrow:function(component,slideConfig,slideState){(slideState.isExpanded()?doStartSmartShrink:doStartGrow)(component,slideConfig,slideState)},disableTransitions:disableTransitions}),ActiveSliding=Object.freeze({__proto__:null,exhibit:function(base,slideConfig,_slideState){var expanded=slideConfig.expanded;return nu$7(expanded?{classes:[slideConfig.openClass],styles:{}}:{classes:[slideConfig.closedClass],styles:wrap$1(slideConfig.dimension.property,"0px")})},events:function(slideConfig,slideState){return derive$2([runOnSource(transitionend(),(function(component,simulatedEvent){simulatedEvent.event.raw.propertyName===slideConfig.dimension.property&&(disableTransitions(component,slideConfig),slideState.isExpanded()&&remove$6(component.element,slideConfig.dimension.property),(slideState.isExpanded()?slideConfig.onGrown:slideConfig.onShrunk)(component))}))])}}),SlidingSchema=[required$1("closedClass"),required$1("openClass"),required$1("shrinkingClass"),required$1("growingClass"),option("getAnimationRoot"),onHandler("onShrunk"),onHandler("onStartShrink"),onHandler("onGrown"),onHandler("onStartGrow"),defaulted("expanded",!1),requiredOf("dimension",choose$1("property",{width:[output$1("property","width"),output$1("getDimension",(function(elem){return get$a(elem)+"px"}))],height:[output$1("property","height"),output$1("getDimension",(function(elem){return get$b(elem)+"px"}))]}))],Sliding=create$7({fields:SlidingSchema,name:"sliding",active:ActiveSliding,apis:SlidingApis,state:Object.freeze({__proto__:null,init:function(spec){var state=Cell(spec.expanded);return nu$8({isExpanded:function(){return!0===state.get()},isCollapsed:function(){return!1===state.get()},setCollapsed:curry(state.set,!1),setExpanded:curry(state.set,!0),readState:function(){return"expanded: "+state.get()}})}})}),schema$d=[field("slotBehaviours",[])],getPartName=function(name){return"<alloy.field."+name+">"},make$1=function(detail,components){var f,getSlotNames=function(_){return getAllPartNames(detail)},onSlot=function(f,def){return function(container,key){return getPart(container,detail,key).map((function(slot){return f(slot,key)})).getOr(def)}},doShowing=function(comp,_key){return"true"!==get$d(comp.element,"aria-hidden")},isShowing=onSlot(doShowing,!1),hideSlot=onSlot((function(comp,key){if(doShowing(comp)){var element=comp.element;set$7(element,"display","none"),set$8(element,"aria-hidden","true"),emitWith(comp,slotVisibility(),{name:key,visible:!1})}})),hideSlots=(f=hideSlot,function(container,keys){each$1(keys,(function(key){return f(container,key)}))}),showSlot=onSlot((function(comp,key){if(!doShowing(comp)){var element=comp.element;remove$6(element,"display"),remove$7(element,"aria-hidden"),emitWith(comp,slotVisibility(),{name:key,visible:!0})}})),apis={getSlotNames:getSlotNames,getSlot:function(container,key){return getPart(container,detail,key)},isShowing:isShowing,hideSlot:hideSlot,hideAllSlots:function(container){return hideSlots(container,getSlotNames())},showSlot:showSlot};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.slotBehaviours),apis:apis}},slotApis=map$1({getSlotNames:function(apis,c){return apis.getSlotNames(c)},getSlot:function(apis,c,key){return apis.getSlot(c,key)},isShowing:function(apis,c,key){return apis.isShowing(c,key)},hideSlot:function(apis,c,key){return apis.hideSlot(c,key)},hideAllSlots:function(apis,c){return apis.hideAllSlots(c)},showSlot:function(apis,c,key){return apis.showSlot(c,key)}},(function(value){return makeApi(value)})),SlotContainer=__assign(__assign({},slotApis),{sketch:function(sSpec){var parts=function(){var record=[];return{slot:function(name,config){return record.push(name),generateOne$1("container",getPartName(name),config)},record:constant$1(record)}}(),spec=sSpec(parts),partNames=parts.record(),fieldParts=map$2(partNames,(function(n){return required({name:n,pname:getPartName(n)})}));return composite$1("container",schema$d,fieldParts,make$1,spec)}}),sidebarSchema=objOf([optionString("icon"),optionString("tooltip"),defaultedFunction("onShow",noop),defaultedFunction("onHide",noop),defaultedFunction("onSetup",(function(){return noop}))]),getApi=function(comp){return{element:function(){return comp.element.dom}}},makePanels=function(parts,panelConfigs){var specs=map$2(keys(panelConfigs),(function(name){var spec=panelConfigs[name],bridged=getOrDie(function(spec){return asRaw("sidebar",sidebarSchema,spec)}(spec));return{name:name,getApi:getApi,onSetup:bridged.onSetup,onShow:bridged.onShow,onHide:bridged.onHide}}));return map$2(specs,(function(spec){var editorOffCell=Cell(noop);return parts.slot(spec.name,{dom:{tag:"div",classes:["tox-sidebar__pane"]},behaviours:SimpleBehaviours_unnamedEvents([onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell),run$1(slotVisibility(),(function(sidepanel,se){var data=se.event;find$5(specs,(function(config){return config.name===data.name})).each((function(sidePanelSpec){(data.visible?sidePanelSpec.onShow:sidePanelSpec.onHide)(sidePanelSpec.getApi(sidepanel))}))}))])})}))},makeSidebar=function(panelConfigs){return SlotContainer.sketch((function(parts){return{dom:{tag:"div",classes:["tox-sidebar__pane-container"]},components:makePanels(parts,panelConfigs),slotBehaviours:SimpleBehaviours_unnamedEvents([runOnAttached((function(slotContainer){return SlotContainer.hideAllSlots(slotContainer)}))])}}))},whichSidebar=function(sidebar){return Composing.getCurrent(sidebar).bind((function(slider){return Sliding.isGrowing(slider)||Sliding.hasGrown(slider)?Composing.getCurrent(slider).bind((function(slotContainer){return find$5(SlotContainer.getSlotNames(slotContainer),(function(name){return SlotContainer.isShowing(slotContainer,name)}))})):Optional.none()}))},fixSize=generate$6("FixSizeEvent"),autoSize=generate$6("AutoSizeEvent"),BlockingApis=Object.freeze({__proto__:null,block:function(component,config,state,getBusySpec){set$8(component.element,"aria-busy",!0);var root=config.getRoot(component).getOr(component),blockerBehaviours=derive$1([Keying.config({mode:"special",onTab:function(){return Optional.some(!0)},onShiftTab:function(){return Optional.some(!0)}}),Focusing.config({})]),blockSpec=getBusySpec(root,blockerBehaviours),blocker=root.getSystem().build(blockSpec);Replacing.append(root,premade(blocker)),blocker.hasConfigured(Keying)&&config.focus&&Keying.focusIn(blocker),state.isBlocked()||config.onBlock(component),state.blockWith((function(){return Replacing.remove(root,blocker)}))},unblock:function(component,config,state){remove$7(component.element,"aria-busy"),state.isBlocked()&&config.onUnblock(component),state.clear()}}),BlockingSchema=[defaultedFunction("getRoot",Optional.none),defaultedBoolean("focus",!0),onHandler("onBlock"),onHandler("onUnblock")],Blocking=create$7({fields:BlockingSchema,name:"blocking",apis:BlockingApis,state:Object.freeze({__proto__:null,init:function(){var blocker=destroyable();return nu$8({readState:blocker.isSet,blockWith:function(destroy){blocker.set({destroy:destroy})},clear:blocker.clear,isBlocked:blocker.isSet})}})}),fromHtml=function(html){var elem=SugarElement.fromHtml(html),children$1=children(elem),attrs=function(elem){var attributes=void 0!==elem.dom.attributes?elem.dom.attributes:[];return foldl(attributes,(function(b,attr){var _a;return"class"===attr.name?b:__assign(__assign({},b),((_a={})[attr.name]=attr.value,_a))}),{})}(elem),classes=function(elem){return Array.prototype.slice.call(elem.dom.classList,0)}(elem),contents=0===children$1.length?{}:{innerHtml:get$7(elem)};return __assign({tag:name$2(elem),classes:classes,attributes:attrs},contents)},focusBusyComponent=function(throbber){return Composing.getCurrent(throbber).each((function(comp){return focus$3(comp.element)}))},toggleThrobber=function(editor,comp,state,providerBackstage){var element=comp.element;if(function(editor,state){Optional.from(editor.iframeElement).map(SugarElement.fromDom).each((function(iframe){state?(getOpt(iframe,"tabindex").each((function(tabIndex){return set$8(iframe,"data-mce-tabindex",tabIndex)})),set$8(iframe,"tabindex",-1)):(remove$7(iframe,"tabindex"),getOpt(iframe,"data-mce-tabindex").each((function(tabIndex){set$8(iframe,"tabindex",tabIndex),remove$7(iframe,"data-mce-tabindex")})))}))}(editor,state),state)Blocking.block(comp,function(providerBackstage){return function(_root,_behaviours){return{dom:{tag:"div",attributes:{"aria-label":providerBackstage.translate("Loading..."),tabindex:"0"},classes:["tox-throbber__busy-spinner"]},components:[{dom:fromHtml('<div class="tox-spinner"><div></div><div></div><div></div></div>')}]}}}(providerBackstage)),remove$6(element,"display"),remove$7(element,"aria-hidden"),editor.hasFocus()&&focusBusyComponent(comp);else{var throbberFocus=Composing.getCurrent(comp).exists((function(busyComp){return hasFocus(busyComp.element)}));Blocking.unblock(comp),set$7(element,"display","none"),set$8(element,"aria-hidden","true"),throbberFocus&&editor.focus()}},setup$7=function(editor,lazyThrobber,sharedBackstage){var throbberState=Cell(!1),timer=value$1(),stealFocus=function(e){var event;!throbberState.get()||function(event){return"focusin"===event.type}(event=e)&&(event.composed?head(event.composedPath()):Optional.from(event.target)).map(SugarElement.fromDom).filter(isElement$2).exists((function(targetElm){return has(targetElm,"mce-pastebin")}))||(e.preventDefault(),focusBusyComponent(lazyThrobber()),editor.editorManager.setActive(editor))};editor.inline||editor.on("PreInit",(function(){editor.dom.bind(editor.getWin(),"focusin",stealFocus),editor.on("BeforeExecCommand",(function(e){"mcefocus"===e.command.toLowerCase()&&!0!==e.value&&stealFocus(e)}))}));var toggle=function(state){state!==throbberState.get()&&(throbberState.set(state),toggleThrobber(editor,lazyThrobber(),state,sharedBackstage.providers),editor.fire("AfterProgressState",{state:state}))};editor.on("ProgressState",(function(e){if(timer.on(global$f.clearTimeout),isNumber(e.time)){var timerId=global$f.setEditorTimeout(editor,(function(){return toggle(e.state)}),e.time);timer.set(timerId)}else toggle(e.state),timer.clear()}))},output=function(within,extra,withinWidth){return{within:within,extra:extra,withinWidth:withinWidth}},apportion=function(units,total,len){var f,parray=(f=function(unit,current){var width=len(unit);return Optional.some({element:unit,start:current,finish:current+width,width:width})},foldl(units,(function(b,a){return f(a,b.len).fold(constant$1(b),(function(v){return{len:v.finish,list:b.list.concat([v])}}))}),{len:0,list:[]}).list),within=filter$2(parray,(function(unit){return unit.finish<=total})),withinWidth=foldr(within,(function(acc,el){return acc+el.width}),0);return{within:within,extra:parray.slice(within.length),withinWidth:withinWidth}},toUnit=function(parray){return map$2(parray,(function(unit){return unit.element}))},partition=function(total,units,len,overflower){var divide=function(total,units,len){var divide=apportion(units,total,len);return 0===divide.extra.length?Optional.some(divide):Optional.none()}(total,units,len).getOrThunk((function(){return apportion(units,total-len(overflower),len)})),within=divide.within,extra=divide.extra,withinWidth=divide.withinWidth;return 1===extra.length&&extra[0].width<=len(overflower)?function(within,extra,withinWidth){var fits=toUnit(within.concat(extra));return output(fits,[],withinWidth)}(within,extra,withinWidth):extra.length>=1?function(within,extra,overflower,withinWidth){var fits=toUnit(within).concat([overflower]);return output(fits,toUnit(extra),withinWidth)}(within,extra,overflower,withinWidth):function(within,extra,withinWidth){return output(toUnit(within),[],withinWidth)}(within,0,withinWidth)},setGroups$1=function(toolbar,storedGroups){var bGroups=map$2(storedGroups,(function(g){return premade(g)}));Toolbar.setGroups(toolbar,bGroups)},refresh$2=function(toolbar,detail,setOverflow){var builtGroups=detail.builtGroups.get();if(0!==builtGroups.length){var primary=getPartOrDie(toolbar,detail,"primary"),overflowGroup=Coupling.getCoupled(toolbar,"overflowGroup");set$7(primary.element,"visibility","hidden");var groups=builtGroups.concat([overflowGroup]),focusedComp=findMap(groups,(function(comp){return search(comp.element).bind((function(focusedElm){return comp.getSystem().getByDom(focusedElm).toOptional()}))}));setOverflow([]),setGroups$1(primary,groups);var availableWidth=get$a(primary.element),overflows=partition(availableWidth,detail.builtGroups.get(),(function(comp){return get$a(comp.element)}),overflowGroup);0===overflows.extra.length?(Replacing.remove(primary,overflowGroup),setOverflow([])):(setGroups$1(primary,overflows.within),setOverflow(overflows.extra)),remove$6(primary.element,"visibility"),reflow(primary.element),focusedComp.each(Focusing.focus)}},schema$c=constant$1([field("splitToolbarBehaviours",[Coupling]),customField("builtGroups",(function(){return Cell([])}))]),schema$b=constant$1([markers$1(["overflowToggledClass"]),optionFunction("getOverflowBounds"),required$1("lazySink"),customField("overflowGroups",(function(){return Cell([])}))].concat(schema$c())),parts$7=constant$1([required({factory:Toolbar,schema:schema$e(),name:"primary"}),external$1({schema:schema$e(),name:"overflow"}),external$1({name:"overflow-button"}),external$1({name:"overflow-group"})]),expandable=constant$1((function(element,available){!function(element,value){var absMax=api$2.max(element,value,["margin-left","border-left-width","padding-left","padding-right","border-right-width","margin-right"]);set$7(element,"max-width",absMax+"px")}(element,Math.floor(available))})),schema$a=constant$1([markers$1(["toggledClass"]),required$1("lazySink"),requiredFunction("fetch"),optionFunction("getBounds"),optionObjOf("fireDismissalEventInstead",[defaulted("event",dismissRequested())]),schema$y()]),parts$6=constant$1([external$1({name:"button",overrides:function(detail){return{dom:{attributes:{"aria-haspopup":"true"}},buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.toggledClass,aria:{mode:"expanded"},toggleOnExecute:!1})])}}}),external$1({factory:Toolbar,schema:schema$e(),name:"toolbar",overrides:function(detail){return{toolbarBehaviours:derive$1([Keying.config({mode:"cyclic",onEscape:function(comp){return getPart(comp,detail,"button").each(Focusing.focus),Optional.none()}})])}}})]),toggle=function(button,externals){var toolbarSandbox=Coupling.getCoupled(button,"toolbarSandbox");Sandboxing.isOpen(toolbarSandbox)?Sandboxing.close(toolbarSandbox):Sandboxing.open(toolbarSandbox,externals.toolbar())},position=function(button,toolbar,detail,layouts){var bounds=detail.getBounds.map((function(bounder){return bounder()})),sink=detail.lazySink(button).getOrDie();Positioning.positionWithinBounds(sink,toolbar,{anchor:{type:"hotspot",hotspot:button,layouts:layouts,overrides:{maxWidthFunction:expandable()}}},bounds)},setGroups=function(button,toolbar,detail,layouts,groups){Toolbar.setGroups(toolbar,groups),position(button,toolbar,detail,layouts),Toggling.on(button)},FloatingToolbarButton=composite({name:"FloatingToolbarButton",factory:function(detail,components,spec,externals){return __assign(__assign({},Button.sketch(__assign(__assign({},externals.button()),{action:function(button){toggle(button,externals)},buttonBehaviours:SketchBehaviours_augment({dump:externals.button().buttonBehaviours},[Coupling.config({others:{toolbarSandbox:function(button){return function(button,spec,detail){var ariaOwner=manager();return{dom:{tag:"div",attributes:{id:ariaOwner.id}},behaviours:derive$1([Keying.config({mode:"special",onEscape:function(comp){return Sandboxing.close(comp),Optional.some(!0)}}),Sandboxing.config({onOpen:function(sandbox,toolbar){detail.fetch().get((function(groups){setGroups(button,toolbar,detail,spec.layouts,groups),ariaOwner.link(button.element),Keying.focusIn(toolbar)}))},onClose:function(){Toggling.off(button),Focusing.focus(button),ariaOwner.unlink(button.element)},isPartOf:function(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(button,queryElem)},getAttachPoint:function(){return detail.lazySink(button).getOrDie()}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1(__assign({isExtraPart:never},detail.fireDismissalEventInstead.map((function(fe){return{fireEventInstead:{event:fe.event}}})).getOr({})))),receivingChannel({doReposition:function(){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each((function(toolbar){position(button,toolbar,detail,spec.layouts)}))}}))})])}}(button,spec,detail)}}})])}))),{apis:{setGroups:function(button,groups){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each((function(toolbar){setGroups(button,toolbar,detail,spec.layouts,groups)}))},reposition:function(button){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each((function(toolbar){position(button,toolbar,detail,spec.layouts)}))},toggle:function(button){toggle(button,externals)},getToolbar:function(button){return Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox"))},isOpen:function(button){return Sandboxing.isOpen(Coupling.getCoupled(button,"toolbarSandbox"))}}})},configFields:schema$a(),partFields:parts$6(),apis:{setGroups:function(apis,button,groups){apis.setGroups(button,groups)},reposition:function(apis,button){apis.reposition(button)},toggle:function(apis,button){apis.toggle(button)},getToolbar:function(apis,button){return apis.getToolbar(button)},isOpen:function(apis,button){return apis.isOpen(button)}}}),schema$9=constant$1([required$1("items"),markers$1(["itemSelector"]),field("tgroupBehaviours",[Keying])]),parts$5=constant$1([group({name:"items",unit:"item"})]),ToolbarGroup=composite({name:"ToolbarGroup",configFields:schema$9(),partFields:parts$5(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.tgroupBehaviours,[Keying.config({mode:"flow",selector:detail.markers.itemSelector})]),domModification:{attributes:{role:"toolbar"}}}}}),buildGroups=function(comps){return map$2(comps,(function(g){return premade(g)}))},refresh$1=function(toolbar,memFloatingToolbarButton,detail){refresh$2(toolbar,detail,(function(overflowGroups){detail.overflowGroups.set(overflowGroups),memFloatingToolbarButton.getOpt(toolbar).each((function(floatingToolbarButton){FloatingToolbarButton.setGroups(floatingToolbarButton,buildGroups(overflowGroups))}))}))},SplitFloatingToolbar=composite({name:"SplitFloatingToolbar",configFields:schema$b(),partFields:parts$7(),factory:function(detail,components,spec,externals){var memFloatingToolbarButton=record(FloatingToolbarButton.sketch({fetch:function(){return Future_nu((function(resolve){resolve(buildGroups(detail.overflowGroups.get()))}))},layouts:{onLtr:function(){return[southwest$2,southeast$2]},onRtl:function(){return[southeast$2,southwest$2]},onBottomLtr:function(){return[northwest$2,northeast$2]},onBottomRtl:function(){return[northeast$2,northwest$2]}},getBounds:spec.getOverflowBounds,lazySink:detail.lazySink,fireDismissalEventInstead:{},markers:{toggledClass:detail.markers.overflowToggledClass},parts:{button:externals["overflow-button"](),toolbar:externals.overflow()}}));return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function(){return ToolbarGroup.sketch(__assign(__assign({},externals["overflow-group"]()),{items:[memFloatingToolbarButton.asSpec()]}))}}})]),apis:{setGroups:function(toolbar,groups){detail.builtGroups.set(map$2(groups,toolbar.getSystem().build)),refresh$1(toolbar,memFloatingToolbarButton,detail)},refresh:function(toolbar){return refresh$1(toolbar,memFloatingToolbarButton,detail)},toggle:function(toolbar){memFloatingToolbarButton.getOpt(toolbar).each((function(floatingToolbarButton){FloatingToolbarButton.toggle(floatingToolbarButton)}))},isOpen:function(toolbar){return memFloatingToolbarButton.getOpt(toolbar).map(FloatingToolbarButton.isOpen).getOr(!1)},reposition:function(toolbar){memFloatingToolbarButton.getOpt(toolbar).each((function(floatingToolbarButton){FloatingToolbarButton.reposition(floatingToolbarButton)}))},getOverflow:function(toolbar){return memFloatingToolbarButton.getOpt(toolbar).bind(FloatingToolbarButton.getToolbar)}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)},refresh:function(apis,toolbar){apis.refresh(toolbar)},reposition:function(apis,toolbar){apis.reposition(toolbar)},toggle:function(apis,toolbar){apis.toggle(toolbar)},isOpen:function(apis,toolbar){return apis.isOpen(toolbar)},getOverflow:function(apis,toolbar){return apis.getOverflow(toolbar)}}}),schema$8=constant$1([markers$1(["closedClass","openClass","shrinkingClass","growingClass","overflowToggledClass"]),onHandler("onOpened"),onHandler("onClosed")].concat(schema$c())),parts$4=constant$1([required({factory:Toolbar,schema:schema$e(),name:"primary"}),required({factory:Toolbar,schema:schema$e(),name:"overflow",overrides:function(detail){return{toolbarBehaviours:derive$1([Sliding.config({dimension:{property:"height"},closedClass:detail.markers.closedClass,openClass:detail.markers.openClass,shrinkingClass:detail.markers.shrinkingClass,growingClass:detail.markers.growingClass,onShrunk:function(comp){getPart(comp,detail,"overflow-button").each((function(button){Toggling.off(button),Focusing.focus(button)})),detail.onClosed(comp)},onGrown:function(comp){Keying.focusIn(comp),detail.onOpened(comp)},onStartGrow:function(comp){getPart(comp,detail,"overflow-button").each(Toggling.on)}}),Keying.config({mode:"acyclic",onEscape:function(comp){return getPart(comp,detail,"overflow-button").each(Focusing.focus),Optional.some(!0)}})])}}}),external$1({name:"overflow-button",overrides:function(detail){return{buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.overflowToggledClass,aria:{mode:"pressed"},toggleOnExecute:!1})])}}}),external$1({name:"overflow-group"})]),toggleToolbar=function(toolbar,detail){getPart(toolbar,detail,"overflow-button").bind((function(){return getPart(toolbar,detail,"overflow")})).each((function(overf){refresh(toolbar,detail),Sliding.toggleGrow(overf)}))},refresh=function(toolbar,detail){getPart(toolbar,detail,"overflow").each((function(overflow){refresh$2(toolbar,detail,(function(groups){var builtGroups=map$2(groups,(function(g){return premade(g)}));Toolbar.setGroups(overflow,builtGroups)})),getPart(toolbar,detail,"overflow-button").each((function(button){Sliding.hasGrown(overflow)&&Toggling.on(button)})),Sliding.refresh(overflow)}))},SplitSlidingToolbar=composite({name:"SplitSlidingToolbar",configFields:schema$8(),partFields:parts$4(),factory:function(detail,components,spec,externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function(toolbar){return ToolbarGroup.sketch(__assign(__assign({},externals["overflow-group"]()),{items:[Button.sketch(__assign(__assign({},externals["overflow-button"]()),{action:function(_button){emit(toolbar,"alloy.toolbar.toggle")}}))]}))}}}),config("toolbar-toggle-events",[run$1("alloy.toolbar.toggle",(function(toolbar){toggleToolbar(toolbar,detail)}))])]),apis:{setGroups:function(toolbar,groups){!function(toolbar,groups){var built=map$2(groups,toolbar.getSystem().build);detail.builtGroups.set(built)}(toolbar,groups),refresh(toolbar,detail)},refresh:function(toolbar){return refresh(toolbar,detail)},toggle:function(toolbar){return toggleToolbar(toolbar,detail)},isOpen:function(toolbar){return function(toolbar,detail){return getPart(toolbar,detail,"overflow").map(Sliding.hasGrown).getOr(!1)}(toolbar,detail)}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)},refresh:function(apis,toolbar){apis.refresh(toolbar)},toggle:function(apis,toolbar){apis.toggle(toolbar)},isOpen:function(apis,toolbar){return apis.isOpen(toolbar)}}}),renderToolbarGroupCommon=function(toolbarGroup){var attributes=toolbarGroup.title.fold((function(){return{}}),(function(title){return{attributes:{title:title}}}));return{dom:__assign({tag:"div",classes:["tox-toolbar__group"]},attributes),components:[ToolbarGroup.parts.items({})],items:toolbarGroup.items,markers:{itemSelector:"*:not(.tox-split-button) > .tox-tbtn:not([disabled]), .tox-split-button:not([disabled]), .tox-toolbar-nav-js:not([disabled])"},tgroupBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])}},renderToolbarGroup=function(toolbarGroup){return ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup))},getToolbarbehaviours=function(toolbarSpec,modeName){var onAttached=runOnAttached((function(component){var groups=map$2(toolbarSpec.initGroups,renderToolbarGroup);Toolbar.setGroups(component,groups)}));return derive$1([DisablingConfigs_toolbarButton(toolbarSpec.providers.isDisabled),receivingConfig(),Keying.config({mode:modeName,onEscape:toolbarSpec.onEscape,selector:".tox-toolbar__group"}),config("toolbar-events",[onAttached])])},renderMoreToolbarCommon=function(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?"cyclic":"acyclic";return{uid:toolbarSpec.uid,dom:{tag:"div",classes:["tox-toolbar-overlord"]},parts:{"overflow-group":renderToolbarGroupCommon({title:Optional.none(),items:[]}),"overflow-button":renderIconButtonSpec({name:"more",icon:Optional.some("more-drawer"),disabled:!1,tooltip:Optional.some("More..."),primary:!1,borderless:!1},Optional.none(),toolbarSpec.providers)},splitToolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)}},renderFloatingMoreToolbar=function(toolbarSpec){var baseSpec=renderMoreToolbarCommon(toolbarSpec),primary=SplitFloatingToolbar.parts.primary({dom:{tag:"div",classes:["tox-toolbar__primary"]}});return SplitFloatingToolbar.sketch(__assign(__assign({},baseSpec),{lazySink:toolbarSpec.getSink,getOverflowBounds:function(){var headerElem=toolbarSpec.moreDrawerData.lazyHeader().element,headerBounds=absolute$2(headerElem),docElem=documentElement(headerElem),docBounds=absolute$2(docElem),height=Math.max(docElem.dom.scrollHeight,docBounds.height);return bounds(headerBounds.x+4,docBounds.y,headerBounds.width-8,height)},parts:__assign(__assign({},baseSpec.parts),{overflow:{dom:{tag:"div",classes:["tox-toolbar__overflow"],attributes:toolbarSpec.attributes}}}),components:[primary],markers:{overflowToggledClass:"tox-tbtn--enabled"}}))},renderSlidingMoreToolbar=function(toolbarSpec){var primary=SplitSlidingToolbar.parts.primary({dom:{tag:"div",classes:["tox-toolbar__primary"]}}),overflow=SplitSlidingToolbar.parts.overflow({dom:{tag:"div",classes:["tox-toolbar__overflow"]}}),baseSpec=renderMoreToolbarCommon(toolbarSpec);return SplitSlidingToolbar.sketch(__assign(__assign({},baseSpec),{components:[primary,overflow],markers:{openClass:"tox-toolbar__overflow--open",closedClass:"tox-toolbar__overflow--closed",growingClass:"tox-toolbar__overflow--growing",shrinkingClass:"tox-toolbar__overflow--shrinking",overflowToggledClass:"tox-tbtn--enabled"},onOpened:function(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:"opened"})},onClosed:function(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:"closed"})}}))},renderToolbar=function(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?"cyclic":"acyclic";return Toolbar.sketch({uid:toolbarSpec.uid,dom:{tag:"div",classes:["tox-toolbar"].concat(toolbarSpec.type===ToolbarMode.scrolling?["tox-toolbar--scrolling"]:[])},components:[Toolbar.parts.groups({})],toolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)})},partMenubar=partType.optional({factory:SilverMenubar,name:"menubar",schema:[required$1("backstage")]}),partMultipleToolbar=partType.optional({factory:{sketch:function(spec){return CustomList.sketch({uid:spec.uid,dom:spec.dom,listBehaviours:derive$1([Keying.config({mode:"acyclic",selector:".tox-toolbar"})]),makeItem:function(){return renderToolbar({type:spec.type,uid:generate$6("multiple-toolbar-item"),cyclicKeying:!1,initGroups:[],providers:spec.providers,onEscape:function(){return spec.onEscape(),Optional.some(!0)}})},setupItem:function(_mToolbar,tc,data,_index){Toolbar.setGroups(tc,data)},shell:!0})}},name:"multiple-toolbar",schema:[required$1("dom"),required$1("onEscape")]}),partToolbar=partType.optional({factory:{sketch:function(spec){return function(spec){return spec.type===ToolbarMode.sliding?renderSlidingMoreToolbar:spec.type===ToolbarMode.floating?renderFloatingMoreToolbar:renderToolbar}(spec)({type:spec.type,uid:spec.uid,onEscape:function(){return spec.onEscape(),Optional.some(!0)},cyclicKeying:!1,initGroups:[],getSink:spec.getSink,providers:spec.providers,moreDrawerData:{lazyToolbar:spec.lazyToolbar,lazyMoreButton:spec.lazyMoreButton,lazyHeader:spec.lazyHeader},attributes:spec.attributes})}},name:"toolbar",schema:[required$1("dom"),required$1("onEscape"),required$1("getSink")]}),partHeader=partType.optional({factory:{sketch:function(spec){var editor=spec.editor,getBehaviours$2=spec.sticky?getBehaviours:getBehaviours$1;return{uid:spec.uid,dom:spec.dom,components:spec.components,behaviours:derive$1(getBehaviours$2(editor,spec.sharedBackstage))}}},name:"header",schema:[required$1("dom")]}),partSocket=partType.optional({name:"socket",schema:[required$1("dom")]}),partSidebar=partType.optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"div",classes:["tox-sidebar"],attributes:{role:"complementary"}},components:[{dom:{tag:"div",classes:["tox-sidebar__slider"]},components:[],behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),Sliding.config({dimension:{property:"width"},closedClass:"tox-sidebar--sliding-closed",openClass:"tox-sidebar--sliding-open",shrinkingClass:"tox-sidebar--sliding-shrinking",growingClass:"tox-sidebar--sliding-growing",onShrunk:function(slider){Composing.getCurrent(slider).each(SlotContainer.hideAllSlots),emit(slider,autoSize)},onGrown:function(slider){emit(slider,autoSize)},onStartGrow:function(slider){emitWith(slider,fixSize,{width:getRaw(slider.element,"width").getOr("")})},onStartShrink:function(slider){emitWith(slider,fixSize,{width:get$a(slider.element)+"px"})}}),Replacing.config({}),Composing.config({find:function(comp){var children=Replacing.contents(comp);return head(children)}})])}],behaviours:derive$1([ComposingConfigs_childAt(0),config("sidebar-sliding-events",[run$1(fixSize,(function(comp,se){set$7(comp.element,"width",se.event.width)})),run$1(autoSize,(function(comp,_se){remove$6(comp.element,"width")}))])])}}},name:"sidebar",schema:[required$1("dom")]}),partThrobber=partType.optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"div",attributes:{"aria-hidden":"true"},classes:["tox-throbber"],styles:{display:"none"}},behaviours:derive$1([Replacing.config({}),Blocking.config({focus:!1}),Composing.config({find:function(comp){return head(comp.components())}})]),components:[]}}},name:"throbber",schema:[required$1("dom")]}),OuterContainer=composite({name:"OuterContainer",factory:function(detail,components,_spec){var apis={getSocket:function(comp){return parts$a.getPart(comp,detail,"socket")},setSidebar:function(comp,panelConfigs){parts$a.getPart(comp,detail,"sidebar").each((function(sidebar){return function(sidebar,panelConfigs){Composing.getCurrent(sidebar).each((function(slider){return Replacing.set(slider,[makeSidebar(panelConfigs)])}))}(sidebar,panelConfigs)}))},toggleSidebar:function(comp,name){parts$a.getPart(comp,detail,"sidebar").each((function(sidebar){return function(sidebar,name){Composing.getCurrent(sidebar).each((function(slider){Composing.getCurrent(slider).each((function(slotContainer){Sliding.hasGrown(slider)?SlotContainer.isShowing(slotContainer,name)?Sliding.shrink(slider):(SlotContainer.hideAllSlots(slotContainer),SlotContainer.showSlot(slotContainer,name)):(SlotContainer.hideAllSlots(slotContainer),SlotContainer.showSlot(slotContainer,name),Sliding.grow(slider))}))}))}(sidebar,name)}))},whichSidebar:function(comp){return parts$a.getPart(comp,detail,"sidebar").bind(whichSidebar).getOrNull()},getHeader:function(comp){return parts$a.getPart(comp,detail,"header")},getToolbar:function(comp){return parts$a.getPart(comp,detail,"toolbar")},setToolbar:function(comp,groups){parts$a.getPart(comp,detail,"toolbar").each((function(toolbar){toolbar.getApis().setGroups(toolbar,groups)}))},setToolbars:function(comp,toolbars){parts$a.getPart(comp,detail,"multiple-toolbar").each((function(mToolbar){CustomList.setItems(mToolbar,toolbars)}))},refreshToolbar:function(comp){parts$a.getPart(comp,detail,"toolbar").each((function(toolbar){return toolbar.getApis().refresh(toolbar)}))},toggleToolbarDrawer:function(comp){parts$a.getPart(comp,detail,"toolbar").each((function(toolbar){var a,f;a=toolbar.getApis().toggle,f=function(toggle){return toggle(toolbar)},null!=a?Optional.some(f(a)):Optional.none()}))},isToolbarDrawerToggled:function(comp){return parts$a.getPart(comp,detail,"toolbar").bind((function(toolbar){return Optional.from(toolbar.getApis().isOpen).map((function(isOpen){return isOpen(toolbar)}))})).getOr(!1)},getThrobber:function(comp){return parts$a.getPart(comp,detail,"throbber")},focusToolbar:function(comp){parts$a.getPart(comp,detail,"toolbar").orThunk((function(){return parts$a.getPart(comp,detail,"multiple-toolbar")})).each((function(toolbar){Keying.focusIn(toolbar)}))},setMenubar:function(comp,menus){parts$a.getPart(comp,detail,"menubar").each((function(menubar){SilverMenubar.setMenus(menubar,menus)}))},focusMenubar:function(comp){parts$a.getPart(comp,detail,"menubar").each((function(menubar){SilverMenubar.focus(menubar)}))}};return{uid:detail.uid,dom:detail.dom,components:components,apis:apis,behaviours:detail.behaviours}},configFields:[required$1("dom"),required$1("behaviours")],partFields:[partHeader,partMenubar,partToolbar,partMultipleToolbar,partSocket,partSidebar,partThrobber],apis:{getSocket:function(apis,comp){return apis.getSocket(comp)},setSidebar:function(apis,comp,panelConfigs){apis.setSidebar(comp,panelConfigs)},toggleSidebar:function(apis,comp,name){apis.toggleSidebar(comp,name)},whichSidebar:function(apis,comp){return apis.whichSidebar(comp)},getHeader:function(apis,comp){return apis.getHeader(comp)},getToolbar:function(apis,comp){return apis.getToolbar(comp)},setToolbar:function(apis,comp,grps){var groups=map$2(grps,(function(grp){return renderToolbarGroup(grp)}));apis.setToolbar(comp,groups)},setToolbars:function(apis,comp,ts){var renderedToolbars=map$2(ts,(function(g){return map$2(g,renderToolbarGroup)}));apis.setToolbars(comp,renderedToolbars)},refreshToolbar:function(apis,comp){return apis.refreshToolbar(comp)},toggleToolbarDrawer:function(apis,comp){apis.toggleToolbarDrawer(comp)},isToolbarDrawerToggled:function(apis,comp){return apis.isToolbarDrawerToggled(comp)},getThrobber:function(apis,comp){return apis.getThrobber(comp)},setMenubar:function(apis,comp,menus){apis.setMenubar(comp,menus)},focusMenubar:function(apis,comp){apis.focusMenubar(comp)},focusToolbar:function(apis,comp){apis.focusToolbar(comp)}}}),defaultMenus={file:{title:"File",items:"newdocument restoredraft | preview | export print | deleteallconversations"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"},table:{title:"Table",items:"inserttable | cell row column | advtablesort | tableprops deletetable"},help:{title:"Help",items:"help"}},parseItemsString=function(items){return"string"==typeof items?items.split(" "):items},identifyMenus=function(editor,registry){var rawMenuData=__assign(__assign({},defaultMenus),registry.menus),userDefinedMenus=keys(registry.menus).length>0,menubar=void 0===registry.menubar||!0===registry.menubar?parseItemsString("file edit view insert format tools table help"):parseItemsString(!1===registry.menubar?"":registry.menubar),validMenus=filter$2(menubar,(function(menuName){var isDefaultMenu=has$2(defaultMenus,menuName);return userDefinedMenus?isDefaultMenu||get$e(registry.menus,menuName).exists((function(menu){return has$2(menu,"items")})):isDefaultMenu})),menus=map$2(validMenus,(function(menuName){var menuData=rawMenuData[menuName];return function(menu,registry,editor){var removedMenuItems=function(editor){return editor.getParam("removed_menuitems","")}(editor).split(/[ ,]/);return{text:menu.title,getItems:function(){return bind$3(menu.items,(function(i){var itemName=i.toLowerCase();return 0===itemName.trim().length||exists(removedMenuItems,(function(removedMenuItem){return removedMenuItem===itemName}))?[]:"separator"===itemName||"|"===itemName?[{type:"separator"}]:registry.menuItems[itemName]?[registry.menuItems[itemName]]:[]}))}}}({title:menuData.title,items:parseItemsString(menuData.items)},registry,editor)}));return filter$2(menus,(function(menu){return menu.getItems().length>0&&exists(menu.getItems(),(function(item){return"separator"!==item.type}))}))},fireSkinLoaded=function(editor){var done=function(){editor._skinLoaded=!0,function(editor){editor.fire("SkinLoaded")}(editor)};return function(){editor.initialized?done():editor.on("init",done)}},loadStylesheet=function(editor,stylesheetUrl,styleSheetLoader){return new global$c((function(resolve,reject){styleSheetLoader.load(stylesheetUrl,resolve,reject),editor.on("remove",(function(){return styleSheetLoader.unload(stylesheetUrl)}))}))},loadUiSkins=function(editor,skinUrl){return loadStylesheet(editor,skinUrl+"/skin.min.css",editor.ui.styleSheetLoader)},loadShadowDomUiSkins=function(editor,skinUrl){var e;return(e=SugarElement.fromDom(editor.getElement()),getShadowRoot(e).isSome())?loadStylesheet(editor,skinUrl+"/skin.shadowdom.min.css",global$b.DOM.styleSheetLoader):global$c.resolve()},loadSkin=function(isInline,editor){var skinUrl=function(editor){var skin=editor.getParam("skin"),skinUrl=editor.getParam("skin_url");if(!1!==skin){var skinName=skin||"oxide";skinUrl=skinUrl?editor.documentBaseURI.toAbsolute(skinUrl):global$a.baseURL+"/skins/ui/"+skinName}return skinUrl}(editor);skinUrl&&editor.contentCSS.push(skinUrl+(isInline?"/content.inline":"/content")+".min.css"),!1===function(editor){return!1===editor.getParam("skin")}(editor)&&isString(skinUrl)?global$c.all([loadUiSkins(editor,skinUrl),loadShadowDomUiSkins(editor,skinUrl)]).then(fireSkinLoaded(editor),function(editor,err){return function(){return function(editor,error){return editor.fire("SkinLoadError",error)}(editor,{message:err})}}(editor,"Skin could not be loaded")):fireSkinLoaded(editor)()},iframe=curry(loadSkin,!1),inline=curry(loadSkin,!0),onSetupFormatToggle=function(editor,name){return function(api){var boundCallback=unbindable(),init=function(){api.setActive(editor.formatter.match(name));var binding=editor.formatter.formatChanged(name,api.setActive);boundCallback.set(binding)};return editor.initialized?init():editor.once("init",init),function(){editor.off("init",init),boundCallback.clear()}}},onSetupEvent=function(editor,event,f){return function(api){var handleEvent=function(){return f(api)},init=function(){f(api),editor.on(event,handleEvent)};return editor.initialized?init():editor.once("init",init),function(){editor.off("init",init),editor.off(event,handleEvent)}}},onActionToggleFormat$1=function(editor){return function(rawItem){return function(){editor.undoManager.transact((function(){editor.focus(),editor.execCommand("mceToggleFormat",!1,rawItem.format)}))}}},onActionExecCommand=function(editor,command){return function(){return editor.execCommand(command)}},generateSelectItems=function(_editor,backstage,spec){var generateItem=function(rawItem,response,disabled,value){var translatedText=backstage.shared.providers.translate(rawItem.title);if("separator"===rawItem.type)return Optional.some({type:"separator",text:translatedText});if("submenu"===rawItem.type){var items=bind$3(rawItem.getStyleItems(),(function(si){return validate(si,response,value)}));return 0===response&&items.length<=0?Optional.none():Optional.some({type:"nestedmenuitem",text:translatedText,disabled:items.length<=0,getSubmenuItems:function(){return bind$3(rawItem.getStyleItems(),(function(si){return validate(si,response,value)}))}})}return Optional.some(__assign({type:"togglemenuitem",text:translatedText,icon:rawItem.icon,active:rawItem.isSelected(value),disabled:disabled,onAction:spec.onAction(rawItem)},rawItem.getStylePreview().fold((function(){return{}}),(function(preview){return{meta:{style:preview}}}))))},validate=function(item,response,value){var invalid="formatter"===item.type&&spec.isInvalid(item);return 0===response?invalid?[]:generateItem(item,response,!1,value).toArray():generateItem(item,response,invalid,value).toArray()},validateItems=function(preItems){var value=spec.getCurrentValue(),response=spec.shouldHide?0:1;return bind$3(preItems,(function(item){return validate(item,response,value)}))};return{validateItems:validateItems,getFetch:function(backstage,getStyleItems){return function(comp,callback){var preItems=getStyleItems(),items=validateItems(preItems);callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))}}}},createMenuItems=function(editor,backstage,spec){var dataset=spec.dataset,getStyleItems="basic"===dataset.type?function(){return map$2(dataset.data,(function(d){return processBasic(d,spec.isSelectedFor,spec.getPreviewFor)}))}:dataset.getData;return{items:generateSelectItems(0,backstage,spec),getStyleItems:getStyleItems}},createSelectButton=function(editor,backstage,spec){var _a=createMenuItems(0,backstage,spec),items=_a.items,getStyleItems=_a.getStyleItems,onSetup=onSetupEvent(editor,"NodeChange",(function(api){var comp=api.getComponent();spec.updateText(comp)}));return renderCommonDropdown({text:spec.icon.isSome()?Optional.none():spec.text,icon:spec.icon,tooltip:Optional.from(spec.tooltip),role:Optional.none(),fetch:items.getFetch(backstage,getStyleItems),onSetup:onSetup,getApi:function(comp){return{getComponent:constant$1(comp)}},columns:1,presets:"normal",classes:spec.icon.isSome()?[]:["bespoke"],dropdownBehaviours:[]},"tox-tbtn",backstage.shared)};!function(Delimiter){Delimiter[Delimiter.SemiColon=0]="SemiColon",Delimiter[Delimiter.Space=1]="Space"}(Delimiter||(Delimiter={}));var opt,unsignedDecimalLiteral,ResizeTypes,buildBasicSettingsDataset=function(editor,settingName,defaults,delimiter){return{type:"basic",data:function(rawFormats){return map$2(rawFormats,(function(item){var title=item,format=item,values=item.split("=");return values.length>1&&(title=values[0],format=values[1]),{title:title,format:format}}))}(function(rawFormats,delimiter){return delimiter===Delimiter.SemiColon?rawFormats.replace(/;$/,"").split(";"):rawFormats.split(" ")}(editor.getParam(settingName,defaults,"string"),delimiter))}},alignMenuItems=[{title:"Left",icon:"align-left",format:"alignleft",command:"JustifyLeft"},{title:"Center",icon:"align-center",format:"aligncenter",command:"JustifyCenter"},{title:"Right",icon:"align-right",format:"alignright",command:"JustifyRight"},{title:"Justify",icon:"align-justify",format:"alignjustify",command:"JustifyFull"}],getSpec$4=function(editor){var dataset={type:"basic",data:alignMenuItems};return{tooltip:"Align",text:Optional.none(),icon:Optional.some("align-left"),isSelectedFor:function(format){return function(){return editor.formatter.match(format)}},getCurrentValue:Optional.none,getPreviewFor:function(_format){return Optional.none},onAction:function(rawItem){return function(){return find$5(alignMenuItems,(function(item){return item.format===rawItem.format})).each((function(item){return editor.execCommand(item.command)}))}},updateText:function(comp){var alignment=find$5(alignMenuItems,(function(item){return editor.formatter.match(item.format)})).fold(constant$1("left"),(function(item){return item.title.toLowerCase()}));emitWith(comp,updateMenuIcon,{icon:"align-"+alignment})},dataset:dataset,shouldHide:!1,isInvalid:function(item){return!editor.formatter.canApply(item.format)}}},systemStackFonts=["-apple-system","Segoe UI","Roboto","Helvetica Neue","sans-serif"],splitFonts=function(fontFamily){var fonts=fontFamily.split(/\s*,\s*/);return map$2(fonts,(function(font){return font.replace(/^['"]+|['"]+$/g,"")}))},getSpec$3=function(editor){var getMatchingValue=function(){var getFirstFont=function(fontFamily){return fontFamily?splitFonts(fontFamily)[0]:""},fontFamily=editor.queryCommandValue("FontName"),items=dataset.data,font=fontFamily?fontFamily.toLowerCase():"";return{matchOpt:find$5(items,(function(item){var format=item.format;return format.toLowerCase()===font||getFirstFont(format).toLowerCase()===getFirstFont(font).toLowerCase()})).orThunk((function(){return someIf(function(fontFamily){var fonts;return 0===fontFamily.indexOf("-apple-system")&&(fonts=splitFonts(fontFamily.toLowerCase()),forall(systemStackFonts,(function(font){return fonts.indexOf(font.toLowerCase())>-1})))}(font),{title:"System Font",format:font})})),font:fontFamily}},dataset=buildBasicSettingsDataset(editor,"font_formats","Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats",Delimiter.SemiColon);return{tooltip:"Fonts",text:Optional.some("System Font"),icon:Optional.none(),isSelectedFor:function(item){return function(valueOpt){return valueOpt.exists((function(value){return value.format===item}))}},getCurrentValue:function(){return getMatchingValue().matchOpt},getPreviewFor:function(item){return function(){return Optional.some({tag:"div",styles:-1===item.indexOf("dings")?{"font-family":item}:{}})}},onAction:function(rawItem){return function(){editor.undoManager.transact((function(){editor.focus(),editor.execCommand("FontName",!1,rawItem.format)}))}},updateText:function(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,font=_a.font,text=matchOpt.fold(constant$1(font),(function(item){return item.title}));emitWith(comp,updateMenuText,{text:text})},dataset:dataset,shouldHide:!1,isInvalid:never}},legacyFontSizes={"8pt":"1","10pt":"2","12pt":"3","14pt":"4","18pt":"5","24pt":"6","36pt":"7"},keywordFontSizes={"xx-small":"7pt","x-small":"8pt",small:"10pt",medium:"12pt",large:"14pt","x-large":"18pt","xx-large":"24pt"},toPt=function(fontSize,precision){return/[0-9.]+px$/.test(fontSize)?function(number,precision){var factor=Math.pow(10,precision);return Math.round(number*factor)/factor}(72*parseInt(fontSize,10)/96,precision||0)+"pt":get$e(keywordFontSizes,fontSize).getOr(fontSize)},getSpec$2=function(editor){var getMatchingValue=function(){var matchOpt=Optional.none(),items=dataset.data,fontSize=editor.queryCommandValue("FontSize");if(fontSize)for(var _loop_1=function(precision){var pt=toPt(fontSize,precision),legacy=function(fontSize){return get$e(legacyFontSizes,fontSize).getOr("")}(pt);matchOpt=find$5(items,(function(item){return item.format===fontSize||item.format===pt||item.format===legacy}))},precision=3;matchOpt.isNone()&&precision>=0;precision--)_loop_1(precision);return{matchOpt:matchOpt,size:fontSize}},getPreviewFor=constant$1(Optional.none),dataset=buildBasicSettingsDataset(editor,"fontsize_formats","8pt 10pt 12pt 14pt 18pt 24pt 36pt",Delimiter.Space);return{tooltip:"Font sizes",text:Optional.some("12pt"),icon:Optional.none(),isSelectedFor:function(item){return function(valueOpt){return valueOpt.exists((function(value){return value.format===item}))}},getPreviewFor:getPreviewFor,getCurrentValue:function(){return getMatchingValue().matchOpt},onAction:function(rawItem){return function(){editor.undoManager.transact((function(){editor.focus(),editor.execCommand("FontSize",!1,rawItem.format)}))}},updateText:function(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,size=_a.size,text=matchOpt.fold(constant$1(size),(function(match){return match.title}));emitWith(comp,updateMenuText,{text:text})},dataset:dataset,shouldHide:!1,isInvalid:never}},findNearest=function(editor,getStyles){var styles=getStyles(),formats=map$2(styles,(function(style){return style.format}));return Optional.from(editor.formatter.closest(formats)).bind((function(fmt){return find$5(styles,(function(data){return data.format===fmt}))})).orThunk((function(){return someIf(editor.formatter.match("p"),{title:"Paragraph",format:"p"})}))},getSpec$1=function(editor){var dataset=buildBasicSettingsDataset(editor,"block_formats","Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre",Delimiter.SemiColon);return{tooltip:"Blocks",text:Optional.some("Paragraph"),icon:Optional.none(),isSelectedFor:function(format){return function(){return editor.formatter.match(format)}},getCurrentValue:Optional.none,getPreviewFor:function(format){return function(){var fmt=editor.formatter.get(format);return Optional.some({tag:fmt.length>0&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))})}},onAction:onActionToggleFormat$1(editor),updateText:function(comp){var text=findNearest(editor,(function(){return dataset.data})).fold(constant$1("Paragraph"),(function(fmt){return fmt.title}));emitWith(comp,updateMenuText,{text:text})},dataset:dataset,shouldHide:!1,isInvalid:function(item){return!editor.formatter.canApply(item.format)}}},getSpec=function(editor,dataset){return{tooltip:"Formats",text:Optional.some("Paragraph"),icon:Optional.none(),isSelectedFor:function(format){return function(){return editor.formatter.match(format)}},getCurrentValue:Optional.none,getPreviewFor:function(format){return function(){var fmt=editor.formatter.get(format);return void 0!==fmt?Optional.some({tag:fmt.length>0&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none()}},onAction:onActionToggleFormat$1(editor),updateText:function(comp){var getFormatItems=function(fmt){var subs=fmt.items;return void 0!==subs&&subs.length>0?bind$3(subs,getFormatItems):[{title:fmt.title,format:fmt.format}]},flattenedItems=bind$3(getStyleFormats(editor),getFormatItems),text=findNearest(editor,constant$1(flattenedItems)).fold(constant$1("Paragraph"),(function(fmt){return fmt.title}));emitWith(comp,updateMenuText,{text:text})},shouldHide:editor.getParam("style_formats_autohide",!1,"boolean"),isInvalid:function(item){return!editor.formatter.canApply(item.format)},dataset:dataset}},ActiveReflecting=Object.freeze({__proto__:null,events:function(reflectingConfig,reflectingState){var update=function(component,data){reflectingConfig.updateState.each((function(updateState){var newState=updateState(component,data);reflectingState.set(newState)})),reflectingConfig.renderComponents.each((function(renderComponents){var newComponents=renderComponents(data,reflectingState.get()),newChildren=map$2(newComponents,component.getSystem().build);replaceChildren(component,newChildren)}))};return derive$2([run$1(receive(),(function(component,message){var receivingData=message;if(!receivingData.universal){var channel=reflectingConfig.channel;contains$2(receivingData.channels,channel)&&update(component,receivingData.data)}})),runOnAttached((function(comp,_se){reflectingConfig.initialData.each((function(rawData){update(comp,rawData)}))}))])}}),ReflectingApis=Object.freeze({__proto__:null,getState:function(component,replaceConfig,reflectState){return reflectState}}),ReflectingSchema=[required$1("channel"),option("renderComponents"),option("updateState"),option("initialData")],ReflectingState=Object.freeze({__proto__:null,init:function(){var cell=Cell(Optional.none());return{readState:function(){return cell.get().getOr("none")},get:cell.get,set:cell.set,clear:function(){return cell.set(Optional.none())}}}}),Reflecting=create$7({fields:ReflectingSchema,name:"reflecting",active:ActiveReflecting,apis:ReflectingApis,state:ReflectingState}),schema$7=constant$1([required$1("toggleClass"),required$1("fetch"),onStrictHandler("onExecute"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),schema$y(),onStrictHandler("onItemExecute"),option("lazySink"),required$1("dom"),onHandler("onOpen"),field("splitDropdownBehaviours",[Coupling,Keying,Focusing]),defaulted("matchWidth",!1),defaulted("useMinWidth",!1),defaulted("eventOrder",{}),option("role")].concat(sandboxFields())),arrowPart=required({factory:Button,schema:[required$1("dom")],name:"arrow",defaults:function(){return{buttonBehaviours:derive$1([Focusing.revoke()])}},overrides:function(detail){return{dom:{tag:"span",attributes:{role:"presentation"}},action:function(arrow){arrow.getSystem().getByUid(detail.uid).each(emitExecute)},buttonBehaviours:derive$1([Toggling.config({toggleOnExecute:!1,toggleClass:detail.toggleClass})])}}}),buttonPart=required({factory:Button,schema:[required$1("dom")],name:"button",defaults:function(){return{buttonBehaviours:derive$1([Focusing.revoke()])}},overrides:function(detail){return{dom:{tag:"span",attributes:{role:"presentation"}},action:function(btn){btn.getSystem().getByUid(detail.uid).each((function(splitDropdown){detail.onExecute(splitDropdown,btn)}))}}}}),parts$3=constant$1([arrowPart,buttonPart,optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:spec.text}}}},schema:[required$1("text")],name:"aria-descriptor"}),external$1({schema:[tieredMenuMarkers()],name:"menu",defaults:function(detail){return{onExecute:function(tmenu,item){tmenu.getSystem().getByUid(detail.uid).each((function(splitDropdown){detail.onItemExecute(splitDropdown,tmenu,item)}))}}}}),partType$1()]),SplitDropdown=composite({name:"SplitDropdown",configFields:schema$7(),partFields:parts$3(),factory:function(detail,components,spec,externals){var _a,switchToMenu=function(sandbox){Composing.getCurrent(sandbox).each((function(current){Highlighting.highlightFirst(current),Keying.focusIn(current)}))},action=function(component){togglePopup(detail,identity$1,component,externals,switchToMenu,HighlightOnOpen.HighlightFirst).get(noop)},executeOnButton=function(comp){var button=getPartOrDie(comp,detail,"button");return emitExecute(button),Optional.some(!0)},buttonEvents=__assign(__assign({},derive$2([runOnAttached((function(component,_simulatedEvent){getPart(component,detail,"aria-descriptor").each((function(descriptor){var descriptorId=generate$6("aria");set$8(descriptor.element,"id",descriptorId),set$8(component.element,"aria-describedby",descriptorId)}))}))])),events$a(Optional.some(action))),apis={repositionMenus:function(comp){Toggling.isOn(comp)&&repositionMenus(comp)}};return{uid:detail.uid,dom:detail.dom,components:components,apis:apis,eventOrder:__assign(__assign({},detail.eventOrder),(_a={},_a[execute$5()]=["disabling","toggling","alloy.base.behaviour"],_a)),events:buttonEvents,behaviours:augment(detail.splitDropdownBehaviours,[Coupling.config({others:{sandbox:function(hotspot){var arrow=getPartOrDie(hotspot,detail,"arrow");return makeSandbox$1(detail,hotspot,{onOpen:function(){Toggling.on(arrow),Toggling.on(hotspot)},onClose:function(){Toggling.off(arrow),Toggling.off(hotspot)}})}}}),Keying.config({mode:"special",onSpace:executeOnButton,onEnter:executeOnButton,onDown:function(comp){return action(comp),Optional.some(!0)}}),Focusing.config({}),Toggling.config({toggleOnExecute:!1,aria:{mode:"expanded"}})]),domModification:{attributes:{role:detail.role.getOr("button"),"aria-haspopup":!0}}}},apis:{repositionMenus:function(apis,comp){return apis.repositionMenus(comp)}}}),getButtonApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},getToggleApi=function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},getTooltipAttributes=function(tooltip,providersBackstage){return tooltip.map((function(tooltip){return{"aria-label":providersBackstage.translate(tooltip),title:providersBackstage.translate(tooltip)}})).getOr({})},focusButtonEvent=generate$6("focus-button"),renderCommonStructure=function(icon,text,tooltip,receiver,behaviours,providersBackstage){var _d;return{dom:{tag:"button",classes:["tox-tbtn"].concat(text.isSome()?["tox-tbtn--select"]:[]),attributes:getTooltipAttributes(tooltip,providersBackstage)},components:componentRenderPipeline([icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})),text.map((function(text){return renderLabel$1(text,"tox-tbtn",providersBackstage)}))]),eventOrder:(_d={},_d[mousedown()]=["focusing","alloy.base.behaviour","common-button-display-events"],_d),buttonBehaviours:derive$1([DisablingConfigs_toolbarButton(providersBackstage.isDisabled),receivingConfig(),config("common-button-display-events",[run$1(mousedown(),(function(button,se){se.event.prevent(),emit(button,focusButtonEvent)}))])].concat(receiver.map((function(r){return Reflecting.config({channel:r,initialData:{icon:icon,text:text},renderComponents:function(data,_state){return componentRenderPipeline([data.icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})),data.text.map((function(text){return renderLabel$1(text,"tox-tbtn",providersBackstage)}))])}})})).toArray()).concat(behaviours.getOr([])))}},renderCommonToolbarButton=function(spec,specialisation,providersBackstage){var info,editorOffCell=Cell(noop),structure=renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),providersBackstage);return Button.sketch({dom:structure.dom,components:structure.components,eventOrder:toolbarButtonEventOrder,buttonBehaviours:derive$1([config("toolbar-button-events",[(info={onAction:spec.onAction,getApi:specialisation.getApi},runOnExecute$1((function(comp,_simulatedEvent){runWithApi(info,comp)((function(itemApi){emitWith(comp,internalToolbarButtonExecute,{buttonApi:itemApi}),info.onAction(itemApi)}))}))),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),DisablingConfigs_toolbarButton((function(){return spec.disabled||providersBackstage.isDisabled()})),receivingConfig()].concat(specialisation.toolbarButtonBehaviours))})},renderToolbarButtonWith=function(spec,providersBackstage,bonusEvents){return renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[].concat(bonusEvents.length>0?[config("toolbarButtonWith",bonusEvents)]:[]),getApi:getButtonApi,onSetup:spec.onSetup},providersBackstage)},renderToolbarToggleButtonWith=function(spec,providersBackstage,bonusEvents){return deepMerge(renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[Replacing.config({}),Toggling.config({toggleClass:"tox-tbtn--enabled",aria:{mode:"pressed"},toggleOnExecute:!1})].concat(bonusEvents.length>0?[config("toolbarToggleButtonWith",bonusEvents)]:[]),getApi:getToggleApi,onSetup:spec.onSetup},providersBackstage))},fetchChoices=function(getApi,spec,providersBackstage){return function(comp){return Future_nu((function(callback){return spec.fetch(callback)})).map((function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6("menu-value"),items,(function(value){spec.onItemAction(getApi(comp),value)}),spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,spec.select.getOr(never),providersBackstage),{movement:deriveMenuMovement(spec.columns,spec.presets),menuBehaviours:SimpleBehaviours_unnamedEvents("auto"!==spec.columns?[]:[runOnAttached((function(comp,_se){detectSize(comp,4,classForPreset(spec.presets)).each((function(_d){var numRows=_d.numRows,numColumns=_d.numColumns;Keying.setGridSize(comp,numRows,numColumns)}))}))])})))}))}},defaultToolbar=[{name:"history",items:["undo","redo"]},{name:"styles",items:["styleselect"]},{name:"formatting",items:["bold","italic"]},{name:"alignment",items:["alignleft","aligncenter","alignright","alignjustify"]},{name:"indentation",items:["outdent","indent"]},{name:"permanent pen",items:["permanentpen"]},{name:"comments",items:["addcomment"]}],renderFromBridge=function(bridgeBuilder,render){return function(spec,extras,editor){var internal=bridgeBuilder(spec).mapError((function(errInfo){return formatError(errInfo)})).getOrDie();return render(internal,extras,editor)}},types={button:renderFromBridge(createToolbarButton,(function(s,extras){return spec=s,providersBackstage=extras.backstage.shared.providers,renderToolbarButtonWith(spec,providersBackstage,[]);var spec,providersBackstage})),togglebutton:renderFromBridge(createToggleButton,(function(s,extras){return spec=s,providersBackstage=extras.backstage.shared.providers,renderToolbarToggleButtonWith(spec,providersBackstage,[]);var spec,providersBackstage})),menubutton:renderFromBridge(createMenuButton,(function(s,extras){return renderMenuButton(s,"tox-tbtn",extras.backstage,Optional.none())})),splitbutton:renderFromBridge((function(spec){return asRaw("SplitButton",splitButtonSchema,spec)}),(function(s,extras){return function(spec,sharedBackstage){var _d,displayChannel=generate$6("channel-update-split-dropdown-display"),getApi=function(comp){return{isDisabled:function(){return Disabling.isDisabled(comp)},setDisabled:function(state){return Disabling.set(comp,state)},setIconFill:function(id,value){descendant(comp.element,'svg path[id="'+id+'"], rect[id="'+id+'"]').each((function(underlinePath){set$8(underlinePath,"fill",value)}))},setIconStroke:function(id,value){descendant(comp.element,'svg path[id="'+id+'"], rect[id="'+id+'"]').each((function(underlinePath){set$8(underlinePath,"stroke",value)}))},setActive:function(state){set$8(comp.element,"aria-pressed",state),descendant(comp.element,"span").each((function(button){comp.getSystem().getByDom(button).each((function(buttonComp){return Toggling.set(buttonComp,state)}))}))},isActive:function(){return descendant(comp.element,"span").exists((function(button){return comp.getSystem().getByDom(button).exists(Toggling.isOn)}))}}},editorOffCell=Cell(noop),specialisation={getApi:getApi,onSetup:spec.onSetup};return SplitDropdown.sketch({dom:{tag:"div",classes:["tox-split-button"],attributes:__assign({"aria-pressed":!1},getTooltipAttributes(spec.tooltip,sharedBackstage.providers))},onExecute:function(button){spec.onAction(getApi(button))},onItemExecute:function(_a,_b,_c){},splitDropdownBehaviours:derive$1([DisablingConfigs_splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),config("split-dropdown-events",[run$1(focusButtonEvent,Focusing.focus),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),Unselecting.config({})]),eventOrder:(_d={},_d[attachedToDom()]=["alloy.base.behaviour","split-dropdown-events"],_d),toggleClass:"tox-tbtn--enabled",lazySink:sharedBackstage.getSink,fetch:fetchChoices(getApi,spec,sharedBackstage.providers),parts:{menu:part(0,spec.columns,spec.presets)},components:[SplitDropdown.parts.button(renderCommonStructure(spec.icon,spec.text,Optional.none(),Optional.some(displayChannel),Optional.some([Toggling.config({toggleClass:"tox-tbtn--enabled",toggleOnExecute:!1})]),sharedBackstage.providers)),SplitDropdown.parts.arrow({dom:{tag:"button",classes:["tox-tbtn","tox-split-button__chevron"],innerHtml:get$1("chevron-down",sharedBackstage.providers.icons)},buttonBehaviours:derive$1([DisablingConfigs_splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),addFocusableBehaviour()])}),SplitDropdown.parts["aria-descriptor"]({text:sharedBackstage.providers.translate("To open the popup, press Shift+Enter")})]})}(s,extras.backstage.shared)})),grouptoolbarbutton:renderFromBridge((function(spec){return asRaw("GroupToolbarButton",groupToolbarButtonSchema,spec)}),(function(s,extras,editor){var _a,buttons=editor.ui.registry.getAll().buttons,attributes=((_a={})[Attribute]=extras.backstage.shared.header.isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop,_a);switch(getToolbarMode(editor)){case ToolbarMode.floating:return function(spec,backstage,identifyButtons,attributes){var sharedBackstage=backstage.shared;return FloatingToolbarButton.sketch({lazySink:sharedBackstage.getSink,fetch:function(){return Future_nu((function(resolve){resolve(map$2(identifyButtons(spec.items),renderToolbarGroup))}))},markers:{toggledClass:"tox-tbtn--enabled"},parts:{button:renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),sharedBackstage.providers),toolbar:{dom:{tag:"div",classes:["tox-toolbar__overflow"],attributes:attributes}}}})}(s,extras.backstage,(function(toolbar){return identifyButtons(editor,{buttons:buttons,toolbar:toolbar,allowToolbarGroups:!1},extras,Optional.none())}),attributes);default:throw new Error("Toolbar groups are only supported when using floating toolbar mode")}})),styleSelectButton:function(editor,extras){return function(editor,backstage){var dataset=__assign({type:"advanced"},backstage.styleselect);return createSelectButton(editor,backstage,getSpec(editor,dataset))}(editor,extras.backstage)},fontsizeSelectButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$2(editor))}(editor,extras.backstage)},fontSelectButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$3(editor))}(editor,extras.backstage)},formatButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$1(editor))}(editor,extras.backstage)},alignMenuButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$4(editor))}(editor,extras.backstage)}},bespokeButtons={styleselect:types.styleSelectButton,fontsizeselect:types.fontsizeSelectButton,fontselect:types.fontSelectButton,formatselect:types.formatButton,align:types.alignMenuButton},createToolbar=function(toolbarConfig){var groupsStrings,toolbar=toolbarConfig.toolbar,buttons=toolbarConfig.buttons;return!1===toolbar?[]:void 0===toolbar||!0===toolbar?function(buttons){var filteredItemGroups=map$2(defaultToolbar,(function(group){var items=filter$2(group.items,(function(subItem){return has$2(buttons,subItem)||has$2(bespokeButtons,subItem)}));return{name:group.name,items:items}}));return filter$2(filteredItemGroups,(function(group){return group.items.length>0}))}(buttons):isString(toolbar)?(groupsStrings=toolbar.split("|"),map$2(groupsStrings,(function(g){return{items:g.trim().split(" ")}}))):function(toolbar){return isArrayOf(toolbar,(function(t){return has$2(t,"name")&&has$2(t,"items")}))}(toolbar)?toolbar:(console.error("Toolbar type should be string, string[], boolean or ToolbarGroup[]"),[])},lookupButton=function(editor,buttons,toolbarItem,allowToolbarGroups,extras,prefixes){return get$e(buttons,toolbarItem.toLowerCase()).orThunk((function(){return prefixes.bind((function(ps){return findMap(ps,(function(prefix){return get$e(buttons,prefix+toolbarItem.toLowerCase())}))}))})).fold((function(){return get$e(bespokeButtons,toolbarItem.toLowerCase()).map((function(r){return r(editor,extras)})).orThunk((function(){return Optional.none()}))}),(function(spec){return"grouptoolbarbutton"!==spec.type||allowToolbarGroups?function(spec,extras,editor){return get$e(types,spec.type).fold((function(){return console.error("skipping button defined by",spec),Optional.none()}),(function(render){return Optional.some(render(spec,extras,editor))}))}(spec,extras,editor):(console.warn("Ignoring the '"+toolbarItem+"' toolbar button. Group toolbar buttons are only supported when using floating toolbar mode and cannot be nested."),Optional.none())}))},identifyButtons=function(editor,toolbarConfig,extras,prefixes){var toolbarGroups=createToolbar(toolbarConfig),groups=map$2(toolbarGroups,(function(group){var items=bind$3(group.items,(function(toolbarItem){return 0===toolbarItem.trim().length?[]:lookupButton(editor,toolbarConfig.buttons,toolbarItem,toolbarConfig.allowToolbarGroups,extras,prefixes).toArray()}));return{title:Optional.from(editor.translate(group.name)),items:items}}));return filter$2(groups,(function(group){return group.items.length>0}))},setToolbar=function(editor,uiComponents,rawUiConfig,backstage){var comp=uiComponents.outerContainer,toolbarConfig=rawUiConfig.toolbar,toolbarButtonsConfig=rawUiConfig.buttons;if(isArrayOf(toolbarConfig,isString)){var toolbars=toolbarConfig.map((function(t){var config={toolbar:t,buttons:toolbarButtonsConfig,allowToolbarGroups:rawUiConfig.allowToolbarGroups};return identifyButtons(editor,config,{backstage:backstage},Optional.none())}));OuterContainer.setToolbars(comp,toolbars)}else OuterContainer.setToolbar(comp,identifyButtons(editor,rawUiConfig,{backstage:backstage},Optional.none()))},detection=detect$1(),isiOS12=detection.os.isiOS()&&detection.os.version.major<=12,Iframe=Object.freeze({__proto__:null,render:function(editor,uiComponents,rawUiConfig,backstage,args){var lastToolbarWidth=Cell(0),outerContainer=uiComponents.outerContainer;iframe(editor);var eTargetNode=SugarElement.fromDom(args.targetNode),uiRoot=getContentContainer(getRootNode(eTargetNode));!function(element,guiSystem){attachSystemWith(element,guiSystem,after$2)}(eTargetNode,uiComponents.mothership),attachSystem(uiRoot,uiComponents.uiMothership),editor.on("PostRender",(function(){setToolbar(editor,uiComponents,rawUiConfig,backstage),lastToolbarWidth.set(editor.getWin().innerWidth),OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig)),OuterContainer.setSidebar(outerContainer,rawUiConfig.sidebar),function(editor,uiComponents){var dom=editor.dom,contentWindow=editor.getWin(),initialDocEle=editor.getDoc().documentElement,lastWindowDimensions=Cell(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight)),lastDocumentDimensions=Cell(SugarPosition(initialDocEle.offsetWidth,initialDocEle.offsetHeight)),resizeWindow=function(){var outer=lastWindowDimensions.get();outer.left===contentWindow.innerWidth&&outer.top===contentWindow.innerHeight||(lastWindowDimensions.set(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight)),fireResizeContent(editor))},resizeDocument=function(){var docEle=editor.getDoc().documentElement,inner=lastDocumentDimensions.get();inner.left===docEle.offsetWidth&&inner.top===docEle.offsetHeight||(lastDocumentDimensions.set(SugarPosition(docEle.offsetWidth,docEle.offsetHeight)),fireResizeContent(editor))},scroll=function(e){return function(editor,e){return editor.fire("ScrollContent",e)}(editor,e)};dom.bind(contentWindow,"resize",resizeWindow),dom.bind(contentWindow,"scroll",scroll);var elementLoad=capture(SugarElement.fromDom(editor.getBody()),"load",resizeDocument),mothership=uiComponents.uiMothership.element;editor.on("hide",(function(){set$7(mothership,"display","none")})),editor.on("show",(function(){remove$6(mothership,"display")})),editor.on("NodeChange",resizeDocument),editor.on("remove",(function(){elementLoad.unbind(),dom.unbind(contentWindow,"resize",resizeWindow),dom.unbind(contentWindow,"scroll",scroll),contentWindow=null}))}(editor,uiComponents)}));var fn,rate,timer,socket=OuterContainer.getSocket(outerContainer).getOrDie("Could not find expected socket element");if(isiOS12){setAll(socket.element,{overflow:"scroll","-webkit-overflow-scrolling":"touch"});var limit=(fn=function(){editor.fire("ScrollContent")},rate=20,timer=null,{cancel:function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];isNull(timer)&&(timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate))}}),unbinder=bind(socket.element,"scroll",limit.throttle);editor.on("remove",unbinder.unbind)}setupReadonlyModeSwitch(editor,uiComponents),editor.addCommand("ToggleSidebar",(function(_ui,value){OuterContainer.toggleSidebar(outerContainer,value),editor.fire("ToggleSidebar")})),editor.addQueryValueHandler("ToggleSidebar",(function(){return OuterContainer.whichSidebar(outerContainer)}));var toolbarMode=getToolbarMode(editor);toolbarMode!==ToolbarMode.sliding&&toolbarMode!==ToolbarMode.floating||editor.on("ResizeWindow ResizeEditor ResizeContent",(function(){var width=editor.getWin().innerWidth;width!==lastToolbarWidth.get()&&(OuterContainer.refreshToolbar(uiComponents.outerContainer),lastToolbarWidth.set(width))}));var api={enable:function(){broadcastReadonly(uiComponents,!1)},disable:function(){broadcastReadonly(uiComponents,!0)},isDisabled:function(){return Disabling.isDisabled(outerContainer)}};return{iframeContainer:socket.element.dom,editorContainer:outerContainer.element.dom,api:api}}}),parseToInt=function(val){return/^[0-9\.]+(|px)$/i.test(""+val)?Optional.some(parseInt(""+val,10)):Optional.none()},numToPx=function(val){return isNumber(val)?val+"px":val},calcCappedSize=function(size,minSize,maxSize){var minOverride=minSize.filter((function(min){return size<min})),maxOverride=maxSize.filter((function(max){return size>max}));return minOverride.or(maxOverride).getOr(size)},getHeightWithFallback=function(editor){return function(editor){var baseHeight=getHeightSetting(editor),minHeight=getMinHeightSetting(editor),maxHeight=getMaxHeightSetting(editor);return parseToInt(baseHeight).map((function(height){return calcCappedSize(height,minHeight,maxHeight)}))}(editor).getOr(getHeightSetting(editor))},getWidth=function(editor){var baseWidth=getWidthSetting(editor),minWidth=getMinWidthSetting(editor),maxWidth=getMaxWidthSetting(editor);return parseToInt(baseWidth).map((function(width){return calcCappedSize(width,minWidth,maxWidth)}))},InlineHeader=function(editor,targetElm,uiComponents,backstage,floatContainer){var uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer,DOM=global$b.DOM,useFixedToolbarContainer=useFixedContainer(editor),isSticky=isStickyToolbar(editor),editorMaxWidthOpt=getMaxWidthSetting(editor).or(getWidth(editor)),headerBackstage=backstage.shared.header,isPositionedAtTop=headerBackstage.isPositionedAtTop,toolbarMode=getToolbarMode(editor),isSplitToolbar=toolbarMode===ToolbarMode.sliding||toolbarMode===ToolbarMode.floating,visible=Cell(!1),isVisible=function(){return visible.get()&&!editor.removed},calcToolbarOffset=function(toolbar){return isSplitToolbar?toolbar.fold(constant$1(0),(function(tbar){return tbar.components().length>1?get$b(tbar.components()[1].element):0})):0},repositionPopups$1=function(){uiMothership.broadcastOn([repositionPopups()],{})},updateChromeUi=function(resetDocking){if(void 0===resetDocking&&(resetDocking=!1),isVisible()){var maxWidth;if(useFixedToolbarContainer||(maxWidth=editorMaxWidthOpt.getOrThunk((function(){var bodyMargin=parseToInt(get$c(body(),"margin-left")).getOr(0);return get$a(body())-absolute$3(targetElm).left+bodyMargin})),set$7(floatContainer.get().element,"max-width",maxWidth+"px")),isSplitToolbar&&OuterContainer.refreshToolbar(outerContainer),useFixedToolbarContainer||function(){var toolbar=OuterContainer.getToolbar(outerContainer),offset=calcToolbarOffset(toolbar),targetBounds=box$1(targetElm),top=isPositionedAtTop()?Math.max(targetBounds.y-get$b(floatContainer.get().element)+offset,0):targetBounds.bottom;setAll(outerContainer.element,{position:"absolute",top:Math.round(top)+"px",left:Math.round(targetBounds.x)+"px"})}(),isSticky){var floatContainerComp=floatContainer.get();resetDocking?Docking.reset(floatContainerComp):Docking.refresh(floatContainerComp)}repositionPopups$1()}},updateMode=function(updateUi){if(void 0===updateUi&&(updateUi=!0),!useFixedToolbarContainer&&isSticky&&isVisible()){var currentMode=headerBackstage.getDockingMode(),newMode=function(container){switch(getToolbarLocation(editor)){case ToolbarLocation.auto:var toolbar_1=OuterContainer.getToolbar(outerContainer),offset=calcToolbarOffset(toolbar_1),toolbarHeight=get$b(container.element)-offset,targetBounds=box$1(targetElm);if(targetBounds.y>toolbarHeight)return"top";var doc=documentElement(targetElm),docHeight=Math.max(doc.dom.scrollHeight,get$b(doc));return targetBounds.bottom<docHeight-toolbarHeight||win().bottom<targetBounds.bottom-toolbarHeight?"bottom":"top";case ToolbarLocation.bottom:return"bottom";case ToolbarLocation.top:default:return"top"}}(floatContainer.get());newMode!==currentMode&&(!function(mode){var container=floatContainer.get();Docking.setModes(container,[mode]),headerBackstage.setDockingMode(mode);var verticalDir=isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop;set$8(container.element,Attribute,verticalDir)}(newMode),updateUi&&updateChromeUi(!0))}};return{isVisible:isVisible,isPositionedAtTop:isPositionedAtTop,show:function(){visible.set(!0),set$7(outerContainer.element,"display","flex"),DOM.addClass(editor.getBody(),"mce-edit-focus"),remove$6(uiMothership.element,"display"),updateMode(!1),updateChromeUi()},hide:function(){visible.set(!1),uiComponents.outerContainer&&(set$7(outerContainer.element,"display","none"),DOM.removeClass(editor.getBody(),"mce-edit-focus")),set$7(uiMothership.element,"display","none")},update:updateChromeUi,updateMode:updateMode,repositionPopups:repositionPopups$1}},getTargetPosAndBounds=function(targetElm,isToolbarTop){var bounds=box$1(targetElm);return{pos:isToolbarTop?bounds.y:bounds.bottom,bounds:bounds}},Inline=Object.freeze({__proto__:null,render:function(editor,uiComponents,rawUiConfig,backstage,args){var mothership=uiComponents.mothership,uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer,floatContainer=Cell(null),targetElm=SugarElement.fromDom(args.targetNode),ui=InlineHeader(editor,targetElm,uiComponents,backstage,floatContainer),toolbarPersist=function(editor){return editor.getParam("toolbar_persist",!1,"boolean")}(editor);inline(editor);var render=function(){if(floatContainer.get())ui.show();else{floatContainer.set(OuterContainer.getHeader(outerContainer).getOrDie());var uiContainer=getUiContainer(editor);attachSystem(uiContainer,mothership),attachSystem(uiContainer,uiMothership),setToolbar(editor,uiComponents,rawUiConfig,backstage),OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig)),ui.show(),function(editor,targetElm,ui,toolbarPersist){var prevPosAndBounds=Cell(getTargetPosAndBounds(targetElm,ui.isPositionedAtTop())),resizeContent=function(e){var _a=getTargetPosAndBounds(targetElm,ui.isPositionedAtTop()),pos=_a.pos,bounds=_a.bounds,_b=prevPosAndBounds.get(),prevPos=_b.pos,prevBounds=_b.bounds,hasResized=bounds.height!==prevBounds.height||bounds.width!==prevBounds.width;prevPosAndBounds.set({pos:pos,bounds:bounds}),hasResized&&fireResizeContent(editor,e),ui.isVisible()&&(prevPos!==pos?ui.update(!0):hasResized&&(ui.updateMode(),ui.repositionPopups()))};toolbarPersist||(editor.on("activate",ui.show),editor.on("deactivate",ui.hide)),editor.on("SkinLoaded ResizeWindow",(function(){return ui.update(!0)})),editor.on("NodeChange keydown",(function(e){global$f.requestAnimationFrame((function(){return resizeContent(e)}))})),editor.on("ScrollWindow",(function(){return ui.updateMode()}));var elementLoad=unbindable();elementLoad.set(capture(SugarElement.fromDom(editor.getBody()),"load",resizeContent)),editor.on("remove",(function(){elementLoad.clear()}))}(editor,targetElm,ui,toolbarPersist),editor.nodeChanged()}};editor.on("show",render),editor.on("hide",ui.hide),toolbarPersist||(editor.on("focus",render),editor.on("blur",ui.hide)),editor.on("init",(function(){(editor.hasFocus()||toolbarPersist)&&render()})),setupReadonlyModeSwitch(editor,uiComponents);var api={show:function(){ui.show()},hide:function(){ui.hide()},enable:function(){broadcastReadonly(uiComponents,!1)},disable:function(){broadcastReadonly(uiComponents,!0)},isDisabled:function(){return Disabling.isDisabled(outerContainer)}};return{editorContainer:outerContainer.element.dom,api:api}}}),runOnExecute=function(memInput,original){return run$1(internalToolbarButtonExecute,(function(comp,se){var formApi=function(input){return{hide:function(){return emit(input,sandboxClose())},getValue:function(){return Representing.getValue(input)}}}(memInput.get(comp));original.onAction(formApi,se.event.buttonApi)}))},generateOne=function(memInput,button,providersBackstage){var extras={backstage:{shared:{providers:providersBackstage}}};return"contextformtogglebutton"===button.type?function(memInput,button,extras){var _a=button.original;_a.primary;var rest=__rest(_a,["primary"]),bridged=getOrDie(createToggleButton(__assign(__assign({},rest),{type:"togglebutton",onAction:noop})));return renderToolbarToggleButtonWith(bridged,extras.backstage.shared.providers,[runOnExecute(memInput,button)])}(memInput,button,extras):function(memInput,button,extras){var _a=button.original;_a.primary;var rest=__rest(_a,["primary"]),bridged=getOrDie(createToolbarButton(__assign(__assign({},rest),{type:"button",onAction:noop})));return renderToolbarButtonWith(bridged,extras.backstage.shared.providers,[runOnExecute(memInput,button)])}(memInput,button,extras)},buildInitGroups=function(ctx,providers){var inputAttributes=ctx.label.fold((function(){return{}}),(function(label){return{"aria-label":label}})),memInput=record(Input.sketch({inputClasses:["tox-toolbar-textfield","tox-toolbar-nav-js"],data:ctx.initValue(),inputAttributes:inputAttributes,selectOnFocus:!0,inputBehaviours:derive$1([Keying.config({mode:"special",onEnter:function(input){return commands.findPrimary(input).map((function(primary){return emitExecute(primary),!0}))},onLeft:function(comp,se){return se.cut(),Optional.none()},onRight:function(comp,se){return se.cut(),Optional.none()}})])})),commands=function(memInput,buttons,providersBackstage){var mementos=map$2(buttons,(function(button){return record(generateOne(memInput,button,providersBackstage))}));return{asSpecs:function(){return map$2(mementos,(function(mem){return mem.asSpec()}))},findPrimary:function(compInSystem){return findMap(buttons,(function(button,i){return button.primary?Optional.from(mementos[i]).bind((function(mem){return mem.getOpt(compInSystem)})).filter(not(Disabling.isDisabled)):Optional.none()}))}}}(memInput,ctx.commands,providers);return[{title:Optional.none(),items:[memInput.asSpec()]},{title:Optional.none(),items:commands.asSpecs()}]},ContextForm_buildInitGroups=buildInitGroups,isVerticalOverlap=function(a,b,threshold){return void 0===threshold&&(threshold=.01),b.bottom-a.y>=threshold&&a.bottom-b.y>=threshold},getSelectionBounds=function(editor){var rect=function(rng){var rect=rng.getBoundingClientRect();if(rect.height<=0&&rect.width<=0){var leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset).element;return(isText$1(leaf$1)?parent(leaf$1):Optional.some(leaf$1)).filter(isElement$2).map((function(e){return e.dom.getBoundingClientRect()})).getOr(rect)}return rect}(editor.selection.getRng());if(editor.inline){var scroll_1=get$9();return bounds(scroll_1.left+rect.left,scroll_1.top+rect.top,rect.width,rect.height)}var bodyPos=absolute$2(SugarElement.fromDom(editor.getBody()));return bounds(bodyPos.x+rect.left,bodyPos.y+rect.top,rect.width,rect.height)},getContextToolbarBounds=function(editor,sharedBackstage,toolbarType,margin){void 0===margin&&(margin=0);var viewportBounds=getBounds$3(window),contentAreaBox=box$1(SugarElement.fromDom(editor.getContentAreaContainer())),toolbarOrMenubarEnabled=isMenubarEnabled(editor)||isToolbarEnabled(editor)||isMultipleToolbars(editor),_a=function(contentAreaBox,viewportBounds,margin){var x=Math.max(contentAreaBox.x+margin,viewportBounds.x);return{x:x,width:Math.min(contentAreaBox.right-margin,viewportBounds.right)-x}}(contentAreaBox,viewportBounds,margin),x=_a.x,width=_a.width;if(editor.inline&&!toolbarOrMenubarEnabled)return bounds(x,viewportBounds.y,width,viewportBounds.height);var _b=function(editor,contentAreaBox,viewportBounds,isToolbarLocationTop,toolbarType,margin){var container=SugarElement.fromDom(editor.getContainer()),header=descendant(container,".tox-editor-header").getOr(container),headerBox=box$1(header),isToolbarBelowContentArea=headerBox.y>=contentAreaBox.bottom,isToolbarAbove=isToolbarLocationTop&&!isToolbarBelowContentArea;if(editor.inline&&isToolbarAbove)return{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:viewportBounds.bottom};if(editor.inline&&!isToolbarAbove)return{y:viewportBounds.y,bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)};var containerBounds="line"===toolbarType?box$1(container):contentAreaBox;return isToolbarAbove?{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:Math.min(containerBounds.bottom-margin,viewportBounds.bottom)}:{y:Math.max(containerBounds.y+margin,viewportBounds.y),bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)}}(editor,contentAreaBox,viewportBounds,sharedBackstage.header.isPositionedAtTop(),toolbarType,margin),y=_b.y,bottom=_b.bottom;return bounds(x,y,width,bottom-y)},bubbleAlignments$1={valignCentre:[],alignCentre:[],alignLeft:["tox-pop--align-left"],alignRight:["tox-pop--align-right"],right:["tox-pop--right"],left:["tox-pop--left"],bottom:["tox-pop--bottom"],top:["tox-pop--top"],inset:["tox-pop--inset"]},anchorOverrides={maxHeightFunction:expandable$1(),maxWidthFunction:expandable()},shouldUseInsetLayouts=function(position){return"node"===position},determineInsetLayout=function(editor,contextbar,elem,data,bounds){var selectionBounds=getSelectionBounds(editor),isSameAnchorElement=data.lastElement().exists((function(prev){return eq(elem,prev)}));return function(editor,elem){var rng=editor.selection.getRng(),leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset);return rng.startContainer===rng.endContainer&&rng.startOffset===rng.endOffset-1&&eq(leaf$1.element,elem)}(editor,elem)?isSameAnchorElement?preserve:north:isSameAnchorElement?function(elem,position,f){var currentPosition=getRaw(elem,"position");set$7(elem,"position",position);var result=f(elem);return currentPosition.each((function(pos){return set$7(elem,"position",pos)})),result}(contextbar,data.getMode(),(function(){return isVerticalOverlap(selectionBounds,box$1(contextbar))&&!data.isReposition()?flip$2:preserve})):("fixed"===data.getMode()?bounds.y+get$9().top:bounds.y)+(get$b(contextbar)+12)<=selectionBounds.y?north:south},getAnchorSpec$2=function(editor,mobile,data,position){var smartInsetLayout=function(elem){return function(anchor,element,bubbles,placee,bounds){var layout=determineInsetLayout(editor,placee,elem,data,bounds),newAnchor=__assign(__assign({},anchor),{y:bounds.y,height:bounds.height});return __assign(__assign({},layout(newAnchor,element,bubbles,placee,bounds)),{alwaysFit:!0})}},getInsetLayouts=function(elem){return shouldUseInsetLayouts(position)?[smartInsetLayout(elem)]:[]};return mobile?{onLtr:function(elem){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2].concat(getInsetLayouts(elem))},onRtl:function(elem){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2].concat(getInsetLayouts(elem))}}:{onLtr:function(elem){return[north$2,south$2,northeast$2,southeast$2,northwest$2,southwest$2].concat(getInsetLayouts(elem))},onRtl:function(elem){return[north$2,south$2,northwest$2,southwest$2,northeast$2,southeast$2].concat(getInsetLayouts(elem))}}},matchTargetWith=function(elem,candidates){var ctxs=filter$2(candidates,(function(toolbarApi){return toolbarApi.predicate(elem.dom)})),_a=partition$3(ctxs,(function(t){return"contexttoolbar"===t.type}));return{contextToolbars:_a.pass,contextForms:_a.fail}},matchStartNode=function(elem,nodeCandidates,editorCandidates){var nodeMatches=matchTargetWith(elem,nodeCandidates);if(nodeMatches.contextForms.length>0)return Optional.some({elem:elem,toolbars:[nodeMatches.contextForms[0]]});var editorMatches=matchTargetWith(elem,editorCandidates);if(editorMatches.contextForms.length>0)return Optional.some({elem:elem,toolbars:[editorMatches.contextForms[0]]});if(nodeMatches.contextToolbars.length>0||editorMatches.contextToolbars.length>0){var toolbars=function(toolbars){if(toolbars.length<=1)return toolbars;var doesPositionExist=function(value){return exists(toolbars,(function(t){return t.position===value}))},filterToolbarsByPosition=function(value){return filter$2(toolbars,(function(t){return t.position===value}))},hasSelectionToolbars=doesPositionExist("selection"),hasNodeToolbars=doesPositionExist("node");if(hasSelectionToolbars||hasNodeToolbars){if(hasNodeToolbars&&hasSelectionToolbars){var nodeToolbars=filterToolbarsByPosition("node"),selectionToolbars=map$2(filterToolbarsByPosition("selection"),(function(t){return __assign(__assign({},t),{position:"node"})}));return nodeToolbars.concat(selectionToolbars)}return filterToolbarsByPosition(hasSelectionToolbars?"selection":"node")}return filterToolbarsByPosition("line")}(nodeMatches.contextToolbars.concat(editorMatches.contextToolbars));return Optional.some({elem:elem,toolbars:toolbars})}return Optional.none()},matchAncestor=function(isRoot,startNode,scopes){return isRoot(startNode)?Optional.none():ancestor$2(startNode,(function(ancestorElem){if(isElement$2(ancestorElem)){var _a=matchTargetWith(ancestorElem,scopes.inNodeScope),contextToolbars=_a.contextToolbars,contextForms=_a.contextForms,toolbars=contextForms.length>0?contextForms:function(toolbars){if(toolbars.length<=1)return toolbars;var findPosition_1=function(value){return find$5(toolbars,(function(t){return t.position===value}))};return findPosition_1("selection").orThunk((function(){return findPosition_1("node")})).orThunk((function(){return findPosition_1("line")})).map((function(t){return t.position})).fold((function(){return[]}),(function(pos){return filter$2(toolbars,(function(t){return t.position===pos}))}))}(contextToolbars);return toolbars.length>0?Optional.some({elem:ancestorElem,toolbars:toolbars}):Optional.none()}return Optional.none()}),isRoot)},categorise=function(contextToolbars,navigate){var forms={},inNodeScope=[],inEditorScope=[],formNavigators={},lookupTable={},registerForm=function(key,toolbarSpec){var contextForm=getOrDie(asRaw("ContextForm",contextFormSchema,toolbarSpec));forms[key]=contextForm,contextForm.launch.map((function(launch){formNavigators["form:"+key]=__assign(__assign({},toolbarSpec.launch),{type:"contextformtogglebutton"===launch.type?"togglebutton":"button",onAction:function(){navigate(contextForm)}})})),"editor"===contextForm.scope?inEditorScope.push(contextForm):inNodeScope.push(contextForm),lookupTable[key]=contextForm},registerToolbar=function(key,toolbarSpec){var spec;(spec=toolbarSpec,asRaw("ContextToolbar",contextToolbarSchema,spec)).each((function(contextToolbar){"editor"===toolbarSpec.scope?inEditorScope.push(contextToolbar):inNodeScope.push(contextToolbar),lookupTable[key]=contextToolbar}))},keys$1=keys(contextToolbars);return each$1(keys$1,(function(key){var toolbarApi=contextToolbars[key];"contextform"===toolbarApi.type?registerForm(key,toolbarApi):"contexttoolbar"===toolbarApi.type&&registerToolbar(key,toolbarApi)})),{forms:forms,inNodeScope:inNodeScope,inEditorScope:inEditorScope,lookupTable:lookupTable,formNavigators:formNavigators}},forwardSlideEvent=generate$6("forward-slide"),backSlideEvent=generate$6("backward-slide"),changeSlideEvent=generate$6("change-slide-event"),register$7=function(editor,registryContextToolbars,sink,extras){var spec,stack,backstage=extras.backstage,sharedBackstage=backstage.shared,isTouch=detect$1().deviceType.isTouch,lastElement=value$1(),lastTrigger=value$1(),lastContextPosition=value$1(),contextbar=build$1((spec={sink:sink,onEscape:function(){return editor.focus(),Optional.some(!0)}},stack=Cell([]),InlineView.sketch({dom:{tag:"div",classes:["tox-pop"]},fireDismissalEventInstead:{event:"doNotDismissYet"},onShow:function(comp){stack.set([]),InlineView.getContent(comp).each((function(c){remove$6(c.element,"visibility")})),remove$2(comp.element,"tox-pop--resizing"),remove$6(comp.element,"width")},inlineBehaviours:derive$1([config("context-toolbar-events",[runOnSource(transitionend(),(function(comp,se){"width"===se.event.raw.propertyName&&(remove$2(comp.element,"tox-pop--resizing"),remove$6(comp.element,"width"))})),run$1(changeSlideEvent,(function(comp,se){var elem=comp.element;remove$6(elem,"width");var currentWidth=get$a(elem);InlineView.setContent(comp,se.event.contents),add$2(elem,"tox-pop--resizing");var newWidth=get$a(elem);set$7(elem,"width",currentWidth+"px"),InlineView.getContent(comp).each((function(newContents){se.event.focus.bind((function(f){return focus$3(f),search(elem)})).orThunk((function(){return Keying.focusIn(newContents),active(getRootNode(elem))}))})),global$f.setTimeout((function(){set$7(comp.element,"width",newWidth+"px")}),0)})),run$1(forwardSlideEvent,(function(comp,se){InlineView.getContent(comp).each((function(oldContents){stack.set(stack.get().concat([{bar:oldContents,focus:active(getRootNode(comp.element))}]))})),emitWith(comp,changeSlideEvent,{contents:se.event.forwardContents,focus:Optional.none()})})),run$1(backSlideEvent,(function(comp,_se){last$2(stack.get()).each((function(last){stack.set(stack.get().slice(0,stack.get().length-1)),emitWith(comp,changeSlideEvent,{contents:premade(last.bar),focus:last.focus})}))}))]),Keying.config({mode:"special",onEscape:function(comp){return last$2(stack.get()).fold((function(){return spec.onEscape()}),(function(_){return emit(comp,backSlideEvent),Optional.some(!0)}))}})]),lazySink:function(){return Result.value(spec.sink)}}))),getBounds=function(){var position=lastContextPosition.get().getOr("node"),margin=shouldUseInsetLayouts(position)?1:0;return getContextToolbarBounds(editor,sharedBackstage,position,margin)},canLaunchToolbar=function(){return!(editor.removed||isTouch()&&backstage.isContextMenuOpen())},shouldContextToolbarHide=function(){if(canLaunchToolbar()){var contextToolbarBounds=getBounds(),anchorBounds=is$1(lastContextPosition.get(),"node")?function(editor,lastElement){return lastElement.filter(inBody).map(absolute$2).getOrThunk((function(){return getSelectionBounds(editor)}))}(editor,lastElement.get()):getSelectionBounds(editor);return contextToolbarBounds.height<=0||!isVerticalOverlap(anchorBounds,contextToolbarBounds)}return!0},close=function(){lastElement.clear(),lastTrigger.clear(),lastContextPosition.clear(),InlineView.hide(contextbar)},hideOrRepositionIfNecessary=function(){if(InlineView.isOpen(contextbar)){var contextBarEle=contextbar.element;remove$6(contextBarEle,"display"),shouldContextToolbarHide()?set$7(contextBarEle,"display","none"):(lastTrigger.set(0),InlineView.reposition(contextbar))}},wrapInPopDialog=function(toolbarSpec){return{dom:{tag:"div",classes:["tox-pop__dialog"]},components:[toolbarSpec],behaviours:derive$1([Keying.config({mode:"acyclic"}),config("pop-dialog-wrap-events",[runOnAttached((function(comp){editor.shortcuts.add("ctrl+F9","focus statusbar",(function(){return Keying.focusIn(comp)}))})),runOnDetached((function(_comp){editor.shortcuts.remove("ctrl+F9")}))])])}},getScopes=cached((function(){return categorise(registryContextToolbars,(function(toolbarApi){var alloySpec=buildToolbar([toolbarApi]);emitWith(contextbar,forwardSlideEvent,{forwardContents:wrapInPopDialog(alloySpec)})}))})),buildToolbar=function(toolbars){var buttons=editor.ui.registry.getAll().buttons,scopes=getScopes(),allButtons=__assign(__assign({},buttons),scopes.formNavigators),toolbarType=getToolbarMode(editor)===ToolbarMode.scrolling?ToolbarMode.scrolling:ToolbarMode.default,initGroups=flatten(map$2(toolbars,(function(ctx){return"contexttoolbar"===ctx.type?function(allButtons,ctx){return identifyButtons(editor,{buttons:allButtons,toolbar:ctx.items,allowToolbarGroups:!1},extras,Optional.some(["form:"]))}(allButtons,ctx):function(ctx,providers){return ContextForm_buildInitGroups(ctx,providers)}(ctx,sharedBackstage.providers)})));return renderToolbar({type:toolbarType,uid:generate$6("context-toolbar"),initGroups:initGroups,onEscape:Optional.none,cyclicKeying:!0,providers:sharedBackstage.providers})},getAnchor=function(position,element){var anchorage="node"===position?sharedBackstage.anchors.node(element):sharedBackstage.anchors.cursor(),anchorLayout=function(editor,position,isTouch,data){return"line"===position?{bubble:nu$5(12,0,bubbleAlignments$1),layouts:{onLtr:function(){return[east$2]},onRtl:function(){return[west$2]}},overrides:anchorOverrides}:{bubble:nu$5(0,12,bubbleAlignments$1,1/12),layouts:getAnchorSpec$2(editor,isTouch,data,position),overrides:anchorOverrides}}(editor,position,isTouch(),{lastElement:lastElement.get,isReposition:function(){return is$1(lastTrigger.get(),0)},getMode:function(){return Positioning.getMode(sink)}});return deepMerge(anchorage,anchorLayout)},launchContext=function(toolbarApi,elem){if(launchContextToolbar.cancel(),canLaunchToolbar()){var toolbarSpec=buildToolbar(toolbarApi),position=toolbarApi[0].position,anchor=getAnchor(position,elem);lastContextPosition.set(position),lastTrigger.set(1);var contextBarEle=contextbar.element;remove$6(contextBarEle,"display"),function(elem){return is$1(lift2(elem,lastElement.get(),eq),!0)}(elem)||(remove$2(contextBarEle,"tox-pop--transition"),Positioning.reset(sink,contextbar)),InlineView.showWithinBounds(contextbar,wrapInPopDialog(toolbarSpec),{anchor:anchor,transition:{classes:["tox-pop--transition"],mode:"placement"}},(function(){return Optional.some(getBounds())})),elem.fold(lastElement.clear,lastElement.set),shouldContextToolbarHide()&&set$7(contextBarEle,"display","none")}},launchContextToolbar=last((function(){editor.hasFocus()&&!editor.removed&&(has(contextbar.element,"tox-pop--transition")?launchContextToolbar.throttle():function(scopes,editor){var rootElem=SugarElement.fromDom(editor.getBody()),isRoot=function(elem){return eq(elem,rootElem)},startNode=SugarElement.fromDom(editor.selection.getNode());return function(startNode){return!isRoot(startNode)&&!contains(rootElem,startNode)}(startNode)?Optional.none():matchStartNode(startNode,scopes.inNodeScope,scopes.inEditorScope).orThunk((function(){return matchAncestor(isRoot,startNode,scopes)}))}(getScopes(),editor).fold(close,(function(info){launchContext(info.toolbars,Optional.some(info.elem))})))}),17);editor.on("init",(function(){editor.on("remove",close),editor.on("ScrollContent ScrollWindow ObjectResized ResizeEditor longpress",hideOrRepositionIfNecessary),editor.on("click keyup focus SetContent",launchContextToolbar.throttle),editor.on("contexttoolbar-hide",close),editor.on("contexttoolbar-show",(function(e){var scopes=getScopes();get$e(scopes.lookupTable,e.toolbarKey).each((function(ctx){launchContext([ctx],someIf(e.target!==editor,e.target)),InlineView.getContent(contextbar).each(Keying.focusIn)}))})),editor.on("focusout",(function(_e){global$f.setEditorTimeout(editor,(function(){search(sink.element).isNone()&&search(contextbar.element).isNone()&&close()}),0)})),editor.on("SwitchMode",(function(){editor.mode.isReadOnly()&&close()})),editor.on("AfterProgressState",(function(event){event.state?close():editor.hasFocus()&&launchContextToolbar.throttle()})),editor.on("NodeChange",(function(_e){search(contextbar.element).fold(launchContextToolbar.throttle,noop)}))}))},units={unsupportedLength:["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","in","pc","pt","px"],fixed:["px","pt"],relative:["%"],empty:[""]},pattern=(unsignedDecimalLiteral=["Infinity","[0-9]+\\."+(opt=function(input){return"(?:"+input+")?"})("[0-9]+")+opt("[eE][+-]?[0-9]+"),"\\.[0-9]+"+opt("[eE][+-]?[0-9]+"),"[0-9]+"+opt("[eE][+-]?[0-9]+")].join("|"),new RegExp("^([+-]?(?:"+unsignedDecimalLiteral+"))(.*)$")),parse=function(input,accepted){return Optional.from(pattern.exec(input)).bind((function(array){var value=Number(array[1]),unitRaw=array[2];return function(unit,accepted){return exists(accepted,(function(acc){return exists(units[acc],(function(check){return unit===check}))}))}(unitRaw,accepted)?Optional.some({value:value,unit:unitRaw}):Optional.none()}))},registerController=function(editor,spec){var getMenuItems=function(){var options=spec.getOptions(editor),initial=spec.getCurrent(editor).map(spec.hash),current=value$1();return map$2(options,(function(value){return{type:"togglemenuitem",text:spec.display(value),onSetup:function(api){var setActive=function(active){active&&(current.on((function(oldApi){return oldApi.setActive(!1)})),current.set(api)),api.setActive(active)};setActive(is$1(initial,spec.hash(value)));var unbindWatcher=spec.watcher(editor,value,setActive);return function(){current.clear(),unbindWatcher()}},onAction:function(){return spec.setCurrent(editor,value)}}}))};editor.ui.registry.addMenuButton(spec.name,{tooltip:spec.text,icon:spec.icon,fetch:function(callback){return callback(getMenuItems())},onSetup:spec.onToolbarSetup}),editor.ui.registry.addNestedMenuItem(spec.name,{type:"nestedmenuitem",text:spec.text,getSubmenuItems:getMenuItems,onSetup:spec.onMenuSetup})},lineHeightSpec={name:"lineheight",text:"Line height",icon:"line-height",getOptions:function(editor){return editor.getParam("lineheight_formats","1 1.1 1.2 1.3 1.4 1.5 2","string").split(" ")},hash:function(input){return function(input,accepted){return parse(input,accepted).map((function(_a){return _a.value+_a.unit}))}(input,["fixed","relative","empty"]).getOr(input)},display:identity$1,watcher:function(editor,value,callback){return editor.formatter.formatChanged("lineheight",callback,!1,{value:value}).unbind},getCurrent:function(editor){return Optional.from(editor.queryCommandValue("LineHeight"))},setCurrent:function(editor,value){return editor.execCommand("LineHeight",!1,value)}},register$5=function(editor){registerController(editor,lineHeightSpec),function(editor){return Optional.from(function(editor){return editor.getParam("content_langs",void 0,"array")}(editor)).map((function(settings){return{name:"language",text:"Language",icon:"language",getOptions:constant$1(settings),hash:function(input){return isUndefined(input.customCode)?input.code:input.code+"/"+input.customCode},display:function(input){return input.title},watcher:function(editor,value,callback){return editor.formatter.formatChanged("lang",callback,!1,{value:value.code,customValue:value.customCode}).unbind},getCurrent:function(editor){var node=SugarElement.fromDom(editor.selection.getNode());return closest$4(node,(function(n){return Optional.some(n).filter(isElement$2).bind((function(ele){return getOpt(ele,"lang").map((function(code){return{code:code,customCode:getOpt(ele,"data-mce-lang").getOrUndefined(),title:""}}))}))}))},setCurrent:function(editor,lang){return editor.execCommand("Lang",!1,lang)},onToolbarSetup:function(api){var unbinder=unbindable();return api.setActive(editor.formatter.match("lang",{},void 0,!0)),unbinder.set(editor.formatter.formatChanged("lang",api.setActive,!0)),unbinder.clear}}}))}(editor).each((function(spec){return registerController(editor,spec)}))},register$4=function(editor,backstage){!function(editor,backstage){var menuItems=createMenuItems(0,backstage,getSpec$4(editor));editor.ui.registry.addNestedMenuItem("align",{text:backstage.shared.providers.translate("Align"),getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var menuItems=createMenuItems(0,backstage,getSpec$3(editor));editor.ui.registry.addNestedMenuItem("fontformats",{text:backstage.shared.providers.translate("Fonts"),getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var dataset=__assign({type:"advanced"},backstage.styleselect),menuItems=createMenuItems(0,backstage,getSpec(editor,dataset));editor.ui.registry.addNestedMenuItem("formats",{text:"Formats",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var menuItems=createMenuItems(0,backstage,getSpec$1(editor));editor.ui.registry.addNestedMenuItem("blockformats",{text:"Blocks",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var menuItems=createMenuItems(0,backstage,getSpec$2(editor));editor.ui.registry.addNestedMenuItem("fontsizes",{text:"Font sizes",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage)},onSetupOutdentState=function(editor){return onSetupEvent(editor,"NodeChange",(function(api){api.setDisabled(!editor.queryCommandState("outdent"))}))},register$3=function(editor){!function(editor){editor.ui.registry.addButton("outdent",{tooltip:"Decrease indent",icon:"outdent",onSetup:onSetupOutdentState(editor),onAction:onActionExecCommand(editor,"outdent")}),editor.ui.registry.addButton("indent",{tooltip:"Increase indent",icon:"indent",onAction:onActionExecCommand(editor,"indent")})}(editor)},onActionToggleFormat=function(editor,fmt){return function(){editor.execCommand("mceToggleFormat",!1,fmt)}},registerButtons$1=function(editor){!function(editor){global$5.each([{name:"bold",text:"Bold",icon:"bold"},{name:"italic",text:"Italic",icon:"italic"},{name:"underline",text:"Underline",icon:"underline"},{name:"strikethrough",text:"Strikethrough",icon:"strike-through"},{name:"subscript",text:"Subscript",icon:"subscript"},{name:"superscript",text:"Superscript",icon:"superscript"}],(function(btn,_idx){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onSetup:onSetupFormatToggle(editor,btn.name),onAction:onActionToggleFormat(editor,btn.name)})}));for(var i=1;i<=6;i++){var name_1="h"+i;editor.ui.registry.addToggleButton(name_1,{text:name_1.toUpperCase(),tooltip:"Heading "+i,onSetup:onSetupFormatToggle(editor,name_1),onAction:onActionToggleFormat(editor,name_1)})}}(editor),function(editor){global$5.each([{name:"cut",text:"Cut",action:"Cut",icon:"cut"},{name:"copy",text:"Copy",action:"Copy",icon:"copy"},{name:"paste",text:"Paste",action:"Paste",icon:"paste"},{name:"help",text:"Help",action:"mceHelp",icon:"help"},{name:"selectall",text:"Select all",action:"SelectAll",icon:"select-all"},{name:"newdocument",text:"New document",action:"mceNewDocument",icon:"new-document"},{name:"removeformat",text:"Clear formatting",action:"RemoveFormat",icon:"remove-formatting"},{name:"remove",text:"Remove",action:"Delete",icon:"remove"}],(function(btn){editor.ui.registry.addButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action)})}))}(editor),function(editor){global$5.each([{name:"blockquote",text:"Blockquote",action:"mceBlockQuote",icon:"quote"}],(function(btn){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action),onSetup:onSetupFormatToggle(editor,btn.name)})}))}(editor)},register$2=function(editor){registerButtons$1(editor),function(editor){global$5.each([{name:"bold",text:"Bold",action:"Bold",icon:"bold",shortcut:"Meta+B"},{name:"italic",text:"Italic",action:"Italic",icon:"italic",shortcut:"Meta+I"},{name:"underline",text:"Underline",action:"Underline",icon:"underline",shortcut:"Meta+U"},{name:"strikethrough",text:"Strikethrough",action:"Strikethrough",icon:"strike-through",shortcut:""},{name:"subscript",text:"Subscript",action:"Subscript",icon:"subscript",shortcut:""},{name:"superscript",text:"Superscript",action:"Superscript",icon:"superscript",shortcut:""},{name:"removeformat",text:"Clear formatting",action:"RemoveFormat",icon:"remove-formatting",shortcut:""},{name:"newdocument",text:"New document",action:"mceNewDocument",icon:"new-document",shortcut:""},{name:"cut",text:"Cut",action:"Cut",icon:"cut",shortcut:"Meta+X"},{name:"copy",text:"Copy",action:"Copy",icon:"copy",shortcut:"Meta+C"},{name:"paste",text:"Paste",action:"Paste",icon:"paste",shortcut:"Meta+V"},{name:"selectall",text:"Select all",action:"SelectAll",icon:"select-all",shortcut:"Meta+A"}],(function(btn){editor.ui.registry.addMenuItem(btn.name,{text:btn.text,icon:btn.icon,shortcut:btn.shortcut,onAction:onActionExecCommand(editor,btn.action)})})),editor.ui.registry.addMenuItem("codeformat",{text:"Code",icon:"sourcecode",onAction:onActionToggleFormat(editor,"code")})}(editor)},onSetupUndoRedoState=function(editor,type){return onSetupEvent(editor,"Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",(function(api){api.setDisabled(editor.mode.isReadOnly()||!editor.undoManager[type]())}))},register$1=function(editor){!function(editor){editor.ui.registry.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onSetup:onSetupUndoRedoState(editor,"hasUndo"),onAction:onActionExecCommand(editor,"undo")}),editor.ui.registry.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onSetup:onSetupUndoRedoState(editor,"hasRedo"),onAction:onActionExecCommand(editor,"redo")})}(editor),function(editor){editor.ui.registry.addButton("undo",{tooltip:"Undo",icon:"undo",disabled:!0,onSetup:onSetupUndoRedoState(editor,"hasUndo"),onAction:onActionExecCommand(editor,"undo")}),editor.ui.registry.addButton("redo",{tooltip:"Redo",icon:"redo",disabled:!0,onSetup:onSetupUndoRedoState(editor,"hasRedo"),onAction:onActionExecCommand(editor,"redo")})}(editor)},onSetupVisualAidState=function(editor){return onSetupEvent(editor,"VisualAid",(function(api){api.setActive(editor.hasVisual)}))},register=function(editor){!function(editor){editor.ui.registry.addButton("visualaid",{tooltip:"Visual aids",text:"Visual aids",onAction:onActionExecCommand(editor,"mceToggleVisualAid")})}(editor),function(editor){editor.ui.registry.addToggleMenuItem("visualaid",{text:"Visual aids",onSetup:onSetupVisualAidState(editor),onAction:onActionExecCommand(editor,"mceToggleVisualAid")})}(editor)},setup$6=function(editor,backstage){!function(editor){each$1([{name:"alignleft",text:"Align left",cmd:"JustifyLeft",icon:"align-left"},{name:"aligncenter",text:"Align center",cmd:"JustifyCenter",icon:"align-center"},{name:"alignright",text:"Align right",cmd:"JustifyRight",icon:"align-right"},{name:"alignjustify",text:"Justify",cmd:"JustifyFull",icon:"align-justify"}],(function(item){editor.ui.registry.addToggleButton(item.name,{tooltip:item.text,icon:item.icon,onAction:onActionExecCommand(editor,item.cmd),onSetup:onSetupFormatToggle(editor,item.name)})})),editor.ui.registry.addButton("alignnone",{tooltip:"No alignment",icon:"align-none",onAction:onActionExecCommand(editor,"JustifyNone")})}(editor),register$2(editor),register$4(editor,backstage),register$1(editor),function(editor){!function(editor){editor.addCommand("mceApplyTextcolor",(function(format,value){!function(editor,format,value){editor.undoManager.transact((function(){editor.focus(),editor.formatter.apply(format,{value:value}),editor.nodeChanged()}))}(editor,format,value)})),editor.addCommand("mceRemoveTextcolor",(function(format){!function(editor,format){editor.undoManager.transact((function(){editor.focus(),editor.formatter.remove(format,{value:null},null,!0),editor.nodeChanged()}))}(editor,format)}))}(editor);var lastForeColor=Cell("#000000"),lastBackColor=Cell("#000000");registerTextColorButton(editor,"forecolor","forecolor","Text color",lastForeColor),registerTextColorButton(editor,"backcolor","hilitecolor","Background color",lastBackColor),registerTextColorMenuItem(editor,"forecolor","forecolor","Text color"),registerTextColorMenuItem(editor,"backcolor","hilitecolor","Background color")}(editor),register(editor),register$3(editor),register$5(editor)},nu=function(x,y){return{type:"makeshift",x:x,y:y}},isTouchEvent=function(e){return"longpress"===e.type||0===e.type.indexOf("touch")},transposeContentAreaContainer=function(element,pos){var containerPos=global$b.DOM.getPos(element);return function(pos,dx,dy){return nu(pos.x+dx,pos.y+dy)}(pos,containerPos.x,containerPos.y)},getPointAnchor=function(editor,e){return"contextmenu"===e.type||"longpress"===e.type?editor.inline?function(e){if(isTouchEvent(e)){var touch=e.touches[0];return nu(touch.pageX,touch.pageY)}return nu(e.pageX,e.pageY)}(e):transposeContentAreaContainer(editor.getContentAreaContainer(),function(e){if(isTouchEvent(e)){var touch=e.touches[0];return nu(touch.clientX,touch.clientY)}return nu(e.clientX,e.clientY)}(e)):getSelectionAnchor(editor)},getSelectionAnchor=function(editor){return{type:"selection",root:SugarElement.fromDom(editor.selection.getNode())}},getAnchorSpec$1=function(editor,e,anchorType){switch(anchorType){case"node":return function(editor){return{type:"node",node:Optional.some(SugarElement.fromDom(editor.selection.getNode())),root:SugarElement.fromDom(editor.getBody())}}(editor);case"point":return getPointAnchor(editor,e);case"selection":return getSelectionAnchor(editor)}},initAndShow$1=function(editor,e,buildMenu,backstage,contextmenu,anchorType){var items=buildMenu(),anchorSpec=getAnchorSpec$1(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1).map((function(menuData){e.preventDefault(),InlineView.showMenuAt(contextmenu,{anchor:anchorSpec},{menu:{markers:markers("normal")},data:menuData})}))},layouts={onLtr:function(){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2,north,south,northeast,southeast,northwest,southwest]},onRtl:function(){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2,north,south,northwest,southwest,northeast,southeast]}},bubbleAlignments={valignCentre:[],alignCentre:[],alignLeft:["tox-pop--align-left"],alignRight:["tox-pop--align-right"],right:["tox-pop--right"],left:["tox-pop--left"],bottom:["tox-pop--bottom"],top:["tox-pop--top"]},show=function(editor,e,items,backstage,contextmenu,anchorType,highlightImmediately){var anchorSpec=function(editor,e,anchorType){var anchorSpec=getAnchorSpec$1(editor,e,anchorType);return __assign({bubble:nu$5(0,"point"===anchorType?12:0,bubbleAlignments),layouts:layouts,overrides:{maxWidthFunction:expandable(),maxHeightFunction:expandable$1()}},anchorSpec)}(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!0).map((function(menuData){e.preventDefault(),InlineView.showMenuWithinBounds(contextmenu,{anchor:anchorSpec},{menu:{markers:markers("normal"),highlightImmediately:highlightImmediately},data:menuData,type:"horizontal"},(function(){return Optional.some(getContextToolbarBounds(editor,backstage.shared,"node"===anchorType?"node":"selection"))})),editor.fire("contexttoolbar-hide")}))},initAndShow=function(editor,e,buildMenu,backstage,contextmenu,anchorType){var detection=detect$1(),isiOS=detection.os.isiOS(),isOSX=detection.os.isOSX(),isAndroid=detection.os.isAndroid(),isTouch=detection.deviceType.isTouch(),open=function(){var items=buildMenu();show(editor,e,items,backstage,contextmenu,anchorType,!(isAndroid||isiOS||isOSX&&isTouch))};if((isOSX||isiOS)&&"node"!==anchorType){var openiOS_1=function(){!function(editor){var originalSelection=editor.selection.getRng(),selectionReset=function(){global$f.setEditorTimeout(editor,(function(){editor.selection.setRng(originalSelection)}),10),unbindEventListeners()};editor.once("touchend",selectionReset);var preventMousedown=function(e){e.preventDefault(),e.stopImmediatePropagation()};editor.on("mousedown",preventMousedown,!0);var clearSelectionReset=function(){return unbindEventListeners()};editor.once("longpresscancel",clearSelectionReset);var unbindEventListeners=function(){editor.off("touchend",selectionReset),editor.off("longpresscancel",clearSelectionReset),editor.off("mousedown",preventMousedown)}}(editor),open()};!function(editor,e){var selection=editor.selection;if(selection.isCollapsed()||e.touches.length<1)return!1;var touch_1=e.touches[0],rng=selection.getRng();return getFirstRect(editor.getWin(),SimSelection.domRange(rng)).exists((function(rngRect){return rngRect.left<=touch_1.clientX&&rngRect.right>=touch_1.clientX&&rngRect.top<=touch_1.clientY&&rngRect.bottom>=touch_1.clientY}))}(editor,e)?(editor.once("selectionchange",openiOS_1),editor.once("touchend",(function(){return editor.off("selectionchange",openiOS_1)}))):openiOS_1()}else open()},patchPipeConfig=function(config){return"string"==typeof config?config.split(/[ ,]/):config},shouldNeverUseNative=function(editor){return editor.getParam("contextmenu_never_use_native",!1,"boolean")},getContextMenu=function(editor){return function(editor,name,defaultItems){var contextMenus=editor.ui.registry.getAll().contextMenus;return Optional.from(editor.getParam(name)).map(patchPipeConfig).getOrThunk((function(){return filter$2(patchPipeConfig(defaultItems),(function(item){return has$2(contextMenus,item)}))}))}(editor,"contextmenu","link linkchecker image imagetools table spellchecker configurepermanentpen")},isSeparator=function(item){return isString(item)?"|"===item:"separator"===item.type},separator={type:"separator"},makeContextItem=function(item){var f,commonMenuItem=function(item){return{text:item.text,icon:item.icon,disabled:item.disabled,shortcut:item.shortcut}};if(isString(item))return item;switch(item.type){case"separator":return separator;case"submenu":return __assign(__assign({type:"nestedmenuitem"},commonMenuItem(item)),{getSubmenuItems:function(){var items=item.getSubmenuItems();return isString(items)?items:map$2(items,makeContextItem)}});default:return __assign(__assign({type:"menuitem"},commonMenuItem(item)),{onAction:(f=item.onAction,function(){return f()})})}},addContextMenuGroup=function(xs,groupItems){if(0===groupItems.length)return xs;var before=last$2(xs).filter((function(item){return!isSeparator(item)})).fold((function(){return[]}),(function(_){return[separator]}));return xs.concat(before).concat(groupItems).concat([separator])},isTriggeredByKeyboard=function(editor,e){return"longpress"!==e.type&&(2!==e.button||e.target===editor.getBody()&&""===e.pointerType)},getSelectedElement=function(editor,e){return isTriggeredByKeyboard(editor,e)?editor.selection.getStart(!0):e.target},setup$5=function(editor,lazySink,backstage){var isTouch=detect$1().deviceType.isTouch,contextmenu=build$1(InlineView.sketch({dom:{tag:"div"},lazySink:lazySink,onEscape:function(){return editor.focus()},onShow:function(){return backstage.setContextMenuState(!0)},onHide:function(){return backstage.setContextMenuState(!1)},fireDismissalEventInstead:{},inlineBehaviours:derive$1([config("dismissContextMenu",[run$1(dismissRequested(),(function(comp,_se){Sandboxing.close(comp),editor.focus()}))])])})),hideContextMenu=function(_e){return InlineView.hide(contextmenu)},showContextMenu=function(e){if(shouldNeverUseNative(editor)&&e.preventDefault(),!function(editor,e){return e.ctrlKey&&!shouldNeverUseNative(editor)}(editor,e)&&!function(editor){return!1===editor.getParam("contextmenu")}(editor)){var anchorType=function(editor,e){var selector=function(editor){return editor.getParam("contextmenu_avoid_overlap","","string")}(editor),anchorType=isTriggeredByKeyboard(editor,e)?"selection":"point";if(isNotEmpty(selector)){var target=getSelectedElement(editor,e);return closest(SugarElement.fromDom(target),selector)?"node":anchorType}return anchorType}(editor,e);(isTouch()?initAndShow:initAndShow$1)(editor,e,(function(){var selectedElement=getSelectedElement(editor,e),registry=editor.ui.registry.getAll(),menuConfig=getContextMenu(editor);return function(contextMenus,menuConfig,selectedElement){var sections=foldl(menuConfig,(function(acc,name){return get$e(contextMenus,name.toLowerCase()).map((function(menu){var items=menu.update(selectedElement);if(isString(items))return addContextMenuGroup(acc,items.split(" "));if(items.length>0){var allItems=map$2(items,makeContextItem);return addContextMenuGroup(acc,allItems)}return acc})).getOrThunk((function(){return acc.concat([name])}))}),[]);return sections.length>0&&isSeparator(sections[sections.length-1])&&sections.pop(),sections}(registry.contextMenus,menuConfig,selectedElement)}),backstage,contextmenu,anchorType)}};editor.on("init",(function(){var hideEvents="ResizeEditor ScrollContent ScrollWindow longpresscancel"+(isTouch()?"":" ResizeWindow");editor.on(hideEvents,hideContextMenu),editor.on("longpress contextmenu",showContextMenu)}))},adt=Adt_generate([{offset:["x","y"]},{absolute:["x","y"]},{fixed:["x","y"]}]),subtract=function(change){return function(point){return point.translate(-change.left,-change.top)}},add=function(change){return function(point){return point.translate(change.left,change.top)}},transform=function(changes){return function(x,y){return foldl(changes,(function(rest,f){return f(rest)}),SugarPosition(x,y))}},asFixed=function(coord,scroll,origin){return coord.fold(transform([add(origin),subtract(scroll)]),transform([subtract(scroll)]),transform([]))},asAbsolute=function(coord,scroll,origin){return coord.fold(transform([add(origin)]),transform([]),transform([add(scroll)]))},asOffset=function(coord,scroll,origin){return coord.fold(transform([]),transform([subtract(origin)]),transform([add(scroll),subtract(origin)]))},toStyles=function(coord,scroll,origin){var stylesOpt=coord.fold((function(x,y){return{position:Optional.some("absolute"),left:Optional.some(x+"px"),top:Optional.some(y+"px")}}),(function(x,y){return{position:Optional.some("absolute"),left:Optional.some(x-origin.left+"px"),top:Optional.some(y-origin.top+"px")}}),(function(x,y){return{position:Optional.some("fixed"),left:Optional.some(x+"px"),top:Optional.some(y+"px")}}));return __assign({right:Optional.none(),bottom:Optional.none()},stylesOpt)},absorb=function(partialCoord,originalCoord,scroll,origin){var absorbOne=function(stencil,nu){return function(optX,optY){var original=stencil(originalCoord,scroll,origin);return nu(optX.getOr(original.left),optY.getOr(original.top))}};return partialCoord.fold(absorbOne(asOffset,offset),absorbOne(asAbsolute,absolute),absorbOne(asFixed,fixed))},offset=adt.offset,absolute=adt.absolute,fixed=adt.fixed,parseAttrToInt=function(element,name){var value=get$d(element,name);return isUndefined(value)?NaN:parseInt(value,10)},getCoords=function(component,snapInfo,coord,delta){return function(component,snapsInfo){var element=component.element,x=parseAttrToInt(element,snapsInfo.leftAttr),y=parseAttrToInt(element,snapsInfo.topAttr);return isNaN(x)||isNaN(y)?Optional.none():Optional.some(SugarPosition(x,y))}(component,snapInfo).fold((function(){return coord}),(function(fixed$1){return fixed(fixed$1.left+delta.left,fixed$1.top+delta.top)}))},moveOrSnap=function(component,snapInfo,coord,delta,scroll,origin){var newCoord=getCoords(component,snapInfo,coord,delta),snap=snapInfo.mustSnap?findClosestSnap(component,snapInfo,newCoord,scroll,origin):findSnap(component,snapInfo,newCoord,scroll,origin),fixedCoord=asFixed(newCoord,scroll,origin);return function(component,snapsInfo,pt){var element=component.element;set$8(element,snapsInfo.leftAttr,pt.left+"px"),set$8(element,snapsInfo.topAttr,pt.top+"px")}(component,snapInfo,fixedCoord),snap.fold((function(){return{coord:fixed(fixedCoord.left,fixedCoord.top),extra:Optional.none()}}),(function(spanned){return{coord:spanned.output,extra:spanned.extra}}))},stopDrag=function(component,snapInfo){!function(component,snapsInfo){var element=component.element;remove$7(element,snapsInfo.leftAttr),remove$7(element,snapsInfo.topAttr)}(component,snapInfo)},findMatchingSnap=function(snaps,newCoord,scroll,origin){return findMap(snaps,(function(snap){var sensor=snap.sensor;return function(coord1,coord2,xRange,yRange,scroll,origin){var a1=asAbsolute(coord1,scroll,origin),a2=asAbsolute(coord2,scroll,origin);return Math.abs(a1.left-a2.left)<=xRange&&Math.abs(a1.top-a2.top)<=yRange}(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin)?Optional.some({output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}):Optional.none()}))},findClosestSnap=function(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component);return findMatchingSnap(snaps,newCoord,scroll,origin).orThunk((function(){return foldl(snaps,(function(acc,snap){var sensor=snap.sensor,deltas=function(coord1,coord2,xRange,yRange,scroll,origin){var a1=asAbsolute(coord1,scroll,origin),a2=asAbsolute(coord2,scroll,origin),left=Math.abs(a1.left-a2.left),top=Math.abs(a1.top-a2.top);return SugarPosition(left,top)}(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return acc.deltas.fold((function(){return{deltas:Optional.some(deltas),snap:Optional.some(snap)}}),(function(bestDeltas){return(deltas.left+deltas.top)/2<=(bestDeltas.left+bestDeltas.top)/2?{deltas:Optional.some(deltas),snap:Optional.some(snap)}:acc}))}),{deltas:Optional.none(),snap:Optional.none()}).snap.map((function(snap){return{output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}}))}))},findSnap=function(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component);return findMatchingSnap(snaps,newCoord,scroll,origin)},DraggingApis=Object.freeze({__proto__:null,snapTo:function(component,dragConfig,_state,snap){var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element),scroll_1=get$9(doc),origin_1=getOrigin(target),snapPin=function(snap,scroll,origin){return{coord:absorb(snap.output,snap.output,scroll,origin),extra:snap.extra}}(snap,scroll_1,origin_1),styles=toStyles(snapPin.coord,0,origin_1);setOptions(target,styles)}}}),instigate=function(anyComponent,blocker){anyComponent.getSystem().addToGui(blocker),function(blocker){parent(blocker.element).filter(isElement$2).each((function(root){getRaw(root,"z-index").each((function(zindex){set$8(root,"data-initial-z-index",zindex)})),set$7(root,"z-index",get$c(blocker.element,"z-index"))}))}(blocker)},discard=function(blocker){!function(blocker){parent(blocker.element).filter(isElement$2).each((function(root){getOpt(root,"data-initial-z-index").fold((function(){return remove$6(root,"z-index")}),(function(zIndex){return set$7(root,"z-index",zIndex)})),remove$7(root,"data-initial-z-index")}))}(blocker),blocker.getSystem().removeFromGui(blocker)},createComponent=function(component,blockerClass,blockerEvents){return component.getSystem().build(Container.sketch({dom:{styles:{left:"0px",top:"0px",width:"100%",height:"100%",position:"fixed","z-index":"1000000000000000"},classes:[blockerClass]},events:blockerEvents}))},SnapSchema=optionObjOf("snaps",[required$1("getSnapPoints"),onHandler("onSensor"),required$1("leftAttr"),required$1("topAttr"),defaulted("lazyViewport",win),defaulted("mustSnap",!1)]),schema$6=[defaulted("useFixed",never),required$1("blockerClass"),defaulted("getTarget",identity$1),defaulted("onDrag",noop),defaulted("repositionTarget",!0),defaulted("onDrop",noop),defaultedFunction("getBounds",win),SnapSchema],getCurrentCoord=function(target){return(oa=getRaw(target,"left"),ob=getRaw(target,"top"),oc=getRaw(target,"position"),f=function(left,top,position){return("fixed"===position?fixed:offset)(parseInt(left,10),parseInt(top,10))},oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()).getOrThunk((function(){var location=absolute$3(target);return absolute(location.left,location.top)}));var oa,ob,oc,f},calcNewCoord=function(component,optSnaps,currentCoord,scroll,origin,delta,startData){return function(component,coords,scroll,origin,startData){var bounds=startData.bounds,absoluteCoord=asAbsolute(coords,scroll,origin),newX=clamp$1(absoluteCoord.left,bounds.x,bounds.x+bounds.width-startData.width),newY=clamp$1(absoluteCoord.top,bounds.y,bounds.y+bounds.height-startData.height),newCoords=absolute(newX,newY);return coords.fold((function(){var offset$1=asOffset(newCoords,scroll,origin);return offset(offset$1.left,offset$1.top)}),constant$1(newCoords),(function(){var fixed$1=asFixed(newCoords,scroll,origin);return fixed(fixed$1.left,fixed$1.top)}))}(0,optSnaps.fold((function(){var coord,deltaX,deltaY,translated=(coord=currentCoord,deltaX=delta.left,deltaY=delta.top,coord.fold((function(x,y){return offset(x+deltaX,y+deltaY)}),(function(x,y){return absolute(x+deltaX,y+deltaY)}),(function(x,y){return fixed(x+deltaX,y+deltaY)}))),fixedCoord=asFixed(translated,scroll,origin);return fixed(fixedCoord.left,fixedCoord.top)}),(function(snapInfo){var snapping=moveOrSnap(component,snapInfo,currentCoord,delta,scroll,origin);return snapping.extra.each((function(extra){snapInfo.onSensor(component,extra)})),snapping.coord})),scroll,origin,startData)},calcStartData=function(dragConfig,comp){return{bounds:dragConfig.getBounds(),height:getOuter$2(comp.element),width:getOuter$1(comp.element)}},move=function(component,dragConfig,dragState,dragMode,event){var delta=dragState.update(dragMode,event),dragStartData=dragState.getStartData().getOrThunk((function(){return calcStartData(dragConfig,component)}));delta.each((function(dlt){!function(component,dragConfig,startData,delta){var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element),scroll_1=get$9(doc),origin_1=getOrigin(target),currentCoord=getCurrentCoord(target),newCoord=calcNewCoord(component,dragConfig.snaps,currentCoord,scroll_1,origin_1,delta,startData),styles=toStyles(newCoord,0,origin_1);setOptions(target,styles)}dragConfig.onDrag(component,target,delta)}(component,dragConfig,dragStartData,dlt)}))},stop=function(component,blocker,dragConfig,dragState){blocker.each(discard),dragConfig.snaps.each((function(snapInfo){stopDrag(component,snapInfo)}));var target=dragConfig.getTarget(component.element);dragState.reset(),dragConfig.onDrop(component,target)},handlers=function(events){return function(dragConfig,dragState){var updateStartState=function(comp){dragState.setStartData(calcStartData(dragConfig,comp))};return derive$2(__spreadArray([run$1(windowScroll(),(function(comp){dragState.getStartData().each((function(){return updateStartState(comp)}))}))],events(dragConfig,dragState,updateStartState),!0))}},MouseData=Object.freeze({__proto__:null,getData:function(event){return Optional.from(SugarPosition(event.x,event.y))},getDelta:function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)}}),events$2=function(dragConfig,dragState,updateStartState){return[run$1(mousedown(),(function(component,simulatedEvent){if(0===simulatedEvent.event.raw.button){simulatedEvent.stop();var stop$1=function(){return stop(component,Optional.some(blocker),dragConfig,dragState)},delayDrop=DelayedFunction(stop$1,200),dragApi={drop:stop$1,delayDrop:delayDrop.schedule,forceDrop:stop$1,move:function(event){delayDrop.cancel(),move(component,dragConfig,dragState,MouseData,event)}},blocker=createComponent(component,dragConfig.blockerClass,function(dragApi){return derive$2([run$1(mousedown(),dragApi.forceDrop),run$1(mouseup(),dragApi.drop),run$1(mousemove(),(function(comp,simulatedEvent){dragApi.move(simulatedEvent.event)})),run$1(mouseout(),dragApi.delayDrop)])}(dragApi));updateStartState(component),instigate(component,blocker)}}))]},schema$5=__spreadArray(__spreadArray([],schema$6,!0),[output$1("dragger",{handlers:handlers(events$2)})],!1),TouchData=Object.freeze({__proto__:null,getData:function(event){var touches=event.raw.touches;return 1===touches.length?function(touches){var touch=touches[0];return Optional.some(SugarPosition(touch.clientX,touch.clientY))}(touches):Optional.none()},getDelta:function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)}}),events$1=function(dragConfig,dragState,updateStartState){var blockerSingleton=value$1(),stopBlocking=function(component){stop(component,blockerSingleton.get(),dragConfig,dragState),blockerSingleton.clear()};return[run$1(touchstart(),(function(component,simulatedEvent){simulatedEvent.stop();var stop=function(){return stopBlocking(component)},dragApi={drop:stop,delayDrop:noop,forceDrop:stop,move:function(event){move(component,dragConfig,dragState,TouchData,event)}},blocker=createComponent(component,dragConfig.blockerClass,function(dragApi){return derive$2([run$1(touchstart(),dragApi.forceDrop),run$1(touchend(),dragApi.drop),run$1(touchcancel(),dragApi.drop),run$1(touchmove(),(function(comp,simulatedEvent){dragApi.move(simulatedEvent.event)}))])}(dragApi));blockerSingleton.set(blocker);updateStartState(component),instigate(component,blocker)})),run$1(touchmove(),(function(component,simulatedEvent){simulatedEvent.stop(),move(component,dragConfig,dragState,TouchData,simulatedEvent.event)})),run$1(touchend(),(function(component,simulatedEvent){simulatedEvent.stop(),stopBlocking(component)})),run$1(touchcancel(),stopBlocking)]},mouse=schema$5,touch=__spreadArray(__spreadArray([],schema$6,!0),[output$1("dragger",{handlers:handlers(events$1)})],!1),mouseOrTouch=__spreadArray(__spreadArray([],schema$6,!0),[output$1("dragger",{handlers:handlers((function(dragConfig,dragState,updateStartState){return __spreadArray(__spreadArray([],events$2(dragConfig,dragState,updateStartState),!0),events$1(dragConfig,dragState,updateStartState),!0)}))})],!1),Dragging=createModes({branchKey:"mode",branches:Object.freeze({__proto__:null,mouse:mouse,touch:touch,mouseOrTouch:mouseOrTouch}),name:"dragging",active:{events:function(dragConfig,dragState){return dragConfig.dragger.handlers(dragConfig,dragState)}},extra:{snap:function(sConfig){return{sensor:sConfig.sensor,range:sConfig.range,output:sConfig.output,extra:Optional.from(sConfig.extra)}}},state:Object.freeze({__proto__:null,init:function(){var previous=Optional.none(),startData=Optional.none(),readState=constant$1({});return nu$8({readState:readState,reset:function(){previous=Optional.none(),startData=Optional.none()},update:function(mode,dragEvent){return mode.getData(dragEvent).bind((function(nuData){return function(mode,nu){var result=previous.map((function(old){return mode.getDelta(old,nu)}));return previous=Optional.some(nu),result}(mode,nuData)}))},getStartData:function(){return startData},setStartData:function(data){startData=Optional.some(data)}})}}),apis:DraggingApis}),calcSnap=function(selectorOpt,td,x,y,width,height){return selectorOpt.fold((function(){return Dragging.snap({sensor:absolute(x-20,y-20),range:SugarPosition(width,height),output:absolute(Optional.some(x),Optional.some(y)),extra:{td:td}})}),(function(selectorHandle){var sensorLeft=x-20,sensorTop=y-20,rect=selectorHandle.element.dom.getBoundingClientRect();return Dragging.snap({sensor:absolute(sensorLeft,sensorTop),range:SugarPosition(40,40),output:absolute(Optional.some(x-rect.width/2),Optional.some(y-rect.height/2)),extra:{td:td}})}))},getSnapsConfig=function(getSnapPoints,cell,onChange){return{getSnapPoints:getSnapPoints,leftAttr:"data-drag-left",topAttr:"data-drag-top",onSensor:function(component,extra){var td=extra.td;(function(cellOpt,td){return cellOpt.exists((function(currentTd){return eq(currentTd,td)}))})(cell.get(),td)||(cell.set(td),onChange(td))},mustSnap:!0}},createSelector=function(snaps){return record(Button.sketch({dom:{tag:"div",classes:["tox-selector"]},buttonBehaviours:derive$1([Dragging.config({mode:"mouseOrTouch",blockerClass:"blocker",snaps:snaps}),Unselecting.config({})]),eventOrder:{mousedown:["dragging","alloy.base.behaviour"],touchstart:["dragging","alloy.base.behaviour"]}}))},setup$4=function(editor,sink){var tlTds=Cell([]),brTds=Cell([]),isVisible=Cell(!1),startCell=value$1(),finishCell=value$1(),getTopLeftSnap=function(td){var box=absolute$2(td);return calcSnap(memTopLeft.getOpt(sink),td,box.x,box.y,box.width,box.height)},getBottomRightSnap=function(td){var box=absolute$2(td);return calcSnap(memBottomRight.getOpt(sink),td,box.right,box.bottom,box.width,box.height)},topLeftSnaps=getSnapsConfig((function(){return map$2(tlTds.get(),(function(td){return getTopLeftSnap(td)}))}),startCell,(function(start){finishCell.get().each((function(finish){editor.fire("TableSelectorChange",{start:start,finish:finish})}))})),bottomRightSnaps=getSnapsConfig((function(){return map$2(brTds.get(),(function(td){return getBottomRightSnap(td)}))}),finishCell,(function(finish){startCell.get().each((function(start){editor.fire("TableSelectorChange",{start:start,finish:finish})}))})),memTopLeft=createSelector(topLeftSnaps),memBottomRight=createSelector(bottomRightSnaps),topLeft=build$1(memTopLeft.asSpec()),bottomRight=build$1(memBottomRight.asSpec()),snapTo=function(selector,cell,getSnapConfig,pos){var snap=getSnapConfig(cell);Dragging.snapTo(selector,snap);!function(selector,cell,isAbove,isBelow){var cellRect=cell.dom.getBoundingClientRect();remove$6(selector.element,"display");var viewportHeight=defaultView(SugarElement.fromDom(editor.getBody())).dom.innerHeight,aboveViewport=isAbove(cellRect),belowViewport=isBelow(cellRect,viewportHeight);(aboveViewport||belowViewport)&&set$7(selector.element,"display","none")}(selector,cell,(function(rect){return rect[pos]<0}),(function(rect,viewportHeight){return rect[pos]>viewportHeight}))},snapTopLeft=function(cell){return snapTo(topLeft,cell,getTopLeftSnap,"top")},snapBottomRight=function(cell){return snapTo(bottomRight,cell,getBottomRightSnap,"bottom")};detect$1().deviceType.isTouch()&&(editor.on("TableSelectionChange",(function(e){isVisible.get()||(attach(sink,topLeft),attach(sink,bottomRight),isVisible.set(!0)),startCell.set(e.start),finishCell.set(e.finish),e.otherCells.each((function(otherCells){tlTds.set(otherCells.upOrLeftCells),brTds.set(otherCells.downOrRightCells),snapTopLeft(e.start),snapBottomRight(e.finish)}))})),editor.on("ResizeEditor ResizeWindow ScrollContent",(function(){startCell.get().each(snapTopLeft),finishCell.get().each(snapBottomRight)})),editor.on("TableSelectionClear",(function(){isVisible.get()&&(detach(topLeft),detach(bottomRight),isVisible.set(!1)),startCell.clear(),finishCell.clear()})))},isHidden=function(elm){if(1===elm.nodeType){if("BR"===elm.nodeName||elm.getAttribute("data-mce-bogus"))return!0;if("bookmark"===elm.getAttribute("data-mce-type"))return!0}return!1},renderElementPath=function(editor,settings,providersBackstage){settings.delimiter||(settings.delimiter="Â»");return{dom:{tag:"div",classes:["tox-statusbar__path"],attributes:{role:"navigation"}},behaviours:derive$1([Keying.config({mode:"flow",selector:"div[role=button]"}),Disabling.config({disabled:providersBackstage.isDisabled}),receivingConfig(),Tabstopping.config({}),Replacing.config({}),config("elementPathEvents",[runOnAttached((function(comp,_e){editor.shortcuts.add("alt+F11","focus statusbar elementpath",(function(){return Keying.focusIn(comp)})),editor.on("NodeChange",(function(e){var newPathElements,divider,newPath=function(parents){for(var newPath=[],i=parents.length;i-- >0;){var parent_1=parents[i];if(1===parent_1.nodeType&&!isHidden(parent_1)){var args=editor.fire("ResolveName",{name:parent_1.nodeName.toLowerCase(),target:parent_1});if(args.isDefaultPrevented()||newPath.push({name:args.name,element:parent_1}),args.isPropagationStopped())break}}return newPath}(e.parents);newPath.length>0?Replacing.set(comp,(newPathElements=map$2(newPath||[],(function(part,index){return Button.sketch({dom:{tag:"div",classes:["tox-statusbar__path-item"],attributes:{role:"button","data-index":index,"tab-index":-1,"aria-level":index+1},innerHtml:part.name},action:function(_btn){editor.focus(),editor.selection.select(part.element),editor.nodeChanged()},buttonBehaviours:derive$1([DisablingConfigs_button(providersBackstage.isDisabled),receivingConfig()])})})),divider={dom:{tag:"div",classes:["tox-statusbar__path-divider"],attributes:{"aria-hidden":!0},innerHtml:" "+settings.delimiter+" "}},foldl(newPathElements.slice(1),(function(acc,element){var newAcc=acc;return newAcc.push(divider),newAcc.push(element),newAcc}),[newPathElements[0]]))):Replacing.set(comp,[])}))}))])]),components:[]}};!function(ResizeTypes){ResizeTypes[ResizeTypes.None=0]="None",ResizeTypes[ResizeTypes.Both=1]="Both",ResizeTypes[ResizeTypes.Vertical=2]="Vertical"}(ResizeTypes||(ResizeTypes={}));var resize=function(editor,deltas,resizeType){var container=SugarElement.fromDom(editor.getContainer()),dimensions=function(editor,deltas,resizeType,originalHeight,originalWidth){var dimensions={};return dimensions.height=calcCappedSize(originalHeight+deltas.top,getMinHeightSetting(editor),getMaxHeightSetting(editor)),resizeType===ResizeTypes.Both&&(dimensions.width=calcCappedSize(originalWidth+deltas.left,getMinWidthSetting(editor),getMaxWidthSetting(editor))),dimensions}(editor,deltas,resizeType,get$b(container),get$a(container));each(dimensions,(function(val,dim){return set$7(container,dim,numToPx(val))})),function(editor){editor.fire("ResizeEditor")}(editor)},keyboardHandler=function(editor,resizeType,x,y){var delta=SugarPosition(20*x,20*y);return resize(editor,delta,resizeType),Optional.some(!0)},renderResizeHandler=function(editor,providersBackstage){var resizeType=function(editor){var fallback=!editor.hasPlugin("autoresize"),resize=editor.getParam("resize",fallback);return!1===resize?ResizeTypes.None:"both"===resize?ResizeTypes.Both:ResizeTypes.Vertical}(editor);return resizeType===ResizeTypes.None?Optional.none():Optional.some(render$3("resize-handle",{tag:"div",classes:["tox-statusbar__resize-handle"],attributes:{title:providersBackstage.translate("Resize")},behaviours:[Dragging.config({mode:"mouse",repositionTarget:!1,onDrag:function(_comp,_target,delta){return resize(editor,delta,resizeType)},blockerClass:"tox-blocker"}),Keying.config({mode:"special",onLeft:function(){return keyboardHandler(editor,resizeType,-1,0)},onRight:function(){return keyboardHandler(editor,resizeType,1,0)},onUp:function(){return keyboardHandler(editor,resizeType,0,-1)},onDown:function(){return keyboardHandler(editor,resizeType,0,1)}}),Tabstopping.config({}),Focusing.config({})]},providersBackstage.icons))},renderStatusbar=function(editor,providersBackstage){var getTextComponents=function(){var label,components=[];return editor.getParam("elementpath",!0,"boolean")&&components.push(renderElementPath(editor,{},providersBackstage)),editor.hasPlugin("wordcount")&&components.push(function(editor,providersBackstage){var _a,replaceCountText=function(comp,count,mode){return Replacing.set(comp,[text(providersBackstage.translate(["{0} "+mode,count[mode]]))])};return Button.sketch({dom:{tag:"button",classes:["tox-statusbar__wordcount"]},components:[],buttonBehaviours:derive$1([DisablingConfigs_button(providersBackstage.isDisabled),receivingConfig(),Tabstopping.config({}),Replacing.config({}),Representing.config({store:{mode:"memory",initialValue:{mode:"words",count:{words:0,characters:0}}}}),config("wordcount-events",[runOnExecute$1((function(comp){var currentVal=Representing.getValue(comp),newMode="words"===currentVal.mode?"characters":"words";Representing.setValue(comp,{mode:newMode,count:currentVal.count}),replaceCountText(comp,currentVal.count,newMode)})),runOnAttached((function(comp){editor.on("wordCountUpdate",(function(e){var mode=Representing.getValue(comp).mode;Representing.setValue(comp,{mode:mode,count:e.wordCount}),replaceCountText(comp,e.wordCount,mode)}))}))])]),eventOrder:(_a={},_a[execute$5()]=["disabling","alloy.base.behaviour","wordcount-events"],_a)})}(editor,providersBackstage)),editor.getParam("branding",!0,"boolean")&&components.push({dom:{tag:"span",classes:["tox-statusbar__branding"],innerHtml:'<a href="https://www.tiny.cloud/?utm_campaign=editor_referral&amp;utm_medium=poweredby&amp;utm_source=tinymce&amp;utm_content=v5" rel="noopener" target="_blank" tabindex="-1" aria-label="'+(label=global$e.translate(["Powered by {0}","Tiny"]))+'">'+label+"</a>"}}),components.length>0?[{dom:{tag:"div",classes:["tox-statusbar__text-container"]},components:components}]:[]};return{dom:{tag:"div",classes:["tox-statusbar"]},components:function(){var components=getTextComponents(),resizeHandler=renderResizeHandler(editor,providersBackstage);return components.concat(resizeHandler.toArray())}()}},setup$3=function(editor){var _a,isGridUiContainer,sinkSpec,reactiveWidthSpec,isInline=editor.inline,mode=isInline?Inline:Iframe,header=isStickyToolbar(editor)?StickyHeader:StaticHeader,lazyOuterContainer=Optional.none(),platform=detect$1(),platformClasses=platform.browser.isIE()?["tox-platform-ie"]:[],deviceClasses=platform.deviceType.isTouch()?["tox-platform-touch"]:[],isToolbarBottom=isToolbarLocationBottom(editor),uiContainer=getUiContainer(editor),dirAttributes=global$e.isRtl()?{attributes:{dir:"rtl"}}:{},verticalDirAttributes={attributes:(_a={},_a[Attribute]=isToolbarBottom?AttributeValue.BottomToTop:AttributeValue.TopToBottom,_a)},lazyHeader=function(){return lazyOuterContainer.bind(OuterContainer.getHeader)},resizeUiMothership=function(){set$7(uiMothership.element,"width",document.body.clientWidth+"px")},sink=build$1((isGridUiContainer=eq(body(),uiContainer)&&"grid"===get$c(uiContainer,"display"),sinkSpec={dom:__assign({tag:"div",classes:["tox","tox-silver-sink","tox-tinymce-aux"].concat(platformClasses).concat(deviceClasses)},dirAttributes),behaviours:derive$1([Positioning.config({useFixed:function(){return header.isDocked(lazyHeader)}})])},reactiveWidthSpec={dom:{styles:{width:document.body.clientWidth+"px"}},events:derive$2([run$1(windowResize(),resizeUiMothership)])},deepMerge(sinkSpec,isGridUiContainer?reactiveWidthSpec:{}))),lazySink=function(){return Result.value(sink)},memAnchorBar=record({dom:{tag:"div",classes:["tox-anchorbar"]}}),lazyThrobber=function(){return lazyOuterContainer.bind((function(container){return OuterContainer.getThrobber(container)})).getOrDie("Could not find throbber element")},backstage=init$7(sink,editor,(function(){return lazyOuterContainer.bind((function(container){return memAnchorBar.getOpt(container)})).getOrDie("Could not find a anchor bar element")})),partMenubar=OuterContainer.parts.menubar({dom:{tag:"div",classes:["tox-menubar"]},backstage:backstage,onEscape:function(){editor.focus()}}),toolbarMode=getToolbarMode(editor),partToolbar=OuterContainer.parts.toolbar(__assign({dom:{tag:"div",classes:["tox-toolbar"]},getSink:lazySink,providers:backstage.shared.providers,onEscape:function(){editor.focus()},type:toolbarMode,lazyToolbar:function(){return lazyOuterContainer.bind((function(container){return OuterContainer.getToolbar(container)})).getOrDie("Could not find more toolbar element")},lazyHeader:function(){return lazyHeader().getOrDie("Could not find header element")}},verticalDirAttributes)),partMultipleToolbar=OuterContainer.parts["multiple-toolbar"]({dom:{tag:"div",classes:["tox-toolbar-overlord"]},providers:backstage.shared.providers,onEscape:function(){editor.focus()},type:toolbarMode}),partSocket=OuterContainer.parts.socket({dom:{tag:"div",classes:["tox-edit-area"]}}),partSidebar=OuterContainer.parts.sidebar({dom:{tag:"div",classes:["tox-sidebar"]}}),partThrobber=OuterContainer.parts.throbber({dom:{tag:"div",classes:["tox-throbber"]},backstage:backstage}),statusbar=editor.getParam("statusbar",!0,"boolean")&&!isInline?Optional.some(renderStatusbar(editor,backstage.shared.providers)):Optional.none(),socketSidebarContainer={dom:{tag:"div",classes:["tox-sidebar-wrap"]},components:[partSocket,partSidebar]},hasMultipleToolbar=isMultipleToolbars(editor),hasToolbar=isToolbarEnabled(editor),hasMenubar=isMenubarEnabled(editor),partHeader=OuterContainer.parts.header({dom:__assign({tag:"div",classes:["tox-editor-header"]},verticalDirAttributes),components:flatten([hasMenubar?[partMenubar]:[],hasMultipleToolbar?[partMultipleToolbar]:hasToolbar?[partToolbar]:[],useFixedContainer(editor)?[]:[memAnchorBar.asSpec()]]),sticky:isStickyToolbar(editor),editor:editor,sharedBackstage:backstage.shared}),editorComponents=flatten([isToolbarBottom?[]:[partHeader],isInline?[]:[socketSidebarContainer],isToolbarBottom?[partHeader]:[]]),containerComponents=flatten([[{dom:{tag:"div",classes:["tox-editor-container"]},components:editorComponents}],isInline?[]:statusbar.toArray(),[partThrobber]]),isHidden=isDistractionFree(editor),attributes=__assign(__assign({role:"application"},global$e.isRtl()?{dir:"rtl"}:{}),isHidden?{"aria-hidden":"true"}:{}),outerContainer=build$1(OuterContainer.sketch({dom:{tag:"div",classes:["tox","tox-tinymce"].concat(isInline?["tox-tinymce-inline"]:[]).concat(isToolbarBottom?["tox-tinymce--toolbar-bottom"]:[]).concat(deviceClasses).concat(platformClasses),styles:__assign({visibility:"hidden"},isHidden?{opacity:"0",border:"0"}:{}),attributes:attributes},components:containerComponents,behaviours:derive$1([receivingConfig(),Disabling.config({disableClass:"tox-tinymce--disabled"}),Keying.config({mode:"cyclic",selector:".tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a, .tox-statusbar__resize-handle"})])}));lazyOuterContainer=Optional.some(outerContainer),editor.shortcuts.add("alt+F9","focus menubar",(function(){OuterContainer.focusMenubar(outerContainer)})),editor.shortcuts.add("alt+F10","focus toolbar",(function(){OuterContainer.focusToolbar(outerContainer)})),editor.addCommand("ToggleToolbarDrawer",(function(){OuterContainer.toggleToolbarDrawer(outerContainer)})),editor.addQueryStateHandler("ToggleToolbarDrawer",(function(){return OuterContainer.isToolbarDrawerToggled(outerContainer)}));var mothership=takeover(outerContainer),uiMothership=takeover(sink);!function(editor,mothership,uiMothership){var broadcastEvent=function(name,evt){each$1([mothership,uiMothership],(function(ship){ship.broadcastEvent(name,evt)}))},broadcastOn=function(channel,message){each$1([mothership,uiMothership],(function(ship){ship.broadcastOn([channel],message)}))},fireDismissPopups=function(evt){return broadcastOn(dismissPopups(),{target:evt.target})},doc=getDocument(),onTouchstart=bind(doc,"touchstart",fireDismissPopups),onTouchmove=bind(doc,"touchmove",(function(evt){return broadcastEvent(documentTouchmove(),evt)})),onTouchend=bind(doc,"touchend",(function(evt){return broadcastEvent(documentTouchend(),evt)})),onMousedown=bind(doc,"mousedown",fireDismissPopups),onMouseup=bind(doc,"mouseup",(function(evt){0===evt.raw.button&&broadcastOn(mouseReleased(),{target:evt.target})})),onContentClick=function(raw){return broadcastOn(dismissPopups(),{target:SugarElement.fromDom(raw.target)})},onContentMouseup=function(raw){0===raw.button&&broadcastOn(mouseReleased(),{target:SugarElement.fromDom(raw.target)})},onContentMousedown=function(){each$1(editor.editorManager.get(),(function(loopEditor){editor!==loopEditor&&loopEditor.fire("DismissPopups",{relatedTarget:editor})}))},onWindowScroll=function(evt){return broadcastEvent(windowScroll(),fromRawEvent(evt))},onWindowResize=function(evt){broadcastOn(repositionPopups(),{}),broadcastEvent(windowResize(),fromRawEvent(evt))},onEditorResize=function(){return broadcastOn(repositionPopups(),{})},onEditorProgress=function(evt){evt.state&&broadcastOn(dismissPopups(),{target:SugarElement.fromDom(editor.getContainer())})},onDismissPopups=function(event){broadcastOn(dismissPopups(),{target:SugarElement.fromDom(event.relatedTarget.getContainer())})};editor.on("PostRender",(function(){editor.on("click",onContentClick),editor.on("tap",onContentClick),editor.on("mouseup",onContentMouseup),editor.on("mousedown",onContentMousedown),editor.on("ScrollWindow",onWindowScroll),editor.on("ResizeWindow",onWindowResize),editor.on("ResizeEditor",onEditorResize),editor.on("AfterProgressState",onEditorProgress),editor.on("DismissPopups",onDismissPopups)})),editor.on("remove",(function(){editor.off("click",onContentClick),editor.off("tap",onContentClick),editor.off("mouseup",onContentMouseup),editor.off("mousedown",onContentMousedown),editor.off("ScrollWindow",onWindowScroll),editor.off("ResizeWindow",onWindowResize),editor.off("ResizeEditor",onEditorResize),editor.off("AfterProgressState",onEditorProgress),editor.off("DismissPopups",onDismissPopups),onMousedown.unbind(),onTouchstart.unbind(),onTouchmove.unbind(),onTouchend.unbind(),onMouseup.unbind()})),editor.on("detach",(function(){detachSystem(mothership),detachSystem(uiMothership),mothership.destroy(),uiMothership.destroy()}))}(editor,mothership,uiMothership);var setEditorSize=function(){var parsedHeight=numToPx(getHeightWithFallback(editor)),parsedWidth=numToPx(function(editor){return getWidth(editor).getOr(getWidthSetting(editor))}(editor));return editor.inline||(isValidValue("div","width",parsedWidth)&&set$7(outerContainer.element,"width",parsedWidth),isValidValue("div","height",parsedHeight)?set$7(outerContainer.element,"height",parsedHeight):set$7(outerContainer.element,"height","200px")),parsedHeight};return{mothership:mothership,uiMothership:uiMothership,backstage:backstage,renderUI:function(){header.setup(editor,backstage.shared,lazyHeader),setup$6(editor,backstage),setup$5(editor,lazySink,backstage),function(editor){var sidebars=editor.ui.registry.getAll().sidebars;each$1(keys(sidebars),(function(name){var spec=sidebars[name],isActive=function(){return is$1(Optional.from(editor.queryCommandValue("ToggleSidebar")),name)};editor.ui.registry.addToggleButton(name,{icon:spec.icon,tooltip:spec.tooltip,onAction:function(buttonApi){editor.execCommand("ToggleSidebar",!1,name),buttonApi.setActive(isActive())},onSetup:function(buttonApi){var handleToggle=function(){return buttonApi.setActive(isActive())};return editor.on("ToggleSidebar",handleToggle),function(){editor.off("ToggleSidebar",handleToggle)}}})}))}(editor),setup$7(editor,lazyThrobber,backstage.shared),map$1(function(editor){return editor.getParam("toolbar_groups",{},"object")}(editor),(function(toolbarGroupButtonConfig,name){editor.ui.registry.addGroupToolbarButton(name,toolbarGroupButtonConfig)}));var _a=editor.ui.registry.getAll(),buttons=_a.buttons,menuItems=_a.menuItems,contextToolbars=_a.contextToolbars,sidebars=_a.sidebars,toolbarOpt=getMultipleToolbarsSetting(editor),rawUiConfig={menuItems:menuItems,menus:getMenus(editor),menubar:getMenubar(editor),toolbar:toolbarOpt.getOrThunk((function(){return function(editor){return editor.getParam("toolbar",!0)}(editor)})),allowToolbarGroups:toolbarMode===ToolbarMode.floating,buttons:buttons,sidebar:sidebars};register$7(editor,contextToolbars,sink,{backstage:backstage}),setup$4(editor,sink);var elm=editor.getElement(),height=setEditorSize(),uiComponents={mothership:mothership,uiMothership:uiMothership,outerContainer:outerContainer},args={targetNode:elm,height:height};return mode.render(editor,uiComponents,rawUiConfig,backstage,args)},getUi:function(){return{channels:{broadcastAll:uiMothership.broadcast,broadcastOn:uiMothership.broadcastOn,register:noop}}}}},schema$2=constant$1([required$1("lazySink"),option("dragBlockClass"),defaultedFunction("getBounds",win),defaulted("useTabstopAt",always),defaulted("eventOrder",{}),field("modalBehaviours",[Keying]),onKeyboardHandler("onExecute"),onStrictKeyboardHandler("onEscape")]),basic={sketch:identity$1},parts$2=constant$1([optional({name:"draghandle",overrides:function(detail,spec){return{behaviours:derive$1([Dragging.config({mode:"mouse",getTarget:function(handle){return ancestor(handle,'[role="dialog"]').getOr(handle)},blockerClass:detail.dragBlockClass.getOrDie(new Error("The drag blocker class was not specified for a dialog with a drag handle: \n"+JSON.stringify(spec,null,2)).message),getBounds:detail.getDragBounds})])}}}),required({schema:[required$1("dom")],name:"title"}),required({factory:basic,schema:[required$1("dom")],name:"close"}),required({factory:basic,schema:[required$1("dom")],name:"body"}),optional({factory:basic,schema:[required$1("dom")],name:"footer"}),external$1({factory:{sketch:function(spec,detail){return __assign(__assign({},spec),{dom:detail.dom,components:detail.components})}},schema:[defaulted("dom",{tag:"div",styles:{position:"fixed",left:"0px",top:"0px",right:"0px",bottom:"0px"}}),defaulted("components",[])],name:"blocker"})]),ModalDialog=composite({name:"ModalDialog",configFields:schema$2(),partFields:parts$2(),factory:function(detail,components,spec,externals){var _a,dialogComp=value$1(),modalEventsId=generate$6("modal-events"),eventOrder=__assign(__assign({},detail.eventOrder),((_a={})[attachedToDom()]=[modalEventsId].concat(detail.eventOrder["alloy.system.attached"]||[]),_a));return{uid:detail.uid,dom:detail.dom,components:components,apis:{show:function(dialog){dialogComp.set(dialog);var sink=detail.lazySink(dialog).getOrDie(),externalBlocker=externals.blocker(),blocker=sink.getSystem().build(__assign(__assign({},externalBlocker),{components:externalBlocker.components.concat([premade(dialog)]),behaviours:derive$1([Focusing.config({}),config("dialog-blocker-events",[runOnSource(focusin(),(function(){Keying.focusIn(dialog)}))])])}));attach(sink,blocker),Keying.focusIn(dialog)},hide:function(dialog){dialogComp.clear(),parent(dialog.element).each((function(blockerDom){dialog.getSystem().getByDom(blockerDom).each((function(blocker){detach(blocker)}))}))},getBody:function(dialog){return getPartOrDie(dialog,detail,"body")},getFooter:function(dialog){return getPartOrDie(dialog,detail,"footer")},setIdle:function(dialog){Blocking.unblock(dialog)},setBusy:function(dialog,getBusySpec){Blocking.block(dialog,getBusySpec)}},eventOrder:eventOrder,domModification:{attributes:{role:"dialog","aria-modal":"true"}},behaviours:augment(detail.modalBehaviours,[Replacing.config({}),Keying.config({mode:"cyclic",onEnter:detail.onExecute,onEscape:detail.onEscape,useTabstopAt:detail.useTabstopAt}),Blocking.config({getRoot:dialogComp.get}),config(modalEventsId,[runOnAttached((function(c){var labelledElement,labelElement,labelId,describedElement,describeElement,describeId;labelledElement=c.element,labelElement=getPartOrDie(c,detail,"title").element,labelId=getOpt(labelledElement,"id").fold((function(){var id=generate$6("dialog-label");return set$8(labelElement,"id",id),id}),identity$1),set$8(labelledElement,"aria-labelledby",labelId),describedElement=c.element,describeElement=getPartOrDie(c,detail,"body").element,describeId=Optional.from(get$d(describedElement,"id")).fold((function(){var id=generate$6("dialog-describe");return set$8(describeElement,"id",id),id}),identity$1),set$8(describedElement,"aria-describedby",describeId)}))])])}},apis:{show:function(apis,dialog){apis.show(dialog)},hide:function(apis,dialog){apis.hide(dialog)},getBody:function(apis,dialog){return apis.getBody(dialog)},getFooter:function(apis,dialog){return apis.getFooter(dialog)},setBusy:function(apis,dialog,getBusySpec){apis.setBusy(dialog,getBusySpec)},setIdle:function(apis,dialog){apis.setIdle(dialog)}}}),dialogToggleMenuItemSchema=objOf([requiredString("type"),requiredString("name")].concat(commonMenuItemFields)),dialogToggleMenuItemDataProcessor=boolean,baseFooterButtonFields=[field$1("name","name",defaultedThunk((function(){return generate$6("button-name")})),string),optionString("icon"),defaultedStringEnum("align","end",["start","end"]),defaultedBoolean("primary",!1),defaultedBoolean("disabled",!1)],dialogFooterButtonFields=__spreadArray(__spreadArray([],baseFooterButtonFields,!0),[requiredString("text")],!1),normalFooterButtonFields=__spreadArray([requiredStringEnum("type",["submit","cancel","custom"])],dialogFooterButtonFields,!0),menuFooterButtonFields=__spreadArray([requiredStringEnum("type",["menu"]),optionString("text"),optionString("tooltip"),optionString("icon"),requiredArrayOf("items",dialogToggleMenuItemSchema)],baseFooterButtonFields,!0),dialogFooterButtonSchema=choose$1("type",{submit:normalFooterButtonFields,cancel:normalFooterButtonFields,custom:normalFooterButtonFields,menu:menuFooterButtonFields}),alertBannerFields=[requiredString("type"),requiredString("text"),requiredStringEnum("level",["info","warn","error","success"]),requiredString("icon"),defaulted("url","")],alertBannerSchema=objOf(alertBannerFields),buttonFields=[requiredString("type"),requiredString("text"),defaultedBoolean("disabled",!1),defaultedBoolean("primary",!1),field$1("name","name",defaultedThunk((function(){return generate$6("button-name")})),string),optionString("icon"),defaultedBoolean("borderless",!1)],buttonSchema=objOf(buttonFields),checkboxFields=[requiredString("type"),requiredString("name"),requiredString("label"),defaultedBoolean("disabled",!1)],checkboxSchema=objOf(checkboxFields),checkboxDataProcessor=boolean,formComponentFields=[requiredString("type"),requiredString("name")],formComponentWithLabelFields=formComponentFields.concat([optionString("label")]),collectionFields=formComponentWithLabelFields.concat([defaulted("columns","auto")]),collectionSchema=objOf(collectionFields),collectionDataProcessor=arrOfObj([requiredString("value"),requiredString("text"),requiredString("icon")]),colorInputSchema=objOf(formComponentWithLabelFields),colorInputDataProcessor=string,colorPickerSchema=objOf(formComponentWithLabelFields),colorPickerDataProcessor=string,customEditorFields=formComponentFields.concat([defaultedString("tag","textarea"),requiredString("scriptId"),requiredString("scriptUrl"),function(key,fallback){return defaultedOf(key,fallback,postMessageable)}("settings",void 0)]),customEditorFieldsOld=formComponentFields.concat([defaultedString("tag","textarea"),requiredFunction("init")]),customEditorSchema=valueOf((function(v){return asRaw("customeditor.old",objOfOnly(customEditorFieldsOld),v).orThunk((function(){return asRaw("customeditor.new",objOfOnly(customEditorFields),v)}))})),customEditorDataProcessor=string,dropZoneSchema=objOf(formComponentWithLabelFields),dropZoneDataProcessor=arrOf(anyValue$1),createGridFields=function(itemsField){return[requiredString("type"),requiredNumber("columns"),itemsField]},htmlPanelFields=[requiredString("type"),requiredString("html"),defaultedStringEnum("presets","presentation",["presentation","document"])],htmlPanelSchema=objOf(htmlPanelFields),iframeFields=formComponentWithLabelFields.concat([defaultedBoolean("sandboxed",!0)]),iframeSchema=objOf(iframeFields),iframeDataProcessor=string,imageToolsFields=formComponentWithLabelFields.concat([requiredOf("currentState",objOf([required$1("blob"),requiredString("url")]))]),imageToolsSchema=objOf(imageToolsFields),inputFields=formComponentWithLabelFields.concat([optionString("inputMode"),optionString("placeholder"),defaultedBoolean("maximized",!1),defaultedBoolean("disabled",!1)]),inputSchema=objOf(inputFields),inputDataProcessor=string,createLabelFields=function(itemsField){return[requiredString("type"),requiredString("label"),itemsField]},listBoxSingleItemFields=[requiredString("text"),requiredString("value")],listBoxNestedItemFields=[requiredString("text"),requiredArrayOf("items",function(desc,schema){return getP=cached(schema),{extract:function(path,val){return getP().extract(path,val)},toString:function(){return getP().toString()}};var getP}(0,(function(){return listBoxItemSchema})))],listBoxItemSchema=oneOf([objOf(listBoxSingleItemFields),objOf(listBoxNestedItemFields)]),listBoxFields=formComponentWithLabelFields.concat([requiredArrayOf("items",listBoxItemSchema),defaultedBoolean("disabled",!1)]),listBoxSchema=objOf(listBoxFields),listBoxDataProcessor=string,selectBoxFields=formComponentWithLabelFields.concat([requiredArrayOfObj("items",[requiredString("text"),requiredString("value")]),defaultedNumber("size",1),defaultedBoolean("disabled",!1)]),selectBoxSchema=objOf(selectBoxFields),selectBoxDataProcessor=string,sizeInputFields=formComponentWithLabelFields.concat([defaultedBoolean("constrain",!0),defaultedBoolean("disabled",!1)]),sizeInputSchema=objOf(sizeInputFields),sizeInputDataProcessor=objOf([requiredString("width"),requiredString("height")]),tableFields=[requiredString("type"),requiredArrayOf("header",string),requiredArrayOf("cells",arrOf(string))],tableSchema=objOf(tableFields),textAreaFields=formComponentWithLabelFields.concat([optionString("placeholder"),defaultedBoolean("maximized",!1),defaultedBoolean("disabled",!1)]),textAreaSchema=objOf(textAreaFields),textAreaDataProcessor=string,urlInputFields=formComponentWithLabelFields.concat([defaultedStringEnum("filetype","file",["image","media","file"]),defaulted("disabled",!1)]),urlInputSchema=objOf(urlInputFields),urlInputDataProcessor=objOf([requiredString("value"),defaulted("meta",{})]),createItemsField=function(name){return field$1("items","items",{tag:"required",process:{}},arrOf(valueOf((function(v){return asRaw("Checking item of "+name,itemSchema,v).fold((function(sErr){return Result.error(formatError(sErr))}),(function(passValue){return Result.value(passValue)}))}))))},itemSchema=valueThunk((function(){return choose$2("type",{alertbanner:alertBannerSchema,bar:objOf((itemsField=createItemsField("bar"),[requiredString("type"),itemsField])),button:buttonSchema,checkbox:checkboxSchema,colorinput:colorInputSchema,colorpicker:colorPickerSchema,dropzone:dropZoneSchema,grid:objOf(createGridFields(createItemsField("grid"))),iframe:iframeSchema,input:inputSchema,listbox:listBoxSchema,selectbox:selectBoxSchema,sizeinput:sizeInputSchema,textarea:textAreaSchema,urlinput:urlInputSchema,customeditor:customEditorSchema,htmlpanel:htmlPanelSchema,imagetools:imageToolsSchema,collection:collectionSchema,label:objOf(createLabelFields(createItemsField("label"))),table:tableSchema,panel:panelSchema});var itemsField})),panelFields=[requiredString("type"),defaulted("classes",[]),requiredArrayOf("items",itemSchema)],panelSchema=objOf(panelFields),tabFields=[field$1("name","name",defaultedThunk((function(){return generate$6("tab-name")})),string),requiredString("title"),requiredArrayOf("items",itemSchema)],tabPanelFields=[requiredString("type"),requiredArrayOfObj("tabs",tabFields)],tabPanelSchema=objOf(tabPanelFields),dialogButtonFields=dialogFooterButtonFields,dialogButtonSchema=dialogFooterButtonSchema,dialogSchema=objOf([requiredString("title"),requiredOf("body",choose$2("type",{panel:panelSchema,tabpanel:tabPanelSchema})),defaultedString("size","normal"),requiredArrayOf("buttons",dialogButtonSchema),defaulted("initialData",{}),defaultedFunction("onAction",noop),defaultedFunction("onChange",noop),defaultedFunction("onSubmit",noop),defaultedFunction("onClose",noop),defaultedFunction("onCancel",noop),defaulted("onTabChange",noop)]),urlDialogButtonSchema=objOf(__spreadArray([requiredStringEnum("type",["cancel","custom"])],dialogButtonFields,!0)),urlDialogSchema=objOf([requiredString("title"),requiredString("url"),optionNumber("height"),optionNumber("width"),optionArrayOf("buttons",urlDialogButtonSchema),defaultedFunction("onAction",noop),defaultedFunction("onCancel",noop),defaultedFunction("onClose",noop),defaultedFunction("onMessage",noop)]),getAllObjects=function(obj){return isObject(obj)?[obj].concat(bind$3(values(obj),getAllObjects)):isArray(obj)?bind$3(obj,getAllObjects):[]},isNamedItem=function(obj){return isString(obj.type)&&isString(obj.name)},dataProcessors={checkbox:checkboxDataProcessor,colorinput:colorInputDataProcessor,colorpicker:colorPickerDataProcessor,dropzone:dropZoneDataProcessor,input:inputDataProcessor,iframe:iframeDataProcessor,sizeinput:sizeInputDataProcessor,selectbox:selectBoxDataProcessor,listbox:listBoxDataProcessor,size:sizeInputDataProcessor,textarea:textAreaDataProcessor,urlinput:urlInputDataProcessor,customeditor:customEditorDataProcessor,collection:collectionDataProcessor,togglemenuitem:dialogToggleMenuItemDataProcessor},createDataValidator=function(structure){var namedItems=function(structure){return filter$2(getAllObjects(structure),isNamedItem)}(structure),fields=bind$3(namedItems,(function(item){return function(item){return Optional.from(dataProcessors[item.type])}(item).fold((function(){return[]}),(function(schema){return[requiredOf(item.name,schema)]}))}));return objOf(fields)},extract=function(structure){return{internalDialog:getOrDie(asRaw("dialog",dialogSchema,structure)),dataValidator:createDataValidator(structure),initialData:structure.initialData}},DialogManager={open:function(factory,structure){var extraction=extract(structure);return factory(extraction.internalDialog,extraction.initialData,extraction.dataValidator)},openUrl:function(factory,structure){return factory(getOrDie(asRaw("dialog",urlDialogSchema,structure)))},redial:function(structure){return extract(structure)}},toValidValues=function(values){var errors=[],result={};return each(values,(function(value,name){value.fold((function(){errors.push(name)}),(function(v){result[name]=v}))})),errors.length>0?Result.error(errors):Result.value(result)},renderBodyPanel=function(spec,backstage){var memForm=record(Form.sketch((function(parts){return{dom:{tag:"div",classes:["tox-form"].concat(spec.classes)},components:map$2(spec.items,(function(item){return interpretInForm(parts,item,backstage)}))}})));return{dom:{tag:"div",classes:["tox-dialog__body"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-content"]},components:[memForm.asSpec()]}],behaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)}),ComposingConfigs_memento(memForm),RepresentingConfigs_memento(memForm,{postprocess:function(formValue){return toValidValues(formValue).fold((function(err){return console.error(err),{}}),identity$1)}})])}},TabButton=single({name:"TabButton",configFields:[defaulted("uid",void 0),required$1("value"),field$1("dom","dom",mergeWithThunk((function(){return{attributes:{role:"tab",id:generate$6("aria"),"aria-selected":"false"}}})),anyValue()),option("action"),defaulted("domModification",{}),field("tabButtonBehaviours",[Focusing,Keying,Representing]),required$1("view")],factory:function(detail,_spec){return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events$a(detail.action),behaviours:augment(detail.tabButtonBehaviours,[Focusing.config({}),Keying.config({mode:"execution",useSpace:!0,useEnter:!0}),Representing.config({store:{mode:"memory",initialValue:detail.value}})]),domModification:detail.domModification}}}),schema$1=constant$1([required$1("tabs"),required$1("dom"),defaulted("clickToDismiss",!1),field("tabbarBehaviours",[Highlighting,Keying]),markers$1(["tabClass","selectedClass"])]),tabsPart=group({factory:TabButton,name:"tabs",unit:"tab",overrides:function(barDetail){var dismissTab$1=function(tabbar,button){Highlighting.dehighlight(tabbar,button),emitWith(tabbar,dismissTab(),{tabbar:tabbar,button:button})},changeTab$1=function(tabbar,button){Highlighting.highlight(tabbar,button),emitWith(tabbar,changeTab(),{tabbar:tabbar,button:button})};return{action:function(button){var tabbar=button.getSystem().getByUid(barDetail.uid).getOrDie(),activeButton=Highlighting.isHighlighted(tabbar,button);(activeButton&&barDetail.clickToDismiss?dismissTab$1:activeButton?noop:changeTab$1)(tabbar,button)},domModification:{classes:[barDetail.markers.tabClass]}}}}),parts$1=constant$1([tabsPart]),Tabbar=composite({name:"Tabbar",configFields:schema$1(),partFields:parts$1(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,"debug.sketcher":"Tabbar",domModification:{attributes:{role:"tablist"}},behaviours:augment(detail.tabbarBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedClass,itemClass:detail.markers.tabClass,onHighlight:function(tabbar,tab){set$8(tab.element,"aria-selected","true")},onDehighlight:function(tabbar,tab){set$8(tab.element,"aria-selected","false")}}),Keying.config({mode:"flow",getInitial:function(tabbar){return Highlighting.getHighlighted(tabbar).map((function(tab){return tab.element}))},selector:"."+detail.markers.tabClass,executeOnMove:!0})])}}}),Tabview=single({name:"Tabview",configFields:[field("tabviewBehaviours",[Replacing])],factory:function(detail,_spec){return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.tabviewBehaviours,[Replacing.config({})]),domModification:{attributes:{role:"tabpanel"}}}}}),schema=constant$1([defaulted("selectFirst",!0),onHandler("onChangeTab"),onHandler("onDismissTab"),defaulted("tabs",[]),field("tabSectionBehaviours",[])]),barPart=required({factory:Tabbar,schema:[required$1("dom"),requiredObjOf("markers",[required$1("tabClass"),required$1("selectedClass")])],name:"tabbar",defaults:function(detail){return{tabs:detail.tabs}}}),viewPart=required({factory:Tabview,name:"tabview"}),parts=constant$1([barPart,viewPart]),TabSection=composite({name:"TabSection",configFields:schema(),partFields:parts(),factory:function(detail,components,_spec,_externals){var changeTabBy=function(section,byPred){getPart(section,detail,"tabbar").each((function(tabbar){byPred(tabbar).each(emitExecute)}))};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.tabSectionBehaviours),events:derive$2(flatten([detail.selectFirst?[runOnAttached((function(section,_simulatedEvent){changeTabBy(section,Highlighting.getFirst)}))]:[],[run$1(changeTab(),(function(section,simulatedEvent){!function(button){var tabValue=Representing.getValue(button);getPart(button,detail,"tabview").each((function(tabview){find$5(detail.tabs,(function(t){return t.value===tabValue})).each((function(tabData){var panel=tabData.view();getOpt(button.element,"id").each((function(id){set$8(tabview.element,"aria-labelledby",id)})),Replacing.set(tabview,panel),detail.onChangeTab(tabview,button,panel)}))}))}(simulatedEvent.event.button)})),run$1(dismissTab(),(function(section,simulatedEvent){var button=simulatedEvent.event.button;detail.onDismissTab(section,button)}))]])),apis:{getViewItems:function(section){return getPart(section,detail,"tabview").map((function(tabview){return Replacing.contents(tabview)})).getOr([])},showTab:function(section,tabKey){changeTabBy(section,(function(tabbar){var candidates=Highlighting.getCandidates(tabbar);return find$5(candidates,(function(c){return Representing.getValue(c)===tabKey})).filter((function(tab){return!Highlighting.isHighlighted(tabbar,tab)}))}))}}}},apis:{getViewItems:function(apis,component){return apis.getViewItems(component)},showTab:function(apis,component,tabKey){apis.showTab(component,tabKey)}}}),setTabviewHeight=function(tabview,height){set$7(tabview,"height",height+"px"),detect$1().browser.isIE()?remove$6(tabview,"flex-basis"):set$7(tabview,"flex-basis",height+"px")},updateTabviewHeight=function(dialogBody,tabview,maxTabHeight){ancestor(dialogBody,'[role="dialog"]').each((function(dialog){descendant(dialog,'[role="tablist"]').each((function(tablist){maxTabHeight.get().map((function(height){return set$7(tabview,"height","0"),set$7(tabview,"flex-basis","0"),Math.min(height,function(dialog,tabview,tablist){var maxHeight,documentElement$1=documentElement(dialog).dom,rootElm=ancestor(dialog,".tox-dialog-wrap").getOr(dialog);maxHeight="fixed"===get$c(rootElm,"position")?Math.max(documentElement$1.clientHeight,window.innerHeight):Math.max(documentElement$1.offsetHeight,documentElement$1.scrollHeight);var tabviewHeight=get$b(tabview),currentTabHeight=tabview.dom.offsetLeft>=tablist.dom.offsetLeft+get$a(tablist)?Math.max(get$b(tablist),tabviewHeight):tabviewHeight,dialogTopMargin=parseInt(get$c(dialog,"margin-top"),10)||0,dialogBottomMargin=parseInt(get$c(dialog,"margin-bottom"),10)||0;return maxHeight-(get$b(dialog)+dialogTopMargin+dialogBottomMargin-currentTabHeight)}(dialog,tabview,tablist))})).each((function(height){setTabviewHeight(tabview,height)}))}))}))},getTabview=function(dialog){return descendant(dialog,'[role="tabpanel"]')},setMode=function(allTabs){var maxTabHeight;return{smartTabHeight:(maxTabHeight=value$1(),{extraEvents:[runOnAttached((function(comp){var dialog=comp.element;getTabview(dialog).each((function(tabview){set$7(tabview,"visibility","hidden"),comp.getSystem().getByDom(tabview).toOptional().each((function(tabviewComp){(function(heights){return head(sort(heights,(function(a,b){return a>b?-1:a<b?1:0})))})(function(allTabs,tabview,tabviewComp){return map$2(allTabs,(function(_tab,i){Replacing.set(tabviewComp,allTabs[i].view());var rect=tabview.dom.getBoundingClientRect();return Replacing.set(tabviewComp,[]),rect.height}))}(allTabs,tabview,tabviewComp)).fold(maxTabHeight.clear,maxTabHeight.set)})),updateTabviewHeight(dialog,tabview,maxTabHeight),remove$6(tabview,"visibility"),function(allTabs,comp){head(allTabs).each((function(tab){return TabSection.showTab(comp,tab.value)}))}(allTabs,comp),global$f.requestAnimationFrame((function(){updateTabviewHeight(dialog,tabview,maxTabHeight)}))}))})),run$1(windowResize(),(function(comp){var dialog=comp.element;getTabview(dialog).each((function(tabview){updateTabviewHeight(dialog,tabview,maxTabHeight)}))})),run$1(formResizeEvent,(function(comp,_se){var dialog=comp.element;getTabview(dialog).each((function(tabview){var oldFocus=active(getRootNode(tabview));set$7(tabview,"visibility","hidden");var oldHeight=getRaw(tabview,"height").map((function(h){return parseInt(h,10)}));remove$6(tabview,"height"),remove$6(tabview,"flex-basis");var newHeight=tabview.dom.getBoundingClientRect().height;oldHeight.forall((function(h){return newHeight>h}))?(maxTabHeight.set(newHeight),updateTabviewHeight(dialog,tabview,maxTabHeight)):oldHeight.each((function(h){setTabviewHeight(tabview,h)})),remove$6(tabview,"visibility"),oldFocus.each(focus$3)}))}))],selectFirst:!1}),naiveTabHeight:{extraEvents:[],selectFirst:!0}}},renderTabPanel=function(spec,backstage){var storedValue=Cell({}),updateDataWithForm=function(form){var formData=Representing.getValue(form),validData=toValidValues(formData).getOr({}),currentData=storedValue.get(),newData=deepMerge(currentData,validData);storedValue.set(newData)},setDataOnForm=function(form){var tabData=storedValue.get();Representing.setValue(form,tabData)},oldTab=Cell(null),allTabs=map$2(spec.tabs,(function(tab){return{value:tab.name,dom:{tag:"div",classes:["tox-dialog__body-nav-item"],innerHtml:backstage.shared.providers.translate(tab.title)},view:function(){return[Form.sketch((function(parts){return{dom:{tag:"div",classes:["tox-form"]},components:map$2(tab.items,(function(item){return interpretInForm(parts,item,backstage)})),formBehaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)}),config("TabView.form.events",[runOnAttached(setDataOnForm),runOnDetached(updateDataWithForm)]),Receiving.config({channels:wrapAll([{key:"send-data-to-section",value:{onReceive:updateDataWithForm}},{key:"send-data-to-view",value:{onReceive:setDataOnForm}}])})])}}))]}}})),tabMode=setMode(allTabs).smartTabHeight;return TabSection.sketch({dom:{tag:"div",classes:["tox-dialog__body"]},onChangeTab:function(section,button,_viewItems){var name=Representing.getValue(button);emitWith(section,formTabChangeEvent,{name:name,oldName:oldTab.get()}),oldTab.set(name)},tabs:allTabs,components:[TabSection.parts.tabbar({dom:{tag:"div",classes:["tox-dialog__body-nav"]},components:[Tabbar.parts.tabs({})],markers:{tabClass:"tox-tab",selectedClass:"tox-dialog__body-nav-item--active"},tabbarBehaviours:derive$1([Tabstopping.config({})])}),TabSection.parts.tabview({dom:{tag:"div",classes:["tox-dialog__body-content"]}})],selectFirst:tabMode.selectFirst,tabSectionBehaviours:derive$1([config("tabpanel",tabMode.extraEvents),Keying.config({mode:"acyclic"}),Composing.config({find:function(comp){return head(TabSection.getViewItems(comp))}}),Representing.config({store:{mode:"manual",getValue:function(tsection){return tsection.getSystem().broadcastOn(["send-data-to-section"],{}),storedValue.get()},setValue:function(tsection,value){storedValue.set(value),tsection.getSystem().broadcastOn(["send-data-to-view"],{})}}})])})},dialogChannel=generate$6("update-dialog"),titleChannel=generate$6("update-title"),bodyChannel=generate$6("update-body"),footerChannel=generate$6("update-footer"),bodySendMessageChannel=generate$6("body-send-message"),renderBody=function(spec,id,backstage,ariaAttrs){return{dom:{tag:"div",classes:["tox-dialog__content-js"],attributes:__assign(__assign({},id.map((function(x){return{id:x}})).getOr({})),ariaAttrs?{"aria-live":"polite"}:{})},components:[],behaviours:derive$1([ComposingConfigs_childAt(0),Reflecting.config({channel:bodyChannel,updateState:function(_comp,incoming){return Optional.some({isTabPanel:function(){return"tabpanel"===incoming.body.type}})},renderComponents:function(incoming){switch(incoming.body.type){case"tabpanel":return[renderTabPanel(incoming.body,backstage)];default:return[renderBodyPanel(incoming.body,backstage)]}},initialData:spec})])}},isTouch=global$9.deviceType.isTouch(),hiddenHeader=function(title,close){return{dom:{tag:"div",styles:{display:"none"},classes:["tox-dialog__header"]},components:[title,close]}},pClose=function(onClose,providersBackstage){return ModalDialog.parts.close(Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--icon","tox-button--naked"],attributes:{type:"button","aria-label":providersBackstage.translate("Close")}},action:onClose,buttonBehaviours:derive$1([Tabstopping.config({})])}))},pUntitled=function(){return ModalDialog.parts.title({dom:{tag:"div",classes:["tox-dialog__title"],innerHtml:"",styles:{display:"none"}}})},pBodyMessage=function(message,providersBackstage){return ModalDialog.parts.body({dom:{tag:"div",classes:["tox-dialog__body"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-content"]},components:[{dom:fromHtml("<p>"+providersBackstage.translate(message)+"</p>")}]}]})},pFooter=function(buttons){return ModalDialog.parts.footer({dom:{tag:"div",classes:["tox-dialog__footer"]},components:buttons})},pFooterGroup=function(startButtons,endButtons){return[Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-start"]},components:startButtons}),Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-end"]},components:endButtons})]},renderDialog$1=function(spec){var _a,dialogClass="tox-dialog",blockerClass=dialogClass+"-wrap",blockerBackdropClass=blockerClass+"__backdrop",scrollLockClass=dialogClass+"__disable-scroll";return ModalDialog.sketch({lazySink:spec.lazySink,onEscape:function(comp){return spec.onEscape(comp),Optional.some(!0)},useTabstopAt:function(elem){return!isPseudoStop(elem)},dom:{tag:"div",classes:[dialogClass].concat(spec.extraClasses),styles:__assign({position:"relative"},spec.extraStyles)},components:__spreadArray([spec.header,spec.body],spec.footer.toArray(),!0),parts:{blocker:{dom:fromHtml('<div class="'+blockerClass+'"></div>'),components:[{dom:{tag:"div",classes:isTouch?[blockerBackdropClass,blockerBackdropClass+"--opaque"]:[blockerBackdropClass]}}]}},dragBlockClass:blockerClass,modalBehaviours:derive$1(__spreadArray([Focusing.config({}),config("dialog-events",spec.dialogEvents.concat([runOnSource(focusin(),(function(comp,_se){Keying.focusIn(comp)}))])),config("scroll-lock",[runOnAttached((function(){add$2(body(),scrollLockClass)})),runOnDetached((function(){remove$2(body(),scrollLockClass)}))])],spec.extraBehaviours,!0)),eventOrder:__assign((_a={},_a[execute$5()]=["dialog-events"],_a[attachedToDom()]=["scroll-lock","dialog-events","alloy.base.behaviour"],_a[detachedFromDom()]=["alloy.base.behaviour","dialog-events","scroll-lock"],_a),spec.eventOrder)})},renderClose=function(providersBackstage){return Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--icon","tox-button--naked"],attributes:{type:"button","aria-label":providersBackstage.translate("Close"),title:providersBackstage.translate("Close")}},components:[render$3("close",{tag:"div",classes:["tox-icon"]},providersBackstage.icons)],action:function(comp){emit(comp,formCancelEvent)}})},renderTitle=function(spec,id,providersBackstage){var renderComponents=function(data){return[text(providersBackstage.translate(data.title))]};return{dom:{tag:"div",classes:["tox-dialog__title"],attributes:__assign({},id.map((function(x){return{id:x}})).getOr({}))},components:renderComponents(spec),behaviours:derive$1([Reflecting.config({channel:titleChannel,renderComponents:renderComponents})])}},renderDragHandle=function(){return{dom:fromHtml('<div class="tox-dialog__draghandle"></div>')}},getHeader=function(title,backstage){return function(spec,providersBackstage){var pTitle=ModalDialog.parts.title(renderTitle(spec,Optional.none(),providersBackstage)),pHandle=ModalDialog.parts.draghandle(renderDragHandle()),pClose=ModalDialog.parts.close(renderClose(providersBackstage)),components=[pTitle].concat(spec.draggable?[pHandle]:[]).concat([pClose]);return Container.sketch({dom:fromHtml('<div class="tox-dialog__header"></div>'),components:components})}({title:backstage.shared.providers.translate(title),draggable:backstage.dialog.isDraggableModal()},backstage.shared.providers)},getBusySpec=function(message,bs,providers){return{dom:{tag:"div",classes:["tox-dialog__busy-spinner"],attributes:{"aria-label":providers.translate(message)},styles:{left:"0px",right:"0px",bottom:"0px",top:"0px",position:"absolute"}},behaviours:bs,components:[{dom:fromHtml('<div class="tox-spinner"><div></div><div></div><div></div></div>')}]}},getEventExtras=function(lazyDialog,providers,extra){return{onClose:function(){return extra.closeWindow()},onBlock:function(blockEvent){ModalDialog.setBusy(lazyDialog(),(function(_comp,bs){return getBusySpec(blockEvent.message,bs,providers)}))},onUnblock:function(){ModalDialog.setIdle(lazyDialog())}}},renderModalDialog=function(spec,initialData,dialogEvents,backstage){var _a;return build$1(renderDialog$1(__assign(__assign({},spec),{lazySink:backstage.shared.getSink,extraBehaviours:__spreadArray([Reflecting.config({channel:dialogChannel,updateState:function(_comp,incoming){return Optional.some(incoming)},initialData:initialData}),RepresentingConfigs_memory({})],spec.extraBehaviours,!0),onEscape:function(comp){emit(comp,formCancelEvent)},dialogEvents:dialogEvents,eventOrder:(_a={},_a[receive()]=[Reflecting.name(),Receiving.name()],_a[attachedToDom()]=["scroll-lock",Reflecting.name(),"messages","dialog-events","alloy.base.behaviour"],_a[detachedFromDom()]=["alloy.base.behaviour","dialog-events","messages",Reflecting.name(),"scroll-lock"],_a)})))},mapMenuButtons=function(buttons){return map$2(buttons,(function(button){return"menu"===button.type?function(button){var items=map$2(button.items,(function(item){var cell=Cell(!1);return __assign(__assign({},item),{storage:cell})}));return __assign(__assign({},button),{items:items})}(button):button}))},extractCellsToObject=function(buttons){return foldl(buttons,(function(acc,button){return"menu"===button.type?foldl(button.items,(function(innerAcc,item){return innerAcc[item.name]=item.storage,innerAcc}),acc):acc}),{})},initCommonEvents=function(fireApiEvent,extras){return[runWithTarget(focusin(),onFocus),fireApiEvent(formCloseEvent,(function(_api,spec){extras.onClose(),spec.onClose()})),fireApiEvent(formCancelEvent,(function(api,spec,_event,self){spec.onCancel(api),emit(self,formCloseEvent)})),run$1(formUnblockEvent,(function(_c,_se){return extras.onUnblock()})),run$1(formBlockEvent,(function(_c,se){return extras.onBlock(se.event)}))]},SilverDialogEvents_initUrlDialog=function(getInstanceApi,extras){var fireApiEvent=function(eventName,f){return run$1(eventName,(function(c,se){withSpec(c,(function(spec,_c){f(getInstanceApi(),spec,se.event,c)}))}))},withSpec=function(c,f){Reflecting.getState(c).get().each((function(currentDialog){f(currentDialog,c)}))};return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),!0),[fireApiEvent(formActionEvent,(function(api,spec,event){spec.onAction(api,{name:event.name})}))],!1)},SilverDialogEvents_initDialog=function(getInstanceApi,extras,getSink){var fireApiEvent=function(eventName,f){return run$1(eventName,(function(c,se){withSpec(c,(function(spec,_c){f(getInstanceApi(),spec,se.event,c)}))}))},withSpec=function(c,f){Reflecting.getState(c).get().each((function(currentDialogInit){f(currentDialogInit.internalDialog,c)}))};return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),!0),[fireApiEvent(formSubmitEvent,(function(api,spec){return spec.onSubmit(api)})),fireApiEvent(formChangeEvent,(function(api,spec,event){spec.onChange(api,{name:event.name})})),fireApiEvent(formActionEvent,(function(api,spec,event,component){var focusIn=function(){return Keying.focusIn(component)},isDisabled=function(focused){return has$1(focused,"disabled")||getOpt(focused,"aria-disabled").exists((function(val){return"true"===val}))},rootNode=getRootNode(component.element),current=active(rootNode);spec.onAction(api,{name:event.name,value:event.value}),active(rootNode).fold(focusIn,(function(focused){isDisabled(focused)||current.exists((function(cur){return contains(focused,cur)&&isDisabled(cur)}))?focusIn():getSink().toOptional().filter((function(sink){return!contains(sink.element,focused)})).each(focusIn)}))})),fireApiEvent(formTabChangeEvent,(function(api,spec,event){spec.onTabChange(api,{newTabName:event.name,oldTabName:event.oldName})})),runOnDetached((function(component){var api=getInstanceApi();Representing.setValue(component,api.getData())}))],!1)},renderComponents=function(_data,state){var footerButtons=state.map((function(s){return s.footerButtons})).getOr([]),buttonGroups=partition$3(footerButtons,(function(button){return"start"===button.align})),makeGroup=function(edge,buttons){return Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-"+edge]},components:map$2(buttons,(function(button){return button.memento.asSpec()}))})};return[makeGroup("start",buttonGroups.pass),makeGroup("end",buttonGroups.fail)]},renderFooter=function(initSpec,backstage){return{dom:fromHtml('<div class="tox-dialog__footer"></div>'),components:[],behaviours:derive$1([Reflecting.config({channel:footerChannel,initialData:initSpec,updateState:function(_comp,data){var footerButtons=map$2(data.buttons,(function(button){var memButton=record(function(button,backstage){return renderFooterButton(button,button.type,backstage)}(button,backstage));return{name:button.name,align:button.align,memento:memButton}}));return Optional.some({lookupByName:function(compInSystem,buttonName){return function(compInSystem,footerButtons,buttonName){return find$5(footerButtons,(function(button){return button.name===buttonName})).bind((function(memButton){return memButton.memento.getOpt(compInSystem)}))}(compInSystem,footerButtons,buttonName)},footerButtons:footerButtons})},renderComponents:renderComponents})])}},renderModalFooter=function(initSpec,backstage){return ModalDialog.parts.footer(renderFooter(initSpec,backstage))},getCompByName=function(access,name){if(access.getRoot().getSystem().isConnected()){var form_1=Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper());return Form.getField(form_1,name).fold((function(){var footer=access.getFooter();return Reflecting.getState(footer).get().bind((function(f){return f.lookupByName(form_1,name)}))}),(function(comp){return Optional.some(comp)}))}return Optional.none()},getDialogApi=function(access,doRedial,menuItemStates){var withRoot=function(f){var root=access.getRoot();root.getSystem().isConnected()&&f(root)},instanceApi={getData:function(){var root=access.getRoot(),valueComp=root.getSystem().isConnected()?access.getFormWrapper():root,representedValues=Representing.getValue(valueComp),menuItemCurrentState=map$1(menuItemStates,(function(cell){return cell.get()}));return __assign(__assign({},representedValues),menuItemCurrentState)},setData:function(newData){withRoot((function(_){var prevData=instanceApi.getData(),mergedData=__assign(__assign({},prevData),newData),newInternalData=function(access,data){var root=access.getRoot();return Reflecting.getState(root).get().map((function(dialogState){return getOrDie(asRaw("data",dialogState.dataValidator,data))})).getOr(data)}(access,mergedData),form=access.getFormWrapper();Representing.setValue(form,newInternalData),each(menuItemStates,(function(v,k){has$2(mergedData,k)&&v.set(mergedData[k])}))}))},disable:function(name){getCompByName(access,name).each(Disabling.disable)},enable:function(name){getCompByName(access,name).each(Disabling.enable)},focus:function(name){getCompByName(access,name).each(Focusing.focus)},block:function(message){if(!isString(message))throw new Error("The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument");withRoot((function(root){emitWith(root,formBlockEvent,{message:message})}))},unblock:function(){withRoot((function(root){emit(root,formUnblockEvent)}))},showTab:function(name){withRoot((function(_){var body=access.getBody();Reflecting.getState(body).get().exists((function(b){return b.isTabPanel()}))&&Composing.getCurrent(body).each((function(tabSection){TabSection.showTab(tabSection,name)}))}))},redial:function(d){withRoot((function(root){var dialogInit=doRedial(d);root.getSystem().broadcastOn([dialogChannel],dialogInit),root.getSystem().broadcastOn([titleChannel],dialogInit.internalDialog),root.getSystem().broadcastOn([bodyChannel],dialogInit.internalDialog),root.getSystem().broadcastOn([footerChannel],dialogInit.internalDialog),instanceApi.setData(dialogInit.initialData)}))},close:function(){withRoot((function(root){emit(root,formCloseEvent)}))}};return instanceApi},renderDialog=function(dialogInit,extra,backstage){var header=getHeader(dialogInit.internalDialog.title,backstage),body=function(spec,backstage){var bodySpec=renderBody(spec,Optional.none(),backstage,!1);return ModalDialog.parts.body(bodySpec)}({body:dialogInit.internalDialog.body},backstage),storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons),objOfCells=extractCellsToObject(storagedMenuButtons),footer=renderModalFooter({buttons:storagedMenuButtons},backstage),dialogEvents=SilverDialogEvents_initDialog((function(){return instanceApi}),getEventExtras((function(){return dialog}),backstage.shared.providers,extra),backstage.shared.getSink),dialogSize=function(size){switch(size){case"large":return["tox-dialog--width-lg"];case"medium":return["tox-dialog--width-md"];default:return[]}}(dialogInit.internalDialog.size),spec={header:header,body:body,footer:Optional.some(footer),extraClasses:dialogSize,extraBehaviours:[],extraStyles:{}},dialog=renderModalDialog(spec,dialogInit,dialogEvents,backstage),modalAccess={getRoot:constant$1(dialog),getBody:function(){return ModalDialog.getBody(dialog)},getFooter:function(){return ModalDialog.getFooter(dialog)},getFormWrapper:function(){var outerForm=ModalDialog.getBody(dialog);return Composing.getCurrent(outerForm).getOr(outerForm)}},instanceApi=getDialogApi(modalAccess,extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi}},renderInlineDialog=function(dialogInit,extra,backstage,ariaAttrs){var _a,_b,spec,titleId,providersBackstage,dialogLabelId=generate$6("dialog-label"),dialogContentId=generate$6("dialog-content"),memHeader=record((spec={title:dialogInit.internalDialog.title,draggable:!0},titleId=dialogLabelId,providersBackstage=backstage.shared.providers,Container.sketch({dom:fromHtml('<div class="tox-dialog__header"></div>'),components:[renderTitle(spec,Optional.some(titleId),providersBackstage),renderDragHandle(),renderClose(providersBackstage)],containerBehaviours:derive$1([Dragging.config({mode:"mouse",blockerClass:"blocker",getTarget:function(handle){return closest$1(handle,'[role="dialog"]').getOrDie()},snaps:{getSnapPoints:function(){return[]},leftAttr:"data-drag-left",topAttr:"data-drag-top"}})])}))),memBody=record(function(spec,contentId,backstage,ariaAttrs){return renderBody(spec,Optional.some(contentId),backstage,ariaAttrs)}({body:dialogInit.internalDialog.body},dialogContentId,backstage,ariaAttrs)),storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons),objOfCells=extractCellsToObject(storagedMenuButtons),memFooter=record(function(initSpec,backstage){return renderFooter(initSpec,backstage)}({buttons:storagedMenuButtons},backstage)),dialogEvents=SilverDialogEvents_initDialog((function(){return instanceApi}),{onBlock:function(event){Blocking.block(dialog,(function(_comp,bs){return getBusySpec(event.message,bs,backstage.shared.providers)}))},onUnblock:function(){Blocking.unblock(dialog)},onClose:function(){return extra.closeWindow()}},backstage.shared.getSink),dialog=build$1({dom:{tag:"div",classes:["tox-dialog","tox-dialog-inline"],attributes:(_a={role:"dialog"},_a["aria-labelledby"]=dialogLabelId,_a["aria-describedby"]=dialogContentId,_a)},eventOrder:(_b={},_b[receive()]=[Reflecting.name(),Receiving.name()],_b[execute$5()]=["execute-on-form"],_b[attachedToDom()]=["reflecting","execute-on-form"],_b),behaviours:derive$1([Keying.config({mode:"cyclic",onEscape:function(c){return emit(c,formCloseEvent),Optional.some(!0)},useTabstopAt:function(elem){return!isPseudoStop(elem)&&("button"!==name$2(elem)||"disabled"!==get$d(elem,"disabled"))}}),Reflecting.config({channel:dialogChannel,updateState:function(_comp,incoming){return Optional.some(incoming)},initialData:dialogInit}),Focusing.config({}),config("execute-on-form",dialogEvents.concat([runOnSource(focusin(),(function(comp,_se){Keying.focusIn(comp)}))])),Blocking.config({getRoot:function(){return Optional.some(dialog)}}),Replacing.config({}),RepresentingConfigs_memory({})]),components:[memHeader.asSpec(),memBody.asSpec(),memFooter.asSpec()]}),instanceApi=getDialogApi({getRoot:constant$1(dialog),getFooter:function(){return memFooter.get(dialog)},getBody:function(){return memBody.get(dialog)},getFormWrapper:function(){var body=memBody.get(dialog);return Composing.getCurrent(body).getOr(body)}},extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi}},global$1=tinymce.util.Tools.resolve("tinymce.util.URI"),SUPPORTED_MESSAGE_ACTIONS=["insertContent","setContent","execCommand","close","block","unblock"],isSupportedMessage=function(data){return isObject(data)&&-1!==SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction)},renderUrlDialog=function(internalDialog,extra,editor,backstage){var _a,root,withRoot,header=getHeader(internalDialog.title,backstage),body=function(spec){var bodySpec={dom:{tag:"div",classes:["tox-dialog__content-js"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-iframe"]},components:[craft({dom:{tag:"iframe",attributes:{src:spec.url}},behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})]}],behaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)})])};return ModalDialog.parts.body(bodySpec)}(internalDialog),footer=internalDialog.buttons.bind((function(buttons){return 0===buttons.length?Optional.none():Optional.some(renderModalFooter({buttons:buttons},backstage))})),dialogEvents=SilverDialogEvents_initUrlDialog((function(){return instanceApi}),getEventExtras((function(){return dialog}),backstage.shared.providers,extra)),styles=__assign(__assign({},internalDialog.height.fold((function(){return{}}),(function(height){return{height:height+"px","max-height":height+"px"}}))),internalDialog.width.fold((function(){return{}}),(function(width){return{width:width+"px","max-width":width+"px"}}))),classes=internalDialog.width.isNone()&&internalDialog.height.isNone()?["tox-dialog--width-lg"]:[],iframeUri=new global$1(internalDialog.url,{base_uri:new global$1(window.location.href)}),iframeDomain=iframeUri.protocol+"://"+iframeUri.host+(iframeUri.port?":"+iframeUri.port:""),messageHandlerUnbinder=unbindable(),extraBehaviours=[config("messages",[runOnAttached((function(){var unbind=bind(SugarElement.fromDom(window),"message",(function(e){if(iframeUri.isSameOrigin(new global$1(e.raw.origin))){var data=e.raw.data;isSupportedMessage(data)?function(editor,api,data){switch(data.mceAction){case"insertContent":editor.insertContent(data.content);break;case"setContent":editor.setContent(data.content);break;case"execCommand":var ui=!!isBoolean(data.ui)&&data.ui;editor.execCommand(data.cmd,ui,data.value);break;case"close":api.close();break;case"block":api.block(data.message);break;case"unblock":api.unblock()}}(editor,instanceApi,data):function(data){return!isSupportedMessage(data)&&isObject(data)&&has$2(data,"mceAction")}(data)&&internalDialog.onMessage(instanceApi,data)}}));messageHandlerUnbinder.set(unbind)})),runOnDetached(messageHandlerUnbinder.clear)]),Receiving.config({channels:(_a={},_a[bodySendMessageChannel]={onReceive:function(comp,data){descendant(comp.element,"iframe").each((function(iframeEle){iframeEle.dom.contentWindow.postMessage(data,iframeDomain)}))}},_a)})],dialog=renderModalDialog({header:header,body:body,footer:footer,extraClasses:classes,extraBehaviours:extraBehaviours,extraStyles:styles},internalDialog,dialogEvents,backstage),instanceApi=(root=dialog,withRoot=function(f){root.getSystem().isConnected()&&f(root)},{block:function(message){if(!isString(message))throw new Error("The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument");withRoot((function(root){emitWith(root,formBlockEvent,{message:message})}))},unblock:function(){withRoot((function(root){emit(root,formUnblockEvent)}))},close:function(){withRoot((function(root){emit(root,formCloseEvent)}))},sendMessage:function(data){withRoot((function(root){root.getSystem().broadcastOn([bodySendMessageChannel],data)}))}});return{dialog:dialog,instanceApi:instanceApi}},inlineAdditionalBehaviours=function(editor,isStickyToolbar,isToolbarLocationTop){return isStickyToolbar&&isToolbarLocationTop?[]:[Docking.config({contextual:{lazyContext:function(){return Optional.some(box$1(SugarElement.fromDom(editor.getContentAreaContainer())))},fadeInClass:"tox-dialog-dock-fadein",fadeOutClass:"tox-dialog-dock-fadeout",transitionClass:"tox-dialog-dock-transition"},modes:["top"]})]},setup=function(extras){var backstage=extras.backstage,editor=extras.editor,isStickyToolbar$1=isStickyToolbar(editor),alertDialog=function(extras){var sharedBackstage=extras.backstage.shared;return{open:function(message,callback){var closeDialog=function(){ModalDialog.hide(alertDialog),callback()},memFooterClose=record(renderFooterButton({name:"close-alert",text:"OK",primary:!0,align:"end",disabled:!1,icon:Optional.none()},"cancel",extras.backstage)),titleSpec=pUntitled(),closeSpec=pClose(closeDialog,sharedBackstage.providers),alertDialog=build$1(renderDialog$1({lazySink:function(){return sharedBackstage.getSink()},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[memFooterClose.asSpec()]))),onEscape:closeDialog,extraClasses:["tox-alert-dialog"],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,closeDialog)],eventOrder:{}}));ModalDialog.show(alertDialog);var footerCloseButton=memFooterClose.get(alertDialog);Focusing.focus(footerCloseButton)}}}(extras),confirmDialog=function(extras){var sharedBackstage=extras.backstage.shared;return{open:function(message,callback){var closeDialog=function(state){ModalDialog.hide(confirmDialog),callback(state)},memFooterYes=record(renderFooterButton({name:"yes",text:"Yes",primary:!0,align:"end",disabled:!1,icon:Optional.none()},"submit",extras.backstage)),footerNo=renderFooterButton({name:"no",text:"No",primary:!1,align:"end",disabled:!1,icon:Optional.none()},"cancel",extras.backstage),titleSpec=pUntitled(),closeSpec=pClose((function(){return closeDialog(!1)}),sharedBackstage.providers),confirmDialog=build$1(renderDialog$1({lazySink:function(){return sharedBackstage.getSink()},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[footerNo,memFooterYes.asSpec()]))),onEscape:function(){return closeDialog(!1)},extraClasses:["tox-confirm-dialog"],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,(function(){return closeDialog(!1)})),run$1(formSubmitEvent,(function(){return closeDialog(!0)}))],eventOrder:{}}));ModalDialog.show(confirmDialog);var footerYesButton=memFooterYes.get(confirmDialog);Focusing.focus(footerYesButton)}}}(extras),openModalUrlDialog=function(config,closeWindow){return DialogManager.openUrl((function(contents){var dialog=renderUrlDialog(contents,{closeWindow:function(){ModalDialog.hide(dialog.dialog),closeWindow(dialog.instanceApi)}},editor,backstage);return ModalDialog.show(dialog.dialog),dialog.instanceApi}),config)},openModalDialog=function(config,closeWindow){return DialogManager.open((function(contents,internalInitialData,dataValidator){var initialData=internalInitialData,dialog=renderDialog({dataValidator:dataValidator,initialData:initialData,internalDialog:contents},{redial:DialogManager.redial,closeWindow:function(){ModalDialog.hide(dialog.dialog),closeWindow(dialog.instanceApi)}},backstage);return ModalDialog.show(dialog.dialog),dialog.instanceApi.setData(initialData),dialog.instanceApi}),config)},openInlineDialog=function(config$1,anchor,closeWindow,ariaAttrs){return DialogManager.open((function(contents,internalInitialData,dataValidator){var initialData=getOrDie(asRaw("data",dataValidator,internalInitialData)),inlineDialog=value$1(),isToolbarLocationTop=backstage.shared.header.isPositionedAtTop(),refreshDocking=function(){return inlineDialog.on((function(dialog){InlineView.reposition(dialog),Docking.refresh(dialog)}))},dialogUi=renderInlineDialog({dataValidator:dataValidator,initialData:initialData,internalDialog:contents},{redial:DialogManager.redial,closeWindow:function(){inlineDialog.on(InlineView.hide),editor.off("ResizeEditor",refreshDocking),inlineDialog.clear(),closeWindow(dialogUi.instanceApi)}},backstage,ariaAttrs),inlineDialogComp=build$1(InlineView.sketch(__assign(__assign({lazySink:backstage.shared.getSink,dom:{tag:"div",classes:[]},fireDismissalEventInstead:{}},isToolbarLocationTop?{}:{fireRepositionEventInstead:{}}),{inlineBehaviours:derive$1(__spreadArray([config("window-manager-inline-events",[run$1(dismissRequested(),(function(_comp,_se){emit(dialogUi.dialog,formCancelEvent)}))])],inlineAdditionalBehaviours(editor,isStickyToolbar$1,isToolbarLocationTop),!0)),isExtraPart:function(_comp,target){return function(target){return closest(target,".tox-alert-dialog")||closest(target,".tox-confirm-dialog")}(target)}})));return inlineDialog.set(inlineDialogComp),InlineView.showWithin(inlineDialogComp,premade(dialogUi.dialog),{anchor:anchor},Optional.some(body())),isStickyToolbar$1&&isToolbarLocationTop||(Docking.refresh(inlineDialogComp),editor.on("ResizeEditor",refreshDocking)),dialogUi.instanceApi.setData(initialData),Keying.focusIn(dialogUi.dialog),dialogUi.instanceApi}),config$1)};return{open:function(config,params,closeWindow){return void 0!==params&&"toolbar"===params.inline?openInlineDialog(config,backstage.shared.anchors.inlineDialog(),closeWindow,params.ariaAttrs):void 0!==params&&"cursor"===params.inline?openInlineDialog(config,backstage.shared.anchors.cursor(),closeWindow,params.ariaAttrs):openModalDialog(config,closeWindow)},openUrl:function(config,closeWindow){return openModalUrlDialog(config,closeWindow)},alert:function(message,callback){alertDialog.open(message,(function(){callback()}))},close:function(instanceApi){instanceApi.close()},confirm:function(message,callback){confirmDialog.open(message,(function(state){callback(state)}))}}};!function Theme(){global$g.add("silver",(function(editor){var _a=setup$3(editor),uiMothership=_a.uiMothership,backstage=_a.backstage,renderUI=_a.renderUI,getUi=_a.getUi;Autocompleter_register(editor,backstage.shared);var windowMgr=setup({editor:editor,backstage:backstage});return{renderUI:renderUI,getWindowManagerImpl:constant$1(windowMgr),getNotificationManagerImpl:function(){return NotificationManagerImpl(editor,{backstage:backstage},uiMothership)},ui:getUi()}}))}()}();
//# sourceMappingURL=scripts.js.map