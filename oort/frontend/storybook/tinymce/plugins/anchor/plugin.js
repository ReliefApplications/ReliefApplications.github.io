!function(){"use strict";var global$2=tinymce.util.Tools.resolve("tinymce.PluginManager"),global$1=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),global=tinymce.util.Tools.resolve("tinymce.util.Tools"),isEmptyString=function(str){return!str},getIdFromAnchor=function(elm){return elm.getAttribute("id")||elm.getAttribute("name")||""},isNamedAnchor=function(elm){return function(elm){return elm&&"a"===elm.nodeName.toLowerCase()}(elm)&&!elm.getAttribute("href")&&""!==getIdFromAnchor(elm)},removeEmptyNamedAnchorsInSelection=function(editor){var dom=editor.dom;global$1(dom).walk(editor.selection.getRng(),(function(nodes){global.each(nodes,(function(node){var elm;isNamedAnchor(elm=node)&&!elm.firstChild&&dom.remove(node,!1)}))}))},getNamedAnchor=function(editor){return editor.dom.getParent(editor.selection.getStart(),"a:not([href])")},insert=function(editor,id){var anchor=getNamedAnchor(editor);anchor?function(editor,id,anchorElement){anchorElement.removeAttribute("name"),anchorElement.id=id,editor.addVisual(),editor.undoManager.add()}(editor,id,anchor):function(editor,id){editor.undoManager.transact((function(){(function(editor){return editor.getParam("allow_html_in_named_anchor",!1,"boolean")})(editor)||editor.selection.collapse(!0),editor.selection.isCollapsed()?editor.insertContent(editor.dom.createHTML("a",{id})):(removeEmptyNamedAnchorsInSelection(editor),editor.formatter.remove("namedAnchor",null,null,!0),editor.formatter.apply("namedAnchor",{value:id}),editor.addVisual())}))}(editor,id),editor.focus()},open=function(editor){var currentId=function(editor){var anchor=getNamedAnchor(editor);return anchor?getIdFromAnchor(anchor):""}(editor);editor.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:currentId},onSubmit:function(api){(function(editor,newId){return/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(newId)?(insert(editor,newId),!0):(editor.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1)})(editor,api.getData().id)&&api.close()}})},isEmptyNamedAnchorNode=function(node){return function(node){return node&&isEmptyString(node.attr("href"))&&!isEmptyString(node.attr("id")||node.attr("name"))}(node)&&!node.firstChild},setContentEditable=function(state){return function(nodes){for(var i=0;i<nodes.length;i++){var node=nodes[i];isEmptyNamedAnchorNode(node)&&node.attr("contenteditable",state)}}};!function Plugin(){global$2.add("anchor",(function(editor){!function(editor){editor.on("PreInit",(function(){editor.parser.addNodeFilter("a",setContentEditable("false")),editor.serializer.addNodeFilter("a",setContentEditable(null))}))}(editor),function(editor){editor.addCommand("mceAnchor",(function(){open(editor)}))}(editor),function(editor){editor.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return editor.execCommand("mceAnchor")},onSetup:function(buttonApi){return editor.selection.selectorChangedWithUnbind("a:not([href])",buttonApi.setActive).unbind}}),editor.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return editor.execCommand("mceAnchor")}})}(editor),editor.on("PreInit",(function(){!function(editor){editor.formatter.register("namedAnchor",{inline:"a",selector:"a:not([href])",remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:function(node,_fmt,_itemName){return isNamedAnchor(node)}})}(editor)}))}))}()}();