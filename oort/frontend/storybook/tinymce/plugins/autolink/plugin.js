!function(){"use strict";var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),global=tinymce.util.Tools.resolve("tinymce.Env"),defaultLinkPattern=new RegExp("^"+/(?:[A-Za-z][A-Za-z\d.+-]{0,14}:\/\/(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?|www\.|[-;:&=+$,.\w]+@)[A-Za-z\d-]+(?:\.[A-Za-z\d-]+)*(?::\d+)?(?:\/(?:[-+~=.,%()\/\w]*[-+~=%()\/\w])?)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g.source+"$","i"),rangeEqualsBracketOrSpace=function(rangeString){return/^[(\[{ \u00a0]$/.test(rangeString)},isTextNode=function(node){return 3===node.nodeType},isElement=function(node){return 1===node.nodeType},scopeIndex=function(container,index){if(index<0&&(index=0),isTextNode(container)){var len=container.data.length;index>len&&(index=len)}return index},setStart=function(rng,container,offset){!isElement(container)||container.hasChildNodes()?rng.setStart(container,scopeIndex(container,offset)):rng.setStartBefore(container)},setEnd=function(rng,container,offset){!isElement(container)||container.hasChildNodes()?rng.setEnd(container,scopeIndex(container,offset)):rng.setEndAfter(container)},parseCurrentLine=function(editor,endOffset){var end,endContainer,bookmark,text,prev,len,rngText,autoLinkPattern=function(editor){return editor.getParam("autolink_pattern",defaultLinkPattern)}(editor),defaultLinkTarget=function(editor){return editor.getParam("default_link_target",!1)}(editor);if(null===editor.dom.getParent(editor.selection.getNode(),"a[href]")){var rng=editor.selection.getRng().cloneRange();if(rng.startOffset<5){if(!(prev=rng.endContainer.previousSibling)){if(!rng.endContainer.firstChild||!rng.endContainer.firstChild.nextSibling)return;prev=rng.endContainer.firstChild.nextSibling}if(len=prev.length,setStart(rng,prev,len),setEnd(rng,prev,len),rng.endOffset<5)return;end=rng.endOffset,endContainer=prev}else{if(endContainer=rng.endContainer,!isTextNode(endContainer)&&endContainer.firstChild){for(;!isTextNode(endContainer)&&endContainer.firstChild;)endContainer=endContainer.firstChild;isTextNode(endContainer)&&(setStart(rng,endContainer,0),setEnd(rng,endContainer,endContainer.nodeValue.length))}end=1===rng.endOffset?2:rng.endOffset-1-endOffset}var char,start=end;do{setStart(rng,endContainer,end>=2?end-2:0),setEnd(rng,endContainer,end>=1?end-1:0),end-=1,rngText=rng.toString()}while(!rangeEqualsBracketOrSpace(rngText)&&end-2>=0);rangeEqualsBracketOrSpace(rng.toString())?(setStart(rng,endContainer,end),setEnd(rng,endContainer,start),end+=1):0===rng.startOffset?(setStart(rng,endContainer,0),setEnd(rng,endContainer,start)):(setStart(rng,endContainer,end),setEnd(rng,endContainer,start)),text=rng.toString(),char=text.charAt(text.length-1),/[?!,.;:]/.test(char)&&setEnd(rng,endContainer,start-1);var matches=(text=rng.toString().trim()).match(autoLinkPattern),protocol=function(editor){return editor.getParam("link_default_protocol","http","string")}(editor);if(matches){var url=matches[0];(function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr})(url,"www.",0)?url=protocol+"://"+url:function(str,substr){return-1!==str.indexOf(substr)}(url,"@")&&!function(url){return/^([A-Za-z][A-Za-z\d.+-]*:\/\/)|mailto:/.test(url)}(url)&&(url="mailto:"+url),bookmark=editor.selection.getBookmark(),editor.selection.setRng(rng),editor.execCommand("createlink",!1,url),!1!==defaultLinkTarget&&editor.dom.setAttrib(editor.selection.getNode(),"target",defaultLinkTarget),editor.selection.moveToBookmark(bookmark),editor.nodeChanged()}}},setup=function(editor){var autoUrlDetectState;editor.on("keydown",(function(e){if(13===e.keyCode)return function(editor){return parseCurrentLine(editor,-1)}(editor)})),global.browser.isIE()?editor.on("focus",(function(){if(!autoUrlDetectState){autoUrlDetectState=!0;try{editor.execCommand("AutoUrlDetect",!1,!0)}catch(ex){}}})):(editor.on("keypress",(function(e){if(41===e.keyCode||93===e.keyCode||125===e.keyCode)return function(editor){return parseCurrentLine(editor,-1)}(editor)})),editor.on("keyup",(function(e){if(32===e.keyCode)return function(editor){return parseCurrentLine(editor,0)}(editor)})))};!function Plugin(){global$1.add("autolink",(function(editor){setup(editor)}))}()}();