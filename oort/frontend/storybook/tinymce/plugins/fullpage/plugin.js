!function(){"use strict";var Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},global$4=tinymce.util.Tools.resolve("tinymce.PluginManager"),__assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},global$3=tinymce.util.Tools.resolve("tinymce.util.Tools"),global$2=tinymce.util.Tools.resolve("tinymce.html.DomParser"),global$1=tinymce.util.Tools.resolve("tinymce.html.Node"),global=tinymce.util.Tools.resolve("tinymce.html.Serializer"),shouldHideInSourceView=function(editor){return editor.getParam("fullpage_hide_in_source_view")},getDefaultEncoding=function(editor){return editor.getParam("fullpage_default_encoding")},getDefaultFontFamily=function(editor){return editor.getParam("fullpage_default_font_family")},getDefaultFontSize=function(editor){return editor.getParam("fullpage_default_font_size")},parseHeader=function(editor,head){return global$2({validate:!1,root_name:"#document"},editor.schema).parse(head,{format:"xhtml"})},open=function(editor,headState){var data=function(editor,head){var elm,matches,headerFragment=parseHeader(editor,head),data={},getAttr=function(elm,name){return elm.attr(name)||""};return data.fontface=getDefaultFontFamily(editor),data.fontsize=getDefaultFontSize(editor),7===(elm=headerFragment.firstChild).type&&(data.xml_pi=!0,(matches=/encoding="([^"]+)"/.exec(elm.value))&&(data.docencoding=matches[1])),(elm=headerFragment.getAll("#doctype")[0])&&(data.doctype="<!DOCTYPE"+elm.value+">"),(elm=headerFragment.getAll("title")[0])&&elm.firstChild&&(data.title=elm.firstChild.value),global$3.each(headerFragment.getAll("meta"),(function(meta){var matches,name=meta.attr("name"),httpEquiv=meta.attr("http-equiv");name?data[name.toLowerCase()]=meta.attr("content"):"Content-Type"===httpEquiv&&(matches=/charset\s*=\s*(.*)\s*/gi.exec(meta.attr("content")))&&(data.docencoding=matches[1])})),(elm=headerFragment.getAll("html")[0])&&(data.langcode=getAttr(elm,"lang")||getAttr(elm,"xml:lang")),data.stylesheets=[],global$3.each(headerFragment.getAll("link"),(function(link){"stylesheet"===link.attr("rel")&&data.stylesheets.push(link.attr("href"))})),(elm=headerFragment.getAll("body")[0])&&(data.langdir=getAttr(elm,"dir"),data.style=getAttr(elm,"style"),data.visited_color=getAttr(elm,"vlink"),data.link_color=getAttr(elm,"link"),data.active_color=getAttr(elm,"alink")),data}(editor,headState.get()),initialData=__assign(__assign({},{title:"",keywords:"",description:"",robots:"",author:"",docencoding:""}),data);editor.windowManager.open({title:"Metadata and Document Properties",size:"normal",body:{type:"panel",items:[{name:"title",type:"input",label:"Title"},{name:"keywords",type:"input",label:"Keywords"},{name:"description",type:"input",label:"Description"},{name:"robots",type:"input",label:"Robots"},{name:"author",type:"input",label:"Author"},{name:"docencoding",type:"input",label:"Encoding"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData,onSubmit:function(api){var nuData=api.getData(),headHtml=function(editor,data,head){var headElement,elm,dom=editor.dom,setAttr=function(elm,name,value){elm.attr(name,value||void 0)},addHeadNode=function(node){headElement.firstChild?headElement.insert(node,headElement.firstChild):headElement.append(node)},headerFragment=parseHeader(editor,head);if((headElement=headerFragment.getAll("head")[0])||(elm=headerFragment.getAll("html")[0],headElement=new global$1("head",1),elm.firstChild?elm.insert(headElement,elm.firstChild,!0):elm.append(headElement)),elm=headerFragment.firstChild,data.xml_pi){var value='version="1.0"';data.docencoding&&(value+=' encoding="'+data.docencoding+'"'),7!==elm.type&&(elm=new global$1("xml",7),headerFragment.insert(elm,headerFragment.firstChild,!0)),elm.value=value}else elm&&7===elm.type&&elm.remove();elm=headerFragment.getAll("#doctype")[0],data.doctype?(elm||(elm=new global$1("#doctype",10),data.xml_pi?headerFragment.insert(elm,headerFragment.firstChild):addHeadNode(elm)),elm.value=data.doctype.substring(9,data.doctype.length-1)):elm&&elm.remove(),elm=null,global$3.each(headerFragment.getAll("meta"),(function(meta){"Content-Type"===meta.attr("http-equiv")&&(elm=meta)})),data.docencoding?(elm||((elm=new global$1("meta",1)).attr("http-equiv","Content-Type"),elm.shortEnded=!0,addHeadNode(elm)),elm.attr("content","text/html; charset="+data.docencoding)):elm&&elm.remove(),elm=headerFragment.getAll("title")[0],data.title?(elm?elm.empty():(elm=new global$1("title",1),addHeadNode(elm)),elm.append(new global$1("#text",3)).value=data.title):elm&&elm.remove(),global$3.each("keywords,description,author,copyright,robots".split(","),(function(name){var i,meta,nodes=headerFragment.getAll("meta"),value=data[name];for(i=0;i<nodes.length;i++)if((meta=nodes[i]).attr("name")===name)return void(value?meta.attr("content",value):meta.remove());value&&((elm=new global$1("meta",1)).attr("name",name),elm.attr("content",value),elm.shortEnded=!0,addHeadNode(elm))}));var currentStyleSheetsMap={};global$3.each(headerFragment.getAll("link"),(function(stylesheet){"stylesheet"===stylesheet.attr("rel")&&(currentStyleSheetsMap[stylesheet.attr("href")]=stylesheet)})),global$3.each(data.stylesheets,(function(stylesheet){currentStyleSheetsMap[stylesheet]||((elm=new global$1("link",1)).attr({rel:"stylesheet",text:"text/css",href:stylesheet}),elm.shortEnded=!0,addHeadNode(elm)),delete currentStyleSheetsMap[stylesheet]})),global$3.each(currentStyleSheetsMap,(function(stylesheet){stylesheet.remove()})),(elm=headerFragment.getAll("body")[0])&&(setAttr(elm,"dir",data.langdir),setAttr(elm,"style",data.style),setAttr(elm,"vlink",data.visited_color),setAttr(elm,"link",data.link_color),setAttr(elm,"alink",data.active_color),dom.setAttribs(editor.getBody(),{style:data.style,dir:data.dir,vLink:data.visited_color,link:data.link_color,aLink:data.active_color})),(elm=headerFragment.getAll("html")[0])&&(setAttr(elm,"lang",data.langcode),setAttr(elm,"xml:lang",data.langcode)),headElement.firstChild||headElement.remove();var html=global({validate:!1,indent:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(headerFragment);return html.substring(0,html.indexOf("</body>"))}(editor,global$3.extend(data,nuData),headState.get());headState.set(headHtml),api.close()}})},each=global$3.each,low=function(s){return s.replace(/<\/?[A-Z]+/g,(function(a){return a.toLowerCase()}))},handleSetContent=function(editor,headState,footState,evt){var startPos,endPos,content,protect,html,styles="",dom=editor.dom;if(!evt.selection&&(protect=function(editor){return editor.getParam("protect")}(editor),html=evt.content,global$3.each(protect,(function(pattern){html=html.replace(pattern,(function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"}))})),content=html,!("raw"===evt.format&&headState.get()||evt.source_view&&shouldHideInSourceView(editor)))){0!==content.length||evt.source_view||(content=global$3.trim(headState.get())+"\n"+global$3.trim(content)+"\n"+global$3.trim(footState.get())),-1!==(startPos=(content=content.replace(/<(\/?)BODY/gi,"<$1body")).indexOf("<body"))?(startPos=content.indexOf(">",startPos),headState.set(low(content.substring(0,startPos+1))),-1===(endPos=content.indexOf("</body",startPos))&&(endPos=content.length),evt.content=global$3.trim(content.substring(startPos+1,endPos)),footState.set(low(content.substring(endPos)))):(headState.set(getDefaultHeader(editor)),footState.set("\n</body>\n</html>"));var headerFragment=parseHeader(editor,headState.get());each(headerFragment.getAll("style"),(function(node){node.firstChild&&(styles+=node.firstChild.value)}));var bodyElm=headerFragment.getAll("body")[0];bodyElm&&dom.setAttribs(editor.getBody(),{style:bodyElm.attr("style")||"",dir:bodyElm.attr("dir")||"",vLink:bodyElm.attr("vlink")||"",link:bodyElm.attr("link")||"",aLink:bodyElm.attr("alink")||""}),dom.remove("fullpage_styles");var headElm=editor.getDoc().getElementsByTagName("head")[0];if(styles)dom.add(headElm,"style",{id:"fullpage_styles"}).appendChild(document.createTextNode(styles));var currentStyleSheetsMap={};global$3.each(headElm.getElementsByTagName("link"),(function(stylesheet){"stylesheet"===stylesheet.rel&&stylesheet.getAttribute("data-mce-fullpage")&&(currentStyleSheetsMap[stylesheet.href]=stylesheet)})),global$3.each(headerFragment.getAll("link"),(function(stylesheet){var href=stylesheet.attr("href");if(!href)return!0;currentStyleSheetsMap[href]||"stylesheet"!==stylesheet.attr("rel")||dom.add(headElm,"link",{rel:"stylesheet",text:"text/css",href,"data-mce-fullpage":"1"}),delete currentStyleSheetsMap[href]})),global$3.each(currentStyleSheetsMap,(function(stylesheet){stylesheet.parentNode.removeChild(stylesheet)}))}},getDefaultHeader=function(editor){var value,header="",styles="";if(function(editor){return editor.getParam("fullpage_default_xml_pi")}(editor)){var piEncoding=getDefaultEncoding(editor);header+='<?xml version="1.0" encoding="'+(piEncoding||"ISO-8859-1")+'" ?>\n'}return header+=function(editor){return editor.getParam("fullpage_default_doctype","<!DOCTYPE html>")}(editor),header+="\n<html>\n<head>\n",(value=function(editor){return editor.getParam("fullpage_default_title")}(editor))&&(header+="<title>"+value+"</title>\n"),(value=getDefaultEncoding(editor))&&(header+='<meta http-equiv="Content-Type" content="text/html; charset='+value+'" />\n'),(value=getDefaultFontFamily(editor))&&(styles+="font-family: "+value+";"),(value=getDefaultFontSize(editor))&&(styles+="font-size: "+value+";"),(value=function(editor){return editor.getParam("fullpage_default_text_color")}(editor))&&(styles+="color: "+value+";"),header+="</head>\n<body"+(styles?' style="'+styles+'"':"")+">\n"},handleGetContent=function(editor,head,foot,evt){"html"!==evt.format||evt.selection||evt.source_view&&shouldHideInSourceView(editor)||(evt.content=(global$3.trim(head)+"\n"+global$3.trim(evt.content)+"\n"+global$3.trim(foot)).replace(/<!--mce:protected ([\s\S]*?)-->/g,(function(a,m){return unescape(m)})))};!function Plugin(){global$4.add("fullpage",(function(editor){var headState=Cell(""),footState=Cell("");!function(editor,headState){editor.addCommand("mceFullPageProperties",(function(){open(editor,headState)}))}(editor,headState),function(editor){editor.ui.registry.addButton("fullpage",{tooltip:"Metadata and document properties",icon:"document-properties",onAction:function(){editor.execCommand("mceFullPageProperties")}}),editor.ui.registry.addMenuItem("fullpage",{text:"Metadata and document properties",icon:"document-properties",onAction:function(){editor.execCommand("mceFullPageProperties")}})}(editor),function(editor,headState,footState){editor.on("BeforeSetContent",(function(evt){handleSetContent(editor,headState,footState,evt)})),editor.on("GetContent",(function(evt){handleGetContent(editor,headState.get(),footState.get(),evt)}))}(editor,headState,footState)}))}()}();