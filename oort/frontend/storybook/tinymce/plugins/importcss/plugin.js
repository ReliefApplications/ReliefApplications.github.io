!function(){"use strict";var global$4=tinymce.util.Tools.resolve("tinymce.PluginManager"),isType=function(type){return function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}},isString=isType("string"),isArray=isType("array"),global$3=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$2=tinymce.util.Tools.resolve("tinymce.EditorManager"),global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.util.Tools"),getSelectorConverter=function(editor){return editor.getParam("importcss_selector_converter")},shouldAppend=function(editor){return editor.getParam("importcss_append")},nativePush=Array.prototype.push,bind=function(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}(xs,f))},internalEditorStyle=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,compileFilter=function(filter){return isString(filter)?function(value){return-1!==value.indexOf(filter)}:filter instanceof RegExp?function(value){return filter.test(value)}:filter},getSelectors=function(editor,doc,fileFilter){var selectors=[],contentCSSUrls={},append=function(styleSheet,imported){var rules,url,cacheSuffix,href=styleSheet.href;if(url=href,cacheSuffix=global$1.cacheSuffix,isString(url)&&(url=url.replace("?"+cacheSuffix,"").replace("&"+cacheSuffix,"")),(href=url)&&fileFilter(href,imported)&&!function(editor,href){var skin=function(editor){var skin=editor.getParam("skin");return!1!==skin&&(skin||"oxide")}(editor);if(skin){var skinUrlBase=function(editor){return editor.getParam("skin_url")}(editor),skinUrl=skinUrlBase?editor.documentBaseURI.toAbsolute(skinUrlBase):global$2.baseURL+"/skins/ui/"+skin,contentSkinUrlPart=global$2.baseURL+"/skins/content/";return href===skinUrl+"/content"+(editor.inline?".inline":"")+".min.css"||-1!==href.indexOf(contentSkinUrlPart)}return!1}(editor,href)){global.each(styleSheet.imports,(function(styleSheet){append(styleSheet,!0)}));try{rules=styleSheet.cssRules||styleSheet.rules}catch(e){}global.each(rules,(function(cssRule){cssRule.styleSheet?append(cssRule.styleSheet,!0):function(rule){return rule.selectorText}(cssRule)&&global.each(cssRule.selectorText.split(","),(function(selector){selectors.push(global.trim(selector))}))}))}};global.each(editor.contentCSS,(function(url){contentCSSUrls[url]=!0})),fileFilter||(fileFilter=function(href,imported){return imported||contentCSSUrls[href]});try{global.each(doc.styleSheets,(function(styleSheet){append(styleSheet)}))}catch(e){}return selectors},defaultConvertSelectorToFormat=function(editor,selectorText){var format,selector=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(selectorText);if(selector){var elementName=selector[1],classes=selector[2].substr(1).split(".").join(" "),inlineSelectorElements=global.makeMap("a,img");return selector[1]?(format={title:selectorText},editor.schema.getTextBlockElements()[elementName]?format.block=elementName:editor.schema.getBlockElements()[elementName]||inlineSelectorElements[elementName.toLowerCase()]?format.selector=elementName:format.inline=elementName):selector[2]&&(format={inline:"span",title:selectorText.substr(1),classes:classes}),!1!==function(editor){return editor.getParam("importcss_merge_classes")}(editor)?format.classes=classes:format.attributes={class:classes},format}},isExclusiveMode=function(editor,group){return null===group||!1!==function(editor){return editor.getParam("importcss_exclusive")}(editor)},setup=function(editor){editor.on("init",(function(){var model=function(){var ungroupedOrder=[],groupOrder=[],groups={};return{addItemToGroup:function(groupTitle,itemInfo){groups[groupTitle]?groups[groupTitle].push(itemInfo):(groupOrder.push(groupTitle),groups[groupTitle]=[itemInfo])},addItem:function(itemInfo){ungroupedOrder.push(itemInfo)},toFormats:function(){return bind(groupOrder,(function(g){var items=groups[g];return 0===items.length?[]:[{title:g,items:items}]})).concat(ungroupedOrder)}}}(),globallyUniqueSelectors={},selectorFilter=compileFilter(function(editor){return editor.getParam("importcss_selector_filter")}(editor)),groups=function(groups){return global.map(groups,(function(group){return global.extend({},group,{original:group,selectors:{},filter:compileFilter(group.filter)})}))}(function(editor){return editor.getParam("importcss_groups")}(editor)),processSelector=function(selector,group){if(function(editor,selector,group,globallyUniqueSelectors){return!(isExclusiveMode(editor,group)?selector in globallyUniqueSelectors:selector in group.selectors)}(editor,selector,group,globallyUniqueSelectors)){!function(editor,selector,group,globallyUniqueSelectors){isExclusiveMode(editor,group)?globallyUniqueSelectors[selector]=!0:group.selectors[selector]=!0}(editor,selector,group,globallyUniqueSelectors);var format=function(editor,plugin,selector,group){return(group&&group.selector_converter?group.selector_converter:getSelectorConverter(editor)?getSelectorConverter(editor):function(){return defaultConvertSelectorToFormat(editor,selector)}).call(plugin,selector,group)}(editor,editor.plugins.importcss,selector,group);if(format){var formatName=format.name||global$3.DOM.uniqueId();return editor.formatter.register(formatName,format),{title:format.title,format:formatName}}}return null};global.each(getSelectors(editor,editor.getDoc(),compileFilter(function(editor){return editor.getParam("importcss_file_filter")}(editor))),(function(selector){if(!internalEditorStyle.test(selector)&&(!selectorFilter||selectorFilter(selector))){var selectorGroups=function(groups,selector){return global.grep(groups,(function(group){return!group.filter||group.filter(selector)}))}(groups,selector);if(selectorGroups.length>0)global.each(selectorGroups,(function(group){var menuItem=processSelector(selector,group);menuItem&&model.addItemToGroup(group.title,menuItem)}));else{var menuItem=processSelector(selector,null);menuItem&&model.addItem(menuItem)}}}));var items=model.toFormats();editor.fire("addStyleModifications",{items:items,replace:!shouldAppend(editor)})}))};!function Plugin(){global$4.add("importcss",(function(editor){return setup(editor),function(editor){return{convertSelectorToFormat:function(selectorText){return defaultConvertSelectorToFormat(editor,selectorText)}}}(editor)}))}()}();