!function(){"use strict";var call,id,global$9=tinymce.util.Tools.resolve("tinymce.PluginManager"),__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},isType=function(type){return function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}},isString=isType("string"),isObject=isType("object"),isArray=isType("array"),isNonNullable=function(a){return!function(a){return null==a}(a)},noop=function(){},constant=function(value){return function(){return value}},identity=function(x){return x},never=constant(!1),always=constant(!0),none=function(){return NONE},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant("none()")},some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},nativePush=Array.prototype.push,each$1=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i)}},flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,get$1=function(obj,key){return has(obj,key)?Optional.from(obj[key]):Optional.none()},has=function(obj,key){return hasOwnProperty.call(obj,key)},getScripts=function(editor){return editor.getParam("media_scripts")},hasLiveEmbeds=function(editor){return editor.getParam("media_live_embeds",!0)},global$8=tinymce.util.Tools.resolve("tinymce.util.Tools"),global$7=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$6=tinymce.util.Tools.resolve("tinymce.html.SaxParser"),getVideoScriptMatch=function(prefixes,src){if(prefixes)for(var i=0;i<prefixes.length;i++)if(-1!==src.indexOf(prefixes[i].filter))return prefixes[i]},DOM$1=global$7.DOM,trimPx=function(value){return value.replace(/px$/,"")},htmlToData=function(prefixes,html){var isEphoxEmbed=Cell(!1),data={};return global$6({validate:!1,allow_conditional_comments:!0,start:function(name,attrs){if(isEphoxEmbed.get());else if(has(attrs.map,"data-ephox-embed-iri"))isEphoxEmbed.set(!0),data=function(attrs){var style=attrs.map.style,styles=style?DOM$1.parseStyle(style):{};return{type:"ephox-embed-iri",source:attrs.map["data-ephox-embed-iri"],altsource:"",poster:"",width:get$1(styles,"max-width").map(trimPx).getOr(""),height:get$1(styles,"max-height").map(trimPx).getOr("")}}(attrs);else{if(data.source||"param"!==name||(data.source=attrs.map.movie),"iframe"!==name&&"object"!==name&&"embed"!==name&&"video"!==name&&"audio"!==name||(data.type||(data.type=name),data=global$8.extend(attrs.map,data)),"script"===name){var videoScript=getVideoScriptMatch(prefixes,attrs.map.src);if(!videoScript)return;data={type:"script",source:attrs.map.src,width:String(videoScript.width),height:String(videoScript.height)}}"source"===name&&(data.source?data.altsource||(data.altsource=attrs.map.src):data.source=attrs.map.src),"img"!==name||data.poster||(data.poster=attrs.map.src)}}}).parse(html),data.source=data.source||data.src||data.data,data.altsource=data.altsource||"",data.poster=data.poster||"",data},guess=function(url){var mime={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[url.toLowerCase().split(".").pop()];return mime||""},global$5=tinymce.util.Tools.resolve("tinymce.html.Schema"),global$4=tinymce.util.Tools.resolve("tinymce.html.Writer"),DOM=global$7.DOM,addPx=function(value){return/^[0-9.]+$/.test(value)?value+"px":value},setAttributes=function(attrs,updatedAttrs){!function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}}(updatedAttrs,(function(val,name){var value=""+val;if(attrs.map[name])for(var i=attrs.length;i--;){var attr=attrs[i];attr.name===name&&(value?(attrs.map[name]=value,attr.value=value):(delete attrs.map[name],attrs.splice(i,1)))}else value&&(attrs.push({name:name,value:value}),attrs.map[name]=value)}))},sources=["source","altsource"],updateHtml=function(html,data,updateAll){var hasImage,writer=global$4(),isEphoxEmbed=Cell(!1),sourceCount=0;return global$6({validate:!1,allow_conditional_comments:!0,comment:function(text){writer.comment(text)},cdata:function(text){writer.cdata(text)},text:function(text,raw){writer.text(text,raw)},start:function(name,attrs,empty){if(isEphoxEmbed.get());else if(has(attrs.map,"data-ephox-embed-iri"))isEphoxEmbed.set(!0),function(data,attrs){var style=attrs.map.style,styleMap=style?DOM.parseStyle(style):{};styleMap["max-width"]=addPx(data.width),styleMap["max-height"]=addPx(data.height),setAttributes(attrs,{style:DOM.serializeStyle(styleMap)})}(data,attrs);else{switch(name){case"video":case"object":case"embed":case"img":case"iframe":void 0!==data.height&&void 0!==data.width&&setAttributes(attrs,{width:data.width,height:data.height})}if(updateAll)switch(name){case"video":setAttributes(attrs,{poster:data.poster,src:""}),data.altsource&&setAttributes(attrs,{src:""});break;case"iframe":setAttributes(attrs,{src:data.source});break;case"source":if(sourceCount<2&&(setAttributes(attrs,{src:data[sources[sourceCount]],type:data[sources[sourceCount]+"mime"]}),!data[sources[sourceCount]]))return;sourceCount++;break;case"img":if(!data.poster)return;hasImage=!0}}writer.start(name,attrs,empty)},end:function(name){if(!isEphoxEmbed.get()){if("video"===name&&updateAll)for(var index=0;index<2;index++)if(data[sources[index]]){var attrs=[];attrs.map={},sourceCount<=index&&(setAttributes(attrs,{src:data[sources[index]],type:data[sources[index]+"mime"]}),writer.start("source",attrs,!0))}if(data.poster&&"object"===name&&updateAll&&!hasImage){var imgAttrs=[];imgAttrs.map={},setAttributes(imgAttrs,{src:data.poster,width:data.width,height:data.height}),writer.start("img",imgAttrs,!0)}}writer.end(name)}},global$5({})).parse(html),writer.getContent()},urlPatterns=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],getUrl=function(pattern,url){for(var protocol=function(url){var protocolMatches=url.match(/^(https?:\/\/|www\.)(.+)$/i);return protocolMatches&&protocolMatches.length>1?"www."===protocolMatches[1]?"https://":protocolMatches[1]:"https://"}(url),match=pattern.regex.exec(url),newUrl=protocol+pattern.url,_loop_1=function(i){newUrl=newUrl.replace("$"+i,(function(){return match[i]?match[i]:""}))},i=0;i<match.length;i++)_loop_1(i);return newUrl.replace(/\?$/,"")},dataToHtml=function(editor,dataIn){var data=global$8.extend({},dataIn);if(!data.source&&(global$8.extend(data,htmlToData(getScripts(editor),data.embed)),!data.source))return"";data.altsource||(data.altsource=""),data.poster||(data.poster=""),data.source=editor.convertURL(data.source,"source"),data.altsource=editor.convertURL(data.altsource,"source"),data.sourcemime=guess(data.source),data.altsourcemime=guess(data.altsource),data.poster=editor.convertURL(data.poster,"poster");var url,patterns,pattern=(url=data.source,(patterns=urlPatterns.filter((function(pattern){return pattern.regex.test(url)}))).length>0?global$8.extend({},patterns[0],{url:getUrl(patterns[0],url)}):null);if(pattern&&(data.source=pattern.url,data.type=pattern.type,data.allowfullscreen=pattern.allowFullscreen,data.width=data.width||String(pattern.w),data.height=data.height||String(pattern.h)),data.embed)return updateHtml(data.embed,data,!0);var videoScript=getVideoScriptMatch(getScripts(editor),data.source);videoScript&&(data.type="script",data.width=String(videoScript.width),data.height=String(videoScript.height));var audioTemplateCallback=function(editor){return editor.getParam("audio_template_callback")}(editor),videoTemplateCallback=function(editor){return editor.getParam("video_template_callback")}(editor);return data.width=data.width||"300",data.height=data.height||"150",global$8.each(data,(function(value,key){data[key]=editor.dom.encode(""+value)})),"iframe"===data.type?function(data){var allowFullscreen=data.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+data.source+'" width="'+data.width+'" height="'+data.height+'"'+allowFullscreen+"></iframe>"}(data):"application/x-shockwave-flash"===data.sourcemime?function(data){var html='<object data="'+data.source+'" width="'+data.width+'" height="'+data.height+'" type="application/x-shockwave-flash">';return data.poster&&(html+='<img src="'+data.poster+'" width="'+data.width+'" height="'+data.height+'" />'),html+"</object>"}(data):-1!==data.sourcemime.indexOf("audio")?function(data,audioTemplateCallback){return audioTemplateCallback?audioTemplateCallback(data):'<audio controls="controls" src="'+data.source+'">'+(data.altsource?'\n<source src="'+data.altsource+'"'+(data.altsourcemime?' type="'+data.altsourcemime+'"':"")+" />\n":"")+"</audio>"}(data,audioTemplateCallback):"script"===data.type?function(data){return'<script src="'+data.source+'"><\/script>'}(data):function(data,videoTemplateCallback){return videoTemplateCallback?videoTemplateCallback(data):'<video width="'+data.width+'" height="'+data.height+'"'+(data.poster?' poster="'+data.poster+'"':"")+' controls="controls">\n<source src="'+data.source+'"'+(data.sourcemime?' type="'+data.sourcemime+'"':"")+" />\n"+(data.altsource?'<source src="'+data.altsource+'"'+(data.altsourcemime?' type="'+data.altsourcemime+'"':"")+" />\n":"")+"</video>"}(data,videoTemplateCallback)},isMediaElement=function(element){return element.hasAttribute("data-mce-object")||element.hasAttribute("data-ephox-embed-iri")},global$3=tinymce.util.Tools.resolve("tinymce.util.Promise"),cache={},loadedData=function(editor){return function(data){return dataToHtml(editor,data)}},getEmbedHtml=function(editor,data){var embedHandler=function(editor){return editor.getParam("media_url_resolver")}(editor);return embedHandler?function(data,dataToHtml,handler){return new global$3((function(res,rej){var wrappedResolve=function(response){return response.html&&(cache[data.source]=response),res({url:data.source,html:response.html?response.html:dataToHtml(data)})};cache[data.source]?wrappedResolve(cache[data.source]):handler({url:data.source},wrappedResolve,rej)}))}(data,loadedData(editor),embedHandler):function(data,dataToHtml){return global$3.resolve({html:dataToHtml(data),url:data.source})}(data,loadedData(editor))},unwrap=function(data,sourceInput){var metaData=sourceInput?function(sourceInput,data){return get$1(data,sourceInput).bind((function(mainData){return get$1(mainData,"meta")}))}(sourceInput,data).getOr({}):{},get=function(data,metaData,sourceInput){return function(prop){var _a,getFromData=function(){return get$1(data,prop)},getFromMetaData=function(){return get$1(metaData,prop)},getNonEmptyValue=function(c){return get$1(c,"value").bind((function(v){return v.length>0?Optional.some(v):Optional.none()}))};return(_a={})[prop]=(prop===sourceInput?getFromData().bind((function(child){return isObject(child)?getNonEmptyValue(child).orThunk(getFromMetaData):getFromMetaData().orThunk((function(){return Optional.from(child)}))})):getFromMetaData().orThunk((function(){return getFromData().bind((function(child){return isObject(child)?getNonEmptyValue(child):Optional.from(child)}))}))).getOr(""),_a}}(data,metaData,sourceInput);return __assign(__assign(__assign(__assign(__assign({},get("source")),get("altsource")),get("poster")),get("embed")),function(data,metaData){var dimensions={};return get$1(data,"dimensions").each((function(dims){each$1(["width","height"],(function(prop){get$1(metaData,prop).orThunk((function(){return get$1(dims,prop)})).each((function(value){return dimensions[prop]=value}))}))})),dimensions}(data,metaData))},wrap=function(data){var wrapped=__assign(__assign({},data),{source:{value:get$1(data,"source").getOr("")},altsource:{value:get$1(data,"altsource").getOr("")},poster:{value:get$1(data,"poster").getOr("")}});return each$1(["width","height"],(function(prop){get$1(data,prop).each((function(value){var dimensions=wrapped.dimensions||{};dimensions[prop]=value,wrapped.dimensions=dimensions}))})),wrapped},handleError=function(editor){return function(error){var errorMessage=error&&error.msg?"Media embed handler error: "+error.msg:"Media embed handler threw unknown error.";editor.notificationManager.open({type:"error",text:errorMessage})}},snippetToData=function(editor,embedSnippet){return htmlToData(getScripts(editor),embedSnippet)},addEmbedHtml=function(api,editor){return function(response){if(isString(response.url)&&response.url.trim().length>0){var html=response.html,snippetData=snippetToData(editor,html),nuData=__assign(__assign({},snippetData),{source:response.url,embed:html});api.setData(wrap(nuData))}}},handleInsert=function(editor,html){var beforeObjects=editor.dom.select("*[data-mce-object]");editor.insertContent(html),function(editor,beforeObjects){for(var afterObjects=editor.dom.select("*[data-mce-object]"),i=0;i<beforeObjects.length;i++)for(var y=afterObjects.length-1;y>=0;y--)beforeObjects[i]===afterObjects[y]&&afterObjects.splice(y,1);editor.selection.select(afterObjects[0])}(editor,beforeObjects),editor.nodeChanged()},submitForm=function(prevData,newData,editor){var url;newData.embed=updateHtml(newData.embed,newData),newData.embed&&(prevData.source===newData.source||(url=newData.source,has(cache,url)))?handleInsert(editor,newData.embed):getEmbedHtml(editor,newData).then((function(response){handleInsert(editor,response.html)})).catch(handleError(editor))},showDialog=function(editor){var editorData=function(editor){var element=editor.selection.getNode(),snippet=isMediaElement(element)?editor.serializer.serialize(element,{selection:!0}):"";return __assign({embed:snippet},htmlToData(getScripts(editor),snippet))}(editor),currentData=Cell(editorData),initialData=wrap(editorData),sizeInput=function(editor){return editor.getParam("media_dimensions",!0)}(editor)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],generalTab={title:"General",name:"general",items:flatten([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],sizeInput])},embedTab={title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]},advancedFormItems=[];(function(editor){return editor.getParam("media_alt_source",!0)})(editor)&&advancedFormItems.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),function(editor){return editor.getParam("media_poster",!0)}(editor)&&advancedFormItems.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});var advancedTab={title:"Advanced",name:"advanced",items:advancedFormItems},tabs=[generalTab,embedTab];advancedFormItems.length>0&&tabs.push(advancedTab);var body={type:"tabpanel",tabs:tabs},win=editor.windowManager.open({title:"Insert/Edit Media",size:"normal",body:body,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(api){var serviceData=unwrap(api.getData());submitForm(currentData.get(),serviceData,editor),api.close()},onChange:function(api,detail){switch(detail.name){case"source":!function(prevData,api){var serviceData=unwrap(api.getData(),"source");prevData.source!==serviceData.source&&(addEmbedHtml(win,editor)({url:serviceData.source,html:""}),getEmbedHtml(editor,serviceData).then(addEmbedHtml(win,editor)).catch(handleError(editor)))}(currentData.get(),api);break;case"embed":!function(api){var data=unwrap(api.getData()),dataFromEmbed=snippetToData(editor,data.embed);api.setData(wrap(dataFromEmbed))}(api);break;case"dimensions":case"altsource":case"poster":!function(api,sourceInput){var data=unwrap(api.getData(),sourceInput),embed=dataToHtml(editor,data);api.setData(wrap(__assign(__assign({},data),{embed:embed})))}(api,detail.name)}currentData.set(unwrap(api.getData()))},initialData:initialData})},global$2=tinymce.util.Tools.resolve("tinymce.html.Node"),global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.html.DomParser"),sanitize=function(editor,html){if(!1===function(editor){return editor.getParam("media_filter_html",!0)}(editor))return html;var blocked,writer=global$4();return global$6({validate:!1,allow_conditional_comments:!1,comment:function(text){blocked||writer.comment(text)},cdata:function(text){blocked||writer.cdata(text)},text:function(text,raw){blocked||writer.text(text,raw)},start:function(name,attrs,empty){if(blocked=!0,"script"!==name&&"noscript"!==name&&"svg"!==name){for(var i=attrs.length-1;i>=0;i--){var attrName=attrs[i].name;0===attrName.indexOf("on")&&(delete attrs.map[attrName],attrs.splice(i,1)),"style"===attrName&&(attrs[i].value=editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value),name))}writer.start(name,attrs,empty),blocked=!1}},end:function(name){blocked||writer.end(name)}},global$5({})).parse(html),writer.getContent()},isLiveEmbedNode=function(node){var name=node.name;return"iframe"===name||"video"===name||"audio"===name},getDimension=function(node,styles,dimension,defaultValue){void 0===defaultValue&&(defaultValue=null);var value=node.attr(dimension);return isNonNullable(value)?value:has(styles,dimension)?null:defaultValue},setDimensions=function(node,previewNode,styles){var useDefaults="img"===previewNode.name||"video"===node.name,defaultWidth=useDefaults?"300":null,fallbackHeight="audio"===node.name?"30":"150",defaultHeight=useDefaults?fallbackHeight:null;previewNode.attr({width:getDimension(node,styles,"width",defaultWidth),height:getDimension(node,styles,"height",defaultHeight)})},createPlaceholderNode=function(editor,node){var name=node.name,placeHolder=new global$2("img",1);return placeHolder.shortEnded=!0,retainAttributesAndInnerHtml(editor,node,placeHolder),setDimensions(node,placeHolder,{}),placeHolder.attr({style:node.attr("style"),src:global$1.transparentSrc,"data-mce-object":name,class:"mce-object mce-object-"+name}),placeHolder},createPreviewNode=function(editor,node){var name=node.name,previewWrapper=new global$2("span",1);previewWrapper.attr({contentEditable:"false",style:node.attr("style"),"data-mce-object":name,class:"mce-preview-object mce-object-"+name}),retainAttributesAndInnerHtml(editor,node,previewWrapper);var styles=editor.dom.parseStyle(node.attr("style")),previewNode=new global$2(name,1);if(setDimensions(node,previewNode,styles),previewNode.attr({src:node.attr("src"),style:node.attr("style"),class:node.attr("class")}),"iframe"===name)previewNode.attr({allowfullscreen:node.attr("allowfullscreen"),frameborder:"0"});else{each$1(["controls","crossorigin","currentTime","loop","muted","poster","preload"],(function(attrName){previewNode.attr(attrName,node.attr(attrName))}));var sanitizedHtml=previewWrapper.attr("data-mce-html");isNonNullable(sanitizedHtml)&&function(editor,nodeName,previewNode,html){for(var newNode=global({forced_root_block:!1,validate:!1},editor.schema).parse(html,{context:nodeName});newNode.firstChild;)previewNode.append(newNode.firstChild)}(editor,name,previewNode,unescape(sanitizedHtml))}var shimNode=new global$2("span",1);return shimNode.attr("class","mce-shim"),previewWrapper.append(previewNode),previewWrapper.append(shimNode),previewWrapper},retainAttributesAndInnerHtml=function(editor,sourceNode,targetNode){for(var attribs=sourceNode.attributes,ai=attribs.length;ai--;){var attrName=attribs[ai].name,attrValue=attribs[ai].value;"width"!==attrName&&"height"!==attrName&&"style"!==attrName&&("data"!==attrName&&"src"!==attrName||(attrValue=editor.convertURL(attrValue,attrName)),targetNode.attr("data-mce-p-"+attrName,attrValue))}var innerHtml=sourceNode.firstChild&&sourceNode.firstChild.value;innerHtml&&(targetNode.attr("data-mce-html",escape(sanitize(editor,innerHtml))),targetNode.firstChild=null)},isPageEmbedWrapper=function(node){var nodeClass=node.attr("class");return nodeClass&&/\btiny-pageembed\b/.test(nodeClass)},isWithinEmbedWrapper=function(node){for(;node=node.parent;)if(node.attr("data-ephox-embed-iri")||isPageEmbedWrapper(node))return!0;return!1},setup$1=function(editor){editor.on("preInit",(function(){var specialElements=editor.schema.getSpecialElements();global$8.each("video audio iframe object".split(" "),(function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}));var boolAttrs=editor.schema.getBoolAttrs();global$8.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),(function(name){boolAttrs[name]={}})),editor.parser.addNodeFilter("iframe,video,audio,object,embed,script",function(editor){return function(nodes){for(var node,videoScript,i=nodes.length;i--;)(node=nodes[i]).parent&&(node.parent.attr("data-mce-object")||("script"!==node.name||(videoScript=getVideoScriptMatch(getScripts(editor),node.attr("src"))))&&(videoScript&&(videoScript.width&&node.attr("width",videoScript.width.toString()),videoScript.height&&node.attr("height",videoScript.height.toString())),isLiveEmbedNode(node)&&hasLiveEmbeds(editor)&&global$1.ceFalse?isWithinEmbedWrapper(node)||node.replace(createPreviewNode(editor,node)):isWithinEmbedWrapper(node)||node.replace(createPlaceholderNode(editor,node))))}}(editor)),editor.serializer.addAttributeFilter("data-mce-object",(function(nodes,name){for(var node,realElm,ai,attribs,innerHtml,innerNode,realElmName,className,i=nodes.length;i--;)if((node=nodes[i]).parent){for(realElmName=node.attr(name),realElm=new global$2(realElmName,1),"audio"!==realElmName&&"script"!==realElmName&&((className=node.attr("class"))&&-1!==className.indexOf("mce-preview-object")?realElm.attr({width:node.firstChild.attr("width"),height:node.firstChild.attr("height")}):realElm.attr({width:node.attr("width"),height:node.attr("height")})),realElm.attr({style:node.attr("style")}),ai=(attribs=node.attributes).length;ai--;){var attrName=attribs[ai].name;0===attrName.indexOf("data-mce-p-")&&realElm.attr(attrName.substr(11),attribs[ai].value)}"script"===realElmName&&realElm.attr("type","text/javascript"),(innerHtml=node.attr("data-mce-html"))&&((innerNode=new global$2("#text",3)).raw=!0,innerNode.value=sanitize(editor,unescape(innerHtml)),realElm.append(innerNode)),node.replace(realElm)}}))})),editor.on("SetContent",(function(){editor.$("span.mce-preview-object").each((function(index,elm){var $elm=editor.$(elm);0===$elm.find("span.mce-shim").length&&$elm.append('<span class="mce-shim"></span>')}))}))};!function Plugin(){global$9.add("media",(function(editor){return function(editor){editor.addCommand("mceMedia",(function(){showDialog(editor)}))}(editor),function(editor){var onAction=function(){return editor.execCommand("mceMedia")};editor.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:onAction,onSetup:function(buttonApi){var selection=editor.selection;return buttonApi.setActive(isMediaElement(selection.getNode())),selection.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",buttonApi.setActive).unbind}}),editor.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:onAction})}(editor),function(editor){editor.on("ResolveName",(function(e){var name;1===e.target.nodeType&&(name=e.target.getAttribute("data-mce-object"))&&(e.name=name)}))}(editor),setup$1(editor),function(editor){editor.on("click keyup touchend",(function(){var selectedNode=editor.selection.getNode();selectedNode&&editor.dom.hasClass(selectedNode,"mce-preview-object")&&editor.dom.getAttrib(selectedNode,"data-mce-selected")&&selectedNode.setAttribute("data-mce-selected","2")})),editor.on("ObjectSelected",(function(e){"script"===e.target.getAttribute("data-mce-object")&&e.preventDefault()})),editor.on("ObjectResized",(function(e){var target=e.target;if(target.getAttribute("data-mce-object")){var html=target.getAttribute("data-mce-html");html&&(html=unescape(html),target.setAttribute("data-mce-html",escape(updateHtml(html,{width:String(e.width),height:String(e.height)}))))}}))}(editor),function(editor){return{showDialog:function(){showDialog(editor)}}}(editor)}))}()}();