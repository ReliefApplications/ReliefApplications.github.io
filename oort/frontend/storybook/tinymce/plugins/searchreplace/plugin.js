!function(){"use strict";var call,id,Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},global$3=tinymce.util.Tools.resolve("tinymce.PluginManager"),__assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},isType$1=function(type){return function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}},isSimpleType=function(type){return function(value){return typeof value===type}},isString=isType$1("string"),isArray=isType$1("array"),isBoolean=isSimpleType("boolean"),isNumber=isSimpleType("number"),noop=function(){},constant=function(value){return function(){return value}},identity=function(x){return x},never=constant(!1),always=constant(!0),punctuation$1=constant("[!-#%-*,-\\/:;?@\\[-\\]_{}¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]"),none=function(){return NONE},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant("none()")},some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some,none,from:function(value){return null==value?NONE:some(value)}},punctuation=punctuation$1,global$2=tinymce.util.Tools.resolve("tinymce.Env"),global$1=tinymce.util.Tools.resolve("tinymce.util.Tools"),nativeSlice=Array.prototype.slice,nativePush=Array.prototype.push,map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i)}},eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--){f(xs[i],i)}},bind=function(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map(xs,f))},hasOwnProperty=Object.hasOwnProperty,has=function(obj,key){return hasOwnProperty.call(obj,key)};"undefined"!=typeof window?window:Function("return this;")();var t,is,name,getOption,isText$1=(t=3,function(element){return function(element){return element.dom.nodeType}(element)===t}),set=function(element,key,value){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(element.dom,key,value)},fromDom=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},SugarElement={fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom(node)},fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}},spot=function(element,offset){return{element,offset}},leaf=function(element,offset){var cs=function(element){return map(element.dom.childNodes,SugarElement.fromDom)}(element);return cs.length>0&&offset<cs.length?spot(cs[offset],0):spot(element,offset)},before=function(marker,element){var parent$1=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)}(marker);parent$1.each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},wrap=function(element,wrapper){before(element,wrapper),function(parent,element){parent.dom.appendChild(element.dom)}(wrapper,element)},api=(is=isText$1,name="text",{get:function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption:getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()},set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}),get$1=function(element){return api.get(element)},descendants=function(scope,selector){return function(selector,scope){var dom,base=void 0===scope?document:scope.dom;return 1!==(dom=base).nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount?[]:map(base.querySelectorAll(selector),SugarElement.fromDom)}(selector,scope)},global=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),isSimpleBoundary=function(dom,node){return dom.isBlock(node)||has(dom.schema.getShortEndedElements(),node.nodeName)},isContentEditableFalse=function(dom,node){return"false"===dom.getContentEditable(node)},isHidden=function(dom,node){return!dom.isBlock(node)&&has(dom.schema.getWhiteSpaceElements(),node.nodeName)},toLeaf=function(node,offset){return leaf(SugarElement.fromDom(node),offset)},walk=function(dom,walkerFn,startNode,callbacks,endNode,skipStart){void 0===skipStart&&(skipStart=!0);for(var next=skipStart?walkerFn(!1):startNode;next;){var isCefNode=isContentEditableFalse(dom,next);if(isCefNode||isHidden(dom,next)){if(isCefNode?callbacks.cef(next):callbacks.boundary(next))break;next=walkerFn(!0)}else{if(isSimpleBoundary(dom,next)){if(callbacks.boundary(next))break}else 3===next.nodeType&&callbacks.text(next);if(next===endNode)break;next=walkerFn(!1)}}},collectTextToBoundary=function(dom,section,node,rootNode,forwards){if(!function(dom,node){return isSimpleBoundary(dom,node)||isContentEditableFalse(dom,node)||isHidden(dom,node)||function(dom,node){return"true"===dom.getContentEditable(node)&&"false"===dom.getContentEditableParent(node.parentNode)}(dom,node)}(dom,node)){var rootBlock=dom.getParent(rootNode,dom.isBlock),walker=new global(node,rootBlock),walkerFn=forwards?walker.next.bind(walker):walker.prev.bind(walker);walk(dom,walkerFn,node,{boundary:always,cef:always,text:function(next){forwards?section.fOffset+=next.length:section.sOffset+=next.length,section.elements.push(SugarElement.fromDom(next))}})}},collect=function(dom,rootNode,startNode,endNode,callbacks,skipStart){void 0===skipStart&&(skipStart=!0);var walker=new global(startNode,rootNode),sections=[],current={sOffset:0,fOffset:0,elements:[]};collectTextToBoundary(dom,current,startNode,rootNode,!1);var finishSection=function(){return current.elements.length>0&&(sections.push(current),current={sOffset:0,fOffset:0,elements:[]}),!1};return walk(dom,walker.next.bind(walker),startNode,{boundary:finishSection,cef:function(node){return finishSection(),callbacks&&sections.push.apply(sections,callbacks.cef(node)),!1},text:function(next){current.elements.push(SugarElement.fromDom(next)),callbacks&&callbacks.text(next,current)}},endNode,skipStart),endNode&&collectTextToBoundary(dom,current,endNode,rootNode,!0),finishSection(),sections},collectRangeSections=function(dom,rng){var start=toLeaf(rng.startContainer,rng.startOffset),startNode=start.element.dom,end=toLeaf(rng.endContainer,rng.endOffset),endNode=end.element.dom;return collect(dom,rng.commonAncestorContainer,startNode,endNode,{text:function(node,section){node===endNode?section.fOffset+=node.length-end.offset:node===startNode&&(section.sOffset+=start.offset)},cef:function(node){var xs,comparator,copy,sections=bind(descendants(SugarElement.fromDom(node),"*[contenteditable=true]"),(function(e){var ceTrueNode=e.dom;return collect(dom,ceTrueNode,ceTrueNode)}));return xs=sections,comparator=function(a,b){return function(a,b){return function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(a,b,Node.DOCUMENT_POSITION_PRECEDING)}(a.elements[0].dom,b.elements[0].dom)?1:-1},(copy=nativeSlice.call(xs,0)).sort(comparator),copy}},!1)},fromRng=function(dom,rng){return rng.collapsed?[]:collectRangeSections(dom,rng)},fromNode=function(dom,node){var rng=dom.createRng();return rng.selectNode(node),fromRng(dom,rng)},extract=function(elements,matches){var xs,f,acc,nodePositions=(xs=elements,f=function(acc,element){var content=get$1(element),start=acc.last,finish=start+content.length,positions=bind(matches,(function(match,matchIdx){return match.start<finish&&match.finish>start?[{element,start:Math.max(start,match.start)-start,finish:Math.min(finish,match.finish)-start,matchId:matchIdx}]:[]}));return{results:acc.results.concat(positions),last:finish}},acc={results:[],last:0},each(xs,(function(x,i){acc=f(acc,x,i)})),acc).results;return function(xs,f){if(0===xs.length)return[];for(var wasType=f(xs[0]),r=[],group=[],i=0,len=xs.length;i<len;i++){var x=xs[i],type=f(x);type!==wasType&&(r.push(group),group=[]),wasType=type,group.push(x)}return 0!==group.length&&r.push(group),r}(nodePositions,(function(position){return position.matchId}))},find$1=function(pattern,sections){return bind(sections,(function(section){var elements=section.elements,content=map(elements,get$1).join(""),positions=function(text,pattern,start,finish){void 0===start&&(start=0),void 0===finish&&(finish=text.length);var regex=pattern.regex;regex.lastIndex=start;for(var match,results=[];match=regex.exec(text);){var matchedText=match[pattern.matchIndex],matchStart=match.index+match[0].indexOf(matchedText),matchFinish=matchStart+matchedText.length;if(matchFinish>finish)break;results.push({start:matchStart,finish:matchFinish}),regex.lastIndex=matchFinish}return results}(content,pattern,section.sOffset,content.length-section.fOffset);return extract(elements,positions)}))},mark=function(matches,replacementNode){eachr(matches,(function(match,idx){eachr(match,(function(pos){var wrapper=SugarElement.fromDom(replacementNode.cloneNode(!1));set(wrapper,"data-mce-index",idx);var textNode=pos.element.dom;if(textNode.length===pos.finish&&0===pos.start)wrap(pos.element,wrapper);else{textNode.length!==pos.finish&&textNode.splitText(pos.finish);var matchNode=textNode.splitText(pos.start);wrap(SugarElement.fromDom(matchNode),wrapper)}}))}))},findAndMarkInSelection=function(dom,pattern,selection,replacementNode){var bookmark=selection.getBookmark(),nodes=dom.select("td[data-mce-selected],th[data-mce-selected]"),textSections=nodes.length>0?function(dom,nodes){return bind(nodes,(function(node){return fromNode(dom,node)}))}(dom,nodes):fromRng(dom,selection.getRng()),matches=find$1(pattern,textSections);return mark(matches,replacementNode),selection.moveToBookmark(bookmark),matches.length},getElmIndex=function(elm){var value=elm.getAttribute("data-mce-index");return"number"==typeof value?""+value:value},markAllMatches=function(editor,currentSearchState,pattern,inSelection){var marker=editor.dom.create("span",{"data-mce-bogus":1});marker.className="mce-match-marker";var node=editor.getBody();return done(editor,currentSearchState,!1),inSelection?findAndMarkInSelection(editor.dom,pattern,editor.selection,marker):function(dom,pattern,node,replacementNode){var textSections=fromNode(dom,node),matches=find$1(pattern,textSections);return mark(matches,replacementNode),matches.length}(editor.dom,pattern,node,marker)},unwrap=function(node){var parentNode=node.parentNode;node.firstChild&&parentNode.insertBefore(node.firstChild,node),node.parentNode.removeChild(node)},findSpansByIndex=function(editor,index){var spans=[],nodes=global$1.toArray(editor.getBody().getElementsByTagName("span"));if(nodes.length)for(var i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&(nodeIndex===index.toString()&&spans.push(nodes[i]))}return spans},moveSelection=function(editor,currentSearchState,forward){var searchState=currentSearchState.get(),testIndex=searchState.index,dom=editor.dom;(forward=!1!==forward)?testIndex+1===searchState.count?testIndex=0:testIndex++:testIndex-1==-1?testIndex=searchState.count-1:testIndex--,dom.removeClass(findSpansByIndex(editor,searchState.index),"mce-match-marker-selected");var spans=findSpansByIndex(editor,testIndex);return spans.length?(dom.addClass(findSpansByIndex(editor,testIndex),"mce-match-marker-selected"),editor.selection.scrollIntoView(spans[0]),testIndex):-1},removeNode=function(dom,node){var parent=node.parentNode;dom.remove(node),dom.isEmpty(parent)&&dom.remove(parent)},find=function(editor,currentSearchState,text,matchCase,wholeWord,inSelection){var selection=editor.selection,escapedText=function(text,wholeWord){var wordRegex="("+text.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return wholeWord?"(?:^|\\s|"+punctuation()+")"+wordRegex+"(?=$|\\s|"+punctuation()+")":wordRegex}(text,wholeWord),isForwardSelection=selection.isForward(),pattern={regex:new RegExp(escapedText,matchCase?"g":"gi"),matchIndex:1},count=markAllMatches(editor,currentSearchState,pattern,inSelection);if(global$2.browser.isSafari()&&selection.setRng(selection.getRng(),isForwardSelection),count){var newIndex=moveSelection(editor,currentSearchState,!0);currentSearchState.set({index:newIndex,count,text,matchCase,wholeWord,inSelection})}return count},next=function(editor,currentSearchState){var index=moveSelection(editor,currentSearchState,!0);currentSearchState.set(__assign(__assign({},currentSearchState.get()),{index}))},prev=function(editor,currentSearchState){var index=moveSelection(editor,currentSearchState,!1);currentSearchState.set(__assign(__assign({},currentSearchState.get()),{index}))},isMatchSpan=function(node){var matchIndex=getElmIndex(node);return null!==matchIndex&&matchIndex.length>0},replace=function(editor,currentSearchState,text,forward,all){var currentMatchIndex,searchState=currentSearchState.get(),currentIndex=searchState.index,nextIndex=currentIndex;forward=!1!==forward;for(var node=editor.getBody(),nodes=global$1.grep(global$1.toArray(node.getElementsByTagName("span")),isMatchSpan),i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]),matchIndex=currentMatchIndex=parseInt(nodeIndex,10);if(all||matchIndex===searchState.index){for(text.length?(nodes[i].firstChild.nodeValue=text,unwrap(nodes[i])):removeNode(editor.dom,nodes[i]);nodes[++i];){if((matchIndex=parseInt(getElmIndex(nodes[i]),10))!==currentMatchIndex){i--;break}removeNode(editor.dom,nodes[i])}forward&&nextIndex--}else currentMatchIndex>currentIndex&&nodes[i].setAttribute("data-mce-index",String(currentMatchIndex-1))}return currentSearchState.set(__assign(__assign({},searchState),{count:all?0:searchState.count-1,index:nextIndex})),forward?next(editor,currentSearchState):prev(editor,currentSearchState),!all&&currentSearchState.get().count>0},done=function(editor,currentSearchState,keepEditorSelection){for(var startContainer,endContainer,searchState=currentSearchState.get(),nodes=global$1.toArray(editor.getBody().getElementsByTagName("span")),i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&(nodeIndex===searchState.index.toString()&&(startContainer||(startContainer=nodes[i].firstChild),endContainer=nodes[i].firstChild),unwrap(nodes[i]))}if(currentSearchState.set(__assign(__assign({},searchState),{index:-1,count:0,text:""})),startContainer&&endContainer){var rng=editor.dom.createRng();return rng.setStart(startContainer,0),rng.setEnd(endContainer,endContainer.data.length),!1!==keepEditorSelection&&editor.selection.setRng(rng),rng}},value=function(){var subject=function(doRevoke){var subject=Cell(Optional.none()),revoke=function(){return subject.get().each(doRevoke)};return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}}(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},open=function(editor,currentSearchState){var dialogApi=value();editor.undoManager.add();var selectedText=global$1.trim(editor.selection.getContent({format:"text"})),updateButtonStates=function(api){var updateNext=function(editor,currentSearchState){return currentSearchState.get().count>1}(0,currentSearchState)?api.enable:api.disable;updateNext("next");var updatePrev=function(editor,currentSearchState){return currentSearchState.get().count>1}(0,currentSearchState)?api.enable:api.disable;updatePrev("prev")},disableAll=function(api,disable){var toggle=disable?api.disable:api.enable;each(["replace","replaceall","prev","next"],toggle)},focusButtonIfRequired=function(api,name){global$2.browser.isSafari()&&global$2.deviceType.isTouch()&&("find"===name||"replace"===name||"replaceall"===name)&&api.focus(name)},reset=function(api){done(editor,currentSearchState,!1),disableAll(api,!0),updateButtonStates(api)},doFind=function(api){var data=api.getData(),last=currentSearchState.get();if(data.findtext.length){if(last.text===data.findtext&&last.matchCase===data.matchcase&&last.wholeWord===data.wholewords)next(editor,currentSearchState);else{var count=find(editor,currentSearchState,data.findtext,data.matchcase,data.wholewords,data.inselection);count<=0&&function(api){editor.windowManager.alert("Could not find the specified string.",(function(){api.focus("findtext")}))}(api),disableAll(api,0===count)}updateButtonStates(api)}else reset(api)},initialState=currentSearchState.get(),spec={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace all",disabled:!0}],initialData:{findtext:selectedText,replacetext:"",wholewords:initialState.wholeWord,matchcase:initialState.matchCase,inselection:initialState.inSelection},onChange:function(api,details){"findtext"===details.name&&currentSearchState.get().count>0&&reset(api)},onAction:function(api,details){var data=api.getData();switch(details.name){case"find":doFind(api);break;case"replace":replace(editor,currentSearchState,data.replacetext)?updateButtonStates(api):reset(api);break;case"replaceall":replace(editor,currentSearchState,data.replacetext,!0,!0),reset(api);break;case"prev":prev(editor,currentSearchState),updateButtonStates(api);break;case"next":next(editor,currentSearchState),updateButtonStates(api);break;case"matchcase":case"wholewords":case"inselection":!function(api){var data=api.getData(),current=currentSearchState.get();currentSearchState.set(__assign(__assign({},current),{matchCase:data.matchcase,wholeWord:data.wholewords,inSelection:data.inselection}))}(api),reset(api)}focusButtonIfRequired(api,details.name)},onSubmit:function(api){doFind(api),focusButtonIfRequired(api,"find")},onClose:function(){editor.focus(),done(editor,currentSearchState),editor.undoManager.add()}};dialogApi.set(editor.windowManager.open(spec,{inline:"toolbar"}))},showDialog=function(editor,currentSearchState){return function(){open(editor,currentSearchState)}};!function Plugin(){global$3.add("searchreplace",(function(editor){var currentSearchState=Cell({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return function(editor,currentSearchState){editor.addCommand("SearchReplace",(function(){open(editor,currentSearchState)}))}(editor,currentSearchState),function(editor,currentSearchState){editor.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:showDialog(editor,currentSearchState),icon:"search"}),editor.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:showDialog(editor,currentSearchState),icon:"search"}),editor.shortcuts.add("Meta+F","",showDialog(editor,currentSearchState))}(editor,currentSearchState),function(editor,currentState){return{done:function(keepEditorSelection){return done(editor,currentState,keepEditorSelection)},find:function(text,matchCase,wholeWord,inSelection){return void 0===inSelection&&(inSelection=!1),find(editor,currentState,text,matchCase,wholeWord,inSelection)},next:function(){return next(editor,currentState)},prev:function(){return prev(editor,currentState)},replace:function(text,forward,all){return replace(editor,currentState,text,forward,all)}}}(editor,currentSearchState)}))}()}();