!function(){"use strict";var isType$1=function(type){return function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}},isSimpleType=function(type){return function(value){return typeof value===type}},eq$2=function(t){return function(a){return t===a}},isString=isType$1("string"),isObject=isType$1("object"),isArray=isType$1("array"),isNull=eq$2(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$2(void 0),isNonNullable=function(a){return!function(a){return null==a}(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),noop=function(){},constant=function(value){return function(){return value}},identity=function(x){return x},tripleEquals=function(a,b){return a===b};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var call,id,not=function(f){return function(t){return!f(t)}},never=constant(!1),always=constant(!0),none$2=function(){return NONE},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none$2,each:noop,bind:none$2,exists:never,forall:always,filter:function(){return none$2()},toArray:function(){return[]},toString:constant("none()")},some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some:some,none:none$2,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,contains$2=function(xs,x){return ts=xs,t=x,nativeIndexOf.call(ts,t)>-1;var ts,t},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return!0}return!1},range$1=function(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r},map$1=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$2=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i)}},partition=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter$2=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return function(xs,f){for(var i=xs.length-1;i>=0;i--)f(xs[i],i)}(xs,(function(x,i){acc=f(acc,x,i)})),acc},foldl=function(xs,f,acc){return each$2(xs,(function(x,i){acc=f(acc,x,i)})),acc},find$1=function(xs,pred){return function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()}(xs,pred,never)},findIndex=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},flatten$1=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind$2=function(xs,f){return flatten$1(map$1(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){if(!0!==pred(xs[i],i))return!1}return!0},mapToObject=function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},pure=function(x){return[x]},get$d=function(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get$d(xs,0)},last$2=function(xs){return get$d(xs,xs.length-1)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}var cached=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},unknown$2=function(){return nu$2(0,0)},nu$2=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$2,detect:function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown$2():function(regexes,agent){var r=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}}(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu$2(group(1),group(2))}(versionRegexes,cleanedAgent)},unknown:unknown$2},detect$5=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$1(candidates,(function(candidate){return candidate.search(agent)}))},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},contains$1=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return checkRange(str,prefix,0)},endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length)},trim=function(r){return function(s){return s.replace(r,"")}}(/^\s+|\s+$/g),isNotEmpty=function(s){return s.length>0},normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return contains$1(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(browsers),oses:constant(oses)},nu$1=function(info){var current=info.current,version=info.version,isBrowser=function(name){return function(){return current===name}};return{current:current,version:version,isEdge:isBrowser("Edge"),isChrome:isBrowser("Chrome"),isIE:isBrowser("IE"),isOpera:isBrowser("Opera"),isFirefox:isBrowser("Firefox"),isSafari:isBrowser("Safari")}},Browser={unknown:function(){return nu$1({current:void 0,version:Version.unknown()})},nu:nu$1,edge:constant("Edge"),chrome:constant("Chrome"),ie:constant("IE"),opera:constant("Opera"),firefox:constant("Firefox"),safari:constant("Safari")},nu=function(info){var current=info.current,version=info.version,isOS=function(name){return function(){return current===name}};return{current:current,version:version,isWindows:isOS("Windows"),isiOS:isOS("iOS"),isAndroid:isOS("Android"),isOSX:isOS("OSX"),isLinux:isOS("Linux"),isSolaris:isOS("Solaris"),isFreeBSD:isOS("FreeBSD"),isChromeOS:isOS("ChromeOS")}},OperatingSystem={unknown:function(){return nu({current:void 0,version:Version.unknown()})},nu:nu,windows:constant("Windows"),ios:constant("iOS"),android:constant("Android"),linux:constant("Linux"),osx:constant("OSX"),solaris:constant("Solaris"),freebsd:constant("FreeBSD"),chromeos:constant("ChromeOS")},PlatformDetection_detect=function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=userAgentDataOpt.bind((function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,(function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$1(browsers,(function(browser){var _a;return lcBrand===(null===(_a=browser.brand)||void 0===_a?void 0:_a.toLowerCase())})).map((function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}}))}))}(browsers,userAgentData)})).orThunk((function(){return function(browsers,userAgent){return detect$5(browsers,userAgent).map((function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}}))}(browsers,userAgent)})).fold(Browser.unknown,Browser.nu),os=function(oses,userAgent){return detect$5(oses,userAgent).map((function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}}))}(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)}}(os,browser,userAgent,mediaMatch);return{browser:browser,os:os,deviceType:deviceType}},mediaMatch=function(query){return window.matchMedia(query).matches},platform=cached((function(){return PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)})),detect$3=function(){return platform()},fromDom$1=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},SugarElement={fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom$1(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom$1(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom$1(node)},fromDom:fromDom$1,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$1)}},is$2=function(element,selector){var dom=element.dom;if(1!==dom.nodeType)return!1;var elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},bypassSelector=function(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount},one=function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)},eq$1=function(e1,e2){return e1.dom===e2.dom},ieContains=function(e1,e2){return a=e1.dom,b=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY);var a,b},contains=function(e1,e2){return detect$3().browser.isIE()?ieContains(e1,e2):function(e1,e2){var d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)}(e1,e2)},is$1=is$2,keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,each$1=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},map=function(obj,f){return tupleMap(obj,(function(x,i){return{k:i,v:f(x,i)}}))},tupleMap=function(obj,f){var r={};return each$1(obj,(function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v})),r},filter$1=function(obj,pred){var t={};return function(obj,pred,onTrue,onFalse){each$1(obj,(function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)}))}(obj,pred,function(r){return function(x,i){r[i]=x}}(t),noop),t},mapToArray=function(obj,f){var r=[];return each$1(obj,(function(value,name){r.push(f(value,name))})),r},values=function(obj){return mapToArray(obj,identity)},size=function(obj){return keys(obj).length},get$c=function(obj,key){return has$1(obj,key)?Optional.from(obj[key]):Optional.none()},has$1=function(obj,key){return hasOwnProperty.call(obj,key)},hasNonNullableKey=function(obj,key){return has$1(obj,key)&&void 0!==obj[key]&&null!==obj[key]},validSectionList=["tfoot","thead","tbody","colgroup"],detail=function(element,rowspan,colspan){return{element:element,rowspan:rowspan,colspan:colspan}},rowdetail=function(element,cells,section){return{element:element,cells:cells,section:section}},elementnew=function(element,isNew,isLocked){return{element:element,isNew:isNew,isLocked:isLocked}},rowcells=function(element,cells,section,isNew){return{element:element,cells:cells,section:section,isNew:isNew}};"undefined"!=typeof window?window:Function("return this;")();var name=function(element){return element.dom.nodeName.toLowerCase()},type$1=function(element){return element.dom.nodeType},isType=function(t){return function(element){return type$1(element)===t}},isComment=function(element){return 8===type$1(element)||"#comment"===name(element)},isElement=isType(1),isText=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),isTag=function(tag){return function(e){return isElement(e)&&name(e)===tag}},owner=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument(dos)?dos:owner(dos)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},parents=function(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret},prevSibling=function(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom)},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},children$3=function(element){return map$1(element.dom.childNodes,SugarElement.fromDom)},child$3=function(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported$1=constant(supported),getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getShadowRoot=function(e){var dos,r=getRootNode(e);return isDocumentFragment(dos=r)&&isNonNullable(dos.dom.host)?Optional.some(r):Optional.none()},getShadowHost=function(e){return SugarElement.fromDom(e.dom.host)},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},inBody=function(element){var dom=isText(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var fbc,fab,doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold((function(){return doc.body.contains(dom)}),(fbc=inBody,fab=getShadowHost,function(a){return fbc(fab(a))}))},getBody$1=function(doc){var b=doc.dom.body;if(null==b)throw new Error("Body is not available yet");return SugarElement.fromDom(b)},descendants$1=function(scope,predicate){var result=[];return each$2(children$3(scope),(function(x){predicate(x)&&(result=result.concat([x])),result=result.concat(descendants$1(x,predicate))})),result},ancestors$3=function(scope,selector,isRoot){return function(scope,predicate,isRoot){return filter$2(parents(scope,isRoot),predicate)}(scope,(function(e){return is$2(e,selector)}),isRoot)},children$1=function(scope,selector){return function(scope,predicate){return filter$2(children$3(scope),predicate)}(scope,(function(e){return is$2(e,selector)}))},descendants=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map$1(base.querySelectorAll(selector),SugarElement.fromDom)}(selector,scope)};function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}var ancestor$2=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},ancestor$1=function(scope,selector,isRoot){return ancestor$2(scope,(function(e){return is$2(e,selector)}),isRoot)},child$1=function(scope,selector){return function(scope,predicate){return find$1(scope.dom.childNodes,(function(node){return predicate(SugarElement.fromDom(node))})).map(SugarElement.fromDom)}(scope,(function(e){return is$2(e,selector)}))},descendant=function(scope,selector){return one(selector,scope)},closest$1=function(scope,selector,isRoot){return ClosestOrAncestor((function(element,selector){return is$2(element,selector)}),ancestor$1,scope,selector,isRoot)},rawSet=function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$2=function(element,key,value){rawSet(element.dom,key,value)},setAll$1=function(element,attrs){var dom=element.dom;each$1(attrs,(function(v,k){rawSet(dom,k,v)}))},get$b=function(element,key){var v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=function(element,key){return Optional.from(get$b(element,key))},remove$7=function(element,key){element.dom.removeAttribute(key)},clone$2=function(element){return foldl(element.dom.attributes,(function(acc,attr){return acc[attr.name]=attr.value,acc}),{})},is=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists((function(left){return comparator(left,rhs)}))},cat=function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},someIf=function(b,a){return b?Optional.some(a):Optional.none()},isSupported=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported(dom)&&dom.style.setProperty(property,value)},set$1=function(element,property,value){var dom=element.dom;internalSet(dom,property,value)},setAll=function(element,css){var dom=element.dom;each$1(css,(function(v,k){internalSet(dom,k,v)}))},get$a=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):""},getRaw$2=function(element,property){var dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((function(r){return r.length>0}))},remove$6=function(element,property){!function(dom,property){isSupported(dom)&&dom.style.removeProperty(property)}(element.dom,property),is(getOpt(element,"style").map(trim),"")&&remove$7(element,"style")},getAttrValue=function(cell,name,fallback){return void 0===fallback&&(fallback=0),getOpt(cell,name).map((function(value){return parseInt(value,10)})).getOr(fallback)},getSpan=function(cell,type){return getAttrValue(cell,type,1)},hasColspan=function(cellOrCol){return isTag("col")(cellOrCol)?getAttrValue(cellOrCol,"span",1)>1:getSpan(cellOrCol,"colspan")>1},hasRowspan=function(cell){return getSpan(cell,"rowspan")>1},getCssValue=function(element,property){return parseInt(get$a(element,property),10)},minWidth=constant(10),minHeight=constant(10),firstLayer=function(scope,selector){return filterFirstLayer(scope,selector,always)},filterFirstLayer=function(scope,selector,predicate){return bind$2(children$3(scope),(function(x){return is$2(x,selector)?predicate(x)?[x]:[]:filterFirstLayer(x,selector,predicate)}))},cell=function(element,isRoot){return function(tags,element,isRoot){return void 0===isRoot&&(isRoot=never),isRoot(element)?Optional.none():contains$2(tags,name(element))?Optional.some(element):ancestor$1(element,tags.join(","),(function(elm){return is$2(elm,"table")||isRoot(elm)}))}(["td","th"],element,isRoot)},cells$1=function(ancestor){return firstLayer(ancestor,"th,td")},columns$1=function(ancestor){return is$2(ancestor,"colgroup")?children$1(ancestor,"col"):bind$2(columnGroups(ancestor),(function(columnGroup){return children$1(columnGroup,"col")}))},table=function(element,isRoot){return closest$1(element,"table",isRoot)},rows$1=function(ancestor){return firstLayer(ancestor,"tr")},columnGroups=function(ancestor){return table(ancestor).fold(constant([]),(function(table){return children$1(table,"colgroup")}))},fromRowsOrColGroups=function(elems,getSection){return map$1(elems,(function(row){if("colgroup"===name(row)){var cells=map$1(columns$1(row),(function(column){var colspan=getAttrValue(column,"span",1);return detail(column,1,colspan)}));return rowdetail(row,cells,"colgroup")}cells=map$1(cells$1(row),(function(cell){var rowspan=getAttrValue(cell,"rowspan",1),colspan=getAttrValue(cell,"colspan",1);return detail(cell,rowspan,colspan)}));return rowdetail(row,cells,getSection(row))}))},getParentSection=function(group){return parent(group).map((function(parent){var parentName=name(parent);return function(parentName){return contains$2(validSectionList,parentName)}(parentName)?parentName:"tbody"})).getOr("tbody")},fromTable$1=function(table){var rows=rows$1(table),elems=__spreadArray(__spreadArray([],columnGroups(table),!0),rows,!0);return fromRowsOrColGroups(elems,getParentSection)},addCells=function(gridRow,index,cells){var existingCells=gridRow.cells,before=existingCells.slice(0,index),after=existingCells.slice(index),newCells=before.concat(cells).concat(after);return setCells(gridRow,newCells)},addCell=function(gridRow,index,cell){return addCells(gridRow,index,[cell])},mutateCell=function(gridRow,index,cell){gridRow.cells[index]=cell},setCells=function(gridRow,cells){return rowcells(gridRow.element,cells,gridRow.section,gridRow.isNew)},getCell=function(gridRow,index){return gridRow.cells[index]},getCellElement=function(gridRow,index){return getCell(gridRow,index).element},cellLength=function(gridRow){return gridRow.cells.length},extractGridDetails=function(grid){var result=partition(grid,(function(row){return"colgroup"===row.section}));return{rows:result.fail,cols:result.pass}},clone$1=function(gridRow,cloneRow,cloneCell){var newCells=map$1(gridRow.cells,cloneCell);return rowcells(cloneRow(gridRow.element),newCells,gridRow.section,!0)},LOCKED_COL_ATTR="data-snooker-locked-cols",getLockedColumnsFromTable=function(table){return getOpt(table,LOCKED_COL_ATTR).bind((function(lockedColStr){return Optional.from(lockedColStr.match(/\d+/g))})).map((function(lockedCols){return mapToObject(lockedCols,always)}))},getLockedColumnsFromGrid=function(grid){var locked=foldl(extractGridDetails(grid).rows,(function(acc,row){return each$2(row.cells,(function(cell,idx){cell.isLocked&&(acc[idx]=!0)})),acc}),{});return function(xs,comparator){var copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy}(mapToArray(locked,(function(_val,key){return parseInt(key,10)})))},key=function(row,column){return row+","+column},filterItems=function(warehouse,predicate){var all=bind$2(warehouse.all,(function(r){return r.cells}));return filter$2(all,predicate)},generate$1=function(list){var access={},cells=[],lockedColumns=head(list).map((function(rowData){return rowData.element})).bind(table).bind(getLockedColumnsFromTable).getOr({}),maxRows=0,maxColumns=0,rowCount=0,_a=partition(list,(function(rowData){return"colgroup"===rowData.section})),colgroupRows=_a.pass,rows=_a.fail;each$2(rows,(function(rowData){var currentRow=[];each$2(rowData.cells,(function(rowCell){for(var start=0;void 0!==access[key(rowCount,start)];)start++;for(var isLocked=hasNonNullableKey(lockedColumns,start.toString()),current=function(element,rowspan,colspan,row,column,isLocked){return{element:element,rowspan:rowspan,colspan:colspan,row:row,column:column,isLocked:isLocked}}(rowCell.element,rowCell.rowspan,rowCell.colspan,rowCount,start,isLocked),occupiedColumnPosition=0;occupiedColumnPosition<rowCell.colspan;occupiedColumnPosition++)for(var occupiedRowPosition=0;occupiedRowPosition<rowCell.rowspan;occupiedRowPosition++){var columnPosition=start+occupiedColumnPosition,newpos=key(rowCount+occupiedRowPosition,columnPosition);access[newpos]=current,maxColumns=Math.max(maxColumns,columnPosition+1)}currentRow.push(current)})),maxRows++,cells.push(rowdetail(rowData.element,currentRow,rowData.section)),rowCount++}));var _b=last$2(colgroupRows).map((function(rowData){var columns=function(rowData){var columnsGroup={},index=0;return each$2(rowData.cells,(function(column){var colspan=column.colspan;range$1(colspan,(function(columnIndex){var colIndex=index+columnIndex;columnsGroup[colIndex]=function(element,colspan,column){return{element:element,colspan:colspan,column:column}}(column.element,colspan,colIndex)})),index+=colspan})),columnsGroup}(rowData);return{colgroups:[function(element,columns){return{element:element,columns:columns}}(rowData.element,values(columns))],columns:columns}})).getOrThunk((function(){return{colgroups:[],columns:{}}})),columns=_b.columns,colgroups=_b.colgroups;return{grid:function(rows,columns){return{rows:rows,columns:columns}}(maxRows,maxColumns),access:access,all:cells,columns:columns,colgroups:colgroups}},Warehouse={fromTable:function(table){var list=fromTable$1(table);return generate$1(list)},generate:generate$1,getAt:function(warehouse,row,column){return Optional.from(warehouse.access[key(row,column)])},findItem:function(warehouse,item,comparator){var filtered=filterItems(warehouse,(function(detail){return comparator(item,detail.element)}));return filtered.length>0?Optional.some(filtered[0]):Optional.none()},filterItems:filterItems,justCells:function(warehouse){return bind$2(warehouse.all,(function(w){return w.cells}))},justColumns:function(warehouse){return values(warehouse.columns)},hasColumns:function(warehouse){return keys(warehouse.columns).length>0},getColumnAt:function(warehouse,columnIndex){return Optional.from(warehouse.columns[columnIndex])}},inSelection=function(bounds,detail){var leftEdge=detail.column,rightEdge=detail.column+detail.colspan-1,topEdge=detail.row,bottomEdge=detail.row+detail.rowspan-1;return leftEdge<=bounds.finishCol&&rightEdge>=bounds.startCol&&topEdge<=bounds.finishRow&&bottomEdge>=bounds.startRow},isWithin=function(bounds,detail){return detail.column>=bounds.startCol&&detail.column+detail.colspan-1<=bounds.finishCol&&detail.row>=bounds.startRow&&detail.row+detail.rowspan-1<=bounds.finishRow},getAnyBox=function(warehouse,startCell,finishCell){var startCoords=Warehouse.findItem(warehouse,startCell,eq$1),finishCoords=Warehouse.findItem(warehouse,finishCell,eq$1);return startCoords.bind((function(sc){return finishCoords.map((function(fc){return detailA=sc,detailB=fc,startRow=Math.min(detailA.row,detailB.row),startCol=Math.min(detailA.column,detailB.column),finishRow=Math.max(detailA.row+detailA.rowspan-1,detailB.row+detailB.rowspan-1),finishCol=Math.max(detailA.column+detailA.colspan-1,detailB.column+detailB.colspan-1),{startRow:startRow,startCol:startCol,finishRow:finishRow,finishCol:finishCol};var detailA,detailB,startRow,startCol,finishRow,finishCol}))}))},getBox$1=function(warehouse,startCell,finishCell){return getAnyBox(warehouse,startCell,finishCell).bind((function(bounds){return function(warehouse,bounds){for(var isRect=!0,detailIsWithin=curry(isWithin,bounds),i=bounds.startRow;i<=bounds.finishRow;i++)for(var j=bounds.startCol;j<=bounds.finishCol;j++)isRect=isRect&&Warehouse.getAt(warehouse,i,j).exists(detailIsWithin);return isRect?Optional.some(bounds):Optional.none()}(warehouse,bounds)}))},intercepts$1=function(warehouse,start,finish){return getAnyBox(warehouse,start,finish).map((function(bounds){var inside=Warehouse.filterItems(warehouse,curry(inSelection,bounds));return map$1(inside,(function(detail){return detail.element}))}))},parentCell=function(warehouse,innerCell){return Warehouse.findItem(warehouse,innerCell,(function(c1,c2){return contains(c2,c1)})).map((function(detail){return detail.element}))},moveBy=function(cell,deltaRow,deltaColumn){return table(cell).bind((function(table){return function(warehouse,cell,row,column){return Warehouse.findItem(warehouse,cell,eq$1).bind((function(detail){var startRow=row>0?detail.row+detail.rowspan-1:detail.row,startCol=column>0?detail.column+detail.colspan-1:detail.column;return Warehouse.getAt(warehouse,startRow+row,startCol+column).map((function(d){return d.element}))}))}(getWarehouse(table),cell,deltaRow,deltaColumn)}))},intercepts=function(table,first,last){var warehouse=getWarehouse(table);return intercepts$1(warehouse,first,last)},nestedIntercepts=function(table,first,firstTable,last,lastTable){var warehouse=getWarehouse(table),optStartCell=eq$1(table,firstTable)?Optional.some(first):parentCell(warehouse,first),optLastCell=eq$1(table,lastTable)?Optional.some(last):parentCell(warehouse,last);return optStartCell.bind((function(startCell){return optLastCell.bind((function(lastCell){return intercepts$1(warehouse,startCell,lastCell)}))}))},getWarehouse=Warehouse.fromTable,before$4=function(marker,element){parent(marker).each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},after$5=function(marker,element){nextSibling(marker).fold((function(){parent(marker).each((function(v){append$1(v,element)}))}),(function(v){before$4(v,element)}))},prepend=function(parent,element){(function(element){return child$3(element,0)})(parent).fold((function(){append$1(parent,element)}),(function(v){parent.dom.insertBefore(element.dom,v.dom)}))},append$1=function(parent,element){parent.dom.appendChild(element.dom)},wrap=function(element,wrapper){before$4(element,wrapper),append$1(wrapper,element)},after$4=function(marker,elements){each$2(elements,(function(x,i){var e=0===i?marker:elements[i-1];after$5(e,x)}))},append=function(parent,elements){each$2(elements,(function(x){append$1(parent,x)}))},empty=function(element){element.dom.textContent="",each$2(children$3(element),(function(rogue){remove$5(rogue)}))},remove$5=function(element){var dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=function(wrapper){var marker,children=children$3(wrapper);children.length>0&&(marker=wrapper,each$2(children,(function(x){before$4(marker,x)}))),remove$5(wrapper)},api$2=function(is,name){var getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()};return{get:function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText,"text"),get$9=function(element){return api$2.get(element)},getOption=function(element){return api$2.getOption(element)},set=function(element,value){return api$2.set(element,value)},TagBoundaries=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function DomUniverse(){return{up:constant({selector:ancestor$1,closest:closest$1,predicate:ancestor$2,all:parents}),down:constant({selector:descendants,predicate:descendants$1}),styles:constant({get:get$a,getRaw:getRaw$2,set:set$1,remove:remove$6}),attrs:constant({get:get$b,set:set$2,remove:remove$7,copyTo:function(source,destination){var as=clone$2(source);setAll$1(destination,as)}}),insert:constant({before:before$4,after:after$5,afterAll:after$4,append:append$1,appendAll:append,prepend:prepend,wrap:wrap}),remove:constant({unwrap:unwrap,remove:remove$5}),create:constant({nu:SugarElement.fromTag,clone:function(element){return SugarElement.fromDom(element.dom.cloneNode(!1))},text:SugarElement.fromText}),query:constant({comparePosition:function(element,other){return element.dom.compareDocumentPosition(other.dom)},prevSibling:prevSibling,nextSibling:nextSibling}),property:constant({children:children$3,name:name,parent:parent,document:function(element){return documentOrOwner(element).dom},isText:isText,isComment:isComment,isElement:isElement,isSpecial:function(element){var tag=name(element);return contains$2(["script","noscript","iframe","noframes","noembed","title","style","textarea","xmp"],tag)},getLanguage:function(element){return isElement(element)?getOpt(element,"lang"):Optional.none()},getText:get$9,setText:set,isBoundary:function(element){return!!isElement(element)&&("body"===name(element)||contains$2(TagBoundaries,name(element)))},isEmptyTag:function(element){return!!isElement(element)&&contains$2(["br","img","hr","input"],name(element))},isNonEditable:function(element){return isElement(element)&&"false"===get$b(element,"contenteditable")}}),eq:eq$1,is:is$1}}var opt,unsignedDecimalLiteral,unsafeOne=function(universe,look,head,tail){var start=look(universe,head);return foldr(tail,(function(b,a){var current=look(universe,a);return commonElement(universe,b,current)}),start)},commonElement=function(universe,start,end){return start.bind((function(s){return end.filter(curry(universe.eq,s))}))},sharedOne$1=function(universe,look,elements){return elements.length>0?function(universe,look,elements,f){return f(universe,look,elements[0],elements.slice(1))}(universe,look,elements,unsafeOne):Optional.none()},ancestors$1=function(universe,start,end,isRoot){void 0===isRoot&&(isRoot=never);var ps1=[start].concat(universe.up().all(start)),ps2=[end].concat(universe.up().all(end)),prune=function(path){return findIndex(path,isRoot).fold((function(){return path}),(function(ind){return path.slice(0,ind+1)}))},pruned1=prune(ps1),pruned2=prune(ps2),shared=find$1(pruned1,(function(x){return exists(pruned2,function(universe,item){return curry(universe.eq,item)}(universe,x))}));return{firstpath:pruned1,secondpath:pruned2,shared:shared}},universe$3=DomUniverse(),sharedOne=function(look,elements){return sharedOne$1(universe$3,(function(_universe,element){return look(element)}),elements)},lookupTable=function(container){return ancestor$1(container,"table")},identify=function(start,finish,isRoot){var getIsRoot=function(rootTable){return function(element){return void 0!==isRoot&&isRoot(element)||eq$1(element,rootTable)}};return eq$1(start,finish)?Optional.some({boxes:Optional.some([start]),start:start,finish:finish}):lookupTable(start).bind((function(startTable){return lookupTable(finish).bind((function(finishTable){if(eq$1(startTable,finishTable))return Optional.some({boxes:intercepts(startTable,start,finish),start:start,finish:finish});if(contains(startTable,finishTable)){var finishCell=(ancestorCells=ancestors$3(finish,"td,th",getIsRoot(startTable))).length>0?ancestorCells[ancestorCells.length-1]:finish;return Optional.some({boxes:nestedIntercepts(startTable,start,startTable,finish,finishTable),start:start,finish:finishCell})}if(contains(finishTable,startTable)){var ancestorCells,startCell=(ancestorCells=ancestors$3(start,"td,th",getIsRoot(finishTable))).length>0?ancestorCells[ancestorCells.length-1]:start;return Optional.some({boxes:nestedIntercepts(finishTable,start,startTable,finish,finishTable),start:start,finish:startCell})}return function(start,finish,isRoot){return ancestors$1(universe$3,start,finish,isRoot)}(start,finish).shared.bind((function(lca){return closest$1(lca,"table",isRoot).bind((function(lcaTable){var finishAncestorCells=ancestors$3(finish,"td,th",getIsRoot(lcaTable)),finishCell=finishAncestorCells.length>0?finishAncestorCells[finishAncestorCells.length-1]:finish,startAncestorCells=ancestors$3(start,"td,th",getIsRoot(lcaTable)),startCell=startAncestorCells.length>0?startAncestorCells[startAncestorCells.length-1]:start;return Optional.some({boxes:nestedIntercepts(lcaTable,start,startTable,finish,finishTable),start:startCell,finish:finishCell})}))}))}))}))},retrieve$1=function(container,selector){var sels=descendants(container,selector);return sels.length>0?Optional.some(sels):Optional.none()},getEdges=function(container,firstSelectedSelector,lastSelectedSelector){return descendant(container,firstSelectedSelector).bind((function(first){return descendant(container,lastSelectedSelector).bind((function(last){return sharedOne(lookupTable,[first,last]).map((function(table){return{first:first,last:last,table:table}}))}))}))},shiftSelection=function(boxes,deltaRow,deltaColumn,firstSelectedSelector,lastSelectedSelector){return function(boxes,lastSelectedSelector){return find$1(boxes,(function(box){return is$2(box,lastSelectedSelector)}))}(boxes,lastSelectedSelector).bind((function(last){return moveBy(last,deltaRow,deltaColumn).bind((function(finish){return function(finish,firstSelectedSelector){return ancestor$1(finish,"table").bind((function(table){return descendant(table,firstSelectedSelector).bind((function(start){return identify(start,finish).bind((function(identified){return identified.boxes.map((function(boxes){return{boxes:boxes,start:identified.start,finish:identified.finish}}))}))}))}))}(finish,firstSelectedSelector)}))}))},retrieve=function(container,selector){return retrieve$1(container,selector)},retrieveBox=function(container,firstSelectedSelector,lastSelectedSelector){return getEdges(container,firstSelectedSelector,lastSelectedSelector).bind((function(edges){var isRoot=function(ancestor){return eq$1(container,ancestor)},firstAncestor=ancestor$1(edges.first,"thead,tfoot,tbody,table",isRoot),lastAncestor=ancestor$1(edges.last,"thead,tfoot,tbody,table",isRoot);return firstAncestor.bind((function(fA){return lastAncestor.bind((function(lA){return eq$1(fA,lA)?function(table,first,last){var warehouse=getWarehouse(table);return getBox$1(warehouse,first,last)}(edges.table,edges.first,edges.last):Optional.none()}))}))}))},Adt_generate=function(cases){if(!isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$2(cases,(function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);var match=function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(function(reqKey){return contains$2(branchKeys,reqKey)})))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)};return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);var target=foldArgs[count];return target.apply(null,args)},match:match,log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}})),adt},type=Adt_generate([{none:[]},{multiple:["elements"]},{single:["element"]}]),cata$2=function(subject,onNone,onMultiple,onSingle){return subject.fold(onNone,onMultiple,onSingle)},none$1=type.none,multiple=type.multiple,single=type.single,global$3=tinymce.util.Tools.resolve("tinymce.PluginManager"),clone=function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))},shallow=function(original){return clone(original,!1)},deep=function(original){return clone(original,!0)},shallowAs=function(original,tag){var nu=SugarElement.fromTag(tag),attributes=clone$2(original);return setAll$1(nu,attributes),nu},Dimension=function(name,getOffset){var get=function(element){var r=getOffset(element);if(r<=0||null===r){var css=get$a(element,name);return parseFloat(css)||0}return r},aggregate=function(element,properties){return foldl(properties,(function(acc,property){var val=get$a(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0)};return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);var dom=element.dom;isSupported(dom)&&(dom.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:function(element,value,properties){var cumulativeInclusions=aggregate(element,properties);return value>cumulativeInclusions?value-cumulativeInclusions:0}}},needManualCalc=function(){var browser=detect$3().browser;return browser.isIE()||browser.isEdge()},toNumber=function(px,fallback){return function(value){var num=parseFloat(value);return isNaN(num)?Optional.none():Optional.some(num)}(px).getOr(fallback)},getProp=function(element,name,fallback){return toNumber(get$a(element,name),fallback)},getBoxSizing=function(element){return get$a(element,"box-sizing")},calcContentBoxSize=function(element,size,upper,lower){return size-getProp(element,"padding-"+upper,0)-getProp(element,"padding-"+lower,0)-getProp(element,"border-"+upper+"-width",0)-getProp(element,"border-"+lower+"-width",0)},getCalculatedWidth=function(element,boxSizing){var dom=element.dom,width=dom.getBoundingClientRect().width||dom.offsetWidth;return"border-box"===boxSizing?width:calcContentBoxSize(element,width,"left","right")},api$1=Dimension("width",(function(element){return element.dom.offsetWidth})),get$8=function(element){return api$1.get(element)},getOuter$2=function(element){return api$1.getOuter(element)},getInner=function(element){return getCalculatedWidth(element,"content-box")},getRuntime$1=function(element){return needManualCalc()?getCalculatedWidth(element,getBoxSizing(element)):getProp(element,"width",element.dom.offsetWidth)},columns=function(warehouse,isValidCell){void 0===isValidCell&&(isValidCell=always);var grid=warehouse.grid,cols=range$1(grid.columns,identity),rowsArr=range$1(grid.rows,identity);return map$1(cols,(function(col){return decide((function(){return bind$2(rowsArr,(function(r){return Warehouse.getAt(warehouse,r,col).filter((function(detail){return detail.column===col})).toArray()}))}),(function(detail){return 1===detail.colspan&&isValidCell(detail.element)}),(function(){return Warehouse.getAt(warehouse,0,col)}))}))},decide=function(getBlock,isValid,getFallback){var inBlock=getBlock();return find$1(inBlock,isValid).orThunk((function(){return Optional.from(inBlock[0]).orThunk(getFallback)})).map((function(detail){return detail.element}))},rows=function(warehouse){var grid=warehouse.grid,rowsArr=range$1(grid.rows,identity),cols=range$1(grid.columns,identity);return map$1(rowsArr,(function(row){return decide((function(){return bind$2(cols,(function(c){return Warehouse.getAt(warehouse,row,c).filter((function(detail){return detail.row===row})).fold(constant([]),(function(detail){return[detail]}))}))}),(function(detail){return 1===detail.rowspan}),(function(){return Warehouse.getAt(warehouse,row,0)}))}))},deduce=function(xs,index){if(index<0||index>=xs.length-1)return Optional.none();var current=xs[index].fold((function(){var rest=function(xs){var r=nativeSlice.call(xs,0);return r.reverse(),r}(xs.slice(0,index));return findMap(rest,(function(a,i){return a.map((function(aa){return{value:aa,delta:i+1}}))}))}),(function(c){return Optional.some({value:c,delta:0})})),next=xs[index+1].fold((function(){var rest=xs.slice(index+1);return findMap(rest,(function(a,i){return a.map((function(aa){return{value:aa,delta:i+1}}))}))}),(function(n){return Optional.some({value:n,delta:1})}));return current.bind((function(c){return next.map((function(n){var extras=n.delta+c.delta;return Math.abs(n.value-c.value)/extras}))}))},onDirection=function(isLtr,isRtl){return function(element){return"rtl"===getDirection(element)?isRtl:isLtr}},getDirection=function(element){return"rtl"===get$a(element,"direction")?"rtl":"ltr"},api=Dimension("height",(function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),get$7=function(element){return api.get(element)},getOuter$1=function(element){return api.getOuter(element)},getRuntime=function(element){return needManualCalc()?function(element,boxSizing){var dom=element.dom,height=dom.getBoundingClientRect().height||dom.offsetHeight;return"border-box"===boxSizing?height:calcContentBoxSize(element,height,"top","bottom")}(element,getBoxSizing(element)):getProp(element,"height",element.dom.offsetHeight)},r=function(left,top){return{left:left,top:top,translate:function(x,y){return r(left+x,top+y)}}},SugarPosition=r,firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},absolute=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)},viewport=function(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?function(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)}(dom):SugarPosition(0,0)},rowInfo=function(row,y){return{row:row,y:y}},colInfo=function(col,x){return{col:col,x:x}},rtlEdge=function(cell){return absolute(cell).left+getOuter$2(cell)},ltrEdge=function(cell){return absolute(cell).left},getLeftEdge=function(index,cell){return colInfo(index,ltrEdge(cell))},getRightEdge=function(index,cell){return colInfo(index,rtlEdge(cell))},getTop$1=function(cell){return absolute(cell).top},getTopEdge=function(index,cell){return rowInfo(index,getTop$1(cell))},getBottomEdge=function(index,cell){return rowInfo(index,getTop$1(cell)+getOuter$1(cell))},findPositions=function(getInnerEdge,getOuterEdge,array){if(0===array.length)return[];var lines=map$1(array.slice(1),(function(cellOption,index){return cellOption.map((function(cell){return getInnerEdge(index,cell)}))})),lastLine=array[array.length-1].map((function(cell){return getOuterEdge(array.length-1,cell)}));return lines.concat([lastLine])},height={delta:identity,positions:function(optElements){return findPositions(getTopEdge,getBottomEdge,optElements)},edge:getTop$1},ltr$1={delta:identity,edge:ltrEdge,positions:function(optElements){return findPositions(getLeftEdge,getRightEdge,optElements)}},rtl$1={delta:function(step){return-step},edge:rtlEdge,positions:function(optElements){return findPositions(getRightEdge,getLeftEdge,optElements)}},detect$2=onDirection(ltr$1,rtl$1),width={delta:function(amount,table){return detect$2(table).delta(amount,table)},positions:function(cols,table){return detect$2(table).positions(cols,table)},edge:function(cell){return detect$2(cell).edge(cell)}},units={unsupportedLength:["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","in","pc","pt","px"],fixed:["px","pt"],relative:["%"],empty:[""]},pattern=(opt=function(input){return"(?:"+input+")?"},unsignedDecimalLiteral=["Infinity","[0-9]+\\."+opt("[0-9]+")+opt("[eE][+-]?[0-9]+"),"\\.[0-9]+"+opt("[eE][+-]?[0-9]+"),"[0-9]+"+opt("[eE][+-]?[0-9]+")].join("|"),new RegExp("^([+-]?(?:"+unsignedDecimalLiteral+"))(.*)$")),parse=function(input,accepted){return Optional.from(pattern.exec(input)).bind((function(array){var value=Number(array[1]),unitRaw=array[2];return function(unit,accepted){return exists(accepted,(function(acc){return exists(units[acc],(function(check){return unit===check}))}))}(unitRaw,accepted)?Optional.some({value:value,unit:unitRaw}):Optional.none()}))},rPercentageBasedSizeRegex=/(\d+(\.\d+)?)%/,rPixelBasedSizeRegex=/(\d+(\.\d+)?)px|em/,isCol$2=isTag("col"),getPercentSize=function(elm,outerGetter,innerGetter){var element,relativeParent=(element=elm,Optional.from(element.dom.parentElement).map(SugarElement.fromDom)).getOrThunk((function(){return getBody$1(owner(elm))}));return outerGetter(elm)/innerGetter(relativeParent)*100},setPixelWidth=function(cell,amount){set$1(cell,"width",amount+"px")},setPercentageWidth=function(cell,amount){set$1(cell,"width",amount+"%")},setHeight=function(cell,amount){set$1(cell,"height",amount+"px")},normalizePixelSize=function(value,cell,getter,setter){var number=parseFloat(value);return endsWith(value,"%")&&"table"!==name(cell)?function(cell,number,getter,setter){var newSize=table(cell).map((function(table){var total=getter(table);return Math.floor(number/100*total)})).getOr(number);return setter(cell,newSize),newSize}(cell,number,getter,setter):number},getTotalHeight=function(cell){var value=function(cell){return getRuntime(cell)+"px"}(cell);return value?normalizePixelSize(value,cell,get$7,setHeight):get$7(cell)},getRaw$1=function(element,prop){return getRaw$2(element,prop).orThunk((function(){return getOpt(element,prop).map((function(val){return val+"px"}))}))},getRawWidth$1=function(element){return getRaw$1(element,"width")},getPercentageWidth=function(cell){return getPercentSize(cell,get$8,getInner)},getPixelWidth$1=function(cell){return isCol$2(cell)?get$8(cell):getRuntime$1(cell)},getHeight=function(cell){return function(cell,type,f){return f(cell)/getSpan(cell,type)}(cell,"rowspan",getTotalHeight)},setGenericWidth=function(cell,amount,unit){set$1(cell,"width",amount+unit)},getPercentTableWidth=function(table){return getPercentSize(table,get$8,getInner)+"%"},percentageBasedSizeRegex=constant(rPercentageBasedSizeRegex),isCol$1=isTag("col"),getRawW=function(cell){return getRawWidth$1(cell).getOrThunk((function(){return getPixelWidth$1(cell)+"px"}))},getRawH=function(cell){return(element=cell,getRaw$1(element,"height")).getOrThunk((function(){return getHeight(cell)+"px"}));var element},getDimension=function(cellOpt,index,backups,filter,getter,fallback){return cellOpt.filter(filter).fold((function(){return fallback(deduce(backups,index))}),(function(cell){return getter(cell)}))},getWidthFrom=function(warehouse,table,getWidth,fallback){var columnCells=columns(warehouse),columns$1=Warehouse.hasColumns(warehouse)?function(warehouse){return map$1(Warehouse.justColumns(warehouse),(function(column){return Optional.from(column.element)}))}(warehouse):columnCells,backups=[Optional.some(width.edge(table))].concat(map$1(width.positions(columnCells,table),(function(pos){return pos.map((function(p){return p.x}))}))),colFilter=not(hasColspan);return map$1(columns$1,(function(cellOption,c){return getDimension(cellOption,c,backups,colFilter,(function(column){if(function(cell){var browser=detect$3().browser,supportsColWidths=browser.isChrome()||browser.isFirefox();return!isCol$1(cell)||supportsColWidths}(column))return getWidth(column);var a,f,cell=(a=columnCells[c],f=identity,null!=a?f(a):Optional.none());return getDimension(cell,c,backups,colFilter,(function(cell){return fallback(Optional.some(get$8(cell)))}),fallback)}),fallback)}))},getDeduced=function(deduced){return deduced.map((function(d){return d+"px"})).getOr("")},getPixelWidths=function(warehouse,table,tableSize){return getWidthFrom(warehouse,table,getPixelWidth$1,(function(deduced){return deduced.getOrThunk(tableSize.minCellWidth)}))},getHeightFrom=function(warehouse,table,direction,getHeight,fallback){var rows$1=rows(warehouse),backups=[Optional.some(direction.edge(table))].concat(map$1(direction.positions(rows$1,table),(function(pos){return pos.map((function(p){return p.y}))})));return map$1(rows$1,(function(cellOption,c){return getDimension(cellOption,c,backups,not(hasRowspan),getHeight,fallback)}))},widthLookup=function(table,getter){return function(){return inBody(table)?getter(table):parseFloat(getRaw$2(table,"width").getOr("0"))}},noneSize=function(table){var getWidth=widthLookup(table,get$8),zero=constant(0);return{width:getWidth,pixelWidth:getWidth,getWidths:function(warehouse,tableSize){return getPixelWidths(warehouse,table,tableSize)},getCellDelta:zero,singleColumnWidth:constant([0]),minCellWidth:zero,setElementWidth:noop,adjustTableWidth:noop,isRelative:!0,label:"none"}},percentageSize=function(table){var getFloatWidth=widthLookup(table,(function(elem){return parseFloat(getPercentTableWidth(elem))})),getWidth=widthLookup(table,get$8);return{width:getFloatWidth,pixelWidth:getWidth,getWidths:function(warehouse,tableSize){return function(warehouse,table,tableSize){return getWidthFrom(warehouse,table,getPercentageWidth,(function(deduced){return deduced.fold((function(){return tableSize.minCellWidth()}),(function(cellWidth){return cellWidth/tableSize.pixelWidth()*100}))}))}(warehouse,table,tableSize)},getCellDelta:function(delta){return delta/getWidth()*100},singleColumnWidth:function(w,_delta){return[100-w]},minCellWidth:function(){return minWidth()/getWidth()*100},setElementWidth:setPercentageWidth,adjustTableWidth:function(delta){var currentWidth=getFloatWidth();setPercentageWidth(table,currentWidth+delta/100*currentWidth)},isRelative:!0,label:"percent"}},pixelSize=function(table){var getWidth=widthLookup(table,get$8);return{width:getWidth,pixelWidth:getWidth,getWidths:function(warehouse,tableSize){return getPixelWidths(warehouse,table,tableSize)},getCellDelta:identity,singleColumnWidth:function(w,delta){return[Math.max(minWidth(),w+delta)-w]},minCellWidth:minWidth,setElementWidth:setPixelWidth,adjustTableWidth:function(delta){var newWidth=getWidth()+delta;setPixelWidth(table,newWidth)},isRelative:!1,label:"pixel"}},TableSize_getTableSize=function(table){return getRawWidth$1(table).fold((function(){return noneSize(table)}),(function(w){return function(element,width){return null!==percentageBasedSizeRegex().exec(width)?percentageSize(element):pixelSize(element)}(table,w)}))},TableSize_pixelSize=pixelSize,TableSize_percentageSize=percentageSize,makeCell=function(list,seenSelected,rowIndex){var row=list[rowIndex].element,td=SugarElement.fromTag("td");append$1(td,SugarElement.fromTag("br")),(seenSelected?append$1:prepend)(row,td)},extract$1=function(table,selectedSelector){var isSelected=function(detail){return is$2(detail.element,selectedSelector)},replica=deep(table),list=fromTable$1(replica),tableSize=TableSize_getTableSize(table),replicaHouse=Warehouse.generate(list),replicaStats=function(house,isSelected){var totalColumns=house.grid.columns,minRow=house.grid.rows,minCol=totalColumns,maxRow=0,maxCol=0,allCells=[],selectedCells=[];return each$1(house.access,(function(detail){if(allCells.push(detail),isSelected(detail)){selectedCells.push(detail);var startRow=detail.row,endRow=startRow+detail.rowspan-1,startCol=detail.column,endCol=startCol+detail.colspan-1;startRow<minRow?minRow=startRow:endRow>maxRow&&(maxRow=endRow),startCol<minCol?minCol=startCol:endCol>maxCol&&(maxCol=endCol)}})),function(minRow,minCol,maxRow,maxCol,allCells,selectedCells){return{minRow:minRow,minCol:minCol,maxRow:maxRow,maxCol:maxCol,allCells:allCells,selectedCells:selectedCells}}(minRow,minCol,maxRow,maxCol,allCells,selectedCells)}(replicaHouse,isSelected),selector="th:not("+selectedSelector+"),td:not("+selectedSelector+")",unselectedCells=filterFirstLayer(replica,"th,td",(function(cell){return is$2(cell,selector)}));return each$2(unselectedCells,remove$5),function(list,house,stats,isSelected){for(var totalColumns=house.grid.columns,totalRows=house.grid.rows,i=0;i<totalRows;i++)for(var seenSelected=!1,j=0;j<totalColumns;j++)i<stats.minRow||i>stats.maxRow||j<stats.minCol||j>stats.maxCol||(Warehouse.getAt(house,i,j).filter(isSelected).isNone()?makeCell(list,seenSelected,i):seenSelected=!0)}(list,replicaHouse,replicaStats,isSelected),function(replica,stats,house,widthDelta){each$1(house.columns,(function(col){(col.column<stats.minCol||col.column>stats.maxCol)&&remove$5(col.element)}));var emptyRows=filter$2(firstLayer(replica,"tr"),(function(row){return 0===row.dom.childElementCount}));each$2(emptyRows,remove$5),stats.minCol!==stats.maxCol&&stats.minRow!==stats.maxRow||each$2(firstLayer(replica,"th,td"),(function(cell){remove$7(cell,"rowspan"),remove$7(cell,"colspan")})),remove$7(replica,LOCKED_COL_ATTR),remove$7(replica,"data-snooker-col-series"),TableSize_getTableSize(replica).adjustTableWidth(widthDelta)}(replica,replicaStats,replicaHouse,function(table,warehouse,tableSize,stats){if(0===stats.minCol&&warehouse.grid.columns===stats.maxCol+1)return 0;var colWidths=getPixelWidths(warehouse,table,tableSize),allColsWidth=foldl(colWidths,(function(acc,width){return acc+width}),0),delta=foldl(colWidths.slice(stats.minCol,stats.maxCol+1),(function(acc,width){return acc+width}),0)/allColsWidth*tableSize.pixelWidth()-tableSize.pixelWidth();return tableSize.getCellDelta(delta)}(table,Warehouse.fromTable(table),tableSize,replicaStats)),replica},getEnd=function(element){return"img"===name(element)?1:getOption(element).fold((function(){return children$3(element).length}),(function(v){return v.length}))},elementsWithCursorPosition=["img","br"],isCursorPosition=function(elem){return getOption(elem).filter((function(text){return 0!==text.trim().length||text.indexOf(" ")>-1})).isSome()||contains$2(elementsWithCursorPosition,name(elem))},first=function(element){return predicate=isCursorPosition,(descend=function(node){for(var i=0;i<node.childNodes.length;i++){var child_1=SugarElement.fromDom(node.childNodes[i]);if(predicate(child_1))return Optional.some(child_1);var res=descend(node.childNodes[i]);if(res.isSome())return res}return Optional.none()})(element.dom);var predicate,descend},last$1=function(element){return descendantRtl(element,isCursorPosition)},descendantRtl=function(scope,predicate){var descend=function(element){for(var children=children$3(element),i=children.length-1;i>=0;i--){var child=children[i];if(predicate(child))return Optional.some(child);var res=descend(child);if(res.isSome())return res}return Optional.none()};return descend(scope)},transferableAttributes={scope:["row","col"]},createCell=function(doc){return function(){var td=SugarElement.fromTag("td",doc.dom);return append$1(td,SugarElement.fromTag("br",doc.dom)),td}},createCol=function(doc){return function(){return SugarElement.fromTag("col",doc.dom)}},createColgroup=function(doc){return function(){return SugarElement.fromTag("colgroup",doc.dom)}},createRow$1=function(doc){return function(){return SugarElement.fromTag("tr",doc.dom)}},replace$1=function(cell,tag,attrs){var replica=function(original,tag){var nu=shallowAs(original,tag),cloneChildren=children$3(deep(original));return append(nu,cloneChildren),nu}(cell,tag);return each$1(attrs,(function(v,k){null===v?remove$7(replica,k):set$2(replica,k,v)})),replica},pasteReplace=function(cell){return cell},cellOperations=function(mutate,doc,formatsToClone){var cloneCss=function(prev,clone){var source,target,sourceDom,targetDom;source=prev.element,target=clone,sourceDom=source.dom,targetDom=target.dom,isSupported(sourceDom)&&isSupported(targetDom)&&(targetDom.style.cssText=sourceDom.style.cssText),remove$6(clone,"height"),1!==prev.colspan&&remove$6(clone,"width")};return{col:function(prev){var col=SugarElement.fromTag(name(prev.element),doc.dom);return cloneCss(prev,col),mutate(prev.element,col),col},colgroup:createColgroup(doc),row:createRow$1(doc),cell:function(prev){var td=SugarElement.fromTag(name(prev.element),doc.dom),formats=formatsToClone.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),lastNode=formats.length>0?function(oldCell,newCell,formats){return first(oldCell).map((function(firstText){var formatSelector=formats.join(","),parents=ancestors$3(firstText,formatSelector,(function(element){return eq$1(element,oldCell)}));return foldr(parents,(function(last,parent){var clonedFormat=shallow(parent);return remove$7(clonedFormat,"contenteditable"),append$1(last,clonedFormat),clonedFormat}),newCell)})).getOr(newCell)}(prev.element,td,formats):td;return append$1(lastNode,SugarElement.fromTag("br")),cloneCss(prev,td),function(original,clone){each$1(transferableAttributes,(function(validAttributes,attributeName){return getOpt(original,attributeName).filter((function(attribute){return contains$2(validAttributes,attribute)})).each((function(attribute){return set$2(clone,attributeName,attribute)}))}))}(prev.element,td),mutate(prev.element,td),td},replace:replace$1,colGap:createCol(doc),gap:createCell(doc)}},paste$1=function(doc){return{col:createCol(doc),colgroup:createColgroup(doc),row:createRow$1(doc),cell:createCell(doc),replace:pasteReplace,colGap:createCol(doc),gap:createCell(doc)}},fromDom=function(nodes){return map$1(nodes,SugarElement.fromDom)},getBody=function(editor){return SugarElement.fromDom(editor.getBody())},getPixelWidth=function(elm){return elm.getBoundingClientRect().width},getPixelHeight=function(elm){return elm.getBoundingClientRect().height},getIsRoot=function(editor){return function(element){return eq$1(element,getBody(editor))}},addPxSuffix=function(size){return/^\d+(\.\d+)?$/.test(size)?size+"px":size},removeDataStyle=function(table){remove$7(table,"data-mce-style");var removeStyleAttribute=function(element){return remove$7(element,"data-mce-style")};each$2(cells$1(table),removeStyleAttribute),each$2(columns$1(table),removeStyleAttribute),each$2(rows$1(table),removeStyleAttribute)},getSelectionStart=function(editor){return SugarElement.fromDom(editor.selection.getStart())},selection=function(selections){return cata$2(selections.get(),constant([]),identity,pure)},unmergable=function(selections){var hasSpan=function(elem,type){return getOpt(elem,type).exists((function(span){return parseInt(span,10)>1}))},candidates=selection(selections);return candidates.length>0&&forall(candidates,(function(elem){return hasSpan(elem,"rowspan")||hasSpan(elem,"colspan")}))?Optional.some(candidates):Optional.none()},mergable=function(table,selections,ephemera){return cata$2(selections.get(),Optional.none,(function(cells){return cells.length<=1?Optional.none():retrieveBox(table,ephemera.firstSelectedSelector,ephemera.lastSelectedSelector).map((function(bounds){return{bounds:bounds,cells:cells}}))}),Optional.none)},ephemera={selected:"data-mce-selected",selectedSelector:"td[data-mce-selected],th[data-mce-selected]",firstSelected:"data-mce-first-selected",firstSelectedSelector:"td[data-mce-first-selected],th[data-mce-first-selected]",lastSelected:"data-mce-last-selected",lastSelectedSelector:"td[data-mce-last-selected],th[data-mce-last-selected]"},forMenu=function(selections,table,cell){return{element:cell,mergable:mergable(table,selections,ephemera),unmergable:unmergable(selections),selection:selection(selections)}},getSelectionFromSelector=function(selector){return function(initCell,isRoot){var element,cellName=name(initCell),cell="col"===cellName||"colgroup"===cellName?table(element=initCell).bind((function(table){return retrieve(table,ephemera.firstSelectedSelector)})).fold(constant(element),(function(cells){return cells[0]})):initCell;return closest$1(cell,selector,isRoot)}},getSelectionCellOrCaption=getSelectionFromSelector("th,td,caption"),getSelectionCell=getSelectionFromSelector("th,td"),getCellsFromSelection=function(selections){return selection(selections)},registerEvents=function(editor,selections,actions){editor.on("BeforeGetContent",(function(e){!0===e.selection&&cata$2(selections.get(),noop,(function(cells){e.preventDefault(),function(cells){return table(cells[0]).map((function(table){var replica=extract$1(table,"[data-mce-selected]");return removeDataStyle(replica),[replica]}))}(cells).each((function(elements){e.content="text"===e.format?function(elements){return map$1(elements,(function(element){return element.dom.innerText})).join("")}(elements):function(editor,elements){return map$1(elements,(function(elm){return editor.selection.serializer.serialize(elm.dom,{})})).join("")}(editor,elements)}))}),noop)})),editor.on("BeforeSetContent",(function(e){if(!0===e.selection&&!0===e.paste){var selectedCells=getCellsFromSelection(selections);head(selectedCells).each((function(cell){table(cell).each((function(table){var html,scope,div,elements=filter$2((html=e.content,(div=(scope||document).createElement("div")).innerHTML=html,children$3(SugarElement.fromDom(div))),(function(content){return"meta"!==name(content)})),isTable=isTag("table");if(1===elements.length&&isTable(elements[0])){e.preventDefault();var doc=SugarElement.fromDom(editor.getDoc()),generators=paste$1(doc),targets=function(element,clipboard,generators){return{element:element,clipboard:clipboard,generators:generators}}(cell,elements[0],generators);actions.pasteCells(table,targets).each((function(){editor.focus()}))}}))}))}}))},adt$7=Adt_generate([{none:[]},{only:["index"]},{left:["index","next"]},{middle:["prev","index","next"]},{right:["prev","index"]}]),ColumnContext=__assign({},adt$7),determine=function(input,column,step,tableSize,resize){var result=input.slice(0),context=function(input,index){return 0===input.length?ColumnContext.none():1===input.length?ColumnContext.only(0):0===index?ColumnContext.left(0,1):index===input.length-1?ColumnContext.right(index-1,index):index>0&&index<input.length-1?ColumnContext.middle(index-1,index,index+1):ColumnContext.none()}(input,column),onNone=constant(map$1(result,constant(0)));return context.fold(onNone,(function(index){return tableSize.singleColumnWidth(result[index],step)}),(function(index,next){return resize.calcLeftEdgeDeltas(result,index,next,step,tableSize.minCellWidth(),tableSize.isRelative)}),(function(prev,index,next){return resize.calcMiddleDeltas(result,prev,index,next,step,tableSize.minCellWidth(),tableSize.isRelative)}),(function(prev,index){return resize.calcRightEdgeDeltas(result,prev,index,step,tableSize.minCellWidth(),tableSize.isRelative)}))},total=function(start,end,measures){for(var r=0,i=start;i<end;i++)r+=void 0!==measures[i]?measures[i]:0;return r},recalculateHeightForCells=function(warehouse,heights){var all=Warehouse.justCells(warehouse);return map$1(all,(function(cell){var height=total(cell.row,cell.row+cell.rowspan,heights);return{element:cell.element,height:height,rowspan:cell.rowspan}}))},recalculate=function(warehouse,widths){return Warehouse.hasColumns(warehouse)?function(warehouse,widths){var groups=Warehouse.justColumns(warehouse);return map$1(groups,(function(column,index){return{element:column.element,width:widths[index],colspan:column.colspan}}))}(warehouse,widths):function(warehouse,widths){var all=Warehouse.justCells(warehouse);return map$1(all,(function(cell){var width=total(cell.column,cell.column+cell.colspan,widths);return{element:cell.element,width:width,colspan:cell.colspan}}))}(warehouse,widths)},recalculateAndApply=function(warehouse,widths,tableSize){var newSizes=recalculate(warehouse,widths);each$2(newSizes,(function(cell){tableSize.setElementWidth(cell.element,cell.width)}))},adjustWidth=function(table,delta,index,resizing,tableSize){var warehouse=Warehouse.fromTable(table),step=tableSize.getCellDelta(delta),widths=tableSize.getWidths(warehouse,tableSize),isLastColumn=index===warehouse.grid.columns-1,clampedStep=resizing.clampTableDelta(widths,index,step,tableSize.minCellWidth(),isLastColumn),deltas=determine(widths,index,clampedStep,tableSize,resizing),newWidths=map$1(deltas,(function(dx,i){return dx+widths[i]}));recalculateAndApply(warehouse,newWidths,tableSize),resizing.resizeTable(tableSize.adjustTableWidth,clampedStep,isLastColumn)},adjustHeight=function(table,delta,index,direction){var warehouse=Warehouse.fromTable(table),heights=function(warehouse,table,direction){return getHeightFrom(warehouse,table,direction,getHeight,(function(deduced){return deduced.getOrThunk(minHeight)}))}(warehouse,table,direction),newHeights=map$1(heights,(function(dy,i){return index===i?Math.max(delta+dy,minHeight()):dy})),newCellSizes=recalculateHeightForCells(warehouse,newHeights),newRowSizes=function(warehouse,heights){return map$1(warehouse.all,(function(row,i){return{element:row.element,height:heights[i]}}))}(warehouse,newHeights);each$2(newRowSizes,(function(row){setHeight(row.element,row.height)})),each$2(newCellSizes,(function(cell){setHeight(cell.element,cell.height)}));var total=foldr(newHeights,(function(b,a){return b+a}),0);setHeight(table,total)},zero=function(array){return map$1(array,constant(0))},surround=function(sizes,startIndex,endIndex,results,f){return f(sizes.slice(0,startIndex)).concat(results).concat(f(sizes.slice(endIndex)))},clampDeltaHelper=function(predicate){return function(sizes,index,delta,minCellSize){if(predicate(delta)){var newSize=Math.max(minCellSize,sizes[index]-Math.abs(delta)),diff=Math.abs(newSize-sizes[index]);return delta>=0?diff:-diff}return delta}},clampNegativeDelta=clampDeltaHelper((function(delta){return delta<0})),clampDelta=clampDeltaHelper(always),resizeTable=function(){var calcRelativeDeltas=function(sizes,index,delta,minCellSize){var ratio=(100+delta)/100,newThis=Math.max(minCellSize,(sizes[index]+delta)/ratio);return map$1(sizes,(function(size,idx){return(idx===index?newThis:size/ratio)-size}))},calcLeftEdgeDeltas=function(sizes,index,next,delta,minCellSize,isRelative){return isRelative?calcRelativeDeltas(sizes,index,delta,minCellSize):function(sizes,index,next,delta,minCellSize){var clampedDelta=clampNegativeDelta(sizes,index,delta,minCellSize);return surround(sizes,index,next+1,[clampedDelta,0],zero)}(sizes,index,next,delta,minCellSize)};return{resizeTable:function(resizer,delta){return resizer(delta)},clampTableDelta:clampNegativeDelta,calcLeftEdgeDeltas:calcLeftEdgeDeltas,calcMiddleDeltas:function(sizes,_prev,index,next,delta,minCellSize,isRelative){return calcLeftEdgeDeltas(sizes,index,next,delta,minCellSize,isRelative)},calcRightEdgeDeltas:function(sizes,_prev,index,delta,minCellSize,isRelative){if(isRelative)return calcRelativeDeltas(sizes,index,delta,minCellSize);var clampedDelta=clampNegativeDelta(sizes,index,delta,minCellSize);return zero(sizes.slice(0,index)).concat([clampedDelta])},calcRedestributedWidths:function(sizes,totalWidth,pixelDelta,isRelative){if(isRelative){var ratio_1=(totalWidth+pixelDelta)/totalWidth,newSizes=map$1(sizes,(function(size){return size/ratio_1}));return{delta:100*ratio_1-100,newSizes:newSizes}}return{delta:pixelDelta,newSizes:sizes}}}},preserveTable=function(){var calcLeftEdgeDeltas=function(sizes,index,next,delta,minCellSize){var clampedDelta=clampDelta(sizes,delta>=0?next:index,delta,minCellSize);return surround(sizes,index,next+1,[clampedDelta,-clampedDelta],zero)};return{resizeTable:function(resizer,delta,isLastColumn){isLastColumn&&resizer(delta)},clampTableDelta:function(sizes,index,delta,minCellSize,isLastColumn){if(isLastColumn){if(delta>=0)return delta;var maxDelta=foldl(sizes,(function(a,b){return a+b-minCellSize}),0);return Math.max(-maxDelta,delta)}return clampNegativeDelta(sizes,index,delta,minCellSize)},calcLeftEdgeDeltas:calcLeftEdgeDeltas,calcMiddleDeltas:function(sizes,_prev,index,next,delta,minCellSize){return calcLeftEdgeDeltas(sizes,index,next,delta,minCellSize)},calcRightEdgeDeltas:function(sizes,_prev,_index,delta,_minCellSize,isRelative){if(isRelative)return zero(sizes);var diff=delta/sizes.length;return map$1(sizes,constant(diff))},calcRedestributedWidths:function(sizes,_totalWidth,_pixelDelta,_isRelative){return{delta:0,newSizes:sizes}}}},ResizeWire_only=function(element,isResizable){var parent=Optional.from(element.dom.documentElement).map(SugarElement.fromDom).getOr(element);return{parent:constant(parent),view:constant(element),origin:constant(SugarPosition(0,0)),isResizable:isResizable}},ResizeWire_body=function(editable,chrome,isResizable){return{parent:constant(chrome),view:constant(editable),origin:constant(SugarPosition(0,0)),isResizable:isResizable}},adt$6=Adt_generate([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),validateFor=function(suffix,type,value){var rawAmount=value.substring(0,value.length-suffix.length),amount=parseFloat(rawAmount);return rawAmount===amount.toString()?type(amount):adt$6.invalid(value)},Size=__assign(__assign({},adt$6),{from:function(value){return endsWith(value,"%")?validateFor("%",adt$6.percent,value):endsWith(value,"px")?validateFor("px",adt$6.pixels,value):adt$6.invalid(value)}}),redistributeValues=function(newWidthType,widths,totalWidth){return newWidthType.fold((function(){return widths}),(function(px){return function(widths,totalWidth,newTotalWidth){var scale=newTotalWidth/totalWidth;return map$1(widths,(function(w){return Size.from(w).fold((function(){return w}),(function(px){return px*scale+"px"}),(function(pc){return pc/100*newTotalWidth+"px"}))}))}(widths,totalWidth,px)}),(function(_pc){return function(widths,totalWidth){return map$1(widths,(function(w){return Size.from(w).fold((function(){return w}),(function(px){return px/totalWidth*100+"%"}),(function(pc){return pc+"%"}))}))}(widths,totalWidth)}))},redistribute$1=function(widths,totalWidth,newWidth){var newType=Size.from(newWidth),floats=forall(widths,(function(s){return"0px"===s}))?function(newWidthType,columns){var f=newWidthType.fold((function(){return constant("")}),(function(pixels){return constant(pixels/columns+"px")}),(function(){return constant(100/columns+"%")}));return range$1(columns,f)}(newType,widths.length):redistributeValues(newType,widths,totalWidth);return normalize(floats)},sum=function(values,fallback){return 0===values.length?fallback:foldr(values,(function(rest,v){return Size.from(v).fold(constant(0),identity,identity)+rest}),0)},add$3=function(value,amount){return Size.from(value).fold(constant(value),(function(px){return px+amount+"px"}),(function(pc){return pc+amount+"%"}))},normalize=function(values){if(0===values.length)return values;var scan=foldr(values,(function(rest,value){var info=Size.from(value).fold((function(){return{value:value,remainder:0}}),(function(num){return function(num,unit){var floored=Math.floor(num);return{value:floored+unit,remainder:num-floored}}(num,"px")}),(function(num){return{value:num+"%",remainder:0}}));return{output:[info.value].concat(rest.output),remainder:rest.remainder+info.remainder}}),{output:[],remainder:0}),r=scan.output;return r.slice(0,r.length-1).concat([add$3(r[r.length-1],Math.round(scan.remainder))])},validate=Size.from,getUnit=function(newSize){return validate(newSize).fold(constant("px"),constant("px"),constant("%"))},redistribute=function(table,optWidth,optHeight){var warehouse=Warehouse.fromTable(table),rows=warehouse.all,cells=Warehouse.justCells(warehouse),columns=Warehouse.justColumns(warehouse);optWidth.each((function(newWidth){var widthUnit=getUnit(newWidth),totalWidth=get$8(table),oldWidths=function(warehouse,table){return getWidthFrom(warehouse,table,getRawW,getDeduced)}(warehouse,table),nuWidths=redistribute$1(oldWidths,totalWidth,newWidth);Warehouse.hasColumns(warehouse)?function(newWidths,columns,unit){each$2(columns,(function(column,index){var width=sum([newWidths[index]],minWidth());set$1(column.element,"width",width+unit)}))}(nuWidths,columns,widthUnit):function(newWidths,cells,unit){each$2(cells,(function(cell){var widths=newWidths.slice(cell.column,cell.colspan+cell.column),w=sum(widths,minWidth());set$1(cell.element,"width",w+unit)}))}(nuWidths,cells,widthUnit),set$1(table,"width",newWidth)})),optHeight.each((function(newHeight){var hUnit=getUnit(newHeight),totalHeight=get$7(table),oldHeights=function(warehouse,table,direction){return getHeightFrom(warehouse,table,direction,getRawH,getDeduced)}(warehouse,table,height);!function(newHeights,rows,cells,unit){each$2(cells,(function(cell){var heights=newHeights.slice(cell.row,cell.rowspan+cell.row),h=sum(heights,minHeight());set$1(cell.element,"height",h+unit)})),each$2(rows,(function(row,i){set$1(row.element,"height",newHeights[i])}))}(redistribute$1(oldHeights,totalHeight,newHeight),rows,cells,hUnit),set$1(table,"height",newHeight)}))},isPercentSizing=function(table){return getRawWidth$1(table).exists((function(size){return rPercentageBasedSizeRegex.test(size)}))},isPixelSizing=function(table){return getRawWidth$1(table).exists((function(size){return rPixelBasedSizeRegex.test(size)}))},isNoneSizing=function(table){return getRawWidth$1(table).isNone()},getGridSize=function(table){return Warehouse.fromTable(table).grid},Event=function(fields){var handlers=[];return{bind:function(handler){if(void 0===handler)throw new Error("Event bind error: undefined handler");handlers.push(handler)},unbind:function(handler){handlers=filter$2(handlers,(function(h){return h!==handler}))},trigger:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var event={};each$2(fields,(function(name,i){event[name]=args[i]})),each$2(handlers,(function(handler){handler(event)}))}}},create$4=function(typeDefs){return{registry:map(typeDefs,(function(event){return{bind:event.bind,unbind:event.unbind}})),trigger:map(typeDefs,(function(event){return event.trigger}))}},sort=function(arr){return arr.slice(0).sort()},baseWith=function(handleUnsupported,required,pred){if(0===required.length)throw new Error("You must specify at least one required field.");var sorted;return function(label,array){if(!isArray(array))throw new Error("The "+label+" fields must be an array. Was: "+array+".");each$2(array,(function(a){if(!isString(a))throw new Error("The value "+a+" in the "+label+" fields was not a string.")}))}("required",required),sorted=sort(required),find$1(sorted,(function(s,i){return i<sorted.length-1&&s===sorted[i+1]})).each((function(d){throw new Error("The field: "+d+" occurs more than once in the combined fields: ["+sorted.join(", ")+"].")})),function(obj){var keys$1=keys(obj);forall(required,(function(req){return contains$2(keys$1,req)}))||function(required,keys){throw new Error("All required keys ("+sort(required).join(", ")+") were not specified. Specified keys were: "+sort(keys).join(", ")+".")}(required,keys$1),handleUnsupported(required,keys$1);var invalidKeys=filter$2(required,(function(key){return!pred.validate(obj[key],key)}));return invalidKeys.length>0&&function(incorrect,type){throw new Error("All values need to be of type: "+type+". Keys ("+sort(incorrect).join(", ")+") were not.")}(invalidKeys,pred.label),obj}},handleExact=function(required,keys){var unsupported=filter$2(keys,(function(key){return!contains$2(required,key)}));unsupported.length>0&&function(unsupported){throw new Error("Unsupported keys for object: "+sort(unsupported).join(", "))}(unsupported)},exactly=function(required){return function(handleUnsupported,required){return baseWith(handleUnsupported,required,{validate:isFunction,label:"function"})}(handleExact,required)},DragMode=exactly(["compare","extract","mutate","sink"]),DragSink=exactly(["element","start","stop","destroy"]),DragApi=exactly(["forceDrop","drop","move","delayDrop"]),InDrag=function(){var previous=Optional.none(),events=create$4({move:Event(["info"])});return{onEvent:function(event,mode){mode.extract(event).each((function(data){(function(mode,nu){var result=previous.map((function(old){return mode.compare(old,nu)}));return previous=Optional.some(nu),result})(mode,data).each((function(d){events.trigger.move(d)}))}))},reset:function(){previous=Optional.none()},events:events.registry}},Movement=function(){var events,noDragState=(events=create$4({move:Event(["info"])}),{onEvent:noop,reset:noop,events:events.registry}),inDragState=InDrag(),dragState=noDragState;return{on:function(){dragState.reset(),dragState=inDragState},off:function(){dragState.reset(),dragState=noDragState},isOn:function(){return dragState===inDragState},onEvent:function(event,mode){dragState.onEvent(event,mode)},events:inDragState.events}},setup=function(mutation,mode,settings){var fn,rate,timer,cancel,active=!1,events=create$4({start:Event([]),stop:Event([])}),movement=Movement(),drop=function(){sink.stop(),movement.isOn()&&(movement.off(),events.trigger.stop())},throttledDrop=(fn=drop,rate=200,timer=null,{cancel:cancel=function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate)}});movement.events.move.bind((function(event){mode.mutate(mutation,event.info)}));var runIfActive=function(f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];active&&f.apply(null,args)}},sink=mode.sink(DragApi({forceDrop:drop,drop:runIfActive(drop),move:runIfActive((function(event){throttledDrop.cancel(),movement.onEvent(event,mode)})),delayDrop:runIfActive(throttledDrop.throttle)}),settings);return{element:sink.element,go:function(parent){sink.start(parent),movement.on(),events.trigger.start()},on:function(){active=!0},off:function(){active=!1},destroy:function(){sink.destroy()},events:events.registry}},fromRawEvent$1=function(rawEvent){var fa,fb,target=SugarElement.fromDom(function(event){if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)}(rawEvent).getOr(rawEvent.target)),stop=function(){return rawEvent.stopPropagation()},prevent=function(){return rawEvent.preventDefault()},kill=(fa=prevent,fb=stop,function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))});return function(target,x,y,stop,prevent,kill,raw){return{target:target,x:x,y:y,stop:stop,prevent:prevent,kill:kill,raw:raw}}(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent)},binder=function(element,event,filter,handler,useCapture){var wrapped=function(filter,handler){return function(rawEvent){filter(rawEvent)&&handler(fromRawEvent$1(rawEvent))}}(filter,handler);return element.dom.addEventListener(event,wrapped,useCapture),{unbind:curry(unbind,element,event,wrapped,useCapture)}},unbind=function(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture)},filter=always,bind=function(element,event,handler){return function(element,event,filter,handler){return binder(element,event,filter,handler,!1)}(element,event,filter,handler)},fromRawEvent=fromRawEvent$1,read=function(element,attr){var value=get$b(element,attr);return void 0===value||""===value?[]:value.split(" ")},supports=function(element){return void 0!==element.dom.classList},add$1=function(element,clazz){return function(element,attr,id){var nu=read(element,attr).concat([id]);return set$2(element,attr,nu.join(" ")),!0}(element,"class",clazz)},add=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$1(element,clazz)},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},css=function(namespace){var dashNamespace=namespace.replace(/\./g,"-");return{resolve:function(str){return dashNamespace+"-"+str}}},styles$1=css("ephox-dragster"),resolve$1=styles$1.resolve,MouseDrag=DragMode({compare:function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)},extract:function(event){return Optional.some(SugarPosition(event.x,event.y))},sink:function(dragApi,settings){var blocker=function(options){var settings=__assign({layerClass:resolve$1("blocker")},options),div=SugarElement.fromTag("div");return set$2(div,"role","presentation"),setAll(div,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),add(div,resolve$1("blocker")),add(div,settings.layerClass),{element:constant(div),destroy:function(){remove$5(div)}}}(settings),mdown=bind(blocker.element(),"mousedown",dragApi.forceDrop),mup=bind(blocker.element(),"mouseup",dragApi.drop),mmove=bind(blocker.element(),"mousemove",dragApi.move),mout=bind(blocker.element(),"mouseout",dragApi.delayDrop);return DragSink({element:blocker.element,start:function(parent){append$1(parent,blocker.element())},stop:function(){remove$5(blocker.element())},destroy:function(){blocker.destroy(),mup.unbind(),mmove.unbind(),mout.unbind(),mdown.unbind()}})},mutate:function(mutation,info){mutation.mutate(info.left,info.top)}}),closest=function(target){return closest$1(target,"[contenteditable]")},isEditable$1=function(element,assumeEditable){return void 0===assumeEditable&&(assumeEditable=!1),!detect$3().browser.isIE()&&inBody(element)?element.dom.isContentEditable:closest(element).fold(constant(assumeEditable),(function(editable){return"true"===getRaw(editable)}))},getRaw=function(element){return element.dom.contentEditable},styles=css("ephox-snooker"),resolve=styles.resolve,BarMutation=function(){var events=create$4({drag:Event(["xDelta","yDelta","target"])}),target=Optional.none(),delegate=function(){var events=create$4({drag:Event(["xDelta","yDelta"])});return{mutate:function(x,y){events.trigger.drag(x,y)},events:events.registry}}();delegate.events.drag.bind((function(event){target.each((function(t){events.trigger.drag(event.xDelta,event.yDelta,t)}))}));return{assign:function(t){target=Optional.some(t)},get:function(){return target},mutate:delegate.mutate,events:events.registry}},resizeBar=resolve("resizer-bar"),resizeRowBar=resolve("resizer-rows"),resizeColBar=resolve("resizer-cols"),destroy=function(wire){var previous=descendants(wire.parent(),"."+resizeBar);each$2(previous,remove$5)},drawBar=function(wire,positions,create){var origin=wire.origin();each$2(positions,(function(cpOption){cpOption.each((function(cp){var bar=create(origin,cp);add(bar,resizeBar),append$1(wire.parent(),bar)}))}))},refreshCol=function(wire,colPositions,position,tableHeight){drawBar(wire,colPositions,(function(origin,cp){var column,x,y,w,h,bar,colBar=(column=cp.col,x=cp.x-origin.left,y=position.top-origin.top,w=7,h=tableHeight,bar=SugarElement.fromTag("div"),setAll(bar,{position:"absolute",left:x-w/2+"px",top:y+"px",height:h+"px",width:w+"px"}),setAll$1(bar,{"data-column":column,role:"presentation"}),bar);return add(colBar,resizeColBar),colBar}))},refreshRow=function(wire,rowPositions,position,tableWidth){drawBar(wire,rowPositions,(function(origin,cp){var rowBar=function(r,x,y,w,h){var bar=SugarElement.fromTag("div");return setAll(bar,{position:"absolute",left:x+"px",top:y-h/2+"px",height:h+"px",width:w+"px"}),setAll$1(bar,{"data-row":r,role:"presentation"}),bar}(cp.row,position.left-origin.left,cp.y-origin.top,tableWidth,7);return add(rowBar,resizeRowBar),rowBar}))},refreshGrid=function(warhouse,wire,table,rows,cols){var position=absolute(table),isResizable=wire.isResizable,rowPositions=rows.length>0?height.positions(rows,table):[],resizableRowBars=rowPositions.length>0?function(warehouse,isResizable){return bind$2(warehouse.all,(function(row,i){return isResizable(row.element)?[i]:[]}))}(warhouse,isResizable):[],resizableRowPositions=filter$2(rowPositions,(function(_pos,i){return exists(resizableRowBars,(function(barIndex){return i===barIndex}))}));refreshRow(wire,resizableRowPositions,position,getOuter$2(table));var colPositions=cols.length>0?width.positions(cols,table):[],resizableColBars=colPositions.length>0?function(warehouse,isResizable){var resizableCols=[];return range$1(warehouse.grid.columns,(function(index){Warehouse.getColumnAt(warehouse,index).map((function(col){return col.element})).forall(isResizable)&&resizableCols.push(index)})),filter$2(resizableCols,(function(colIndex){var columnCells=Warehouse.filterItems(warehouse,(function(cell){return cell.column===colIndex}));return forall(columnCells,(function(cell){return isResizable(cell.element)}))}))}(warhouse,isResizable):[],resizableColPositions=filter$2(colPositions,(function(_pos,i){return exists(resizableColBars,(function(barIndex){return i===barIndex}))}));refreshCol(wire,resizableColPositions,position,getOuter$1(table))},refresh=function(wire,table){if(destroy(wire),wire.isResizable(table)){var warehouse=Warehouse.fromTable(table),rows$1=rows(warehouse),cols=columns(warehouse);refreshGrid(warehouse,wire,table,rows$1,cols)}},each=function(wire,f){var bars=descendants(wire.parent(),"."+resizeBar);each$2(bars,f)},hide=function(wire){each(wire,(function(bar){set$1(bar,"display","none")}))},show=function(wire){each(wire,(function(bar){set$1(bar,"display","block")}))},resizeBarDragging=resolve("resizer-bar-dragging"),BarManager=function(wire){var mutation=BarMutation(),resizing=function(mutation,settings){void 0===settings&&(settings={});var mode=void 0!==settings.mode?settings.mode:MouseDrag;return setup(mutation,mode,settings)}(mutation,{}),hoverTable=Optional.none(),getResizer=function(element,type){return Optional.from(get$b(element,type))};mutation.events.drag.bind((function(event){getResizer(event.target,"data-row").each((function(_dataRow){var currentRow=getCssValue(event.target,"top");set$1(event.target,"top",currentRow+event.yDelta+"px")})),getResizer(event.target,"data-column").each((function(_dataCol){var currentCol=getCssValue(event.target,"left");set$1(event.target,"left",currentCol+event.xDelta+"px")}))}));var getDelta=function(target,dir){return getCssValue(target,dir)-getAttrValue(target,"data-initial-"+dir,0)};resizing.events.stop.bind((function(){mutation.get().each((function(target){hoverTable.each((function(table){getResizer(target,"data-row").each((function(row){var delta=getDelta(target,"top");remove$7(target,"data-initial-top"),events.trigger.adjustHeight(table,delta,parseInt(row,10))})),getResizer(target,"data-column").each((function(column){var delta=getDelta(target,"left");remove$7(target,"data-initial-left"),events.trigger.adjustWidth(table,delta,parseInt(column,10))})),refresh(wire,table)}))}))}));var handler=function(target,dir){events.trigger.startAdjust(),mutation.assign(target),set$2(target,"data-initial-"+dir,getCssValue(target,dir)),add(target,resizeBarDragging),set$1(target,"opacity","0.2"),resizing.go(wire.parent())},mousedown=bind(wire.parent(),"mousedown",(function(event){var element;element=event.target,has(element,resizeRowBar)&&handler(event.target,"top"),function(element){return has(element,resizeColBar)}(event.target)&&handler(event.target,"left")})),isRoot=function(e){return eq$1(e,wire.view())},mouseover=bind(wire.view(),"mouseover",(function(event){var target;(target=event.target,closest$1(target,"table",isRoot).filter(isEditable$1)).fold((function(){inBody(event.target)&&destroy(wire)}),(function(table){hoverTable=Optional.some(table),refresh(wire,table)}))})),events=create$4({adjustHeight:Event(["table","delta","row"]),adjustWidth:Event(["table","delta","column"]),startAdjust:Event([])});return{destroy:function(){mousedown.unbind(),mouseover.unbind(),resizing.destroy(),destroy(wire)},refresh:function(tbl){refresh(wire,tbl)},on:resizing.on,off:resizing.off,hideBars:curry(hide,wire),showBars:curry(show,wire),events:events.registry}},TableResize_create=function(wire,resizing,lazySizing){var hdirection=height,vdirection=width,manager=BarManager(wire),events=create$4({beforeResize:Event(["table","type"]),afterResize:Event(["table","type"]),startDrag:Event([])});return manager.events.adjustHeight.bind((function(event){var table=event.table;events.trigger.beforeResize(table,"row");var delta=hdirection.delta(event.delta,table);adjustHeight(table,delta,event.row,hdirection),events.trigger.afterResize(table,"row")})),manager.events.startAdjust.bind((function(_event){events.trigger.startDrag()})),manager.events.adjustWidth.bind((function(event){var table=event.table;events.trigger.beforeResize(table,"col");var delta=vdirection.delta(event.delta,table),tableSize=lazySizing(table);adjustWidth(table,delta,event.column,resizing,tableSize),events.trigger.afterResize(table,"col")})),{on:manager.on,off:manager.off,hideBars:manager.hideBars,showBars:manager.showBars,destroy:manager.destroy,events:events.registry}},fireNewRow=function(editor,row){return editor.fire("newrow",{node:row})},fireNewCell=function(editor,cell){return editor.fire("newcell",{node:cell})},fireTableModified=function(editor,table,data){editor.fire("TableModified",__assign(__assign({},data),{table:table}))},styleModified={structure:!1,style:!0},structureModified={structure:!0,style:!1},styleAndStructureModified={structure:!0,style:!0},defaultStyles={"border-collapse":"collapse",width:"100%"},defaultCellBorderWidths=range$1(5,(function(i){var size=i+1+"px";return{title:size,value:size}})),defaultCellBorderStyles=map$1(["Solid","Dotted","Dashed","Double","Groove","Ridge","Inset","Outset","None","Hidden"],(function(type){return{title:type,value:type.toLowerCase()}})),defaultAttributes={border:"1"},getTableSizingMode=function(editor){return editor.getParam("table_sizing_mode","auto")},getTableResponseWidth=function(editor){return editor.getParam("table_responsive_width")},getTableBorderWidths=function(editor){return editor.getParam("table_border_widths",defaultCellBorderWidths,"array")},getTableBorderStyles=function(editor){return editor.getParam("table_border_styles",defaultCellBorderStyles,"array")},getDefaultAttributes=function(editor){return editor.getParam("table_default_attributes",defaultAttributes,"object")},getDefaultStyles=function(editor){return editor.getParam("table_default_styles",function(editor){var _a;if(isPixelsForced(editor)){var dom=editor.dom,parentBlock=null!==(_a=dom.getParent(editor.selection.getStart(),dom.isBlock))&&void 0!==_a?_a:editor.getBody(),contentWidth=getInner(SugarElement.fromDom(parentBlock));return __assign(__assign({},defaultStyles),{width:contentWidth+"px"})}return isResponsiveForced(editor)?filter$1(defaultStyles,(function(_value,key){return"width"!==key})):defaultStyles}(editor),"object")},hasAdvancedCellTab=function(editor){return editor.getParam("table_cell_advtab",!0,"boolean")},hasAdvancedRowTab=function(editor){return editor.getParam("table_row_advtab",!0,"boolean")},hasAdvancedTableTab=function(editor){return editor.getParam("table_advtab",!0,"boolean")},shouldStyleWithCss=function(editor){return editor.getParam("table_style_by_css",!1,"boolean")},getCellClassList=function(editor){return editor.getParam("table_cell_class_list",[],"array")},getTableClassList=function(editor){return editor.getParam("table_class_list",[],"array")},isPercentagesForced=function(editor){return"relative"===getTableSizingMode(editor)||!0===getTableResponseWidth(editor)},isPixelsForced=function(editor){return"fixed"===getTableSizingMode(editor)||!1===getTableResponseWidth(editor)},isResponsiveForced=function(editor){return"responsive"===getTableSizingMode(editor)},useColumnGroup=function(editor){return editor.getParam("table_use_colgroups",!1,"boolean")},getTableHeaderType=function(editor){var value=editor.getParam("table_header_type","section","string");return contains$2(["section","cells","sectionCells","auto"],value)?value:"section"},getColumnResizingBehaviour=function(editor){var givenMode=editor.getParam("table_column_resizing","preservetable","string");return find$1(["preservetable","resizetable"],(function(mode){return mode===givenMode})).getOr("preservetable")},isPreserveTableColumnResizing=function(editor){return"preservetable"===getColumnResizingBehaviour(editor)},isResizeTableColumnResizing=function(editor){return"resizetable"===getColumnResizingBehaviour(editor)},getCloneElements=function(editor){var cloneElements=editor.getParam("table_clone_elements");return isString(cloneElements)?Optional.some(cloneElements.split(/[ ,]/)):Array.isArray(cloneElements)?Optional.some(cloneElements):Optional.none()},getTableBackgroundColorMap=function(editor){return editor.getParam("table_background_color_map",[],"array")},getTableBorderColorMap=function(editor){return editor.getParam("table_border_color_map",[],"array")},get$4=function(editor,table){return isPercentagesForced(editor)?TableSize_percentageSize(table):isPixelsForced(editor)?TableSize_pixelSize(table):TableSize_getTableSize(table)},cleanupLegacyAttributes=function(element){remove$7(element,"width")},enforcePercentage=function(table){var newWidth=getPercentTableWidth(table);redistribute(table,Optional.some(newWidth),Optional.none()),cleanupLegacyAttributes(table)},enforcePixels=function(table){var newWidth=function(table){return get$8(table)+"px"}(table);redistribute(table,Optional.some(newWidth),Optional.none()),cleanupLegacyAttributes(table)},enforceNone=function(table){remove$6(table,"width");var columns=columns$1(table),rowElements=columns.length>0?columns:cells$1(table);each$2(rowElements,(function(cell){remove$6(cell,"width"),cleanupLegacyAttributes(cell)})),cleanupLegacyAttributes(table)},createContainer=function(){var container=SugarElement.fromTag("div");return setAll(container,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),append$1(getBody$1(SugarElement.fromDom(document)),container),container},isResizable=function(elm){return"false"!==get$b(elm,"data-mce-resize")},getResizeHandler=function(editor){var startW,startRawW,selectionRng=Optional.none(),resize=Optional.none(),wire=Optional.none(),isTable=function(elm){return"TABLE"===elm.nodeName},lazyResize=function(){return resize},lazySizing=function(table){return get$4(editor,table)},lazyResizingBehaviour=function(){return isPreserveTableColumnResizing(editor)?preserveTable():resizeTable()},afterCornerResize=function(table,origin,width){var isRightEdgeResize=endsWith(origin,"e");if(""===startRawW&&enforcePercentage(table),width!==startW&&""!==startRawW){set$1(table,"width",startRawW);var resizing=lazyResizingBehaviour(),tableSize=lazySizing(table),col=isPreserveTableColumnResizing(editor)||isRightEdgeResize?function(table){return getGridSize(table).columns}(table)-1:0;adjustWidth(table,width-startW,col,resizing,tableSize)}else if(function(value){return/^(\d+(\.\d+)?)%$/.test(value)}(startRawW)){var percentW=parseFloat(startRawW.replace("%",""));set$1(table,"width",width*percentW/startW+"%")}(function(value){return/^(\d+(\.\d+)?)px$/.test(value)})(startRawW)&&function(table){var warehouse=Warehouse.fromTable(table);Warehouse.hasColumns(warehouse)||each$2(cells$1(table),(function(cell){var computedWidth=get$a(cell,"width");set$1(cell,"width",computedWidth),remove$7(cell,"width")}))}(table)};return editor.on("init",(function(){var rawWire=function(editor,isResizable){return editor.inline?ResizeWire_body(getBody(editor),createContainer(),isResizable):ResizeWire_only(SugarElement.fromDom(editor.getDoc()),isResizable)}(editor,isResizable);if(wire=Optional.some(rawWire),function(editor){var objectResizing=editor.getParam("object_resizing",!0);return isString(objectResizing)?"table"===objectResizing:objectResizing}(editor)&&function(editor){return editor.getParam("table_resize_bars",!0,"boolean")}(editor)){var resizing=lazyResizingBehaviour(),sz=TableResize_create(rawWire,resizing,lazySizing);sz.on(),sz.events.startDrag.bind((function(_event){selectionRng=Optional.some(editor.selection.getRng())})),sz.events.beforeResize.bind((function(event){var rawTable=event.table.dom;!function(editor,target,width,height,origin){editor.fire("ObjectResizeStart",{target:target,width:width,height:height,origin:origin})}(editor,rawTable,getPixelWidth(rawTable),getPixelHeight(rawTable),"bar-"+event.type)})),sz.events.afterResize.bind((function(event){var table=event.table,rawTable=table.dom;removeDataStyle(table),selectionRng.each((function(rng){editor.selection.setRng(rng),editor.focus()})),function(editor,target,width,height,origin){editor.fire("ObjectResized",{target:target,width:width,height:height,origin:origin})}(editor,rawTable,getPixelWidth(rawTable),getPixelHeight(rawTable),"bar-"+event.type),editor.undoManager.add()})),resize=Optional.some(sz)}})),editor.on("ObjectResizeStart",(function(e){var targetElm=e.target;if(isTable(targetElm)){var table=SugarElement.fromDom(targetElm);each$2(editor.dom.select(".mce-clonedresizable"),(function(clone){editor.dom.addClass(clone,"mce-"+getColumnResizingBehaviour(editor)+"-columns")})),!isPixelSizing(table)&&isPixelsForced(editor)?enforcePixels(table):!isPercentSizing(table)&&isPercentagesForced(editor)&&enforcePercentage(table),isNoneSizing(table)&&startsWith(e.origin,"bar-")&&enforcePercentage(table),startW=e.width,startRawW=isResponsiveForced(editor)?"":function(editor,elm){var raw=editor.dom.getStyle(elm,"width")||editor.dom.getAttrib(elm,"width");return Optional.from(raw).filter(isNotEmpty)}(editor,targetElm).getOr("")}})),editor.on("ObjectResized",(function(e){var targetElm=e.target;if(isTable(targetElm)){var table=SugarElement.fromDom(targetElm),origin_1=e.origin;startsWith(origin_1,"corner-")&&afterCornerResize(table,origin_1,e.width),removeDataStyle(table),fireTableModified(editor,table.dom,styleModified)}})),editor.on("SwitchMode",(function(){lazyResize().each((function(resize){editor.mode.isReadOnly()?resize.hideBars():resize.showBars()}))})),{lazyResize:lazyResize,lazyWire:function(){return wire.getOr(ResizeWire_only(SugarElement.fromDom(editor.getBody()),isResizable))},destroy:function(){resize.each((function(sz){sz.destroy()})),wire.each((function(w){!function(editor,wire){editor.inline&&remove$5(wire.parent())}(editor,w)}))}}},point=function(element,offset){return{element:element,offset:offset}},scan$1=function(universe,element,direction){return universe.property().isText(element)&&0===universe.property().getText(element).trim().length||universe.property().isComment(element)?direction(element).bind((function(elem){return scan$1(universe,elem,direction).orThunk((function(){return Optional.some(elem)}))})):Optional.none()},toEnd=function(universe,element){return universe.property().isText(element)?universe.property().getText(element).length:universe.property().children(element).length},freefallRtl$2=function(universe,element){var candidate=scan$1(universe,element,universe.query().prevSibling).getOr(element);if(universe.property().isText(candidate))return point(candidate,toEnd(universe,candidate));var children=universe.property().children(candidate);return children.length>0?freefallRtl$2(universe,children[children.length-1]):point(candidate,toEnd(universe,candidate))},freefallRtl$1=freefallRtl$2,universe$2=DomUniverse(),halve=function(main,other){1===getSpan(main,"colspan")&&function(cell){return getRawWidth$1(cell).bind((function(w){return parse(w,["fixed","relative","empty"])}))}(main).each((function(w){var newWidth=w.value/2;setGenericWidth(main,newWidth,w.unit),setGenericWidth(other,newWidth,w.unit)}))},isHeaderCell=isTag("th"),isHeaderCells=function(cells){return forall(cells,(function(cell){return isHeaderCell(cell.element)}))},getRowHeaderType=function(isHeaderRow,isHeaderCells){return isHeaderRow&&isHeaderCells?"sectionCells":isHeaderRow?"section":"cells"},getRowType$1=function(row){var isHeaderRow="thead"===row.section,isHeaderCells=is(findCommonCellType(row.cells),"th");return isHeaderRow||isHeaderCells?{type:"header",subType:getRowHeaderType(isHeaderRow,isHeaderCells)}:"tfoot"===row.section?{type:"footer"}:{type:"body"}},findCommonCellType=function(cells){var headerCells=filter$2(cells,(function(cell){return isHeaderCell(cell.element)}));return 0===headerCells.length?Optional.some("td"):headerCells.length===cells.length?Optional.some("th"):Optional.none()},transformCell=function(cell,comparator,substitution){return elementnew(substitution(cell.element,comparator),!0,cell.isLocked)},transformRow=function(row,section){return row.section!==section?rowcells(row.element,row.cells,section,row.isNew):row},section=function(){return{transformRow:transformRow,transformCell:function(cell,comparator,substitution){var newCell=substitution(cell.element,comparator),fixedCell="td"!==name(newCell)?function(original,tag){var nu=shallowAs(original,tag);before$4(original,nu);var children=children$3(original);return append(nu,children),remove$5(original),nu}(newCell,"td"):newCell;return elementnew(fixedCell,cell.isNew,cell.isLocked)}}},sectionCells=function(){return{transformRow:transformRow,transformCell:transformCell}},cells=function(){return{transformRow:function(row,section){return transformRow(row,"thead"===section?"tbody":section)},transformCell:transformCell}},TableSection_getTableSectionType=function(table,fallback){switch(function(warehouse){return findMap(warehouse.all,(function(row){var rowType=getRowType$1(row);return"header"===rowType.type?Optional.from(rowType.subType):Optional.none()}))}(Warehouse.fromTable(table)).getOr(fallback)){case"section":return section();case"sectionCells":return sectionCells();case"cells":return cells()}},TableSection_section=section,TableSection_sectionCells=sectionCells,TableSection_cells=cells,TableSection_fallback=function(){return{transformRow:identity,transformCell:transformCell}},setIfNot=function(element,property,value,ignore){value===ignore?remove$7(element,property):set$2(element,property,value)},insert$1=function(table,selector,element){last$2(children$1(table,selector)).fold((function(){return prepend(table,element)}),(function(child){return after$5(child,element)}))},render$1=function(table,grid){var newRows=[],newCells=[],syncRows=function(gridSection){return map$1(gridSection,(function(row){row.isNew&&newRows.push(row.element);var tr=row.element;return empty(tr),each$2(row.cells,(function(cell){cell.isNew&&newCells.push(cell.element),setIfNot(cell.element,"colspan",cell.colspan,1),setIfNot(cell.element,"rowspan",cell.rowspan,1),append$1(tr,cell.element)})),tr}))},syncColGroup=function(gridSection){return bind$2(gridSection,(function(colGroup){return map$1(colGroup.cells,(function(col){return setIfNot(col.element,"span",col.colspan,1),col.element}))}))},renderSection=function(gridSection,sectionName){var section=function(table,sectionName){var section=child$1(table,sectionName).getOrThunk((function(){var newSection=SugarElement.fromTag(sectionName,owner(table).dom);return"thead"===sectionName?insert$1(table,"caption,colgroup",newSection):"colgroup"===sectionName?insert$1(table,"caption",newSection):append$1(table,newSection),newSection}));return empty(section),section}(table,sectionName),sectionElems=("colgroup"===sectionName?syncColGroup:syncRows)(gridSection);append(section,sectionElems)},renderOrRemoveSection=function(gridSection,sectionName){gridSection.length>0?renderSection(gridSection,sectionName):function(sectionName){child$1(table,sectionName).each(remove$5)}(sectionName)},headSection=[],bodySection=[],footSection=[],columnGroupsSection=[];return each$2(grid,(function(row){switch(row.section){case"thead":headSection.push(row);break;case"tbody":bodySection.push(row);break;case"tfoot":footSection.push(row);break;case"colgroup":columnGroupsSection.push(row)}})),renderOrRemoveSection(columnGroupsSection,"colgroup"),renderOrRemoveSection(headSection,"thead"),renderOrRemoveSection(bodySection,"tbody"),renderOrRemoveSection(footSection,"tfoot"),{newRows:newRows,newCells:newCells}},findDiff=function(xs,comp){if(0===xs.length)return 0;var first=xs[0];return findIndex(xs,(function(x){return!comp(first.element,x.element)})).getOr(xs.length)},subgrid=function(grid,row,column,comparator){var gridRow=function(grid,index){return grid[index]}(grid,row),isColRow="colgroup"===gridRow.section;return{colspan:findDiff(gridRow.cells.slice(column),comparator),rowspan:isColRow?1:findDiff(function(grid,index){return map$1(grid,(function(row){return getCell(row,index)}))}(grid.slice(row),column),comparator)}},toDetails=function(grid,comparator){var seen=map$1(grid,(function(row){return map$1(row.cells,never)}));return map$1(grid,(function(row,rowIndex){var details=bind$2(row.cells,(function(cell,columnIndex){if(!1===seen[rowIndex][columnIndex]){var result=subgrid(grid,rowIndex,columnIndex,comparator);return function(rowIndex,columnIndex,rowspan,colspan){for(var row=rowIndex;row<rowIndex+rowspan;row++)for(var column=columnIndex;column<columnIndex+colspan;column++)seen[row][column]=!0}(rowIndex,columnIndex,result.rowspan,result.colspan),[(element=cell.element,rowspan=result.rowspan,colspan=result.colspan,isNew=cell.isNew,{element:element,rowspan:rowspan,colspan:colspan,isNew:isNew})]}return[];var element,rowspan,colspan,isNew}));return function(element,cells,section,isNew){return{element:element,cells:cells,section:section,isNew:isNew}}(row.element,details,row.section,row.isNew)}))},toGrid=function(warehouse,generators,isNew){var grid=[];each$2(warehouse.colgroups,(function(colgroup){for(var colgroupCols=[],columnIndex=0;columnIndex<warehouse.grid.columns;columnIndex++){var element=Warehouse.getColumnAt(warehouse,columnIndex).map((function(column){return elementnew(column.element,isNew,!1)})).getOrThunk((function(){return elementnew(generators.colGap(),!0,!1)}));colgroupCols.push(element)}grid.push(rowcells(colgroup.element,colgroupCols,"colgroup",isNew))}));for(var rowIndex=0;rowIndex<warehouse.grid.rows;rowIndex++){for(var rowCells=[],columnIndex=0;columnIndex<warehouse.grid.columns;columnIndex++){var element=Warehouse.getAt(warehouse,rowIndex,columnIndex).map((function(item){return elementnew(item.element,isNew,item.isLocked)})).getOrThunk((function(){return elementnew(generators.gap(),!0,!1)}));rowCells.push(element)}var rowDetail=warehouse.all[rowIndex],row=rowcells(rowDetail.element,rowCells,rowDetail.section,isNew);grid.push(row)}return grid},toDetailList=function(grid){return toDetails(grid,eq$1)},findInWarehouse=function(warehouse,element){return findMap(warehouse.all,(function(r){return find$1(r.cells,(function(e){return eq$1(element,e.element)}))}))},extractCells=function(warehouse,target,predicate){var details=map$1(target.selection,(function(cell$1){return cell(cell$1).bind((function(lc){return findInWarehouse(warehouse,lc)})).filter(predicate)})),cells=cat(details);return someIf(cells.length>0,cells)},run=function(operation,extract,adjustment,postAction,genWrappers){return function(wire,table,target,generators,behaviours){var warehouse=Warehouse.fromTable(table),tableSection=Optional.from(null==behaviours?void 0:behaviours.section).getOrThunk(TableSection_fallback);return extract(warehouse,target).map((function(info){var model=function(warehouse,generators){return toGrid(warehouse,generators,!1)}(warehouse,generators),result=operation(model,info,eq$1,genWrappers(generators),tableSection),lockedColumns=getLockedColumnsFromGrid(result.grid);return{info:info,grid:toDetailList(result.grid),cursor:result.cursor,lockedColumns:lockedColumns}})).bind((function(out){var newElements=render$1(table,out.grid),tableSizing=Optional.from(null==behaviours?void 0:behaviours.sizing).getOrThunk((function(){return TableSize_getTableSize(table)})),resizing=Optional.from(null==behaviours?void 0:behaviours.resize).getOrThunk(preserveTable);return adjustment(table,out.grid,out.info,{sizing:tableSizing,resize:resizing,section:tableSection}),postAction(table),refresh(wire,table),remove$7(table,LOCKED_COL_ATTR),out.lockedColumns.length>0&&set$2(table,LOCKED_COL_ATTR,out.lockedColumns.join(",")),Optional.some({cursor:out.cursor,newRows:newElements.newRows,newCells:newElements.newCells})}))}},onPasteByEditor=function(warehouse,target){return extractCells(warehouse,target,always).map((function(cells){return{cells:cells,generators:target.generators,clipboard:target.clipboard}}))},onCells=function(warehouse,target){return extractCells(warehouse,target,always)},onUnlockedCells=function(warehouse,target){return extractCells(warehouse,target,(function(detail){return!detail.isLocked}))},allUnlocked=function(warehouse,cells){return forall(cells,(function(cell){return function(warehouse,cell){return findInWarehouse(warehouse,cell).exists((function(detail){return!detail.isLocked}))}(warehouse,cell)}))},onUnlockedMergable=function(warehouse,target){return function(_warehouse,target){return target.mergable}(0,target).filter((function(mergeable){return allUnlocked(warehouse,mergeable.cells)}))},onUnlockedUnmergable=function(warehouse,target){return function(_warehouse,target){return target.unmergable}(0,target).filter((function(cells){return allUnlocked(warehouse,cells)}))},unmerge=function(grid,target,comparator,substitution){for(var rows=extractGridDetails(grid).rows,first=!0,i=0;i<rows.length;i++)for(var j=0;j<cellLength(rows[0]);j++){var row=rows[i],currentCell=getCell(row,j),isToReplace=comparator(currentCell.element,target);!0===isToReplace&&!1===first?mutateCell(row,j,elementnew(substitution(),!0,currentCell.isLocked)):!0===isToReplace&&(first=!1)}return grid},splitRows=function(grid,index,comparator,substitution){var rows=extractGridDetails(grid).rows;if(index>0&&index<rows.length){var cells=function(row,comparator){return foldl(row,(function(rest,cell){return exists(rest,(function(currentCell){return comparator(currentCell.element,cell.element)}))?rest:rest.concat([cell])}),[])}(rows[index-1].cells,comparator);each$2(cells,(function(cell){for(var replacement=Optional.none(),i=index;i<rows.length;i++)for(var _loop_1=function(j){var row=rows[i],current=getCell(row,j);comparator(current.element,cell.element)&&(replacement.isNone()&&(replacement=Optional.some(substitution())),replacement.each((function(sub){mutateCell(row,j,elementnew(sub,!0,current.isLocked))})))},j=0;j<cellLength(rows[0]);j++)_loop_1(j)}))}return grid},value$1=function(o){return{isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:function(_opt){return value$1(o)},orThunk:function(_f){return value$1(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$1(f(o))},mapError:function(_f){return value$1(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}},error=function(message){return{isValue:never,isError:always,getOr:identity,getOrThunk:function(f){return f()},getOrDie:function(){return(msg=String(message),function(){throw new Error(msg)})();var msg},or:identity,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error(message)},mapError:function(f){return error(f(message))},each:noop,bind:function(_f){return error(message)},exists:never,forall:always,toOptional:Optional.none}},Result={value:value$1,error:error,fromOption:function(opt,err){return opt.fold((function(){return error(err)}),value$1)}},measureWidth=function(gridA,gridB){return{rowDelta:0,colDelta:cellLength(gridA[0])-cellLength(gridB[0])}},measureHeight=function(gridA,gridB){return{rowDelta:gridA.length-gridB.length,colDelta:0}},generateElements=function(amount,row,generators,isLocked){var generator="colgroup"===row.section?generators.col:generators.cell;return range$1(amount,(function(idx){return elementnew(generator(),!0,isLocked(idx))}))},rowFill=function(grid,amount,generators,lockedColumns){var exampleRow=grid[grid.length-1];return grid.concat(range$1(amount,(function(){var generator="colgroup"===exampleRow.section?generators.colgroup:generators.row,row=clone$1(exampleRow,generator,identity),elements=generateElements(row.cells.length,row,generators,(function(idx){return has$1(lockedColumns,idx.toString())}));return setCells(row,elements)})))},colFill=function(grid,amount,generators,startIndex){return map$1(grid,(function(row){var newChildren=generateElements(amount,row,generators,never);return addCells(row,startIndex,newChildren)}))},tailor=function(gridA,delta,generators){var fillCols=delta.colDelta<0?colFill:identity,fillRows=delta.rowDelta<0?rowFill:identity,lockedColumns=getLockedColumnsFromGrid(gridA),gridWidth=cellLength(gridA[0]),isLastColLocked=exists(lockedColumns,(function(locked){return locked===gridWidth-1})),modifiedCols=fillCols(gridA,Math.abs(delta.colDelta),generators,isLastColLocked?gridWidth-1:gridWidth),newLockedColumns=getLockedColumnsFromGrid(modifiedCols);return fillRows(modifiedCols,Math.abs(delta.rowDelta),generators,mapToObject(newLockedColumns,always))},isSpanning=function(grid,row,col,comparator){var matching=curry(comparator,getCell(grid[row],col).element),currentRow=grid[row];return grid.length>1&&cellLength(currentRow)>1&&(col>0&&matching(getCellElement(currentRow,col-1))||col<currentRow.cells.length-1&&matching(getCellElement(currentRow,col+1))||row>0&&matching(getCellElement(grid[row-1],col))||row<grid.length-1&&matching(getCellElement(grid[row+1],col)))},getLockedColumnsWithinBounds=function(startAddress,grid,lockedColumns){return filter$2(lockedColumns,(function(colNum){return colNum>=startAddress.column&&colNum<=cellLength(grid[0])+startAddress.column}))},merge$1=function(startAddress,gridA,gridB,generator,comparator){var lockedColumns=getLockedColumnsFromGrid(gridA),validStartAddress=function(currentStartAddress,grid,lockedColumns){var gridColLength=cellLength(grid[0]),adjustedRowAddress=extractGridDetails(grid).cols.length+currentStartAddress.row,possibleColAddresses=range$1(gridColLength-currentStartAddress.column,(function(num){return num+currentStartAddress.column}));return{row:adjustedRowAddress,column:find$1(possibleColAddresses,(function(num){return forall(lockedColumns,(function(col){return col!==num}))})).getOr(gridColLength-1)}}(startAddress,gridA,lockedColumns),gridBRows=extractGridDetails(gridB).rows,lockedColumnsWithinBounds=getLockedColumnsWithinBounds(validStartAddress,gridBRows,lockedColumns);return function(startAddress,gridA,gridB){if(startAddress.row>=gridA.length||startAddress.column>cellLength(gridA[0]))return Result.error("invalid start address out of table bounds, row: "+startAddress.row+", column: "+startAddress.column);var rowRemainder=gridA.slice(startAddress.row),colRemainder=rowRemainder[0].cells.slice(startAddress.column),colRequired=cellLength(gridB[0]),rowRequired=gridB.length;return Result.value({rowDelta:rowRemainder.length-rowRequired,colDelta:colRemainder.length-colRequired})}(validStartAddress,gridA,gridBRows).map((function(diff){var delta=__assign(__assign({},diff),{colDelta:diff.colDelta-lockedColumnsWithinBounds.length}),fittedGrid=tailor(gridA,delta,generator),newLockedColumns=getLockedColumnsFromGrid(fittedGrid),newLockedColumnsWithinBounds=getLockedColumnsWithinBounds(validStartAddress,gridBRows,newLockedColumns);return function(startAddress,gridA,gridB,generator,comparator,lockedColumns){for(var startRow=startAddress.row,startCol=startAddress.column,endRow=startRow+gridB.length,endCol=startCol+cellLength(gridB[0])+lockedColumns.length,lockedColumnObj=mapToObject(lockedColumns,always),r=startRow;r<endRow;r++)for(var skippedCol=0,c=startCol;c<endCol;c++)if(lockedColumnObj[c])skippedCol++;else{isSpanning(gridA,r,c,comparator)&&unmerge(gridA,getCellElement(gridA[r],c),comparator,generator.cell);var gridBColIndex=c-startCol-skippedCol,newCell=getCell(gridB[r-startRow],gridBColIndex),newCellElm=newCell.element,replacement=generator.replace(newCellElm);mutateCell(gridA[r],c,elementnew(replacement,!0,newCell.isLocked))}return gridA}(validStartAddress,fittedGrid,gridBRows,generator,comparator,newLockedColumnsWithinBounds)}))},insertCols=function(index,gridA,gridB,generator,comparator){!function(grid,index,comparator,substitution){index>0&&index<grid[0].cells.length&&each$2(grid,(function(row){var prevCell=row.cells[index-1],current=row.cells[index];comparator(current.element,prevCell.element)&&mutateCell(row,index,elementnew(substitution(),!0,current.isLocked))}))}(gridA,index,comparator,generator.cell);var delta=measureHeight(gridB,gridA),fittedNewGrid=tailor(gridB,delta,generator),secondDelta=measureHeight(gridA,fittedNewGrid),fittedOldGrid=tailor(gridA,secondDelta,generator);return map$1(fittedOldGrid,(function(gridRow,i){return addCells(gridRow,index,fittedNewGrid[i].cells)}))},insertRows=function(index,gridA,gridB,generator,comparator){splitRows(gridA,index,comparator,generator.cell);var locked=getLockedColumnsFromGrid(gridA),diff=measureWidth(gridA,gridB),delta=__assign(__assign({},diff),{colDelta:diff.colDelta-locked.length}),fittedOldGrid=tailor(gridA,delta,generator),_a=extractGridDetails(fittedOldGrid),oldCols=_a.cols,oldRows=_a.rows,newLocked=getLockedColumnsFromGrid(fittedOldGrid),secondDiff=measureWidth(gridB,gridA),secondDelta=__assign(__assign({},secondDiff),{colDelta:secondDiff.colDelta+newLocked.length}),fittedGridB=function(grid,generators,lockedColumns){return map$1(grid,(function(row){return foldl(lockedColumns,(function(acc,colNum){var newChild=generateElements(1,row,generators,always)[0];return addCell(acc,colNum,newChild)}),row)}))}(gridB,generator,newLocked),fittedNewGrid=tailor(fittedGridB,secondDelta,generator);return oldCols.concat(oldRows.slice(0,index)).concat(fittedNewGrid).concat(oldRows.slice(index,oldRows.length))},insertRowAt=function(grid,index,example,comparator,substitution){var _a=extractGridDetails(grid),rows=_a.rows,cols=_a.cols,before=rows.slice(0,index),after=rows.slice(index),newRow=function(row,cloneCell,comparator,substitution){return clone$1(row,(function(elem){return substitution(elem,comparator)}),cloneCell)}(rows[example],(function(ex,c){return index>0&&index<rows.length&&comparator(getCellElement(rows[index-1],c),getCellElement(rows[index],c))?getCell(rows[index],c):elementnew(substitution(ex.element,comparator),!0,ex.isLocked)}),comparator,substitution);return cols.concat(before).concat([newRow]).concat(after)},insertColumnAt=function(grid,index,example,comparator,substitution){return map$1(grid,(function(row){var withinSpan=index>0&&index<cellLength(row)&&comparator(getCellElement(row,index-1),getCellElement(row,index)),sub=function(row,column,section,withinSpan,example,comparator,substitution){if("colgroup"!==section&&withinSpan)return getCell(row,column);var cell=getCell(row,example);return elementnew(substitution(cell.element,comparator),!0,!1)}(row,index,row.section,withinSpan,example,comparator,substitution);return addCell(row,index,sub)}))},isDuplicatedCell=function(grid,rowIndex,colIndex,comparator){return function(grid,rowIndex,colIndex,comparator){return void 0!==getCellElement(grid[rowIndex],colIndex)&&rowIndex>0&&comparator(getCellElement(grid[rowIndex-1],colIndex),getCellElement(grid[rowIndex],colIndex))}(grid,rowIndex,colIndex,comparator)||function(row,index,comparator){return index>0&&comparator(getCellElement(row,index-1),getCellElement(row,index))}(grid[rowIndex],colIndex,comparator)},determineScope=function(applyScope,element,newScope,isInHeader){var getScope=function(scope){return function(scope){return"row"===scope?hasRowspan(element):hasColspan(element)}(scope)?scope+"group":scope};return applyScope?isHeaderCell(element)?getScope(newScope):null:isInHeader&&isHeaderCell(element)?getScope("row"===newScope?"col":"row"):null},replace=function(cell,comparator,substitute){return elementnew(substitute(cell.element,comparator),!0,cell.isLocked)},replaceIn=function(grid,targets,comparator,substitute,replacer,genScope,shouldReplace){return map$1(grid,(function(row,rowIndex){return function(gridRow,f){var cells=gridRow.cells,r=map$1(cells,f);return rowcells(gridRow.element,r,gridRow.section,gridRow.isNew)}(row,(function(cell,colIndex){if(function(cell){return exists(targets,(function(target){return comparator(cell.element,target.element)}))}(cell)){var newCell_1=shouldReplace(cell,rowIndex,colIndex)?replacer(cell,comparator,substitute):cell;return genScope(newCell_1,rowIndex,colIndex).each((function(scope){var element,attrs;element=newCell_1.element,attrs={scope:Optional.from(scope)},each$1(attrs,(function(v,k){v.fold((function(){remove$7(element,k)}),(function(value){rawSet(element.dom,k,value)}))}))})),newCell_1}return cell}))}))},getColumnCells=function(rows,columnIndex,comparator){return bind$2(rows,(function(row,i){return isDuplicatedCell(rows,i,columnIndex,comparator)?[]:[getCell(row,columnIndex)]}))},replaceColumns=function(grid,indexes,applyScope,comparator,substitution){var rows=extractGridDetails(grid).rows,targets=bind$2(indexes,(function(index){return getColumnCells(rows,index,comparator)})),rowHeaders=map$1(grid,(function(row){return isHeaderCells(row.cells)})),shouldReplaceCell=function(targetColumn,rowHeaders){return forall(rowHeaders,identity)&&isHeaderCells(targetColumn)?always:function(cell,rowIndex,_colIndex){return!("th"===name(cell.element)&&rowHeaders[rowIndex])}}(targets,rowHeaders),scopeGenerator=function(applyScope,rowHeaders){return function(cell,rowIndex){return Optional.some(determineScope(applyScope,cell.element,"row",rowHeaders[rowIndex]))}}(applyScope,rowHeaders);return replaceIn(grid,targets,comparator,substitution,replace,scopeGenerator,shouldReplaceCell)},replaceRows=function(grid,indexes,section,applyScope,comparator,substitution,tableSection){var _a=extractGridDetails(grid),cols=_a.cols,rows=_a.rows,targetRow=rows[indexes[0]],targets=bind$2(indexes,(function(index){return function(rows,rowIndex,comparator){var targetRow=rows[rowIndex];return bind$2(targetRow.cells,(function(item,i){return isDuplicatedCell(rows,rowIndex,i,comparator)?[]:[item]}))}(rows,index,comparator)})),columnHeaders=map$1(targetRow.cells,(function(_cell,index){return isHeaderCells(getColumnCells(rows,index,comparator))})),newRows=__spreadArray([],rows,!0);each$2(indexes,(function(index){newRows[index]=tableSection.transformRow(rows[index],section)}));var newGrid=cols.concat(newRows),shouldReplaceCell=function(targetRow,columnHeaders){return forall(columnHeaders,identity)&&isHeaderCells(targetRow.cells)?always:function(cell,_rowIndex,colIndex){return!("th"===name(cell.element)&&columnHeaders[colIndex])}}(targetRow,columnHeaders),scopeGenerator=function(applyScope,columnHeaders){return function(cell,rowIndex,columnIndex){return Optional.some(determineScope(applyScope,cell.element,"col",columnHeaders[columnIndex]))}}(applyScope,columnHeaders);return replaceIn(newGrid,targets,comparator,substitution,tableSection.transformCell,scopeGenerator,shouldReplaceCell)},replaceCells=function(grid,details,comparator,substitution){var rows=extractGridDetails(grid).rows,targetCells=map$1(details,(function(detail){return getCell(rows[detail.row],detail.column)}));return replaceIn(grid,targetCells,comparator,substitution,replace,Optional.none,always)},uniqueColumns=function(details){return foldl(details,(function(rest,detail){return exists(rest,(function(currentDetail){return currentDetail.column===detail.column}))?rest:rest.concat([detail])}),[]).sort((function(detailA,detailB){return detailA.column-detailB.column}))},isCol=isTag("col"),isColgroup=isTag("colgroup"),isRow$1=function(element){return"tr"===name(element)||isColgroup(element)},elementToData=function(element){return{element:element,colspan:getAttrValue(element,"colspan",1),rowspan:getAttrValue(element,"rowspan",1)}},getScopeAttribute=function(cell){return getOpt(cell,"scope").map((function(attribute){return attribute.substr(0,3)}))},Generators_modification=function(generators,toData){void 0===toData&&(toData=elementToData);var add=function(element){if(isRow$1(element))return isColgroup((data={element:element}).element)?generators.colgroup(data):generators.row(data);var data,replacement=function(data){return isCol(data.element)?generators.col(data):generators.cell(data)}(toData(element));return recent=Optional.some({item:element,replacement:replacement}),replacement},recent=Optional.none();return{getOrInit:function(element,comparator){return recent.fold((function(){return add(element)}),(function(p){return comparator(element,p.item)?p.replacement:add(element)}))}}},Generators_transform=function(tag){return function(generators){var list=[],makeNew=function(element){var attrs="td"===tag?{scope:null}:{},cell=generators.replace(element,tag,attrs);return list.push({item:element,sub:cell}),cell};return{replaceOrInit:function(element,comparator){return isRow$1(element)||isCol(element)?element:function(element,comparator){return find$1(list,(function(x){return comparator(x.item,element)}))}(element,comparator).fold((function(){return makeNew(element)}),(function(p){return comparator(element,p.item)?p.sub:makeNew(element)}))}}}},Generators_merging=function(generators){return{unmerge:function(cell){var scope=getScopeAttribute(cell);return scope.each((function(attribute){return set$2(cell,"scope",attribute)})),function(){var raw=generators.cell({element:cell,colspan:1,rowspan:1});return remove$6(raw,"width"),remove$6(cell,"width"),scope.each((function(attribute){return set$2(raw,"scope",attribute)})),raw}},merge:function(cells){return remove$6(cells[0],"width"),function(){var stringAttributes=cat(map$1(cells,getScopeAttribute));if(0===stringAttributes.length)return Optional.none();var baseScope_1=stringAttributes[0],scopes_1=["row","col"];return exists(stringAttributes,(function(attribute){return attribute!==baseScope_1&&contains$2(scopes_1,attribute)}))?Optional.none():Optional.from(baseScope_1)}().fold((function(){return remove$7(cells[0],"scope")}),(function(attribute){return set$2(cells[0],"scope",attribute+"group")})),constant(cells[0])}}},blockList=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],universe$1=DomUniverse(),isBlock=function(element){return function(universe,item){var tagName=universe.property().name(item);return contains$2(blockList,tagName)}(universe$1,element)},isList=function(element){return function(universe,item){var tagName=universe.property().name(item);return contains$2(["ol","ul"],tagName)}(universe$1,element)},isEmptyTag=function(element){return function(universe,item){return contains$2(["br","img","hr","input"],universe.property().name(item))}(universe$1,element)},merge=function(cells){var content,isBr=function(el){return"br"===name(el)},markCell=function(cell){return last$1(cell).bind((function(rightEdge){var rightSiblingIsBlock=nextSibling(rightEdge).map((function(rightSibling){return!!isBlock(rightSibling)||!!isEmptyTag(rightSibling)&&"img"!==name(rightSibling)})).getOr(!1);return parent(rightEdge).map((function(parent){return!0===rightSiblingIsBlock||function(el){return"li"===name(el)||ancestor$2(el,isList).isSome()}(parent)||isBr(rightEdge)||isBlock(parent)&&!eq$1(cell,parent)?[]:[SugarElement.fromTag("br")]}))})).getOr([])},contents=0===(content=bind$2(cells,(function(cell){var children=children$3(cell);return function(children){return forall(children,(function(c){return isBr(c)||isText(c)&&0===get$9(c).trim().length}))}(children)?[]:children.concat(markCell(cell))}))).length?[SugarElement.fromTag("br")]:content;empty(cells[0]),append(cells[0],contents)},isEditable=function(elem){return isEditable$1(elem,!0)},prune=function(table){0===cells$1(table).length&&remove$5(table)},outcome=function(grid,cursor){return{grid:grid,cursor:cursor}},elementFromGrid=function(grid,row,column){var _a,_b,rows=extractGridDetails(grid).rows;return Optional.from(null===(_b=null===(_a=rows[row])||void 0===_a?void 0:_a.cells[column])||void 0===_b?void 0:_b.element).filter(isEditable).orThunk((function(){return function(rows){return findMap(rows,(function(row){return findMap(row.cells,(function(cell){var elem=cell.element;return someIf(isEditable(elem),elem)}))}))}(rows)}))},bundle=function(grid,row,column){var cursorElement=elementFromGrid(grid,row,column);return outcome(grid,cursorElement)},uniqueRows=function(details){return foldl(details,(function(rest,detail){return exists(rest,(function(currentDetail){return currentDetail.row===detail.row}))?rest:rest.concat([detail])}),[]).sort((function(detailA,detailB){return detailA.row-detailB.row}))},makeRowsSection=function(section,applyScope){return function(initialGrid,details,comparator,genWrappers,tableSection){var rows=uniqueRows(details),rowIndexes=map$1(rows,(function(detail){return detail.row})),newGrid=replaceRows(initialGrid,rowIndexes,section,applyScope,comparator,genWrappers.replaceOrInit,tableSection);return bundle(newGrid,details[0].row,details[0].column)}},opMakeRowsHeader=makeRowsSection("thead",!0),opMakeRowsBody=makeRowsSection("tbody",!1),opMakeRowsFooter=makeRowsSection("tfoot",!1),gridifyRows=function(rows,generators,context){var pasteDetails=function(elems,section){return fromRowsOrColGroups(elems,(function(){return section}))}(rows,context.section),wh=Warehouse.generate(pasteDetails);return toGrid(wh,generators,!0)},resize=function(table,list,details,behaviours){return function(_table,list,_info,tableSize){var warehouse=Warehouse.generate(list),widths=tableSize.getWidths(warehouse,tableSize);recalculateAndApply(warehouse,widths,tableSize)}(0,list,0,behaviours.sizing)},adjustAndRedistributeWidths=function(table,list,details,behaviours){return function(_table,list,details,tableSize,resizeBehaviour){var warehouse=Warehouse.generate(list),sizes=tableSize.getWidths(warehouse,tableSize),tablePixelWidth=tableSize.pixelWidth(),_a=resizeBehaviour.calcRedestributedWidths(sizes,tablePixelWidth,details.pixelDelta,tableSize.isRelative),newSizes=_a.newSizes,delta=_a.delta;recalculateAndApply(warehouse,newSizes,tableSize),tableSize.adjustTableWidth(delta)}(0,list,details,behaviours.sizing,behaviours.resize)},firstColumnIsLocked=function(_warehouse,details){return exists(details,(function(detail){return 0===detail.column&&detail.isLocked}))},lastColumnIsLocked=function(warehouse,details){return exists(details,(function(detail){return detail.column+detail.colspan>=warehouse.grid.columns&&detail.isLocked}))},getColumnsWidth=function(warehouse,details){var columns$1=columns(warehouse),uniqueCols=uniqueColumns(details);return foldl(uniqueCols,(function(acc,detail){return acc+columns$1[detail.column].map(getOuter$2).getOr(0)}),0)},insertColumnsExtractor=function(before){return function(warehouse,target){return onCells(warehouse,target).filter((function(details){return!(before?firstColumnIsLocked:lastColumnIsLocked)(warehouse,details)})).map((function(details){return{details:details,pixelDelta:getColumnsWidth(warehouse,details)}}))}},pasteColumnsExtractor=function(before){return function(warehouse,target){return onPasteByEditor(warehouse,target).filter((function(details){return!(before?firstColumnIsLocked:lastColumnIsLocked)(warehouse,details.cells)}))}},headerCellGenerator=Generators_transform("th"),bodyCellGenerator=Generators_transform("td"),insertRowsBefore=run((function(grid,details,comparator,genWrappers){var targetIndex=details[0].row,rows=uniqueRows(details),newGrid=foldr(rows,(function(acc,row){return{grid:insertRowAt(acc.grid,targetIndex,row.row+acc.delta,comparator,genWrappers.getOrInit),delta:acc.delta+1}}),{grid:grid,delta:0}).grid;return bundle(newGrid,targetIndex,details[0].column)}),onCells,noop,noop,Generators_modification),insertRowsAfter=run((function(grid,details,comparator,genWrappers){var rows=uniqueRows(details),target=rows[rows.length-1],targetIndex=target.row+target.rowspan,newGrid=foldr(rows,(function(newG,row){return insertRowAt(newG,targetIndex,row.row,comparator,genWrappers.getOrInit)}),grid);return bundle(newGrid,targetIndex,details[0].column)}),onCells,noop,noop,Generators_modification),insertColumnsBefore=run((function(grid,extractDetail,comparator,genWrappers){var details=extractDetail.details,columns=uniqueColumns(details),targetIndex=columns[0].column,newGrid=foldr(columns,(function(acc,col){return{grid:insertColumnAt(acc.grid,targetIndex,col.column+acc.delta,comparator,genWrappers.getOrInit),delta:acc.delta+1}}),{grid:grid,delta:0}).grid;return bundle(newGrid,details[0].row,targetIndex)}),insertColumnsExtractor(!0),adjustAndRedistributeWidths,noop,Generators_modification),insertColumnsAfter=run((function(grid,extractDetail,comparator,genWrappers){var details=extractDetail.details,target=details[details.length-1],targetIndex=target.column+target.colspan,columns=uniqueColumns(details),newGrid=foldr(columns,(function(newG,col){return insertColumnAt(newG,targetIndex,col.column,comparator,genWrappers.getOrInit)}),grid);return bundle(newGrid,details[0].row,targetIndex)}),insertColumnsExtractor(!1),adjustAndRedistributeWidths,noop,Generators_modification),eraseColumns=run((function(grid,extractDetail,_comparator,_genWrappers){var columns=uniqueColumns(extractDetail.details),newGrid=function(grid,columns){return bind$2(grid,(function(row){var existingCells=row.cells,cells=foldr(columns,(function(acc,column){return column>=0&&column<acc.length?acc.slice(0,column).concat(acc.slice(column+1)):acc}),existingCells);return cells.length>0?[rowcells(row.element,cells,row.section,row.isNew)]:[]}))}(grid,map$1(columns,(function(column){return column.column}))),maxColIndex=newGrid.length>0?newGrid[0].cells.length-1:0;return bundle(newGrid,columns[0].row,Math.min(columns[0].column,maxColIndex))}),(function(warehouse,target){return onUnlockedCells(warehouse,target).map((function(details){return{details:details,pixelDelta:-getColumnsWidth(warehouse,details)}}))}),adjustAndRedistributeWidths,prune,Generators_modification),eraseRows=run((function(grid,details,_comparator,_genWrappers){var rows=uniqueRows(details),newGrid=function(grid,start,finish){var _a=extractGridDetails(grid),rows=_a.rows;return _a.cols.concat(rows.slice(0,start)).concat(rows.slice(finish+1))}(grid,rows[0].row,rows[rows.length-1].row),maxRowIndex=newGrid.length>0?newGrid.length-1:0;return bundle(newGrid,Math.min(details[0].row,maxRowIndex),details[0].column)}),onCells,noop,prune,Generators_modification),makeColumnsHeader=run((function(initialGrid,details,comparator,genWrappers){var columns=uniqueColumns(details),columnIndexes=map$1(columns,(function(detail){return detail.column})),newGrid=replaceColumns(initialGrid,columnIndexes,!0,comparator,genWrappers.replaceOrInit);return bundle(newGrid,details[0].row,details[0].column)}),onUnlockedCells,noop,noop,headerCellGenerator),unmakeColumnsHeader=run((function(initialGrid,details,comparator,genWrappers){var columns=uniqueColumns(details),columnIndexes=map$1(columns,(function(detail){return detail.column})),newGrid=replaceColumns(initialGrid,columnIndexes,!1,comparator,genWrappers.replaceOrInit);return bundle(newGrid,details[0].row,details[0].column)}),onUnlockedCells,noop,noop,bodyCellGenerator),makeRowsHeader=run(opMakeRowsHeader,onUnlockedCells,noop,noop,headerCellGenerator),makeRowsBody=run(opMakeRowsBody,onUnlockedCells,noop,noop,bodyCellGenerator),makeRowsFooter=run(opMakeRowsFooter,onUnlockedCells,noop,noop,bodyCellGenerator),makeCellsHeader=run((function(initialGrid,details,comparator,genWrappers){var newGrid=replaceCells(initialGrid,details,comparator,genWrappers.replaceOrInit);return bundle(newGrid,details[0].row,details[0].column)}),onUnlockedCells,noop,noop,headerCellGenerator),unmakeCellsHeader=run((function(initialGrid,details,comparator,genWrappers){var newGrid=replaceCells(initialGrid,details,comparator,genWrappers.replaceOrInit);return bundle(newGrid,details[0].row,details[0].column)}),onUnlockedCells,noop,noop,bodyCellGenerator),mergeCells=run((function(grid,mergable,comparator,genWrappers){var cells=mergable.cells;merge(cells);var newGrid=function(grid,bounds,comparator,substitution){var rows=extractGridDetails(grid).rows;if(0===rows.length)return grid;for(var i=bounds.startRow;i<=bounds.finishRow;i++)for(var j=bounds.startCol;j<=bounds.finishCol;j++){var row=rows[i],isLocked=getCell(row,j).isLocked;mutateCell(row,j,elementnew(substitution(),!1,isLocked))}return grid}(grid,mergable.bounds,0,genWrappers.merge(cells));return outcome(newGrid,Optional.from(cells[0]))}),onUnlockedMergable,resize,noop,Generators_merging),unmergeCells=run((function(grid,unmergable,comparator,genWrappers){var newGrid=foldr(unmergable,(function(b,cell){return unmerge(b,cell,comparator,genWrappers.unmerge(cell))}),grid);return outcome(newGrid,Optional.from(unmergable[0]))}),onUnlockedUnmergable,resize,noop,Generators_merging),pasteCells=run((function(grid,pasteDetails,comparator,_genWrappers){var gridB=function(table,generators){var wh=Warehouse.fromTable(table);return toGrid(wh,generators,!0)}(pasteDetails.clipboard,pasteDetails.generators),startAddress=function(row,column){return{row:row,column:column}}(pasteDetails.row,pasteDetails.column);return merge$1(startAddress,grid,gridB,pasteDetails.generators,comparator).fold((function(){return outcome(grid,Optional.some(pasteDetails.element))}),(function(newGrid){return bundle(newGrid,pasteDetails.row,pasteDetails.column)}))}),(function(warehouse,target){return cell(target.element).bind((function(cell){return findInWarehouse(warehouse,cell).map((function(details){return __assign(__assign({},details),{generators:target.generators,clipboard:target.clipboard})}))}))}),resize,noop,Generators_modification),pasteColsBefore=run((function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[0].column,context=rows[pasteDetails.cells[0].row],gridB=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,context),mergedGrid=insertCols(index,grid,gridB,pasteDetails.generators,comparator);return bundle(mergedGrid,pasteDetails.cells[0].row,pasteDetails.cells[0].column)}),pasteColumnsExtractor(!0),noop,noop,Generators_modification),pasteColsAfter=run((function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[pasteDetails.cells.length-1].column+pasteDetails.cells[pasteDetails.cells.length-1].colspan,context=rows[pasteDetails.cells[0].row],gridB=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,context),mergedGrid=insertCols(index,grid,gridB,pasteDetails.generators,comparator);return bundle(mergedGrid,pasteDetails.cells[0].row,pasteDetails.cells[0].column)}),pasteColumnsExtractor(!1),noop,noop,Generators_modification),pasteRowsBefore=run((function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[0].row,context=rows[index],gridB=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,context),mergedGrid=insertRows(index,grid,gridB,pasteDetails.generators,comparator);return bundle(mergedGrid,pasteDetails.cells[0].row,pasteDetails.cells[0].column)}),onPasteByEditor,noop,noop,Generators_modification),pasteRowsAfter=run((function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[pasteDetails.cells.length-1].row+pasteDetails.cells[pasteDetails.cells.length-1].rowspan,context=rows[pasteDetails.cells[0].row],gridB=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,context),mergedGrid=insertRows(index,grid,gridB,pasteDetails.generators,comparator);return bundle(mergedGrid,pasteDetails.cells[0].row,pasteDetails.cells[0].column)}),onPasteByEditor,noop,noop,Generators_modification),getColumnsType=function(table,target){var house=Warehouse.fromTable(table);return onCells(house,target).bind((function(selectedCells){var lastSelectedCell=selectedCells[selectedCells.length-1],minColRange=selectedCells[0].column,maxColRange=lastSelectedCell.column+lastSelectedCell.colspan,selectedColumnCells=flatten$1(map$1(house.all,(function(row){return filter$2(row.cells,(function(cell){return cell.column>=minColRange&&cell.column<maxColRange}))})));return findCommonCellType(selectedColumnCells)})).getOr("")},getCellsType=function(table,target){var house=Warehouse.fromTable(table);return onCells(house,target).bind(findCommonCellType).getOr("")},getRowsType=function(table,target){var house=Warehouse.fromTable(table);return onCells(house,target).bind((function(selectedCells){var lastSelectedCell=selectedCells[selectedCells.length-1],minRowRange=selectedCells[0].row,maxRowRange=lastSelectedCell.row+lastSelectedCell.rowspan;return function(rows){var rowTypes=map$1(rows,(function(row){return getRowType$1(row).type})),hasHeader=contains$2(rowTypes,"header"),hasFooter=contains$2(rowTypes,"footer");if(hasHeader||hasFooter){var hasBody=contains$2(rowTypes,"body");return!hasHeader||hasBody||hasFooter?hasHeader||hasBody||!hasFooter?Optional.none():Optional.some("footer"):Optional.some("header")}return Optional.some("body")}(house.all.slice(minRowRange,maxRowRange))})).getOr("")},TableActions=function(editor,cellSelection,lazyWire){var isTableBody=function(editor){return"table"===name(getBody(editor))},cloneFormats=getCloneElements(editor),colMutationOp=isResizeTableColumnResizing(editor)?noop:halve,getTableSectionType=function(table){switch(getTableHeaderType(editor)){case"section":return TableSection_section();case"sectionCells":return TableSection_sectionCells();case"cells":return TableSection_cells();default:return TableSection_getTableSectionType(table,"section")}},setSelectionFromAction=function(table,result){return result.cursor.fold((function(){var cells=cells$1(table);return head(cells).filter(inBody).map((function(firstCell){cellSelection.clear(table);var rng=editor.dom.createRng();return rng.selectNode(firstCell.dom),editor.selection.setRng(rng),set$2(firstCell,"data-mce-selected","1"),rng}))}),(function(cell){var des=freefallRtl$1(universe$2,cell),rng=editor.dom.createRng();return rng.setStart(des.element.dom,des.offset),rng.setEnd(des.element.dom,des.offset),editor.selection.setRng(rng),cellSelection.clear(table),Optional.some(rng)}))},execute=function(operation,guard,mutate,lazyWire,effect){return function(table,target,noEvents){void 0===noEvents&&(noEvents=!1),removeDataStyle(table);var wire=lazyWire(),doc=SugarElement.fromDom(editor.getDoc()),generators=cellOperations(mutate,doc,cloneFormats),behaviours={sizing:get$4(editor,table),resize:isResizeTableColumnResizing(editor)?resizeTable():preserveTable(),section:getTableSectionType(table)};return guard(table)?operation(wire,table,target,generators,behaviours).bind((function(result){each$2(result.newRows,(function(row){fireNewRow(editor,row.dom)})),each$2(result.newCells,(function(cell){fireNewCell(editor,cell.dom)}));var range=setSelectionFromAction(table,result);return inBody(table)&&(removeDataStyle(table),noEvents||fireTableModified(editor,table.dom,effect)),range.map((function(rng){return{rng:rng,effect:effect}}))})):Optional.none()}};return{deleteRow:execute(eraseRows,(function(table){return!1===isTableBody(editor)||getGridSize(table).rows>1}),noop,lazyWire,structureModified),deleteColumn:execute(eraseColumns,(function(table){return!1===isTableBody(editor)||getGridSize(table).columns>1}),noop,lazyWire,structureModified),insertRowsBefore:execute(insertRowsBefore,always,noop,lazyWire,structureModified),insertRowsAfter:execute(insertRowsAfter,always,noop,lazyWire,structureModified),insertColumnsBefore:execute(insertColumnsBefore,always,colMutationOp,lazyWire,structureModified),insertColumnsAfter:execute(insertColumnsAfter,always,colMutationOp,lazyWire,structureModified),mergeCells:execute(mergeCells,always,noop,lazyWire,structureModified),unmergeCells:execute(unmergeCells,always,noop,lazyWire,structureModified),pasteColsBefore:execute(pasteColsBefore,always,noop,lazyWire,structureModified),pasteColsAfter:execute(pasteColsAfter,always,noop,lazyWire,structureModified),pasteRowsBefore:execute(pasteRowsBefore,always,noop,lazyWire,structureModified),pasteRowsAfter:execute(pasteRowsAfter,always,noop,lazyWire,structureModified),pasteCells:execute(pasteCells,always,noop,lazyWire,styleAndStructureModified),makeCellsHeader:execute(makeCellsHeader,always,noop,lazyWire,structureModified),unmakeCellsHeader:execute(unmakeCellsHeader,always,noop,lazyWire,structureModified),makeColumnsHeader:execute(makeColumnsHeader,always,noop,lazyWire,structureModified),unmakeColumnsHeader:execute(unmakeColumnsHeader,always,noop,lazyWire,structureModified),makeRowsHeader:execute(makeRowsHeader,always,noop,lazyWire,structureModified),makeRowsBody:execute(makeRowsBody,always,noop,lazyWire,structureModified),makeRowsFooter:execute(makeRowsFooter,always,noop,lazyWire,structureModified),getTableRowType:getRowsType,getTableCellType:getCellsType,getTableColType:getColumnsType}},DefaultRenderOptions={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},colGroups:!1},createGroupRow=function(columns){var columnGroup=SugarElement.fromTag("colgroup");return range$1(columns,(function(){return append$1(columnGroup,SugarElement.fromTag("col"))})),columnGroup},createRows=function(rows,columns,rowHeaders,columnHeaders){return range$1(rows,(function(r){return function(columns,rowHeaders,columnHeaders,rowIndex){for(var tr=SugarElement.fromTag("tr"),j=0;j<columns;j++){var td=rowIndex<rowHeaders||j<columnHeaders?SugarElement.fromTag("th"):SugarElement.fromTag("td");j<columnHeaders&&set$2(td,"scope","row"),rowIndex<rowHeaders&&set$2(td,"scope","col"),append$1(td,SugarElement.fromTag("br")),append$1(tr,td)}return tr}(columns,rowHeaders,columnHeaders,r)}))},placeCaretInCell=function(editor,cell){editor.selection.select(cell.dom,!0),editor.selection.collapse(!0)},insert=function(editor,columns,rows,colHeaders,rowHeaders){var defaultStyles=getDefaultStyles(editor),options={styles:defaultStyles,attributes:getDefaultAttributes(editor),colGroups:useColumnGroup(editor)};return editor.undoManager.ignore((function(){var table=function(rows,columns,rowHeaders,columnHeaders,headerType,renderOpts){void 0===renderOpts&&(renderOpts=DefaultRenderOptions);var table=SugarElement.fromTag("table"),rowHeadersGoInThead="cells"!==headerType;setAll(table,renderOpts.styles),setAll$1(table,renderOpts.attributes),renderOpts.colGroups&&append$1(table,createGroupRow(columns));var actualRowHeaders=Math.min(rows,rowHeaders);if(rowHeadersGoInThead&&rowHeaders>0){var thead=SugarElement.fromTag("thead");append$1(table,thead);var theadRows=createRows(rowHeaders,columns,"sectionCells"===headerType?actualRowHeaders:0,columnHeaders);append(thead,theadRows)}var tbody=SugarElement.fromTag("tbody");append$1(table,tbody);var tbodyRows=createRows(rowHeadersGoInThead?rows-actualRowHeaders:rows,columns,rowHeadersGoInThead?0:rowHeaders,columnHeaders);return append(tbody,tbodyRows),table}(rows,columns,rowHeaders,colHeaders,getTableHeaderType(editor),options);set$2(table,"data-mce-id","__mce");var html=function(element){var container=SugarElement.fromTag("div"),clone=SugarElement.fromDom(element.dom.cloneNode(!0));return append$1(container,clone),function(element){return element.dom.innerHTML}(container)}(table);editor.insertContent(html),editor.addVisual()})),descendant(getBody(editor),'table[data-mce-id="__mce"]').map((function(table){return isPixelsForced(editor)?enforcePixels(table):isResponsiveForced(editor)?enforceNone(table):(isPercentagesForced(editor)||function(width){return isString(width)&&-1!==width.indexOf("%")}(defaultStyles.width))&&enforcePercentage(table),removeDataStyle(table),remove$7(table,"data-mce-id"),function(editor,table){each$2(descendants(table,"tr"),(function(row){fireNewRow(editor,row.dom),each$2(descendants(row,"th,td"),(function(cell){fireNewCell(editor,cell.dom)}))}))}(editor,table),function(editor,tableElm){descendant(tableElm,"td,th").each(curry(placeCaretInCell,editor))}(editor,table),table.dom})).getOr(null)},insertTableWithDataValidation=function(editor,rows,columns,options,errorMsg){void 0===options&&(options={});var checkInput=function(val){return isNumber(val)&&val>0};if(checkInput(rows)&&checkInput(columns)){var headerRows=options.headerRows||0,headerColumns=options.headerColumns||0;return insert(editor,columns,rows,headerColumns,headerRows)}return console.error(errorMsg),null},getClipboardElements=function(getClipboard){return function(){return getClipboard().fold((function(){return[]}),(function(elems){return map$1(elems,(function(e){return e.dom}))}))}},setClipboardElements=function(setClipboard){return function(elems){var elmsOpt=elems.length>0?Optional.some(fromDom(elems)):Optional.none();setClipboard(elmsOpt)}},insertTable=function(editor){return function(columns,rows,options){void 0===options&&(options={});var table=insertTableWithDataValidation(editor,rows,columns,options,"Invalid values for insertTable - rows and columns values are required to insert a table.");return editor.undoManager.add(),table}},constrainSpan=function(element,property,value){var currentColspan=getAttrValue(element,property,1);1===value||currentColspan<=1?remove$7(element,property):set$2(element,property,Math.min(value,currentColspan))},copyCols=function(table,target){var house=Warehouse.fromTable(table);return onUnlockedCells(house,target).map((function(selectedCells){var lastSelectedCell=selectedCells[selectedCells.length-1],minColRange=selectedCells[0].column,maxColRange=lastSelectedCell.column+lastSelectedCell.colspan,fakeColGroups=function(house,minColRange,maxColRange){if(Warehouse.hasColumns(house)){var colsToCopy=filter$2(Warehouse.justColumns(house),(function(col){return col.column>=minColRange&&col.column<maxColRange})),copiedCols=map$1(colsToCopy,(function(c){var clonedCol=deep(c.element);return constrainSpan(clonedCol,"span",maxColRange-minColRange),clonedCol})),fakeColgroup=SugarElement.fromTag("colgroup");return append(fakeColgroup,copiedCols),[fakeColgroup]}return[]}(house,minColRange,maxColRange),fakeRows=function(house,minColRange,maxColRange){return map$1(house.all,(function(row){var cellsToCopy=filter$2(row.cells,(function(cell){return cell.column>=minColRange&&cell.column<maxColRange})),copiedCells=map$1(cellsToCopy,(function(cell){var clonedCell=deep(cell.element);return constrainSpan(clonedCell,"colspan",maxColRange-minColRange),clonedCell})),fakeTR=SugarElement.fromTag("tr");return append(fakeTR,copiedCells),fakeTR}))}(house,minColRange,maxColRange);return __spreadArray(__spreadArray([],fakeColGroups,!0),fakeRows,!0)}))},copyRows=function(table,target,generators){var warehouse=Warehouse.fromTable(table);return onCells(warehouse,target).bind((function(selectedCells){var grid=toGrid(warehouse,generators,!1),slicedGrid=extractGridDetails(grid).rows.slice(selectedCells[0].row,selectedCells[selectedCells.length-1].row+selectedCells[selectedCells.length-1].rowspan),filteredGrid=bind$2(slicedGrid,(function(row){var newCells=filter$2(row.cells,(function(cell){return!cell.isLocked}));return newCells.length>0?[__assign(__assign({},row),{cells:newCells})]:[]})),slicedDetails=toDetailList(filteredGrid);return someIf(slicedDetails.length>0,slicedDetails)})).map((function(slicedDetails){return function(grid){return map$1(grid,(function(row){var tr=shallow(row.element);return each$2(row.cells,(function(cell){var clonedCell=deep(cell.element);setIfNot(clonedCell,"colspan",cell.colspan,1),setIfNot(clonedCell,"rowspan",cell.rowspan,1),append$1(tr,clonedCell)})),tr}))}(slicedDetails)}))},global$2=tinymce.util.Tools.resolve("tinymce.util.Tools"),getTDTHOverallStyle=function(dom,elm,name){return function(firstChildStyle,elms){for(var i=0;i<elms.length;i++){var currentStyle=dom.getStyle(elms[i],name);if(void 0===firstChildStyle&&(firstChildStyle=currentStyle),firstChildStyle!==currentStyle)return""}return firstChildStyle}(undefined,dom.select("td,th",elm))},applyAlign=function(editor,elm,name){name&&editor.formatter.apply("align"+name,{},elm)},unApplyAlign=function(editor,elm){global$2.each("left center right".split(" "),(function(name){editor.formatter.remove("align"+name,{},elm)}))},verticalAlignValues=[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}],shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longformRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,normalizeHex=function(hex){return(str=hex,prefix="#",startsWith(str,prefix)?function(str,numChars){return str.substring(numChars)}(str,prefix.length):str).toUpperCase();var str,prefix},fromString$1=function(hex){return function(hex){return shorthandRegex.test(hex)||longformRegex.test(hex)}(hex)?Optional.some({value:normalizeHex(hex)}):Optional.none()},toHex=function(component){var hex=component.toString(16);return(1===hex.length?"0"+hex:hex).toUpperCase()},fromRgba=function(rgbaColour){return function(value){return{value:value}}(toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue))},rgbRegex=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/,rgbaRegex=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/,rgbaColour=function(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha}},fromStringValues=function(red,green,blue,alpha){var r=parseInt(red,10),g=parseInt(green,10),b=parseInt(blue,10),a=parseFloat(alpha);return rgbaColour(r,g,b,a)},anyToHex=function(color){return fromString$1(color).orThunk((function(){return function(rgbaString){if("transparent"===rgbaString)return Optional.some(rgbaColour(0,0,0,0));var rgbMatch=rgbRegex.exec(rgbaString);if(null!==rgbMatch)return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],"1"));var rgbaMatch=rgbaRegex.exec(rgbaString);return null!==rgbaMatch?Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4])):Optional.none()}(color).map(fromRgba)})).getOrThunk((function(){var canvas=document.createElement("canvas");canvas.height=1,canvas.width=1;var canvasContext=canvas.getContext("2d");canvasContext.clearRect(0,0,canvas.width,canvas.height),canvasContext.fillStyle="#FFFFFF",canvasContext.fillStyle=color,canvasContext.fillRect(0,0,1,1);var rgba=canvasContext.getImageData(0,0,1,1).data,r=rgba[0],g=rgba[1],b=rgba[2],a=rgba[3];return fromRgba(rgbaColour(r,g,b,a))}))},Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},singleton=function(doRevoke){var subject=Cell(Optional.none()),revoke=function(){return subject.get().each(doRevoke)};return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}},value=function(){var subject=singleton(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},onSetupToggle=function(editor,selections,formatName,formatValue){return function(api){var boundCallback=singleton((function(s){return s.unbind()})),isNone=!isNotEmpty(formatValue),init=function(){var selectedCells=getCellsFromSelection(selections),checkNode=function(cell){return editor.formatter.match(formatName,{value:formatValue},cell.dom,isNone)};isNone?(api.setActive(!exists(selectedCells,checkNode)),boundCallback.set(editor.formatter.formatChanged(formatName,(function(match){return api.setActive(!match)}),!0))):(api.setActive(forall(selectedCells,checkNode)),boundCallback.set(editor.formatter.formatChanged(formatName,api.setActive,!1,{value:formatValue})))};return editor.initialized?init():editor.on("init",init),boundCallback.clear}},isListGroup=function(item){return hasNonNullableKey(item,"menu")},buildListItems=function(items){return map$1(items,(function(item){var text=item.text||item.title;return isListGroup(item)?{text:text,items:buildListItems(item.menu)}:{text:text,value:item.value}}))},buildMenuItems=function(editor,selections,items,format,onAction){return map$1(items,(function(item){var text=item.text||item.title;return isListGroup(item)?{type:"nestedmenuitem",text:text,getSubmenuItems:function(){return buildMenuItems(editor,selections,item.menu,format,onAction)}}:{text:text,type:"togglemenuitem",onAction:function(){return onAction(item.value)},onSetup:onSetupToggle(editor,selections,format,item.value)}}))},applyTableCellStyle=function(editor,style){return function(value){var _a;editor.execCommand("mceTableApplyCellStyle",!1,((_a={})[style]=value,_a))}},filterNoneItem=function(list){return bind$2(list,(function(item){return isListGroup(item)?[__assign(__assign({},item),{menu:filterNoneItem(item.menu)})]:isNotEmpty(item.value)?[item]:[]}))},generateMenuItemsCallback=function(editor,selections,items,format,onAction){return function(callback){return callback(buildMenuItems(editor,selections,items,format,onAction))}},buildColorMenu=function(editor,colorList,style){var colorMap=map$1(colorList,(function(entry){return{text:entry.title,value:"#"+anyToHex(entry.value).value,type:"choiceitem"}}));return[{type:"fancymenuitem",fancytype:"colorswatch",initData:{colors:colorMap.length>0?colorMap:void 0,allowCustomColors:!1},onAction:function(data){var _a,value="remove"===data.value?"":data.value;editor.execCommand("mceTableApplyCellStyle",!1,((_a={})[style]=value,_a))}}]},changeRowHeader=function(editor){return function(){var newType="header"===editor.queryCommandValue("mceTableRowType")?"body":"header";editor.execCommand("mceTableRowType",!1,{type:newType})}},changeColumnHeader=function(editor){return function(){var newType="th"===editor.queryCommandValue("mceTableColType")?"td":"th";editor.execCommand("mceTableColType",!1,{type:newType})}},children=[{name:"width",type:"input",label:"Width"},{name:"height",type:"input",label:"Height"},{name:"celltype",type:"listbox",label:"Cell type",items:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{name:"scope",type:"listbox",label:"Scope",items:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{name:"halign",type:"listbox",label:"Horizontal align",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{name:"valign",type:"listbox",label:"Vertical align",items:verticalAlignValues}],getItems$2=function(editor){return children.concat(function(editor){var classes=buildListItems(getCellClassList(editor));return classes.length>0?Optional.some({name:"class",type:"listbox",label:"Class",items:classes}):Optional.none()}(editor).toArray())},getAdvancedTab=function(editor,dialogName){var advTabItems=[{name:"borderstyle",type:"listbox",label:"Border style",items:[{text:"Select...",value:""}].concat(buildListItems(getTableBorderStyles(editor)))},{name:"bordercolor",type:"colorinput",label:"Border color"},{name:"backgroundcolor",type:"colorinput",label:"Background color"}];return{title:"Advanced",name:"advanced",items:"cell"===dialogName?[{name:"borderwidth",type:"input",label:"Border width"}].concat(advTabItems):advTabItems}},modifiers=function(testTruthy){return function(editor,node){var dom=editor.dom;return{setAttrib:function(attr,value){testTruthy&&!value||dom.setAttrib(node,attr,value)},setStyle:function(prop,value){testTruthy&&!value||dom.setStyle(node,prop,value)},setFormat:function(formatName,value){testTruthy&&!value||(""===value?editor.formatter.remove(formatName,{value:null},node,!0):editor.formatter.apply(formatName,{value:value},node))}}}},DomModifier={normal:modifiers(!1),ifTruthy:modifiers(!0)},rgbToHex=function(dom){return function(value){return startsWith(value,"rgb")?dom.toHex(value):value}},extractAdvancedStyles=function(dom,elm){var element=SugarElement.fromDom(elm);return{borderwidth:getRaw$2(element,"border-width").getOr(""),borderstyle:getRaw$2(element,"border-style").getOr(""),bordercolor:getRaw$2(element,"border-color").map(rgbToHex(dom)).getOr(""),backgroundcolor:getRaw$2(element,"background-color").map(rgbToHex(dom)).getOr("")}},getSharedValues=function(data){var baseData=data[0],comparisonData=data.slice(1);return each$2(comparisonData,(function(items){each$2(keys(baseData),(function(key){each$1(items,(function(itemValue,itemKey){var comparisonValue=baseData[key];""!==comparisonValue&&key===itemKey&&comparisonValue!==itemValue&&(baseData[key]="")}))}))})),baseData},getAlignment=function(formats,formatName,editor,elm){return find$1(formats,(function(name){return!isUndefined(editor.formatter.matchNode(elm,formatName+name))})).getOr("")},getHAlignment=curry(getAlignment,["left","center","right"],"align"),getVAlignment=curry(getAlignment,["top","middle","bottom"],"valign"),getRowType=function(elm){return table(SugarElement.fromDom(elm)).map((function(table){var target={selection:fromDom(elm.cells)};return getRowsType(table,target)})).getOr("")},getSelectedCells=function(table,cells){var warehouse=Warehouse.fromTable(table),allCells=Warehouse.justCells(warehouse),filtered=filter$2(allCells,(function(cellA){return exists(cells,(function(cellB){return eq$1(cellA.element,cellB)}))}));return map$1(filtered,(function(cell){return{element:cell.element.dom,column:Warehouse.getColumnAt(warehouse,cell.column).map((function(col){return col.element.dom}))}}))},applyStyleData$1=function(editor,cells,data){var isSingleCell=1===cells.length;each$2(cells,(function(item){var cellElm=item.element,modifier=isSingleCell?DomModifier.normal(editor,cellElm):DomModifier.ifTruthy(editor,cellElm);!function(modifier,colModifier,data){modifier.setAttrib("scope",data.scope),modifier.setAttrib("class",data.class),modifier.setStyle("height",addPxSuffix(data.height)),colModifier.setStyle("width",addPxSuffix(data.width))}(modifier,item.column.map((function(col){return isSingleCell?DomModifier.normal(editor,col):DomModifier.ifTruthy(editor,col)})).getOr(modifier),data),hasAdvancedCellTab(editor)&&function(modifier,data){modifier.setFormat("tablecellbackgroundcolor",data.backgroundcolor),modifier.setFormat("tablecellbordercolor",data.bordercolor),modifier.setFormat("tablecellborderstyle",data.borderstyle),modifier.setFormat("tablecellborderwidth",addPxSuffix(data.borderwidth))}(modifier,data),isSingleCell&&(unApplyAlign(editor,cellElm),function(editor,elm){global$2.each("top middle bottom".split(" "),(function(name){editor.formatter.remove("valign"+name,{},elm)}))}(editor,cellElm)),data.halign&&applyAlign(editor,cellElm,data.halign),data.valign&&function(editor,elm,name){name&&editor.formatter.apply("valign"+name,{},elm)}(editor,cellElm,data.valign)}))},onSubmitCellForm=function(editor,cells,oldData,api){var data=api.getData();api.close(),editor.undoManager.transact((function(){!function(editor,cells,oldData,data){var modifiedData=filter$1(data,(function(value,key){return oldData[key]!==value}));size(modifiedData)>0&&cells.length>=1&&table(cells[0]).each((function(table){var selectedCells=getSelectedCells(table,cells),styleModified=size(filter$1(modifiedData,(function(_value,key){return"scope"!==key&&"celltype"!==key})))>0,structureModified=has$1(modifiedData,"celltype");(styleModified||has$1(modifiedData,"scope"))&&applyStyleData$1(editor,selectedCells,data),structureModified&&function(editor,data){editor.execCommand("mceTableCellType",!1,{type:data.celltype,no_events:!0})}(editor,data),fireTableModified(editor,table.dom,{structure:structureModified,style:styleModified})}))}(editor,cells,oldData,data),editor.focus()}))},getData=function(editor,cells){var cellsData=table(cells[0]).map((function(table){return map$1(getSelectedCells(table,cells),(function(item){return function(editor,cell,hasAdvancedCellTab,column){var elm,dom=editor.dom,colElm=column.getOr(cell),getStyle=function(element,style){return dom.getStyle(element,style)||dom.getAttrib(element,style)};return __assign({width:getStyle(colElm,"width"),height:getStyle(cell,"height"),scope:dom.getAttrib(cell,"scope"),celltype:(elm=cell,elm.nodeName.toLowerCase()),class:dom.getAttrib(cell,"class",""),halign:getHAlignment(editor,cell),valign:getVAlignment(editor,cell)},hasAdvancedCellTab?extractAdvancedStyles(dom,cell):{})}(editor,item.element,hasAdvancedCellTab(editor),item.column)}))}));return getSharedValues(cellsData.getOrDie())},open$2=function(editor,selections){var cells=getCellsFromSelection(selections);if(0!==cells.length){var data=getData(editor,cells),dialogTabPanel={type:"tabpanel",tabs:[{title:"General",name:"general",items:getItems$2(editor)},getAdvancedTab(editor,"cell")]},dialogPanel={type:"panel",items:[{type:"grid",columns:2,items:getItems$2(editor)}]};editor.windowManager.open({title:"Cell Properties",size:"normal",body:hasAdvancedCellTab(editor)?dialogTabPanel:dialogPanel,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:data,onSubmit:curry(onSubmitCellForm,editor,cells,data)})}},formChildren=[{type:"listbox",name:"type",label:"Row type",items:[{text:"Header",value:"header"},{text:"Body",value:"body"},{text:"Footer",value:"footer"}]},{type:"listbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height",type:"input"}],getItems$1=function(editor){return formChildren.concat(function(editor){var classes=buildListItems(function(editor){return editor.getParam("table_row_class_list",[],"array")}(editor));return classes.length>0?Optional.some({name:"class",type:"listbox",label:"Class",items:classes}):Optional.none()}(editor).toArray())},applyStyleData=function(editor,rows,data,oldData){var isSingleRow=1===rows.length;each$2(rows,(function(rowElm){var modifier=isSingleRow?DomModifier.normal(editor,rowElm):DomModifier.ifTruthy(editor,rowElm);!function(modifier,data){modifier.setAttrib("class",data.class),modifier.setStyle("height",addPxSuffix(data.height))}(modifier,data),hasAdvancedRowTab(editor)&&function(modifier,data){modifier.setStyle("background-color",data.backgroundcolor),modifier.setStyle("border-color",data.bordercolor),modifier.setStyle("border-style",data.borderstyle)}(modifier,data),data.align!==oldData.align&&(unApplyAlign(editor,rowElm),applyAlign(editor,rowElm,data.align))}))},onSubmitRowForm=function(editor,rows,oldData,api){var data=api.getData();api.close(),editor.undoManager.transact((function(){!function(editor,rows,oldData,data){var modifiedData=filter$1(data,(function(value,key){return oldData[key]!==value}));if(size(modifiedData)>0){var typeModified_1=has$1(modifiedData,"type"),styleModified_1=!typeModified_1||size(modifiedData)>1;styleModified_1&&applyStyleData(editor,rows,data,oldData),typeModified_1&&function(editor,data){editor.execCommand("mceTableRowType",!1,{type:data.type,no_events:!0})}(editor,data),table(SugarElement.fromDom(rows[0])).each((function(table){return fireTableModified(editor,table.dom,{structure:typeModified_1,style:styleModified_1})}))}}(editor,rows,oldData,data),editor.focus()}))},open$1=function(editor){var selected,selector,cellOpt,rowsOpt,rows=(selected=getSelectionStart(editor),selector=ephemera.selected,cellOpt=getSelectionCell(selected),rowsOpt=cellOpt.bind((function(cell){return table(cell)})).map((function(table){return rows$1(table)})),lift2(cellOpt,rowsOpt,(function(cell,rows){return filter$2(rows,(function(row){return exists(fromDom(row.dom.cells),(function(rowCell){return"1"===get$b(rowCell,selector)||eq$1(rowCell,cell)}))}))})).getOr([]));if(0!==rows.length){var rowsData=map$1(rows,(function(rowElm){return function(editor,elm,hasAdvancedRowTab){var dom=editor.dom;return __assign({height:dom.getStyle(elm,"height")||dom.getAttrib(elm,"height"),class:dom.getAttrib(elm,"class",""),type:getRowType(elm),align:getHAlignment(editor,elm)},hasAdvancedRowTab?extractAdvancedStyles(dom,elm):{})}(editor,rowElm.dom,hasAdvancedRowTab(editor))})),data=getSharedValues(rowsData),dialogTabPanel={type:"tabpanel",tabs:[{title:"General",name:"general",items:getItems$1(editor)},getAdvancedTab(editor,"row")]},dialogPanel={type:"panel",items:[{type:"grid",columns:2,items:getItems$1(editor)}]};editor.windowManager.open({title:"Row Properties",size:"normal",body:hasAdvancedRowTab(editor)?dialogTabPanel:dialogPanel,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:data,onSubmit:curry(onSubmitRowForm,editor,map$1(rows,(function(r){return r.dom})),data)})}},getItems=function(editor,classes,insertNewTable){var rowColCountItems=insertNewTable?[{type:"input",name:"cols",label:"Cols",inputMode:"numeric"},{type:"input",name:"rows",label:"Rows",inputMode:"numeric"}]:[],appearanceItems=function(editor){return editor.getParam("table_appearance_options",!0,"boolean")}(editor)?[{type:"input",name:"cellspacing",label:"Cell spacing",inputMode:"numeric"},{type:"input",name:"cellpadding",label:"Cell padding",inputMode:"numeric"},{type:"input",name:"border",label:"Border width"},{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[],classListItem=classes.length>0?[{type:"listbox",name:"class",label:"Class",items:classes}]:[];return rowColCountItems.concat([{type:"input",name:"width",label:"Width"},{type:"input",name:"height",label:"Height"}]).concat(appearanceItems).concat([{type:"listbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]).concat(classListItem)},styleTDTH=function(dom,elm,name,value){if("TD"===elm.tagName||"TH"===elm.tagName)isString(name)?dom.setStyle(elm,name,value):dom.setStyle(elm,name);else if(elm.children)for(var i=0;i<elm.children.length;i++)styleTDTH(dom,elm.children[i],name,value)},onSubmitTableForm=function(editor,tableElm,oldData,api){var dom=editor.dom,data=api.getData(),modifiedData=filter$1(data,(function(value,key){return oldData[key]!==value}));api.close(),""===data.class&&delete data.class,editor.undoManager.transact((function(){if(!tableElm){var cols=parseInt(data.cols,10)||1,rows=parseInt(data.rows,10)||1;tableElm=insert(editor,cols,rows,0,0)}if(size(modifiedData)>0){!function(editor,tableElm,data){var dom=editor.dom,attrs={},styles={};if(attrs.class=data.class,styles.height=addPxSuffix(data.height),dom.getAttrib(tableElm,"width")&&!shouldStyleWithCss(editor)?attrs.width=function(size){return size?size.replace(/px$/,""):""}(data.width):styles.width=addPxSuffix(data.width),shouldStyleWithCss(editor)?(styles["border-width"]=addPxSuffix(data.border),styles["border-spacing"]=addPxSuffix(data.cellspacing)):(attrs.border=data.border,attrs.cellpadding=data.cellpadding,attrs.cellspacing=data.cellspacing),shouldStyleWithCss(editor)&&tableElm.children)for(var i=0;i<tableElm.children.length;i++)styleTDTH(dom,tableElm.children[i],{"border-width":addPxSuffix(data.border),padding:addPxSuffix(data.cellpadding)}),hasAdvancedTableTab(editor)&&styleTDTH(dom,tableElm.children[i],{"border-color":data.bordercolor});hasAdvancedTableTab(editor)&&(styles["background-color"]=data.backgroundcolor,styles["border-color"]=data.bordercolor,styles["border-style"]=data.borderstyle),attrs.style=dom.serializeStyle(__assign(__assign({},getDefaultStyles(editor)),styles)),dom.setAttribs(tableElm,__assign(__assign({},getDefaultAttributes(editor)),attrs))}(editor,tableElm,data);var captionElm=dom.select("caption",tableElm)[0];(captionElm&&!data.caption||!captionElm&&data.caption)&&editor.execCommand("mceTableToggleCaption"),""===data.align?unApplyAlign(editor,tableElm):applyAlign(editor,tableElm,data.align)}if(editor.focus(),editor.addVisual(),size(modifiedData)>0){var captionModified=has$1(modifiedData,"caption"),styleModified=!captionModified||size(modifiedData)>1;fireTableModified(editor,tableElm,{structure:captionModified,style:styleModified})}}))},open=function(editor,insertNewTable){var tableElm,dom=editor.dom,data=function(editor,hasAdvTableTab){var dom,spacing,padding,borderWidth,style=getDefaultStyles(editor),attrs=getDefaultAttributes(editor),advStyle=hasAdvTableTab?(dom=editor.dom,{borderstyle:get$c(style,"border-style").getOr(""),bordercolor:rgbToHex(dom)(get$c(style,"border-color").getOr("")),backgroundcolor:rgbToHex(dom)(get$c(style,"background-color").getOr(""))}):{};return __assign(__assign(__assign(__assign(__assign(__assign({},{height:"",width:"100%",cellspacing:"",cellpadding:"",caption:!1,class:"",align:"",border:""}),style),attrs),advStyle),(borderWidth=style["border-width"],shouldStyleWithCss(editor)&&borderWidth?{border:borderWidth}:get$c(attrs,"border").fold((function(){return{}}),(function(border){return{border:border}})))),(spacing=get$c(style,"border-spacing").or(get$c(attrs,"cellspacing")).fold((function(){return{}}),(function(cellspacing){return{cellspacing:cellspacing}})),padding=get$c(style,"border-padding").or(get$c(attrs,"cellpadding")).fold((function(){return{}}),(function(cellpadding){return{cellpadding:cellpadding}})),__assign(__assign({},spacing),padding)))}(editor,hasAdvancedTableTab(editor));!1===insertNewTable?(tableElm=dom.getParent(editor.selection.getStart(),"table",editor.getBody()))?data=function(editor,elm,hasAdvTableTab){var dom=editor.dom,cellspacing=shouldStyleWithCss(editor)?dom.getStyle(elm,"border-spacing")||dom.getAttrib(elm,"cellspacing"):dom.getAttrib(elm,"cellspacing")||dom.getStyle(elm,"border-spacing"),cellpadding=shouldStyleWithCss(editor)?getTDTHOverallStyle(dom,elm,"padding")||dom.getAttrib(elm,"cellpadding"):dom.getAttrib(elm,"cellpadding")||getTDTHOverallStyle(dom,elm,"padding");return __assign({width:dom.getStyle(elm,"width")||dom.getAttrib(elm,"width"),height:dom.getStyle(elm,"height")||dom.getAttrib(elm,"height"),cellspacing:cellspacing,cellpadding:cellpadding,border:function(dom,elm){var optBorderWidth=getRaw$2(SugarElement.fromDom(elm),"border-width");return shouldStyleWithCss(editor)&&optBorderWidth.isSome()?optBorderWidth.getOr(""):dom.getAttrib(elm,"border")||getTDTHOverallStyle(editor.dom,elm,"border-width")||getTDTHOverallStyle(editor.dom,elm,"border")}(dom,elm),caption:!!dom.select("caption",elm)[0],class:dom.getAttrib(elm,"class",""),align:getHAlignment(editor,elm)},hasAdvTableTab?extractAdvancedStyles(dom,elm):{})}(editor,tableElm,hasAdvancedTableTab(editor)):hasAdvancedTableTab(editor)&&(data.borderstyle="",data.bordercolor="",data.backgroundcolor=""):(data.cols="1",data.rows="1",hasAdvancedTableTab(editor)&&(data.borderstyle="",data.bordercolor="",data.backgroundcolor=""));var classes=buildListItems(getTableClassList(editor));classes.length>0&&data.class&&(data.class=data.class.replace(/\s*mce\-item\-table\s*/g,""));var generalPanel={type:"grid",columns:2,items:getItems(editor,classes,insertNewTable)},dialogBody=hasAdvancedTableTab(editor)?{type:"tabpanel",tabs:[{title:"General",name:"general",items:[generalPanel]},getAdvancedTab(editor,"table")]}:{type:"panel",items:[generalPanel]};editor.windowManager.open({title:"Table Properties",size:"normal",body:dialogBody,onSubmit:curry(onSubmitTableForm,editor,tableElm,data),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:data})},getSelectionStartCellOrCaption=function(editor){return getSelectionCellOrCaption(getSelectionStart(editor),getIsRoot(editor))},registerCommands=function(editor,actions,cellSelection,selections,clipboard){var isRoot=getIsRoot(editor),getTableFromCell=function(cell){return table(cell,isRoot)},performActionOnSelection=function(action){return function(editor){return getSelectionCell(getSelectionStart(editor),getIsRoot(editor))}(editor).bind((function(cell){return getTableFromCell(cell).map((function(table){return action(table,cell)}))}))},postExecute=function(_data){editor.focus()},actOnSelection=function(execute,noEvents){return void 0===noEvents&&(noEvents=!1),performActionOnSelection((function(table,startCell){var targets=forMenu(selections,table,startCell);execute(table,targets,noEvents).each(postExecute)}))},copyRowSelection=function(){return performActionOnSelection((function(table,startCell){var targets=forMenu(selections,table,startCell),generators=cellOperations(noop,SugarElement.fromDom(editor.getDoc()),Optional.none());return copyRows(table,targets,generators)}))},copyColSelection=function(){return performActionOnSelection((function(table,startCell){var targets=forMenu(selections,table,startCell);return copyCols(table,targets)}))},pasteOnSelection=function(execute,getRows){return getRows().each((function(rows){var clonedRows=map$1(rows,(function(row){return deep(row)}));performActionOnSelection((function(table,startCell){var generators=paste$1(SugarElement.fromDom(editor.getDoc())),targets=function(selections,cell,clipboard,generators){return{selection:selection(selections),clipboard:clipboard,generators:generators}}(selections,0,clonedRows,generators);execute(table,targets).each(postExecute)}))}))},actOnType=function(getAction){return function(_ui,args){return get$c(args,"type").each((function(type){actOnSelection(getAction(type),args.no_events)}))}};each$1({mceTableSplitCells:function(){return actOnSelection(actions.unmergeCells)},mceTableMergeCells:function(){return actOnSelection(actions.mergeCells)},mceTableInsertRowBefore:function(){return actOnSelection(actions.insertRowsBefore)},mceTableInsertRowAfter:function(){return actOnSelection(actions.insertRowsAfter)},mceTableInsertColBefore:function(){return actOnSelection(actions.insertColumnsBefore)},mceTableInsertColAfter:function(){return actOnSelection(actions.insertColumnsAfter)},mceTableDeleteCol:function(){return actOnSelection(actions.deleteColumn)},mceTableDeleteRow:function(){return actOnSelection(actions.deleteRow)},mceTableCutCol:function(){return copyColSelection().each((function(selection){clipboard.setColumns(selection),actOnSelection(actions.deleteColumn)}))},mceTableCutRow:function(){return copyRowSelection().each((function(selection){clipboard.setRows(selection),actOnSelection(actions.deleteRow)}))},mceTableCopyCol:function(){return copyColSelection().each((function(selection){return clipboard.setColumns(selection)}))},mceTableCopyRow:function(){return copyRowSelection().each((function(selection){return clipboard.setRows(selection)}))},mceTablePasteColBefore:function(){return pasteOnSelection(actions.pasteColsBefore,clipboard.getColumns)},mceTablePasteColAfter:function(){return pasteOnSelection(actions.pasteColsAfter,clipboard.getColumns)},mceTablePasteRowBefore:function(){return pasteOnSelection(actions.pasteRowsBefore,clipboard.getRows)},mceTablePasteRowAfter:function(){return pasteOnSelection(actions.pasteRowsAfter,clipboard.getRows)},mceTableDelete:function(){return getSelectionStartCellOrCaption(editor).each((function(cellOrCaption){table(cellOrCaption,isRoot).filter(not(isRoot)).each((function(table){var cursor=SugarElement.fromText("");if(after$5(table,cursor),remove$5(table),editor.dom.isEmpty(editor.getBody()))editor.setContent(""),editor.selection.setCursorLocation();else{var rng=editor.dom.createRng();rng.setStart(cursor.dom,0),rng.setEnd(cursor.dom,0),editor.selection.setRng(rng),editor.nodeChanged()}}))}))},mceTableCellToggleClass:function(_ui,clazz){performActionOnSelection((function(table){var selectedCells=getCellsFromSelection(selections),formatterAction=forall(selectedCells,(function(cell){return editor.formatter.match("tablecellclass",{value:clazz},cell.dom)}))?editor.formatter.remove:editor.formatter.apply;each$2(selectedCells,(function(cell){return formatterAction("tablecellclass",{value:clazz},cell.dom)})),fireTableModified(editor,table.dom,styleModified)}))},mceTableToggleClass:function(_ui,clazz){performActionOnSelection((function(table){editor.formatter.toggle("tableclass",{value:clazz},table.dom),fireTableModified(editor,table.dom,styleModified)}))},mceTableToggleCaption:function(){getSelectionStartCellOrCaption(editor).each((function(cellOrCaption){table(cellOrCaption,isRoot).each((function(table){child$1(table,"caption").fold((function(){var caption=SugarElement.fromTag("caption");append$1(caption,SugarElement.fromText("Caption")),function(parent,element,index){child$3(parent,index).fold((function(){append$1(parent,element)}),(function(v){before$4(v,element)}))}(table,caption,0),editor.selection.setCursorLocation(caption.dom,0)}),(function(caption){isTag("caption")(cellOrCaption)&&one("td",table).each((function(td){return editor.selection.setCursorLocation(td.dom,0)})),remove$5(caption)})),fireTableModified(editor,table.dom,structureModified)}))}))},mceTableSizingMode:function(_ui,sizing){return function(sizing){return getSelectionStartCellOrCaption(editor).each((function(cellOrCaption){isResponsiveForced(editor)||isPixelsForced(editor)||isPercentagesForced(editor)||table(cellOrCaption,isRoot).each((function(table){"relative"!==sizing||isPercentSizing(table)?"fixed"!==sizing||isPixelSizing(table)?"responsive"!==sizing||isNoneSizing(table)||enforceNone(table):enforcePixels(table):enforcePercentage(table),removeDataStyle(table),fireTableModified(editor,table.dom,structureModified)}))}))}(sizing)},mceTableCellType:actOnType((function(type){return"th"===type?actions.makeCellsHeader:actions.unmakeCellsHeader})),mceTableColType:actOnType((function(type){return"th"===type?actions.makeColumnsHeader:actions.unmakeColumnsHeader})),mceTableRowType:actOnType((function(type){switch(type){case"header":return actions.makeRowsHeader;case"footer":return actions.makeRowsFooter;default:return actions.makeRowsBody}}))},(function(func,name){return editor.addCommand(name,func)})),each$1({mceTableProps:curry(open,editor,!1),mceTableRowProps:curry(open$1,editor),mceTableCellProps:curry(open$2,editor,selections)},(function(func,name){return editor.addCommand(name,(function(){return func()}))})),editor.addCommand("mceInsertTable",(function(_ui,args){isObject(args)&&keys(args).length>0?insertTableWithDataValidation(editor,args.rows,args.columns,args.options,"Invalid values for mceInsertTable - rows and columns values are required to insert a table."):open(editor,!0)})),editor.addCommand("mceTableApplyCellStyle",(function(_ui,args){var getFormatName=function(style){return"tablecell"+style.toLowerCase().replace("-","")};if(isObject(args)){var cells=getCellsFromSelection(selections);if(0!==cells.length){var validArgs=filter$1(args,(function(value,style){return editor.formatter.has(getFormatName(style))&&isString(value)}));(function(r){for(var x in r)if(hasOwnProperty.call(r,x))return!1;return!0})(validArgs)||(each$1(validArgs,(function(value,style){each$2(cells,(function(cell){DomModifier.normal(editor,cell.dom).setFormat(getFormatName(style),value)}))})),getTableFromCell(cells[0]).each((function(table){return fireTableModified(editor,table.dom,styleModified)})))}}}))},genericBase={remove_similar:!0,inherit:!1},cellBase=__assign({selector:"td,th"},genericBase),cellFormats={tablecellbackgroundcolor:__assign({styles:{backgroundColor:"%value"}},cellBase),tablecellverticalalign:__assign({styles:{"vertical-align":"%value"}},cellBase),tablecellbordercolor:__assign({styles:{borderColor:"%value"}},cellBase),tablecellclass:__assign({classes:["%value"]},cellBase),tableclass:__assign({selector:"table",classes:["%value"]},genericBase),tablecellborderstyle:__assign({styles:{borderStyle:"%value"}},cellBase),tablecellborderwidth:__assign({styles:{borderWidth:"%value"}},cellBase)},adt$5=Adt_generate([{none:["current"]},{first:["current"]},{middle:["current","target"]},{last:["current"]}]),CellLocation=__assign(__assign({},adt$5),{none:function(current){return void 0===current&&(current=void 0),adt$5.none(current)}}),walk=function(all,current,index,direction,isEligible){void 0===isEligible&&(isEligible=always);var forwards=1===direction;if(!forwards&&index<=0)return CellLocation.first(all[0]);if(forwards&&index>=all.length-1)return CellLocation.last(all[all.length-1]);var newIndex=index+direction,elem=all[newIndex];return isEligible(elem)?CellLocation.middle(current,elem):walk(all,current,newIndex,direction,isEligible)},detect$1=function(current,isRoot){return table(current,isRoot).bind((function(table){var all=cells$1(table);return findIndex(all,(function(x){return eq$1(current,x)})).map((function(index){return{index:index,all:all}}))}))},SimRange_create=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},adt$4=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ={before:adt$4.before,on:adt$4.on,after:adt$4.after,cata:function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter)},getStart:function(situ){return situ.fold(identity,identity,identity)}},adt$3=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt$3.domRange,relative:adt$3.relative,exact:adt$3.exact,exactFromRange:function(simRange){return adt$3.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){var element,start=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ.getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return element=start,SugarElement.fromDom(documentOrOwner(element).dom.defaultView)},range:SimRange_create},selectNode=function(win,element){var rng=win.document.createRange();return rng.selectNode(element.dom),rng},selectNodeContents=function(win,element){var rng=win.document.createRange();return selectNodeContentsUsing(rng,element),rng},selectNodeContentsUsing=function(rng,element){return rng.selectNodeContents(element.dom)},relativeToNative=function(win,startSitu,finishSitu){var rng,range=win.document.createRange();return rng=range,startSitu.fold((function(e){rng.setStartBefore(e.dom)}),(function(e,o){rng.setStart(e.dom,o)}),(function(e){rng.setStartAfter(e.dom)})),function(rng,situ){situ.fold((function(e){rng.setEndBefore(e.dom)}),(function(e,o){rng.setEnd(e.dom,o)}),(function(e){rng.setEndAfter(e.dom)}))}(range,finishSitu),range},exactToNative=function(win,start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},toRect=function(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height}},adt$2=Adt_generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),fromRange=function(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset)},diagnose=function(win,selection){return function(win,ranges){var rng=ranges.ltr();return rng.collapsed?ranges.rtl().filter((function(rev){return!1===rev.collapsed})).map((function(rev){return adt$2.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)})).getOrThunk((function(){return fromRange(0,adt$2.ltr,rng)})):fromRange(0,adt$2.ltr,rng)}(0,function(win,selection){return selection.match({domRange:function(rng){return{ltr:constant(rng),rtl:Optional.none}},relative:function(startSitu,finishSitu){return{ltr:cached((function(){return relativeToNative(win,startSitu,finishSitu)})),rtl:cached((function(){return Optional.some(relativeToNative(win,finishSitu,startSitu))}))}},exact:function(start,soffset,finish,foffset){return{ltr:cached((function(){return exactToNative(win,start,soffset,finish,foffset)})),rtl:cached((function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset))}))}}})}(win,selection))},asLtrRange=function(win,selection){return diagnose(win,selection).match({ltr:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},rtl:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(finish.dom,foffset),rng.setEnd(start.dom,soffset),rng}})};adt$2.ltr,adt$2.rtl;var inRect=function(rect,x,y){return x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom},locateOffset=function(doc,textnode,x,y,rect){var rangeForOffset=function(o){var r=doc.dom.createRange();return r.setStart(textnode.dom,o),r.collapse(!0),r},length=get$9(textnode).length,offset=function(rectForOffset,x,y,maxX,length){if(0===length)return 0;if(x===maxX)return length-1;for(var xDelta=maxX,i=1;i<length;i++){var rect=rectForOffset(i),curDeltaX=Math.abs(x-rect.left);if(y<=rect.bottom){if(y<rect.top||curDeltaX>xDelta)return i-1;xDelta=curDeltaX}}return 0}((function(o){return rangeForOffset(o).getBoundingClientRect()}),x,y,rect.right,length);return rangeForOffset(offset)},locateNode=function(doc,node,x,y){return isText(node)?function(doc,node,x,y){var r=doc.dom.createRange();r.selectNode(node.dom);var rects=r.getClientRects();return findMap(rects,(function(rect){return inRect(rect,x,y)?Optional.some(rect):Optional.none()})).map((function(rect){return locateOffset(doc,node,x,y,rect)}))}(doc,node,x,y):function(doc,node,x,y){var r=doc.dom.createRange(),nodes=children$3(node);return findMap(nodes,(function(n){return r.selectNode(n.dom),inRect(r.getBoundingClientRect(),x,y)?locateNode(doc,n,x,y):Optional.none()}))}(doc,node,x,y)},getCollapseDirection=function(rect,x){return x-rect.left<rect.right-x},createCollapsedNode=function(doc,target,collapseDirection){var r=doc.dom.createRange();return r.selectNode(target.dom),r.collapse(collapseDirection),r},locateInElement=function(doc,node,x){var cursorRange=doc.dom.createRange();cursorRange.selectNode(node.dom);var rect=cursorRange.getBoundingClientRect(),collapseDirection=getCollapseDirection(rect,x);return(true===collapseDirection?first:last$1)(node).map((function(target){return createCollapsedNode(doc,target,collapseDirection)}))},locateInEmpty=function(doc,node,x){var rect=node.dom.getBoundingClientRect(),collapseDirection=getCollapseDirection(rect,x);return Optional.some(createCollapsedNode(doc,node,collapseDirection))},caretPositionFromPoint=function(doc,x,y){var _a,_b;return Optional.from(null===(_b=(_a=doc.dom).caretPositionFromPoint)||void 0===_b?void 0:_b.call(_a,x,y)).bind((function(pos){if(null===pos.offsetNode)return Optional.none();var r=doc.dom.createRange();return r.setStart(pos.offsetNode,pos.offset),r.collapse(),Optional.some(r)}))},caretRangeFromPoint=function(doc,x,y){var _a,_b;return Optional.from(null===(_b=(_a=doc.dom).caretRangeFromPoint)||void 0===_b?void 0:_b.call(_a,x,y))},searchTextNodes=function(doc,node,x,y){var r=doc.dom.createRange();r.selectNode(node.dom);var rect=r.getBoundingClientRect();return function(doc,node,x,y){var r=doc.dom.createRange();r.selectNode(node.dom);var rect=r.getBoundingClientRect(),boundedX=Math.max(rect.left,Math.min(rect.right,x)),boundedY=Math.max(rect.top,Math.min(rect.bottom,y));return locateNode(doc,node,boundedX,boundedY)}(doc,node,Math.max(rect.left,Math.min(rect.right,x)),Math.max(rect.top,Math.min(rect.bottom,y)))},searchFromPoint=function(doc,x,y){return SugarElement.fromPoint(doc,x,y).bind((function(elem){var fallback=function(){return function(doc,node,x){return(0===children$3(node).length?locateInEmpty:locateInElement)(doc,node,x)}(doc,elem,x)};return 0===children$3(elem).length?fallback():searchTextNodes(doc,elem,x,y).orThunk(fallback)}))},availableSearch=document.caretPositionFromPoint?caretPositionFromPoint:document.caretRangeFromPoint?caretRangeFromPoint:searchFromPoint,beforeSpecial=function(element,offset){var name$1=name(element);return"input"===name$1?Situ.after(element):contains$2(["br","img"],name$1)?0===offset?Situ.before(element):Situ.after(element):Situ.on(element,offset)},preprocessRelative=function(startSitu,finishSitu){var start=startSitu.fold(Situ.before,beforeSpecial,Situ.after),finish=finishSitu.fold(Situ.before,beforeSpecial,Situ.after);return SimSelection.relative(start,finish)},preprocessExact=function(start,soffset,finish,foffset){var startSitu=beforeSpecial(start,soffset),finishSitu=beforeSpecial(finish,foffset);return SimSelection.relative(startSitu,finishSitu)},after$2=function(start,soffset,finish,foffset){var r=function(start,soffset,finish,foffset){var rng=owner(start).dom.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng}(start,soffset,finish,foffset),same=eq$1(start,finish)&&soffset===foffset;return r.collapsed&&!same},getNativeSelection=function(win){return Optional.from(win.getSelection())},doSetNativeRange=function(win,rng){getNativeSelection(win).each((function(selection){selection.removeAllRanges(),selection.addRange(rng)}))},doSetRange=function(win,start,soffset,finish,foffset){var rng=exactToNative(win,start,soffset,finish,foffset);doSetNativeRange(win,rng)},setRangeFromRelative=function(win,relative){return diagnose(win,relative).match({ltr:function(start,soffset,finish,foffset){doSetRange(win,start,soffset,finish,foffset)},rtl:function(start,soffset,finish,foffset){getNativeSelection(win).each((function(selection){if(selection.setBaseAndExtent)selection.setBaseAndExtent(start.dom,soffset,finish.dom,foffset);else if(selection.extend)try{!function(win,selection,start,soffset,finish,foffset){selection.collapse(start.dom,soffset),selection.extend(finish.dom,foffset)}(0,selection,start,soffset,finish,foffset)}catch(e){doSetRange(win,finish,foffset,start,soffset)}else doSetRange(win,finish,foffset,start,soffset)}))}})},setExact=function(win,start,soffset,finish,foffset){var relative=preprocessExact(start,soffset,finish,foffset);setRangeFromRelative(win,relative)},setRelative=function(win,startSitu,finishSitu){var relative=preprocessRelative(startSitu,finishSitu);setRangeFromRelative(win,relative)},toNative=function(selection){var win=SimSelection.getWin(selection).dom,getDomRange=function(start,soffset,finish,foffset){return exactToNative(win,start,soffset,finish,foffset)},filtered=function(selection){return selection.match({domRange:function(rng){var start=SugarElement.fromDom(rng.startContainer),finish=SugarElement.fromDom(rng.endContainer);return preprocessExact(start,rng.startOffset,finish,rng.endOffset)},relative:preprocessRelative,exact:preprocessExact})}(selection);return diagnose(win,filtered).match({ltr:getDomRange,rtl:getDomRange})},readRange=function(selection){if(selection.rangeCount>0){var firstRng=selection.getRangeAt(0),lastRng=selection.getRangeAt(selection.rangeCount-1);return Optional.some(SimRange_create(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(lastRng.endContainer),lastRng.endOffset))}return Optional.none()},doGetExact=function(selection){if(null===selection.anchorNode||null===selection.focusNode)return readRange(selection);var anchor=SugarElement.fromDom(selection.anchorNode),focus_1=SugarElement.fromDom(selection.focusNode);return after$2(anchor,selection.anchorOffset,focus_1,selection.focusOffset)?Optional.some(SimRange_create(anchor,selection.anchorOffset,focus_1,selection.focusOffset)):readRange(selection)},setToElement=function(win,element,selectNodeContents$1){void 0===selectNodeContents$1&&(selectNodeContents$1=!0);var rng=(selectNodeContents$1?selectNodeContents:selectNode)(win,element);doSetNativeRange(win,rng)},get$1=function(win){return function(win){return getNativeSelection(win).filter((function(sel){return sel.rangeCount>0})).bind(doGetExact)}(win).map((function(range){return SimSelection.exact(range.start,range.soffset,range.finish,range.foffset)}))},getFirstRect=function(win,selection){return function(rng){var rects=rng.getClientRects(),rect=rects.length>0?rects[0]:rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none()}(asLtrRange(win,selection))},getAtPoint=function(win,x,y){return function(win,x,y){var doc=SugarElement.fromDom(win.document);return availableSearch(doc,x,y).map((function(rng){return SimRange_create(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset)}))}(win,x,y)},global$1=tinymce.util.Tools.resolve("tinymce.util.VK"),forward=function(editor,isRoot,cell){return go$1(editor,isRoot,function(current,isEligible,isRoot){return detect$1(current,isRoot).fold((function(){return CellLocation.none(current)}),(function(info){return walk(info.all,current,info.index,1,isEligible)}))}(cell,isEditable$1))},backward=function(editor,isRoot,cell){return go$1(editor,isRoot,function(current,isEligible,isRoot){return detect$1(current,isRoot).fold((function(){return CellLocation.none()}),(function(info){return walk(info.all,current,info.index,-1,isEligible)}))}(cell,isEditable$1))},go$1=function(editor,isRoot,cell){return cell.fold(Optional.none,Optional.none,(function(current,next){return first(next).map((function(cell){return function(editor,cell){var selection=SimSelection.exact(cell,0,cell,0);return toNative(selection)}(0,cell)}))}),(function(current){return editor.execCommand("mceTableInsertRowAfter"),forward(editor,isRoot,current)}))},rootElements=["table","li","dl"],Response_create=function(selection,kill){return{selection:selection,kill:kill}},Situs_create=function(start,soffset,finish,foffset){return{start:Situ.on(start,soffset),finish:Situ.on(finish,foffset)}},convertToRange=function(win,selection){var rng=asLtrRange(win,selection);return SimRange_create(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset)},makeSitus=Situs_create,detect=function(container,isRoot,start,finish,selectRange){return eq$1(start,finish)?Optional.none():identify(start,finish,isRoot).bind((function(cellSel){var boxes=cellSel.boxes.getOr([]);return boxes.length>1?(selectRange(container,boxes,cellSel.start,cellSel.finish),Optional.some(Response_create(Optional.some(makeSitus(start,0,start,getEnd(start))),!0))):Optional.none()}))},traverse=function(item,mode){return{item:item,mode:mode}},backtrack=function(universe,item,_direction,transition){return void 0===transition&&(transition=sidestep),universe.property().parent(item).map((function(p){return traverse(p,transition)}))},sidestep=function(universe,item,direction,transition){return void 0===transition&&(transition=advance),direction.sibling(universe,item).map((function(p){return traverse(p,transition)}))},advance=function(universe,item,direction,transition){void 0===transition&&(transition=advance);var children=universe.property().children(item);return direction.first(children).map((function(r){return traverse(r,transition)}))},successors=[{current:backtrack,next:sidestep,fallback:Optional.none()},{current:sidestep,next:advance,fallback:Optional.some(backtrack)},{current:advance,next:advance,fallback:Optional.some(sidestep)}],go=function(universe,item,mode,direction,rules){return void 0===rules&&(rules=successors),find$1(rules,(function(succ){return succ.current===mode})).bind((function(rule){return rule.current(universe,item,direction,rule.next).orThunk((function(){return rule.fallback.bind((function(fb){return go(universe,item,fb,direction)}))}))}))},Walkers_left=function(){return{sibling:function(universe,item){return universe.query().prevSibling(item)},first:function(children){return children.length>0?Optional.some(children[children.length-1]):Optional.none()}}},Walkers_right=function(){return{sibling:function(universe,item){return universe.query().nextSibling(item)},first:function(children){return children.length>0?Optional.some(children[0]):Optional.none()}}},hone=function(universe,item,predicate,mode,direction,isRoot){return go(universe,item,mode,direction).bind((function(n){return isRoot(n.item)?Optional.none():predicate(n.item)?Optional.some(n.item):hone(universe,n.item,predicate,n.mode,direction,isRoot)}))},isLeaf=function(universe){return function(element){return 0===universe.property().children(element).length}},seekLeft$1=function(universe,item,predicate,isRoot){return hone(universe,item,predicate,sidestep,Walkers_left(),isRoot)},seekRight$1=function(universe,item,predicate,isRoot){return hone(universe,item,predicate,sidestep,Walkers_right(),isRoot)},universe=DomUniverse(),before=function(element,isRoot){return function(universe,item,isRoot){return seekLeft$1(universe,item,isLeaf(universe),isRoot)}(universe,element,isRoot)},after=function(element,isRoot){return function(universe,item,isRoot){return seekRight$1(universe,item,isLeaf(universe),isRoot)}(universe,element,isRoot)},adt$1=Adt_generate([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),isRow=function(elem){return closest$1(elem,"tr")},BeforeAfter=__assign(__assign({},adt$1),{verify:function(bridge,before,beforeOffset,after,afterOffset,failure,isRoot){return closest$1(after,"td,th",isRoot).bind((function(afterCell){return closest$1(before,"td,th",isRoot).map((function(beforeCell){return eq$1(afterCell,beforeCell)?eq$1(after,afterCell)&&getEnd(afterCell)===afterOffset?failure(beforeCell):adt$1.none("in same cell"):sharedOne(isRow,[afterCell,beforeCell]).fold((function(){return function(bridge,before,after){var beforeBounds=bridge.getRect(before),afterBounds=bridge.getRect(after);return afterBounds.right>beforeBounds.left&&afterBounds.left<beforeBounds.right}(bridge,beforeCell,afterCell)?adt$1.success():failure(beforeCell)}),(function(_sharedRow){return failure(beforeCell)}))}))})).getOr(adt$1.none("default"))},cata:function(subject,onNone,onSuccess,onFailedUp,onFailedDown){return subject.fold(onNone,onSuccess,onFailedUp,onFailedDown)}}),indexOf=function(elements,element){return findIndex(elements,curry(eq$1,element))},isBr=function(elem){return"br"===name(elem)},gatherer=function(cand,gather,isRoot){return gather(cand,isRoot).bind((function(target){return isText(target)&&0===get$9(target).trim().length?gatherer(target,gather,isRoot):Optional.some(target)}))},handleParent=function(isRoot,element,offset,direction){return function(element,offset){return child$3(element,offset).filter(isBr).orThunk((function(){return child$3(element,offset-1).filter(isBr)}))}(element,offset).bind((function(br){return direction.traverse(br).fold((function(){return gatherer(br,direction.gather,isRoot).map(direction.relative)}),(function(adjacent){return function(element){return parent(element).bind((function(parent){var children=children$3(parent);return indexOf(children,element).map((function(index){return function(parent,children,element,index){return{parent:parent,children:children,element:element,index:index}}(parent,children,element,index)}))}))}(adjacent).map((function(info){return Situ.on(info.parent,info.index)}))}))}))},tryBr=function(isRoot,element,offset,direction){return(isBr(element)?function(isRoot,element,direction){return direction.traverse(element).orThunk((function(){return gatherer(element,direction.gather,isRoot)})).map(direction.relative)}(isRoot,element,direction):handleParent(isRoot,element,offset,direction)).map((function(tgt){return{start:tgt,finish:tgt}}))},moveDown=function(caret,amount){return{left:caret.left,top:caret.top+amount,right:caret.right,bottom:caret.bottom+amount}},moveUp=function(caret,amount){return{left:caret.left,top:caret.top-amount,right:caret.right,bottom:caret.bottom-amount}},translate=function(caret,xDelta,yDelta){return{left:caret.left+xDelta,top:caret.top+yDelta,right:caret.right+xDelta,bottom:caret.bottom+yDelta}},toCaret=function(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom}},getElemBox=function(bridge,element){return Optional.some(bridge.getRect(element))},getBoxAt=function(bridge,element,offset){return isElement(element)?getElemBox(bridge,element).map(toCaret):isText(element)?function(bridge,element,offset){return offset>=0&&offset<getEnd(element)?bridge.getRangedRect(element,offset,element,offset+1):offset>0?bridge.getRangedRect(element,offset-1,element,offset):Optional.none()}(bridge,element,offset).map(toCaret):Optional.none()},getEntireBox=function(bridge,element){return isElement(element)?getElemBox(bridge,element).map(toCaret):isText(element)?bridge.getRangedRect(element,0,element,getEnd(element)).map(toCaret):Optional.none()},adt=Adt_generate([{none:[]},{retry:["caret"]}]),inOutsideBlock=function(bridge,element,caret){return(scope=element,predicate=isBlock,ClosestOrAncestor((function(s,test){return test(s)}),ancestor$2,scope,predicate,isRoot)).fold(never,(function(cell){return getEntireBox(bridge,cell).exists((function(box){return function(caret,box){return caret.left<box.left||Math.abs(box.right-caret.left)<1||caret.left>box.right}(caret,box)}))}));var scope,predicate,isRoot},downMovement={point:function(caret){return caret.bottom},adjuster:function(bridge,element,guessBox,original,caret){var lowerCaret=moveDown(caret,5);return Math.abs(guessBox.bottom-original.bottom)<1||guessBox.top>caret.bottom?adt.retry(lowerCaret):guessBox.top===caret.bottom?adt.retry(moveDown(caret,1)):inOutsideBlock(bridge,element,caret)?adt.retry(translate(lowerCaret,5,0)):adt.none()},move:moveDown,gather:after},adjustTil=function(bridge,movement,original,caret,numRetries){return 0===numRetries?Optional.some(caret):function(bridge,x,y){return bridge.elementFromPoint(x,y).filter((function(elm){return"table"===name(elm)})).isSome()}(bridge,caret.left,movement.point(caret))?function(bridge,movement,original,caret,numRetries){return adjustTil(bridge,movement,original,movement.move(caret,5),numRetries)}(bridge,movement,original,caret,numRetries-1):bridge.situsFromPoint(caret.left,movement.point(caret)).bind((function(guess){return guess.start.fold(Optional.none,(function(element){return getEntireBox(bridge,element).bind((function(guessBox){return movement.adjuster(bridge,element,guessBox,original,caret).fold(Optional.none,(function(newCaret){return adjustTil(bridge,movement,original,newCaret,numRetries-1)}))})).orThunk((function(){return Optional.some(caret)}))}),Optional.none)}))},retry=function(movement,bridge,caret){var moved=movement.move(caret,5),adjusted=adjustTil(bridge,movement,caret,moved,100).getOr(moved);return function(movement,adjusted,bridge){return movement.point(adjusted)>bridge.getInnerHeight()?Optional.some(movement.point(adjusted)-bridge.getInnerHeight()):movement.point(adjusted)<0?Optional.some(-movement.point(adjusted)):Optional.none()}(movement,adjusted,bridge).fold((function(){return bridge.situsFromPoint(adjusted.left,movement.point(adjusted))}),(function(delta){return bridge.scrollBy(0,delta),bridge.situsFromPoint(adjusted.left,movement.point(adjusted)-delta)}))},Retries={tryUp:curry(retry,{point:function(caret){return caret.top},adjuster:function(bridge,element,guessBox,original,caret){var higherCaret=moveUp(caret,5);return Math.abs(guessBox.top-original.top)<1||guessBox.bottom<caret.top?adt.retry(higherCaret):guessBox.bottom===caret.top?adt.retry(moveUp(caret,1)):inOutsideBlock(bridge,element,caret)?adt.retry(translate(higherCaret,5,0)):adt.none()},move:moveUp,gather:before}),tryDown:curry(retry,downMovement),ieTryUp:function(bridge,caret){return bridge.situsFromPoint(caret.left,caret.top-5)},ieTryDown:function(bridge,caret){return bridge.situsFromPoint(caret.left,caret.bottom+5)},getJumpSize:constant(5)},findSpot=function(bridge,isRoot,direction){return bridge.getSelection().bind((function(sel){return tryBr(isRoot,sel.finish,sel.foffset,direction).fold((function(){return Optional.some(point(sel.finish,sel.foffset))}),(function(brNeighbour){var range=bridge.fromSitus(brNeighbour);return function(analysis){return BeforeAfter.cata(analysis,(function(_message){return Optional.none()}),(function(){return Optional.none()}),(function(cell){return Optional.some(point(cell,0))}),(function(cell){return Optional.some(point(cell,getEnd(cell)))}))}(BeforeAfter.verify(bridge,sel.finish,sel.foffset,range.finish,range.foffset,direction.failure,isRoot))}))}))},scan=function(bridge,isRoot,element,offset,direction,numRetries){return 0===numRetries?Optional.none():tryCursor(bridge,isRoot,element,offset,direction).bind((function(situs){var range=bridge.fromSitus(situs),analysis=BeforeAfter.verify(bridge,element,offset,range.finish,range.foffset,direction.failure,isRoot);return BeforeAfter.cata(analysis,(function(){return Optional.none()}),(function(){return Optional.some(situs)}),(function(cell){return eq$1(element,cell)&&0===offset?tryAgain(bridge,element,offset,moveUp,direction):scan(bridge,isRoot,cell,0,direction,numRetries-1)}),(function(cell){return eq$1(element,cell)&&offset===getEnd(cell)?tryAgain(bridge,element,offset,moveDown,direction):scan(bridge,isRoot,cell,getEnd(cell),direction,numRetries-1)}))}))},tryAgain=function(bridge,element,offset,move,direction){return getBoxAt(bridge,element,offset).bind((function(box){return tryAt(bridge,direction,move(box,Retries.getJumpSize()))}))},tryAt=function(bridge,direction,box){var browser=detect$3().browser;return browser.isChrome()||browser.isSafari()||browser.isFirefox()||browser.isEdge()?direction.otherRetry(bridge,box):browser.isIE()?direction.ieRetry(bridge,box):Optional.none()},tryCursor=function(bridge,isRoot,element,offset,direction){return getBoxAt(bridge,element,offset).bind((function(box){return tryAt(bridge,direction,box)}))},inSameTable=function(elem,table){return ancestor$2(elem,(function(e){return parent(e).exists((function(p){return eq$1(p,table)}))}),isRoot).isSome();var isRoot},simulate=function(bridge,isRoot,direction,initial,anchor){return closest$1(initial,"td,th",isRoot).bind((function(start){return closest$1(start,"table",isRoot).bind((function(table){return inSameTable(anchor,table)?function(bridge,isRoot,direction){return findSpot(bridge,isRoot,direction).bind((function(spot){return scan(bridge,isRoot,spot.element,spot.offset,direction,20).map(bridge.fromSitus)}))}(bridge,isRoot,direction).bind((function(range){return closest$1(range.finish,"td,th",isRoot).map((function(finish){return{start:start,finish:finish,range:range}}))})):Optional.none()}))}))},navigate=function(bridge,isRoot,direction,initial,anchor,precheck){return detect$3().browser.isIE()?Optional.none():precheck(initial,isRoot).orThunk((function(){return simulate(bridge,isRoot,direction,initial,anchor).map((function(info){var range=info.range;return Response_create(Optional.some(makeSitus(range.start,range.soffset,range.finish,range.foffset)),!0)}))}))},firstUpCheck=function(initial,isRoot){return closest$1(initial,"tr",isRoot).bind((function(startRow){return closest$1(startRow,"table",isRoot).bind((function(table){var rows=descendants(table,"tr");return eq$1(startRow,rows[0])?function(element,predicate,isRoot){return seekLeft$1(universe,element,predicate,isRoot)}(table,(function(element){return last$1(element).isSome()}),isRoot).map((function(last){var lastOffset=getEnd(last);return Response_create(Optional.some(makeSitus(last,lastOffset,last,lastOffset)),!0)})):Optional.none()}))}))},lastDownCheck=function(initial,isRoot){return closest$1(initial,"tr",isRoot).bind((function(startRow){return closest$1(startRow,"table",isRoot).bind((function(table){var rows=descendants(table,"tr");return eq$1(startRow,rows[rows.length-1])?function(element,predicate,isRoot){return seekRight$1(universe,element,predicate,isRoot)}(table,(function(element){return first(element).isSome()}),isRoot).map((function(first){return Response_create(Optional.some(makeSitus(first,0,first,0)),!0)})):Optional.none()}))}))},select=function(bridge,container,isRoot,direction,initial,anchor,selectRange){return simulate(bridge,isRoot,direction,initial,anchor).bind((function(info){return detect(container,isRoot,info.start,info.finish,selectRange)}))},findCell=function(target,isRoot){return closest$1(target,"td,th",isRoot)},down={traverse:nextSibling,gather:after,relative:Situ.before,otherRetry:Retries.tryDown,ieRetry:Retries.ieTryDown,failure:BeforeAfter.failedDown},up={traverse:prevSibling,gather:before,relative:Situ.before,otherRetry:Retries.tryUp,ieRetry:Retries.ieTryUp,failure:BeforeAfter.failedUp},isKey=function(key){return function(keycode){return keycode===key}},isUp=isKey(38),isDown=isKey(40),isNavigation=function(keycode){return keycode>=37&&keycode<=40},ltr={isBackward:isKey(37),isForward:isKey(39)},rtl={isBackward:isKey(39),isForward:isKey(37)},WindowBridge=function(win){return{elementFromPoint:function(x,y){return SugarElement.fromPoint(SugarElement.fromDom(win.document),x,y)},getRect:function(element){return element.dom.getBoundingClientRect()},getRangedRect:function(start,soffset,finish,foffset){var sel=SimSelection.exact(start,soffset,finish,foffset);return getFirstRect(win,sel)},getSelection:function(){return get$1(win).map((function(exactAdt){return convertToRange(win,exactAdt)}))},fromSitus:function(situs){var relative=SimSelection.relative(situs.start,situs.finish);return convertToRange(win,relative)},situsFromPoint:function(x,y){return getAtPoint(win,x,y).map((function(exact){return Situs_create(exact.start,exact.soffset,exact.finish,exact.foffset)}))},clearSelection:function(){!function(win){getNativeSelection(win).each((function(selection){return selection.removeAllRanges()}))}(win)},collapseSelection:function(toStart){void 0===toStart&&(toStart=!1),get$1(win).each((function(sel){return sel.fold((function(rng){return rng.collapse(toStart)}),(function(startSitu,finishSitu){var situ=toStart?startSitu:finishSitu;setRelative(win,situ,situ)}),(function(start,soffset,finish,foffset){var node=toStart?start:finish,offset=toStart?soffset:foffset;setExact(win,node,offset,node,offset)}))}))},setSelection:function(sel){setExact(win,sel.start,sel.soffset,sel.finish,sel.foffset)},setRelativeSelection:function(start,finish){setRelative(win,start,finish)},selectNode:function(element){setToElement(win,element,!1)},selectContents:function(element){setToElement(win,element)},getInnerHeight:function(){return win.innerHeight},getScrollY:function(){var _DOC,doc,x,y;return(_DOC=SugarElement.fromDom(win.document),doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop,SugarPosition(x,y)).top},scrollBy:function(x,y){!function(x,y,_DOC){var win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollBy(x,y)}(x,y,SugarElement.fromDom(win.document))}}},rc=function(rows,cols){return{rows:rows,cols:cols}},mouse=function(win,container,isRoot,annotations){var handlers=function(bridge,container,isRoot,annotations){var cursor=value(),clearstate=cursor.clear,applySelection=function(event){cursor.on((function(start){annotations.clearBeforeUpdate(container),findCell(event.target,isRoot).each((function(finish){identify(start,finish,isRoot).each((function(cellSel){var boxes=cellSel.boxes.getOr([]);if(1===boxes.length){var singleCell=boxes[0],isNonEditableCell="false"===getRaw(singleCell),isCellClosestContentEditable=is(closest(event.target),singleCell,eq$1);isNonEditableCell&&isCellClosestContentEditable&&(annotations.selectRange(container,boxes,singleCell,singleCell),bridge.selectContents(singleCell))}else boxes.length>1&&(annotations.selectRange(container,boxes,cellSel.start,cellSel.finish),bridge.selectContents(finish))}))}))}))};return{clearstate:clearstate,mousedown:function(event){annotations.clear(container),findCell(event.target,isRoot).each(cursor.set)},mouseover:function(event){applySelection(event)},mouseup:function(event){applySelection(event),clearstate()}}}(WindowBridge(win),container,isRoot,annotations);return{clearstate:handlers.clearstate,mousedown:handlers.mousedown,mouseover:handlers.mouseover,mouseup:handlers.mouseup}},keyboard=function(win,container,isRoot,annotations){var bridge=WindowBridge(win),clearToNavigate=function(){return annotations.clear(container),Optional.none()};return{keydown:function(event,start,soffset,finish,foffset,direction){var realEvent=event.raw,keycode=realEvent.which,shiftKey=!0===realEvent.shiftKey;return retrieve$1(container,annotations.selectedSelector).fold((function(){return isNavigation(keycode)&&!shiftKey&&annotations.clearBeforeUpdate(container),isDown(keycode)&&shiftKey?curry(select,bridge,container,isRoot,down,finish,start,annotations.selectRange):isUp(keycode)&&shiftKey?curry(select,bridge,container,isRoot,up,finish,start,annotations.selectRange):isDown(keycode)?curry(navigate,bridge,isRoot,down,finish,start,lastDownCheck):isUp(keycode)?curry(navigate,bridge,isRoot,up,finish,start,firstUpCheck):Optional.none}),(function(selected){var update$1=function(attempts){return function(){return findMap(attempts,(function(delta){return function(rows,columns,container,selected,annotations){return shiftSelection(selected,rows,columns,annotations.firstSelectedSelector,annotations.lastSelectedSelector).map((function(newSels){return annotations.clearBeforeUpdate(container),annotations.selectRange(container,newSels.boxes,newSels.start,newSels.finish),newSels.boxes}))}(delta.rows,delta.cols,container,selected,annotations)})).fold((function(){return getEdges(container,annotations.firstSelectedSelector,annotations.lastSelectedSelector).map((function(edges){var relative=isDown(keycode)||direction.isForward(keycode)?Situ.after:Situ.before;return bridge.setRelativeSelection(Situ.on(edges.first,0),relative(edges.table)),annotations.clear(container),Response_create(Optional.none(),!0)}))}),(function(_){return Optional.some(Response_create(Optional.none(),!0))}))}};return isDown(keycode)&&shiftKey?update$1([rc(1,0)]):isUp(keycode)&&shiftKey?update$1([rc(-1,0)]):direction.isBackward(keycode)&&shiftKey?update$1([rc(0,-1),rc(-1,0)]):direction.isForward(keycode)&&shiftKey?update$1([rc(0,1),rc(1,0)]):isNavigation(keycode)&&!shiftKey?clearToNavigate:Optional.none}))()},keyup:function(event,start,soffset,finish,foffset){return retrieve$1(container,annotations.selectedSelector).fold((function(){var realEvent=event.raw,keycode=realEvent.which;return!0===realEvent.shiftKey&&isNavigation(keycode)?function(container,isRoot,start,soffset,finish,foffset,selectRange){return eq$1(start,finish)&&soffset===foffset?Optional.none():closest$1(start,"td,th",isRoot).bind((function(s){return closest$1(finish,"td,th",isRoot).bind((function(f){return detect(container,isRoot,s,f,selectRange)}))}))}(container,isRoot,start,soffset,finish,foffset,annotations.selectRange):Optional.none()}),Optional.none)}}},SelectionAnnotation_byAttr=function(ephemera,onSelection,onClear){var removeSelectionAttributes=function(element){remove$7(element,ephemera.selected),remove$7(element,ephemera.firstSelected),remove$7(element,ephemera.lastSelected)},addSelectionAttribute=function(element){set$2(element,ephemera.selected,"1")},clear=function(container){clearBeforeUpdate(container),onClear()},clearBeforeUpdate=function(container){var sels=descendants(container,ephemera.selectedSelector+","+ephemera.firstSelectedSelector+","+ephemera.lastSelectedSelector);each$2(sels,removeSelectionAttributes)};return{clearBeforeUpdate:clearBeforeUpdate,clear:clear,selectRange:function(container,cells,start,finish){clear(container),each$2(cells,addSelectionAttribute),set$2(start,ephemera.firstSelected,"1"),set$2(finish,ephemera.lastSelected,"1"),onSelection(cells,start,finish)},selectedSelector:ephemera.selectedSelector,firstSelectedSelector:ephemera.firstSelectedSelector,lastSelectedSelector:ephemera.lastSelectedSelector}},getOtherCells=function(table,target,generators){var warehouse=Warehouse.fromTable(table);return onCells(warehouse,target).map((function(selectedCells){var grid=toGrid(warehouse,generators,!1);return{upOrLeftCells:function(grid,selectedCells){var upGrid=grid.slice(0,selectedCells[selectedCells.length-1].row+1),upDetails=toDetailList(upGrid);return bind$2(upDetails,(function(detail){var slicedCells=detail.cells.slice(0,selectedCells[selectedCells.length-1].column+1);return map$1(slicedCells,(function(cell){return cell.element}))}))}(grid,selectedCells),downOrRightCells:function(grid,selectedCells){var downGrid=grid.slice(selectedCells[0].row+selectedCells[0].rowspan-1,grid.length),downDetails=toDetailList(downGrid);return bind$2(downDetails,(function(detail){var slicedCells=detail.cells.slice(selectedCells[0].column+selectedCells[0].colspan-1,detail.cells.length);return map$1(slicedCells,(function(cell){return cell.element}))}))}(grid,selectedCells)}}))},global=tinymce.util.Tools.resolve("tinymce.Env"),hasInternalTarget=function(e){return!1===has(SugarElement.fromDom(e.target),"ephox-snooker-resizer-bar")};function CellSelection(editor,lazyResize,selectionTargets){var annotations=SelectionAnnotation_byAttr(ephemera,(function(cells,start,finish){selectionTargets.targets().each((function(targets){table(start).each((function(table){var cloneFormats=getCloneElements(editor),generators=cellOperations(noop,SugarElement.fromDom(editor.getDoc()),cloneFormats),otherCells=getOtherCells(table,targets,generators);!function(editor,cells,start,finish,otherCells){editor.fire("TableSelectionChange",{cells:cells,start:start,finish:finish,otherCells:otherCells})}(editor,cells,start,finish,otherCells)}))}))}),(function(){return function(editor){editor.fire("TableSelectionClear")}(editor)}));return editor.on("init",(function(_e){var win=editor.getWin(),body=getBody(editor),isRoot=getIsRoot(editor),mouseHandlers=mouse(win,body,isRoot,annotations),keyHandlers=keyboard(win,body,isRoot,annotations),external$1=function(win,container,isRoot,annotations){var bridge=WindowBridge(win);return function(start,finish){annotations.clearBeforeUpdate(container),identify(start,finish,isRoot).each((function(cellSel){var boxes=cellSel.boxes.getOr([]);annotations.selectRange(container,boxes,cellSel.start,cellSel.finish),bridge.selectContents(finish),bridge.collapseSelection()}))}}(win,body,isRoot,annotations);editor.on("TableSelectorChange",(function(e){return external$1(e.start,e.finish)}));var lastTarget,lastTimeStamp,handleResponse=function(event,response){(function(event){return!0===event.raw.shiftKey})(event)&&(response.kill&&event.kill(),response.selection.each((function(ns){var relative=SimSelection.relative(ns.start,ns.finish),rng=asLtrRange(win,relative);editor.selection.setRng(rng)})))},isLeftMouse=function(raw){return 0===raw.button},doubleTap=(lastTarget=Cell(SugarElement.fromDom(body)),lastTimeStamp=Cell(0),{touchEnd:function(t){var target=SugarElement.fromDom(t.target);if("td"===name(target)||"th"===name(target)){var lT=lastTarget.get(),lTS=lastTimeStamp.get();eq$1(lT,target)&&t.timeStamp-lTS<300&&(t.preventDefault(),external$1(target,target))}lastTarget.set(target),lastTimeStamp.set(t.timeStamp)}});editor.on("dragstart",(function(_e){mouseHandlers.clearstate()})),editor.on("mousedown",(function(e){isLeftMouse(e)&&hasInternalTarget(e)&&mouseHandlers.mousedown(fromRawEvent(e))})),editor.on("mouseover",(function(e){var raw;(void 0===(raw=e).buttons||global.browser.isEdge()&&0===raw.buttons||0!=(1&raw.buttons))&&hasInternalTarget(e)&&mouseHandlers.mouseover(fromRawEvent(e))})),editor.on("mouseup",(function(e){isLeftMouse(e)&&hasInternalTarget(e)&&mouseHandlers.mouseup(fromRawEvent(e))})),editor.on("touchend",doubleTap.touchEnd),editor.on("keyup",(function(event){var wrappedEvent=fromRawEvent(event);if(wrappedEvent.raw.shiftKey&&isNavigation(wrappedEvent.raw.which)){var rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),end=SugarElement.fromDom(rng.endContainer);keyHandlers.keyup(wrappedEvent,start,rng.startOffset,end,rng.endOffset).each((function(response){handleResponse(wrappedEvent,response)}))}})),editor.on("keydown",(function(event){var wrappedEvent=fromRawEvent(event);lazyResize().each((function(resize){return resize.hideBars()}));var rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),end=SugarElement.fromDom(rng.endContainer),direction=onDirection(ltr,rtl)(SugarElement.fromDom(editor.selection.getStart()));keyHandlers.keydown(wrappedEvent,start,rng.startOffset,end,rng.endOffset,direction).each((function(response){handleResponse(wrappedEvent,response)})),lazyResize().each((function(resize){return resize.showBars()}))})),editor.on("NodeChange",(function(){var sel=editor.selection,start=SugarElement.fromDom(sel.getStart()),end=SugarElement.fromDom(sel.getEnd());sharedOne(table,[start,end]).fold((function(){return annotations.clear(body)}),noop)}))})),{clear:annotations.clear}}var getSelectionTargets=function(editor,selections){var targets=Cell(Optional.none()),changeHandlers=Cell([]),selectionDetails=Optional.none(),isCaption=isTag("caption"),isDisabledForSelection=function(key){return selectionDetails.forall((function(details){return!details[key]}))},getEnd=function(){return getSelectionCellOrCaption(function(editor){return SugarElement.fromDom(editor.selection.getEnd())}(editor),getIsRoot(editor))},findTargets=function(){return getSelectionCellOrCaption(getSelectionStart(editor),getIsRoot(editor)).bind((function(startCellOrCaption){return lift2(table(startCellOrCaption),getEnd().bind(table),(function(startTable,endTable){return eq$1(startTable,endTable)?isCaption(startCellOrCaption)?Optional.some(function(cell){return{element:cell,mergable:Optional.none(),unmergable:Optional.none(),selection:[cell]}}(startCellOrCaption)):Optional.some(forMenu(selections,startTable,startCellOrCaption)):Optional.none()})).bind(identity)}))},getExtractedDetails=function(targets){return table(targets.element).map((function(table){var warehouse=Warehouse.fromTable(table),selectedCells=onCells(warehouse,targets).getOr([]),locked=foldl(selectedCells,(function(acc,cell){return cell.isLocked&&(acc.onAny=!0,0===cell.column?acc.onFirst=!0:cell.column+cell.colspan>=warehouse.grid.columns&&(acc.onLast=!0)),acc}),{onAny:!1,onFirst:!1,onLast:!1});return{mergeable:onUnlockedMergable(warehouse,targets).isSome(),unmergeable:onUnlockedUnmergable(warehouse,targets).isSome(),locked:locked}}))},resetTargets=function(){targets.set(cached(findTargets)()),selectionDetails=targets.get().bind(getExtractedDetails),each$2(changeHandlers.get(),(function(handler){return handler()}))},setupHandler=function(handler){return handler(),changeHandlers.set(changeHandlers.get().concat([handler])),function(){changeHandlers.set(filter$2(changeHandlers.get(),(function(h){return h!==handler})))}},onSetup=function(api,isDisabled){return setupHandler((function(){return targets.get().fold((function(){api.setDisabled(!0)}),(function(targets){api.setDisabled(isDisabled(targets))}))}))},onSetupWithToggle=function(api,isDisabled,isActive){return setupHandler((function(){return targets.get().fold((function(){api.setDisabled(!0),api.setActive(!1)}),(function(targets){api.setDisabled(isDisabled(targets)),api.setActive(isActive(targets))}))}))},isDisabledFromLocked=function(lockedDisable){return selectionDetails.exists((function(details){return details.locked[lockedDisable]}))},onSetupTableHeaders=function(command,headerType){return function(api){return onSetupWithToggle(api,(function(targets){return isCaption(targets.element)}),(function(){return editor.queryCommandValue(command)===headerType}))}},onSetupTableRowHeaders=onSetupTableHeaders("mceTableRowType","header"),onSetupTableColumnHeaders=onSetupTableHeaders("mceTableColType","th");return editor.on("NodeChange ExecCommand TableSelectorChange",resetTargets),{onSetupTable:function(api){return onSetup(api,(function(_){return!1}))},onSetupCellOrRow:function(api){return onSetup(api,(function(targets){return isCaption(targets.element)}))},onSetupColumn:function(lockedDisable){return function(api){return onSetup(api,(function(targets){return isCaption(targets.element)||isDisabledFromLocked(lockedDisable)}))}},onSetupPasteable:function(getClipboardData){return function(api){return onSetup(api,(function(targets){return isCaption(targets.element)||getClipboardData().isNone()}))}},onSetupPasteableColumn:function(getClipboardData,lockedDisable){return function(api){return onSetup(api,(function(targets){return isCaption(targets.element)||getClipboardData().isNone()||isDisabledFromLocked(lockedDisable)}))}},onSetupMergeable:function(api){return onSetup(api,(function(_targets){return isDisabledForSelection("mergeable")}))},onSetupUnmergeable:function(api){return onSetup(api,(function(_targets){return isDisabledForSelection("unmergeable")}))},resetTargets:resetTargets,onSetupTableWithCaption:function(api){return onSetupWithToggle(api,never,(function(targets){return table(targets.element,getIsRoot(editor)).exists((function(table){return child$1(table,"caption").isSome()}))}))},onSetupTableRowHeaders:onSetupTableRowHeaders,onSetupTableColumnHeaders:onSetupTableColumnHeaders,targets:targets.get}},Plugin=function(editor){var selections=function(lazyRoot,getStart,selectedSelector){return{get:function(){return retrieve(lazyRoot(),selectedSelector).fold((function(){return getStart().fold(none$1,single)}),(function(cells){return multiple(cells)}))}}}((function(){return getBody(editor)}),(function(){return getSelectionCell(getSelectionStart(editor),getIsRoot(editor))}),ephemera.selectedSelector),selectionTargets=getSelectionTargets(editor,selections),resizeHandler=getResizeHandler(editor),cellSelection=CellSelection(editor,resizeHandler.lazyResize,selectionTargets),actions=TableActions(editor,cellSelection,resizeHandler.lazyWire),clipboard=function(){var rows=value(),cols=value();return{getRows:rows.get,setRows:function(r){r.fold(rows.clear,rows.set),cols.clear()},clearRows:rows.clear,getColumns:cols.get,setColumns:function(c){c.fold(cols.clear,cols.set),rows.clear()},clearColumns:cols.clear}}();return registerCommands(editor,actions,0,selections,clipboard),function(editor,actions,selections){var isRoot=getIsRoot(editor),lookupOnSelection=function(action){return getSelectionCell(getSelectionStart(editor)).bind((function(cell){return table(cell,isRoot).map((function(table){var targets=forMenu(selections,table,cell);return action(table,targets)}))})).getOr("")};each$1({mceTableRowType:function(){return lookupOnSelection(actions.getTableRowType)},mceTableCellType:function(){return lookupOnSelection(actions.getTableCellType)},mceTableColType:function(){return lookupOnSelection(actions.getTableColType)}},(function(func,name){return editor.addQueryValueHandler(name,func)}))}(editor,actions,selections),registerEvents(editor,selections,actions),function(editor,selections,selectionTargets,clipboard){var cmd=function(command){return function(){return editor.execCommand(command)}},insertTableAction=function(data){editor.execCommand("mceInsertTable",!1,{rows:data.numRows,columns:data.numColumns})},tableProperties={text:"Table properties",onSetup:selectionTargets.onSetupTable,onAction:cmd("mceTableProps")},deleteTable={text:"Delete table",icon:"table-delete-table",onSetup:selectionTargets.onSetupTable,onAction:cmd("mceTableDelete")};editor.ui.registry.addMenuItem("tableinsertrowbefore",{text:"Insert row before",icon:"table-insert-row-above",onAction:cmd("mceTableInsertRowBefore"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tableinsertrowafter",{text:"Insert row after",icon:"table-insert-row-after",onAction:cmd("mceTableInsertRowAfter"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tabledeleterow",{text:"Delete row",icon:"table-delete-row",onAction:cmd("mceTableDeleteRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablerowprops",{text:"Row properties",icon:"table-row-properties",onAction:cmd("mceTableRowProps"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablecutrow",{text:"Cut row",icon:"cut-row",onAction:cmd("mceTableCutRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablecopyrow",{text:"Copy row",icon:"duplicate-row",onAction:cmd("mceTableCopyRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablepasterowbefore",{text:"Paste row before",icon:"paste-row-before",onAction:cmd("mceTablePasteRowBefore"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),editor.ui.registry.addMenuItem("tablepasterowafter",{text:"Paste row after",icon:"paste-row-after",onAction:cmd("mceTablePasteRowAfter"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)});var row={type:"nestedmenuitem",text:"Row",getSubmenuItems:constant("tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter")};editor.ui.registry.addMenuItem("tableinsertcolumnbefore",{text:"Insert column before",icon:"table-insert-column-before",onAction:cmd("mceTableInsertColBefore"),onSetup:selectionTargets.onSetupColumn("onFirst")}),editor.ui.registry.addMenuItem("tableinsertcolumnafter",{text:"Insert column after",icon:"table-insert-column-after",onAction:cmd("mceTableInsertColAfter"),onSetup:selectionTargets.onSetupColumn("onLast")}),editor.ui.registry.addMenuItem("tabledeletecolumn",{text:"Delete column",icon:"table-delete-column",onAction:cmd("mceTableDeleteCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addMenuItem("tablecutcolumn",{text:"Cut column",icon:"cut-column",onAction:cmd("mceTableCutCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addMenuItem("tablecopycolumn",{text:"Copy column",icon:"duplicate-column",onAction:cmd("mceTableCopyCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addMenuItem("tablepastecolumnbefore",{text:"Paste column before",icon:"paste-column-before",onAction:cmd("mceTablePasteColBefore"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onFirst")}),editor.ui.registry.addMenuItem("tablepastecolumnafter",{text:"Paste column after",icon:"paste-column-after",onAction:cmd("mceTablePasteColAfter"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onLast")});var column={type:"nestedmenuitem",text:"Column",getSubmenuItems:constant("tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn | tablecutcolumn tablecopycolumn tablepastecolumnbefore tablepastecolumnafter")};editor.ui.registry.addMenuItem("tablecellprops",{text:"Cell properties",icon:"table-cell-properties",onAction:cmd("mceTableCellProps"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablemergecells",{text:"Merge cells",icon:"table-merge-cells",onAction:cmd("mceTableMergeCells"),onSetup:selectionTargets.onSetupMergeable}),editor.ui.registry.addMenuItem("tablesplitcells",{text:"Split cell",icon:"table-split-cells",onAction:cmd("mceTableSplitCells"),onSetup:selectionTargets.onSetupUnmergeable});var cell={type:"nestedmenuitem",text:"Cell",getSubmenuItems:constant("tablecellprops tablemergecells tablesplitcells")};!1===function(editor){return editor.getParam("table_grid",!0,"boolean")}(editor)?editor.ui.registry.addMenuItem("inserttable",{text:"Table",icon:"table",onAction:cmd("mceInsertTable")}):editor.ui.registry.addNestedMenuItem("inserttable",{text:"Table",icon:"table",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"inserttable",onAction:insertTableAction}]}}),editor.ui.registry.addMenuItem("inserttabledialog",{text:"Insert table",icon:"table",onAction:cmd("mceInsertTable")}),editor.ui.registry.addMenuItem("tableprops",tableProperties),editor.ui.registry.addMenuItem("deletetable",deleteTable),editor.ui.registry.addNestedMenuItem("row",row),editor.ui.registry.addNestedMenuItem("column",column),editor.ui.registry.addNestedMenuItem("cell",cell),editor.ui.registry.addContextMenu("table",{update:function(){return selectionTargets.resetTargets(),selectionTargets.targets().fold(constant(""),(function(targets){return"caption"===name(targets.element)?"tableprops deletetable":"cell row column | advtablesort | tableprops deletetable"}))}});var tableClassList=filterNoneItem(getTableClassList(editor));0!==tableClassList.length&&editor.ui.registry.addNestedMenuItem("tableclass",{icon:"table-classes",text:"Table styles",getSubmenuItems:function(){return buildMenuItems(editor,selections,tableClassList,"tableclass",(function(value){return editor.execCommand("mceTableToggleClass",!1,value)}))},onSetup:selectionTargets.onSetupTable});var tableCellClassList=filterNoneItem(getCellClassList(editor));0!==tableCellClassList.length&&editor.ui.registry.addNestedMenuItem("tablecellclass",{icon:"table-cell-classes",text:"Cell styles",getSubmenuItems:function(){return buildMenuItems(editor,selections,tableCellClassList,"tablecellclass",(function(value){return editor.execCommand("mceTableCellToggleClass",!1,value)}))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellvalign",{icon:"vertical-align",text:"Vertical align",getSubmenuItems:function(){return buildMenuItems(editor,selections,verticalAlignValues,"tablecellverticalalign",applyTableCellStyle(editor,"vertical-align"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellborderwidth",{icon:"border-width",text:"Border width",getSubmenuItems:function(){return buildMenuItems(editor,selections,getTableBorderWidths(editor),"tablecellborderwidth",applyTableCellStyle(editor,"border-width"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellborderstyle",{icon:"border-style",text:"Border style",getSubmenuItems:function(){return buildMenuItems(editor,selections,getTableBorderStyles(editor),"tablecellborderstyle",applyTableCellStyle(editor,"border-style"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleMenuItem("tablecaption",{icon:"table-caption",text:"Table caption",onAction:cmd("mceTableToggleCaption"),onSetup:selectionTargets.onSetupTableWithCaption}),editor.ui.registry.addNestedMenuItem("tablecellbackgroundcolor",{icon:"cell-background-color",text:"Background color",getSubmenuItems:function(){return buildColorMenu(editor,getTableBackgroundColorMap(editor),"background-color")},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellbordercolor",{icon:"cell-border-color",text:"Border color",getSubmenuItems:function(){return buildColorMenu(editor,getTableBorderColorMap(editor),"border-color")},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleMenuItem("tablerowheader",{text:"Row header",icon:"table-top-header",onAction:changeRowHeader(editor),onSetup:selectionTargets.onSetupTableRowHeaders}),editor.ui.registry.addToggleMenuItem("tablecolheader",{text:"Column header",icon:"table-left-header",onAction:changeColumnHeader(editor),onSetup:selectionTargets.onSetupTableColumnHeaders})}(editor,selections,selectionTargets,clipboard),function(editor,selections,selectionTargets,clipboard){editor.ui.registry.addMenuButton("table",{tooltip:"Table",icon:"table",fetch:function(callback){return callback("inserttable | cell row column | advtablesort | tableprops deletetable")}});var cmd=function(command){return function(){return editor.execCommand(command)}};editor.ui.registry.addButton("tableprops",{tooltip:"Table properties",onAction:cmd("mceTableProps"),icon:"table",onSetup:selectionTargets.onSetupTable}),editor.ui.registry.addButton("tabledelete",{tooltip:"Delete table",onAction:cmd("mceTableDelete"),icon:"table-delete-table",onSetup:selectionTargets.onSetupTable}),editor.ui.registry.addButton("tablecellprops",{tooltip:"Cell properties",onAction:cmd("mceTableCellProps"),icon:"table-cell-properties",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablemergecells",{tooltip:"Merge cells",onAction:cmd("mceTableMergeCells"),icon:"table-merge-cells",onSetup:selectionTargets.onSetupMergeable}),editor.ui.registry.addButton("tablesplitcells",{tooltip:"Split cell",onAction:cmd("mceTableSplitCells"),icon:"table-split-cells",onSetup:selectionTargets.onSetupUnmergeable}),editor.ui.registry.addButton("tableinsertrowbefore",{tooltip:"Insert row before",onAction:cmd("mceTableInsertRowBefore"),icon:"table-insert-row-above",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tableinsertrowafter",{tooltip:"Insert row after",onAction:cmd("mceTableInsertRowAfter"),icon:"table-insert-row-after",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tabledeleterow",{tooltip:"Delete row",onAction:cmd("mceTableDeleteRow"),icon:"table-delete-row",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablerowprops",{tooltip:"Row properties",onAction:cmd("mceTableRowProps"),icon:"table-row-properties",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tableinsertcolbefore",{tooltip:"Insert column before",onAction:cmd("mceTableInsertColBefore"),icon:"table-insert-column-before",onSetup:selectionTargets.onSetupColumn("onFirst")}),editor.ui.registry.addButton("tableinsertcolafter",{tooltip:"Insert column after",onAction:cmd("mceTableInsertColAfter"),icon:"table-insert-column-after",onSetup:selectionTargets.onSetupColumn("onLast")}),editor.ui.registry.addButton("tabledeletecol",{tooltip:"Delete column",onAction:cmd("mceTableDeleteCol"),icon:"table-delete-column",onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addButton("tablecutrow",{tooltip:"Cut row",icon:"cut-row",onAction:cmd("mceTableCutRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablecopyrow",{tooltip:"Copy row",icon:"duplicate-row",onAction:cmd("mceTableCopyRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablepasterowbefore",{tooltip:"Paste row before",icon:"paste-row-before",onAction:cmd("mceTablePasteRowBefore"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),editor.ui.registry.addButton("tablepasterowafter",{tooltip:"Paste row after",icon:"paste-row-after",onAction:cmd("mceTablePasteRowAfter"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),editor.ui.registry.addButton("tablecutcol",{tooltip:"Cut column",icon:"cut-column",onAction:cmd("mceTableCutCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addButton("tablecopycol",{tooltip:"Copy column",icon:"duplicate-column",onAction:cmd("mceTableCopyCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addButton("tablepastecolbefore",{tooltip:"Paste column before",icon:"paste-column-before",onAction:cmd("mceTablePasteColBefore"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onFirst")}),editor.ui.registry.addButton("tablepastecolafter",{tooltip:"Paste column after",icon:"paste-column-after",onAction:cmd("mceTablePasteColAfter"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onLast")}),editor.ui.registry.addButton("tableinsertdialog",{tooltip:"Insert table",onAction:cmd("mceInsertTable"),icon:"table"});var tableClassList=filterNoneItem(getTableClassList(editor));0!==tableClassList.length&&editor.ui.registry.addMenuButton("tableclass",{icon:"table-classes",tooltip:"Table styles",fetch:generateMenuItemsCallback(editor,selections,tableClassList,"tableclass",(function(value){return editor.execCommand("mceTableToggleClass",!1,value)})),onSetup:selectionTargets.onSetupTable});var tableCellClassList=filterNoneItem(getCellClassList(editor));0!==tableCellClassList.length&&editor.ui.registry.addMenuButton("tablecellclass",{icon:"table-cell-classes",tooltip:"Cell styles",fetch:generateMenuItemsCallback(editor,selections,tableCellClassList,"tablecellclass",(function(value){return editor.execCommand("mceTableCellToggleClass",!1,value)})),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellvalign",{icon:"vertical-align",tooltip:"Vertical align",fetch:generateMenuItemsCallback(editor,selections,verticalAlignValues,"tablecellverticalalign",applyTableCellStyle(editor,"vertical-align")),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellborderwidth",{icon:"border-width",tooltip:"Border width",fetch:generateMenuItemsCallback(editor,selections,getTableBorderWidths(editor),"tablecellborderwidth",applyTableCellStyle(editor,"border-width")),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellborderstyle",{icon:"border-style",tooltip:"Border style",fetch:generateMenuItemsCallback(editor,selections,getTableBorderStyles(editor),"tablecellborderstyle",applyTableCellStyle(editor,"border-style")),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleButton("tablecaption",{tooltip:"Table caption",onAction:cmd("mceTableToggleCaption"),icon:"table-caption",onSetup:selectionTargets.onSetupTableWithCaption}),editor.ui.registry.addMenuButton("tablecellbackgroundcolor",{icon:"cell-background-color",tooltip:"Background color",fetch:function(callback){return callback(buildColorMenu(editor,getTableBackgroundColorMap(editor),"background-color"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellbordercolor",{icon:"cell-border-color",tooltip:"Border color",fetch:function(callback){return callback(buildColorMenu(editor,getTableBorderColorMap(editor),"border-color"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleButton("tablerowheader",{tooltip:"Row header",icon:"table-top-header",onAction:changeRowHeader(editor),onSetup:selectionTargets.onSetupTableRowHeaders}),editor.ui.registry.addToggleButton("tablecolheader",{tooltip:"Column header",icon:"table-left-header",onAction:changeColumnHeader(editor),onSetup:selectionTargets.onSetupTableColumnHeaders})}(editor,selections,selectionTargets,clipboard),function(editor){var toolbar=function(editor){return editor.getParam("table_toolbar","tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol")}(editor);toolbar.length>0&&editor.ui.registry.addContextToolbar("table",{predicate:function(table){return editor.dom.is(table,"table")&&editor.getBody().contains(table)},items:toolbar,scope:"node",position:"node"})}(editor),editor.on("PreInit",(function(){editor.serializer.addTempAttr(ephemera.firstSelected),editor.serializer.addTempAttr(ephemera.lastSelected),function(editor){editor.formatter.register(cellFormats)}(editor)})),function(editor){return editor.getParam("table_tab_navigation",!0,"boolean")}(editor)&&editor.on("keydown",(function(e){!function(event,editor,cellSelection){if(event.keyCode===global$1.TAB){var body_1=getBody(editor),isRoot_1=function(element){var name$1=name(element);return eq$1(element,body_1)||contains$2(rootElements,name$1)},rng=editor.selection.getRng(),container=SugarElement.fromDom(event.shiftKey?rng.startContainer:rng.endContainer);cell(container,isRoot_1).each((function(cell){event.preventDefault(),table(cell,isRoot_1).each(cellSelection.clear),editor.selection.collapse(event.shiftKey),(event.shiftKey?backward:forward)(editor,isRoot_1,cell).each((function(range){editor.selection.setRng(range)}))}))}}(e,editor,cellSelection)})),editor.on("remove",(function(){resizeHandler.destroy()})),function(editor,clipboard,resizeHandler,selectionTargets){return{insertTable:insertTable(editor),setClipboardRows:setClipboardElements(clipboard.setRows),getClipboardRows:getClipboardElements(clipboard.getRows),setClipboardCols:setClipboardElements(clipboard.setColumns),getClipboardCols:getClipboardElements(clipboard.getColumns),resizeHandler:resizeHandler,selectionTargets:selectionTargets}}(editor,clipboard,resizeHandler,selectionTargets)};!function Plugin$1(){global$3.add("table",Plugin)}()}();