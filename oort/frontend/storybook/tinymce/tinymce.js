!function(){"use strict";var typeOf$1=function(x){if(null===x)return"null";if(void 0===x)return"undefined";var t=typeof x;return"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t},eq$2=function(f){return{eq:f}},eqString=eq$2((function(x,y){return x===y})),eqArray=function(eqa){return eq$2((function(x,y){if(x.length!==y.length)return!1;for(var len=x.length,i=0;i<len;i++)if(!eqa.eq(x[i],y[i]))return!1;return!0}))},eqSortedArray=function(eqa,compareFn){return function(eqa,f){return eq$2((function(x,y){return eqa.eq(f(x),f(y))}))}(eqArray(eqa),(function(xs){return function(xs,compareFn){return Array.prototype.slice.call(xs).sort(compareFn)}(xs,compareFn)}))},eqRecord=function(eqa){return eq$2((function(x,y){var kx=Object.keys(x),ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky))return!1;for(var len=kx.length,i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q]))return!1}return!0}))},eqAny=eq$2((function(x,y){if(x===y)return!0;var tx=typeOf$1(x);return tx===typeOf$1(y)&&(function(x){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(x)}(tx)?x===y:"array"===tx?eqArray(eqAny).eq(x,y):"object"===tx&&eqRecord(eqAny).eq(x,y))})),isType$1=function(type){return function(value){return t=typeof(x=value),(null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t)===type;var x,t}},isSimpleType=function(type){return function(value){return typeof value===type}},eq$1=function(t){return function(a){return t===a}},isString$1=isType$1("string"),isObject=isType$1("object"),isArray$1=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),noop=function(){},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},compose1=function(fbc,fab){return function(a){return fbc(fab(a))}},constant=function(value){return function(){return value}},identity=function(x){return x},tripleEquals=function(a,b){return a===b};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var not=function(f){return function(t){return!f(t)}},apply=function(f){return f()},call=function(f){f()},never=constant(!1),always=constant(!0),none=function(){return NONE},NONE=function(){var call=function(thunk){return thunk()},id=identity;return{fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant("none()")}}(),some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},Optional={some,none,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},contains$3=function(xs,x){return rawIndexOf(xs,x)>-1},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return!0}return!1},map$3=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$k=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i)}},eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--){f(xs[i],i)}},partition=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass,fail}},filter$4=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return eachr(xs,(function(x,i){acc=f(acc,x,i)})),acc},foldl=function(xs,f,acc){return each$k(xs,(function(x,i){acc=f(acc,x,i)})),acc},findUntil$1=function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find$3=function(xs,pred){return findUntil$1(xs,pred,never)},findIndex$2=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},bind=function(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map$3(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){if(!0!==pred(xs[i],i))return!1}return!0},reverse=function(xs){var r=nativeSlice.call(xs,0);return r.reverse(),r},difference=function(a1,a2){return filter$4(a1,(function(x){return!contains$3(a2,x)}))},sort=function(xs,comparator){var copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy},get$a=function(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get$a(xs,0)},last$2=function(xs){return get$a(xs,xs.length-1)},from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty$1=Object.hasOwnProperty,each$j=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},map$2=function(obj,f){return tupleMap(obj,(function(x,i){return{k:i,v:f(x,i)}}))},tupleMap=function(obj,f){var r={};return each$j(obj,(function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v})),r},objAcc=function(r){return function(x,i){r[i]=x}},internalFilter=function(obj,pred,onTrue,onFalse){return each$j(obj,(function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})),{}},filter$3=function(obj,pred){var t={};return internalFilter(obj,pred,objAcc(t),noop),t},values=function(obj){return function(obj,f){var r=[];return each$j(obj,(function(value,name){r.push(f(value,name))})),r}(obj,identity)},get$9=function(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none()},has$2=function(obj,key){return hasOwnProperty$1.call(obj,key)},hasNonNullableKey=function(obj,key){return has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key]},isArray=Array.isArray,each$i=function(o,cb,s){var n,l;if(!o)return!1;if(s=s||o,void 0!==o.length){for(n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return!1}else for(n in o)if(has$2(o,n)&&!1===cb.call(s,o[n],n,o))return!1;return!0},map$1=function(array,callback){var out=[];return each$i(array,(function(item,index){out.push(callback(item,index,array))})),out},filter$2=function(a,f){var o=[];return each$i(a,(function(v,index){f&&!f(v,index,a)||o.push(v)})),o},indexOf$1=function(a,v){if(a)for(var i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1},reduce=function(collection,iteratee,accumulator,thisArg){for(var acc=isUndefined(accumulator)?collection[0]:accumulator,i=0;i<collection.length;i++)acc=iteratee.call(thisArg,acc,collection[i],i);return acc},findIndex$1=function(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1},last$1=function(collection){return collection[collection.length-1]},__assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}var cached=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},unknown$2=function(){return nu$4(0,0)},nu$4=function(major,minor){return{major,minor}},Version={nu:nu$4,detect:function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown$2():function(regexes,agent){var r=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}}(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu$4(group(1),group(2))}(versionRegexes,cleanedAgent)},unknown:unknown$2},detect$2=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$3(candidates,(function(candidate){return candidate.search(agent)}))},contains$2=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr}(str,prefix,0)},blank=function(r){return function(s){return s.replace(r,"")}},trim$4=blank(/^\s+|\s+$/g),lTrim=blank(/^\s+/g),rTrim=blank(/\s+$/g),isNotEmpty=function(s){return s.length>0},isEmpty$3=function(s){return!isNotEmpty(s)},normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return contains$2(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$2(uastring,"edge/")&&contains$2(uastring,"chrome")&&contains$2(uastring,"safari")&&contains$2(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$2(uastring,"chrome")&&!contains$2(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$2(uastring,"msie")||contains$2(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$2(uastring,"safari")||contains$2(uastring,"mobile/"))&&contains$2(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$2(uastring,"iphone")||contains$2(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(browsers),oses:constant(oses)},nu$3=function(info){var current=info.current,version=info.version,isBrowser=function(name){return function(){return current===name}};return{current,version,isEdge:isBrowser("Edge"),isChrome:isBrowser("Chrome"),isIE:isBrowser("IE"),isOpera:isBrowser("Opera"),isFirefox:isBrowser("Firefox"),isSafari:isBrowser("Safari")}},Browser={unknown:function(){return nu$3({current:void 0,version:Version.unknown()})},nu:nu$3,edge:constant("Edge"),chrome:constant("Chrome"),ie:constant("IE"),opera:constant("Opera"),firefox:constant("Firefox"),safari:constant("Safari")},nu$2=function(info){var current=info.current,version=info.version,isOS=function(name){return function(){return current===name}};return{current,version,isWindows:isOS("Windows"),isiOS:isOS("iOS"),isAndroid:isOS("Android"),isOSX:isOS("OSX"),isLinux:isOS("Linux"),isSolaris:isOS("Solaris"),isFreeBSD:isOS("FreeBSD"),isChromeOS:isOS("ChromeOS")}},OperatingSystem={unknown:function(){return nu$2({current:void 0,version:Version.unknown()})},nu:nu$2,windows:constant("Windows"),ios:constant("iOS"),android:constant("Android"),linux:constant("Linux"),osx:constant("OSX"),solaris:constant("Solaris"),freebsd:constant("FreeBSD"),chromeos:constant("ChromeOS")},PlatformDetection_detect=function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=userAgentDataOpt.bind((function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,(function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$3(browsers,(function(browser){var _a;return lcBrand===(null===(_a=browser.brand)||void 0===_a?void 0:_a.toLowerCase())})).map((function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}}))}))}(browsers,userAgentData)})).orThunk((function(){return function(browsers,userAgent){return detect$2(browsers,userAgent).map((function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version}}))}(browsers,userAgent)})).fold(Browser.unknown,Browser.nu),os=function(oses,userAgent){return detect$2(oses,userAgent).map((function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version}}))}(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)}}(os,browser,userAgent,mediaMatch);return{browser,os,deviceType}},mediaMatch=function(query){return window.matchMedia(query).matches},platform$2=cached((function(){return PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)})),detect=function(){return platform$2()},userAgent=navigator.userAgent,platform$1=detect(),browser$4=platform$1.browser,os=platform$1.os,deviceType=platform$1.deviceType,webkit=/WebKit/.test(userAgent)&&!browser$4.isEdge(),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,windowsPhone=-1!==userAgent.indexOf("Windows Phone"),Env={opera:browser$4.isOpera(),webkit,ie:!(!browser$4.isIE()&&!browser$4.isEdge())&&browser$4.version.major,gecko:browser$4.isFirefox(),mac:os.isOSX()||os.isiOS(),iOS:deviceType.isiPad()||deviceType.isiPhone(),android:os.isAndroid(),contentEditable:!0,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:!0,range:window.getSelection&&"Range"in window,documentMode:browser$4.isIE()?document.documentMode||7:10,fileApi,ceFalse:!0,cacheSuffix:null,container:null,experimentalShadowDom:!1,canHaveCSP:!browser$4.isIE(),desktop:deviceType.isDesktop(),windowsPhone,browser:{current:browser$4.current,version:browser$4.version,isChrome:browser$4.isChrome,isEdge:browser$4.isEdge,isFirefox:browser$4.isFirefox,isIE:browser$4.isIE,isOpera:browser$4.isOpera,isSafari:browser$4.isSafari},os:{current:os.current,version:os.version,isAndroid:os.isAndroid,isChromeOS:os.isChromeOS,isFreeBSD:os.isFreeBSD,isiOS:os.isiOS,isLinux:os.isLinux,isOSX:os.isOSX,isSolaris:os.isSolaris,isWindows:os.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}},whiteSpaceRegExp$2=/^\s*|\s*$/g,trim$3=function(str){return null==str?"":(""+str).replace(whiteSpaceRegExp$2,"")},is$3=function(obj,type){return type?!("array"!==type||!isArray(obj))||typeof obj===type:void 0!==obj},walk$3=function(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),each$i(o,(function(o,i){if(!1===f.call(s,o,i,n))return!1;walk$3(o,f,n,s)})))},Tools={trim:trim$3,isArray,is:is$3,toArray:function(obj){if(isArray(obj))return obj;for(var array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array},makeMap:function(items,delim,map){var i;for(delim=delim||",","string"==typeof(items=items||[])&&(items=items.split(delim)),map=map||{},i=items.length;i--;)map[items[i]]={};return map},each:each$i,map:map$1,grep:filter$2,inArray:indexOf$1,hasOwn:has$2,extend:function(obj){for(var exts=[],_i=1;_i<arguments.length;_i++)exts[_i-1]=arguments[_i];for(var i=0;i<exts.length;i++){var ext=exts[i];for(var name_1 in ext)if(has$2(ext,name_1)){var value=ext[name_1];void 0!==value&&(obj[name_1]=value)}}return obj},create:function(s,p,root){var sp,scn,c,de=0,cn=(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s))[3].match(/(^|\.)(\w+)$/i)[2],ns=this.createNS(s[3].replace(/\.\w+$/,""),root);if(!ns[cn]){if("static"===s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=function(){},de=1),ns[cn]=p[cn],this.extend(ns[cn].prototype,p),s[5]&&(sp=this.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],ns[cn]=de?function(){return sp[scn].apply(this,arguments)}:function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],this.each(sp,(function(f,n){ns[cn].prototype[n]=sp[n]})),this.each(p,(function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!==cn&&(ns[cn].prototype[n]=f)}))),this.each(p.static,(function(f,n){ns[cn][n]=f}))}},walk:walk$3,createNS:function(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)o[v=n[i]]||(o[v]={}),o=o[v];return o},resolve:function(n,o){var i,l;for(o=o||window,i=0,l=(n=n.split(".")).length;i<l&&(o=o[n[i]]);i++);return o},explode:function(s,d){return!s||is$3(s,"array")?s:map$1(s.split(d||","),trim$3)},_addCacheSuffix:function(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}},fromDom$2=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},SugarElement={fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom$2(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom$2(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom$2(node)},fromDom:fromDom$2,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2)}},toArray=function(target,f){var r=[],recurse=function(e){return r.push(e),f(e)},cur=f(target);do{cur=cur.bind(recurse)}while(cur.isSome());return r},is$2=function(element,selector){var dom=element.dom;if(1!==dom.nodeType)return!1;var elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},bypassSelector=function(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount},eq=function(e1,e2){return e1.dom===e2.dom},ieContains=function(e1,e2){return a=e1.dom,b=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY);var a,b},contains$1=function(e1,e2){return detect().browser.isIE()?ieContains(e1,e2):function(e1,e2){var d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)}(e1,e2)};"undefined"!=typeof window?window:Function("return this;")();var name=function(element){return element.dom.nodeName.toLowerCase()},type=function(element){return element.dom.nodeType},isType=function(t){return function(element){return type(element)===t}},isElement$6=isType(1),isText$8=isType(3),isDocument$2=isType(9),isDocumentFragment$1=isType(11),owner$1=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument$2(dos)?dos:owner$1(dos)},defaultView=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},prevSibling=function(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom)},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},prevSiblings=function(element){return reverse(toArray(element,prevSibling))},nextSiblings=function(element){return toArray(element,nextSibling)},children=function(element){return map$3(element.dom.childNodes,SugarElement.fromDom)},child$1=function(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},firstChild=function(element){return child$1(element,0)},lastChild=function(element){return child$1(element,element.dom.childNodes.length-1)},childNodesCount=function(element){return element.dom.childNodes.length},isShadowRoot=function(dos){return isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host)},supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported$1=constant(supported),getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getStyleContainer=function(dos){return isShadowRoot(dos)?dos:function(doc){var b=doc.dom.head;if(null==b)throw new Error("Head is not available yet");return SugarElement.fromDom(b)}(documentOrOwner(dos))},getShadowHost=function(e){return SugarElement.fromDom(e.dom.host)},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},before$4=function(marker,element){parent(marker).each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},after$3=function(marker,element){nextSibling(marker).fold((function(){parent(marker).each((function(v){append$1(v,element)}))}),(function(v){before$4(v,element)}))},prepend=function(parent,element){firstChild(parent).fold((function(){append$1(parent,element)}),(function(v){parent.dom.insertBefore(element.dom,v.dom)}))},append$1=function(parent,element){parent.dom.appendChild(element.dom)},append=function(parent,elements){each$k(elements,(function(x){append$1(parent,x)}))},empty=function(element){element.dom.textContent="",each$k(children(element),(function(rogue){remove$7(rogue)}))},remove$7=function(element){var dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=function(wrapper){var marker,children$1=children(wrapper);children$1.length>0&&(marker=wrapper,each$k(children$1,(function(x){before$4(marker,x)}))),remove$7(wrapper)},inBody=function(element){var dom=isText$8(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var doc=dom.ownerDocument;return function(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none()}(SugarElement.fromDom(dom)).fold((function(){return doc.body.contains(dom)}),compose1(inBody,getShadowHost))},r=function(left,top){return{left,top,translate:function(x,y){return r(left+x,top+y)}}},SugarPosition=r,firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},viewport=function(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?function(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)}(dom):SugarPosition(0,0)},get$8=function(_DOC){var doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y)},to=function(x,y,_DOC){var win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollTo(x,y)},intoView=function(element,alignToTop){detect().browser.isSafari()&&isFunction(element.dom.scrollIntoViewIfNeeded)?element.dom.scrollIntoViewIfNeeded(!1):element.dom.scrollIntoView(alignToTop)},bounds=function(x,y,width,height){return{x,y,width,height,right:x+width,bottom:y+height}},getBounds=function(_win){var win=void 0===_win?window:_win,doc=win.document,scroll=get$8(SugarElement.fromDom(doc));return function(_win){var win=void 0===_win?window:_win;return detect().browser.isFirefox()?Optional.none():Optional.from(win.visualViewport)}(win).fold((function(){var html=win.document.documentElement,width=html.clientWidth,height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height)}),(function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)}))},isNodeType=function(type){return function(node){return!!node&&node.nodeType===type}},isRestrictedNode=function(node){return!!node&&!Object.getPrototypeOf(node)},isElement$5=isNodeType(1),matchNodeNames=function(names){var lowercasedNames=names.map((function(s){return s.toLowerCase()}));return function(node){if(node&&node.nodeName){var nodeName=node.nodeName.toLowerCase();return contains$3(lowercasedNames,nodeName)}return!1}},matchStyleValues=function(name,values){var items=values.toLowerCase().split(" ");return function(node){if(isElement$5(node))for(var i=0;i<items.length;i++){var computed=node.ownerDocument.defaultView.getComputedStyle(node,null);if((computed?computed.getPropertyValue(name):null)===items[i])return!0}return!1}},hasAttribute=function(attrName){return function(node){return isElement$5(node)&&node.hasAttribute(attrName)}},isBogus$2=function(node){return isElement$5(node)&&node.hasAttribute("data-mce-bogus")},isTable$3=function(node){return isElement$5(node)&&"TABLE"===node.tagName},hasContentEditableState=function(value){return function(node){if(isElement$5(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}},isTextareaOrInput=matchNodeNames(["textarea","input"]),isText$7=isNodeType(3),isComment=isNodeType(8),isDocument$1=isNodeType(9),isDocumentFragment=isNodeType(11),isBr$5=matchNodeNames(["br"]),isImg=matchNodeNames(["img"]),isContentEditableTrue$4=hasContentEditableState("true"),isContentEditableFalse$b=hasContentEditableState("false"),isTableCell$5=matchNodeNames(["td","th"]),isMedia$2=matchNodeNames(["video","audio","object","embed"]),is$1=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists((function(left){return comparator(left,rhs)}))},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},isSupported=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},rawSet=function(dom,key,value){if(!(isString$1(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$1=function(element,key,value){rawSet(element.dom,key,value)},setAll$1=function(element,attrs){var dom=element.dom;each$j(attrs,(function(v,k){rawSet(dom,k,v)}))},get$6=function(element,key){var v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=function(element,key){return Optional.from(get$6(element,key))},remove$6=function(element,key){element.dom.removeAttribute(key)},setAll=function(element,css){var dom=element.dom;each$j(css,(function(v,k){!function(dom,property,value){if(!isString$1(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported(dom)&&dom.style.setProperty(property,value)}(dom,k,v)}))},get$5=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){var dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((function(r){return r.length>0}))},getAllRaw=function(element){var css={},dom=element.dom;if(isSupported(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css},browser$3=detect().browser,firstElement=function(nodes){return find$3(nodes,isElement$6)},hasChild=function(elm,child){return elm.children&&contains$3(elm.children,child)},getPos=function(body,elm,rootElm){var x=0,y=0,doc=body.ownerDocument;if(rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===get$5(SugarElement.fromDom(body),"position")){var pos=elm.getBoundingClientRect();return{x:x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft,y:y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop}}for(var offsetParent=elm;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);){var castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0,y+=castOffsetParent.offsetTop||0,offsetParent=castOffsetParent.offsetParent}for(offsetParent=elm.parentNode;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode;y+=function(elm){return browser$3.isFirefox()&&"table"===name(elm)?firstElement(children(elm)).filter((function(elm){return"caption"===name(elm)})).bind((function(caption){return firstElement(nextSiblings(caption)).map((function(body){var bodyTop=body.dom.offsetTop,captionTop=caption.dom.offsetTop,captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0}))})).getOr(0):0}(SugarElement.fromDom(elm))}return{x,y}},exports$1={},module$1={exports:exports$1};!function(define,exports,module,require){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).EphoxContactWrapper=factory()}(this,(function(){var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},promise={exports:{}};!function(module){!function(root){var setTimeoutFunc=setTimeout;function noop(){}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,Promise._immediateFn((function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)}))):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn((function(){self._handled||Promise._unhandledRejectionFn(self._value)}));for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn((function(value){done||(done=!0,resolve(self,value))}),(function(reason){done||(done=!0,reject(self,reason))}))}catch(ex){if(done)return;done=!0,reject(self,ex)}}Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise((function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])}))},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise((function(resolve){resolve(value)}))},Promise.reject=function(value){return new Promise((function(resolve,reject){reject(value)}))},Promise.race=function(values){return new Promise((function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)}))},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(commonjsGlobal)}(promise);var promisePolyfill=promise.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||promisePolyfill}}))}(void 0,exports$1,module$1);var Promise$1=module$1.exports.boltExport,nu$1=function(baseFn){var data=Optional.none(),callbacks=[],get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},isReady=function(){return data.isSome()},run=function(cbs){each$k(cbs,call)},call=function(cb){data.each((function(x){setTimeout((function(){cb(x)}),0)}))};return baseFn((function(x){isReady()||(data=Optional.some(x),run(callbacks),callbacks=[])})),{get,map:function(f){return nu$1((function(nCallback){get((function(data){nCallback(f(data))}))}))},isReady}},LazyValue={nu:nu$1,pure:function(a){return nu$1((function(callback){callback(a)}))}},errorReporter=function(err){setTimeout((function(){throw err}),0)},make=function(run){var get=function(callback){run().then(callback,errorReporter)};return{map:function(fab){return make((function(){return run().then(fab)}))},bind:function(aFutureB){return make((function(){return run().then((function(v){return aFutureB(v).toPromise()}))}))},anonBind:function(futureB){return make((function(){return run().then((function(){return futureB.toPromise()}))}))},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make((function(){return null===cache&&(cache=run()),cache}))},toPromise:run,get}},Future_nu=function(baseFn){return make((function(){return new Promise$1(baseFn)}))},par$1=function(asyncValues,nu){return nu((function(callback){var r=[],count=0;0===asyncValues.length?callback([]):each$k(asyncValues,(function(asyncValue,i){asyncValue.get(function(i){return function(value){r[i]=value,++count>=asyncValues.length&&callback(r)}}(i))}))}))},value$1=function(o){return{isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:function(_opt){return value$1(o)},orThunk:function(_f){return value$1(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$1(f(o))},mapError:function(_f){return value$1(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}},error=function(message){return{isValue:never,isError:always,getOr:identity,getOrThunk:function(f){return f()},getOrDie:function(){return(msg=String(message),function(){throw new Error(msg)})();var msg},or:identity,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error(message)},mapError:function(f){return error(f(message))},each:noop,bind:function(_f){return error(message)},exists:never,forall:always,toOptional:Optional.none}},Result={value:value$1,error,fromOption:function(opt,err){return opt.fold((function(){return error(err)}),value$1)}},Adt_generate=function(cases){if(!isArray$1(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$k(cases,(function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray$1(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);var match=function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(function(reqKey){return contains$3(branchKeys,reqKey)})))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)};return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);var target=foldArgs[count];return target.apply(null,args)},match,log:function(label){console.log(label,{constructors,constructor:key,params:args})}}}})),adt};Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var unite=function(result){return result.fold(identity,identity)};function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}var requestAnimationFramePromise,attrName,attrValue,support,Expr,getText,isXML,tokenize,compile,select$1,outermostContext,sortInput,hasDuplicate,setDocument,document$1,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,contains,ancestor$3=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest$3=function(scope,predicate,isRoot){return ClosestOrAncestor((function(s,test){return test(s)}),ancestor$3,scope,predicate,isRoot)},child=function(scope,predicate){return find$3(scope.dom.childNodes,(function(node){return predicate(SugarElement.fromDom(node))})).map(SugarElement.fromDom)},ancestor$2=function(scope,selector,isRoot){return ancestor$3(scope,(function(e){return is$2(e,selector)}),isRoot)},descendant=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)}(selector,scope)},closest$2=function(scope,selector,isRoot){return ClosestOrAncestor((function(element,selector){return is$2(element,selector)}),ancestor$2,scope,selector,isRoot)},promiseObj=window.Promise?window.Promise:Promise$1,wrappedSetTimeout=function(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)},wrappedSetInterval=function(callback,time){return"number"!=typeof time&&(time=1),setInterval(callback,time)},debounce=function(callback,time){var timer,func=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];clearTimeout(timer),timer=wrappedSetTimeout((function(){callback.apply(this,args)}),time)};return func.stop=function(){clearTimeout(timer)},func},Delay={requestAnimationFrame:function(callback,element){requestAnimationFramePromise?requestAnimationFramePromise.then(callback):requestAnimationFramePromise=new promiseObj((function(resolve){element||(element=document.body),function(callback,element){for(var requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"],i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];requestAnimationFrameFunc||(requestAnimationFrameFunc=function(cb){window.setTimeout(cb,0)}),requestAnimationFrameFunc(callback,element)}(resolve,element)})).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout((function(){editor.removed||callback()}),time)},setEditorInterval:function(editor,callback,time){var timer=wrappedSetInterval((function(){editor.removed?clearInterval(timer):callback()}),time);return timer},debounce,throttle:debounce,clearInterval:function(id){return clearInterval(id)},clearTimeout:function(id){return clearTimeout(id)}},StyleSheetLoader=function(documentOrShadowRoot,settings){void 0===settings&&(settings={});var idCount=0,loadedStates={},edos=SugarElement.fromDom(documentOrShadowRoot),doc=documentOrOwner(edos),maxLoadTime=settings.maxLoadTime||5e3,load=function(url,success,failure){var link,urlWithSuffix=Tools._addCacheSuffix(url),state=function(url){return get$9(loadedStates,url).getOrThunk((function(){return{id:"mce-u"+idCount++,passed:[],failed:[],count:0}}))}(urlWithSuffix);loadedStates[urlWithSuffix]=state,state.count++;var resolve=function(callbacks,status){for(var i=callbacks.length;i--;)callbacks[i]();state.status=status,state.passed=[],state.failed=[],link&&(link.onload=null,link.onerror=null,link=null)},passed=function(){return resolve(state.passed,2)},failed=function(){return resolve(state.failed,3)},waitForWebKitLinkLoaded=function(){var testCallback,waitCallback;testCallback=function(){for(var styleSheets=documentOrShadowRoot.styleSheets,i=styleSheets.length;i--;){var owner=styleSheets[i].ownerNode;if(owner&&owner.id===link.id)return passed(),!0}return!1},waitCallback=waitForWebKitLinkLoaded,testCallback()||(Date.now()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())};if(success&&state.passed.push(success),failure&&state.failed.push(failure),1!==state.status)if(2!==state.status)if(3!==state.status){state.status=1;var linkElem=SugarElement.fromTag("link",doc.dom);setAll$1(linkElem,{rel:"stylesheet",type:"text/css",id:state.id});var element,startTime=Date.now();settings.contentCssCors&&set$1(linkElem,"crossOrigin","anonymous"),settings.referrerPolicy&&set$1(linkElem,"referrerpolicy",settings.referrerPolicy),(link=linkElem.dom).onload=waitForWebKitLinkLoaded,link.onerror=failed,element=linkElem,append$1(getStyleContainer(edos),element),set$1(linkElem,"href",urlWithSuffix)}else failed();else passed()},loadF=function(url){return Future_nu((function(resolve){load(url,compose(resolve,constant(Result.value(url))),compose(resolve,constant(Result.error(url))))}))},unload=function(url){var urlWithSuffix=Tools._addCacheSuffix(url);get$9(loadedStates,urlWithSuffix).each((function(state){var id,styleContainer;0===--state.count&&(delete loadedStates[urlWithSuffix],id=state.id,styleContainer=getStyleContainer(edos),descendant(styleContainer,"#"+id).each(remove$7))}))};return{load,loadAll:function(urls,success,failure){var futures;(futures=map$3(urls,loadF),par$1(futures,Future_nu)).get((function(result){var parts=partition(result,(function(r){return r.isValue()}));parts.fail.length>0?failure(parts.fail.map(unite)):success(parts.pass.map(unite))}))},unload,unloadAll:function(urls){each$k(urls,(function(url){unload(url)}))},_setReferrerPolicy:function(referrerPolicy){settings.referrerPolicy=referrerPolicy}}},instance=function(){var map=new WeakMap;return{forElement:function(referenceElement,settings){var rootDom=getRootNode(referenceElement).dom;return Optional.from(map.get(rootDom)).getOrThunk((function(){var sl=StyleSheetLoader(rootDom,settings);return map.set(rootDom,sl),sl}))}}}(),DomTreeWalker=function(){function DomTreeWalker(startNode,rootNode){this.node=startNode,this.rootNode=rootNode,this.current=this.current.bind(this),this.next=this.next.bind(this),this.prev=this.prev.bind(this),this.prev2=this.prev2.bind(this)}return DomTreeWalker.prototype.current=function(){return this.node},DomTreeWalker.prototype.next=function(shallow){return this.node=this.findSibling(this.node,"firstChild","nextSibling",shallow),this.node},DomTreeWalker.prototype.prev=function(shallow){return this.node=this.findSibling(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.prev2=function(shallow){return this.node=this.findPreviousNode(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.findSibling=function(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!==this.rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}},DomTreeWalker.prototype.findPreviousNode=function(node,startName,siblingName,shallow){var sibling,parent,child;if(node){if(sibling=node[siblingName],this.rootNode&&sibling===this.rootNode)return;if(sibling){if(!shallow)for(child=sibling[startName];child;child=child[startName])if(!child[startName])return child;return sibling}if((parent=node.parentNode)&&parent!==this.rootNode)return parent}},DomTreeWalker}(),lazyLookup=function(items){var lookup;return function(node){return lookup=lookup||function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r}(items,always),has$2(lookup,name(node))}},isHeading=lazyLookup(["h1","h2","h3","h4","h5","h6"]),isBlock$2=lazyLookup(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]),isInline$1=function(node){return isElement$6(node)&&!isBlock$2(node)},isBr$4=function(node){return isElement$6(node)&&"br"===name(node)},isTextBlock$2=lazyLookup(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),isList=lazyLookup(["ul","ol","dl"]),isListItem=lazyLookup(["li","dd","dt"]),isTableSection=lazyLookup(["thead","tbody","tfoot"]),isTableCell$4=lazyLookup(["td","th"]),isWsPreserveElement=lazyLookup(["pre","script","textarea","style"]),isZwsp=function(char){return"\ufeff"===char},trim$2=function(s){return s.replace(/\uFEFF/g,"")},isElement$4=isElement$5,isText$6=isText$7,isCaretContainerBlock$1=function(node){return isText$6(node)&&(node=node.parentNode),isElement$4(node)&&node.hasAttribute("data-mce-caret")},isCaretContainerInline=function(node){return isText$6(node)&&isZwsp(node.data)},isCaretContainer$2=function(node){return isCaretContainerBlock$1(node)||isCaretContainerInline(node)},hasContent=function(node){return node.firstChild!==node.lastChild||!isBr$5(node.firstChild)},isBeforeInline=function(pos){var container=pos.container();return!!isText$7(container)&&("\ufeff"===container.data.charAt(pos.offset())||pos.isAtStart()&&isCaretContainerInline(container.previousSibling))},isAfterInline=function(pos){var container=pos.container();return!!isText$7(container)&&("\ufeff"===container.data.charAt(pos.offset()-1)||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling))},insertBlock$1=function(blockName,node,before){var br,blockNode=node.ownerDocument.createElement(blockName);blockNode.setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(((br=document.createElement("br")).setAttribute("data-mce-bogus","1"),br));var parentNode=node.parentNode;return before?parentNode.insertBefore(blockNode,node):node.nextSibling?parentNode.insertBefore(blockNode,node.nextSibling):parentNode.appendChild(blockNode),blockNode},startsWithCaretContainer$1=function(node){return isText$6(node)&&"\ufeff"===node.data[0]},endsWithCaretContainer$1=function(node){return isText$6(node)&&"\ufeff"===node.data[node.data.length-1]},showCaretContainerBlock=function(caretContainer){return caretContainer&&caretContainer.hasAttribute("data-mce-caret")?(brs=caretContainer.getElementsByTagName("br"),lastBr=brs[brs.length-1],isBogus$2(lastBr)&&lastBr.parentNode.removeChild(lastBr),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null;var brs,lastBr},isRangeInCaretContainerBlock=function(range){return isCaretContainerBlock$1(range.startContainer)},isContentEditableTrue$3=isContentEditableTrue$4,isContentEditableFalse$a=isContentEditableFalse$b,isBr$3=isBr$5,isText$5=isText$7,isInvalidTextElement=matchNodeNames(["script","style","textarea"]),isAtomicInline=matchNodeNames(["img","input","textarea","hr","iframe","video","audio","object","embed"]),isTable$1=matchNodeNames(["table"]),isCaretContainer$1=isCaretContainer$2,isCaretCandidate$3=function(node){return!isCaretContainer$1(node)&&(isText$5(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr$3(node)||isTable$1(node)||isNonUiContentEditableFalse(node))},isNonUiContentEditableFalse=function(node){return!1===function(node){return isElement$5(node)&&"true"===node.getAttribute("unselectable")}(node)&&isContentEditableFalse$a(node)},isEditableCaretCandidate$1=function(node,root){return isCaretCandidate$3(node)&&function(node,root){for(node=node.parentNode;node&&node!==root;node=node.parentNode){if(isNonUiContentEditableFalse(node))return!1;if(isContentEditableTrue$3(node))return!0}return!0}(node,root)},whiteSpaceRegExp$1=/^[ \t\r\n]*$/,isWhitespaceText=function(text){return whiteSpaceRegExp$1.test(text)},hasWhitespacePreserveParent=function(node,rootNode){var scope,selector,isRoot,rootElement=SugarElement.fromDom(rootNode),startNode=SugarElement.fromDom(node);return scope=startNode,selector="pre,code",isRoot=curry(eq,rootElement),ancestor$2(scope,selector,isRoot).isSome()},isContent$1=function(node,rootNode){return isCaretCandidate$3(node)&&!1===function(node,rootNode){return isText$7(node)&&isWhitespaceText(node.data)&&!1===hasWhitespacePreserveParent(node,rootNode)}(node,rootNode)||function(node){return isElement$5(node)&&"A"===node.nodeName&&!node.hasAttribute("href")&&(node.hasAttribute("name")||node.hasAttribute("id"))}(node)||isBookmark(node)},isBookmark=hasAttribute("data-mce-bookmark"),isBogus$1=hasAttribute("data-mce-bogus"),isBogusAll=(attrName="data-mce-bogus",attrValue="all",function(node){return isElement$5(node)&&node.getAttribute(attrName)===attrValue}),isEmpty$2=function(elm,skipBogus){return void 0===skipBogus&&(skipBogus=!0),function(targetNode,skipBogus){var brCount=0;if(isContent$1(targetNode,targetNode))return!1;var node=targetNode.firstChild;if(!node)return!0;var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(!0);continue}if(isBogus$1(node)){node=walker.next();continue}}if(isBr$5(node))brCount++,node=walker.next();else{if(isContent$1(node,targetNode))return!1;node=walker.next()}}while(node);return brCount<=1}(elm.dom,skipBogus)},isInlineContent=function(node,root){return isNonNullable(node)&&(isContent$1(node,root)||isInline$1(SugarElement.fromDom(node)))},isBookmarkNode$2=function(node){return function(node){return"span"===node.nodeName.toLowerCase()}(node)&&"bookmark"===node.getAttribute("data-mce-type")},isKeepTextNode=function(node,root){return isText$7(node)&&node.data.length>0&&function(node,root){var prev=new DomTreeWalker(node,root).prev(!1),next=new DomTreeWalker(node,root).next(!1),prevIsInline=isUndefined(prev)||isInlineContent(prev,root),nextIsInline=isUndefined(next)||isInlineContent(next,root);return prevIsInline&&nextIsInline}(node,root)},trimNode=function(dom,node,root){var rootNode=root||node;if(isElement$5(node)&&isBookmarkNode$2(node))return node;for(var children=node.childNodes,i=children.length-1;i>=0;i--)trimNode(dom,children[i],rootNode);if(isElement$5(node)){var currentChildren=node.childNodes;1===currentChildren.length&&isBookmarkNode$2(currentChildren[0])&&node.parentNode.insertBefore(currentChildren[0],node)}return function(node){return isDocumentFragment(node)||isDocument$1(node)}(node)||isContent$1(node,rootNode)||function(node){return!!isElement$5(node)&&node.childNodes.length>0}(node)||isKeepTextNode(node,rootNode)||dom.remove(node),node},makeMap$3=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""},baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},buildEntitiesLookup=function(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),encodeRaw=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return baseEntities[chr]||chr}))},encodeNumeric=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"}))},encodeNamed=function(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return baseEntities[chr]||entities[chr]||chr}))},Entities={encodeRaw,encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,(function(chr){return baseEntities[chr]||chr}))},encodeNumeric,encodeNamed,getEncodeFunc:function(name,entities){var entitiesMap=buildEntitiesLookup(entities)||namedEntities,nameMap=makeMap$3(name.replace(/\+/g,","));return nameMap.named&&nameMap.numeric?function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return void 0!==baseEntities[chr]?baseEntities[chr]:void 0!==entitiesMap[chr]?entitiesMap[chr]:chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";"}))}:nameMap.named?entities?function(text,attr){return encodeNamed(text,attr,entitiesMap)}:encodeNamed:nameMap.numeric?encodeNumeric:encodeRaw},decode:function(text){return text.replace(entityRegExp,(function(all,numeric){return numeric?(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))>65535?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||function(text){var elm=SugarElement.fromTag("div").dom;return elm.innerHTML=text,elm.textContent||elm.innerText||text}(all)}))}},mapCache={},dummyObj={},makeMap$2=Tools.makeMap,each$h=Tools.each,extend$5=Tools.extend,explode$3=Tools.explode,inArray$2=Tools.inArray,split$1=function(items,delim){return(items=Tools.trim(items))?items.split(delim||" "):[]},createMap=function(defaultValue,extendWith){var value=makeMap$2(defaultValue," ",makeMap$2(defaultValue.toUpperCase()," "));return extend$5(value,extendWith)},getTextRootBlockElements=function(schema){return createMap("td th li dt dd figcaption caption details summary",schema.getTextBlockElements())},compileElementMap=function(value,mode){var styles;return value&&(styles={},"string"==typeof value&&(value={"*":value}),each$h(value,(function(value,key){styles[key]=styles[key.toUpperCase()]="map"===mode?makeMap$2(value,/[, ]/):explode$3(value,/[, ]/)}))),styles},Schema=function(settings){var elements={},children={},patternElements=[],customElementsMap={},specialElements={},createLookupTable=function(option,defaultValue,extendWith){var value=settings[option];return value?value=makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/)):(value=mapCache[option])||(value=createMap(defaultValue,extendWith),mapCache[option]=value),value},schemaItems=function(type){var globalAttributes,blockContent,phrasingContent,flowContent,html4BlockContent,html4PhrasingContent,schema={},add=function(name,attributes,children){var ni,attributesOrder,element,arrayToMap=function(array,obj){var i,l,map={};for(i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map};attributes=attributes||"","string"==typeof(children=children||[])&&(children=split$1(children));var names=split$1(name);for(ni=names.length;ni--;)element={attributes:arrayToMap(attributesOrder=split$1([globalAttributes,attributes].join(" "))),attributesOrder,children:arrayToMap(children,dummyObj)},schema[names[ni]]=element},addAttrs=function(name,attributes){var ni,schemaItem,i,l,names=split$1(name);ni=names.length;for(var attrs=split$1(attributes);ni--;)for(schemaItem=schema[names[ni]],i=0,l=attrs.length;i<l;i++)schemaItem.attributes[attrs[i]]={},schemaItem.attributesOrder.push(attrs[i])};return mapCache[type]?mapCache[type]:(globalAttributes="id accesskey class dir lang style tabindex title role",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure main header footer hgroup section nav",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!==type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,html4PhrasingContent="acronym applet basefont big font strike tt"].join(" "),each$h(split$1(html4PhrasingContent),(function(name){add(name,"",phrasingContent)})),blockContent=[blockContent,html4BlockContent="center dir isindex noframes"].join(" "),flowContent=[blockContent,phrasingContent].join(" "),each$h(split$1(html4BlockContent),(function(name){add(name,"",flowContent)}))),flowContent=flowContent||[blockContent,phrasingContent].join(" "),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"===type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!==type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside main header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!==type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!==type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("img","loading"),addAttrs("iframe","sandbox seamless allowfullscreen loading")),each$h(split$1("a form meter progress dfn"),(function(name){schema[name]&&delete schema[name].children[name]})),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema,schema)}((settings=settings||{}).schema);!1===settings.verify_html&&(settings.valid_elements="*[*]");var validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script code pre",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","td th iframe video audio object script code table",shortEndedElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside main nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption details summary",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font s strike u var cite dfn code mark q sup sub samp");each$h((settings.special||"script noscript iframe noframes noembed title style textarea xmp").split(" "),(function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}));var patternToRegExp=function(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")},addValidElements=function(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)])?$/,attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){var validElementsArr=split$1(validElements,",");for(elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElementsArr.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElementsArr[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],element={attributes:attributes={},attributesOrder:attributesOrder=[]},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes&&(each$j(globalAttributes,(function(value,key){attributes[key]=value})),attributesOrder.push.apply(attributesOrder,globalAttributesOrder)),attrData)for(ai=0,al=(attrData=split$1(attrData,"|")).length;ai<al;ai++)if(matches=attrRuleRegExp.exec(attrData[ai])){if(attr={},attrType=matches[1],attrName=matches[2].replace(/[\\:]:/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType){delete attributes[attrName],attributesOrder.splice(inArray$2(attributesOrder,attrName),1);continue}prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap$2(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)}globalAttributes||"@"!==elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}},setValidElements=function(validElements){elements={},patternElements=[],addValidElements(validElements),each$h(schemaItems,(function(element,name){children[name]=element.children}))},addCustomElements=function(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each$h(split$1(customElements,","),(function(rule){var matches=customElementRegExp.exec(rule),inline="~"===matches[1],cloneName=inline?"span":"div",name=matches[2];if(children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){var customRule=elements[cloneName];delete(customRule=extend$5({},customRule)).removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each$h(children,(function(element,elmName){element[cloneName]&&(children[elmName]=element=extend$5({},children[elmName]),element[name]=element[cloneName])}))})))},addValidChildren=function(validChildren){var childRuleRegExp=/^([+\-]?)([A-Za-z0-9_\-.\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]+)\[([^\]]+)]$/;mapCache[settings.schema]=null,validChildren&&each$h(split$1(validChildren,","),(function(rule){var parent,prefix,matches=childRuleRegExp.exec(rule);matches&&(prefix=matches[1],parent=prefix?children[matches[2]]:children[matches[2]]={"#comment":{}},parent=children[matches[2]],each$h(split$1(matches[3],"|"),(function(child){"-"===prefix?delete parent[child]:parent[child]={}})))}))},getElementRule=function(name){var i,element=elements[name];if(element)return element;for(i=patternElements.length;i--;)if((element=patternElements[i]).pattern.test(name))return element};settings.valid_elements?setValidElements(settings.valid_elements):(each$h(schemaItems,(function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children})),"html5"!==settings.schema&&each$h(split$1("strong/b em/i"),(function(item){var items=split$1(item,"/");elements[items[1]].outputName=items[0]})),each$h(textInlineElementsMap,(function(_val,name){elements[name]&&(settings.padd_empty_block_inline_children&&(elements[name].paddInEmptyBlock=!0),elements[name].removeEmpty=!0)})),each$h(split$1("ol ul blockquote a table tbody"),(function(name){elements[name]&&(elements[name].removeEmpty=!0)})),each$h(split$1("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),(function(name){elements[name].paddEmpty=!0})),each$h(split$1("span"),(function(name){elements[name].removeEmptyAttrs=!0}))),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each$h({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},(function(parents,item){elements[item]&&(elements[item].parentsRequired=split$1(parents))})),settings.invalid_elements&&each$h(explode$3(settings.invalid_elements),(function(item){elements[item]&&delete elements[item]})),getElementRule("span")||addValidElements("span[!data-mce-type|*]");var getValidStyles=constant(validStyles),getInvalidStyles=constant(invalidStyles),getValidClasses=constant(validClasses),getBoolAttrs=constant(boolAttrMap),getBlockElements=constant(blockElementsMap),getTextBlockElements=constant(textBlockElementsMap),getTextInlineElements=constant(textInlineElementsMap),getShortEndedElements=constant(shortEndedElementsMap),getSelfClosingElements=constant(selfClosingElementsMap),getNonEmptyElements=constant(nonEmptyElementsMap),getMoveCaretBeforeOnEnterElements=constant(moveCaretBeforeOnEnterElementsMap),getWhiteSpaceElements=constant(whiteSpaceElementsMap),getSpecialElements=constant(specialElements),getCustomElements=constant(customElementsMap);return{children,elements,getValidStyles,getValidClasses,getBlockElements,getInvalidStyles,getShortEndedElements,getTextBlockElements,getTextInlineElements,getBoolAttrs,getElementRule,getSelfClosingElements,getNonEmptyElements,getMoveCaretBeforeOnEnterElements,getWhiteSpaceElements,getSpecialElements,isValidChild:function(name,child){var parent=children[name.toLowerCase()];return!(!parent||!parent[child.toLowerCase()])},isValid:function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},getCustomElements,addValidElements,setValidElements,addCustomElements,addValidChildren}},toHex=function(match,r,g,b){var hex=function(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val};return"#"+hex(r)+hex(g)+hex(b)},Styles=function(settings,schema){var i,validStyles,invalidStyles,_this=this,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={};settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles());var encodingItems="\\\" \\' \\; \\: ; : \ufeff".split(" ");for(i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]="\ufeff"+i,encodingLookup["\ufeff"+i]=encodingItems[i];return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){var matches,name,value,isEncoded,target,a,b,c,styles={},urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||_this,compress=function(prefix,suffix,noJoin){var top=styles[prefix+"-top"+suffix];if(top){var right=styles[prefix+"-right"+suffix];if(right){var bottom=styles[prefix+"-bottom"+suffix];if(bottom){var left=styles[prefix+"-left"+suffix];if(left){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);i>-1&&noJoin||(styles[prefix+suffix]=-1===i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}}}},canCompress=function(key){var i,value=styles[key];if(value){for(i=(value=value.split(" ")).length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}},encode=function(str){return isEncoded=!0,encodingLookup[str]},decode=function(str,keepSlashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,(function(str){return encodingLookup[str]}))),keepSlashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str},decodeSingleHexSequence=function(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16))},decodeHexSequences=function(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence)},processUrl=function(match,url,url2,url3,str,str2){if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"};if(css){for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,(function(str){return str.replace(/[;:]/g,encode)}));matches=styleRegExp.exec(css);)if(styleRegExp.lastIndex=matches.index+matches[0].length,name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,""),name&&value){if(name=decodeHexSequences(name),value=decodeHexSequences(value),-1!==name.indexOf("\ufeff")||-1!==name.indexOf('"'))continue;if(!settings.allow_script_urls&&("behavior"===name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),value=(value=value.replace(rgbRegExp,toHex)).replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(value,!0):value}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),target="border",b="border-style",c="border-color",canCompress(a="border-width")&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c]),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){var css="",serializeStyles=function(name){var value,styleList=validStyles[name];if(styleList)for(var i_1=0,l=styleList.length;i_1<l;i_1++)name=styleList[i_1],(value=styles[name])&&(css+=(css.length>0?" ":"")+name+": "+value+";")};return elementName&&validStyles?(serializeStyles("*"),serializeStyles(elementName)):each$j(styles,(function(value,name){!value||invalidStyles&&!function(name,elementName){var styleMap=invalidStyles["*"];return!(styleMap&&styleMap[name]||(styleMap=invalidStyles[elementName])&&styleMap[name])}(name,elementName)||(css+=(css.length>0?" ":"")+name+": "+value+";")})),css}}},deprecated={keyLocation:!0,layerX:!0,layerY:!0,returnValue:!0,webkitMovementX:!0,webkitMovementY:!0,keyIdentifier:!0,mozPressure:!0},isNativeEvent=function(event){return event instanceof Event||isFunction(event.initEvent)},normalize$3=function(type,originalEvent,fallbackTarget,data){var _a,event=function(originalEvent,data){var event=null!=data?data:{};for(var name_1 in originalEvent)has$2(deprecated,name_1)||(event[name_1]=originalEvent[name_1]);return isNonNullable(event.composedPath)&&(event.composedPath=function(){return originalEvent.composedPath()}),event}(originalEvent,data);return event.type=type,isNullable(event.target)&&(event.target=null!==(_a=event.srcElement)&&void 0!==_a?_a:fallbackTarget),function(event){return isNullable(event.preventDefault)||isNativeEvent(event)}(originalEvent)&&(event.preventDefault=function(){event.defaultPrevented=!0,event.isDefaultPrevented=always,isFunction(originalEvent.preventDefault)?originalEvent.preventDefault():isNativeEvent(originalEvent)&&(originalEvent.returnValue=!1)},event.stopPropagation=function(){event.cancelBubble=!0,event.isPropagationStopped=always,isFunction(originalEvent.stopPropagation)?originalEvent.stopPropagation():isNativeEvent(originalEvent)&&(originalEvent.cancelBubble=!0)},event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=always,event.stopPropagation()},function(event){return event.isDefaultPrevented===always||event.isDefaultPrevented===never}(event)||(event.isDefaultPrevented=!0===event.defaultPrevented?always:never,event.isPropagationStopped=!0===event.cancelBubble?always:never,event.isImmediatePropagationStopped=never)),event},mouseEventRe=/^(?:mouse|contextmenu)|click/,addEvent=function(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)},removeEvent=function(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)},fix=function(originalEvent,data){var event=normalize$3(originalEvent.type,originalEvent,document,data);if(function(event){return isNonNullable(event)&&mouseEventRe.test(event.type)}(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)){var eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,mouseEvent=event;mouseEvent.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return isUndefined(event.metaKey)&&(event.metaKey=!1),event},bindOnReady=function(win,callback,eventUtils){var doc=win.document,event={type:"ready"};if(eventUtils.domLoaded)callback(event);else{var readyHandler=function(){removeEvent(win,"DOMContentLoaded",readyHandler),removeEvent(win,"load",readyHandler),eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event)),win=null};"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),eventUtils.domLoaded||addEvent(win,"load",readyHandler)}},EventUtils=function(){function EventUtils(){this.domLoaded=!1,this.events={},this.count=1,this.expando="mce-data-"+(+new Date).toString(32),this.hasMouseEnterLeave="onmouseenter"in document.documentElement,this.hasFocusIn="onfocusin"in document.documentElement,this.count=1}return EventUtils.prototype.bind=function(target,names,callback,scope){var id,callbackList,i,name,fakeName,nativeHandler,capture,self=this,win=window,defaultNativeHandler=function(evt){self.executeHandlers(fix(evt||win.event),id)};if(target&&3!==target.nodeType&&8!==target.nodeType){target[self.expando]?id=target[self.expando]:(id=self.count++,target[self.expando]=id,self.events[id]={}),scope=scope||target;var namesList=names.split(" ");for(i=namesList.length;i--;)nativeHandler=defaultNativeHandler,fakeName=capture=!1,"DOMContentLoaded"===(name=namesList[i])&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"===target.readyState?callback.call(scope,fix({type:name})):(self.hasMouseEnterLeave||(fakeName=self.mouseEnterLeave[name])&&(nativeHandler=function(evt){var current=evt.currentTarget,related=evt.relatedTarget;if(related&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||((evt=fix(evt||win.event)).type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,self.executeHandlers(evt,id))}),self.hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){(evt=fix(evt||win.event)).type="focus"===evt.type?"focusin":"focusout",self.executeHandlers(evt,id)}),(callbackList=self.events[id][name])?"ready"===name&&self.domLoaded?callback(fix({type:name})):callbackList.push({func:callback,scope}):(self.events[id][name]=callbackList=[{func:callback,scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=null,callback}},EventUtils.prototype.unbind=function(target,names,callback){var callbackList,i,ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return this;var id=target[this.expando];if(id){if(eventMap=this.events[id],names){var namesList=names.split(" ");for(i=namesList.length;i--;)if(callbackList=eventMap[name=namesList[i]]){if(callback)for(ci=callbackList.length;ci--;)if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture;(callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1))).nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else each$j(eventMap,(function(callbackList,name){removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)})),eventMap={};for(name in eventMap)if(has$2(eventMap,name))return this;delete this.events[id];try{delete target[this.expando]}catch(ex){target[this.expando]=null}}return this},EventUtils.prototype.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return this;var event=fix({type:name,target},args);do{(id=target[this.expando])&&this.executeHandlers(event,id),target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow}while(target&&!event.isPropagationStopped());return this},EventUtils.prototype.clean=function(target){var i,children;if(!target||3===target.nodeType||8===target.nodeType)return this;if(target[this.expando]&&this.unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName)for(this.unbind(target),i=(children=target.getElementsByTagName("*")).length;i--;)(target=children[i])[this.expando]&&this.unbind(target);return this},EventUtils.prototype.destroy=function(){this.events={}},EventUtils.prototype.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1},EventUtils.prototype.executeHandlers=function(evt,id){var container=this.events[id],callbackList=container&&container[evt.type];if(callbackList)for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}},EventUtils.Event=new EventUtils,EventUtils}(),expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push$1=arr.push,slice$1=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\[[\\x20\\t\\r\\n\\f]*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),rcomma=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),rcombinators=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),rattributeQuotes=new RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*?)[\\x20\\t\\r\\n\\f]*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr$1=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push$1.apply(arr=slice$1.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push$1={apply:arr.length?function(target,els){push_native.apply(target,slice$1.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}var Sizzle=function(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document$1&&setDocument(context),results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=(context=context||document$1).nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr$1.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push$1.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push$1.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push$1.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select$1(selector.replace(rtrim,"$1"),context,results,seed)};function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||-2147483648)-(~a.sourceIndex||-2147483648);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createPositionalPseudo(fn){return markFunction((function(argument){return argument=+argument,markFunction((function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))}))}))}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if((oldCache=(outerCache=elem[expando]||(elem[expando]={}))[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction((function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push$1.apply(results,matcherOut)}))}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator((function(elem){return elem===checkContext}),implicitRelative,!0),matchAnyContext=addCombinator((function(elem){return indexOf.call(checkContext,elem)>-1}),implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document$1&&9===doc.nodeType&&doc.documentElement?(document$1=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==function getTop(win){try{return win.top}catch(ex){}return null}(parent)&&(parent.addEventListener?parent.addEventListener("unload",(function(){setDocument()}),!1):parent.attachEvent&&parent.attachEvent("onunload",(function(){setDocument()}))),support.attributes=!0,support.getElementsByTagName=!0,support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=!0,Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(void 0!==context.getElementsByTagName)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],support.disconnectedMatch=!0,rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document$1},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document$1&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=undefined.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document$1,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document$1&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document$1&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+className+"("+whitespace+"|$)"))&&classCache(className,(function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")}))},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction((function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf.call(seed,matched[i])]=!(matches[idx]=matched[i])})):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction((function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction((function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))})):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}})),has:markFunction((function(selector){return function(elem){return Sizzle(selector,elem).length>0}})),contains:markFunction((function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}})),lang:markFunction((function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}})),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document$1.activeElement&&(!document$1.hasFocus||document$1.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo((function(){return[0]})),last:createPositionalPseudo((function(matchIndexes,length){return[length-1]})),eq:createPositionalPseudo((function(matchIndexes,length,argument){return[argument<0?argument+length:argument]})),even:createPositionalPseudo((function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),odd:createPositionalPseudo((function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),lt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes})),gt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes}))}},Expr.pseudos.nth=Expr.pseudos.eq,each$k(["radio","checkbox","file","password","image"],(function(i){Expr.pseudos[i]=function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}(i)})),each$k(["submit","reset"],(function(i){Expr.pseudos[i]=function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}(i)})),setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)Expr.filter.hasOwnProperty(type)&&(!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type,matches:match}),soFar=soFar.slice(matched.length)));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document$1&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push$1.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers)),cached.selector=selector}return cached},select$1=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push$1.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=!0;var doc=document,push=Array.prototype.push,slice=Array.prototype.slice,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event$1=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev"),isDefined=function(obj){return void 0!==obj},isString=function(obj){return"string"==typeof obj},createFragment$1=function(html,fragDoc){var node,container=(fragDoc=fragDoc||doc).createElement("div"),frag=fragDoc.createDocumentFragment();for(container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag},domManipulate=function(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem))sourceItem=createFragment$1(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;i>=0;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes},hasClass=function(node,className){return node&&className&&-1!==(" "+node.className+" ").indexOf(" "+className+" ")},wrap$2=function(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each((function(){all&&lastParent===this.parentNode||(lastParent=this.parentNode,newWrapper=wrapper.cloneNode(!1),this.parentNode.insertBefore(newWrapper,this)),newWrapper.appendChild(this)})),elements},numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={for:"htmlFor",class:"className",readonly:"readOnly"},cssFix={float:"cssFloat"},attrHooks={},cssHooks={},DomQueryConstructor=function(selector,context){return new DomQuery.fn.init(selector,context)},whiteSpaceRegExp=/^\s*|\s*$/g,trim$1=function(str){return null==str?"":(""+str).replace(whiteSpaceRegExp,"")},each$g=function(obj,callback){var length,key,i,value;if(obj)if(void 0===(length=obj.length)){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],!1===callback.call(value,key,value)))break}else for(i=0;i<length&&(value=obj[i],!1!==callback.call(value,i,value));i++);return obj},grep$2=function(array,callback){var out=[];return each$g(array,(function(i,item){callback(item,i)&&out.push(item)})),out},getElementDocument=function(element){return element?9===element.nodeType?element:element.ownerDocument:doc};DomQueryConstructor.fn=DomQueryConstructor.prototype={constructor:DomQueryConstructor,selector:"",context:null,length:0,init:function(selector,context){var match,node;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(context&&context.nodeType)this.context=context;else{if(context)return DomQuery(selector).attr(context);this.context=context=document}if(isString(selector)){if(this.selector=selector,!(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector)))return DomQuery(context).find(selector);if(match[1])for(node=createFragment$1(selector,getElementDocument(context)).firstChild;node;)push.call(this,node),node=node.nextSibling;else{if(!(node=getElementDocument(context).getElementById(match[2])))return this;if(node.id!==match[2])return this.find(selector);this.length=1,this[0]=node}}else this.add(selector,!1);return this},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var nodes,i;if(isString(items))return this.add(DomQuery(items));if(!1!==sort)for(nodes=DomQuery.unique(this.toArray().concat(DomQuery.makeArray(items))),this.length=nodes.length,i=0;i<nodes.length;i++)this[i]=nodes[i];else push.apply(this,DomQuery.makeArray(items));return this},attr:function(name,value){var hook,self=this;if("object"==typeof name)each$g(name,(function(name,value){self.attr(name,value)}));else{if(!isDefined(value)){if(self[0]&&1===self[0].nodeType){if((hook=attrHooks[name])&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:void 0;null===(value=self[0].getAttribute(name,2))&&(value=void 0)}return value}this.each((function(){var hook;if(1===this.nodeType){if((hook=attrHooks[name])&&hook.set)return void hook.set(this,value);null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2)}}))}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if("object"==typeof(name=propFix[name]||name))each$g(name,(function(name,value){self.prop(name,value)}));else{if(!isDefined(value))return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each((function(){1===this.nodeType&&(this[name]=value)}))}return self},css:function(name,value){var elm,hook,self=this,camel=function(name){return name.replace(/-(\D)/g,(function(a,b){return b.toUpperCase()}))},dashed=function(name){return name.replace(/[A-Z]/g,(function(a){return"-"+a}))};if("object"==typeof name)each$g(name,(function(name,value){self.css(name,value)}));else if(isDefined(value))name=camel(name),"number"!=typeof value||numericCssMap[name]||(value=value.toString()+"px"),self.each((function(){var style=this.style;if((hook=cssHooks[name])&&hook.set)hook.set(this,value);else{try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))}}));else{if(elm=self[0],(hook=cssHooks[name])&&hook.get)return hook.get(elm);if(!elm.ownerDocument.defaultView)return elm.currentStyle?elm.currentStyle[camel(name)]:"";try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return}}return self},remove:function(){for(var node,i=this.length;i--;)node=this[i],Event$1.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var node,i=this.length;i--;)for(node=this[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var i;if(isDefined(value)){i=this.length;try{for(;i--;)this[i].innerHTML=value}catch(ex){DomQuery(this[i]).empty().append(value)}return this}return this[0]?this[0].innerHTML:""},text:function(value){var i;if(isDefined(value)){for(i=this.length;i--;)"innerText"in this[i]?this[i].innerText=value:this[0].textContent=value;return this}return this[0]?this[0].innerText||this[0].textContent:""},append:function(){return domManipulate(this,arguments,(function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)}))},prepend:function(){return domManipulate(this,arguments,(function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)}),!0)},before:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,(function(node){this.parentNode.insertBefore(node,this)})):self},after:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,(function(node){this.parentNode.insertBefore(node,this.nextSibling)}),!0):self},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap$2(this,content)},wrapAll:function(content){return wrap$2(this,content,!0)},wrapInner:function(content){return this.each((function(){DomQuery(this).contents().wrapAll(content)})),this},unwrap:function(){return this.parent().each((function(){DomQuery(this).replaceWith(this.childNodes)}))},clone:function(){var result=[];return this.each((function(){result.push(this.cloneNode(!0))})),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className||(-1!==className.indexOf(" ")?each$g(className.split(" "),(function(){self.toggleClass(this,state)})):self.each((function(index,node){var classState=hasClass(node,className);if(classState!==state){var existingClassName=node.className;classState?node.className=trim$1((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className}}))),self},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each$g(this,callback)},on:function(name,callback){return this.each((function(){Event$1.bind(this,name,callback)}))},off:function(name,callback){return this.each((function(){Event$1.unbind(this,name,callback)}))},trigger:function(name){return this.each((function(){"object"==typeof name?Event$1.fire(this,name.type,name):Event$1.fire(this,name)}))},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return DomQuery(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep$2(this.toArray(),(function(item,i){return selector(i,item)})):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each((function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node===selector){result.push(node);break}node=node.parentNode}})),DomQuery(result)},offset:function(offset){var elm,doc,docElm,pos,x=0,y=0;return offset?this.css(offset):((elm=this[0])&&(docElm=(doc=elm.ownerDocument).documentElement,elm.getBoundingClientRect&&(x=(pos=elm.getBoundingClientRect()).left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push,sort:Array.prototype.sort,splice:Array.prototype.splice},Tools.extend(DomQueryConstructor,{extend:Tools.extend,makeArray:function(object){return(obj=object)&&obj===obj.window||object.nodeType?[object]:Tools.toArray(object);var obj},inArray:function(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1},isArray:Tools.isArray,each:each$g,trim:trim$1,grep:grep$2,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!==elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}});var dir=function(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(void 0!==until){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched},sibling$1=function(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(void 0!==until){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result},firstSibling=function(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType===nodeType)return node;return null};each$g({parent:function(node){var parent=node.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling$1(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},(function(name,fn){DomQueryConstructor.fn[name]=function(selector){var result=[];this.each((function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))})),this.length>1&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse()));var wrappedResult=DomQuery(result);return selector?wrappedResult.filter(selector):wrappedResult}})),each$g({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling$1(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling$1(node,"previousSibling",1,until).slice(1)}},(function(name,fn){DomQueryConstructor.fn[name]=function(selector,filter){var result=[];this.each((function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))})),this.length>1&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse()));var wrappedResult=DomQuery(result);return filter?wrappedResult.filter(filter):wrappedResult}})),DomQueryConstructor.fn.is=function(selector){return!!selector&&this.filter(selector).length>0},DomQueryConstructor.fn.init.prototype=DomQueryConstructor.fn,DomQueryConstructor.overrideDefaults=function(callback){var defaults,sub=function(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context||(context=defaults.context),new sub.fn.init(selector,context)};return DomQuery.extend(sub,this),sub},DomQueryConstructor.attrHooks=attrHooks,DomQueryConstructor.cssHooks=cssHooks;var DomQuery=DomQueryConstructor,each$f=Tools.each,grep$1=Tools.grep,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,updateInternalStyleAttr=function(styles,$elm){var rawValue=$elm.attr("style"),value=styles.serialize(styles.parse(rawValue),$elm[0].nodeName);value||(value=null),$elm.attr("data-mce-style",value)},findNodeIndex=function(node,normalized){var lastNodeType,nodeType,idx=0;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!==nodeType||nodeType!==lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx},DOMUtils=function(doc,settings){void 0===settings&&(settings={});var addedStyles={},win=window,files={},counter=0,styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy}),boundEvents=[],schema=settings.schema?settings.schema:Schema({}),styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),events=settings.ownEvents?new EventUtils:EventUtils.Event,blockElementsMap=schema.getBlockElements(),$=DomQuery.overrideDefaults((function(){return{context:doc,element:self.getRoot()}})),get=function(elm){return elm&&doc&&isString$1(elm)?doc.getElementById(elm):elm},$$=function(elm){return $("string"==typeof elm?get(elm):elm)},getAttrib=function(elm,name,defaultVal){var hook,value,$elm=$$(elm);return $elm.length&&(value=(hook=attrHooks[name])&&hook.get?hook.get($elm,name):$elm.attr(name)),void 0===value&&(value=defaultVal||""),value},getAttribs=function(elm){var node=get(elm);return node?node.attributes:[]},setAttrib=function(elm,name,value){""===value&&(value=null);var $elm=$$(elm),originalValue=$elm.attr(name);if($elm.length){var hook=attrHooks[name];hook&&hook.set?hook.set($elm,value,name):$elm.attr(name,value),originalValue!==value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:$elm,attrName:name,attrValue:value})}},getRoot=function(){return settings.root_element||doc.body},getPos$1=function(elm,rootElm){return getPos(doc.body,get(elm),rootElm)},getStyle=function(elm,name,computed){var $elm=$$(elm);return computed?$elm.css(name):("float"===(name=name.replace(/-(\D)/g,(function(a,b){return b.toUpperCase()})))&&(name=Env.browser.isIE()?"styleFloat":"cssFloat"),$elm[0]&&$elm[0].style?$elm[0].style[name]:void 0)},getSize=function(elm){var w,h;return elm=get(elm),w=getStyle(elm,"width"),h=getStyle(elm,"height"),-1===w.indexOf("px")&&(w=0),-1===h.indexOf("px")&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},is=function(elm,selector){var i;if(!elm)return!1;if(!Array.isArray(elm)){if("*"===selector)return 1===elm.nodeType;if(simpleSelectorRe.test(selector)){var selectors=selector.toLowerCase().split(/,/),elmName=elm.nodeName.toLowerCase();for(i=selectors.length-1;i>=0;i--)if(selectors[i]===elmName)return!0;return!1}if(elm.nodeType&&1!==elm.nodeType)return!1}var elms=Array.isArray(elm)?elm:[elm];return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0},getParents=function(elm,selector,root,collect){var selectorVal,result=[],node=get(elm);for(collect=void 0===collect,root=root||("BODY"!==getRoot().nodeName?getRoot().parentNode:null),Tools.is(selector,"string")&&(selectorVal=selector,selector="*"===selector?function(node){return 1===node.nodeType}:function(node){return is(node,selectorVal)});node&&!(node===root||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node));){if(!selector||"function"==typeof selector&&selector(node)){if(!collect)return[node];result.push(node)}node=node.parentNode}return collect?result:null},_findSib=function(node,selector,name){var func=selector;if(node)for("string"==typeof selector&&(func=function(node){return is(node,selector)}),node=node[name];node;node=node[name])if("function"==typeof func&&func(node))return node;return null},run=function(elm,func,scope){var result,node="string"==typeof elm?get(elm):elm;if(!node)return!1;if(Tools.isArray(node)&&(node.length||0===node.length))return result=[],each$f(node,(function(elm,i){elm&&result.push(func.call(scope,"string"==typeof elm?get(elm):elm,i))})),result;var context=scope||this;return func.call(context,node)},setAttribs=function(elm,attrs){$$(elm).each((function(i,node){each$f(attrs,(function(value,name){setAttrib(node,name,value)}))}))},setHTML=function(elm,html){var $elm=$$(elm);isIE?$elm.each((function(i,target){if(!1!==target.canHaveHTML){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){DomQuery("<div></div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}})):$elm.html(html)},add=function(parentElm,name,attrs,html,create){return run(parentElm,(function(parentElm){var newElm="string"==typeof name?doc.createElement(name):name;return setAttribs(newElm,attrs),html&&("string"!=typeof html&&html.nodeType?newElm.appendChild(html):"string"==typeof html&&setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)}))},create=function(name,attrs,html){return add(doc.createElement(name),name,attrs,html,!0)},encode=Entities.encodeAllRaw,remove=function(node,keepChildren){var $node=$$(node);return keepChildren?$node.each((function(){for(var child;child=this.firstChild;)3===child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)})).remove():$node.remove(),$node.length>1?$node.toArray():$node[0]},toggleClass=function(elm,cls,state){$$(elm).toggleClass(cls,state).each((function(){""===this.className&&DomQuery(this).attr("class",null)}))},replace=function(newElm,oldElm,keepChildren){return run(oldElm,(function(oldElm){return Tools.is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each$f(grep$1(oldElm.childNodes),(function(node){newElm.appendChild(node)})),oldElm.parentNode.replaceChild(newElm,oldElm)}))},isNonEmptyElement=function(node){if(isElement$5(node)){var isNamedAnchor="a"===node.nodeName.toLowerCase()&&!getAttrib(node,"href")&&getAttrib(node,"id");if(getAttrib(node,"name")||getAttrib(node,"data-mce-bookmark")||isNamedAnchor)return!0}return!1},createRng=function(){return doc.createRange()},bind=function(target,name,func,scope){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=bind(target[i],name,func,scope);return rv}return!settings.collect||target!==doc&&target!==win||boundEvents.push([target,name,func,scope]),events.bind(target,name,func,scope||self)},unbind=function(target,name,func){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=unbind(target[i],name,func);return rv}if(boundEvents.length>0&&(target===doc||target===win))for(i=boundEvents.length;i--;){var item=boundEvents[i];target!==item[0]||name&&name!==item[1]||func&&func!==item[2]||events.unbind(item[0],item[1],item[2])}return events.unbind(target,name,func)},getContentEditable=function(node){if(node&&isElement$5(node)){var contentEditable=node.getAttribute("data-mce-contenteditable");return contentEditable&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null}return null},self={doc,settings,win,files,stdMode:!0,boxModel:!0,styleSheetLoader,boundEvents,styles,schema,events,isBlock:function(node){if("string"==typeof node)return!!blockElementsMap[node];if(node){var type=node.nodeType;if(type)return!(1!==type||!blockElementsMap[node.nodeName])}return!1},$,$$,root:null,clone:function(node,deep){if(!isIE||1!==node.nodeType||deep)return node.cloneNode(deep);var clone_1=doc.createElement(node.nodeName);return each$f(getAttribs(node),(function(attr){setAttrib(clone_1,attr.nodeName,getAttrib(node,attr.nodeName))})),clone_1},getRoot,getViewPort:function(argWin){var vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height}},getRect:function(elm){elm=get(elm);var pos=getPos$1(elm),size=getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize,getParent:function(node,selector,root){var parents=getParents(node,selector,root,!1);return parents&&parents.length>0?parents[0]:null},getParents,get,getNext:function(node,selector){return _findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return _findSib(node,selector,"previousSibling")},select:function(selector,scope){return Sizzle(selector,get(scope)||settings.root_element||doc,[])},is,add,create,createHTML:function(name,attrs,html){var key,outHtml="";for(key in outHtml+="<"+name,attrs)hasNonNullableKey(attrs,key)&&(outHtml+=" "+key+'="'+encode(attrs[key])+'"');return void 0!==html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:function(html){var node,container=doc.createElement("div"),frag=doc.createDocumentFragment();for(frag.appendChild(container),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag.removeChild(container),frag},remove,setStyle:function(elm,name,value){var $elm=isString$1(name)?$$(elm).css(name,value):$$(elm).css(name);settings.update_styles&&updateInternalStyleAttr(styles,$elm)},getStyle,setStyles:function(elm,stylesArg){var $elm=$$(elm).css(stylesArg);settings.update_styles&&updateInternalStyleAttr(styles,$elm)},removeAllAttribs:function(e){return run(e,(function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--)e.removeAttributeNode(attrs.item(i))}))},setAttrib,setAttribs,getAttrib,getPos:getPos$1,parseStyle:function(cssText){return styles.parse(cssText)},serializeStyle:function(stylesArg,name){return styles.serialize(stylesArg,name)},addStyle:function(cssText){var head,styleElm;if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText])return;addedStyles[cssText]=!0}(styleElm=doc.getElementById("mceDefaultStyles"))||((styleElm=doc.createElement("style")).id="mceDefaultStyles",styleElm.type="text/css",(head=doc.getElementsByTagName("head")[0]).firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:function(urls){urls||(urls=""),each$k(urls.split(","),(function(url){files[url]=!0,styleSheetLoader.load(url,noop)}))},addClass:function(elm,cls){$$(elm).addClass(cls)},removeClass:function(elm,cls){toggleClass(elm,cls,!1)},hasClass:function(elm,cls){return $$(elm).hasClass(cls)},toggleClass,show:function(elm){$$(elm).show()},hide:function(elm){$$(elm).hide()},isHidden:function(elm){return"none"===$$(elm).css("display")},uniqueId:function(prefix){return(prefix||"mce_")+counter++},setHTML,getOuterHTML:function(elm){var node="string"==typeof elm?get(elm):elm;return isElement$5(node)?node.outerHTML:DomQuery("<div></div>").append(DomQuery(node).clone()).html()},setOuterHTML:function(elm,html){$$(elm).each((function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}remove(DomQuery(this).html(html),!0)}))},decode:Entities.decode,encode,insertAfter:function(node,reference){var referenceNode=get(reference);return run(node,(function(node){var parent=referenceNode.parentNode,nextSibling=referenceNode.nextSibling;return nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node),node}))},replace,rename:function(elm,name){var newElm;return elm.nodeName!==name.toUpperCase()&&(newElm=create(name),each$f(getAttribs(elm),(function(attrNode){setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName))})),replace(newElm,elm,!0)),newElm||elm},findCommonAncestor:function(a,b){for(var pe,ps=a;ps;){for(pe=b;pe&&ps!==pe;)pe=pe.parentNode;if(ps===pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:function(rgbVal){return styles.toHex(Tools.trim(rgbVal))},run,getAttribs,isEmpty:function(node,elements){var type,name,brCount=0;if(isNonEmptyElement(node))return!1;if(node=node.firstChild){var walker=new DomTreeWalker(node,node.parentNode),whitespace=schema?schema.getWhiteSpaceElements():{};elements=elements||(schema?schema.getNonEmptyElements():null);do{if(type=node.nodeType,isElement$5(node)){var bogusVal=node.getAttribute("data-mce-bogus");if(bogusVal){node=walker.next("all"===bogusVal);continue}if(name=node.nodeName.toLowerCase(),elements&&elements[name]){if("br"===name){brCount++,node=walker.next();continue}return!1}if(isNonEmptyElement(node))return!1}if(8===type)return!1;if(3===type&&!isWhitespaceText(node.nodeValue))return!1;if(3===type&&node.parentNode&&whitespace[node.parentNode.nodeName]&&isWhitespaceText(node.nodeValue))return!1;node=walker.next()}while(node)}return brCount<=1},createRng,nodeIndex:findNodeIndex,split:function(parentElm,splitElm,replacementElm){var beforeFragment,afterFragment,parentNode,range=createRng();if(parentElm&&splitElm)return range.setStart(parentElm.parentNode,findNodeIndex(parentElm)),range.setEnd(splitElm.parentNode,findNodeIndex(splitElm)),beforeFragment=range.extractContents(),(range=createRng()).setStart(splitElm.parentNode,findNodeIndex(splitElm)+1),range.setEnd(parentElm.parentNode,findNodeIndex(parentElm)+1),afterFragment=range.extractContents(),(parentNode=parentElm.parentNode).insertBefore(trimNode(self,beforeFragment),parentElm),replacementElm?parentNode.insertBefore(replacementElm,parentElm):parentNode.insertBefore(splitElm,parentElm),parentNode.insertBefore(trimNode(self,afterFragment),parentElm),remove(parentElm),replacementElm||splitElm},bind,unbind,fire:function(target,name,evt){return events.fire(target,name,evt)},getContentEditable,getContentEditableParent:function(node){for(var root=getRoot(),state=null;node&&node!==root&&null===(state=getContentEditable(node));node=node.parentNode);return state},destroy:function(){if(boundEvents.length>0)for(var i=boundEvents.length;i--;){var item=boundEvents[i];events.unbind(item[0],item[1],item[2])}each$j(files,(function(_,url){styleSheetLoader.unload(url),delete files[url]})),Sizzle.setDocument&&Sizzle.setDocument()},isChildOf:function(node,parent){if(isIE){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1}return node===parent||parent.contains(node)},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset}},attrHooks=function(styles,settings,getContext){var keepValues=settings.keep_values,keepUrlHook={set:function($elm,value,name){settings.url_converter&&null!==value&&(value=settings.url_converter.call(settings.url_converter_scope||getContext(),value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}},attrHooks={style:{set:function($elm,value){null===value||"object"!=typeof value?(keepValues&&$elm.attr("data-mce-style",value),null!==value&&"string"==typeof value?($elm.removeAttr("style"),$elm.css(styles.parse(value))):$elm.attr("style",value)):$elm.css(value)},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return styles.serialize(styles.parse(value),$elm[0].nodeName)}}};return keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks}(styles,settings,constant(self));return self};DOMUtils.DOM=DOMUtils(document),DOMUtils.nodeIndex=findNodeIndex;var DOM$a=DOMUtils.DOM,each$e=Tools.each,grep=Tools.grep,ScriptLoader=function(){function ScriptLoader(settings){void 0===settings&&(settings={}),this.states={},this.queue=[],this.scriptLoadedCallbacks={},this.queueLoadedCallbacks=[],this.loading=0,this.settings=settings}return ScriptLoader.prototype._setReferrerPolicy=function(referrerPolicy){this.settings.referrerPolicy=referrerPolicy},ScriptLoader.prototype.loadScript=function(url,success,failure){var elm,dom=DOM$a,cleanup=function(){dom.remove(id),elm&&(elm.onerror=elm.onload=elm=null)},id=dom.uniqueId();(elm=document.createElement("script")).id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),this.settings.referrerPolicy&&dom.setAttrib(elm,"referrerpolicy",this.settings.referrerPolicy),elm.onload=function(){cleanup(),success()},elm.onerror=function(){cleanup(),isFunction(failure)?failure():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+url)},(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)},ScriptLoader.prototype.isDone=function(url){return 2===this.states[url]},ScriptLoader.prototype.markDone=function(url){this.states[url]=2},ScriptLoader.prototype.add=function(url,success,scope,failure){var state=this.states[url];this.queue.push(url),void 0===state&&(this.states[url]=0),success&&(this.scriptLoadedCallbacks[url]||(this.scriptLoadedCallbacks[url]=[]),this.scriptLoadedCallbacks[url].push({success,failure,scope:scope||this}))},ScriptLoader.prototype.load=function(url,success,scope,failure){return this.add(url,success,scope,failure)},ScriptLoader.prototype.remove=function(url){delete this.states[url],delete this.scriptLoadedCallbacks[url]},ScriptLoader.prototype.loadQueue=function(success,scope,failure){this.loadScripts(this.queue,success,scope,failure)},ScriptLoader.prototype.loadScripts=function(scripts,success,scope,failure){var self=this,failures=[],execCallbacks=function(name,url){each$e(self.scriptLoadedCallbacks[url],(function(callback){isFunction(callback[name])&&callback[name].call(callback.scope)})),self.scriptLoadedCallbacks[url]=void 0};self.queueLoadedCallbacks.push({success,failure,scope:scope||this});var loadScripts=function(){var loadingScripts=grep(scripts);if(scripts.length=0,each$e(loadingScripts,(function(url){2!==self.states[url]?3!==self.states[url]?1!==self.states[url]&&(self.states[url]=1,self.loading++,self.loadScript(url,(function(){self.states[url]=2,self.loading--,execCallbacks("success",url),loadScripts()}),(function(){self.states[url]=3,self.loading--,failures.push(url),execCallbacks("failure",url),loadScripts()}))):execCallbacks("failure",url):execCallbacks("success",url)})),!self.loading){var notifyCallbacks=self.queueLoadedCallbacks.slice(0);self.queueLoadedCallbacks.length=0,each$e(notifyCallbacks,(function(callback){0===failures.length?isFunction(callback.success)&&callback.success.call(callback.scope):isFunction(callback.failure)&&callback.failure.call(callback.scope,failures)}))}};loadScripts()},ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}(),Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},data={},currentCode=Cell("en"),getLanguageData=function(){return get$9(data,currentCode.get())},I18n={getData:function(){return map$2(data,(function(value){return __assign({},value)}))},setCode:function(newCode){newCode&&currentCode.set(newCode)},getCode:function(){return currentCode.get()},add:function(code,items){var langData=data[code];langData||(data[code]=langData={}),each$j(items,(function(translation,name){langData[name.toLowerCase()]=translation}))},translate:function(text){var str,langData=getLanguageData().getOr({}),toString=function(obj){return isFunction(obj)?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj},isEmpty=function(text){return""===text||null==text},getLangData=function(text){var textstr=toString(text);return get$9(langData,textstr.toLowerCase()).map(toString).getOr(textstr)},removeContext=function(str){return str.replace(/{context:\w+}$/,"")};if(isEmpty(text))return"";if(isObject(str=text)&&has$2(str,"raw"))return toString(text.raw);if(function(str){return isArray$1(str)&&str.length>1}(text)){var values_1=text.slice(1);return removeContext(getLangData(text[0]).replace(/\{([0-9]+)\}/g,(function($1,$2){return has$2(values_1,$2)?toString(values_1[$2]):$1})))}return removeContext(getLangData(text))},isRtl:function(){return getLanguageData().bind((function(items){return get$9(items,"_dir")})).exists((function(dir){return"rtl"===dir}))},hasCode:function(code){return has$2(data,code)}},AddOnManager=function(){var items=[],urls={},lookup={},_listeners=[],runListeners=function(name,state){var matchedListeners=filter$4(_listeners,(function(listener){return listener.name===name&&listener.state===state}));each$k(matchedListeners,(function(listener){return listener.callback()}))},dependencies=function(name){var result;return lookup[name]&&(result=lookup[name].dependencies),result||[]},createUrl=function(baseUrl,dep){return"object"==typeof dep?dep:"string"==typeof baseUrl?{prefix:"",resource:dep,suffix:""}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},load=function(name,addOnUrl,success,scope,failure){if(!urls[name]){var urlString="string"==typeof addOnUrl?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;0!==urlString.indexOf("/")&&-1===urlString.indexOf("://")&&(urlString=AddOnManager.baseURL+"/"+urlString),urls[name]=urlString.substring(0,urlString.lastIndexOf("/"));var done=function(){runListeners(name,"loaded"),function(name,addOnUrl,success,scope){var deps=dependencies(name);each$k(deps,(function(dep){var newUrl=createUrl(addOnUrl,dep);load(newUrl.resource,newUrl,void 0,void 0)})),success&&(scope?success.call(scope):success.call(ScriptLoader))}(name,addOnUrl,success,scope)};lookup[name]?done():ScriptLoader.ScriptLoader.add(urlString,done,scope,failure)}},waitFor=function(name,callback,state){void 0===state&&(state="added"),has$2(lookup,name)&&"added"===state||has$2(urls,name)&&"loaded"===state?callback():_listeners.push({name,state,callback})};return{items,urls,lookup,_listeners,get:function(name){if(lookup[name])return lookup[name].instance},dependencies,requireLangPack:function(name,languages){!1!==AddOnManager.languageLoad&&waitFor(name,(function(){var language=I18n.getCode();!language||languages&&-1===(","+(languages||"")+",").indexOf(","+language+",")||ScriptLoader.ScriptLoader.add(urls[name]+"/langs/"+language+".js")}),"loaded")},add:function(id,addOn,dependencies){var addOnConstructor=addOn;return items.push(addOnConstructor),lookup[id]={instance:addOnConstructor,dependencies},runListeners(id,"added"),addOnConstructor},remove:function(name){delete urls[name],delete lookup[name]},createUrl,addComponents:function(pluginName,scripts){var pluginUrl=urls[pluginName];each$k(scripts,(function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)}))},load,waitFor}};AddOnManager.languageLoad=!0,AddOnManager.baseURL="",AddOnManager.PluginManager=AddOnManager(),AddOnManager.ThemeManager=AddOnManager();var value=function(){var subject=function(doRevoke){var subject=Cell(Optional.none()),revoke=function(){return subject.get().each(doRevoke)};return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}}(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},first=function(fn,rate){var timer=null;return{cancel:function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];isNull(timer)&&(timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate))}}},last=function(fn,rate){var timer=null,cancel=function(){isNull(timer)||(clearTimeout(timer),timer=null)};return{cancel,throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate)}}},read$4=function(element,attr){var value=get$6(element,attr);return void 0===value||""===value?[]:value.split(" ")},supports=function(element){return void 0!==element.dom.classList},add$2=function(element,clazz){return function(element,attr,id){var nu=read$4(element,attr).concat([id]);return set$1(element,attr,nu.join(" ")),!0}(element,"class",clazz)},remove$4=function(element,clazz){return function(element,attr,id){var nu=filter$4(read$4(element,attr),(function(v){return v!==id}));return nu.length>0?set$1(element,attr,nu.join(" ")):remove$6(element,attr),!1}(element,"class",clazz)},add$1=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$2(element,clazz)},cleanClass=function(element){var classList=supports(element)?element.dom.classList:function(element){return read$4(element,"class")}(element);0===classList.length&&remove$6(element,"class")},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},descendants$1=function(scope,predicate){var result=[];return each$k(children(scope),(function(x){predicate(x)&&(result=result.concat([x])),result=result.concat(descendants$1(x,predicate))})),result},descendants=function(scope,selector){return function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map$3(base.querySelectorAll(selector),SugarElement.fromDom)}(selector,scope)},annotation=constant("mce-annotation"),dataAnnotation=constant("data-mce-annotation"),dataAnnotationId=constant("data-mce-annotation-uid"),identify=function(editor,annotationName){var rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),root=SugarElement.fromDom(editor.getBody()),selector=annotationName.fold((function(){return"."+annotation()}),(function(an){return"["+dataAnnotation()+'="'+an+'"]'})),newStart=child$1(start,rng.startOffset).getOr(start),closest=closest$2(newStart,selector,(function(n){return eq(n,root)})),getAttr=function(c,property){return function(element,key){var dom=element.dom;return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)}(c,property)?Optional.some(get$6(c,property)):Optional.none()};return closest.bind((function(c){return getAttr(c,""+dataAnnotationId()).bind((function(uid){return getAttr(c,""+dataAnnotation()).map((function(name){var elements=findMarkers(editor,uid);return{uid,name,elements}}))}))}))},findMarkers=function(editor,uid){var body=SugarElement.fromDom(editor.getBody());return descendants(body,"["+dataAnnotationId()+'="'+uid+'"]')},setup$n=function(editor,_registry){var changeCallbacks=Cell({}),initData=function(){return{listeners:[],previous:value()}},withCallbacks=function(name,f){updateCallbacks(name,(function(data){return f(data),data}))},updateCallbacks=function(name,f){var callbackMap=changeCallbacks.get(),outputData=f(get$9(callbackMap,name).getOrThunk(initData));callbackMap[name]=outputData,changeCallbacks.set(callbackMap)},onNodeChange=last((function(){var callbackMap=changeCallbacks.get(),annotations=sort(keys(callbackMap));each$k(annotations,(function(name){updateCallbacks(name,(function(data){var prev=data.previous.get();return identify(editor,Optional.some(name)).fold((function(){prev.isSome()&&(!function(name){withCallbacks(name,(function(data){each$k(data.listeners,(function(f){return f(!1,name)}))}))}(name),data.previous.clear())}),(function(_a){var uid=_a.uid,name=_a.name,elements=_a.elements;is$1(prev,uid)||(!function(name,uid,elements){withCallbacks(name,(function(data){each$k(data.listeners,(function(f){return f(!0,name,{uid,nodes:map$3(elements,(function(elem){return elem.dom}))})}))}))}(name,uid,elements),data.previous.set(uid))})),{previous:data.previous,listeners:data.listeners}}))}))}),30);editor.on("remove",(function(){onNodeChange.cancel()})),editor.on("NodeChange",(function(){onNodeChange.throttle()}));return{addListener:function(name,f){updateCallbacks(name,(function(data){return{previous:data.previous,listeners:data.listeners.concat([f])}}))}}},setup$m=function(editor,registry){editor.on("init",(function(){editor.serializer.addNodeFilter("span",(function(spans){each$k(spans,(function(span){(function(span){return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup)})(span).each((function(settings){!1===settings.persistent&&span.unwrap()}))}))}))}))},unique=0,generate=function(prefix){var time=(new Date).getTime();return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},set=function(element,content){var html,div,docDom=owner$1(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),contentElements=(html=content,(div=(docDom||document).createElement("div")).innerHTML=html,children(SugarElement.fromDom(div)));append(fragment,contentElements),empty(element),append$1(element,fragment)},clone$1=function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))},shallow=function(original){return clone$1(original,!1)},deep$1=function(original){return clone$1(original,!0)},TextWalker=function(startNode,rootNode,isBoundary){void 0===isBoundary&&(isBoundary=never);var walker=new DomTreeWalker(startNode,rootNode),walk=function(direction){var next;do{next=walker[direction]()}while(next&&!isText$7(next)&&!isBoundary(next));return Optional.from(next).filter(isText$7)};return{current:function(){return Optional.from(walker.current()).filter(isText$7)},next:function(){return walk("next")},prev:function(){return walk("prev")},prev2:function(){return walk("prev2")}}},TextSeeker=function(dom,isBoundary){var isBlockBoundary=isBoundary||function(node){return dom.isBlock(node)||isBr$5(node)||isContentEditableFalse$b(node)},walk=function(node,offset,walker,process){if(isText$7(node)){var newOffset=process(node,offset,node.data);if(-1!==newOffset)return Optional.some({container:node,offset:newOffset})}return walker().bind((function(next){return walk(next.container,next.offset,walker,process)}))};return{backwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,(function(){return walker.prev().map((function(prev){return{container:prev,offset:prev.length}}))}),process).getOrNull()},forwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,(function(){return walker.next().map((function(next){return{container:next,offset:0}}))}),process).getOrNull()}}},round$2=Math.round,clone=function(rect){return rect?{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},collapse=function(rect,toStart){return rect=clone(rect),toStart||(rect.left=rect.left+rect.width),rect.right=rect.left,rect.width=0,rect},isValidOverflow=function(overflowY,rect1,rect2){return overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2},isAbove$1=function(rect1,rect2){var halfHeight=Math.min(rect2.height/2,rect1.height/2);return rect1.bottom-halfHeight<rect2.top||!(rect1.top>rect2.bottom)&&isValidOverflow(rect2.top-rect1.bottom,rect1,rect2)},isBelow$1=function(rect1,rect2){return rect1.top>rect2.bottom||!(rect1.bottom<rect2.top)&&isValidOverflow(rect2.bottom-rect1.top,rect1,rect2)},containsXY=function(rect,clientX,clientY){return clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom},getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset===startOffset+1?startContainer.childNodes[startOffset]:null},getNode$1=function(container,offset){if(isElement$5(container)&&container.hasChildNodes()){var childNodes=container.childNodes,safeOffset=function(value,min,max){return Math.min(Math.max(value,min),max)}(offset,0,childNodes.length-1);return childNodes[safeOffset]}return container},extendingChars=new RegExp("[-----------------------------------------------------------------------------------------------------------------------------------]"),isExtendingChar=function(ch){return"string"==typeof ch&&ch.charCodeAt(0)>=768&&extendingChars.test(ch)},isElement$3=isElement$5,isCaretCandidate$2=isCaretCandidate$3,isBlock$1=matchStyleValues("display","block table"),isFloated=matchStyleValues("float","left right"),isValidElementCaretCandidate=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}}(isElement$3,isCaretCandidate$2,not(isFloated)),isNotPre=not(matchStyleValues("white-space","pre pre-line pre-wrap")),isText$4=isText$7,isBr$2=isBr$5,nodeIndex$1=DOMUtils.nodeIndex,resolveIndex$1=function(container,offset){return offset<0&&isElement$5(container)&&container.hasChildNodes()?void 0:getNode$1(container,offset)},createRange$1=function(doc){return"createRange"in doc?doc.createRange():DOMUtils.DOM.createRng()},isWhiteSpace$1=function(chr){return chr&&/[\r\n\t ]/.test(chr)},isRange=function(rng){return!!rng.setStart&&!!rng.setEnd},isHiddenWhiteSpaceRange=function(range){var container=range.startContainer,offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$7(container)){var text=container.data;if(isWhiteSpace$1(text[offset-1])||isWhiteSpace$1(text[offset+1]))return!0}return!1},isZeroRect=function(r){return 0===r.left&&0===r.right&&0===r.top&&0===r.bottom},getBoundingClientRect$1=function(item){var clientRect,clientRects=item.getClientRects();return clientRect=clientRects.length>0?clone(clientRects[0]):clone(item.getBoundingClientRect()),!isRange(item)&&isBr$2(item)&&isZeroRect(clientRect)?function(brNode){var doc=brNode.ownerDocument,rng=createRange$1(doc),nbsp$1=doc.createTextNode(""),parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode),rng.setStart(nbsp$1,0),rng.setEnd(nbsp$1,1);var clientRect=clone(rng.getBoundingClientRect());return parentNode.removeChild(nbsp$1),clientRect}(item):isZeroRect(clientRect)&&isRange(item)?function(rng){var sc=rng.startContainer,ec=rng.endContainer,so=rng.startOffset,eo=rng.endOffset;if(sc===ec&&isText$7(ec)&&0===so&&1===eo){var newRng=rng.cloneRange();return newRng.setEndAfter(ec),getBoundingClientRect$1(newRng)}return null}(item):clientRect},collapseAndInflateWidth=function(clientRect,toStart){var newClientRect=collapse(clientRect,toStart);return newClientRect.width=1,newClientRect.right=newClientRect.left+1,newClientRect},getCaretPositionClientRects=function(caretPosition){var clientRects=[],addUniqueAndValidRect=function(clientRect){var rect1,rect2;0!==clientRect.height&&(clientRects.length>0&&(rect1=clientRect,rect2=clientRects[clientRects.length-1],rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right)||clientRects.push(clientRect))},addCharacterOffset=function(container,offset){var range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset]))return clientRects;if(isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1)),clientRects}offset>0&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!0)))},container=caretPosition.container(),offset=caretPosition.offset();if(isText$4(container))return addCharacterOffset(container,offset),clientRects;if(isElement$3(container))if(caretPosition.isAtEnd()){var node=resolveIndex$1(container,offset);isText$4(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr$2(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1))}else{node=resolveIndex$1(container,offset);if(isText$4(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1)),clientRects;var beforeNode=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);isValidElementCaretCandidate(beforeNode)&&!isBr$2(beforeNode)&&(isBlock$1(beforeNode)||isBlock$1(node)||!isValidElementCaretCandidate(node))&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(beforeNode),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!0))}return clientRects},CaretPosition=function(container,offset,clientRects){var getClientRects=function(){return clientRects||(clientRects=getCaretPositionClientRects(CaretPosition(container,offset))),clientRects};return{container:constant(container),offset:constant(offset),toRange:function(){var range=createRange$1(container.ownerDocument);return range.setStart(container,offset),range.setEnd(container,offset),range},getClientRects,isVisible:function(){return getClientRects().length>0},isAtStart:function(){return isText$4(container),0===offset},isAtEnd:function(){return isText$4(container)?offset>=container.data.length:offset>=container.childNodes.length},isEqual:function(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()},getNode:function(before){return resolveIndex$1(container,before?offset-1:offset)}}};CaretPosition.fromRangeStart=function(range){return CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node)+1)},CaretPosition.before=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node))},CaretPosition.isAbove=function(pos1,pos2){return lift2(head(pos2.getClientRects()),last$2(pos1.getClientRects()),isAbove$1).getOr(!1)},CaretPosition.isBelow=function(pos1,pos2){return lift2(last$2(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(!1)},CaretPosition.isAtStart=function(pos){return!!pos&&pos.isAtStart()},CaretPosition.isAtEnd=function(pos){return!!pos&&pos.isAtEnd()},CaretPosition.isTextPosition=function(pos){return!!pos&&isText$7(pos.container())},CaretPosition.isElementPosition=function(pos){return!1===CaretPosition.isTextPosition(pos)};var HDirection,trimEmptyTextNode$1=function(dom,node){isText$7(node)&&0===node.data.length&&dom.remove(node)},rangeInsertNode=function(dom,rng,node){isDocumentFragment(node)?function(dom,rng,frag){var firstChild=Optional.from(frag.firstChild),lastChild=Optional.from(frag.lastChild);rng.insertNode(frag),firstChild.each((function(child){return trimEmptyTextNode$1(dom,child.previousSibling)})),lastChild.each((function(child){return trimEmptyTextNode$1(dom,child.nextSibling)}))}(dom,rng,node):function(dom,rng,node){rng.insertNode(node),trimEmptyTextNode$1(dom,node.previousSibling),trimEmptyTextNode$1(dom,node.nextSibling)}(dom,rng,node)},isText$3=isText$7,isBogus=isBogus$2,nodeIndex=DOMUtils.nodeIndex,normalizedParent=function(node){var parentNode=node.parentNode;return isBogus(parentNode)?normalizedParent(parentNode):parentNode},getChildNodes=function(node){return node?reduce(node.childNodes,(function(result,node){return isBogus(node)&&"BR"!==node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result}),[]):[]},equal=function(a){return function(b){return a===b}},createPathItem=function(node){return(isText$3(node)?"text()":node.nodeName.toLowerCase())+"["+function(node){var nodes,index;nodes=getChildNodes(normalizedParent(node)),index=findIndex$1(nodes,equal(node),node),nodes=nodes.slice(0,index+1);var numTextFragments=reduce(nodes,(function(result,node,i){return isText$3(node)&&isText$3(nodes[i-1])&&result++,result}),0);return nodes=filter$2(nodes,matchNodeNames([node.nodeName])),(index=findIndex$1(nodes,equal(node),node))-numTextFragments}(node)+"]"},create$6=function(root,caretPosition){var container,offset,outputOffset,childNodes,parents,path=[];return container=caretPosition.container(),offset=caretPosition.offset(),isText$3(container)?outputOffset=function(node,offset){for(;(node=node.previousSibling)&&isText$3(node);)offset+=node.data.length;return offset}(container,offset):(offset>=(childNodes=container.childNodes).length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]),path.push(createPathItem(container)),parents=function(root,node,predicate){var parents=[];for(node=node.parentNode;!(node===root||predicate&&predicate(node));node=node.parentNode)parents.push(node);return parents}(root,container),parents=filter$2(parents,not(isBogus$2)),(path=path.concat(map$1(parents,(function(node){return createPathItem(node)})))).reverse().join("/")+","+outputOffset},resolve$2=function(root,path){var offset;if(!path)return null;var parts=path.split(","),paths=parts[0].split("/");offset=parts.length>1?parts[1]:"before";var container=reduce(paths,(function(result,value){var match=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);return match?("text()"===match[1]&&(match[1]="#text"),function(node,name,index){var nodes=getChildNodes(node);return nodes=filter$2(nodes,(function(node,index){return!isText$3(node)||!isText$3(nodes[index-1])})),(nodes=filter$2(nodes,matchNodeNames([name])))[index]}(result,match[1],parseInt(match[2],10))):null}),root);return container?isText$3(container)?function(container,offset){for(var dataLen,node=container,targetOffset=0;isText$3(node);){if(dataLen=node.data.length,offset>=targetOffset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText$3(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return isText$3(container)&&offset>container.data.length&&(offset=container.data.length),CaretPosition(container,offset)}(container,parseInt(offset,10)):(offset="after"===offset?nodeIndex(container)+1:nodeIndex(container),CaretPosition(container.parentNode,offset)):null},isContentEditableFalse$9=isContentEditableFalse$b,getPoint=function(dom,trim,normalized,rng,start){var childNodes,container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],after=0,root=dom.getRoot();for(isText$7(container)?point.push(normalized?function(trim,container,offset){var node,trimmedOffset;for(trimmedOffset=trim(container.data.slice(0,offset)).length,node=container.previousSibling;node&&isText$7(node);node=node.previousSibling)trimmedOffset+=trim(node.data).length;return trimmedOffset}(trim,container,offset):offset):(offset>=(childNodes=container.childNodes).length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after));container&&container!==root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point},findIndex=function(dom,name,element){var count=0;return Tools.each(dom.select(name),(function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!==element&&void count++})),count},moveEndPoint$1=function(rng,start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"],offset=rng[prefix+"Offset"],isElement$5(container)&&"TR"===container.nodeName&&(container=(childNodes=container.childNodes)[Math.min(start?offset:offset-1,childNodes.length-1)])&&(offset=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,offset))},normalizeTableCellSelection=function(rng){return moveEndPoint$1(rng,!0),moveEndPoint$1(rng,!1),rng},findSibling=function(node,offset){var sibling;if(isElement$5(node)&&(node=getNode$1(node,offset),isContentEditableFalse$9(node)))return node;if(isCaretContainer$2(node)){if(isText$7(node)&&isCaretContainerBlock$1(node)&&(node=node.parentNode),sibling=node.previousSibling,isContentEditableFalse$9(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse$9(sibling))return sibling}},getOffsetBookmark=function(trim,normalized,selection){var element=selection.getNode(),name=element?element.nodeName:null,rng=selection.getRng();if(isContentEditableFalse$9(element)||"IMG"===name)return{name,index:findIndex(selection.dom,name,element)};var sibling=function(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset)}(rng);return sibling?{name:name=sibling.tagName,index:findIndex(selection.dom,name,sibling)}:function(trim,selection,normalized,rng){var dom=selection.dom,bookmark={};return bookmark.start=getPoint(dom,trim,normalized,rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(dom,trim,normalized,rng,!1)),isRangeInCaretContainerBlock(rng)&&(bookmark.isFakeCaret=!0),bookmark}(trim,selection,normalized,rng)},createBookmarkSpan=function(dom,id,filled){var args={"data-mce-type":"bookmark",id,style:"overflow:hidden;line-height:0px"};return filled?dom.create("span",args,"&#xFEFF;"):dom.create("span",args)},getPersistentBookmark=function(selection,filled){var dom=selection.dom,rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),element=selection.getNode(),name=element.nodeName;if("IMG"===name)return{name,index:findIndex(dom,name,element)};var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(!1);var endBookmarkNode=createBookmarkSpan(dom,id+"_end",filled);rangeInsertNode(dom,rng2,endBookmarkNode)}(rng=normalizeTableCellSelection(rng)).collapse(!0);var startBookmarkNode=createBookmarkSpan(dom,id+"_start",filled);return rangeInsertNode(dom,rng,startBookmarkNode),selection.moveToBookmark({id,keep:!0}),{id}},getBookmark$2=function(selection,type,normalized){return 2===type?getOffsetBookmark(trim$2,normalized,selection):3===type?function(selection){var rng=selection.getRng();return{start:create$6(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$6(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng))}}(selection):type?function(selection){return{rng:selection.getRng()}}(selection):getPersistentBookmark(selection,!1)},getUndoBookmark=curry(getOffsetBookmark,identity,!0),DOM$9=DOMUtils.DOM,getBodySetting=function(editor,name,defaultValue){var value=editor.getParam(name,defaultValue);if(-1!==value.indexOf("=")){var bodyObj=editor.getParam(name,"","hash");return get$9(bodyObj,editor.id).getOr(defaultValue)}return value},getContentSecurityPolicy=function(editor){return editor.getParam("content_security_policy","")},getForcedRootBlock=function(editor){if(editor.getParam("force_p_newlines",!1))return"p";var block=editor.getParam("forced_root_block","p");return!1===block?"":!0===block?"p":block},getForcedRootBlockAttrs=function(editor){return editor.getParam("forced_root_block_attrs",{})},isAutomaticUploadsEnabled=function(editor){return editor.getParam("automatic_uploads",!0,"boolean")},shouldReuseFileName=function(editor){return editor.getParam("images_reuse_filename",!1,"boolean")},getIconPackName=function(editor){return editor.getParam("icons","","string")},getImageUploadUrl=function(editor){return editor.getParam("images_upload_url","","string")},getImageUploadBasePath=function(editor){return editor.getParam("images_upload_base_path","","string")},getImagesUploadCredentials=function(editor){return editor.getParam("images_upload_credentials",!1,"boolean")},getImagesUploadHandler=function(editor){return editor.getParam("images_upload_handler",null,"function")},shouldUseContentCssCors=function(editor){return editor.getParam("content_css_cors",!1,"boolean")},getReferrerPolicy=function(editor){return editor.getParam("referrer_policy","","string")},getLanguageCode=function(editor){return editor.getParam("language","en","string")},shouldIndentUseMargin=function(editor){return editor.getParam("indent_use_margin",!1)},getFontCss=function(editor){var fontCss=editor.getParam("font_css",[]);return isArray$1(fontCss)?fontCss:map$3(fontCss.split(","),trim$4)},getObjectResizing=function(editor){var selector=editor.getParam("object_resizing");return!1!==selector&&!Env.iOS&&(isString$1(selector)?selector:"table,img,figure.image,div,video,iframe")},getEventRoot=function(editor){return editor.getParam("event_root")},getTheme=function(editor){return editor.getParam("theme")},shouldValidate=function(editor){return editor.getParam("validate")},isInlineBoundariesEnabled=function(editor){return!1!==editor.getParam("inline_boundaries")},hasContentCssCors=function(editor){return editor.getParam("content_css_cors")},getPlugins=function(editor){return editor.getParam("plugins","","string")},isElement$2=isElement$5,isText$2=isText$7,removeNode$1=function(node){var parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},trimCount=function(text){var trimmedText=trim$2(text);return{count:text.length-trimmedText.length,text:trimmedText}},deleteZwspChars=function(caretContainer){for(var idx;-1!==(idx=caretContainer.data.lastIndexOf("\ufeff"));)caretContainer.deleteData(idx,1)},removeUnchanged=function(caretContainer,pos){return remove$2(caretContainer),pos},removeElementAndReposition=function(caretContainer,pos){var parentNode=pos.container(),newPosition=function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Optional.none():Optional.some(r)}(from(parentNode.childNodes),caretContainer).map((function(index){return index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos})).getOr(pos);return remove$2(caretContainer),newPosition},removeTextCaretContainer=function(caretContainer,pos){return isText$2(caretContainer)&&pos.container()===caretContainer?function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset()));return(before.text+after.text).length>0?(deleteZwspChars(caretContainer),CaretPosition(caretContainer,pos.offset()-before.count)):pos}(caretContainer,pos):removeUnchanged(caretContainer,pos)},removeAndReposition=function(container,pos){return CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):function(caretContainer,pos){return pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos)}(container,pos)},remove$2=function(caretContainerNode){isElement$2(caretContainerNode)&&isCaretContainer$2(caretContainerNode)&&(hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode$1(caretContainerNode)),isText$2(caretContainerNode)&&(deleteZwspChars(caretContainerNode),0===caretContainerNode.data.length&&removeNode$1(caretContainerNode))},browser$2=detect().browser,isContentEditableFalse$8=isContentEditableFalse$b,isMedia$1=isMedia$2,isTableCell$3=isTableCell$5,getAbsoluteClientRect=function(root,element,before){var scrollX,scrollY,clientRect=collapse(element.getBoundingClientRect(),before);if("BODY"===root.tagName){var docElm=root.ownerDocument.documentElement;scrollX=root.scrollLeft||docElm.scrollLeft,scrollY=root.scrollTop||docElm.scrollTop}else{var rootRect=root.getBoundingClientRect();scrollX=root.scrollLeft-rootRect.left,scrollY=root.scrollTop-rootRect.top}clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1;var margin=element.offsetWidth-element.clientWidth;return margin>0&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect},FakeCaret=function(editor,root,isBlock,hasFocus){var cursorInterval,caretContainerNode,lastVisualCaret=value(),rootBlock=getForcedRootBlock(editor),caretBlock=rootBlock.length>0?rootBlock:"p",hide=function(){!function(root){for(var fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),"*[contentEditable=false],video,audio,embed,object"),i=0;i<fakeCaretTargetNodes.length;i++){var data,node=fakeCaretTargetNodes[i].dom,sibling=node.previousSibling;endsWithCaretContainer$1(sibling)&&(1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1)),sibling=node.nextSibling,startsWithCaretContainer$1(sibling)&&(1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1))}}(root),caretContainerNode&&(remove$2(caretContainerNode),caretContainerNode=null),lastVisualCaret.on((function(caretState){DomQuery(caretState.caret).remove(),lastVisualCaret.clear()})),cursorInterval&&(Delay.clearInterval(cursorInterval),cursorInterval=void 0)},startBlink=function(){cursorInterval=Delay.setInterval((function(){hasFocus()?DomQuery("div.mce-visual-caret",root).toggleClass("mce-visual-caret-hidden"):DomQuery("div.mce-visual-caret",root).addClass("mce-visual-caret-hidden")}),500)};return{show:function(before,element){var rng;if(hide(),isTableCell$3(element))return null;if(!isBlock(element))return caretContainerNode=function(node,before){var textNode=node.ownerDocument.createTextNode("\ufeff"),parentNode=node.parentNode;if(before){if(sibling=node.previousSibling,isText$6(sibling)){if(isCaretContainer$2(sibling))return sibling;if(endsWithCaretContainer$1(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{var sibling=node.nextSibling;if(isText$6(sibling)){if(isCaretContainer$2(sibling))return sibling;if(startsWithCaretContainer$1(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode}(element,before),rng=element.ownerDocument.createRange(),isInlineFakeCaretTarget(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng;caretContainerNode=insertBlock$1(caretBlock,element,before);var clientRect=getAbsoluteClientRect(root,element,before);DomQuery(caretContainerNode).css("top",clientRect.top);var caret=DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(__assign({},clientRect)).appendTo(root)[0];return lastVisualCaret.set({caret,element,before}),before&&DomQuery(caret).addClass("mce-visual-caret-before"),startBlink(),(rng=element.ownerDocument.createRange()).setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0),rng},hide,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},reposition:function(){lastVisualCaret.on((function(caretState){var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);DomQuery(caretState.caret).css(__assign({},clientRect))}))},destroy:function(){return Delay.clearInterval(cursorInterval)}}},isFakeCaretTableBrowser=function(){return browser$2.isIE()||browser$2.isEdge()||browser$2.isFirefox()},isInlineFakeCaretTarget=function(node){return isContentEditableFalse$8(node)||isMedia$1(node)},isFakeCaretTarget=function(node){return isInlineFakeCaretTarget(node)||isTable$3(node)&&isFakeCaretTableBrowser()},isContentEditableFalse$7=isContentEditableFalse$b,isMedia=isMedia$2,isBlockLike=matchStyleValues("display","block table table-cell table-caption list-item"),isCaretContainer=isCaretContainer$2,isCaretContainerBlock=isCaretContainerBlock$1,isElement$1=isElement$5,isCaretCandidate$1=isCaretCandidate$3,isForwards=function(direction){return direction>0},isBackwards=function(direction){return direction<0},skipCaretContainers=function(walk,shallow){for(var node;node=walk(shallow);)if(!isCaretContainerBlock(node))return node;return null},findNode$1=function(node,direction,predicateFn,rootNode,shallow){var walker=new DomTreeWalker(node,rootNode),isCefOrCaretContainer=isContentEditableFalse$7(node)||isCaretContainerBlock(node);if(isBackwards(direction)){if(isCefOrCaretContainer&&predicateFn(node=skipCaretContainers(walker.prev.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.prev.bind(walker),shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if(isCefOrCaretContainer&&predicateFn(node=skipCaretContainers(walker.next.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.next.bind(walker),shallow);)if(predicateFn(node))return node}return null},getParentBlock$2=function(node,rootNode){for(;node&&node!==rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null},isInSameBlock=function(caretPosition1,caretPosition2,rootNode){return getParentBlock$2(caretPosition1.container(),rootNode)===getParentBlock$2(caretPosition2.container(),rootNode)},getChildNodeAtRelativeOffset=function(relativeOffset,caretPosition){if(!caretPosition)return null;var container=caretPosition.container(),offset=caretPosition.offset();return isElement$1(container)?container.childNodes[offset+relativeOffset]:null},beforeAfter=function(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range},isNodesInSameBlock=function(root,node1,node2){return getParentBlock$2(node1,root)===getParentBlock$2(node2,root)},lean=function(left,root,node){for(var siblingName=left?"previousSibling":"nextSibling";node&&node!==root;){var sibling=node[siblingName];if(isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse$7(sibling)||isMedia(sibling)){if(isNodesInSameBlock(root,sibling,node))return sibling;break}if(isCaretCandidate$1(sibling))break;node=node.parentNode}return null},before$2=curry(beforeAfter,!0),after$2=curry(beforeAfter,!1),normalizeRange=function(direction,root,range){var node,leanLeft=curry(lean,!0,root),leanRight=curry(lean,!1,root),container=range.startContainer,offset=range.startOffset;if(isCaretContainerBlock$1(container)){isElement$1(container)||(container=container.parentNode);var location_1=container.getAttribute("data-mce-caret");if("before"===location_1&&(node=container.nextSibling,isFakeCaretTarget(node)))return before$2(node);if("after"===location_1&&(node=container.previousSibling,isFakeCaretTarget(node)))return after$2(node)}if(!range.collapsed)return range;if(isText$7(container)){if(isCaretContainer(container)){if(1===direction){if(node=leanRight(container))return before$2(node);if(node=leanLeft(container))return after$2(node)}if(-1===direction){if(node=leanLeft(container))return after$2(node);if(node=leanRight(container))return before$2(node)}return range}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container))?before$2(node):range;if(startsWithCaretContainer$1(container)&&offset<=1)return-1===direction&&(node=leanLeft(container))?after$2(node):range;if(offset===container.data.length)return(node=leanRight(container))?before$2(node):range;if(0===offset)return(node=leanLeft(container))?after$2(node):range}return range},getRelativeCefElm=function(forward,caretPosition){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,caretPosition)).filter(isContentEditableFalse$7)},getNormalizedRangeEndPoint=function(direction,root,range){var normalizedRange=normalizeRange(direction,root,range);return-1===direction?CaretPosition.fromRangeStart(normalizedRange):CaretPosition.fromRangeEnd(normalizedRange)},getElementFromPosition=function(pos){return Optional.from(pos.getNode()).map(SugarElement.fromDom)},getVisualCaretPosition=function(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition},isMoveInsideSameBlock=function(from,to){var inSameBlock=isInSameBlock(from,to);return!(inSameBlock||!isBr$5(from.getNode()))||inSameBlock};!function(HDirection){HDirection[HDirection.Backwards=-1]="Backwards",HDirection[HDirection.Forwards=1]="Forwards"}(HDirection||(HDirection={}));var expected,isContentEditableFalse$6=isContentEditableFalse$b,isText$1=isText$7,isElement=isElement$5,isBr$1=isBr$5,isCaretCandidate=isCaretCandidate$3,isAtomic=function(node){return isAtomicInline(node)||function(node){return!!isNonUiContentEditableFalse(node)&&!0!==foldl(from(node.getElementsByTagName("*")),(function(result,elm){return result||isContentEditableTrue$3(elm)}),!1)}(node)},isEditableCaretCandidate=isEditableCaretCandidate$1,nodeAtIndex=function(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null},getCaretCandidatePosition=function(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$1(node.previousSibling))return CaretPosition.before(node);if(isText$1(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$1(node.nextSibling))return CaretPosition.after(node);if(isText$1(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr$1(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)},findCaretPosition$1=function(direction,startPos,root){var node,nextNode,innerNode,caretPosition;if(!isElement(root)||!startPos)return null;if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){if(caretPosition=CaretPosition.after(root.lastChild),isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement(root.lastChild))return isBr$1(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition}else caretPosition=startPos;var container=caretPosition.container(),offset=caretPosition.offset();if(isText$1(container)){if(isBackwards(direction)&&offset>0)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&offset>0&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode))?isText$1(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText$1(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate(nextNode)))return isBr$1(nextNode)?function(root,nextNode){var nextSibling=nextNode.nextSibling;return nextSibling&&isCaretCandidate(nextSibling)?isText$1(nextSibling)?CaretPosition(nextSibling,0):CaretPosition.before(nextSibling):findCaretPosition$1(HDirection.Forwards,CaretPosition.after(nextNode),root)}(root,nextNode):!isAtomic(nextNode)&&(innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode))?isText$1(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText$1(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=nextNode||caretPosition.getNode()}if((isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=findNode$1(node,direction,always,root,!0),isEditableCaretCandidate(node,root)))return getCaretCandidatePosition(direction,node);nextNode=findNode$1(node,direction,isEditableCaretCandidate,root);var rootContentEditableFalseElm=last$1(filter$4(function(node,root){for(var parents=[];node&&node!==root;)parents.push(node),node=node.parentNode;return parents}(container,root),isContentEditableFalse$6));return!rootContentEditableFalseElm||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm)},CaretWalker=function(root){return{next:function(caretPosition){return findCaretPosition$1(HDirection.Forwards,caretPosition,root)},prev:function(caretPosition){return findCaretPosition$1(HDirection.Backwards,caretPosition,root)}}},isBeforeOrStart=function(position){return CaretPosition.isTextPosition(position)?0===position.offset():isCaretCandidate$3(position.getNode())},isAfterOrEnd=function(position){if(CaretPosition.isTextPosition(position)){var container=position.container();return position.offset()===container.data.length}return isCaretCandidate$3(position.getNode(!0))},isBeforeAfterSameElement=function(from,to){return!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(!0)},shouldSkipPosition=function(forward,from,to){return forward?!isBeforeAfterSameElement(from,to)&&(position=from,!(!CaretPosition.isTextPosition(position)&&isBr$5(position.getNode())))&&isAfterOrEnd(from)&&isBeforeOrStart(to):!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to);var position},fromPosition=function(forward,root,pos){var walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos))},navigate=function(forward,root,from){return fromPosition(forward,root,from).bind((function(to){return isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)?fromPosition(forward,root,to):Optional.some(to)}))},navigateIgnore=function(forward,root,from,ignoreFilter){return navigate(forward,root,from).bind((function(pos){return ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos)}))},positionIn=function(forward,element){var node,startNode=forward?element.firstChild:element.lastChild;return isText$7(startNode)?Optional.some(CaretPosition(startNode,forward?0:startNode.data.length)):startNode?isCaretCandidate$3(startNode)?Optional.some(forward?CaretPosition.before(startNode):isBr$5(node=startNode)?CaretPosition.before(node):CaretPosition.after(node)):function(forward,root,start){var position=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,position)}(forward,element,startNode):Optional.none()},nextPosition=curry(fromPosition,!0),prevPosition=curry(fromPosition,!1),firstPositionIn=curry(positionIn,!0),lastPositionIn=curry(positionIn,!1),isCaretNode=function(node){return isElement$5(node)&&"_mce_caret"===node.id},getParentCaretContainer=function(body,node){for(;node&&node!==body;){if("_mce_caret"===node.id)return node;node=node.parentNode}return null},isPathBookmark=function(bookmark){return Tools.isArray(bookmark.start)},addBogus=function(dom,node){return isElement$5(node)&&dom.isBlock(node)&&!node.innerHTML&&!Env.ie&&(node.innerHTML='<br data-mce-bogus="1" />'),node},tryFindRangePosition=function(node,rng){return lastPositionIn(node).fold(never,(function(pos){return rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),!0}))},padEmptyCaretContainer=function(root,node,rng){return!(!function(node){return!1===node.hasChildNodes()}(node)||!getParentCaretContainer(root,node))&&(function(node,rng){var textNode=node.ownerDocument.createTextNode("\ufeff");node.appendChild(textNode),rng.setStart(textNode,0),rng.setEnd(textNode,0)}(node,rng),!0)},setEndPoint=function(dom,start,bookmark,rng){var i,node,offset,children,point=bookmark[start?"start":"end"],root=dom.getRoot();if(point){for(offset=point[0],node=root,i=point.length-1;i>=1;i--){if(children=node.childNodes,padEmptyCaretContainer(root,node,rng))return!0;if(point[i]>children.length-1)return!!padEmptyCaretContainer(root,node,rng)||tryFindRangePosition(node,rng);node=children[point[i]]}3===node.nodeType&&(offset=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0},isValidTextNode=function(node){return isText$7(node)&&node.data.length>0},restoreEndPoint=function(dom,suffix,bookmark){var node,idx,next,prev,container,offset,marker=dom.get(bookmark.id+"_"+suffix),keep=bookmark.keep;if(marker){if(node=marker.parentNode,"start"===suffix?(keep?marker.hasChildNodes()?(node=marker.firstChild,idx=1):isValidTextNode(marker.nextSibling)?(node=marker.nextSibling,idx=0):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,idx=marker.previousSibling.data.length):(node=marker.parentNode,idx=dom.nodeIndex(marker)+1):idx=dom.nodeIndex(marker),container=node,offset=idx):(keep?marker.hasChildNodes()?(node=marker.firstChild,idx=1):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,idx=marker.previousSibling.data.length):(node=marker.parentNode,idx=dom.nodeIndex(marker)):idx=dom.nodeIndex(marker),container=node,offset=idx),!keep){for(prev=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),(function(node){isText$7(node)&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))}));marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,!0);prev&&next&&prev.nodeType===next.nodeType&&isText$7(prev)&&!Env.opera&&(idx=prev.nodeValue.length,prev.appendData(next.nodeValue),dom.remove(next),container=prev,offset=idx)}return Optional.some(CaretPosition(container,offset))}return Optional.none()},resolve$1=function(selection,bookmark){var dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark))return function(dom,bookmark){var rng=dom.createRng();return setEndPoint(dom,!0,bookmark,rng)&&setEndPoint(dom,!1,bookmark,rng)?Optional.some(rng):Optional.none()}(dom,bookmark);if(function(bookmark){return isString$1(bookmark.start)}(bookmark))return Optional.some(function(dom,bookmark){var pos,rng=dom.createRng();return pos=resolve$2(dom.getRoot(),bookmark.start),rng.setStart(pos.container(),pos.offset()),pos=resolve$2(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng}(dom,bookmark));if(function(bookmark){return has$2(bookmark,"id")}(bookmark))return function(dom,bookmark){var startPos=restoreEndPoint(dom,"start",bookmark),endPos=restoreEndPoint(dom,"end",bookmark);return lift2(startPos,endPos.or(startPos),(function(spos,epos){var rng=dom.createRng();return rng.setStart(addBogus(dom,spos.container()),spos.offset()),rng.setEnd(addBogus(dom,epos.container()),epos.offset()),rng}))}(dom,bookmark);if(function(bookmark){return has$2(bookmark,"name")}(bookmark))return function(dom,bookmark){return Optional.from(dom.select(bookmark.name)[bookmark.index]).map((function(elm){var rng=dom.createRng();return rng.selectNode(elm),rng}))}(dom,bookmark);if(function(bookmark){return has$2(bookmark,"rng")}(bookmark))return Optional.some(bookmark.rng)}return Optional.none()},getBookmark$1=function(selection,type,normalized){return getBookmark$2(selection,type,normalized)},moveToBookmark=function(selection,bookmark){resolve$1(selection,bookmark).each((function(rng){selection.setRng(rng)}))},isBookmarkNode$1=function(node){return isElement$5(node)&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},isNbsp=(expected="",function(actual){return expected===actual}),isWhiteSpace=function(chr){return""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr)},isContent=function(chr){return!isWhiteSpace(chr)&&!isNbsp(chr)},isNode=function(node){return!!node.nodeType},moveStart=function(dom,selection,rng){var offset=rng.startOffset,container=rng.startContainer;if((container!==rng.endContainer||!function(node){return node&&/^(IMG)$/.test(node.nodeName)}(container.childNodes[offset]))&&isElement$5(container)){var nodes=container.childNodes,walker=void 0;offset<nodes.length?(container=nodes[offset],walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))):(container=nodes[nodes.length-1],(walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))).next(!0));for(var node=walker.current();node;node=walker.next())if(isText$7(node)&&!isWhiteSpaceNode$1(node))return rng.setStart(node,0),void selection.setRng(rng)}},getNonWhiteSpaceSibling=function(node,next,inc){if(node){var nextName=next?"nextSibling":"previousSibling";for(node=inc?node:node[nextName];node;node=node[nextName])if(isElement$5(node)||!isWhiteSpaceNode$1(node))return node}},isTextBlock$1=function(editor,name){return isNode(name)&&(name=name.nodeName),!!editor.schema.getTextBlockElements()[name.toLowerCase()]},isValid=function(ed,parent,child){return ed.schema.isValidChild(parent,child)},isWhiteSpaceNode$1=function(node,allowSpaces){if(void 0===allowSpaces&&(allowSpaces=!1),isNonNullable(node)&&isText$7(node)){var data=allowSpaces?node.data.replace(/ /g,""):node.data;return isWhitespaceText(data)}return!1},replaceVars=function(value,vars){return isFunction(value)?value=value(vars):isNonNullable(vars)&&(value=value.replace(/%(\w+)/g,(function(str,name){return vars[name]||str}))),value},isEq$5=function(str1,str2){return str2=str2||"",str1=""+((str1=str1||"").nodeName||str1),str2=""+(str2.nodeName||str2),str1.toLowerCase()===str2.toLowerCase()},normalizeStyleValue=function(dom,value,name){return"color"!==name&&"backgroundColor"!==name||(value=dom.toHex(value)),"fontWeight"===name&&700===value&&(value="bold"),"fontFamily"===name&&(value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+value},getStyle=function(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name)},getTextDecoration=function(dom,node){var decoration;return dom.getParent(node,(function(n){return(decoration=dom.getStyle(n,"text-decoration"))&&"none"!==decoration})),decoration},getParents$2=function(dom,node,selector){return dom.getParents(node,selector,dom.getRoot())},areSimilarFormats=function(editor,formatName,otherFormatName){var validKeys=["inline","block","selector","attributes","styles","classes"],filterObj=function(format){return filter$3(format,(function(_,key){return exists(validKeys,(function(validKey){return validKey===key}))}))};return exists(editor.formatter.get(formatName),(function(fmt1){var filteredFmt1=filterObj(fmt1);return exists(editor.formatter.get(otherFormatName),(function(fmt2){var filteredFmt2=filterObj(fmt2);return function(a1,a2,eq){return void 0===eq&&(eq=eqAny),eqRecord(eq).eq(a1,a2)}(filteredFmt1,filteredFmt2)}))}))},isBlockFormat=function(format){return hasNonNullableKey(format,"block")},isSelectorFormat=function(format){return hasNonNullableKey(format,"selector")},isInlineFormat=function(format){return hasNonNullableKey(format,"inline")},shouldExpandToSelector=function(format){return isSelectorFormat(format)&&!1!==format.expand&&!isInlineFormat(format)},isBookmarkNode=isBookmarkNode$1,getParents$1=getParents$2,isWhiteSpaceNode=isWhiteSpaceNode$1,isTextBlock=isTextBlock$1,findParentContentEditable=function(dom,node){for(var parent=node;parent;){if(isElement$5(parent)&&dom.getContentEditable(parent))return"false"===dom.getContentEditable(parent)?parent:node;parent=parent.parentNode}return node},walkText=function(start,node,offset,predicate){for(var str=node.data,i=offset;start?i>=0:i<str.length;start?i--:i++)if(predicate(str.charAt(i)))return start?i+1:i;return-1},findSpace=function(start,node,offset){return walkText(start,node,offset,(function(c){return isNbsp(c)||isWhiteSpace(c)}))},findContent=function(start,node,offset){return walkText(start,node,offset,isContent)},findWordEndPoint=function(dom,body,container,offset,start,includeTrailingSpaces){var lastTextNode,rootNode=dom.getParent(container,dom.isBlock)||body,walk=function(container,offset,pred){var textSeeker=TextSeeker(dom),walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,(function(text,textOffset){return isBookmarkNode(text.parentNode)?-1:(lastTextNode=text,pred(start,text,textOffset))}),rootNode))};return walk(container,offset,findSpace).bind((function(result){return includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result)})).orThunk((function(){return lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none()}))},findSelectorEndPoint=function(dom,formatList,rng,container,siblingName){isText$7(container)&&isEmpty$3(container.data)&&container[siblingName]&&(container=container[siblingName]);for(var parents=getParents$1(dom,container),i=0;i<parents.length;i++)for(var y=0;y<formatList.length;y++){var curFormat=formatList[y];if((!isNonNullable(curFormat.collapsed)||curFormat.collapsed===rng.collapsed)&&(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)))return parents[i]}return container},findBlockEndPoint=function(editor,formatList,container,siblingName){var node=container,dom=editor.dom,root=dom.getRoot(),format=formatList[0];if(isBlockFormat(format)&&(node=format.wrapper?null:dom.getParent(container,format.block,root)),!node){var scopeRoot=dom.getParent(container,"LI,TD,TH");node=dom.getParent(isText$7(container)?container.parentNode:container,(function(node){return node!==root&&isTextBlock(editor,node)}),scopeRoot)}if(node&&isBlockFormat(format)&&format.wrapper&&(node=getParents$1(dom,node,"ul,ol").reverse()[0]||node),!node)for(node=container;node[siblingName]&&!dom.isBlock(node[siblingName])&&(node=node[siblingName],!isEq$5(node,"br")););return node||container},isAtBlockBoundary$1=function(dom,root,container,siblingName){var parent=container.parentNode;return!isNonNullable(container[siblingName])&&(!(parent!==root&&!isNullable(parent)&&!dom.isBlock(parent))||isAtBlockBoundary$1(dom,root,parent,siblingName))},findParentContainer=function(dom,formatList,container,offset,start){var node,parent=container,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot();if(isText$7(container)&&!isWhiteSpaceNode(container)&&(start?offset>0:offset<container.data.length))return container;for(;;){if(!formatList[0].block_expand&&dom.isBlock(parent))return parent;for(var sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){var allowSpaces=isText$7(sibling)&&!isAtBlockBoundary$1(dom,root,sibling,siblingName);if(!isBookmarkNode(sibling)&&(!isBr$5(node=sibling)||!node.getAttribute("data-mce-bogus")||node.nextSibling)&&!isWhiteSpaceNode(sibling,allowSpaces))return parent}if(parent===root||parent.parentNode===root){container=parent;break}parent=parent.parentNode}return container},isSelfOrParentBookmark=function(container){return isBookmarkNode(container.parentNode)||isBookmarkNode(container)},expandRng=function(editor,rng,formatList,includeTrailingSpace){void 0===includeTrailingSpace&&(includeTrailingSpace=!1);var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,dom=editor.dom,format=formatList[0];(isElement$5(startContainer)&&startContainer.hasChildNodes()&&(startContainer=getNode$1(startContainer,startOffset),isText$7(startContainer)&&(startOffset=0)),isElement$5(endContainer)&&endContainer.hasChildNodes()&&(endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1),isText$7(endContainer)&&(endOffset=endContainer.nodeValue.length)),startContainer=findParentContentEditable(dom,startContainer),endContainer=findParentContentEditable(dom,endContainer),isSelfOrParentBookmark(startContainer)&&(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode,startContainer=rng.collapsed?startContainer.previousSibling||startContainer:startContainer.nextSibling||startContainer,isText$7(startContainer)&&(startOffset=rng.collapsed?startContainer.length:0)),isSelfOrParentBookmark(endContainer)&&(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode,endContainer=rng.collapsed?endContainer.nextSibling||endContainer:endContainer.previousSibling||endContainer,isText$7(endContainer)&&(endOffset=rng.collapsed?0:endContainer.length)),rng.collapsed)&&(findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,!0,includeTrailingSpace).each((function(_a){var container=_a.container,offset=_a.offset;startContainer=container,startOffset=offset})),findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,!1,includeTrailingSpace).each((function(_a){var container=_a.container,offset=_a.offset;endContainer=container,endOffset=offset})));return(isInlineFormat(format)||format.block_expand)&&(isInlineFormat(format)&&isText$7(startContainer)&&0!==startOffset||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),isInlineFormat(format)&&isText$7(endContainer)&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1))),shouldExpandToSelector(format)&&(startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,"previousSibling"),endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,"nextSibling")),(isBlockFormat(format)||isSelectorFormat(format))&&(startContainer=findBlockEndPoint(editor,formatList,startContainer,"previousSibling"),endContainer=findBlockEndPoint(editor,formatList,endContainer,"nextSibling"),isBlockFormat(format)&&(dom.isBlock(startContainer)||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),dom.isBlock(endContainer)||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1)))),isElement$5(startContainer)&&(startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),isElement$5(endContainer)&&(endOffset=dom.nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer,startOffset,endContainer,endOffset}},walk$2=function(dom,rng,callback){var startOffset=rng.startOffset,startContainer=getNode$1(rng.startContainer,startOffset),endOffset=rng.endOffset,endContainer=getNode$1(rng.endContainer,endOffset-1),exclude=function(nodes){var firstNode=nodes[0];isText$7(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length&&nodes.splice(0,1);var lastNode=nodes[nodes.length-1];return 0===endOffset&&nodes.length>0&&lastNode===endContainer&&isText$7(lastNode)&&nodes.splice(nodes.length-1,1),nodes},collectSiblings=function(node,name,endNode){for(var siblings=[];node&&node!==endNode;node=node[name])siblings.push(node);return siblings},findEndPoint=function(node,root){return dom.getParent(node,(function(node){return node.parentNode===root}),root)},walkBoundary=function(startNode,endNode,next){for(var siblingName=next?"nextSibling":"previousSibling",node=startNode,parent_1=node.parentNode;node&&node!==endNode;node=parent_1){parent_1=node.parentNode;var siblings_1=collectSiblings(node===startNode?node:node[siblingName],siblingName);siblings_1.length&&(next||siblings_1.reverse(),callback(exclude(siblings_1)))}};if(startContainer===endContainer)return callback(exclude([startContainer]));var ancestor=dom.findCommonAncestor(startContainer,endContainer);if(dom.isChildOf(startContainer,endContainer))return walkBoundary(startContainer,ancestor,!0);if(dom.isChildOf(endContainer,startContainer))return walkBoundary(endContainer,ancestor);var startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,!0);var siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint===endContainer?endPoint.nextSibling:endPoint);siblings.length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)},getRanges=function(selection){var ranges=[];if(selection)for(var i=0;i<selection.rangeCount;i++)ranges.push(selection.getRangeAt(i));return ranges},getCellsFromRanges=function(ranges){return filter$4(function(ranges){return bind(ranges,(function(range){var node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[]}))}(ranges),isTableCell$4)},getCellsFromElementOrRanges=function(ranges,element){var selectedCells=descendants(element,"td[data-mce-selected],th[data-mce-selected]");return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges)},getCellsFromEditor=function(editor){return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()))},getClosestTable=function(cell,isRoot){return ancestor$2(cell,"table",isRoot)},getFirstChildren=function(node){return firstChild(node).fold(constant([node]),(function(child){return[node].concat(getFirstChildren(child))}))},getLastChildren$1=function(node){return lastChild(node).fold(constant([node]),(function(child){return"br"===name(child)?prevSibling(child).map((function(sibling){return[node].concat(getLastChildren$1(sibling))})).getOr([]):[node].concat(getLastChildren$1(child))}))},hasAllContentsSelected=function(elm,rng){return lift2(function(rng){var sc=rng.startContainer,so=rng.startOffset;return isText$7(sc)?0===so?Optional.some(SugarElement.fromDom(sc)):Optional.none():Optional.from(sc.childNodes[so]).map(SugarElement.fromDom)}(rng),function(rng){var ec=rng.endContainer,eo=rng.endOffset;return isText$7(ec)?eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none():Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom)}(rng),(function(startNode,endNode){var start=find$3(getFirstChildren(elm),curry(eq,startNode)),end=find$3(getLastChildren$1(elm),curry(eq,endNode));return start.isSome()&&end.isSome()})).getOr(!1)},moveEndPoint=function(dom,rng,node,start){var root=node,walker=new DomTreeWalker(node,root),moveCaretBeforeOnEnterElementsMap=filter$3(dom.schema.getMoveCaretBeforeOnEnterElements(),(function(_,name){return!contains$3(["td","th","table"],name.toLowerCase())}));do{if(isText$7(node)&&0!==Tools.trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(moveCaretBeforeOnEnterElementsMap[node.nodeName])return void(start?rng.setStartBefore(node):"BR"===node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node))}while(node=start?walker.next():walker.prev());"BODY"===root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},hasAnyRanges=function(editor){var sel=editor.selection.getSel();return sel&&sel.rangeCount>0},runOnRanges=function(editor,executor){var fakeSelectionNodes=getCellsFromEditor(editor);fakeSelectionNodes.length>0?each$k(fakeSelectionNodes,(function(elem){var node=elem.dom,fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node),fakeNodeRng.setEndAfter(node),executor(fakeNodeRng,!0)})):executor(editor.selection.getRng(),!1)},preserve=function(selection,fillBookmark,executor){var bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark),selection.moveToBookmark(bookmark)},api$1=function(is,name){var getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()};return{get:function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText$8,"text"),get$2=function(element){return api$1.get(element)},context=function(editor,elem,wrapName,nodeName){return parent(elem).fold((function(){return"skipping"}),(function(parent){return"br"===nodeName||function(elem){return isText$8(elem)&&"\ufeff"===get$2(elem)}(elem)?"valid":function(elem){return isElement$6(elem)&&has(elem,annotation())}(elem)?"existing":isCaretNode(elem.dom)?"caret":isValid(editor,wrapName,nodeName)&&isValid(editor,name(parent),wrapName)?"valid":"invalid-child"}))},makeAnnotation=function(eDoc,_a,annotationName,decorate){var _b=_a.uid,uid=void 0===_b?generate("mce-annotation"):_b,data=function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}(_a,["uid"]),master=SugarElement.fromTag("span",eDoc);add$1(master,annotation()),set$1(master,""+dataAnnotationId(),uid),set$1(master,""+dataAnnotation(),annotationName);var _c=decorate(uid,data),_d=_c.attributes,attributes=void 0===_d?{}:_d,_e=_c.classes,classes=void 0===_e?[]:_e;return setAll$1(master,attributes),function(element,classes){each$k(classes,(function(x){add$1(element,x)}))}(master,classes),master},annotate=function(editor,rng,annotationName,decorate,data){var newWrappers=[],master=makeAnnotation(editor.getDoc(),data,annotationName,decorate),wrapper=value(),finishWrapper=function(){wrapper.clear()},processElements=function(elems){each$k(elems,processElement)},processElement=function(elem){switch(context(editor,elem,"span",name(elem))){case"invalid-child":finishWrapper();var children$1=children(elem);processElements(children$1),finishWrapper();break;case"valid":var w=wrapper.get().getOrThunk((function(){var nu=shallow(master);return newWrappers.push(nu),wrapper.set(nu),nu}));!function(element,wrapper){before$4(element,wrapper),append$1(wrapper,element)}(elem,w)}};return walk$2(editor.dom,rng,(function(nodes){finishWrapper(),function(nodes){var elems=map$3(nodes,SugarElement.fromDom);processElements(elems)}(nodes)})),newWrappers},annotateWithBookmark=function(editor,name,settings,data){editor.undoManager.transact((function(){var selection=editor.selection,initialRng=selection.getRng(),hasFakeSelection=getCellsFromEditor(editor).length>0;if(initialRng.collapsed&&!hasFakeSelection&&function(editor,rng){var r=expandRng(editor,rng,[{inline:"span"}]);rng.setStart(r.startContainer,r.startOffset),rng.setEnd(r.endContainer,r.endOffset),editor.selection.setRng(rng)}(editor,initialRng),selection.getRng().collapsed&&!hasFakeSelection){var wrapper=makeAnnotation(editor.getDoc(),data,name,settings.decorate);set(wrapper,""),selection.getRng().insertNode(wrapper.dom),selection.select(wrapper.dom)}else preserve(selection,!1,(function(){runOnRanges(editor,(function(selectionRng){annotate(editor,selectionRng,name,settings.decorate,data)}))}))}))},Annotator=function(editor){var annotations,registry=(annotations={},{register:function(name,settings){annotations[name]={name,settings}},lookup:function(name){return get$9(annotations,name).map((function(a){return a.settings}))}});setup$m(editor,registry);var changes=setup$n(editor);return{register:function(name,settings){registry.register(name,settings)},annotate:function(name,data){registry.lookup(name).each((function(settings){annotateWithBookmark(editor,name,settings,data)}))},annotationChanged:function(name,callback){changes.addListener(name,callback)},remove:function(name){identify(editor,Optional.some(name)).each((function(_a){var elements=_a.elements;each$k(elements,unwrap)}))},getAll:function(name){var directory=function(editor,name){var body=SugarElement.fromDom(editor.getBody()),markers=descendants(body,"["+dataAnnotation()+'="'+name+'"]'),directory={};return each$k(markers,(function(m){var uid=get$6(m,dataAnnotationId()),nodesAlready=get$9(directory,uid).getOr([]);directory[uid]=nodesAlready.concat([m])})),directory}(editor,name);return map$2(directory,(function(elems){return map$3(elems,(function(elem){return elem.dom}))}))}}},BookmarkManager=function(selection){return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)}};BookmarkManager.isBookmarkNode=isBookmarkNode$1;var getContentEditableRoot$1=function(root,node){for(;node&&node!==root;){if(isContentEditableTrue$4(node)||isContentEditableFalse$b(node))return node;node=node.parentNode}return null},isXYWithinRange=function(clientX,clientY,range){if(range.collapsed)return!1;if(Env.browser.isIE()&&range.startOffset===range.endOffset-1&&range.startContainer===range.endContainer){var elm=range.startContainer.childNodes[range.startOffset];if(isElement$5(elm))return exists(elm.getClientRects(),(function(rect){return containsXY(rect,clientX,clientY)}))}return exists(range.getClientRects(),(function(rect){return containsXY(rect,clientX,clientY)}))},fireError=function(editor,errorType,error){return editor.fire(errorType,error)},fireFormatApply=function(editor,format,node,vars){return editor.fire("FormatApply",{format,node,vars})},fireFormatRemove=function(editor,format,node,vars){return editor.fire("FormatRemove",{format,node,vars})},VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}},isContentEditableFalse$5=isContentEditableFalse$b,ControlSelection=function(selection,editor){var selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop,startX,startY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight,dom=editor.dom,each=Tools.each,editableDoc=editor.getDoc(),rootDocument=document,abs=Math.abs,round=Math.round,rootElement=editor.getBody(),resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},isImage=function(elm){return elm&&("IMG"===elm.nodeName||editor.dom.is(elm,"figure.image"))},isMedia=function(elm){return isMedia$2(elm)||dom.hasClass(elm,"mce-preview-object")},contextMenuSelectImage=function(evt){var target=evt.target;(function(evt,range){if("longpress"===evt.type||0===evt.type.indexOf("touch")){var touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range)}return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range)})(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()&&editor.selection.select(target)},getResizeTargets=function(elm){return dom.is(elm,"figure.image")?[elm.querySelector("img")]:dom.hasClass(elm,"mce-preview-object")&&isNonNullable(elm.firstElementChild)?[elm,elm.firstElementChild]:[elm]},isResizable=function(elm){var selector=getObjectResizing(editor);return!!selector&&("false"!==elm.getAttribute("data-mce-resize")&&(elm!==editor.getBody()&&(dom.hasClass(elm,"mce-preview-object")?is$2(SugarElement.fromDom(elm.firstElementChild),selector):is$2(SugarElement.fromDom(elm),selector))))},setSizeProp=function(element,name,value){if(isNonNullable(value)){var targets=getResizeTargets(element);each$k(targets,(function(target){target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)?dom.setStyle(target,name,value):dom.setAttrib(target,name,""+value)}))}},setGhostElmSize=function(ghostElm,width,height){setSizeProp(ghostElm,"width",width),setSizeProp(ghostElm,"height",height)},resizeGhostElement=function(e){var deltaX,deltaY,proportional,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,proportional=(isImage(selectedElm)||isMedia(selectedElm))&&!1!==function(editor){return editor.getParam("resize_img_proportional",!0,"boolean")}(editor)?!VK.modifierPressed(e):VK.modifierPressed(e),proportional&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),setGhostElmSize(selectedElmGhost,width,height),resizeHelperX=(resizeHelperX=selectedHandle.startPos.x+deltaX)>0?resizeHelperX:0,resizeHelperY=(resizeHelperY=selectedHandle.startPos.y+deltaY)>0?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",undefined+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",undefined+(startH-height)),(deltaX=rootElement.scrollWidth-startScrollWidth)+(deltaY=rootElement.scrollHeight-startScrollHeight)!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(!function(editor,target,width,height,origin){editor.fire("ObjectResizeStart",{target,width,height,origin})}(editor,selectedElm,startW,startH,"corner-"+selectedHandle.name),resizeStarted=!0)},endGhostResize=function(){var wasResizeStarted=resizeStarted;resizeStarted=!1,wasResizeStarted&&(setSizeProp(selectedElm,"width",width),setSizeProp(selectedElm,"height",height)),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),dom.remove(resizeBackdrop),showResizeRect(selectedElm),wasResizeStarted&&(!function(editor,target,width,height,origin){editor.fire("ObjectResized",{target,width,height,origin})}(editor,selectedElm,width,height,"corner-"+selectedHandle.name),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style"))),editor.nodeChanged()},showResizeRect=function(targetElm){unbindResizeHandleEvents();var position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top;selectedElm!==targetElm&&(hideResizeRect(),selectedElm=targetElm,width=height=0);var e=editor.fire("ObjectSelected",{target:targetElm}),selectedValue=dom.getAttrib(selectedElm,"data-mce-selected","1");isResizable(targetElm)&&!e.isDefaultPrevented()?each(resizeHandles,(function(handle,name){var handleElm,startDrag=function(e){var elm,target=getResizeTargets(selectedElm)[0];startX=e.screenX,startY=e.screenY,startW=target.clientWidth,startH=target.clientHeight,ratio=startH/startW,(selectedHandle=handle).name=name,selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,resizeBackdrop=dom.add(rootElement,"div",{class:"mce-resize-backdrop","data-mce-bogus":"all"}),dom.setStyles(resizeBackdrop,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}),selectedElmGhost=isMedia(elm=selectedElm)?dom.create("img",{src:Env.transparentSrc}):elm.cloneNode(!0),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable="false",dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),setGhostElmSize(selectedElmGhost,targetWidth,targetHeight),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)};(handleElm=dom.get("mceResizeHandle"+name))&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),11===Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",(function(e){e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)})),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2})})):hideResizeRect(),dom.getAttrib(selectedElm,"data-mce-selected")||selectedElm.setAttribute("data-mce-selected",selectedValue)},hideResizeRect=function(){unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute("data-mce-selected"),each$j(resizeHandles,(function(value,name){var handleElm=dom.get("mceResizeHandle"+name);handleElm&&(dom.unbind(handleElm),dom.remove(handleElm))}))},updateResizeRect=function(e){var controlElm,isChildOrEqual=function(node,parent){if(node)do{if(node===parent)return!0}while(node=node.parentNode)};resizeStarted||editor.removed||(each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),(function(img){img.removeAttribute("data-mce-selected")})),controlElm="mousedown"===e.type?e.target:selection.getNode(),isChildOrEqual(controlElm=dom.$(controlElm).closest("table,img,figure.image,hr,video,span.mce-preview-object")[0],rootElement)&&(disableGeckoResize(),isChildOrEqual(selection.getStart(!0),controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm))?showResizeRect(controlElm):hideResizeRect())},isWithinContentEditableFalse=function(elm){return isContentEditableFalse$5(getContentEditableRoot$1(editor.getBody(),elm))},unbindResizeHandleEvents=function(){each$j(resizeHandles,(function(handle){handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}))},disableGeckoResize=function(){try{editor.getDoc().execCommand("enableObjectResizing",!1,"false")}catch(ex){}};editor.on("init",(function(){if(disableGeckoResize(),Env.browser.isIE()||Env.browser.isEdge()){editor.on("mousedown click",(function(e){var target=e.target,nodeName=target.nodeName;resizeStarted||!/^(TABLE|IMG|HR)$/.test(nodeName)||isWithinContentEditableFalse(target)||(2!==e.button&&editor.selection.select(target,"TABLE"===nodeName),"mousedown"===e.type&&editor.nodeChanged())}));var handleMSControlSelect_1=function(e){var delayedSelect=function(node){Delay.setEditorTimeout(editor,(function(){return editor.selection.select(node)}))};if(isWithinContentEditableFalse(e.target)||isMedia$2(e.target))return e.preventDefault(),void delayedSelect(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"===e.target.tagName&&delayedSelect(e.target))};dom.bind(rootElement,"mscontrolselect",handleMSControlSelect_1),editor.on("remove",(function(){return dom.unbind(rootElement,"mscontrolselect",handleMSControlSelect_1)}))}var throttledUpdateResizeRect=Delay.throttle((function(e){editor.composing||updateResizeRect(e)}));editor.on("nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged",throttledUpdateResizeRect),editor.on("keyup compositionend",(function(e){selectedElm&&"TABLE"===selectedElm.nodeName&&throttledUpdateResizeRect(e)})),editor.on("hide blur",hideResizeRect),editor.on("contextmenu longpress",contextMenuSelectImage,!0)})),editor.on("remove",unbindResizeHandleEvents);return{isResizable,showResizeRect,hideResizeRect,updateResizeRect,destroy:function(){selectedElm=selectedElmGhost=resizeBackdrop=null}}},hasCeProperty=function(node){return isContentEditableTrue$4(node)||isContentEditableFalse$b(node)},fromPoint=function(clientX,clientY,doc){var rng,point,pointDoc=doc;if(pointDoc.caretPositionFromPoint)(point=pointDoc.caretPositionFromPoint(clientX,clientY))&&((rng=doc.createRange()).setStart(point.offsetNode,point.offset),rng.collapse(!0));else if(pointDoc.caretRangeFromPoint)rng=pointDoc.caretRangeFromPoint(clientX,clientY);else if(pointDoc.body.createTextRange){rng=pointDoc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=function(clientX,clientY,doc){var rects,element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange();if(element&&"HTML"!==element.tagName||(element=doc.body),rng.moveToElementText(element),(rects=(rects=Tools.toArray(rng.getClientRects())).sort((function(a,b){return(a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)))-Math.abs(Math.max(b.top-clientY,b.bottom-clientY))}))).length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null}(clientX,clientY,doc)}return function(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse$b(function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}(parentElement,rootNode,hasCeProperty))?null:rng}(rng,doc.body)}return rng},isEq$4=function(rng1,rng2){return rng1&&rng2&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset},hasParent$1=function(node,rootNode,predicate){return null!==function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}(node,rootNode,predicate)},hasParentWithName=function(node,rootNode,name){return hasParent$1(node,rootNode,(function(node){return node.nodeName===name}))},isTable=function(node){return node&&"TABLE"===node.nodeName},isTableCell$2=function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)},isCeFalseCaretContainer=function(node,rootNode){return isCaretContainer$2(node)&&!1===hasParent$1(node,rootNode,isCaretNode)},hasBrBeforeAfter=function(dom,node,left){for(var walker=new DomTreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());node=walker[left?"prev":"next"]();)if(isBr$5(node))return!0},findTextNodeRelative=function(dom,isAfterNode,collapsed,left,startNode){var lastInlineElement,node,body=dom.getRoot(),nonEmptyElementsMap=dom.schema.getNonEmptyElements(),parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&isBr$5(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer))return Optional.some(CaretPosition(startNode.parentNode,dom.nodeIndex(startNode)));for(var walker=new DomTreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCeFalseCaretContainer(node,body))return Optional.none();if(isText$7(node)&&node.nodeValue.length>0)return!1===hasParentWithName(node,body,"A")?Optional.some(CaretPosition(node,left?node.nodeValue.length:0)):Optional.none();if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return Optional.none();lastInlineElement=node}return collapsed&&lastInlineElement?Optional.some(CaretPosition(lastInlineElement,0)):Optional.none()},normalizeEndPoint=function(dom,collapsed,start,rng){var container,offset,node,directionLeft,body=dom.getRoot(),normalized=!1;container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"];var isAfterNode=isElement$5(container)&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements();if(directionLeft=start,isCaretContainer$2(container))return Optional.none();if(isElement$5(container)&&offset>container.childNodes.length-1&&(directionLeft=!1),isDocument$1(container)&&(container=body,offset=0),container===body){if(directionLeft&&(node=container.childNodes[offset>0?offset-1:0])){if(isCaretContainer$2(node))return Optional.none();if(nonEmptyElementsMap[node.nodeName]||isTable(node))return Optional.none()}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=isText$7(container)&&isAfterNode?container.data.length:0,!collapsed&&container===body.lastChild&&isTable(container))return Optional.none();if(function(body,node){for(;node&&node!==body;){if(isContentEditableFalse$b(node))return!0;node=node.parentNode}return!1}(body,container)||isCaretContainer$2(container))return Optional.none();if(container.hasChildNodes()&&!1===isTable(container)){node=container;var walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=!1;break}if(isText$7(node)&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell$2(node)){offset=dom.nodeIndex(node),container=node.parentNode,directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}return collapsed&&(isText$7(container)&&0===offset&&findTextNodeRelative(dom,isAfterNode,collapsed,!0,container).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),isElement$5(container)&&((node=container.childNodes[offset])||(node=container.childNodes[offset-1]),!node||!isBr$5(node)||function(node,name){return node.previousSibling&&node.previousSibling.nodeName===name}(node,"A")||hasBrBeforeAfter(dom,node,!1)||hasBrBeforeAfter(dom,node,!0)||findTextNodeRelative(dom,isAfterNode,collapsed,!0,node).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})))),directionLeft&&!collapsed&&isText$7(container)&&offset===container.nodeValue.length&&findTextNodeRelative(dom,isAfterNode,collapsed,!1,container).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),normalized?Optional.some(CaretPosition(container,offset)):Optional.none()},normalize$2=function(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange(),startPos=CaretPosition.fromRangeStart(rng);return normalizeEndPoint(dom,collapsed,!0,normRng).each((function(pos){collapsed&&CaretPosition.isAbove(startPos,pos)||normRng.setStart(pos.container(),pos.offset())})),collapsed||normalizeEndPoint(dom,collapsed,!1,normRng).each((function(pos){normRng.setEnd(pos.container(),pos.offset())})),collapsed&&normRng.collapse(!0),isEq$4(rng,normRng)?Optional.none():Optional.some(normRng)},splitText=function(node,offset){return node.splitText(offset)},split=function(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return startContainer===endContainer&&isText$7(startContainer)?startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=(endContainer=splitText(startContainer,startOffset)).previousSibling,endOffset>startOffset?(startContainer=endContainer=splitText(endContainer,endOffset-=startOffset).previousSibling,endOffset=endContainer.nodeValue.length,startOffset=0):endOffset=0):(isText$7(startContainer)&&startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),isText$7(endContainer)&&endOffset>0&&endOffset<endContainer.nodeValue.length&&(endOffset=(endContainer=splitText(endContainer,endOffset).previousSibling).nodeValue.length)),{startContainer,startOffset,endContainer,endOffset}},RangeUtils=function(dom){return{walk:function(rng,callback){return walk$2(dom,rng,callback)},split,normalize:function(rng){return normalize$2(dom,rng).fold(never,(function(normalizedRng){return rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset),rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset),!0}))}}};RangeUtils.compareRanges=isEq$4,RangeUtils.getCaretRangeFromPoint=fromPoint,RangeUtils.getSelectedNode=getSelectedNode,RangeUtils.getNode=getNode$1;var documentFocusInHandler,api=function(name,getOffset){var get=function(element){var r=getOffset(element);if(r<=0||null===r){var css=get$5(element,name);return parseFloat(css)||0}return r},aggregate=function(element,properties){return foldl(properties,(function(acc,property){var val=get$5(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0)};return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);var dom=element.dom;isSupported(dom)&&(dom.style[name]=h+"px")},get,getOuter:get,aggregate,max:function(element,value,properties){var cumulativeInclusions=aggregate(element,properties);return value>cumulativeInclusions?value-cumulativeInclusions:0}}}("height",(function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),walkUp=function(navigation,doc){return navigation.view(doc).fold(constant([]),(function(f){var parent=navigation.owner(f),rest=walkUp(navigation,parent);return[f].concat(rest)}))},Navigation=Object.freeze({__proto__:null,view:function(doc){var _a;return(doc.dom===document?Optional.none():Optional.from(null===(_a=doc.dom.defaultView)||void 0===_a?void 0:_a.frameElement)).map(SugarElement.fromDom)},owner:function(element){return documentOrOwner(element)}}),find$1=function(element){var doc=SugarElement.fromDom(document),scroll=get$8(doc),frames=function(element,navigation){var d=navigation.owner(element);return walkUp(navigation,d)}(element,Navigation),offset=viewport(element),r=foldr(frames,(function(b,a){var loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top}}),{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top)},excludeFromDescend=function(element){return"textarea"===name(element)},markerInfo=function(element,cleanupFun){var pos=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)}(element),height=function(element){return api.get(element)}(element);return{element,bottom:pos.top+height,height,pos,cleanup:cleanupFun}},createMarker=function(element,offset){var startPoint=function(element,offset){var children$1=children(element);if(0===children$1.length||excludeFromDescend(element))return{element,offset};if(offset<children$1.length&&!excludeFromDescend(children$1[offset]))return{element:children$1[offset],offset:0};var last=children$1[children$1.length-1];return excludeFromDescend(last)?{element,offset}:"img"===name(last)?{element:last,offset:1}:isText$8(last)?{element:last,offset:get$2(last).length}:{element:last,offset:children(last).length}}(element,offset),span=SugarElement.fromHtml('<span data-mce-bogus="all" style="display: inline-block;">\ufeff</span>');return before$4(startPoint.element,span),markerInfo(span,(function(){return remove$7(span)}))},withMarker=function(editor,f,rng,alignToTop){preserveWith(editor,(function(_s,_e){return applyWithMarker(editor,f,rng,alignToTop)}),rng)},withScrollEvents=function(editor,doc,f,marker,alignToTop){var data={elm:marker.element.dom,alignToTop};(function(editor,data){return editor.fire("ScrollIntoView",data).isDefaultPrevented()})(editor,data)||(f(doc,get$8(doc).top,marker,alignToTop),function(editor,data){editor.fire("AfterScrollIntoView",data)}(editor,data))},applyWithMarker=function(editor,f,rng,alignToTop){var body=SugarElement.fromDom(editor.getBody()),doc=SugarElement.fromDom(editor.getDoc());body.dom.offsetWidth;var marker=createMarker(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop),marker.cleanup()},withElement=function(editor,element,f,alignToTop){var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,function(element){return markerInfo(SugarElement.fromDom(element),noop)}(element),alignToTop)},preserveWith=function(editor,f,rng){var startElement=rng.startContainer,startOffset=rng.startOffset,endElement=rng.endContainer,endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));var newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset),newRng.setEnd(endElement,endOffset),editor.selection.setRng(rng)},scrollToMarker=function(marker,viewHeight,alignToTop,doc){var pos=marker.pos;if(alignToTop)to(pos.left,pos.top,doc);else{var y=pos.top-viewHeight+marker.height;to(pos.left,y,doc)}},intoWindowIfNeeded=function(doc,scrollTop,viewHeight,marker,alignToTop){var viewportBottom=viewHeight+scrollTop,markerTop=marker.pos.top,markerBottom=marker.bottom,largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop)scrollToMarker(marker,viewHeight,!1!==alignToTop,doc);else if(markerTop>viewportBottom){scrollToMarker(marker,viewHeight,largerThanViewport?!1!==alignToTop:!0===alignToTop,doc)}else markerBottom>viewportBottom&&!largerThanViewport&&scrollToMarker(marker,viewHeight,!0===alignToTop,doc)},intoWindow=function(doc,scrollTop,marker,alignToTop){var viewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop)},intoFrame=function(doc,scrollTop,marker,alignToTop){var frameViewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,frameViewHeight,marker,alignToTop);var op=find$1(marker.element),viewportBounds=getBounds(window);op.top<viewportBounds.y?intoView(marker.element,!1!==alignToTop):op.top>viewportBounds.bottom&&intoView(marker.element,!0===alignToTop)},rangeIntoWindow=function(editor,rng,alignToTop){return withMarker(editor,intoWindow,rng,alignToTop)},elementIntoWindow=function(editor,element,alignToTop){return withElement(editor,element,intoWindow,alignToTop)},rangeIntoFrame=function(editor,rng,alignToTop){return withMarker(editor,intoFrame,rng,alignToTop)},elementIntoFrame=function(editor,element,alignToTop){return withElement(editor,element,intoFrame,alignToTop)},scrollRangeIntoView=function(editor,rng,alignToTop){(editor.inline?rangeIntoWindow:rangeIntoFrame)(editor,rng,alignToTop)},hasFocus$1=function(element){var root=getRootNode(element).dom;return element.dom===root.activeElement},active=function(root){return void 0===root&&(root=SugarElement.fromDom(document)),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)},SimRange_create=function(start,soffset,finish,foffset){return{start,soffset,finish,foffset}},adt$1=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ_getStart=(adt$1.before,adt$1.on,adt$1.after,function(situ){return situ.fold(identity,identity,identity)}),adt=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt.domRange,relative:adt.relative,exact:adt.exact,exactFromRange:function(simRange){return adt.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){var start=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ_getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return defaultView(start)},range:SimRange_create},browser$1=detect().browser,clamp$1=function(offset,element){var max=isText$8(element)?get$2(element).length:children(element).length+1;return offset>max?max:offset<0?0:offset},normalizeRng=function(rng){return SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish))},isOrContains=function(root,elm){return!isRestrictedNode(elm.dom)&&(contains$1(root,elm)||eq(root,elm))},isRngInRoot=function(root){return function(rng){return isOrContains(root,rng.start)&&isOrContains(root,rng.finish)}},shouldStore=function(editor){return!0===editor.inline||browser$1.isIE()},nativeRangeToSelectionRange=function(r){return SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset)},getBookmark=function(root){return function(win){var selection=win.getSelection();return(selection&&0!==selection.rangeCount?Optional.from(selection.getRangeAt(0)):Optional.none()).map(nativeRangeToSelectionRange)}(defaultView(root).dom).filter(isRngInRoot(root))},bookmarkToNativeRng=function(bookmark){var rng=document.createRange();try{return rng.setStart(bookmark.start.dom,bookmark.soffset),rng.setEnd(bookmark.finish.dom,bookmark.foffset),Optional.some(rng)}catch(_){return Optional.none()}},store=function(editor){var newBookmark=shouldStore(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark},getRng=function(editor){return(editor.bookmark?editor.bookmark:Optional.none()).bind((function(x){return function(root,bookmark){return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng)}(SugarElement.fromDom(editor.getBody()),x)})).bind(bookmarkToNativeRng)},FocusManager={isEditorUIElement:function(elm){var className=elm.className.toString();return-1!==className.indexOf("tox-")||-1!==className.indexOf("mce-")}},registerEditorEvents=function(editor,throttledStore){detect().browser.isIE()?function(editor){editor.on("focusout",(function(){store(editor)}))}(editor):function(editor,throttledStore){editor.on("mouseup touchend",(function(_e){throttledStore.throttle()}))}(editor,throttledStore),editor.on("keyup NodeChange",(function(e){(function(e){return"nodechange"===e.type&&e.selectionChange})(e)||store(editor)}))},register$3=function(editor){var throttledStore=first((function(){store(editor)}),0);editor.on("init",(function(){editor.inline&&function(editor,throttledStore){var mouseUpPage=function(){throttledStore.throttle()};DOMUtils.DOM.bind(document,"mouseup",mouseUpPage),editor.on("remove",(function(){DOMUtils.DOM.unbind(document,"mouseup",mouseUpPage)}))}(editor,throttledStore),registerEditorEvents(editor,throttledStore)})),editor.on("remove",(function(){throttledStore.cancel()}))},DOM$8=DOMUtils.DOM,isUIElement=function(editor,elm){var customSelector=function(editor){return editor.getParam("custom_ui_selector","","string")}(editor),parent=DOM$8.getParent(elm,(function(elm){return function(elm){return FocusManager.isEditorUIElement(elm)}(elm)||!!customSelector&&editor.dom.is(elm,customSelector)}));return null!==parent},registerEvents$1=function(editorManager,e){var editor=e.editor;register$3(editor),editor.on("focusin",(function(){var focusedEditor=editorManager.focusedEditor;focusedEditor!==editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),editorManager.focusedEditor=editor,editor.fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0))})),editor.on("focusout",(function(){Delay.setEditorTimeout(editor,(function(){var focusedEditor=editorManager.focusedEditor;isUIElement(editor,function(editor){try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active(root).fold((function(){return document.body}),(function(x){return x.dom}))}catch(ex){return document.body}}(editor))||focusedEditor!==editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null)}))})),documentFocusInHandler||(documentFocusInHandler=function(e){var activeEditor=editorManager.activeEditor;activeEditor&&function(event){if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$6(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)}(e).each((function(target){target.ownerDocument===document&&(target===document.body||isUIElement(activeEditor,target)||editorManager.focusedEditor!==activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null))}))},DOM$8.bind(document,"focusin",documentFocusInHandler))},unregisterDocumentEvents=function(editorManager,e){editorManager.focusedEditor===e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM$8.unbind(document,"focusin",documentFocusInHandler),documentFocusInHandler=null)},getFocusInElement=function(root,rng){return function(rng){return rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none()}(rng).bind((function(node){return isTableSection(node)?Optional.some(node):!1===contains$1(root,node)?Optional.some(root):Optional.none()}))},normalizeSelection$1=function(editor,rng){getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind((function(elm){return firstPositionIn(elm.dom)})).fold((function(){editor.selection.normalize()}),(function(caretPos){return editor.selection.setRng(caretPos.toRange())}))},focusBody=function(body){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus()},hasElementFocus=function(elm){return hasFocus$1(elm)||(element=elm,active(getRootNode(element)).filter((function(e){return element.dom.contains(e.dom)}))).isSome();var element},hasFocus=function(editor){return editor.inline?function(editor){var rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody))}(editor):function(editor){return editor.iframeElement&&hasFocus$1(SugarElement.fromDom(editor.iframeElement))}(editor)},hasEditorOrUiFocus=function(editor){return hasFocus(editor)||function(editor){var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active(dos).filter((function(elem){return!(void 0!==(classList=elem.dom.classList)&&(classList.contains("tox-edit-area")||classList.contains("tox-edit-area__iframe")||classList.contains("mce-content-body")))&&isUIElement(editor,elem.dom);var classList})).isSome()}(editor)},activateEditor=function(editor){return editor.editorManager.setActive(editor)},focus=function(editor,skipFocus){editor.removed||(skipFocus?activateEditor(editor):function(editor){var selection=editor.selection,body=editor.getBody(),rng=selection.getRng();editor.quirks.refreshContentEditable(),void 0!==editor.bookmark&&!1===hasFocus(editor)&&getRng(editor).each((function(bookmarkRng){editor.selection.setRng(bookmarkRng),rng=bookmarkRng}));var contentEditableHost=function(editor,node){return editor.dom.getParent(node,(function(node){return"true"===editor.dom.getContentEditable(node)}))}(editor,selection.getNode());if(editor.$.contains(body,contentEditableHost))return focusBody(contentEditableHost),normalizeSelection$1(editor,rng),void activateEditor(editor);editor.inline||(Env.opera||focusBody(body),editor.getWin().focus()),(Env.gecko||editor.inline)&&(focusBody(body),normalizeSelection$1(editor,rng)),activateEditor(editor)}(editor))},getEndpointElement=function(root,rng,start,real,resolve){var container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map((function(elm){return real&&rng.collapsed?elm:child$1(elm,resolve(elm,offset)).getOr(elm)})).bind((function(elm){return isElement$6(elm)?Optional.some(elm):parent(elm).filter(isElement$6)})).map((function(elm){return elm.dom})).getOr(root)},getStart=function(root,rng,real){return getEndpointElement(root,rng,!0,real,(function(elm,offset){return Math.min(childNodesCount(elm),offset)}))},getEnd=function(root,rng,real){return getEndpointElement(root,rng,!1,real,(function(elm,offset){return offset>0?offset-1:offset}))},skipEmptyTextNodes=function(node,forwards){for(var orig=node;node&&isText$7(node)&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig},processRanges=function(editor,ranges){return map$3(ranges,(function(range){var evt=editor.fire("GetSelectionRange",{range});return evt.range!==range?evt.range:range}))},typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},walk$1=function(node,root,prev){var startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==root){var sibling=node[siblingName];if(sibling)return sibling;for(var parent_1=node.parent;parent_1&&parent_1!==root;parent_1=parent_1.parent)if(sibling=parent_1[siblingName])return sibling}},isEmptyTextNode=function(node){if(!isWhitespaceText(node.value))return!1;var parentNode=node.parent;return!parentNode||"span"===parentNode.name&&!parentNode.attr("style")||!/^[ ]+$/.test(node.value)},isNonEmptyElement=function(node){var isNamedAnchor="a"===node.name&&!node.attr("href")&&node.attr("id");return node.attr("name")||node.attr("id")&&!node.firstChild||node.attr("data-mce-bookmark")||isNamedAnchor},AstNode=function(){function AstNode(name,type){this.name=name,this.type=type,1===type&&(this.attributes=[],this.attributes.map={})}return AstNode.create=function(name,attrs){var node=new AstNode(name,typeLookup[name]||1);return attrs&&each$j(attrs,(function(value,attrName){node.attr(attrName,value)})),node},AstNode.prototype.replace=function(node){return node.parent&&node.remove(),this.insert(node,this),this.remove(),this},AstNode.prototype.attr=function(name,value){var attrs,self=this;if("string"!=typeof name)return null!=name&&each$j(name,(function(value,key){self.attr(key,value)})),self;if(attrs=self.attributes){if(void 0!==value){if(null===value){if(name in attrs.map){delete attrs.map[name];for(var i=attrs.length;i--;)if(attrs[i].name===name)return attrs.splice(i,1),self}return self}if(name in attrs.map){for(i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name,value});return attrs.map[name]=value,self}return attrs.map[name]}},AstNode.prototype.clone=function(){var selfAttrs,clone=new AstNode(this.name,this.type);if(selfAttrs=this.attributes){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];"id"!==selfAttr.name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value)}clone.attributes=cloneAttrs}return clone.value=this.value,clone.shortEnded=this.shortEnded,clone},AstNode.prototype.wrap=function(wrapper){return this.parent.insert(wrapper,this),wrapper.append(this),this},AstNode.prototype.unwrap=function(){for(var node=this.firstChild;node;){var next=node.next;this.insert(node,this,!0),node=next}this.remove()},AstNode.prototype.remove=function(){var parent=this.parent,next=this.next,prev=this.prev;return parent&&(parent.firstChild===this?(parent.firstChild=next,next&&(next.prev=null)):prev.next=next,parent.lastChild===this?(parent.lastChild=prev,prev&&(prev.next=null)):next.prev=prev,this.parent=this.next=this.prev=null),this},AstNode.prototype.append=function(node){node.parent&&node.remove();var last=this.lastChild;return last?(last.next=node,node.prev=last,this.lastChild=node):this.lastChild=this.firstChild=node,node.parent=this,node},AstNode.prototype.insert=function(node,refNode,before){node.parent&&node.remove();var parent=refNode.parent||this;return before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev.next=node,node.prev=refNode.prev,node.next=refNode,refNode.prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next.prev=node,node.next=refNode.next,node.prev=refNode,refNode.next=node),node.parent=parent,node},AstNode.prototype.getAll=function(name){for(var collection=[],node=this.firstChild;node;node=walk$1(node,this))node.name===name&&collection.push(node);return collection},AstNode.prototype.children=function(){for(var collection=[],node=this.firstChild;node;node=node.next)collection.push(node);return collection},AstNode.prototype.empty=function(){if(this.firstChild){for(var nodes=[],node=this.firstChild;node;node=walk$1(node,this))nodes.push(node);for(var i=nodes.length;i--;){(node=nodes[i]).parent=node.firstChild=node.lastChild=node.next=node.prev=null}}return this.firstChild=this.lastChild=null,this},AstNode.prototype.isEmpty=function(elements,whitespace,predicate){void 0===whitespace&&(whitespace={});var node=this.firstChild;if(isNonEmptyElement(this))return!1;if(node)do{if(1===node.type){if(node.attr("data-mce-bogus"))continue;if(elements[node.name])return!1;if(isNonEmptyElement(node))return!1}if(8===node.type)return!1;if(3===node.type&&!isEmptyTextNode(node))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(node.value))return!1;if(predicate&&predicate(node))return!1}while(node=walk$1(node,this));return!0},AstNode.prototype.walk=function(prev){return walk$1(this,null,prev)},AstNode}(),restoreDataUris=function(html,result){return html.replace(result.re,(function(imageId){return get$9(result.uris,imageId).getOr(imageId)}))},each$d=Tools.each,trim=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25},safeSvgDataUrlElements=["img","video"],isInvalidUri=function(settings,uri,tagName){return!settings.allow_html_data_urls&&(/^data:image\//i.test(uri)?function(allowSvgDataUrls,tagName){return isNonNullable(allowSvgDataUrls)?!allowSvgDataUrls:!isNonNullable(tagName)||!contains$3(safeSvgDataUrlElements,tagName)}(settings.allow_svg_data_urls,tagName)&&/^data:image\/svg\+xml/i.test(uri):/^data:/i.test(uri))},URI=function(){function URI(url,settings){url=trim(url),this.settings=settings||{};var baseUri=this.settings.base_uri,self=this;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))self.source=url;else{var isProtocolRelative=0===url.indexOf("//");if(0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+url),!/^[\w\-]*:?\/\//.test(url)){var baseUrl=this.settings.base_uri?this.settings.base_uri.path:new URI(document.location.href).directory;if(this.settings.base_uri&&""==this.settings.base_uri.protocol)url="//mce_host"+self.toAbsPath(baseUrl,url);else{var match=/([^#?]*)([#?]?.*)/.exec(url);url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,match[1])+match[2]}}url=url.replace(/@@/g,"(mce_at)");var urlMatch=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?(\[[a-zA-Z0-9:.%]+\]|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each$d(queryParts,(function(v,i){var part=urlMatch[i];part&&(part=part.replace(/\(mce_at\)/g,"@@")),self[v]=part})),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}}return URI.parseDataUri=function(uri){var type,uriComponents=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriComponents[0]);return matches&&(type=matches[1]),{type,data:uriComponents[1]}},URI.isDomSafe=function(uri,context,options){if(void 0===options&&(options={}),options.allow_script_urls)return!0;var decodedUri=Entities.decode(uri).replace(/[\s\u0000-\u001F]+/g,"");try{decodedUri=decodeURIComponent(decodedUri)}catch(ex){decodedUri=unescape(decodedUri)}return!/((java|vb)script|mhtml):/i.test(decodedUri)&&!isInvalidUri(options,decodedUri,context)},URI.getDocumentBaseUrl=function(loc){var baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl},URI.prototype.setPath=function(path){var pathMatch=/^(.*?)\/?(\w+)?$/.exec(path);this.path=pathMatch[0],this.directory=pathMatch[1],this.file=pathMatch[2],this.source="",this.getURI()},URI.prototype.toRelative=function(uri){var output;if("./"===uri)return uri;var relativeUri=new URI(uri,{base_uri:this});if("mce_host"!==relativeUri.host&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&""!==relativeUri.protocol)return relativeUri.getURI();var tu=this.getURI(),uu=relativeUri.getURI();return tu===uu||"/"===tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)===uu?tu:(output=this.toRelPath(this.path,relativeUri.path),relativeUri.query&&(output+="?"+relativeUri.query),relativeUri.anchor&&(output+="#"+relativeUri.anchor),output)},URI.prototype.toAbsolute=function(uri,noHost){var absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri))},URI.prototype.isSameOrigin=function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},URI.prototype.toRelPath=function(base,path){var i,l,breakPoint=0,out="",normalizedBase=base.substring(0,base.lastIndexOf("/")).split("/"),items=path.split("/");if(normalizedBase.length>=items.length)for(i=0,l=normalizedBase.length;i<l;i++)if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(normalizedBase.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!==breakPoint-1?"/"+items[i]:items[i];return out},URI.prototype.toAbsPath=function(base,path){var i,outPath,nb=0,o=[],tr=/\/$/.test(path)?"/":"",normalizedBase=base.split("/"),normalizedPath=path.split("/");for(each$d(normalizedBase,(function(k){k&&o.push(k)})),normalizedBase=o,i=normalizedPath.length-1,o=[];i>=0;i--)0!==normalizedPath[i].length&&"."!==normalizedPath[i]&&(".."!==normalizedPath[i]?nb>0?nb--:o.push(normalizedPath[i]):nb++);return 0!==(outPath=(i=normalizedBase.length-nb)<=0?reverse(o).join("/"):normalizedBase.slice(0,i).join("/")+"/"+reverse(o).join("/")).indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath},URI.prototype.getURI=function(noProtoHost){var s;return void 0===noProtoHost&&(noProtoHost=!1),this.source&&!noProtoHost||(s="",noProtoHost||(this.protocol?s+=this.protocol+"://":s+="//",this.userInfo&&(s+=this.userInfo+"@"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port)),this.path&&(s+=this.path),this.query&&(s+="?"+this.query),this.anchor&&(s+="#"+this.anchor),this.source=s),this.source},URI}(),filteredClobberElements=Tools.makeMap("button,fieldset,form,iframe,img,image,input,object,output,select,textarea"),findMatchingEndTagIndex=function(schema,html,startIndex){for(var startTagRegExp=/<([!?\/])?([A-Za-z0-9\-_:.]+)/g,endTagRegExp=/(?:\s(?:[^'">]+(?:"[^"]*"|'[^']*'))*[^"'>]*(?:"[^">]*|'[^'>]*)?|\s*|\/)>/g,shortEndedElements=schema.getShortEndedElements(),count=1,index=startIndex;0!==count;)for(startTagRegExp.lastIndex=index;;){var startMatch=startTagRegExp.exec(html);if(null===startMatch)return index;if("!"===startMatch[1]){index=startsWith(startMatch[2],"--")?findCommentEndIndex(html,!1,startMatch.index+"!--".length):findCommentEndIndex(html,!0,startMatch.index+1);break}endTagRegExp.lastIndex=startTagRegExp.lastIndex;var endMatch=endTagRegExp.exec(html);if(!isNull(endMatch)&&endMatch.index===startTagRegExp.lastIndex){"/"===startMatch[1]?count-=1:has$2(shortEndedElements,startMatch[2])||(count+=1),index=startTagRegExp.lastIndex+endMatch[0].length;break}}return index},findCommentEndIndex=function(html,isBogus,startIndex){void 0===startIndex&&(startIndex=0);var lcHtml=html.toLowerCase();if(-1!==lcHtml.indexOf("[if ",startIndex)&&function(html,startIndex){return/^\s*\[if [\w\W]+\]>.*<!\[endif\](--!?)?>/.test(html.substr(startIndex))}(lcHtml,startIndex)){var endIfIndex=lcHtml.indexOf("[endif]",startIndex);return lcHtml.indexOf(">",endIfIndex)}if(isBogus){var endIndex=lcHtml.indexOf(">",startIndex);return-1!==endIndex?endIndex:lcHtml.length}var endCommentRegexp=/--!?>/g;endCommentRegexp.lastIndex=startIndex;var match=endCommentRegexp.exec(html);return match?match.index+match[0].length:lcHtml.length},checkBogusAttribute=function(regExp,attrString){var matches=regExp.exec(attrString);if(matches){var name_1=matches[1],value=matches[2];return"string"==typeof name_1&&"data-mce-bogus"===name_1.toLowerCase()?value:null}return null},SaxParser=function(settings,schema){var _a;void 0===schema&&(schema=Schema());var doc=null!==(_a=(settings=settings||{}).document)&&void 0!==_a?_a:document,form=doc.createElement("form");!1!==settings.fix_self_closing&&(settings.fix_self_closing=!0);var comment=settings.comment?settings.comment:noop,cdata=settings.cdata?settings.cdata:noop,text=settings.text?settings.text:noop,start=settings.start?settings.start:noop,end=settings.end?settings.end:noop,pi=settings.pi?settings.pi:noop,doctype=settings.doctype?settings.doctype:noop,parseInternal=function(base64Extract,format){void 0===format&&(format="html");for(var matches,value,endRegExp,attrList,i,textData,name,isInternalElement,isShortEnded,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,attrValue,html=base64Extract.html,index=0,stack=[],idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,action,formaction,poster,xlink:href"),parsingMode="html"===format?0:1,processEndTag=function(name){var pos,i;for(pos=stack.length;pos--&&stack[pos].name!==name;);if(pos>=0){for(i=stack.length-1;i>=pos;i--)(name=stack[i]).valid&&end(name.name);stack.length=pos}},processText=function(value,raw){return text(restoreDataUris(value,base64Extract),raw)},processComment=function(value){""!==value&&(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3).toLowerCase()||(value=" "+value),comment(restoreDataUris(value,base64Extract)))},processMalformedComment=function(value,startIndex){var startTag=value||"",isBogus=!startsWith(startTag,"--"),endIndex=findCommentEndIndex(html,isBogus,startIndex);return value=html.substr(startIndex,endIndex-startIndex),processComment(isBogus?startTag+value:value),endIndex+1},parseAttribute=function(tagName,name,value,val2,val3){if(value=function(value){return restoreDataUris(value,base64Extract)}((name=name.toLowerCase())in fillAttrsMap?name:decode(value||val2||val3||"")),validate&&!isInternalElement&&!1===function(name){return 0===name.indexOf("data-")||0===name.indexOf("aria-")}(name)){var attrRule=validAttributesMap[name];if(!attrRule&&validAttributePatterns){for(var i_1=validAttributePatterns.length;i_1--&&!(attrRule=validAttributePatterns[i_1]).pattern.test(name););-1===i_1&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}("name"===name||"id"===name)&&tagName in filteredClobberElements&&(value in doc||value in form)||filteredUrlAttrs[name]&&!URI.isDomSafe(value,tagName,settings)||isInternalElement&&(name in filteredUrlAttrs||0===name.indexOf("on"))||(attrList.map[name]=value,attrList.push({name,value}))},tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)--!?>)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\w\\W]*?)>)|(?:!(--)?)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_:.]*)(\\s(?:[^'\">]+(?:\"[^\"]*\"|'[^']*'))*[^\"'>]*(?:\"[^\">]*|'[^'>]*)?|\\s*|\\/)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements(),processHtml=html+">";matches=tokenRegExp.exec(processHtml);){var matchText=matches[0];if(index<matches.index&&processText(decode(html.substr(index,matches.index-index))),value=matches[7])":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),processEndTag(value);else if(value=matches[8]){if(matches.index+matchText.length>html.length){processText(decode(html.substr(matches.index))),index=matches.index+matchText.length;continue}":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),isShortEnded=value in shortEndedElements,fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value&&processEndTag(value);var bogusValue=checkBogusAttribute(attrRegExp,matches[9]);if(null!==bogusValue){if("all"===bogusValue){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}if(!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[9])?((isInternalElement=-1!==attribsValue.indexOf("data-mce-type"))&&removeInternalElements&&(isValidElement=!1),(attrList=[]).map={},attribsValue.replace(attrRegExp,(function(match,name,val,val2,val3){return parseAttribute(value,name,val,val2,val3),""}))):(attrList=[]).map={},validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,elementRule.removeEmptyAttrs&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)name=(attr=attributesForced[i]).name,"{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)(name=(attr=attributesDefault[i]).name)in attrList.map||("{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););-1===i&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&start(value,attrList,isShortEnded)}else isValidElement=!1;if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matchText.length,(matches=endRegExp.exec(html))?(isValidElement&&(textData=html.substr(index,matches.index-index)),index=matches.index+matches[0].length):(textData=html.substr(index),index=html.length),isValidElement&&(textData.length>0&&processText(textData,!0),end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")===attribsValue.length-1?isValidElement&&end(value):stack.push({name:value,valid:isValidElement}))}else if(value=matches[1])processComment(value);else if(value=matches[2]){if(!(1===parsingMode||settings.preserve_cdata||stack.length>0&&schema.isValidChild(stack[stack.length-1].name,"#cdata"))){index=processMalformedComment("",matches.index+2),tokenRegExp.lastIndex=index;continue}cdata(value)}else if(value=matches[3])doctype(value);else{if((value=matches[4])||"<!"===matchText){index=processMalformedComment(value,matches.index+matchText.length),tokenRegExp.lastIndex=index;continue}if(value=matches[5]){if(1!==parsingMode){index=processMalformedComment("?",matches.index+2),tokenRegExp.lastIndex=index;continue}pi(value,matches[6])}}index=matches.index+matchText.length}for(index<html.length&&processText(decode(html.substr(index))),i=stack.length-1;i>=0;i--)(value=stack[i]).valid&&end(value.name)};return{parse:function(html,format){void 0===format&&(format="html"),parseInternal(function(html){for(var matches,dataImageUri=/data:[^;<"'\s]+;base64,([a-z0-9\+\/=\s]+)/gi,chunks=[],uris={},prefix=generate("img"),index=0,count=0;matches=dataImageUri.exec(html);){var uri=matches[0],imageId=prefix+"_"+count++;uris[imageId]=uri,index<matches.index&&chunks.push(html.substr(index,matches.index-index)),chunks.push(imageId),index=matches.index+uri.length}var re=new RegExp(prefix+"_[0-9]+","g");return 0===index?{prefix,uris,html,re}:(index<html.length&&chunks.push(html.substr(index)),{prefix,uris,html:chunks.join(""),re})}(html),format)}}};SaxParser.findEndTag=findMatchingEndTagIndex;var trimInternal=function(serializer,html){for(var matches,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,schema=serializer.schema,content=function(tempAttrs,html){var trimContentRegExp=new RegExp(["\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html.replace(trimContentRegExp,"")}(serializer.getTempAttrs(),html),shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);){var index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=void 0;endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex),bogusAllRegExp.lastIndex=index-matchLength}return trim$2(content)},trimExternal=trimInternal,getContentFromBody=function(editor,args,format,body){var content,defaultedArgs=function(args,format){return __assign(__assign({},args),{format,get:!0,getInner:!0})}(args,format),updatedArgs=args.no_events?defaultedArgs:editor.fire("BeforeGetContent",defaultedArgs);return content="raw"===updatedArgs.format?Tools.trim(trimExternal(editor.serializer,body.innerHTML)):"text"===updatedArgs.format?editor.dom.isEmpty(body)?"":trim$2(body.innerText||body.textContent):"tree"===updatedArgs.format?editor.serializer.serialize(body,updatedArgs):function(editor,html){var blockName=getForcedRootBlock(editor),emptyRegExp=new RegExp("^(<"+blockName+"[^>]*>(&nbsp;|&#160;|\\s||<br \\/>|)<\\/"+blockName+">[\r\n]*|<br \\/>[\r\n]*)$");return html.replace(emptyRegExp,"")}(editor,editor.serializer.serialize(body,updatedArgs)),contains$3(["text","tree"],updatedArgs.format)||isWsPreserveElement(SugarElement.fromDom(body))?updatedArgs.content=content:updatedArgs.content=Tools.trim(content),updatedArgs.no_events?updatedArgs.content:editor.fire("GetContent",updatedArgs).content},each$c=Tools.each,ElementUtils=function(dom){return{compare:function(node1,node2){if(node1.nodeName!==node2.nodeName)return!1;var getAttribs=function(node){var attribs={};return each$c(dom.getAttribs(node),(function(attr){var name=attr.nodeName.toLowerCase();0!==name.indexOf("_")&&"style"!==name&&0!==name.indexOf("data-")&&(attribs[name]=dom.getAttrib(node,name))})),attribs},compareObjects=function(obj1,obj2){var value,name;for(name in obj1)if(has$2(obj1,name)){if(void 0===(value=obj2[name]))return!1;if(obj1[name]!==value)return!1;delete obj2[name]}for(name in obj2)if(has$2(obj2,name))return!1;return!0};return!!compareObjects(getAttribs(node1),getAttribs(node2))&&(!!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))&&(!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2)))}}},makeMap$1=Tools.makeMap,Writer=function(settings){var html=[],indent=(settings=settings||{}).indent,indentBefore=makeMap$1(settings.indent_before||""),indentAfter=makeMap$1(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"===settings.element_format;return{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n"),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},end:function(name){var value;html.push("</",name,">"),indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},text:function(text,raw){text.length>0&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("\x3c!--",text,"--\x3e")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}},HtmlSerializer=function(settings,schema){void 0===schema&&(schema=Schema());var writer=Writer(settings);(settings=settings||{}).validate=!("validate"in settings)||settings.validate;return{serialize:function(node){var validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)do{walk(node)}while(node=node.next)}};writer.reset();var walk=function(node){var handler=handlers[node.type];if(handler)handler(node);else{var name_1=node.name,isEmpty=node.shortEnded,attrs=node.attributes;if(validate&&attrs&&attrs.length>1){var sortedAttrs=[];sortedAttrs.map={};var elementRule=schema.getElementRule(node.name);if(elementRule){for(var i=0,l=elementRule.attributesOrder.length;i<l;i++){if((attrName=elementRule.attributesOrder[i])in attrs.map){var attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue})}}for(i=0,l=attrs.length;i<l;i++){var attrName;if(!((attrName=attrs[i].name)in sortedAttrs.map)){attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue})}}attrs=sortedAttrs}}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)do{walk(node)}while(node=node.next);writer.end(name_1)}}};return 1!==node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}},nonInheritableStyles=new Set;each$k(["margin","margin-left","margin-right","margin-top","margin-bottom","padding","padding-left","padding-right","padding-top","padding-bottom","border","border-width","border-style","border-color","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","float","position","left","right","top","bottom","z-index","display","transform","width","max-width","min-width","height","max-height","min-height","overflow","overflow-x","overflow-y","text-overflow","vertical-align","transition","transition-delay","transition-duration","transition-property","transition-timing-function"],(function(style){nonInheritableStyles.add(style)}));var shorthandStyleProps=["font","text-decoration","text-emphasis"],getStyleProps=function(dom,node){return keys(dom.parseStyle(dom.getAttrib(node,"style")))},hasInheritableStyles=function(dom,node){return forall(getStyleProps(dom,node),(function(style){return!function(style){return nonInheritableStyles.has(style)}(style)}))},hasStyleConflict=function(dom,node,parentNode){var nodeStyleProps=getStyleProps(dom,node),parentNodeStyleProps=getStyleProps(dom,parentNode),valueMismatch=function(prop){var nodeValue=dom.getStyle(node,prop),parentValue=dom.getStyle(parentNode,prop);return isNotEmpty(nodeValue)&&isNotEmpty(parentValue)&&nodeValue!==parentValue};return exists(nodeStyleProps,(function(nodeStyleProp){var propExists=function(props){return exists(props,(function(prop){return prop===nodeStyleProp}))};if(!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)){var longhandProps=filter$4(parentNodeStyleProps,(function(style){return exists(shorthandStyleProps,(function(prop){return startsWith(style,prop)}))}));return exists(longhandProps,valueMismatch)}return valueMismatch(nodeStyleProp)}))},isChar=function(forward,predicate,pos){return Optional.from(pos.container()).filter(isText$7).exists((function(text){var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta))}))},isBeforeSpace=curry(isChar,!0,isWhiteSpace),isAfterSpace=curry(isChar,!1,isWhiteSpace),isEmptyText=function(pos){var container=pos.container();return isText$7(container)&&(0===container.data.length||isZwsp(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode))},matchesElementPosition=function(before,predicate){return function(pos){return Optional.from(getChildNodeAtRelativeOffset(before?0:-1,pos)).filter(predicate).isSome()}},isImageBlock=function(node){return isImg(node)&&"block"===get$5(SugarElement.fromDom(node),"display")},isCefNode=function(node){return isContentEditableFalse$b(node)&&!function(node){return isElement$5(node)&&"all"===node.getAttribute("data-mce-bogus")}(node)},isBeforeImageBlock=matchesElementPosition(!0,isImageBlock),isAfterImageBlock=matchesElementPosition(!1,isImageBlock),isBeforeMedia=matchesElementPosition(!0,isMedia$2),isAfterMedia=matchesElementPosition(!1,isMedia$2),isBeforeTable=matchesElementPosition(!0,isTable$3),isAfterTable=matchesElementPosition(!1,isTable$3),isBeforeContentEditableFalse=matchesElementPosition(!0,isCefNode),isAfterContentEditableFalse=matchesElementPosition(!1,isCefNode),removeTrailingBr=function(elm){var allBrs=descendants(elm,"br"),brs=filter$4(function(elm){for(var children=[],rawNode=elm.dom;rawNode;)children.push(SugarElement.fromDom(rawNode)),rawNode=rawNode.lastChild;return children}(elm).slice(-1),isBr$4);allBrs.length===brs.length&&each$k(brs,remove$7)},fillWithPaddingBr=function(elm){empty(elm),append$1(elm,SugarElement.fromHtml('<br data-mce-bogus="1">'))},trimBlockTrailingBr=function(elm){lastChild(elm).each((function(lastChild){prevSibling(lastChild).each((function(lastChildPrevSibling){isBlock$2(elm)&&isBr$4(lastChild)&&isBlock$2(lastChildPrevSibling)&&remove$7(lastChild)}))}))},parentsUntil=function(start,root,predicate){return contains$1(root,start)?(xs=function(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret}(start,(function(elm){return predicate(elm)||eq(elm,root)})),xs.slice(0,-1)):[];var xs},parents=function(start,root){return parentsUntil(start,root,never)},parentsAndSelf=function(start,root){return[start].concat(parents(start,root))},navigateIgnoreEmptyTextNodes=function(forward,root,from){return navigateIgnore(forward,root,from,isEmptyText)},getClosestBlock$1=function(root,pos){return find$3(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2)},isAtBeforeAfterBlockBoundary=function(forward,root,pos){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((function(newPos){return getClosestBlock$1(root,pos).fold((function(){return!1===isInSameBlock(newPos,pos,root.dom)}),(function(fromBlock){return!1===isInSameBlock(newPos,pos,root.dom)&&contains$1(fromBlock,SugarElement.fromDom(newPos.container()))}))}))},isAtBlockBoundary=function(forward,root,pos){return getClosestBlock$1(root,pos).fold((function(){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((function(newPos){return!1===isInSameBlock(newPos,pos,root.dom)}))}),(function(parent){return navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone()}))},isAtStartOfBlock=curry(isAtBlockBoundary,!1),isAtEndOfBlock=curry(isAtBlockBoundary,!0),isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,!1),isAfterBlock=curry(isAtBeforeAfterBlockBoundary,!0),isBr=function(pos){return getElementFromPosition(pos).exists(isBr$4)},findBr=function(forward,root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2),scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr)},isBeforeBr$1=function(root,pos){return getElementFromPosition(pos).exists(isBr$4)||findBr(!0,root,pos).isSome()},isAfterBr=function(root,pos){return function(pos){return Optional.from(pos.getNode(!0)).map(SugarElement.fromDom)}(pos).exists(isBr$4)||findBr(!1,root,pos).isSome()},findPreviousBr=curry(findBr,!1),findNextBr=curry(findBr,!0),isInMiddleOfText=function(pos){return CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd()},getClosestBlock=function(root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);return head(parentBlocks).getOr(root)},hasSpaceBefore=function(root,pos){return isInMiddleOfText(pos)?isAfterSpace(pos):isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos).dom,pos).exists(isAfterSpace)},hasSpaceAfter=function(root,pos){return isInMiddleOfText(pos)?isBeforeSpace(pos):isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos).dom,pos).exists(isBeforeSpace)},isInPre=function(pos){return getElementFromPosition(pos).bind((function(elm){return closest$3(elm,isElement$6)})).exists((function(elm){return function(value){return contains$3(["pre","pre-wrap"],value)}(get$5(elm,"white-space"))}))},isAtLineBoundary=function(root,pos){return function(root,pos){return prevPosition(root.dom,pos).isNone()}(root,pos)||function(root,pos){return nextPosition(root.dom,pos).isNone()}(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr$1(root,pos)},needsToBeNbspLeft=function(root,pos){return!isInPre(pos)&&(isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos))},needsToBeNbspRight=function(root,pos){return!isInPre(pos)&&(isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr$1(root,pos)||hasSpaceAfter(root,pos))},needsToBeNbsp=function(root,pos){return needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,function(pos){var container=pos.container(),offset=pos.offset();return isText$7(container)&&offset<container.data.length?CaretPosition(container,offset+1):pos}(pos))},isNbspAt=function(text,offset){return isNbsp(text.charAt(offset))},hasNbsp=function(pos){var container=pos.container();return isText$7(container)&&contains$2(container.data,"")},normalizeNbspInMiddleOfTextNode=function(node){var text=node.data,newText=function(text){var chars=text.split("");return map$3(chars,(function(chr,i){return isNbsp(chr)&&i>0&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])?" ":chr})).join("")}(text);return newText!==text&&(node.data=newText,!0)},normalizeNbsps=function(root,pos){return Optional.some(pos).filter(hasNbsp).bind((function(pos){var container=pos.container(),normalized=function(root,node){var text=node.data,firstPos=CaretPosition(node,0);return!(!isNbspAt(text,0)||needsToBeNbsp(root,firstPos)||(node.data=" "+text.slice(1),0))}(root,container)||normalizeNbspInMiddleOfTextNode(container)||function(root,node){var text=node.data,lastPos=CaretPosition(node,text.length-1);return!(!isNbspAt(text,text.length-1)||needsToBeNbsp(root,lastPos)||(node.data=text.slice(0,-1)+" ",0))}(root,container);return normalized?Optional.some(pos):Optional.none()}))},normalizeNbspsInEditor=function(editor){var root=SugarElement.fromDom(editor.getBody());editor.selection.isCollapsed()&&normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng())).each((function(pos){editor.selection.setRng(pos.toRange())}))},normalize$1=function(node,offset,count){if(0!==count){var elm=SugarElement.fromDom(node),root=ancestor$3(elm,isBlock$2).getOr(elm),whitespace=node.data.slice(offset,offset+count),isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,CaretPosition(node,node.data.length)),isStartOfContent=0===offset&&needsToBeNbspLeft(root,CaretPosition(node,0));node.replaceData(offset,count,function(content,isStartOfContent,isEndOfContent){return foldl(content,(function(acc,c){return isWhiteSpace(c)||isNbsp(c)?acc.previousCharIsSpace||""===acc.str&&isStartOfContent||acc.str.length===content.length-1&&isEndOfContent?{previousCharIsSpace:!1,str:acc.str+""}:{previousCharIsSpace:!0,str:acc.str+" "}:{previousCharIsSpace:!1,str:acc.str+c}}),{previousCharIsSpace:!1,str:""}).str}(whitespace,isStartOfContent,isEndOfContent))}},normalizeWhitespaceAfter=function(node,offset){var content=node.data.slice(offset),whitespaceCount=content.length-lTrim(content).length;normalize$1(node,offset,whitespaceCount)},normalizeWhitespaceBefore=function(node,offset){var content=node.data.slice(0,offset),whitespaceCount=content.length-rTrim(content).length;normalize$1(node,offset-whitespaceCount,whitespaceCount)},mergeTextNodes=function(prevNode,nextNode,normalizeWhitespace,mergeToPrev){void 0===mergeToPrev&&(mergeToPrev=!0);var whitespaceOffset=rTrim(prevNode.data).length,newNode=mergeToPrev?prevNode:nextNode,removeNode=mergeToPrev?nextNode:prevNode;return mergeToPrev?newNode.appendData(removeNode.data):newNode.insertData(0,removeNode.data),remove$7(SugarElement.fromDom(removeNode)),normalizeWhitespace&&normalizeWhitespaceAfter(newNode,whitespaceOffset),newNode},reposition=function(elm,pos){return function(pos,elm){var container=pos.container(),offset=pos.offset();return!1===CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()}(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos},getPreviousSiblingCaretPosition=function(elm){return isCaretCandidate$3(elm.previousSibling)?Optional.some((node=elm.previousSibling,isText$7(node)?CaretPosition(node,node.data.length):CaretPosition.after(node))):elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();var node},getNextSiblingCaretPosition=function(elm){return isCaretCandidate$3(elm.nextSibling)?Optional.some((node=elm.nextSibling,isText$7(node)?CaretPosition(node,0):CaretPosition.before(node))):elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();var node},findCaretPositionBackwards=function(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk((function(){return getNextSiblingCaretPosition(elm)})).orThunk((function(){return function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return prevPosition(rootElement,startPosition).fold((function(){return nextPosition(rootElement,CaretPosition.after(elm))}),Optional.some)}(rootElement,elm)}))},findCaretPositionForward=function(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk((function(){return getPreviousSiblingCaretPosition(elm)})).orThunk((function(){return function(rootElement,elm){return nextPosition(rootElement,CaretPosition.after(elm)).fold((function(){return prevPosition(rootElement,CaretPosition.before(elm))}),Optional.some)}(rootElement,elm)}))},findCaretPosOutsideElmAfterDelete=function(forward,rootElement,elm){return function(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm)}(forward,rootElement,elm).map(curry(reposition,elm))},setSelection$1=function(editor,forward,pos){pos.fold((function(){editor.focus()}),(function(pos){editor.selection.setRng(pos.toRange(),forward)}))},isBlock=function(editor,elm){return elm&&has$2(editor.schema.getBlockElements(),name(elm))},paddEmptyBlock=function(elm){if(isEmpty$2(elm)){var br=SugarElement.fromHtml('<br data-mce-bogus="1">');return empty(elm),append$1(elm,br),Optional.some(CaretPosition.before(br.dom))}return Optional.none()},deleteNormalized=function(elm,afterDeletePosOpt,normalizeWhitespace){var oa,ob,oc,f,prevTextOpt=prevSibling(elm).filter(isText$8),nextTextOpt=nextSibling(elm).filter(isText$8);return remove$7(elm),(oa=prevTextOpt,ob=nextTextOpt,oc=afterDeletePosOpt,f=function(prev,next,pos){var prevNode=prev.dom,nextNode=next.dom,offset=prevNode.data.length;return mergeTextNodes(prevNode,nextNode,normalizeWhitespace),pos.container()===nextNode?CaretPosition(prevNode,offset):pos},oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()).orThunk((function(){return normalizeWhitespace&&(prevTextOpt.each((function(elm){return normalizeWhitespaceBefore(elm.dom,elm.dom.length)})),nextTextOpt.each((function(elm){return normalizeWhitespaceAfter(elm.dom,0)}))),afterDeletePosOpt}))},deleteElement$2=function(editor,forward,elm,moveCaret){void 0===moveCaret&&(moveCaret=!0);var rawNode,afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom),parentBlock=ancestor$3(elm,curry(isBlock,editor),(rawNode=editor.getBody(),function(elm){return elm.dom===rawNode})),normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,function(editor,element){return has$2(editor.schema.getTextInlineElements(),name(element))}(editor,elm));editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),editor.selection.setCursorLocation()):parentBlock.bind(paddEmptyBlock).fold((function(){moveCaret&&setSelection$1(editor,forward,normalizedAfterDeletePos)}),(function(paddPos){moveCaret&&setSelection$1(editor,forward,Optional.some(paddPos))}))},getTableCells=function(table){return descendants(table,"td,th")},tableCellRng=function(start,end){return{start,end}},deleteAction=Adt_generate([{singleCellTable:["rng","cell"]},{fullTable:["table"]},{partialTable:["cells","outsideDetails"]},{multiTable:["startTableCells","endTableCells","betweenRng"]}]),getClosestCell$1=function(container,isRoot){return closest$2(SugarElement.fromDom(container),"td,th",isRoot)},isExpandedCellRng=function(cellRng){return!eq(cellRng.start,cellRng.end)},getTableFromCellRng=function(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind((function(startParentTable){return getClosestTable(cellRng.end,isRoot).bind((function(endParentTable){return b=eq(startParentTable,endParentTable),a=startParentTable,b?Optional.some(a):Optional.none();var b,a}))}))},getTableSelectionFromCellRng=function(isRoot){return function(cellRng){return getTableFromCellRng(cellRng,isRoot).map((function(table){return function(rng,table,cells){return{rng,table,cells}}(cellRng,table,getTableCells(table))}))}},getTableSelections=function(cellRng,selectionDetails,rng,isRoot){if(rng.collapsed||!cellRng.forall(isExpandedCellRng))return Optional.none();if(selectionDetails.isSameTable){var sameTableSelection=cellRng.bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:sameTableSelection,end:sameTableSelection})}var startCell=getClosestCell$1(rng.startContainer,isRoot),endCell=getClosestCell$1(rng.endContainer,isRoot),startTableSelection=startCell.bind(function(isRoot){return function(startCell){return getClosestTable(startCell,isRoot).bind((function(table){return last$2(getTableCells(table)).map((function(endCell){return tableCellRng(startCell,endCell)}))}))}}(isRoot)).bind(getTableSelectionFromCellRng(isRoot)),endTableSelection=endCell.bind(function(isRoot){return function(endCell){return getClosestTable(endCell,isRoot).bind((function(table){return head(getTableCells(table)).map((function(startCell){return tableCellRng(startCell,endCell)}))}))}}(isRoot)).bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:startTableSelection,end:endTableSelection})},getCellIndex=function(cells,cell){return findIndex$2(cells,(function(x){return eq(x,cell)}))},getSelectedCells=function(tableSelection){return lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),(function(startIndex,endIndex){return tableSelection.cells.slice(startIndex,endIndex+1)}))},isSingleCellTableContentSelected=function(optCellRng,rng,isRoot){return optCellRng.exists((function(cellRng){return function(cellRng,isRoot){return!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists((function(table){var rows=table.dom.rows;return 1===rows.length&&1===rows[0].cells.length}))}(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng)}))},unselectCells=function(rng,selectionDetails){var startTable=selectionDetails.startTable,endTable=selectionDetails.endTable,otherContentRng=rng.cloneRange();return startTable.each((function(table){return otherContentRng.setStartAfter(table.dom)})),endTable.each((function(table){return otherContentRng.setEndBefore(table.dom)})),otherContentRng},getActionFromRange=function(root,rng){var isRoot=function(root){return function(cur){return eq(root,cur)}}(root),optCellRng=function(rng,isRoot){var startCell=getClosestCell$1(rng.startContainer,isRoot),endCell=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng)}(rng,isRoot),selectionDetails=function(rng,isRoot){var getTable=function(node){return getClosestTable(SugarElement.fromDom(node),isRoot)},startTable=getTable(rng.startContainer),endTable=getTable(rng.endContainer),isStartInTable=startTable.isSome(),isEndInTable=endTable.isSome(),isSameTable=lift2(startTable,endTable,eq).getOr(!1);return{startTable,endTable,isStartInTable,isEndInTable,isSameTable,isMultiTable:!isSameTable&&isStartInTable&&isEndInTable}}(rng,isRoot);return isSingleCellTableContentSelected(optCellRng,rng,isRoot)?optCellRng.map((function(cellRng){return deleteAction.singleCellTable(rng,cellRng.start)})):selectionDetails.isMultiTable?function(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind((function(_a){var start=_a.start,end=_a.end,startTableSelectedCells=start.bind(getSelectedCells).getOr([]),endTableSelectedCells=end.bind(getSelectedCells).getOr([]);if(startTableSelectedCells.length>0&&endTableSelectedCells.length>0){var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.multiTable(startTableSelectedCells,endTableSelectedCells,otherContentRng))}return Optional.none()}))}(optCellRng,selectionDetails,rng,isRoot):function(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind((function(_a){var start=_a.start,end=_a.end;return start.or(end)})).bind((function(tableSelection){var isSameTable=selectionDetails.isSameTable,selectedCells=getSelectedCells(tableSelection).getOr([]);if(isSameTable&&tableSelection.cells.length===selectedCells.length)return Optional.some(deleteAction.fullTable(tableSelection.table));if(selectedCells.length>0){if(isSameTable)return Optional.some(deleteAction.partialTable(selectedCells,Optional.none()));var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.partialTable(selectedCells,Optional.some(__assign(__assign({},selectionDetails),{rng:otherContentRng}))))}return Optional.none()}))}(optCellRng,selectionDetails,rng,isRoot)},freefallRtl=function(root){var element;return(8===type(element=root)||"#comment"===name(element)?prevSibling(root):lastChild(root)).bind(freefallRtl).orThunk((function(){return Optional.some(root)}))},cleanCells=function(cells){return each$k(cells,(function(cell){remove$6(cell,"contenteditable"),fillWithPaddingBr(cell)}))},deleteContentInsideCell=function(editor,cell,rng,isFirstCellInSelection){var insideTableRng=rng.cloneRange();isFirstCellInSelection?(insideTableRng.setStart(rng.startContainer,rng.startOffset),insideTableRng.setEndAfter(cell.dom.lastChild)):(insideTableRng.setStartBefore(cell.dom.firstChild),insideTableRng.setEnd(rng.endContainer,rng.endOffset)),deleteCellContents(editor,insideTableRng,cell,!1)},collapseAndRestoreCellSelection=function(editor){var selectedCells=getCellsFromEditor(editor),selectedNode=SugarElement.fromDom(editor.selection.getNode());isTableCell$5(selectedNode.dom)&&isEmpty$2(selectedNode)?editor.selection.setCursorLocation(selectedNode.dom,0):editor.selection.collapse(!0),selectedCells.length>1&&exists(selectedCells,(function(cell){return eq(cell,selectedNode)}))&&set$1(selectedNode,"data-mce-selected","1")},emptySingleTableCells=function(editor,cells,outsideDetails){var editorRng=editor.selection.getRng(),cellsToClean=outsideDetails.bind((function(_a){var rng=_a.rng,isStartInTable=_a.isStartInTable,outsideBlock=function(editor,container){return Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom)}(editor,isStartInTable?rng.endContainer:rng.startContainer);rng.deleteContents(),function(editor,startInTable,emptyBlock){emptyBlock.each((function(block){startInTable?remove$7(block):(fillWithPaddingBr(block),editor.selection.setCursorLocation(block.dom,0))}))}(editor,isStartInTable,outsideBlock.filter(isEmpty$2));var endPointCell=isStartInTable?cells[0]:cells[cells.length-1];return deleteContentInsideCell(editor,endPointCell,editorRng,isStartInTable),isEmpty$2(endPointCell)?Optional.none():Optional.some(isStartInTable?cells.slice(1):cells.slice(0,-1))})).getOr(cells);return cleanCells(cellsToClean),collapseAndRestoreCellSelection(editor),!0},emptyMultiTableCells=function(editor,startTableCells,endTableCells,betweenRng){var rng=editor.selection.getRng(),startCell=startTableCells[0],endCell=endTableCells[endTableCells.length-1];deleteContentInsideCell(editor,startCell,rng,!0),deleteContentInsideCell(editor,endCell,rng,!1);var startTableCellsToClean=isEmpty$2(startCell)?startTableCells:startTableCells.slice(1),endTableCellsToClean=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);return cleanCells(startTableCellsToClean.concat(endTableCellsToClean)),betweenRng.deleteContents(),collapseAndRestoreCellSelection(editor),!0},deleteCellContents=function(editor,rng,cell,moveSelection){void 0===moveSelection&&(moveSelection=!0),rng.deleteContents();var element,lastNode=freefallRtl(cell).getOr(cell),lastBlock=SugarElement.fromDom(editor.dom.getParent(lastNode.dom,editor.dom.isBlock));if(isEmpty$2(lastBlock)&&(fillWithPaddingBr(lastBlock),moveSelection&&editor.selection.setCursorLocation(lastBlock.dom,0)),!eq(cell,lastBlock)){var additionalCleanupNodes=is$1(parent(lastBlock),cell)?[]:parent(element=lastBlock).map(children).map((function(elements){return filter$4(elements,(function(x){return!eq(element,x)}))})).getOr([]);each$k(additionalCleanupNodes.concat(children(cell)),(function(node){eq(node,lastBlock)||contains$1(node,lastBlock)||!isEmpty$2(node)||remove$7(node)}))}return!0},deleteTableElement=function(editor,table){return deleteElement$2(editor,!1,table),!0},deleteTableRange=function(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold((function(){return function(editor,rootElm,rng){return getActionFromRange(rootElm,rng).map((function(action){return action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor))}))}(editor,rootElm,rng)}),(function(caption){return function(editor,caption){return emptyElement(editor,caption)}(editor,caption)})).getOr(!1)},getParentCell=function(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),isTableCell$4)},getParentCaption=function(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),(tag="caption",function(e){return isElement$6(e)&&name(e)===tag}));var tag},emptyElement=function(editor,elm){return fillWithPaddingBr(elm),editor.selection.setCursorLocation(elm.dom,0),Optional.some(!0)},deleteCaretInsideCaption=function(editor,rootElm,forward,fromCaption,from){return navigate(forward,editor.getBody(),from).bind((function(to){return function(fromCaption,forward,from,to){return firstPositionIn(fromCaption.dom).bind((function(first){return lastPositionIn(fromCaption.dom).map((function(last){return forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first)}))})).getOr(!0)}(fromCaption,forward,from,to)?function(editor,elm){return emptyElement(editor,elm)}(editor,fromCaption):function(rootElm,fromCaption,to){return getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).map((function(toCaption){return!1===eq(toCaption,fromCaption)}))}(rootElm,fromCaption,to)})).or(Optional.some(!0))},deleteCaretCells=function(editor,forward,rootElm,startElm){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind((function(fromCell){return isEmpty$2(fromCell)?emptyElement(editor,fromCell):function(editor,rootElm,forward,fromCell,from){return navigate(forward,editor.getBody(),from).bind((function(to){return getParentCell(rootElm,SugarElement.fromDom(to.getNode())).map((function(toCell){return!1===eq(toCell,fromCell)}))}))}(editor,rootElm,forward,fromCell,from)})).getOr(!1)},isNearTable=function(forward,pos){return forward?isBeforeTable(pos):isAfterTable(pos)},deleteCaret$3=function(editor,forward,startElm){var rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold((function(){return deleteCaretCells(editor,forward,rootElm,startElm)||function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists((function(pos){return isNearTable(forward,pos)}))}(editor,forward)}),(function(fromCaption){return function(editor,forward,rootElm,fromCaption){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from)}(editor,forward,rootElm,fromCaption).getOr(!1)}))},backspaceDelete$9=function(editor,forward){var startElm=SugarElement.fromDom(editor.selection.getStart(!0)),cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&0===cells.length?deleteCaret$3(editor,forward,startElm):function(editor,startElm,selectedCells){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return 0!==selectedCells.length?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm)}(editor,startElm,cells)},normalizeBlockSelectionRange=function(rng){var startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return fromPosition(!1,rootNode,endPos).map((function(newEndPos){return!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)?function(sc,so,ec,eo){var rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng}(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng})).getOr(rng)},normalize=function(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng)},isListItemPadded=function(node){return node&&node.firstChild&&node.firstChild===node.lastChild&&function(node){return""===node.data||isBr$5(node)}(node.firstChild)},trimListItems=function(elms){return elms.length>0&&(!(elm=elms[elms.length-1]).firstChild||isListItemPadded(elm))?elms.slice(0,-1):elms;var elm},getParentLi=function(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&"LI"===parentBlock.nodeName?parentBlock:null},findLastOf=function(node,rootNode){var caretPos=CaretPosition.after(node),newCaretPos=CaretWalker(rootNode).prev(caretPos);return newCaretPos?newCaretPos.toRange():null},insertBefore$1=function(target,elms,rootNode){var parentElm=target.parentNode;return Tools.each(elms,(function(elm){parentElm.insertBefore(elm,target)})),function(node,rootNode){var caretPos=CaretPosition.before(node),newCaretPos=CaretWalker(rootNode).next(caretPos);return newCaretPos?newCaretPos.toRange():null}(target,rootNode)},insertAtCaret$1=function(serializer,dom,rng,fragment){var elm,domFragment=function(dom,serializer,fragment){var html=serializer.serialize(fragment);return function(domFragment){var firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&firstChild.parentNode.removeChild(firstChild),lastChild&&"mce_marker"===lastChild.id&&lastChild.parentNode.removeChild(lastChild),domFragment}(dom.createFragment(html))}(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),liElms=trimListItems((elm=domFragment.firstChild,filter$4(elm.childNodes,(function(child){return"LI"===child.nodeName})))),rootNode=dom.getRoot(),isAt=function(location){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=CaretWalker(dom.getRoot()),newPos=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos);return!newPos||getParentLi(dom,newPos.getNode())!==liTarget};return isAt(1)?insertBefore$1(liTarget,liElms,rootNode):isAt(2)?function(target,elms,rootNode,dom){return dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)}(liTarget,liElms,rootNode,dom):function(target,elms,rootNode,rng){var parts=function(parentNode,rng){var beforeRng=rng.cloneRange(),afterRng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),afterRng.setEndAfter(parentNode),[beforeRng.cloneContents(),afterRng.cloneContents()]}(target,rng),parentElm=target.parentNode;return parentElm.insertBefore(parts[0],target),Tools.each(elms,(function(li){parentElm.insertBefore(li,target)})),parentElm.insertBefore(parts[1],target),parentElm.removeChild(target),findLastOf(elms[elms.length-1],rootNode)}(liTarget,liElms,rootNode,rng)},isTableCell$1=isTableCell$5,deleteSelectedContent=function(editor){var dom=editor.dom,rng=normalize(editor.selection.getRng());editor.selection.setRng(rng);var startCell=dom.getParent(rng.startContainer,isTableCell$1);!function(dom,rng,cell){return null!==cell&&cell===dom.getParent(rng.endContainer,isTableCell$1)&&hasAllContentsSelected(SugarElement.fromDom(cell),rng)}(dom,rng,startCell)?editor.getDoc().execCommand("Delete",!1,null):deleteCellContents(editor,rng,SugarElement.fromDom(startCell))},insertHtmlAtCaret=function(editor,value,details){var parentNode,rng,node,selection=editor.selection,dom=editor.dom;/^ | $/.test(value)&&(value=function(dom,rng,html){var root=SugarElement.fromDom(dom.getRoot());return html=needsToBeNbspLeft(root,CaretPosition.fromRangeStart(rng))?html.replace(/^ /,"&nbsp;"):html.replace(/^&nbsp;/," "),needsToBeNbspRight(root,CaretPosition.fromRangeEnd(rng))?html.replace(/(&nbsp;| )(<br( \/)>)?$/,"&nbsp;"):html.replace(/&nbsp;(<br( \/)?>)?$/," ")}(dom,selection.getRng(),value));var parser=editor.parser,merge=details.merge,serializer=HtmlSerializer({validate:shouldValidate(editor)},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>',args=editor.fire("BeforeSetContent",{content:value,format:"html",selection:!0,paste:details.paste});if(args.isDefaultPrevented())editor.fire("SetContent",{content:args.content,format:"html",selection:!0,paste:details.paste});else{-1===(value=args.content).indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);var caretElement=(rng=selection.getRng()).startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&function(editor,node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}(editor,body.firstChild)&&dom.isEmpty(body.firstChild)&&((rng=dom.createRng()).setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||deleteSelectedContent(editor);var elm,parserArgs={context:(parentNode=selection.getNode()).nodeName.toLowerCase(),data:details.data,insert:!0},fragment=parser.parse(value,parserArgs);if(!0===details.paste&&function(schema,fragment){var firstChild=fragment.firstChild,lastChild=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),lastChild&&"mce_marker"===lastChild.attr("id")&&(lastChild=lastChild.prev),function(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node&&(node.isEmpty(nonEmptyElements)||function(schema,node){return schema.getBlockElements()[node.name]&&function(node){return node.firstChild&&node.firstChild===node.lastChild}(node)&&function(node){return"br"===node.name||""===node.value}(node.firstChild)}(schema,node))}(schema,lastChild)&&(lastChild=lastChild.prev),!(!firstChild||firstChild!==lastChild||"ul"!==firstChild.name&&"ol"!==firstChild.name)}(editor.schema,fragment)&&function(dom,node){return!!getParentLi(dom,node)}(dom,parentNode))return rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment),selection.setRng(rng),void editor.fire("SetContent",args);if(function(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")}(fragment),"mce_marker"===(node=fragment.lastChild).attr("id")){var marker=node;for(node=node.prev;node;node=node.walk(!0))if(3===node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid){editor.selection.setContent(bookmarkHtml),parentNode=selection.getNode();var rootNode=editor.getBody();for(9===parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)parentNode=node,node=node.parentNode;value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,(function(){return serializer.serialize(fragment)})))),parentNode===rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else!function(editor,value,parentNode){if("all"===parentNode.getAttribute("data-mce-bogus"))parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);else{var node=parentNode.firstChild,node2=parentNode.lastChild;!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value)}}(editor,value=serializer.serialize(fragment),parentNode);!function(editor,merge){var textInlineElements=editor.schema.getTextInlineElements(),dom=editor.dom;if(merge){var root_1=editor.getBody(),elementUtils_1=ElementUtils(dom);Tools.each(dom.select("*[data-mce-fragment]"),(function(node){if(isNonNullable(textInlineElements[node.nodeName.toLowerCase()])&&hasInheritableStyles(dom,node))for(var parentNode=node.parentNode;isNonNullable(parentNode)&&parentNode!==root_1&&!hasStyleConflict(dom,node,parentNode);parentNode=parentNode.parentNode)if(elementUtils_1.compare(parentNode,node)){dom.remove(node,!0);break}}))}}(editor,merge),function(editor,marker){var nextRng,dom=editor.dom,selection=editor.selection;if(marker){selection.scrollIntoView(marker);var parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if("false"===dom.getContentEditable(parentEditableElm))return dom.remove(marker),void selection.select(parentEditableElm);var rng=dom.createRng(),node=marker.previousSibling;if(isText$7(node)){if(rng.setStart(node,node.nodeValue.length),!Env.ie){var node2=marker.nextSibling;isText$7(node2)&&(node.appendData(node2.data),node2.parentNode.removeChild(node2))}}else rng.setStartBefore(marker),rng.setEndBefore(marker);var parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)&&(editor.$(parentBlock).empty(),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isTableCell$1(parentBlock)||function(node){return!!node.getAttribute("data-mce-fragment")}(parentBlock)||!(nextRng=function(rng){var caretPos=CaretPosition.fromRangeStart(rng);if(caretPos=CaretWalker(editor.getBody()).next(caretPos))return caretPos.toRange()}(rng))?dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))),selection.setRng(rng)}}(editor,dom.get("mce_marker")),elm=editor.getBody(),Tools.each(elm.getElementsByTagName("*"),(function(elm){elm.removeAttribute("data-mce-fragment")})),function(dom,elm){Optional.from(dom.getParent(elm,"td,th")).map(SugarElement.fromDom).each(trimBlockTrailingBr)}(dom,selection.getStart()),editor.fire("SetContent",args),editor.addVisual()}},traverse=function(node,fn){fn(node),node.firstChild&&traverse(node.firstChild,fn),node.next&&traverse(node.next,fn)},filter$1=function(nodeFilters,attributeFilters,node){var matches=function(nodeFilters,attributeFilters,node){var nodeMatches={},attrMatches={},matches=[];for(var name_1 in node.firstChild&&traverse(node.firstChild,(function(node){each$k(nodeFilters,(function(filter){filter.name===node.name&&(nodeMatches[filter.name]?nodeMatches[filter.name].nodes.push(node):nodeMatches[filter.name]={filter,nodes:[node]})})),each$k(attributeFilters,(function(filter){"string"==typeof node.attr(filter.name)&&(attrMatches[filter.name]?attrMatches[filter.name].nodes.push(node):attrMatches[filter.name]={filter,nodes:[node]})}))})),nodeMatches)has$2(nodeMatches,name_1)&&matches.push(nodeMatches[name_1]);for(var name_2 in attrMatches)has$2(attrMatches,name_2)&&matches.push(attrMatches[name_2]);return matches}(nodeFilters,attributeFilters,node);each$k(matches,(function(match){each$k(match.filter.callbacks,(function(callback){callback(match.nodes,match.filter.name,{})}))}))},isTreeNode=function(content){return content instanceof AstNode},setEditorHtml=function(editor,html,noSelection){editor.dom.setHTML(editor.getBody(),html),!0!==noSelection&&function(editor){hasFocus(editor)&&firstPositionIn(editor.getBody()).each((function(pos){var node=pos.getNode(),caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange())}))}(editor)},setContentInternal=function(editor,content,args){var defaultedArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,content:isTreeNode(content)?"":content})}(args,content),updatedArgs=args.no_events?defaultedArgs:editor.fire("BeforeSetContent",defaultedArgs);return isTreeNode(content)||(content=updatedArgs.content),Optional.from(editor.getBody()).fold(constant(content),(function(body){return isTreeNode(content)?function(editor,body,content,args){filter$1(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:editor.validate},editor.schema).serialize(content);return args.content=isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html),setEditorHtml(editor,args.content,args.no_selection),args.no_events||editor.fire("SetContent",args),content}(editor,body,content,updatedArgs):function(editor,body,content,args){if(0===content.length||/^\s+$/.test(content)){var padd='<br data-mce-bogus="1">';"TABLE"===body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>");var forcedRootBlockName=getForcedRootBlock(editor);forcedRootBlockName&&editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content)):content||(content='<br data-mce-bogus="1">'),setEditorHtml(editor,content,args.no_selection),editor.fire("SetContent",args)}else"raw"!==args.format&&(content=HtmlSerializer({validate:editor.validate},editor.schema).serialize(editor.parser.parse(content,{isRootContent:!0,insert:!0}))),args.content=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content),setEditorHtml(editor,args.content,args.no_selection),args.no_events||editor.fire("SetContent",args);return args.content}(editor,body,content,updatedArgs)}))},sibling=function(scope,predicate){return function(scope,predicate){var element=scope.dom;return element.parentNode?child(SugarElement.fromDom(element.parentNode),(function(x){return!eq(scope,x)&&predicate(x)})):Optional.none()}(scope,predicate).isSome()},ensureIsRoot=function(isRoot){return isFunction(isRoot)?isRoot:never},closest$1=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk((function(){return stop(scope)?Optional.none():function(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()}(scope,transform,stop)}))},isEq$3=isEq$5,matchesUnInheritedFormatSelector=function(ed,node,name){var formatList=ed.formatter.get(name);if(formatList)for(var i=0;i<formatList.length;i++){var format=formatList[i];if(isSelectorFormat(format)&&!1===format.inherit&&ed.dom.is(node,format.selector))return!0}return!1},matchParents=function(editor,node,name,vars,similar){var root=editor.dom.getRoot();return node!==root&&(node=editor.dom.getParent(node,(function(node){return!!matchesUnInheritedFormatSelector(editor,node,name)||(node.parentNode===root||!!matchNode(editor,node,name,vars,!0))})),!!matchNode(editor,node,name,vars,similar))},matchName$1=function(dom,node,format){return!!isEq$3(node,format.inline)||(!!isEq$3(node,format.block)||(format.selector?1===node.nodeType&&dom.is(node,format.selector):void 0))},matchItems=function(dom,node,format,itemName,similar,vars){var items=format[itemName];if(isFunction(format.onmatch))return format.onmatch(node,format,itemName);if(items)if(isUndefined(items.length)){for(var key in items)if(has$2(items,key)){var value="attributes"===itemName?dom.getAttrib(node,key):getStyle(dom,node,key),expectedValue=replaceVars(items[key],vars),isEmptyValue=isNullable(value)||isEmpty$3(value);if(isEmptyValue&&isNullable(expectedValue))continue;if(similar&&isEmptyValue&&!format.exact)return!1;if((!similar||format.exact)&&!isEq$3(value,normalizeStyleValue(dom,expectedValue,key)))return!1}}else for(var i=0;i<items.length;i++)if("attributes"===itemName?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i]))return!0;return!0},matchNode=function(ed,node,name,vars,similar){var formatList=ed.formatter.get(name),dom=ed.dom;if(formatList&&node)for(var i=0;i<formatList.length;i++){var format=formatList[i];if(matchName$1(ed.dom,node,format)&&matchItems(dom,node,format,"attributes",similar,vars)&&matchItems(dom,node,format,"styles",similar,vars)){var classes=format.classes;if(classes)for(var x=0;x<classes.length;x++)if(!ed.dom.hasClass(node,replaceVars(classes[x],vars)))return;return format}}},match$2=function(editor,name,vars,node,similar){if(node)return matchParents(editor,node,name,vars,similar);if(node=editor.selection.getNode(),matchParents(editor,node,name,vars,similar))return!0;var startNode=editor.selection.getStart();return!(startNode===node||!matchParents(editor,startNode,name,vars,similar))},closest=function(editor,names){var isRoot=function(elm){return eq(elm,SugarElement.fromDom(editor.getBody()))};return Optional.from(editor.selection.getStart(!0)).bind((function(rawElm){return closest$1(SugarElement.fromDom(rawElm),(function(elm){return findMap(names,(function(name){return function(elm,name){return matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none()}(elm,name)}))}),isRoot)})).getOrNull()},matchAllOnNode=function(editor,node,formatNames){return foldl(formatNames,(function(acc,name){var matchSimilar=function(editor,formatName){return exists(editor.formatter.get(formatName),(function(format){var isVariableValue=function(val){return val.length>1&&"%"===val.charAt(0)};return exists(["styles","attributes"],(function(key){return get$9(format,key).exists((function(field){var fieldValues=isArray$1(field)?field:values(field);return exists(fieldValues,isVariableValue)}))}))}))}(editor,name);return editor.formatter.matchNode(node,name,{},matchSimilar)?acc.concat([name]):acc}),[])},isCaretContainerEmpty=function(node){return function(node){for(var nodes=[];node;){if(3===node.nodeType&&"\ufeff"!==node.nodeValue||node.childNodes.length>1)return[];1===node.nodeType&&nodes.push(node),node=node.firstChild}return nodes}(node).length>0},findFirstTextNode=function(node){if(node){var walker=new DomTreeWalker(node,node);for(node=walker.current();node;node=walker.next())if(isText$7(node))return node}return null},createCaretContainer=function(fill){var caretContainer=SugarElement.fromTag("span");return setAll$1(caretContainer,{id:"_mce_caret","data-mce-bogus":"1","data-mce-type":"format-caret"}),fill&&append$1(caretContainer,SugarElement.fromText("\ufeff")),caretContainer},removeCaretContainerNode=function(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node))deleteElement$2(editor,!1,SugarElement.fromDom(node),moveCaret);else{var rng=selection.getRng(),block=dom.getParent(node,dom.isBlock),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,textNode=function(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);return textNode&&"\ufeff"===textNode.nodeValue.charAt(0)&&textNode.deleteData(0,1),textNode}(node);dom.remove(node,!0),startContainer===textNode&&startOffset>0&&rng.setStart(textNode,startOffset-1),endContainer===textNode&&endOffset>0&&rng.setEnd(textNode,endOffset-1),block&&dom.isEmpty(block)&&fillWithPaddingBr(SugarElement.fromDom(block)),selection.setRng(rng)}},removeCaretContainer=function(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(node)removeCaretContainerNode(editor,node,moveCaret);else if(!(node=getParentCaretContainer(editor.getBody(),selection.getStart())))for(;node=dom.get("_mce_caret");)removeCaretContainerNode(editor,node,!1)},appendNode=function(parentNode,node){return parentNode.appendChild(node),node},insertFormatNodesIntoCaretContainer=function(formatNodes,caretContainer){var innerMostFormatNode=foldr(formatNodes,(function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(!1))}),caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode("\ufeff"))},removeCaretFormat=function(editor,name,vars,similar){var hasContentAfter,node,formatNode,dom=editor.dom,selection=editor.selection,parents=[],rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset;for(node=container,3===container.nodeType&&(offset!==container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(matchNode(editor,node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter){var bookmark=selection.getBookmark();rng.collapse(!0);var expandedRng=expandRng(editor,rng,editor.formatter.get(name),!0);expandedRng=split(expandedRng),editor.formatter.remove(name,vars,expandedRng,similar),selection.moveToBookmark(bookmark)}else{var caretContainer=getParentCaretContainer(editor.getBody(),formatNode),newCaretContainer=createCaretContainer(!1).dom;!function(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,curry(isTextBlock$1,editor));block&&dom.isEmpty(block)?formatNode.parentNode.replaceChild(caretContainer,formatNode):(removeTrailingBr(SugarElement.fromDom(formatNode)),dom.isEmpty(formatNode)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode))}(editor,newCaretContainer,null!==caretContainer?caretContainer:formatNode);var cleanedFormatNode=function(editor,caretContainer,formatNode,name,vars,similar){var formatter=editor.formatter,dom=editor.dom,validFormats=filter$4(keys(formatter.get()),(function(formatName){return formatName!==name&&!contains$2(formatName,"removeformat")})),matchedFormats=matchAllOnNode(editor,formatNode,validFormats);if(filter$4(matchedFormats,(function(fmtName){return!areSimilarFormats(editor,fmtName,name)})).length>0){var clonedFormatNode=formatNode.cloneNode(!1);return dom.add(caretContainer,clonedFormatNode),formatter.remove(name,vars,clonedFormatNode,similar),dom.remove(clonedFormatNode),Optional.some(clonedFormatNode)}return Optional.none()}(editor,newCaretContainer,formatNode,name,vars,similar),caretTextNode=insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()),newCaretContainer);removeCaretContainerNode(editor,caretContainer,!1),selection.setCursorLocation(caretTextNode,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}},setup$k=function(editor){editor.on("mouseup keydown",(function(e){!function(editor,keyCode){var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,!1),8!==keyCode&&46!==keyCode||!selection.isCollapsed()||"\ufeff"!==selection.getStart().innerHTML||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart())),37!==keyCode&&39!==keyCode||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()))}(editor,e.keyCode)}))},isFormatElement=function(editor,element){var inlineElements=editor.schema.getTextInlineElements();return has$2(inlineElements,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom)},postProcessHooks={},filter=filter$2,each$b=each$i;!function(name,hook){postProcessHooks[name]||(postProcessHooks[name]=[]),postProcessHooks[name].push(hook)}("pre",(function(editor){var blocks,rng=editor.selection.getRng(),isPre=matchNodeNames(["pre"]);rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each$b(filter(filter(blocks,isPre),(function(pre){return isPre(pre.previousSibling)&&-1!==indexOf$1(blocks,pre.previousSibling)})),(function(pre){var pre1,pre2;pre1=pre.previousSibling,DomQuery(pre2=pre).remove(),DomQuery(pre1).append("<br><br>").append(pre2.childNodes)})))}));var each$a=Tools.each,isElementNode$1=function(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node)},findElementSibling=function(node,siblingName){for(var sibling=node;sibling;sibling=sibling[siblingName]){if(isText$7(sibling)&&isNotEmpty(sibling.data))return node;if(isElement$5(sibling)&&!isBookmarkNode$1(sibling))return sibling}return node},mergeSiblingsNodes=function(dom,prev,next){var elementUtils=ElementUtils(dom);if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(var sibling=prev.nextSibling;sibling&&sibling!==next;){var tmpSibling=sibling;sibling=sibling.nextSibling,prev.appendChild(tmpSibling)}return dom.remove(next),Tools.each(Tools.grep(next.childNodes),(function(node){prev.appendChild(node)})),prev}return next},mergeSiblings=function(dom,format,vars,node){if(node&&!1!==format.merge_siblings){var newNode=mergeSiblingsNodes(dom,getNonWhiteSpaceSibling(node),node);mergeSiblingsNodes(dom,newNode,getNonWhiteSpaceSibling(newNode,!0))}},processChildElements=function(node,filter,process){each$a(node.childNodes,(function(node){isElementNode$1(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))}))},hasStyle=function(dom,name){return function(node){return!(!node||!getStyle(dom,node,name))}},applyStyle=function(dom,name,value){return function(node){dom.setStyle(node,name,value),""===node.getAttribute("style")&&node.removeAttribute("style"),function(dom,node){"SPAN"===node.nodeName&&0===dom.getAttribs(node).length&&dom.remove(node,!0)}(dom,node)}},removeResult=Adt_generate([{keep:[]},{rename:["name"]},{removed:[]}]),MCE_ATTR_RE=/^(src|href|style)$/,each$9=Tools.each,isEq$2=isEq$5,isChildOfInlineParent=function(dom,node,parent){return dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent)},getContainer=function(ed,rng,start){var container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"];if(isElement$5(container)){var lastIdx=container.childNodes.length-1;!start&&offset&&offset--,container=container.childNodes[offset>lastIdx?lastIdx:offset]}return isText$7(container)&&start&&offset>=container.nodeValue.length&&(container=new DomTreeWalker(container,ed.getBody()).next()||container),isText$7(container)&&!start&&0===offset&&(container=new DomTreeWalker(container,ed.getBody()).prev()||container),container},normalizeTableSelection=function(node,start){var prop=start?"firstChild":"lastChild";if(function(node){return/^(TR|TH|TD)$/.test(node.nodeName)}(node)&&node[prop]){var childNode=node[prop];return"TR"===node.nodeName&&childNode[prop]||childNode}return node},wrap$1=function(dom,node,name,attrs){var wrapper=dom.create(name,attrs);return node.parentNode.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper},wrapWithSiblings=function(dom,node,next,name,attrs){var start=SugarElement.fromDom(node),wrapper=SugarElement.fromDom(dom.create(name,attrs)),siblings=next?nextSiblings(start):prevSiblings(start);return append(wrapper,siblings),next?(before$4(start,wrapper),prepend(wrapper,start)):(after$3(start,wrapper),append$1(wrapper,start)),wrapper.dom},find=function(dom,node,next,inc){var sibling=getNonWhiteSpaceSibling(node,next,inc);return isNullable(sibling)||"BR"===sibling.nodeName||dom.isBlock(sibling)},removeNode=function(ed,node,format){var rootBlockElm,parentNode=node.parentNode,dom=ed.dom,forcedRootBlock=getForcedRootBlock(ed);isBlockFormat(format)&&(forcedRootBlock?parentNode===dom.getRoot()&&(format.list_block&&isEq$2(node,format.list_block)||each$k(from(node.childNodes),(function(node){isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap$1(dom,node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=null}))):dom.isBlock(node)&&!dom.isBlock(parentNode)&&(find(dom,node,!1)||find(dom,node.firstChild,!0,!0)||node.insertBefore(dom.create("br"),node.firstChild),find(dom,node,!0)||find(dom,node.lastChild,!1,!0)||node.appendChild(dom.create("br")))),function(format){return isSelectorFormat(format)&&isInlineFormat(format)&&is$1(get$9(format,"mixed"),!0)}(format)&&!isEq$2(format.inline,node)||dom.remove(node,!0)},removeFormatInternal=function(ed,format,vars,node,compareNode){var stylesModified,dom=ed.dom;if(!function(dom,node,format){return!(!isInlineFormat(format)||!isEq$2(node,format.inline))||!(!isBlockFormat(format)||!isEq$2(node,format.block))||(isSelectorFormat(format)?isElement$5(node)&&dom.is(node,format.selector):void 0)}(dom,node,format)&&!function(node,format){return format.links&&"A"===node.nodeName}(node,format))return removeResult.keep();var elm=node;if(isInlineFormat(format)&&"all"===format.remove&&isArray$1(format.preserve_attributes)){var attrsToPreserve=filter$4(dom.getAttribs(elm),(function(attr){return contains$3(format.preserve_attributes,attr.name.toLowerCase())}));if(dom.removeAllAttribs(elm),each$k(attrsToPreserve,(function(attr){return dom.setAttrib(elm,attr.name,attr.value)})),attrsToPreserve.length>0)return removeResult.rename("span")}if("all"!==format.remove){each$9(format.styles,(function(value,name){value=normalizeStyleValue(dom,replaceVars(value,vars),name+""),isNumber(name)&&(name=value,compareNode=null),(format.remove_similar||!compareNode||isEq$2(getStyle(dom,compareNode,name),value))&&dom.setStyle(elm,name,""),stylesModified=!0})),stylesModified&&""===dom.getAttrib(elm,"style")&&(elm.removeAttribute("style"),elm.removeAttribute("data-mce-style")),each$9(format.attributes,(function(value,name){var valueOut;if(value=replaceVars(value,vars),isNumber(name)&&(name=value,compareNode=null),format.remove_similar||!compareNode||isEq$2(dom.getAttrib(compareNode,name),value)){if("class"===name&&(value=dom.getAttrib(elm,name))&&(valueOut="",each$k(value.split(/\s+/),(function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)})),valueOut))return void dom.setAttrib(elm,name,valueOut);if(MCE_ATTR_RE.test(name)&&elm.removeAttribute("data-mce-"+name),"style"===name&&matchNodeNames(["li"])(elm)&&"none"===dom.getStyle(elm,"list-style-type"))return elm.removeAttribute(name),void dom.setStyle(elm,"list-style-type","none");"class"===name&&elm.removeAttribute("className"),elm.removeAttribute(name)}})),each$9(format.classes,(function(value){value=replaceVars(value,vars),compareNode&&!dom.hasClass(compareNode,value)||dom.removeClass(elm,value)}));for(var attrs=dom.getAttribs(elm),i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(0!==attrName.indexOf("_")&&0!==attrName.indexOf("data-"))return removeResult.keep()}}return"none"!==format.remove?(removeNode(ed,elm,format),removeResult.removed()):removeResult.keep()},removeFormat$1=function(ed,format,vars,node,compareNode){return removeFormatInternal(ed,format,vars,node,compareNode).fold(never,(function(newName){return ed.dom.rename(node,newName),!0}),always)},removeFormatFromClone=function(editor,format,vars,clone){return removeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),(function(newName){return editor.dom.createFragment().appendChild(clone),editor.dom.rename(clone,newName)}),constant(null))},remove$1=function(ed,name,vars,node,similar){var formatList=ed.formatter.get(name),format=formatList[0],contentEditable=!0,dom=ed.dom,selection=ed.selection,splitToFormatRoot=function(container){var formatRoot=function(editor,container,name,vars,similar){var formatRoot;return each$k(getParents$2(editor.dom,container.parentNode).reverse(),(function(parent){if(!formatRoot&&"_start"!==parent.id&&"_end"!==parent.id){var format=matchNode(editor,parent,name,vars,similar);format&&!1!==format.split&&(formatRoot=parent)}})),formatRoot}(ed,container,name,vars,similar);return function(editor,formatList,formatRoot,container,target,split,format,vars){var clone,lastClone,firstClone,dom=editor.dom;if(formatRoot){for(var formatRootParent=formatRoot.parentNode,parent_1=container.parentNode;parent_1&&parent_1!==formatRootParent;parent_1=parent_1.parentNode){clone=dom.clone(parent_1,!1);for(var i=0;i<formatList.length&&null!==(clone=removeFormatFromClone(editor,formatList[i],vars,clone));i++);clone&&(lastClone&&clone.appendChild(lastClone),firstClone||(firstClone=clone),lastClone=clone)}!split||format.mixed&&dom.isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target),isInlineFormat(format)&&mergeSiblings(dom,format,0,lastClone))}return container}(ed,formatList,formatRoot,container,container,!0,format,vars)},removeNodeFormat=function(node){return exists(formatList,(function(fmt){return removeFormat$1(ed,fmt,vars,node,node)}))},process=function(node){var lastContentEditable=!0,hasContentEditableState=!1;isElement$5(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0);var children=from(node.childNodes);if(contentEditable&&!hasContentEditableState){var currentNodeMatches=removeNodeFormat(node)||exists(formatList,(function(f){return matchName$1(dom,node,f)})),parentNode=node.parentNode;!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&removeNodeFormat(parentNode)}if(format.deep&&children.length){for(var i=0;i<children.length;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}each$k(["underline","line-through","overline"],(function(decoration){isElement$5(node)&&ed.dom.getStyle(node,"text-decoration")===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration&&removeFormat$1(ed,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:decoration}},null,node)}))},unwrap=function(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return function(node){return isBookmarkNode$1(node)&&isElement$5(node)&&("_start"===node.id||"_end"===node.id)}(out)&&(out=out[start?"firstChild":"lastChild"]),isText$7(out)&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out},removeRngStyle=function(rng){var startContainer,endContainer,expandedRng=expandRng(ed,rng,formatList,rng.collapsed);if(format.split){if(expandedRng=split(expandedRng),(startContainer=getContainer(ed,expandedRng,!0))!==(endContainer=getContainer(ed,expandedRng))){if(startContainer=normalizeTableSelection(startContainer,!0),endContainer=normalizeTableSelection(endContainer,!1),isChildOfInlineParent(dom,startContainer,endContainer)){var marker=Optional.from(startContainer.firstChild).getOr(startContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!0,"span",{id:"_start","data-mce-type":"bookmark"})),void unwrap(!0)}if(isChildOfInlineParent(dom,endContainer,startContainer)){marker=Optional.from(endContainer.lastChild).getOr(endContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!1,"span",{id:"_end","data-mce-type":"bookmark"})),void unwrap(!1)}startContainer=wrap$1(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap$1(dom,endContainer,"span",{id:"_end","data-mce-type":"bookmark"});var newRng=dom.createRng();newRng.setStartAfter(startContainer),newRng.setEndBefore(endContainer),walk$2(dom,newRng,(function(nodes){each$k(nodes,(function(n){isBookmarkNode$1(n)||isBookmarkNode$1(n.parentNode)||splitToFormatRoot(n)}))})),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(!0),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,expandedRng.startOffset=dom.nodeIndex(startContainer),expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,expandedRng.endOffset=dom.nodeIndex(endContainer)+1}walk$2(dom,expandedRng,(function(nodes){each$k(nodes,process)}))};if(node){if(isNode(node)){var rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)}else removeRngStyle(node);fireFormatRemove(ed,name,node,vars)}else if("false"!==dom.getContentEditable(selection.getNode()))selection.isCollapsed()&&isInlineFormat(format)&&!getCellsFromEditor(ed).length?removeCaretFormat(ed,name,vars,similar):(preserve(selection,!0,(function(){runOnRanges(ed,removeRngStyle)})),isInlineFormat(format)&&match$2(ed,name,vars,selection.getStart())&&moveStart(dom,selection,selection.getRng()),ed.nodeChanged()),fireFormatRemove(ed,name,node,vars);else{node=selection.getNode();for(var i=0;i<formatList.length&&(!formatList[i].ceFalseOverride||!removeFormat$1(ed,formatList[i],vars,node,node));i++);fireFormatRemove(ed,name,node,vars)}},each$8=Tools.each,mergeWithChildren=function(editor,formatList,vars,node){each$8(formatList,(function(format){isInlineFormat(format)&&each$8(editor.dom.select(format.inline,node),(function(child){isElementNode$1(child)&&removeFormat$1(editor,format,vars,child,format.exact?child:null)})),function(dom,format,node){if(format.clear_child_styles){var selector=format.links?"*:not(a)":"*";each$a(dom.select(selector,node),(function(node){isElementNode$1(node)&&each$a(format.styles,(function(value,name){dom.setStyle(node,name,"")}))}))}}(editor.dom,format,node)}))},each$7=Tools.each,isElementNode=function(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node)},applyFormat$1=function(ed,name,vars,node){var formatList=ed.formatter.get(name),format=formatList[0],isCollapsed=!node&&ed.selection.isCollapsed(),dom=ed.dom,selection=ed.selection,setElementFormat=function(elm,fmt){if(void 0===fmt&&(fmt=format),isFunction(fmt.onformat)&&fmt.onformat(elm,fmt,vars,node),each$7(fmt.styles,(function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))})),fmt.styles){var styleVal=dom.getAttrib(elm,"style");styleVal&&dom.setAttrib(elm,"data-mce-style",styleVal)}each$7(fmt.attributes,(function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))})),each$7(fmt.classes,(function(value){value=replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)}))},applyNodeStyle=function(formatList,node){var found=!1;return each$7(formatList,(function(format){return!!isSelectorFormat(format)&&(isNonNullable(format.collapsed)&&format.collapsed!==isCollapsed?void 0:dom.is(node,format.selector)&&!isCaretNode(node)?(setElementFormat(node,format),found=!0,!1):void 0)})),found},createWrapElement=function(wrapName){if(isString$1(wrapName)){var wrapElm=dom.create(wrapName);return setElementFormat(wrapElm),wrapElm}return null},applyRngStyle=function(dom,rng,nodeSpecific){var newWrappers=[],contentEditable=!0,wrapName=format.inline||format.block,wrapElm=createWrapElement(wrapName);walk$2(dom,rng,(function(nodes){var currentWrapElm,process=function(node){var hasContentEditableState=!1,lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentNode=node.parentNode,parentName=parentNode.nodeName.toLowerCase();if(isElement$5(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),isBr$5(node)&&!function(editor,format,node,parentName){if(function(editor){return editor.getParam("format_empty_lines",!1,"boolean")}(editor)&&isInlineFormat(format)){var validBRParentElements=getTextRootBlockElements(editor.schema),hasCaretNodeSibling=sibling(SugarElement.fromDom(node),(function(sibling){return isCaretNode(sibling.dom)}));return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),!1)&&!hasCaretNodeSibling}return!1}(ed,format,node,parentName))return currentWrapElm=null,void(isBlockFormat(format)&&dom.remove(node));if(isBlockFormat(format)&&format.wrapper&&matchNode(ed,node,name,vars))currentWrapElm=null;else{if(contentEditable&&!hasContentEditableState&&isBlockFormat(format)&&!format.wrapper&&isTextBlock$1(ed,nodeName)&&isValid(ed,parentName,wrapName)){var elm=dom.rename(node,wrapName);return setElementFormat(elm),newWrappers.push(elm),void(currentWrapElm=null)}if(isSelectorFormat(format)){var found=applyNodeStyle(formatList,node);if(!found&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&(found=applyNodeStyle(formatList,parentNode)),!isInlineFormat(format)||found)return void(currentWrapElm=null)}!contentEditable||hasContentEditableState||!isValid(ed,wrapName,nodeName)||!isValid(ed,parentName,wrapName)||!nodeSpecific&&isText$7(node)&&isZwsp(node.data)||isCaretNode(node)||isInlineFormat(format)&&dom.isBlock(node)?(currentWrapElm=null,each$k(from(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=null):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,!1),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node))}};each$k(nodes,process)})),!0===format.links&&each$k(newWrappers,(function(node){var process=function(node){"A"===node.nodeName&&setElementFormat(node,format),each$k(from(node.childNodes),process)};process(node)})),each$k(newWrappers,(function(node){var childCount=function(node){var count=0;return each$k(node.childNodes,(function(node){(function(node){return isNonNullable(node)&&isText$7(node)&&0===node.length})(node)||isBookmarkNode$1(node)||count++})),count}(node);!(newWrappers.length>1)&&dom.isBlock(node)||0!==childCount?(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper)&&(format.exact||1!==childCount||(node=function(node){var childElement=find$3(node.childNodes,isElementNode).filter((function(child){return matchName$1(dom,child,format)}));return childElement.map((function(child){var clone=dom.clone(child,!1);return setElementFormat(clone),dom.replace(clone,node,!0),dom.remove(child,!0),clone})).getOr(node)}(node)),mergeWithChildren(ed,formatList,vars,node),function(editor,format,name,vars,node){matchNode(editor,node.parentNode,name,vars)&&removeFormat$1(editor,format,vars,node)||format.merge_with_parents&&editor.dom.getParent(node.parentNode,(function(parent){if(matchNode(editor,parent,name,vars))return removeFormat$1(editor,format,vars,node),!0}))}(ed,format,name,vars,node),function(dom,format,vars,node){format.styles&&format.styles.backgroundColor&&processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"backgroundColor",replaceVars(format.styles.backgroundColor,vars)))}(dom,format,vars,node),function(dom,format,vars,node){var processTextDecorationsAndColor=function(n){if(1===n.nodeType&&n.parentNode&&1===n.parentNode.nodeType){var textDecoration=getTextDecoration(dom,n.parentNode);dom.getStyle(n,"color")&&textDecoration?dom.setStyle(n,"text-decoration",textDecoration):dom.getStyle(n,"text-decoration")===textDecoration&&dom.setStyle(n,"text-decoration",null)}};format.styles&&(format.styles.color||format.styles.textDecoration)&&(Tools.walk(node,processTextDecorationsAndColor,"childNodes"),processTextDecorationsAndColor(node))}(dom,format,0,node),function(dom,format,vars,node){!isInlineFormat(format)||"sub"!==format.inline&&"sup"!==format.inline||(processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"fontSize","")),dom.remove(dom.select("sup"===format.inline?"sub":"sup",node),!0))}(dom,format,0,node),mergeSiblings(dom,format,0,node)):dom.remove(node,!0)}))};if("false"!==dom.getContentEditable(selection.getNode())){if(format){if(node)if(isNode(node)){if(!applyNodeStyle(formatList,node)){var rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),applyRngStyle(dom,expandRng(ed,rng,formatList),!0)}}else applyRngStyle(dom,node,!0);else if(isCollapsed&&isInlineFormat(format)&&!getCellsFromEditor(ed).length)!function(editor,name,vars){var caretContainer,textNode,selection=editor.selection,selectionRng=selection.getRng(),offset=selectionRng.startOffset,text=selectionRng.startContainer.nodeValue;(caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart()))&&(textNode=findFirstTextNode(caretContainer));var ownerDocument,node,wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){var bookmark=selection.getBookmark();selectionRng.collapse(!0);var rng=expandRng(editor,selectionRng,editor.formatter.get(name));rng=split(rng),editor.formatter.apply(name,vars,rng),selection.moveToBookmark(bookmark)}else caretContainer&&"\ufeff"===textNode.nodeValue||(ownerDocument=editor.getDoc(),node=createCaretContainer(!0).dom,textNode=(caretContainer=ownerDocument.importNode(node,!0)).firstChild,selectionRng.insertNode(caretContainer),offset=1),editor.formatter.apply(name,vars,caretContainer),selection.setCursorLocation(textNode,offset)}(ed,name,vars);else{var curSelNode=selection.getNode(),firstFormat=formatList[0];ed.settings.forced_root_block||!firstFormat.defaultBlock||dom.getParent(curSelNode,dom.isBlock)||applyFormat$1(ed,firstFormat.defaultBlock),selection.setRng(normalize(selection.getRng())),preserve(selection,!0,(function(){runOnRanges(ed,(function(selectionRng,fake){var expandedRng=fake?selectionRng:expandRng(ed,selectionRng,formatList);applyRngStyle(dom,expandedRng,!1)}))})),moveStart(dom,selection,selection.getRng()),ed.nodeChanged()}!function(name,editor){each$b(postProcessHooks[name],(function(hook){hook(editor)}))}(name,ed)}fireFormatApply(ed,name,node,vars)}else{node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){var formatItem=formatList[i];if(formatItem.ceFalseOverride&&isSelectorFormat(formatItem)&&dom.is(node,formatItem.selector)){setElementFormat(node,formatItem);break}}fireFormatApply(ed,name,node,vars)}},hasVars=function(value){return has$2(value,"vars")},fallbackElement=function(editor){return editor.selection.getStart()},matchingNode=function(editor,parents,format,similar,vars){return findUntil$1(parents,(function(node){var matchingFormat=editor.formatter.matchNode(node,format,null!=vars?vars:{},similar);return!isUndefined(matchingFormat)}),(function(node){return!!matchesUnInheritedFormatSelector(editor,node,format)||!similar&&isNonNullable(editor.formatter.matchNode(node,format,vars,!0))}))},getParents=function(editor,elm){var element=null!=elm?elm:fallbackElement(editor);return filter$4(getParents$2(editor.dom,element),(function(node){return isElement$5(node)&&!isBogus$2(node)}))},updateAndFireChangeCallbacks=function(editor,elm,registeredCallbacks){var parents=getParents(editor,elm);each$j(registeredCallbacks,(function(data,format){var runIfChanged=function(spec){var match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:void 0),isSet=match.isSome();if(spec.state.get()!==isSet){spec.state.set(isSet);var node_1=match.getOr(elm);hasVars(spec)?spec.callback(isSet,{node:node_1,format,parents}):each$k(spec.callbacks,(function(callback){return callback(isSet,{node:node_1,format,parents})}))}};each$k([data.withSimilar,data.withoutSimilar],runIfChanged),each$k(data.withVars,runIfChanged)}))},formatChangedInternal=function(editor,registeredFormatListeners,formats,callback,similar,vars){return null===registeredFormatListeners.get()&&function(registeredFormatListeners,editor){registeredFormatListeners.set({}),editor.on("NodeChange",(function(e){updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get())})),editor.on("FormatApply FormatRemove",(function(e){var element=Optional.from(e.node).map((function(nodeOrRange){return isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer})).bind((function(node){return isElement$5(node)?Optional.some(node):Optional.from(node.parentElement)})).getOrThunk((function(){return fallbackElement(editor)}));updateAndFireChangeCallbacks(editor,element,registeredFormatListeners.get())}))}(registeredFormatListeners,editor),function(editor,registeredFormatListeners,formats,callback,similar,vars){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(","),(function(format){var group=get$9(formatChangeItems,format).getOrThunk((function(){var base={withSimilar:{state:Cell(!1),similar:!0,callbacks:[]},withoutSimilar:{state:Cell(!1),similar:!1,callbacks:[]},withVars:[]};return formatChangeItems[format]=base,base})),getCurrent=function(){var parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome()};if(isUndefined(vars)){var toAppendTo=similar?group.withSimilar:group.withoutSimilar;toAppendTo.callbacks.push(callback),1===toAppendTo.callbacks.length&&toAppendTo.state.set(getCurrent())}else group.withVars.push({state:Cell(getCurrent()),similar,vars,callback})})),registeredFormatListeners.set(formatChangeItems)}(editor,registeredFormatListeners,formats,callback,similar,vars),{unbind:function(){return function(registeredFormatListeners,formats,callback){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(","),(function(format){return get$9(formatChangeItems,format).each((function(group){formatChangeItems[format]={withSimilar:__assign(__assign({},group.withSimilar),{callbacks:filter$4(group.withSimilar.callbacks,(function(cb){return cb!==callback}))}),withoutSimilar:__assign(__assign({},group.withoutSimilar),{callbacks:filter$4(group.withoutSimilar.callbacks,(function(cb){return cb!==callback}))}),withVars:filter$4(group.withVars,(function(item){return item.callback!==callback}))}}))})),registeredFormatListeners.set(formatChangeItems)}(registeredFormatListeners,formats,callback)}}},fromElements=function(elements,scope){var fragment=(scope||document).createDocumentFragment();return each$k(elements,(function(element){fragment.appendChild(element.dom)})),SugarElement.fromDom(fragment)},tableModel=function(element,width,rows){return{element,width,rows}},tableRow=function(element,cells){return{element,cells}},cellPosition=function(x,y){return{x,y}},getSpan=function(td,key){var value=parseInt(get$6(td,key),10);return isNaN(value)?1:value},cellExists=function(table,x,y){var rows=table.rows;return!!(rows[y]?rows[y].cells:[])[x]},getWidth=function(rows){return foldl(rows,(function(acc,row){return row.cells.length>acc?row.cells.length:acc}),0)},findElementPos=function(table,element){for(var rows=table.rows,y=0;y<rows.length;y++)for(var cells=rows[y].cells,x=0;x<cells.length;x++)if(eq(cells[x],element))return Optional.some(cellPosition(x,y));return Optional.none()},extractRows=function(table,sx,sy,ex,ey){for(var newRows=[],rows=table.rows,y=sy;y<=ey;y++){var cells=rows[y].cells,slice=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice))}return newRows},fromDom=function(tableElm){var table=tableModel(shallow(tableElm),0,[]);return each$k(descendants(tableElm,"tr"),(function(tr,y){each$k(descendants(tr,"td,th"),(function(td,x){!function(table,x,y,tr,td){for(var rowspan=getSpan(td,"rowspan"),colspan=getSpan(td,"colspan"),rows=table.rows,y2=y;y2<y+rowspan;y2++){rows[y2]||(rows[y2]=tableRow(deep$1(tr),[]));for(var x2=x;x2<x+colspan;x2++)rows[y2].cells[x2]=y2===y&&x2===x?td:shallow(td)}}(table,function(table,x,y){for(;cellExists(table,x,y);)x++;return x}(table,x,y),y,tr,td)}))})),tableModel(table.element,getWidth(table.rows),table.rows)},toDom=function(table){return function(table,rows){var tableElement=shallow(table.element),tableBody=SugarElement.fromTag("tbody");return append(tableBody,rows),append$1(tableElement,tableBody),tableElement}(table,function(table){return map$3(table.rows,(function(row){var cells=map$3(row.cells,(function(cell){var td=deep$1(cell);return remove$6(td,"colspan"),remove$6(td,"rowspan"),td})),tr=shallow(row.element);return append(tr,cells),tr}))}(table))},subsection=function(table,startElement,endElement){return findElementPos(table,startElement).bind((function(startPos){return findElementPos(table,endElement).map((function(endPos){return function(table,startPos,endPos){var sx=startPos.x,sy=startPos.y,ex=endPos.x,ey=endPos.y,newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows)}(table,startPos,endPos)}))}))},getFullySelectedListWrappers=function(parents,rng){return find$3(parents,(function(elm){return"li"===name(elm)&&hasAllContentsSelected(elm,rng)})).fold(constant([]),(function(_li){return function(parents){return find$3(parents,(function(elm){return"ul"===name(elm)||"ol"===name(elm)}))}(parents).map((function(listCont){var listElm=SugarElement.fromTag(name(listCont)),listStyles=filter$3(getAllRaw(listCont),(function(_style,name){return startsWith(name,"list-style")}));return setAll(listElm,listStyles),[SugarElement.fromTag("li"),listElm]})).getOr([])}))},getWrapElements=function(rootNode,rng){var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer),parents=parentsAndSelf(commonAnchorContainer,rootNode),wrapElements=filter$4(parents,(function(elm){return isInline$1(elm)||isHeading(elm)})),listWrappers=getFullySelectedListWrappers(parents,rng),allWrappers=wrapElements.concat(listWrappers.length?listWrappers:function(commonAnchorContainer){return isListItem(commonAnchorContainer)?parent(commonAnchorContainer).filter(isList).fold(constant([]),(function(listElm){return[commonAnchorContainer,listElm]})):isList(commonAnchorContainer)?[commonAnchorContainer]:[]}(commonAnchorContainer));return map$3(allWrappers,shallow)},emptyFragment=function(){return fromElements([])},getFragmentFromRange=function(rootNode,rng){return innerElm=SugarElement.fromDom(rng.cloneContents()),elms=getWrapElements(rootNode,rng),wrapped=foldl(elms,(function(acc,elm){return append$1(elm,acc),elm}),innerElm),elms.length>0?fromElements([wrapped]):wrapped;var innerElm,elms,wrapped},getTableFragment=function(rootNode,selectedTableCells){return(rootElm=rootNode,cell=selectedTableCells[0],ancestor$2(cell,"table",curry(eq,rootElm))).bind((function(tableElm){var firstCell=selectedTableCells[0],lastCell=selectedTableCells[selectedTableCells.length-1],fullTableModel=fromDom(tableElm);return subsection(fullTableModel,firstCell,lastCell).map((function(sectionedTableModel){return fromElements([toDom(sectionedTableModel)])}))})).getOrThunk(emptyFragment);var rootElm,cell},read$3=function(rootNode,ranges){var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):function(rootNode,ranges){return ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0])}(rootNode,ranges)},isCollapsibleWhitespace=function(text,index){return index>=0&&index<text.length&&isWhiteSpace(text.charAt(index))},getInnerText=function(bin,shouldTrim){var text=trim$2(bin.innerText);return shouldTrim?function(text){return text.replace(/^[ \f\n\r\t\v]+/,"")}(text):text},getSelectedContentInternal=function(editor,format,args){void 0===args&&(args={});var defaultedArgs=function(args,format){return __assign(__assign({},args),{format,get:!0,selection:!0})}(args,format),updatedArgs=editor.fire("BeforeGetContent",defaultedArgs);if(updatedArgs.isDefaultPrevented())return editor.fire("GetContent",updatedArgs),updatedArgs.content;if("text"===updatedArgs.format)return function(editor){return Optional.from(editor.selection.getRng()).map((function(rng){var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock)),body=editor.getBody(),contextNodeName=function(parentBlockOpt){return parentBlockOpt.map((function(block){return block.nodeName})).getOr("div").toLowerCase()}(parentBlockOpt),shouldTrimSpaces=Env.browser.isIE()&&"pre"!==contextNodeName,bin=editor.dom.add(body,contextNodeName,{"data-mce-bogus":"all",style:"overflow: hidden; opacity: 0;"},rng.cloneContents()),text=getInnerText(bin,shouldTrimSpaces),nonRenderedText=trim$2(bin.textContent);if(editor.dom.remove(bin),isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){var parentBlock=parentBlockOpt.getOr(body),parentBlockText=getInnerText(parentBlock,shouldTrimSpaces),textIndex=parentBlockText.indexOf(text);return-1===textIndex?text:(isCollapsibleWhitespace(parentBlockText,textIndex-1)?" ":"")+text+(isCollapsibleWhitespace(parentBlockText,textIndex+text.length)?" ":"")}return text})).getOr("")}(editor);updatedArgs.getInner=!0;var content=function(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create("body"),sel=editor.selection.getSel(),ranges=processRanges(editor,getRanges(sel)),fragment=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),ranges).dom:rng.cloneContents();return fragment&&tmpElm.appendChild(fragment),editor.selection.serializer.serialize(tmpElm,args)}(editor,updatedArgs);return"tree"===updatedArgs.format?content:(updatedArgs.content=editor.selection.isCollapsed()?"":content,editor.fire("GetContent",updatedArgs),updatedArgs.content)},getOuterHtml=function(elm){return isElement$5(elm)?elm.outerHTML:isText$7(elm)?Entities.encodeRaw(elm.data,!1):isComment(elm)?"\x3c!--"+elm.data+"--\x3e":""},insertAt=function(elm,html,index){var fragment=function(html){var node,container=document.createElement("div"),frag=document.createDocumentFragment();for(html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag}(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target)}else elm.appendChild(fragment)},write=function(fragments,elm){var left,right,size,vDown,vUp,buildScript,buildSnake,getMiddleSnake,script,currentFragments=map$3(from(elm.childNodes),getOuterHtml);return function(diff,elm){var index=0;each$k(diff,(function(action){0===action[0]?index++:1===action[0]?(insertAt(elm,action[1],index),index++):2===action[0]&&function(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target)}}(elm,index)}))}((right=fragments,size=(left=currentFragments).length+right.length+2,vDown=new Array(size),vUp=new Array(size),buildScript=function(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2)for(var i=start1,j=start2;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end1-start1>end2-start2?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j);else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}},buildSnake=function(start,diag,end1,end2){for(var end=start;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return function(start,end,diag){return{start,end,diag}}(start,end,diag)},getMiddleSnake=function(start1,end1,start2,end2){var m=end1-start1,n=end2-start2;if(0===m||0===n)return null;var d,k,i,x,y,delta=m-n,sum=n+m,offset=(sum%2==0?sum:sum+1)/2;for(vDown[1+offset]=start1,vUp[1+offset]=end1+1,d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){for(i=k+offset,k===-d||k!==d&&vDown[i-1]<vDown[i+1]?vDown[i]=vDown[i+1]:vDown[i]=vDown[i-1]+1,y=(x=vDown[i])-start1+start2-k;x<end1&&y<end2&&left[x]===right[y];)vDown[i]=++x,++y;if(delta%2!=0&&delta-d<=k&&k<=delta+d&&vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){for(i=k+offset-delta,k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]?vUp[i]=vUp[i+1]-1:vUp[i]=vUp[i-1],y=(x=vUp[i]-1)-start1+start2-k;x>=start1&&y>=start2&&left[x]===right[y];)vUp[i]=x--,y--;if(delta%2==0&&-d<=k&&k<=d&&vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}},script=[],buildScript(0,left.length,0,right.length,script),script),elm),elm},lazyTempDocument=cached((function(){return document.implementation.createHTMLDocument("undo")})),createFromEditor=function(editor){var elm,fragments=(elm=editor.getBody(),filter$4(map$3(from(elm.childNodes),getOuterHtml),(function(item){return item.length>0}))),trimmedFragments=bind(fragments,(function(html){var trimmed=trimInternal(editor.serializer,html);return trimmed.length>0?[trimmed]:[]})),content=trimmedFragments.join("");return-1!==content.indexOf("</iframe>")?function(fragments){return{type:"fragmented",fragments,content:"",bookmark:null,beforeBookmark:null}}(trimmedFragments):function(content){return{type:"complete",fragments:null,content,bookmark:null,beforeBookmark:null}}(content)},applyToEditor=function(editor,level,before){var bookmark=before?level.beforeBookmark:level.bookmark;"fragmented"===level.type?write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw",no_selection:!isNonNullable(bookmark)||!isPathBookmark(bookmark)||!bookmark.isFakeCaret}),editor.selection.moveToBookmark(bookmark)},getLevelContent=function(level){return"fragmented"===level.type?level.fragments.join(""):level.content},getCleanLevelContent=function(level){var elm=SugarElement.fromTag("body",lazyTempDocument());return set(elm,getLevelContent(level)),each$k(descendants(elm,"*[data-mce-bogus]"),unwrap),elm.dom.innerHTML},isEq$1=function(level1,level2){return!(!level1||!level2)&&(!!function(level1,level2){return getLevelContent(level1)===getLevelContent(level2)}(level1,level2)||function(level1,level2){return getCleanLevelContent(level1)===getCleanLevelContent(level2)}(level1,level2))},isUnlocked=function(locks){return 0===locks.get()},setTyping=function(undoManager,typing,locks){isUnlocked(locks)&&(undoManager.typing=typing)},endTyping=function(undoManager,locks){undoManager.typing&&(setTyping(undoManager,!1,locks),undoManager.add())},makePlainAdaptor=function(editor){return{undoManager:{beforeChange:function(locks,beforeBookmark){return function(editor,locks,beforeBookmark){isUnlocked(locks)&&beforeBookmark.set(getUndoBookmark(editor.selection))}(editor,locks,beforeBookmark)},add:function(undoManager,index,locks,beforeBookmark,level,event){return function(editor,undoManager,index,locks,beforeBookmark,level,event){var currentLevel=createFromEditor(editor);if(level=level||{},level=Tools.extend(level,currentLevel),!1===isUnlocked(locks)||editor.removed)return null;var lastLevel=undoManager.data[index.get()];if(editor.fire("BeforeAddUndo",{level,lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&isEq$1(lastLevel,level))return null;undoManager.data[index.get()]&&beforeBookmark.get().each((function(bm){undoManager.data[index.get()].beforeBookmark=bm}));var customUndoRedoLevels=function(editor){return editor.getParam("custom_undo_redo_levels",0,"number")}(editor);if(customUndoRedoLevels&&undoManager.data.length>customUndoRedoLevels){for(var i=0;i<undoManager.data.length-1;i++)undoManager.data[i]=undoManager.data[i+1];undoManager.data.length--,index.set(undoManager.data.length)}level.bookmark=getUndoBookmark(editor.selection),index.get()<undoManager.data.length-1&&(undoManager.data.length=index.get()+1),undoManager.data.push(level),index.set(undoManager.data.length-1);var args={level,lastLevel,originalEvent:event};return index.get()>0?(editor.setDirty(!0),editor.fire("AddUndo",args),editor.fire("change",args)):editor.fire("AddUndo",args),level}(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(undoManager,locks,index){return function(editor,undoManager,locks,index){var level;return undoManager.typing&&(undoManager.add(),undoManager.typing=!1,setTyping(undoManager,!1,locks)),index.get()>0&&(index.set(index.get()-1),level=undoManager.data[index.get()],applyToEditor(editor,level,!0),editor.setDirty(!0),editor.fire("Undo",{level})),level}(editor,undoManager,locks,index)},redo:function(index,data){return function(editor,index,data){var level;return index.get()<data.length-1&&(index.set(index.get()+1),level=data[index.get()],applyToEditor(editor,level,!1),editor.setDirty(!0),editor.fire("Redo",{level})),level}(editor,index,data)},clear:function(undoManager,index){return function(editor,undoManager,index){undoManager.data=[],index.set(0),undoManager.typing=!1,editor.fire("ClearUndos")}(editor,undoManager,index)},reset:function(undoManager){return function(undoManager){undoManager.clear(),undoManager.add()}(undoManager)},hasUndo:function(undoManager,index){return function(editor,undoManager,index){return index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0])}(editor,undoManager,index)},hasRedo:function(undoManager,index){return function(undoManager,index){return index.get()<undoManager.data.length-1&&!undoManager.typing}(undoManager,index)},transact:function(undoManager,locks,callback){return function(undoManager,locks,callback){return endTyping(undoManager,locks),undoManager.beforeChange(),undoManager.ignore(callback),undoManager.add()}(undoManager,locks,callback)},ignore:function(locks,callback){return function(locks,callback){try{locks.set(locks.get()+1),callback()}finally{locks.set(locks.get()-1)}}(locks,callback)},extra:function(undoManager,index,callback1,callback2){return function(editor,undoManager,index,callback1,callback2){if(undoManager.transact(callback1)){var bookmark=undoManager.data[index.get()].bookmark,lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,!0),undoManager.transact(callback2)&&(undoManager.data[index.get()-1].beforeBookmark=bookmark)}}(editor,undoManager,index,callback1,callback2)}},formatter:{match:function(name,vars,node,similar){return match$2(editor,name,vars,node,similar)},matchAll:function(names,vars){return function(editor,names,vars){var matchedFormatNames=[],checkedMap={},startElement=editor.selection.getStart();return editor.dom.getParent(startElement,(function(node){for(var i=0;i<names.length;i++){var name_1=names[i];!checkedMap[name_1]&&matchNode(editor,node,name_1,vars)&&(checkedMap[name_1]=!0,matchedFormatNames.push(name_1))}}),editor.dom.getRoot()),matchedFormatNames}(editor,names,vars)},matchNode:function(node,name,vars,similar){return matchNode(editor,node,name,vars,similar)},canApply:function(name){return function(editor,name){var formatList=editor.formatter.get(name),dom=editor.dom;if(formatList)for(var startNode=editor.selection.getStart(),parents=getParents$2(dom,startNode),x=formatList.length-1;x>=0;x--){var format=formatList[x];if(!isSelectorFormat(format)||isNonNullable(format.defaultBlock))return!0;for(var i=parents.length-1;i>=0;i--)if(dom.is(parents[i],format.selector))return!0}return!1}(editor,name)},closest:function(names){return closest(editor,names)},apply:function(name,vars,node){return applyFormat$1(editor,name,vars,node)},remove:function(name,vars,node,similar){return remove$1(editor,name,vars,node,similar)},toggle:function(name,vars,node){return function(editor,name,vars,node){var fmt=editor.formatter.get(name);!match$2(editor,name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?applyFormat$1(editor,name,vars,node):remove$1(editor,name,vars,node)}(editor,name,vars,node)},formatChanged:function(registeredFormatListeners,formats,callback,similar,vars){return formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars)}},editor:{getContent:function(args,format){return function(editor,args,format){return Optional.from(editor.getBody()).fold(constant("tree"===args.format?new AstNode("body",11):""),(function(body){return getContentFromBody(editor,args,format,body)}))}(editor,args,format)},setContent:function(content,args){return setContentInternal(editor,content,args)},insertContent:function(value,details){return insertHtmlAtCaret(editor,value,details)},addVisual:function(elm){return function(editor,elm){var dom=editor.dom,scope=isNonNullable(elm)?elm:editor.getBody();isUndefined(editor.hasVisual)&&(editor.hasVisual=function(editor){return editor.getParam("visual",!0,"boolean")}(editor)),each$k(dom.select("table,a",scope),(function(matchedElm){switch(matchedElm.nodeName){case"TABLE":var cls=function(editor){return editor.getParam("visual_table_class","mce-item-table","string")}(editor),value=dom.getAttrib(matchedElm,"border");value&&"0"!==value||!editor.hasVisual?dom.removeClass(matchedElm,cls):dom.addClass(matchedElm,cls);break;case"A":if(!dom.getAttrib(matchedElm,"href")){var value_1=dom.getAttrib(matchedElm,"name")||matchedElm.id,cls_1=function(editor){return editor.getParam("visual_anchor_class","mce-item-anchor","string")}(editor);value_1&&editor.hasVisual?dom.addClass(matchedElm,cls_1):dom.removeClass(matchedElm,cls_1)}}})),editor.fire("VisualAid",{element:elm,hasVisual:editor.hasVisual})}(editor,elm)}},selection:{getContent:function(format,args){return getSelectedContentInternal(editor,format,args)}},raw:{getModel:function(){return Optional.none()}}}},isRtc=function(editor){return has$2(editor.plugins,"rtc")},setup$i=function(editor){var editorCast=editor;return function(editor){return get$9(editor.plugins,"rtc").bind((function(rtcPlugin){return Optional.from(rtcPlugin.setup)}))}(editor).fold((function(){return editorCast.rtcInstance=makePlainAdaptor(editor),Optional.none()}),(function(setup){return editorCast.rtcInstance=function(){var nul=constant(null),empty=constant("");return{undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(void 0),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:empty,insertContent:noop,addVisual:noop},selection:{getContent:empty},raw:{getModel:constant(Optional.none())}}}(),Optional.some((function(){return setup().then((function(rtcEditor){return editorCast.rtcInstance=function(rtcEditor){var defaultVars=function(vars){return isObject(vars)?vars:{}},undoManager=rtcEditor.undoManager,formatter=rtcEditor.formatter,editor=rtcEditor.editor,selection=rtcEditor.selection,raw=rtcEditor.raw;return{undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:function(_undoManager,_locks,fn){return undoManager.transact(fn)},ignore:function(_locks,callback){return undoManager.ignore(callback)},extra:function(_undoManager,_index,callback1,callback2){return undoManager.extra(callback1,callback2)}},formatter:{match:function(name,vars,_node,similar){return formatter.match(name,defaultVars(vars),similar)},matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:function(name){return formatter.canApply(name)},closest:function(names){return formatter.closest(names)},apply:function(name,vars,_node){return formatter.apply(name,defaultVars(vars))},remove:function(name,vars,_node,_similar){return formatter.remove(name,defaultVars(vars))},toggle:function(name,vars,_node){return formatter.toggle(name,defaultVars(vars))},formatChanged:function(_rfl,formats,callback,similar,vars){return formatter.formatChanged(formats,callback,similar,vars)}},editor:{getContent:function(args,_format){return editor.getContent(args)},setContent:function(content,args){return editor.setContent(content,args)},insertContent:function(content,_details){return editor.insertContent(content)},addVisual:editor.addVisual},selection:{getContent:function(_format,args){return selection.getContent(args)}},raw:{getModel:function(){return Optional.some(raw.getRawModel())}}}}(rtcEditor),rtcEditor.rtc.isRemote}))}))}))},getRtcInstanceWithFallback=function(editor){return editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor)},getRtcInstanceWithError=function(editor){var rtcInstance=editor.rtcInstance;if(rtcInstance)return rtcInstance;throw new Error("Failed to get RTC instance not yet initialized.")},getContent$1=function(editor,args){return void 0===args&&(args={}),function(editor,format,args){return getRtcInstanceWithError(editor).selection.getContent(format,args)}(editor,args.format?args.format:"html",args)},removeEmpty=function(text){return 0===text.dom.length?(remove$7(text),Optional.none()):Optional.some(text)},mergeAndNormalizeText=function(outerNode,innerNode,rng,start){outerNode.bind((function(outer){return(start?normalizeWhitespaceBefore:normalizeWhitespaceAfter)(outer.dom,start?outer.dom.length:0),innerNode.filter(isText$8).map((function(inner){return function(outer,inner,rng,start){var outerElm=outer.dom,innerElm=inner.dom,oldLength=start?outerElm.length:innerElm.length;start?(mergeTextNodes(outerElm,innerElm,!1,!start),rng.setStart(innerElm,oldLength)):(mergeTextNodes(innerElm,outerElm,!1,!start),rng.setEnd(innerElm,oldLength))}(outer,inner,rng,start)}))})).orThunk((function(){var innerTextNode=function(node,start){return node.filter((function(elm){return BookmarkManager.isBookmarkNode(elm.dom)})).bind(start?nextSibling:prevSibling)}(innerNode,start).or(innerNode).filter(isText$8);return innerTextNode.map((function(inner){return function(inner,start){parent(inner).each((function(root){var text=inner.dom;start&&needsToBeNbspLeft(root,CaretPosition(text,0))?normalizeWhitespaceAfter(text,0):!start&&needsToBeNbspRight(root,CaretPosition(text,text.length))&&normalizeWhitespaceBefore(text,text.length)}))}(inner,start)}))}))},setContent$1=function(editor,content,args){void 0===args&&(args={});var defaultedArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,selection:!0,content})}(args,content),updatedArgs=defaultedArgs;if(!defaultedArgs.no_events){var eventArgs=editor.fire("BeforeSetContent",defaultedArgs);if(eventArgs.isDefaultPrevented())return void editor.fire("SetContent",eventArgs);updatedArgs=eventArgs}updatedArgs.content=function(editor,args){if("raw"!==args.format){var rng=editor.selection.getRng(),contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock),contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{},node=editor.parser.parse(args.content,__assign(__assign({isRootContent:!0,forced_root_block:!1},contextArgs),args));return HtmlSerializer({validate:editor.validate},editor.schema).serialize(node)}return args.content}(editor,updatedArgs);var rng=editor.selection.getRng();!function(rng,fragment){var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom),lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents(),rng.insertNode(fragment);var prevText=firstChild.bind(prevSibling).filter(isText$8).bind(removeEmpty),nextText=lastChild.bind(nextSibling).filter(isText$8).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,!0),mergeAndNormalizeText(nextText,lastChild,rng,!1),rng.collapse(!1)}(rng,rng.createContextualFragment(updatedArgs.content)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng),updatedArgs.no_events||editor.fire("SetContent",updatedArgs)},deleteFromCallbackMap=function(callbackMap,selector,callback){if(callbackMap&&has$2(callbackMap,selector)){var newCallbacks=filter$4(callbackMap[selector],(function(cb){return cb!==callback}));0===newCallbacks.length?delete callbackMap[selector]:callbackMap[selector]=newCallbacks}};var merger,lookup,isNativeIeSelection=function(rng){return!!rng.select},isAttachedToDom=function(node){return!(!node||!node.ownerDocument)&&contains$1(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node))},EditorSelection=function(dom,win,serializer,editor){var selectedRange,explicitRange,selectorChangedWithUnbind=function SelectorChanged(dom,editor){var selectorChangedData,currentSelectors,findMatchingNode=function(selector,nodes){return find$3(nodes,(function(node){return dom.is(node,selector)}))},getParents=function(elem){return dom.getParents(elem,null,dom.getRoot())};return{selectorChangedWithUnbind:function(selector,callback){return selectorChangedData||(selectorChangedData={},currentSelectors={},editor.on("NodeChange",(function(e){var node=e.element,parents=getParents(node),matchedSelectors={};Tools.each(selectorChangedData,(function(callbacks,selector){findMatchingNode(selector,parents).each((function(node){currentSelectors[selector]||(each$k(callbacks,(function(callback){callback(!0,{node,selector,parents})})),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks}))})),Tools.each(currentSelectors,(function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],Tools.each(callbacks,(function(callback){callback(!1,{node,selector,parents})})))}))}))),selectorChangedData[selector]||(selectorChangedData[selector]=[]),selectorChangedData[selector].push(callback),findMatchingNode(selector,getParents(editor.selection.getStart())).each((function(){currentSelectors[selector]=selectorChangedData[selector]})),{unbind:function(){deleteFromCallbackMap(selectorChangedData,selector,callback),deleteFromCallbackMap(currentSelectors,selector,callback)}}}}}(dom,editor).selectorChangedWithUnbind,setContent=function(content,args){return setContent$1(editor,content,args)},collapse=function(toStart){var rng=getRng$1();rng.collapse(!!toStart),setRng(rng)},getSel=function(){return win.getSelection?win.getSelection():win.document.selection},getRng$1=function(){var selection,rng,elm,tryCompareBoundaryPoints=function(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}},doc=win.document;if(void 0!==editor.bookmark&&!1===hasFocus(editor)){var bookmark=getRng(editor);if(bookmark.isSome())return bookmark.map((function(r){return processRanges(editor,[r])[0]})).getOr(doc.createRange())}try{(selection=getSel())&&!isRestrictedNode(selection.anchorNode)&&(rng=selection.rangeCount>0?selection.getRangeAt(0):selection.createRange?selection.createRange():doc.createRange(),rng=processRanges(editor,[rng])[0])}catch(ex){}return rng||(rng=doc.createRange?doc.createRange():doc.body.createTextRange()),rng.setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(elm=dom.getRoot(),rng.setStart(elm,0),rng.setEnd(elm,0)),selectedRange&&explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)?rng=explicitRange:(selectedRange=null,explicitRange=null)),rng},setRng=function(rng,forward){var node;if(function(rng){return!!rng&&(!!isNativeIeSelection(rng)||isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer))}(rng)){var ieRange=isNativeIeSelection(rng)?rng:null;if(ieRange){explicitRange=null;try{ieRange.select()}catch(ex){}}else{var sel=getSel();if(rng=editor.fire("SetSelectionRange",{range:rng,forward}).range,sel){explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}!1===forward&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}rng.collapsed||rng.startContainer!==rng.endContainer||!sel.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset])&&"IMG"===node.tagName&&(sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),sel.anchorNode===rng.startContainer&&sel.focusNode===rng.endContainer||sel.setBaseAndExtent(node,0,node,1)),editor.fire("AfterSetSelectionRange",{range:rng,forward})}}},isForward=function(){var sel=getSel(),anchorNode=null==sel?void 0:sel.anchorNode,focusNode=null==sel?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode))return!0;var anchorRange=dom.createRng();anchorRange.setStart(anchorNode,sel.anchorOffset),anchorRange.collapse(!0);var focusRange=dom.createRng();return focusRange.setStart(focusNode,sel.focusOffset),focusRange.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0},exports={bookmarkManager:null,controlSelection:null,dom,win,serializer,editor,collapse,setCursorLocation:function(node,offset){var rng=dom.createRng();isNonNullable(node)&&isNonNullable(offset)?(rng.setStart(node,offset),rng.setEnd(node,offset),setRng(rng),collapse(!1)):(moveEndPoint(dom,rng,editor.getBody(),!0),setRng(rng))},getContent:function(args){return getContent$1(editor,args)},setContent,getBookmark:function(type,normalized){return bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){return function(dom,node,content){return Optional.from(node).map((function(node){var idx=dom.nodeIndex(node),rng=dom.createRng();return rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(moveEndPoint(dom,rng,node,!0),moveEndPoint(dom,rng,node,!1)),rng}))}(dom,node,content).each(setRng),node},isCollapsed:function(){var rng=getRng$1(),sel=getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},isForward,setNode:function(elm){return setContent(dom.getOuterHTML(elm)),elm},getNode:function(){return function(root,rng){var elm,startContainer,endContainer;if(!rng)return root;startContainer=rng.startContainer,endContainer=rng.endContainer;var startOffset=rng.startOffset,endOffset=rng.endOffset;return elm=rng.commonAncestorContainer,!rng.collapsed&&(startContainer===endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(elm=startContainer.childNodes[startOffset]),3===startContainer.nodeType&&3===endContainer.nodeType&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer))?startContainer:elm&&3===elm.nodeType?elm.parentNode:elm}(editor.getBody(),getRng$1())},getSel,setRng,getRng:getRng$1,getStart:function(real){return getStart(editor.getBody(),getRng$1(),real)},getEnd:function(real){return getEnd(editor.getBody(),getRng$1(),real)},getSelectedBlocks:function(startElm,endElm){return function(dom,rng,startElm,endElm){var node,selectedBlocks=[],root=dom.getRoot();if(startElm=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock),endElm=dom.getParent(endElm||getEnd(root,rng,rng.collapsed),dom.isBlock),startElm&&startElm!==root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!==endElm){node=startElm;for(var walker=new DomTreeWalker(startElm,root);(node=walker.next())&&node!==endElm;)dom.isBlock(node)&&selectedBlocks.push(node)}return endElm&&startElm!==endElm&&endElm!==root&&selectedBlocks.push(endElm),selectedBlocks}(dom,getRng$1(),startElm,endElm)},normalize:function(){var rng=getRng$1(),sel=getSel();if(!(getRanges(sel).length>1)&&hasAnyRanges(editor)){var normRng=normalize$2(dom,rng);return normRng.each((function(normRng){setRng(normRng,isForward())})),normRng.getOr(rng)}return rng},selectorChanged:function(selector,callback){return selectorChangedWithUnbind(selector,callback),exports},selectorChangedWithUnbind,getScrollContainer:function(){for(var scrollContainer,node=dom.getRoot();node&&"BODY"!==node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){isNonNullable(elm)?function(editor,element,alignToTop){(editor.inline?elementIntoWindow:elementIntoFrame)(editor,element,alignToTop)}(editor,elm,alignToTop):scrollRangeIntoView(editor,getRng$1(),alignToTop)},placeCaretAt:function(clientX,clientY){return setRng(fromPoint(clientX,clientY,editor.getDoc()))},getBoundingClientRect:function(){var rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy:function(){win=selectedRange=explicitRange=null,controlSelection.destroy()}},bookmarkManager=BookmarkManager(exports),controlSelection=ControlSelection(exports,editor);return exports.bookmarkManager=bookmarkManager,exports.controlSelection=controlSelection,exports},addFontToSpansFilter=function(domParser,styles,fontSizes){domParser.addNodeFilter("font",(function(nodes){each$k(nodes,(function(node){var props=styles.parse(node.attr("style")),color=node.attr("color"),face=node.attr("face"),size=node.attr("size");color&&(props.color=color),face&&(props["font-family"]=face),size&&(props["font-size"]=fontSizes[parseInt(node.attr("size"),10)-1]),node.name="span",node.attr("style",styles.serialize(props)),function(node,names){each$k(names,(function(name){node.attr(name,null)}))}(node,["color","face","size"])}))}))},addFilters=function(domParser,settings){var styles=Styles();settings.convert_fonts_to_spans&&addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values)),function(domParser,styles){domParser.addNodeFilter("strike",(function(nodes){each$k(nodes,(function(node){var props=styles.parse(node.attr("style"));props["text-decoration"]="line-through",node.name="span",node.attr("style",styles.serialize(props))}))}))}(domParser,styles)},parseDataUri=function(uri){var type,uriParts=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriParts[0]);return matches&&(type=matches[1]),{type,data:uriParts[1]}},buildBlob=function(type,data){var str;try{str=atob(data)}catch(e){return Optional.none()}for(var arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);return Optional.some(new Blob([arr],{type}))},uriToBlob=function(url){return 0===url.indexOf("blob:")?function(url){return new promiseObj((function(resolve,reject){var rejectWithError=function(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.")};try{var xhr_1=new XMLHttpRequest;xhr_1.open("GET",url,!0),xhr_1.responseType="blob",xhr_1.onload=function(){200===xhr_1.status?resolve(xhr_1.response):rejectWithError()},xhr_1.onerror=rejectWithError,xhr_1.send()}catch(ex){rejectWithError()}}))}(url):0===url.indexOf("data:")?(uri=url,new promiseObj((function(resolve){var _a=parseDataUri(uri),type=_a.type,data=_a.data;buildBlob(type,data).fold((function(){return resolve(new Blob([]))}),resolve)}))):null;var uri},count$1=0,uniqueId=function(prefix){return(prefix||"blobid")+count$1++},imageToBlobInfo=function(blobCache,img,resolve,reject){var base64,blobInfo;if(0!==img.src.indexOf("blob:")){var _a=parseDataUri(img.src),data=_a.data,type=_a.type;base64=data,(blobInfo=blobCache.getByData(base64,type))?resolve({image:img,blobInfo}):uriToBlob(img.src).then((function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo})}),(function(err){reject(err)}))}else(blobInfo=blobCache.getByUri(img.src))?resolve({image:img,blobInfo}):uriToBlob(img.src).then((function(blob){(function(blob){return new promiseObj((function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)}))})(blob).then((function(dataUri){base64=parseDataUri(dataUri).data,blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo})}))}),(function(err){reject(err)}))},ImageScanner=function(uploadStatus,blobCache){var cachedPromises={};return{findAll:function(elm,predicate){predicate||(predicate=always);var images=filter$4(function(elm){return elm?from(elm.getElementsByTagName("img")):[]}(elm),(function(img){var src=img.src;return!!Env.fileApi&&(!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src===Env.transparentSrc)&&(0===src.indexOf("blob:")?!uploadStatus.isUploaded(src)&&predicate(img):0===src.indexOf("data:")&&predicate(img)))))})),promises=map$3(images,(function(img){if(void 0!==cachedPromises[img.src])return new promiseObj((function(resolve){cachedPromises[img.src].then((function(imageInfo){if("string"==typeof imageInfo)return imageInfo;resolve({image:img,blobInfo:imageInfo.blobInfo})}))}));var newPromise=new promiseObj((function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject)})).then((function(result){return delete cachedPromises[result.image.src],result})).catch((function(error){return delete cachedPromises[img.src],error}));return cachedPromises[img.src]=newPromise,newPromise}));return promiseObj.all(promises)}}},paddEmptyNode=function(settings,args,blockElements,node){(settings.padd_empty_with_br||args.insert)&&blockElements[node.name]?node.empty().append(new AstNode("br",1)).shortEnded=!0:node.empty().append(new AstNode("#text",3)).value=""},hasOnlyChild=function(node,name){return node&&node.firstChild&&node.firstChild===node.lastChild&&node.firstChild.name===name},isEmpty=function(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,(function(node){return function(schema,node){var rule=schema.getElementRule(node.name);return rule&&rule.paddEmpty}(schema,node)}))},registerBase64ImageFilter=function(parser,settings){var blobCache=settings.blob_cache,processImage=function(img){var inputSrc=img.attr("src");(function(img){return img.attr("src")===Env.transparentSrc||isNonNullable(img.attr("data-mce-placeholder"))})(img)||function(img){return isNonNullable(img.attr("data-mce-bogus"))}(img)||function(uri){var matches=/data:([^;]+);base64,([a-z0-9\+\/=\s]+)/i.exec(uri);return matches?Optional.some({type:matches[1],data:decodeURIComponent(matches[2])}):Optional.none()}(inputSrc).filter((function(){return function(img,settings){if(settings.images_dataimg_filter){var imgElem_1=new Image;return imgElem_1.src=img.attr("src"),each$j(img.attributes.map,(function(value,key){imgElem_1.setAttribute(key,value)})),settings.images_dataimg_filter(imgElem_1)}return!0}(img,settings)})).bind((function(_a){var type=_a.type,data=_a.data;return Optional.from(blobCache.getByData(data,type)).orThunk((function(){return buildBlob(type,data).map((function(blob){var blobInfo=blobCache.create(uniqueId(),blob,data);return blobCache.add(blobInfo),blobInfo}))}))})).each((function(blobInfo){img.attr("src",blobInfo.blobUri())}))};blobCache&&parser.addAttributeFilter("src",(function(nodes){return each$k(nodes,processImage)}))},makeMap=Tools.makeMap,each$6=Tools.each,explode$2=Tools.explode,extend$4=Tools.extend,DomParser=function(settings,schema){void 0===schema&&(schema=Schema());var nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};(settings=settings||{}).validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body";var filterNode=function(node){var name=node.name;name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]);for(var i=attributeFilters.length;i--;){var list,attrName=attributeFilters[i].name;if(attrName in node.attributes.map)(list=matchedAttributes[attrName])?list.push(node):matchedAttributes[attrName]=[node]}return node},exports={schema,addAttributeFilter:function(name,callback){each$6(explode$2(name),(function(name){var i;for(i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name,callbacks:[callback]})}))},getAttributeFilters:function(){return[].concat(attributeFilters)},addNodeFilter:function(name,callback){each$6(explode$2(name),(function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)}))},getNodeFilters:function(){var out=[];for(var name_1 in nodeFilters)has$2(nodeFilters,name_1)&&out.push({name:name_1,callbacks:nodeFilters[name_1]});return out},filterNode,parse:function(html,args){var nodes,i,l,fi,fl,list,name,node,invalidChildren=[];args=args||{},matchedNodes={},matchedAttributes={};var blockElements=extend$4(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),textRootBlockElements=getTextRootBlockElements(schema),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,rootBlockName=function(name){return!1===name?"":!0===name?"p":name}("forced_root_block"in args?args.forced_root_block:settings.forced_root_block),whiteSpaceElements=schema.getWhiteSpaceElements(),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/,isInWhiteSpacePreservedElement=has$2(whiteSpaceElements,args.context)||has$2(whiteSpaceElements,settings.root_name),createNode=function(name,type){var list,node=new AstNode(name,type);return name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),node},removeWhitespaceBefore=function(node){for(var blockElements=schema.getBlockElements(),textNode=node.prev;textNode&&3===textNode.type;){var textVal=textNode.value.replace(endWhiteSpaceRegExp,"");if(textVal.length>0)return void(textNode.value=textVal);var textNodeNext=textNode.next;if(textNodeNext){if(3===textNodeNext.type&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&"script"!==textNodeNext.name&&"style"!==textNodeNext.name){textNode=textNode.prev;continue}}var sibling=textNode.prev;textNode.remove(),textNode=sibling}},parser=SaxParser({validate,document:settings.document,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,preserve_cdata:settings.preserve_cdata,self_closing_elements:function(input){var output={};for(var name_2 in input)"li"!==name_2&&"p"!==name_2&&(output[name_2]=input[name_2]);return output}(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;isInWhiteSpacePreservedElement||(text=text.replace(allWhiteSpaceRegExp," "),function(node,blockElements){return node&&(has$2(blockElements,node.name)||"br"===node.name)}(node.lastChild,blockElements)&&(text=text.replace(startWhiteSpaceRegExp,""))),0!==text.length&&((textNode=createNode("#text",3)).raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){node.append(createNode("#doctype",10)).value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var elementRule=validate?schema.getElementRule(name):{};if(elementRule){var newNode=createNode(elementRule.outputName||name,1);newNode.attributes=attrs,newNode.shortEnded=empty,node.append(newNode);var parent_2=children[node.name];parent_2&&children[newNode.name]&&!parent_2[newNode.name]&&invalidChildren.push(newNode);for(var attrFiltersLen=attributeFilters.length;attrFiltersLen--;){var attrName=attributeFilters[attrFiltersLen].name;attrName in attrs.map&&((list=matchedAttributes[attrName])?list.push(newNode):matchedAttributes[attrName]=[newNode])}blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,text,sibling,elementRule=validate?schema.getElementRule(name):{};if(elementRule){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if((textNode=node.firstChild)&&3===textNode.type)if((text=textNode.value.replace(startWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling;if((textNode=node.lastChild)&&3===textNode.type)if((text=textNode.value.replace(endWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling}isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1);var isNodeEmpty=isEmpty(schema,nonEmptyElements,whiteSpaceElements,node),parentNode=node.parent;elementRule.paddInEmptyBlock&&isNodeEmpty&&function(node){for(var tempNode=node;isNonNullable(tempNode);){if(tempNode.name in textRootBlockElements)return isEmpty(schema,nonEmptyElements,whiteSpaceElements,tempNode);tempNode=tempNode.parent}return!1}(node)?paddEmptyNode(settings,args,blockElements,node):elementRule.removeEmpty&&isNodeEmpty?blockElements[node.name]?node.empty().remove():node.unwrap():elementRule.paddEmpty&&(function(node){return hasOnlyChild(node,"#text")&&""===node.firstChild.value}(node)||isNodeEmpty)&&paddEmptyNode(settings,args,blockElements,node),node=parentNode}}},schema),rootNode=node=new AstNode(args.context||settings.root_name,11);if(parser.parse(html,args.format),validate&&invalidChildren.length&&(args.context?args.invalid=!0:function(nodes){for(var nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhiteSpaceElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements(),removeOrUnwrapInvalidNode=function(node,originalNodeParent){if(void 0===originalNodeParent&&(originalNodeParent=node.parent),specialElements[node.name])node.empty().remove();else{for(var _i=0,children_1=node.children();_i<children_1.length;_i++){var childNode=children_1[_i];schema.isValidChild(originalNodeParent.name,childNode.name)||removeOrUnwrapInvalidNode(childNode,originalNodeParent)}node.unwrap()}},ni=0;ni<nodes.length;ni++){var node=nodes[ni],parent_1=void 0,newParent=void 0,tempNode=void 0;if(node.parent&&!node.fixed)if(textBlockElements[node.name]&&"li"===node.parent.name){for(var sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap()}else{var parents=[node];for(parent_1=node.parent;parent_1&&!schema.isValidChild(parent_1.name,node.name)&&!nonSplitableElements[parent_1.name];parent_1=parent_1.parent)parents.push(parent_1);if(parent_1&&parents.length>1)if(schema.isValidChild(parent_1.name,node.name)){parents.reverse();for(var currentNode=newParent=filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode;for(var childNode=parents[i].firstChild;childNode&&childNode!==parents[i+1];){var nextNode=childNode.next;tempNode.append(childNode),childNode=nextNode}currentNode=tempNode}isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)?parent_1.insert(node,parents[0],!0):(parent_1.insert(newParent,parents[0],!0),parent_1.insert(node,newParent)),parent_1=parents[0],(isEmpty(schema,nonEmptyElements,whitespaceElements,parent_1)||hasOnlyChild(parent_1,"br"))&&parent_1.empty().remove()}else removeOrUnwrapInvalidNode(node);else if(node.parent){if("li"===node.name){if((sibling=node.prev)&&("ul"===sibling.name||"ol"===sibling.name)){sibling.append(node);continue}if((sibling=node.next)&&("ul"===sibling.name||"ol"===sibling.name)){sibling.insert(node,sibling.firstChild,!0);continue}node.wrap(filterNode(new AstNode("ul",1)));continue}schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(filterNode(new AstNode("div",1))):removeOrUnwrapInvalidNode(node)}}}}(invalidChildren)),rootBlockName&&("body"===rootNode.name||args.isRootContent)&&function(){var node=rootNode.firstChild,rootBlockNode=null,trim=function(rootBlock){rootBlock&&((node=rootBlock.firstChild)&&3===node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),(node=rootBlock.lastChild)&&3===node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))};if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;){var next=node.next;3===node.type||1===node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?(rootBlockNode||((rootBlockNode=createNode(rootBlockName,1)).attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node)),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next}trim(rootBlockNode)}}(),!args.invalid){for(name in matchedNodes)if(has$2(matchedNodes,name)){for(list=nodeFilters[name],fi=(nodes=matchedNodes[name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if((list=attributeFilters[i]).name in matchedAttributes){for(fi=(nodes=matchedAttributes[list.name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode}};return function(parser,settings){var schema=parser.schema;settings.remove_trailing_brs&&parser.addNodeFilter("br",(function(nodes,_,args){var i,node,parent,lastParent,prev,prevName,elementRule,textNode,l=nodes.length,blockElements=Tools.extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),whiteSpaceElements=schema.getWhiteSpaceElements();for(blockElements.body=1,i=0;i<l;i++)if(parent=(node=nodes[i]).parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if("span"!==(prevName=prev.name)||"bookmark"!==prev.attr("data-mce-type")){"br"===prevName&&(node=null);break}prev=prev.prev}node&&(node.remove(),isEmpty(schema,nonEmptyElements,whiteSpaceElements,parent)&&(elementRule=schema.getElementRule(parent.name))&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,args,blockElements,parent)))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&(lastParent=parent,!blockElements[parent.name]);)parent=parent.parent;lastParent===parent&&!0!==settings.padd_empty_with_br&&((textNode=new AstNode("#text",3)).value="",node.replace(textNode))}})),parser.addAttributeFilter("href",(function(nodes){var rel,newRel,i=nodes.length;if(!settings.allow_unsafe_link_target)for(;i--;){var node=nodes[i];"a"===node.name&&"_blank"===node.attr("target")&&node.attr("rel",(newRel=void 0,newRel=(rel=node.attr("rel"))?Tools.trim(rel):"",/\b(noopener)\b/g.test(newRel)?newRel:function(rel){return rel.split(" ").filter((function(p){return p.length>0})).concat(["noopener"]).sort().join(" ")}(newRel)))}})),settings.allow_html_in_named_anchor||parser.addAttributeFilter("id,name",(function(nodes){for(var sibling,prevSibling,parent,node,i=nodes.length;i--;)if("a"===(node=nodes[i]).name&&node.firstChild&&!node.attr("href")){parent=node.parent,sibling=node.lastChild;do{prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling}while(sibling)}})),settings.fix_list_elements&&parser.addNodeFilter("ul,ol",(function(nodes){for(var node,parentNode,i=nodes.length;i--;)if("ul"===(parentNode=(node=nodes[i]).parent).name||"ol"===parentNode.name)if(node.prev&&"li"===node.prev.name)node.prev.append(node);else{var li=new AstNode("li",1);li.attr("style","list-style-type: none"),node.wrap(li)}})),settings.validate&&schema.getValidClasses()&&parser.addAttributeFilter("class",(function(nodes){for(var validClasses=schema.getValidClasses(),i=nodes.length;i--;){for(var node=nodes[i],classList=node.attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++){var className=classList[ci],valid=!1,validClassesMap=validClasses["*"];validClassesMap&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className)}classValue.length||(classValue=null),node.attr("class",classValue)}})),registerBase64ImageFilter(parser,settings)}(exports,settings),function(domParser,settings){settings.inline_styles&&addFilters(domParser,settings)}(exports,settings),exports},process=function(editor,node,args){return function(editor,args){return editor&&editor.hasEventListeners("PreProcess")&&!args.no_events}(editor,args)?function(editor,node,args){var oldDoc,dom=editor.dom,clonedNode=node.cloneNode(!0),impl=document.implementation;if(impl.createHTMLDocument){var doc_1=impl.createHTMLDocument("");Tools.each("BODY"===clonedNode.nodeName?clonedNode.childNodes:[clonedNode],(function(node){doc_1.body.appendChild(doc_1.importNode(node,!0))})),clonedNode="BODY"!==clonedNode.nodeName?doc_1.body.firstChild:doc_1.body,oldDoc=dom.doc,dom.doc=doc_1}return function(editor,args){editor.fire("PreProcess",args)}(editor,__assign(__assign({},args),{node:clonedNode})),oldDoc&&(dom.doc=oldDoc),clonedNode}(editor,node,args):node},addTempAttr=function(htmlParser,tempAttrs,name){-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,(function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)})),tempAttrs.push(name))},toHtml=function(editor,settings,schema,rootNode,args){var content=function(settings,schema,node){return HtmlSerializer(settings,schema).serialize(node)}(settings,schema,rootNode);return function(editor,args,content){if(!args.no_events&&editor){var outArgs=function(editor,args){return editor.fire("PostProcess",args)}(editor,__assign(__assign({},args),{content}));return outArgs.content}return content}(editor,args,content)},DomSerializerImpl=function(settings,editor){var tempAttrs=["data-mce-selected"],dom=editor&&editor.dom?editor.dom:DOMUtils.DOM,schema=editor&&editor.schema?editor.schema:Schema(settings);settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs;var htmlParser=DomParser(settings,schema);!function(htmlParser,settings,dom){htmlParser.addAttributeFilter("data-mce-tabindex",(function(nodes,name){for(var i=nodes.length;i--;){var node=nodes[i];node.attr("tabindex",node.attr("data-mce-tabindex")),node.attr(name,null)}})),htmlParser.addAttributeFilter("src,href,style",(function(nodes,name){for(var internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope,i=nodes.length;i--;){var node=nodes[i],value=node.attr(internalName);void 0!==value?(node.attr(name,value.length>0?value:null),node.attr(internalName,null)):(value=node.attr(name),"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,value.length>0?value:null))}})),htmlParser.addAttributeFilter("class",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i],value=node.attr("class");value&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",value.length>0?value:null))}})),htmlParser.addAttributeFilter("data-mce-type",(function(nodes,name,args){for(var i=nodes.length;i--;){var node=nodes[i];if("bookmark"===node.attr("data-mce-type")&&!args.cleanup){var hasChildren=Optional.from(node.firstChild).exists((function(firstChild){return!isZwsp(firstChild.value)}));hasChildren?node.unwrap():node.remove()}}})),htmlParser.addNodeFilter("noscript",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i].firstChild;node&&(node.value=Entities.decode(node.value))}})),htmlParser.addNodeFilter("script,style",(function(nodes,name){for(var trim=function(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")},i=nodes.length;i--;){var node=nodes[i],value=node.firstChild?node.firstChild.value:"";if("script"===name){var type=node.attr("type");type&&node.attr("type","mce-no/type"===type?null:type.replace(/^mce\-/,"")),"xhtml"===settings.element_format&&value.length>0&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")}else"xhtml"===settings.element_format&&value.length>0&&(node.firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")}})),htmlParser.addNodeFilter("#comment",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];settings.preserve_cdata&&0===node.value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=dom.decode(node.value.replace(/^\[CDATA\[|\]\]$/g,""))):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))}})),htmlParser.addNodeFilter("xml:namespace,input",(function(nodes,name){for(var i=nodes.length;i--;){var node=nodes[i];7===node.type?node.remove():1===node.type&&("input"!==name||node.attr("type")||node.attr("type","text"))}})),htmlParser.addAttributeFilter("data-mce-type",(function(nodes){each$k(nodes,(function(node){"format-caret"===node.attr("data-mce-type")&&(node.isEmpty(htmlParser.schema.getNonEmptyElements())?node.remove():node.unwrap())}))})),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize,data-mce-placeholder",(function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}))}(htmlParser,settings,dom);return{schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,parserArgs){void 0===parserArgs&&(parserArgs={});var args=__assign({format:"html"},parserArgs),targetNode=process(editor,node,args),html=function(dom,node,args){var html=trim$2(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html)}(dom,targetNode,args),rootNode=function(htmlParser,html,args){var parserArgs=args.selection?__assign({forced_root_block:!1},args):args,rootNode=htmlParser.parse(html,parserArgs);return function(rootNode){var isBr=function(node){return node&&"br"===node.name},brNode1=rootNode.lastChild;if(isBr(brNode1)){var brNode2=brNode1.prev;isBr(brNode2)&&(brNode1.remove(),brNode2.remove())}}(rootNode),rootNode}(htmlParser,html,args);return"tree"===args.format?rootNode:toHtml(editor,settings,schema,rootNode,args)},addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters}},DomSerializer=function(settings,editor){var domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters}},getContent=function(editor,args){return void 0===args&&(args={}),function(editor,args,format){return getRtcInstanceWithFallback(editor).editor.getContent(args,format)}(editor,args,args.format?args.format:"html")},setContent=function(editor,content,args){return void 0===args&&(args={}),function(editor,content,args){return getRtcInstanceWithFallback(editor).editor.setContent(content,args)}(editor,content,args)},DOM$7=DOMUtils.DOM,safeDestroy=function(x){return Optional.from(x).each((function(x){return x.destroy()}))},remove=function(editor){if(!editor.removed){var _selectionOverrides=editor._selectionOverrides,editorUpload=editor.editorUpload,body=editor.getBody(),element=editor.getElement();body&&editor.save({is_removing:!0}),editor.removed=!0,editor.unbindAllNativeEvents(),editor.hasHiddenInput&&element&&DOM$7.remove(element.nextSibling),function(editor){editor.fire("remove")}(editor),editor.editorManager.remove(editor),!editor.inline&&body&&function(editor){DOM$7.setStyle(editor.id,"display",editor.orgDisplay)}(editor),function(editor){editor.fire("detach")}(editor),DOM$7.remove(editor.getContainer()),safeDestroy(_selectionOverrides),safeDestroy(editorUpload),editor.destroy()}},destroy=function(editor,automatic){var selection=editor.selection,dom=editor.dom;editor.destroyed||(automatic||editor.removed?(automatic||(editor.editorManager.off("beforeunload",editor._beforeUnload),editor.theme&&editor.theme.destroy&&editor.theme.destroy(),safeDestroy(selection),safeDestroy(dom)),function(editor){var form=editor.formElement;form&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM$7.unbind(form,"submit reset",editor.formEventDelegate))}(editor),function(editor){editor.contentAreaContainer=editor.formElement=editor.container=editor.editorContainer=null,editor.bodyElement=editor.contentDocument=editor.contentWindow=null,editor.iframeElement=editor.targetElm=null,editor.selection&&(editor.selection=editor.selection.win=editor.selection.dom=editor.selection.dom.doc=null)}(editor),editor.destroyed=!0):editor.remove())},deepMerge=(merger=function(old,nu){return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu},function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}),deprecatedSettings="autoresize_on_init,content_editable_state,convert_fonts_to_spans,inline_styles,padd_empty_with_br,block_elements,boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,tab_focus,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists".split(","),deprecatedPlugins="bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor".split(","),movedToPremiumPlugins="imagetools,toc".split(","),getDeprecatedSettings=function(settings){var settingNames=filter$4(deprecatedSettings,(function(setting){return has$2(settings,setting)})),forcedRootBlock=settings.forced_root_block;return!1!==forcedRootBlock&&""!==forcedRootBlock||settingNames.push("forced_root_block (false only)"),sort(settingNames)},getDeprecatedPlugins=function(settings){var plugins=Tools.makeMap(settings.plugins," "),hasPlugin=function(plugin){return has$2(plugins,plugin)},pluginNames=__spreadArray(__spreadArray([],filter$4(deprecatedPlugins,hasPlugin),!0),bind(movedToPremiumPlugins,(function(plugin){return hasPlugin(plugin)?[plugin+" (moving to premium)"]:[]})),!0);return sort(pluginNames)},deviceDetection=detect().deviceType,isTouch=deviceDetection.isTouch(),isPhone=deviceDetection.isPhone(),isTablet=deviceDetection.isTablet(),legacyMobilePlugins=["lists","autolink","autosave"],defaultTouchSettings={table_grid:!1,object_resizing:!1,resize:!1},normalizePlugins=function(plugins){var pluginNames=isArray$1(plugins)?plugins.join(" "):plugins,trimmedPlugins=map$3(isString$1(pluginNames)?pluginNames.split(" "):[],trim$4);return filter$4(trimmedPlugins,(function(item){return item.length>0}))},extractSections=function(keys,settings){var t,f,result=(f={},internalFilter(settings,(function(value,key){return contains$3(keys,key)}),objAcc(t={}),objAcc(f)),{t,f});return function(sections,settings){return{sections:constant(sections),settings:constant(settings)}}(result.t,result.f)},hasSection=function(sectionResult,name){return has$2(sectionResult.sections(),name)},getToolbarMode=function(settings,defaultVal){return get$9(settings,"toolbar_mode").orThunk((function(){return get$9(settings,"toolbar_drawer").map((function(val){return!1===val?"wrap":val}))})).getOr(defaultVal)},getDefaultMobileSettings=function(mobileSettings,isPhone){var defaultMobileSettings={resize:!1,toolbar_mode:getToolbarMode(mobileSettings,"scrolling"),toolbar_sticky:!1};return __assign(__assign(__assign({},defaultTouchSettings),defaultMobileSettings),isPhone?{menubar:!1}:{})},getExternalPlugins=function(overrideSettings,settings){var userDefinedExternalPlugins=settings.external_plugins?settings.external_plugins:{};return overrideSettings&&overrideSettings.external_plugins?Tools.extend({},overrideSettings.external_plugins,userDefinedExternalPlugins):userDefinedExternalPlugins},getPlatformPlugins=function(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins){return isMobileDevice&&function(sectionResult,name,theme){var section=sectionResult.sections();return hasSection(sectionResult,name)&&section[name].theme===theme}(sectionResult,"mobile","mobile")?filter$4(mobilePlugins,curry(contains$3,legacyMobilePlugins)):isMobileDevice&&hasSection(sectionResult,"mobile")?mobilePlugins:desktopPlugins},processPlugins=function(isMobileDevice,sectionResult,defaultOverrideSettings,settings){var forcedPlugins=normalizePlugins(defaultOverrideSettings.forced_plugins),desktopPlugins=normalizePlugins(settings.plugins),mobileConfig=function(sectionResult,name){return hasSection(sectionResult,name)?sectionResult.sections()[name]:{}}(sectionResult,"mobile"),mobilePlugins=mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins,combinedPlugins=function(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins))}(forcedPlugins,getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins));if(Env.browser.isIE()&&contains$3(combinedPlugins,"rtc"))throw new Error("RTC plugin is not supported on IE 11.");return Tools.extend(settings,{plugins:combinedPlugins.join(" ")})},combineSettings=function(isMobileDevice,isPhone,defaultSettings,defaultOverrideSettings,settings){var defaultDeviceSettings=isMobileDevice?{mobile:getDefaultMobileSettings(settings.mobile||{},isPhone)}:{},sectionResult=extractSections(["mobile"],deepMerge(defaultDeviceSettings,settings)),extendedSettings=Tools.extend(defaultSettings,defaultOverrideSettings,sectionResult.settings(),function(isMobileDevice,sectionResult){return isMobileDevice&&hasSection(sectionResult,"mobile")}(isMobileDevice,sectionResult)?function(sectionResult,name,defaults){void 0===defaults&&(defaults={});var sections=sectionResult.sections(),sectionSettings=get$9(sections,name).getOr({});return Tools.extend({},defaults,sectionSettings)}(sectionResult,"mobile"):{},{validate:!0,external_plugins:getExternalPlugins(defaultOverrideSettings,sectionResult.settings())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideSettings,extendedSettings)},getEditorSettings=function(editor,id,documentBaseUrl,defaultOverrideSettings,settings){var defaultSettings=function(settings,id,documentBaseUrl,isTouch,editor){var baseDefaults={id,theme:"silver",toolbar_mode:getToolbarMode(settings,"floating"),plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,inline_styles:!0,convert_fonts_to_spans:!0,indent:!0,indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:editor.convertURL,url_converter_scope:editor};return __assign(__assign({},baseDefaults),isTouch?defaultTouchSettings:{})}(settings,id,documentBaseUrl,isTouch,editor),finalSettings=combineSettings(isPhone||isTablet,isPhone,defaultSettings,defaultOverrideSettings,settings);return!1!==finalSettings.deprecation_warnings&&function(rawSettings,finalSettings){var deprecatedSettings=getDeprecatedSettings(rawSettings),deprecatedPlugins=getDeprecatedPlugins(finalSettings),hasDeprecatedPlugins=deprecatedPlugins.length>0,hasDeprecatedSettings=deprecatedSettings.length>0,isLegacyMobileTheme="mobile"===finalSettings.theme;if(hasDeprecatedPlugins||hasDeprecatedSettings||isLegacyMobileTheme){var themesMessage=isLegacyMobileTheme?"\n\nThemes:\n- mobile":"",pluginsMessage=hasDeprecatedPlugins?"\n\nPlugins:\n- "+deprecatedPlugins.join("\n- "):"",settingsMessage=hasDeprecatedSettings?"\n\nSettings:\n- "+deprecatedSettings.join("\n- "):"";console.warn("The following deprecated features are currently enabled, these will be removed in TinyMCE 6.0. See https://www.tiny.cloud/docs/release-notes/6.0-upcoming-changes/ for more information."+themesMessage+pluginsMessage+settingsMessage)}}(settings,finalSettings),finalSettings},getFiltered=function(predicate,editor,name){return Optional.from(editor.settings[name]).filter(predicate)},getParam=function(editor,name,defaultVal,type){var p,value=name in editor.settings?editor.settings[name]:defaultVal;return"hash"===type?function(value){var output={};return"string"==typeof value?each$k(value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),(function(val){var arr=val.split("=");arr.length>1?output[Tools.trim(arr[0])]=Tools.trim(arr[1]):output[Tools.trim(arr[0])]=Tools.trim(arr[0])})):output=value,output}(value):"string"===type?getFiltered(isString$1,editor,name).getOr(defaultVal):"number"===type?getFiltered(isNumber,editor,name).getOr(defaultVal):"boolean"===type?getFiltered(isBoolean,editor,name).getOr(defaultVal):"object"===type?getFiltered(isObject,editor,name).getOr(defaultVal):"array"===type?getFiltered(isArray$1,editor,name).getOr(defaultVal):"string[]"===type?getFiltered((p=isString$1,function(a){return isArray$1(a)&&forall(a,p)}),editor,name).getOr(defaultVal):"function"===type?getFiltered(isFunction,editor,name).getOr(defaultVal):value},IconManager=(lookup={},{add:function(id,iconPack){lookup[id]=iconPack},get:function(id){return lookup[id]?lookup[id]:{icons:{}}},has:function(id){return has$2(lookup,id)}}),getProp=function(propName,elm){return elm.dom[propName]},getComputedSizeProp=function(propName,elm){return parseInt(get$5(elm,propName),10)},getClientWidth=curry(getProp,"clientWidth"),getClientHeight=curry(getProp,"clientHeight"),getMarginTop=curry(getComputedSizeProp,"margin-top"),getMarginLeft=curry(getComputedSizeProp,"margin-left"),isXYInContentArea=function(editor,clientX,clientY){var element,bodyElm=SugarElement.fromDom(editor.getBody()),targetElm=editor.inline?bodyElm:(element=bodyElm,SugarElement.fromDom(documentOrOwner(element).dom.documentElement)),transposedPoint=function(inline,elm,clientX,clientY){var clientRect=function(elm){return elm.dom.getBoundingClientRect()}(elm);return{x:clientX-(inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0),y:clientY-(inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0)}}(editor.inline,targetElm,clientX,clientY);return function(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm),clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight}(targetElm,transposedPoint.x,transposedPoint.y)},isEditorAttachedToDom=function(editor){var node,rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return(node=rawContainer,Optional.from(node).map(SugarElement.fromDom)).map(inBody).getOr(!1)},NotificationManager=function(editor){var notifications=[],getImplementation=function(){var unimplemented,theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():{open:unimplemented=function(){throw new Error("Theme did not provide a NotificationManager implementation.")},close:unimplemented,reposition:unimplemented,getArgs:unimplemented}},getTopNotification=function(){return Optional.from(notifications[0])},reposition=function(){notifications.length>0&&getImplementation().reposition(notifications)},closeNotification=function(notification){findIndex$2(notifications,(function(otherNotification){return otherNotification===notification})).each((function(index){notifications.splice(index,1)}))},open=function(spec,fireEvent){if(void 0===fireEvent&&(fireEvent=!0),!editor.removed&&isEditorAttachedToDom(editor))return fireEvent&&editor.fire("BeforeOpenNotification",{notification:spec}),find$3(notifications,(function(notification){return a=getImplementation().getArgs(notification),b=spec,!(a.type!==b.type||a.text!==b.text||a.progressBar||a.timeout||b.progressBar||b.timeout);var a,b})).getOrThunk((function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,(function(){closeNotification(notification),reposition(),getTopNotification().fold((function(){return editor.focus()}),(function(top){return SugarElement.fromDom(top.getEl()).dom.focus()}))}));return function(notification){notifications.push(notification)}(notification),reposition(),editor.fire("OpenNotification",{notification:__assign({},notification)}),notification}))},getNotifications=constant(notifications);return function(editor){editor.on("SkinLoaded",(function(){var serviceMessage=function(editor){return editor.getParam("service_message")}(editor);serviceMessage&&open({text:serviceMessage,type:"warning",timeout:0},!1),reposition()})),editor.on("show ResizeEditor ResizeWindow NodeChange",(function(){Delay.requestAnimationFrame(reposition)})),editor.on("remove",(function(){each$k(notifications.slice(),(function(notification){getImplementation().close(notification)}))}))}(editor),{open,close:function(){getTopNotification().each((function(notification){getImplementation().close(notification),closeNotification(notification),reposition()}))},getNotifications}},PluginManager=AddOnManager.PluginManager,ThemeManager=AddOnManager.ThemeManager;var WindowManager=function(editor){var dialogs=[],getImplementation=function(){var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():function WindowManagerImpl(){var unimplemented=function(){throw new Error("Theme did not provide a WindowManager implementation.")};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented}}()},funcBind=function(scope,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f?f.apply(scope,args):void 0}},addDialog=function(dialog){dialogs.push(dialog),function(dialog){editor.fire("OpenWindow",{dialog})}(dialog)},closeDialog=function(dialog){!function(dialog){editor.fire("CloseWindow",{dialog})}(dialog),0===(dialogs=filter$4(dialogs,(function(otherDialog){return otherDialog!==dialog}))).length&&editor.focus()},storeSelectionAndOpenDialog=function(openDialog){editor.editorManager.setActive(editor),store(editor);var dialog=openDialog();return addDialog(dialog),dialog};return editor.on("remove",(function(){each$k(dialogs,(function(dialog){getImplementation().close(dialog)}))})),{open:function(args,params){return storeSelectionAndOpenDialog((function(){return getImplementation().open(args,params,closeDialog)}))},openUrl:function(args){return storeSelectionAndOpenDialog((function(){return getImplementation().openUrl(args,closeDialog)}))},alert:function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope||windowManagerImpl,callback))},confirm:function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope||windowManagerImpl,callback))},close:function(){Optional.from(dialogs[dialogs.length-1]).each((function(dialog){getImplementation().close(dialog),closeDialog(dialog)}))}}},displayNotification=function(editor,message){editor.notificationManager.open({type:"error",text:message})},displayError=function(editor,message){editor._skinLoaded?displayNotification(editor,message):editor.on("SkinLoaded",(function(){displayNotification(editor,message)}))},logError=function(editor,errorType,msg){fireError(editor,errorType,{message:msg}),console.error(msg)},createLoadError=function(type,url,name){return name?"Failed to load "+type+": "+name+" from url "+url:"Failed to load "+type+" url: "+url},pluginLoadError=function(editor,url,name){logError(editor,"PluginLoadError",createLoadError("plugin",url,name))},initError=function(message){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var console=window.console;console&&(console.error?console.error.apply(console,__spreadArray([message],x,!1)):console.log.apply(console,__spreadArray([message],x,!1)))},getContentCssUrls=function(editor){return transformToUrls(editor,function(editor){var contentCss=editor.getParam("content_css");return isString$1(contentCss)?map$3(contentCss.split(","),trim$4):isArray$1(contentCss)?contentCss:!1===contentCss||editor.inline?[]:["default"]}(editor))},transformToUrls=function(editor,cssLinks){var skinUrl=editor.editorManager.baseURL+"/skins/content",contentCssFile="content"+editor.editorManager.suffix+".css",inline=!0===editor.inline;return map$3(cssLinks,(function(url){return function(url){return/^[a-z0-9\-]+$/i.test(url)}(url)&&!inline?skinUrl+"/"+url+"/"+contentCssFile:editor.documentBaseURI.toAbsolute(url)}))},appendContentCssFromSettings=function(editor){editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),function(editor){return transformToUrls(editor,getFontCss(editor))}(editor))},UploadStatus=function(){var blobUriStatuses={},createStatus=function(status,resultUri){return{status,resultUri}},hasBlobUri=function(blobUri){return blobUri in blobUriStatuses};return{hasBlobUri,getResultUri:function(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null},isPending:function(blobUri){return!!hasBlobUri(blobUri)&&1===blobUriStatuses[blobUri].status},isUploaded:function(blobUri){return!!hasBlobUri(blobUri)&&2===blobUriStatuses[blobUri].status},markPending:function(blobUri){blobUriStatuses[blobUri]=createStatus(1,null)},markUploaded:function(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(2,resultUri)},removeFailed:function(blobUri){delete blobUriStatuses[blobUri]},destroy:function(){blobUriStatuses={}}}},count=0,uuid=function(prefix){return prefix+count+++(rnd=function(){return Math.round(4294967295*Math.random()).toString(36)},"s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd());var rnd},Uploader=function(uploadStatus,settings){var pendingPromises={},defaultHandler=function(blobInfo,success,failure,progress){var xhr=new XMLHttpRequest;xhr.open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){if(xhr.status<200||xhr.status>=300)failure("HTTP Error: "+xhr.status);else{var path1,path2,json=JSON.parse(xhr.responseText);if(json&&"string"==typeof json.location)success((path1=settings.basePath,path2=json.location,path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2));else failure("Invalid JSON: "+xhr.responseText)}};var formData=new FormData;formData.append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)},handlerSuccess=function(blobInfo,url){return{url,blobInfo,status:!0}},handlerFailure=function(blobInfo,message,options){return{url:"",blobInfo,status:!1,error:{message,options}}},resolvePending=function(blobUri,result){Tools.each(pendingPromises[blobUri],(function(resolve){resolve(result)})),delete pendingPromises[blobUri]},uploadBlobs=function(blobInfos,openNotification){return blobInfos=Tools.grep(blobInfos,(function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri())})),promiseObj.all(Tools.map(blobInfos,(function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?function(blobInfo){var blobUri=blobInfo.blobUri();return new promiseObj((function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)}))}(blobInfo):function(blobInfo,handler,openNotification){return uploadStatus.markPending(blobInfo.blobUri()),new promiseObj((function(resolve){var notification;try{var closeNotification_1=function(){notification&&notification.close()};handler(blobInfo,(function(url){closeNotification_1(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))}),(function(error,options){var failureOptions=options||{};closeNotification_1(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error,failureOptions)),resolve(handlerFailure(blobInfo,error,failureOptions))}),(function(percent){percent<0||percent>100||Optional.from(notification).orThunk((function(){return Optional.from(openNotification).map(apply)})).each((function(n){notification=n,n.progressBar.value(percent)}))}))}catch(ex){resolve(handlerFailure(blobInfo,ex.message,{}))}}))}(blobInfo,settings.handler,openNotification)})))};return!1===isFunction(settings.handler)&&(settings.handler=defaultHandler),{upload:function(blobInfos,openNotification){return settings.url||settings.handler!==defaultHandler?uploadBlobs(blobInfos,openNotification):new promiseObj((function(resolve){resolve([])}))}}},openNotification=function(editor){return function(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}},createUploader=function(editor,uploadStatus){return Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)})},EditorUpload=function(editor){var uploader,imageScanner,blobCache=function(){var cache=[],toBlobInfo=function(o){if(!o.blob||!o.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");var mime,id=o.id||uuid("blobid"),name=o.name||id,blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+"."+(mime=blob.type,{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png","image/apng":"apng","image/avif":"avif","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"}[mime.toLowerCase()]||"dat")),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)}},findFirst=function(predicate){return find$3(cache,predicate).getOrUndefined()},get=function(id){return findFirst((function(cachedBlobInfo){return cachedBlobInfo.id()===id}))};return{create:function(o,blob,base64,name,filename){if(isString$1(o))return toBlobInfo({id:o,name,filename,blob,base64});if(isObject(o))return toBlobInfo(o);throw new Error("Unknown input type")},add:function(blobInfo){get(blobInfo.id())||cache.push(blobInfo)},get,getByUri:function(blobUri){return findFirst((function(blobInfo){return blobInfo.blobUri()===blobUri}))},getByData:function(base64,type){return findFirst((function(blobInfo){return blobInfo.base64()===base64&&blobInfo.blob().type===type}))},findFirst,removeByUri:function(blobUri){cache=filter$4(cache,(function(blobInfo){return blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)}))},destroy:function(){each$k(cache,(function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())})),cache=[]}}}(),uploadStatus=UploadStatus(),urlFilters=[],changeHandler=function(editor){var lastChangedLevel=Cell(null);return editor.on("change AddUndo",(function(e){lastChangedLevel.set(__assign({},e.level))})),{fireIfChanged:function(){var data=editor.undoManager.data;last$2(data).filter((function(level){return!isEq$1(lastChangedLevel.get(),level)})).each((function(level){editor.setDirty(!0),editor.fire("change",{level,lastLevel:get$a(data,data.length-2).getOrNull()})}))}}}(editor),aliveGuard=function(callback){return function(result){return editor.selection?callback(result):[]}},replaceString=function(content,search,replace){var index=0;do{-1!==(index=content.indexOf(search,index))&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1)}while(-1!==index);return content},replaceImageUrl=function(content,targetUrl,replacementUrl){var replacementString='src="'+replacementUrl+'"'+(replacementUrl===Env.transparentSrc?' data-mce-placeholder="1"':"");return content=replaceString(content,'src="'+targetUrl+'"',replacementString),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')},replaceUrlInUndoStack=function(targetUrl,replacementUrl){each$k(editor.undoManager.data,(function(level){"fragmented"===level.type?level.fragments=map$3(level.fragments,(function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl)})):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)}))},uploadImages=function(callback){return uploader||(uploader=createUploader(editor,uploadStatus)),scanForImages().then(aliveGuard((function(imageInfos){var blobInfos=map$3(imageInfos,(function(imageInfo){return imageInfo.blobInfo}));return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard((function(result){var imagesToRemove=[],filteredResult=map$3(result,(function(uploadInfo,index){var blobInfo=imageInfos[index].blobInfo,image=imageInfos[index].image;return uploadInfo.status&&function(editor){return editor.getParam("images_replace_blob_uris",!0,"boolean")}(editor)?(blobCache.removeByUri(image.src),isRtc(editor)||function(image,resultUri){var url,src=editor.convertURL(resultUri,"src");replaceUrlInUndoStack(image.src,resultUri),editor.$(image).attr({src:shouldReuseFileName(editor)?(url=resultUri,url+(-1===url.indexOf("?")?"?":"&")+(new Date).getTime()):resultUri,"data-mce-src":src})}(image,uploadInfo.url)):uploadInfo.error&&(uploadInfo.error.options.remove&&(replaceUrlInUndoStack(image.getAttribute("src"),Env.transparentSrc),imagesToRemove.push(image)),function(editor,message){displayError(editor,I18n.translate(["Failed to upload image: {0}",message]))}(editor,uploadInfo.error.message)),{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo}}));return filteredResult.length>0&&changeHandler.fireIfChanged(),imagesToRemove.length>0&&(isRtc(editor)?console.error("Removing images on failed uploads is currently unsupported for RTC"):editor.undoManager.transact((function(){each$k(imagesToRemove,(function(element){editor.dom.remove(element),blobCache.removeByUri(element.src)}))}))),callback&&callback(filteredResult),filteredResult})))})))},uploadImagesAuto=function(callback){if(isAutomaticUploadsEnabled(editor))return uploadImages(callback)},isValidDataUriImage=function(imgElm){if(!1===forall(urlFilters,(function(filter){return filter(imgElm)})))return!1;if(0===imgElm.getAttribute("src").indexOf("data:")){var dataImgFilter=function(editor){return editor.getParam("images_dataimg_filter",always,"function")}(editor);return dataImgFilter(imgElm)}return!0},scanForImages=function(){return imageScanner||(imageScanner=ImageScanner(uploadStatus,blobCache)),imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard((function(result){return result=filter$4(result,(function(resultItem){return"string"!=typeof resultItem||(displayError(editor,resultItem),!1)})),isRtc(editor)||each$k(result,(function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")})),result})))},replaceBlobUris=function(content){return content.replace(/src="(blob:[^"]+)"/g,(function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';var blobInfo=blobCache.getByUri(blobUri);return blobInfo||(blobInfo=foldl(editor.editorManager.get(),(function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)}),null)),blobInfo?'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"':match}))};return editor.on("SetContent",(function(){isAutomaticUploadsEnabled(editor)?uploadImagesAuto():scanForImages()})),editor.on("RawSaveContent",(function(e){e.content=replaceBlobUris(e.content)})),editor.on("GetContent",(function(e){e.source_view||"raw"===e.format||"tree"===e.format||(e.content=replaceBlobUris(e.content))})),editor.on("PostRender",(function(){editor.parser.addNodeFilter("img",(function(images){each$k(images,(function(img){var src=img.attr("src");if(!blobCache.getByUri(src)){var resultUri=uploadStatus.getResultUri(src);resultUri&&img.attr("src",resultUri)}}))}))})),{blobCache,addFilter:function(filter){urlFilters.push(filter)},uploadImages,uploadImagesAuto,scanForImages,destroy:function(){blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null}}},FormatRegistry=function(editor){var formats={},register=function(name,format){name&&(isString$1(name)?(isArray$1(format)||(format=[format]),each$k(format,(function(format){isUndefined(format.deep)&&(format.deep=!isSelectorFormat(format)),isUndefined(format.split)&&(format.split=!isSelectorFormat(format)||isInlineFormat(format)),isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)&&(format.remove="none"),isSelectorFormat(format)&&isInlineFormat(format)&&(format.mixed=!0,format.block_expand=!0),isString$1(format.classes)&&(format.classes=format.classes.split(/\s+/))})),formats[name]=format):each$j(name,(function(format,name){register(name,format)})))};return register(function(dom){var formats={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table,audio,video",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img,audio,video",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table,audio,video",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all",preserve_attributes:["class","style"]}],italic:[{inline:"em",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all",preserve_attributes:["class","style"]}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all",preserve_attributes:["class","style"]}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all",preserve_attributes:["class","style"]},{inline:"s",remove:"all",preserve_attributes:["class","style"]}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},lineheight:{selector:"h1,h2,h3,h4,h5,h6,p,li,td,th,div",defaultBlock:"p",styles:{lineHeight:"%value"}},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:!0,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(node,_fmt,_itemName){return isElement$5(node)&&node.hasAttribute("href")},onformat:function(elm,_fmt,vars){Tools.each(vars,(function(value,key){dom.setAttrib(elm,key,value)}))}},lang:{inline:"span",clear_child_styles:!0,remove_similar:!0,attributes:{lang:"%value","data-mce-lang":function(vars){var _a;return null!==(_a=null==vars?void 0:vars.customValue)&&void 0!==_a?_a:null}}},removeformat:[{selector:"b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Tools.each("p h1 h2 h3 h4 h5 h6 div address pre dt dd samp".split(/\s/),(function(name){formats[name]={block:name,remove:"all"}})),formats}(editor.dom)),register(function(editor){return editor.getParam("formats")}(editor)),{get:function(name){return isNonNullable(name)?formats[name]:formats},has:function(name){return has$2(formats,name)},register,unregister:function(name){return name&&formats[name]&&delete formats[name],formats}}},each$5=Tools.each,dom=DOMUtils.DOM,parsedSelectorToHtml=function(ancestry,editor){var elm,item,fragment,schema=editor&&editor.schema||Schema({}),createElement=function(sItem){item="string"==typeof sItem?{name:sItem,classes:[],attrs:{}}:sItem;var elm=dom.create(item.name);return function(elm,item){item.classes.length&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)}(elm,item),elm},wrapInHtml=function(elm,ancestry,siblings){var parent,parentCandidate,ancestor=ancestry.length>0&&ancestry[0],ancestorName=ancestor&&ancestor.name,parentRequired=function(elm,candidate){var name="string"!=typeof elm?elm.nodeName.toLowerCase():elm,elmRule=schema.getElementRule(name),parentsRequired=elmRule&&elmRule.parentsRequired;return!(!parentsRequired||!parentsRequired.length)&&(candidate&&-1!==Tools.inArray(parentsRequired,candidate)?candidate:parentsRequired[0])}(elm,ancestorName);if(parentRequired)ancestorName===parentRequired?(parentCandidate=ancestry[0],ancestry=ancestry.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestry[0],ancestry=ancestry.slice(1);else if(!siblings)return elm;return parentCandidate&&(parent=createElement(parentCandidate)).appendChild(elm),siblings&&(parent||(parent=dom.create("div")).appendChild(elm),Tools.each(siblings,(function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm)}))),wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings)};return ancestry&&ancestry.length?(item=ancestry[0],elm=createElement(item),(fragment=dom.create("div")).appendChild(wrapInHtml(elm,ancestry.slice(1),item.siblings)),fragment):""},parseSelectorItem=function(item){var tagName,obj={classes:[],attrs:{}};return"*"!==(item=obj.selector=Tools.trim(item))&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,(function($0,$1,$2,$3,$4){switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}if("["===$3){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);m&&(obj.attrs[m[1]]=m[2])}return""}))),obj.name=tagName||"div",obj},getCssText=function(editor,format){var name,previewFrag,parentFontSize,previewCss="",previewStyles=function(editor){var style=editor.getParam("preview_styles","font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow");return isString$1(style)?style:""}(editor);if(""===previewStyles)return"";var removeVars=function(val){return val.replace(/%(\w+)/g,"")};if("string"==typeof format){if(!(format=editor.formatter.get(format)))return;format=format[0]}if("preview"in format){var previewOpt=get$9(format,"preview");if(is$1(previewOpt,!1))return"";previewStyles=previewOpt.getOr(previewStyles)}name=format.block||format.inline||"span";var selector,items=(selector=format.selector)&&"string"==typeof selector?(selector=(selector=selector.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),(function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=siblings.pop();return siblings.length&&(obj.siblings=siblings),obj})).reverse()):[];items.length?(items[0].name||(items[0].name=name),name=format.selector,previewFrag=parsedSelectorToHtml(items,editor)):previewFrag=parsedSelectorToHtml([name],editor);var previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;return each$5(format.styles,(function(value,name){var newValue=removeVars(value);newValue&&dom.setStyle(previewElm,name,newValue)})),each$5(format.attributes,(function(value,name){var newValue=removeVars(value);newValue&&dom.setAttrib(previewElm,name,newValue)})),each$5(format.classes,(function(value){var newValue=removeVars(value);dom.hasClass(previewElm,newValue)||dom.addClass(previewElm,newValue)})),editor.fire("PreviewFormats"),dom.setStyles(previewFrag,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewFrag),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each$5(previewStyles.split(" "),(function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"===name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"===dom.toHex(value).toLowerCase())||"color"===name&&"#000000"===dom.toHex(value).toLowerCase())){if("font-size"===name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=parseFloat(value)/(/%$/.test(value)?100:1)*parentFontSize+"px"}"border"===name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}})),editor.fire("AfterPreviewFormats"),dom.remove(previewFrag),previewCss},Formatter=function(editor){var formats=FormatRegistry(editor),formatChangeState=Cell(null);return function(editor){editor.addShortcut("meta+b","","Bold"),editor.addShortcut("meta+i","","Italic"),editor.addShortcut("meta+u","","Underline");for(var i=1;i<=6;i++)editor.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);editor.addShortcut("access+7","",["FormatBlock",!1,"p"]),editor.addShortcut("access+8","",["FormatBlock",!1,"div"]),editor.addShortcut("access+9","",["FormatBlock",!1,"address"])}(editor),setup$k(editor),{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:function(name,vars,node){!function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.apply(name,vars,node)}(editor,name,vars,node)},remove:function(name,vars,node,similar){!function(editor,name,vars,node,similar){getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar)}(editor,name,vars,node,similar)},toggle:function(name,vars,node){!function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.toggle(name,vars,node)}(editor,name,vars,node)},match:function(name,vars,node,similar){return function(editor,name,vars,node,similar){return getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar)}(editor,name,vars,node,similar)},closest:function(names){return function(editor,names){return getRtcInstanceWithError(editor).formatter.closest(names)}(editor,names)},matchAll:function(names,vars){return function(editor,names,vars){return getRtcInstanceWithError(editor).formatter.matchAll(names,vars)}(editor,names,vars)},matchNode:function(node,name,vars,similar){return function(editor,node,name,vars,similar){return getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar)}(editor,node,name,vars,similar)},canApply:function(name){return function(editor,name){return getRtcInstanceWithError(editor).formatter.canApply(name)}(editor,name)},formatChanged:function(formats,callback,similar,vars){return function(editor,registeredFormatListeners,formats,callback,similar,vars){return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars)}(editor,formatChangeState,formats,callback,similar,vars)},getCssText:curry(getCssText,editor)}},shouldIgnoreCommand=function(cmd){switch(cmd.toLowerCase()){case"undo":case"redo":case"mcerepaint":case"mcefocus":return!0;default:return!1}},UndoManager=function(editor){var beforeBookmark=value(),locks=Cell(0),index=Cell(0),undoManager={data:[],typing:!1,beforeChange:function(){!function(editor,locks,beforeBookmark){getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark)}(editor,locks,beforeBookmark)},add:function(level,event){return function(editor,undoManager,index,locks,beforeBookmark,level,event){return getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event)}(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(){return function(editor,undoManager,locks,index){return getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index)}(editor,undoManager,locks,index)},redo:function(){return function(editor,index,data){return getRtcInstanceWithError(editor).undoManager.redo(index,data)}(editor,index,undoManager.data)},clear:function(){!function(editor,undoManager,index){getRtcInstanceWithError(editor).undoManager.clear(undoManager,index)}(editor,undoManager,index)},reset:function(){!function(editor,undoManager){getRtcInstanceWithError(editor).undoManager.reset(undoManager)}(editor,undoManager)},hasUndo:function(){return function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index)}(editor,undoManager,index)},hasRedo:function(){return function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index)}(editor,undoManager,index)},transact:function(callback){return function(editor,undoManager,locks,callback){return getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback)}(editor,undoManager,locks,callback)},ignore:function(callback){!function(editor,locks,callback){getRtcInstanceWithError(editor).undoManager.ignore(locks,callback)}(editor,locks,callback)},extra:function(callback1,callback2){!function(editor,undoManager,index,callback1,callback2){getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2)}(editor,undoManager,index,callback1,callback2)}};return isRtc(editor)||function(editor,undoManager,locks){var isFirstTypedCharacter=Cell(!1),addNonTypingUndoLevel=function(e){setTyping(undoManager,!1,locks),undoManager.add({},e)};editor.on("init",(function(){undoManager.add()})),editor.on("BeforeExecCommand",(function(e){var cmd=e.command;shouldIgnoreCommand(cmd)||(endTyping(undoManager,locks),undoManager.beforeChange())})),editor.on("ExecCommand",(function(e){var cmd=e.command;shouldIgnoreCommand(cmd)||addNonTypingUndoLevel(e)})),editor.on("ObjectResizeStart cut",(function(){undoManager.beforeChange()})),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("dragend",addNonTypingUndoLevel),editor.on("keyup",(function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter.get()&&undoManager.typing&&!1===isEq$1(createFromEditor(editor),undoManager.data[0])&&(!1===editor.isDirty()&&(editor.setDirty(!0),editor.fire("change",{level:undoManager.data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter.set(!1),editor.nodeChanged()))})),editor.on("keydown",(function(e){var keyCode=e.keyCode;if(!e.isDefaultPrevented())if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode)undoManager.typing&&addNonTypingUndoLevel(e);else{var modKey=e.ctrlKey&&!e.altKey||e.metaKey;!(keyCode<16||keyCode>20)||224===keyCode||91===keyCode||undoManager.typing||modKey||(undoManager.beforeChange(),setTyping(undoManager,!0,locks),undoManager.add({},e),isFirstTypedCharacter.set(!0))}})),editor.on("mousedown",(function(e){undoManager.typing&&addNonTypingUndoLevel(e)})),editor.on("input",(function(e){var event;e.inputType&&("insertReplacementText"===e.inputType||"insertText"===(event=e).inputType&&null===event.data||function(event){return"insertFromPaste"===event.inputType||"insertFromDrop"===event.inputType}(e))&&addNonTypingUndoLevel(e)})),editor.on("AddUndo Undo Redo ClearUndos",(function(e){e.isDefaultPrevented()||editor.nodeChanged()}))}(editor,undoManager,locks),function(editor){editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo")}(editor),undoManager},nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]),isKeyboardEvent=function(e){return"keydown"===e.type||"keyup"===e.type},isDeleteEvent=function(e){var keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE},setup$g=function(editor){var dom=editor.dom,rootBlock=getForcedRootBlock(editor),placeholder=function(editor){return editor.getParam("placeholder",DOM$9.getAttrib(editor.getElement(),"placeholder"),"string")}(editor),updatePlaceholder=function(e,initial){if(!function(e){if(isKeyboardEvent(e)){var keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains$3(nonTypingKeycodes,keyCode))}return!1}(e)){var body=editor.getBody(),showPlaceholder=!function(e){return isKeyboardEvent(e)&&!(isDeleteEvent(e)||"keyup"===e.type&&229===e.keyCode)}(e)&&function(dom,rootElm,forcedRootBlock){if(isEmpty$2(SugarElement.fromDom(rootElm),!1)){var isForcedRootBlockFalse=""===forcedRootBlock,firstElement=rootElm.firstElementChild;return!firstElement||!dom.getStyle(rootElm.firstElementChild,"padding-left")&&!dom.getStyle(rootElm.firstElementChild,"padding-right")&&(isForcedRootBlockFalse?!dom.isBlock(firstElement):forcedRootBlock===firstElement.nodeName.toLowerCase())}return!1}(dom,body,rootBlock);(""!==dom.getAttrib(body,"data-mce-placeholder")!==showPlaceholder||initial)&&(dom.setAttrib(body,"data-mce-placeholder",showPlaceholder?placeholder:null),dom.setAttrib(body,"aria-placeholder",showPlaceholder?placeholder:null),function(editor,state){editor.fire("PlaceholderToggle",{state})}(editor,showPlaceholder),editor.on(showPlaceholder?"keydown":"keyup",updatePlaceholder),editor.off(showPlaceholder?"keyup":"keydown",updatePlaceholder))}};placeholder&&editor.on("init",(function(e){updatePlaceholder(e,!0),editor.on("change SetContent ExecCommand",updatePlaceholder),editor.on("paste",(function(e){return Delay.setEditorTimeout(editor,(function(){return updatePlaceholder(e)}))}))}))},strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,isInlineTarget=function(editor,elm){return is$2(SugarElement.fromDom(elm),function(editor){return editor.getParam("inline_boundaries_selector","a[href],code,.mce-annotation","string")}(editor))},isRtl=function(element){return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||(text=element.textContent,strongRtl.test(text));var text},findRootInline=function(isInlineTarget,rootNode,pos){var parents=function(isInlineTarget,rootNode,pos){return filter$4(DOMUtils.DOM.getParents(pos.container(),"*",rootNode),isInlineTarget)}(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1])},normalizePosition=function(forward,pos){if(!pos)return pos;var container=pos.container(),offset=pos.offset();return forward?isCaretContainerInline(container)?isText$7(container.nextSibling)?CaretPosition(container.nextSibling,0):CaretPosition.after(container):isBeforeInline(pos)?CaretPosition(container,offset+1):pos:isCaretContainerInline(container)?isText$7(container.previousSibling)?CaretPosition(container.previousSibling,container.previousSibling.data.length):CaretPosition.before(container):isAfterInline(pos)?CaretPosition(container,offset-1):pos},normalizeForwards=curry(normalizePosition,!0),normalizeBackwards=curry(normalizePosition,!1),isTextBlockOrListItem=function(element){return isTextBlock$2(element)||isListItem(element)},getParentBlock$1=function(rootNode,elm){return contains$1(rootNode,elm)?closest$3(elm,isTextBlockOrListItem,function(rootNode){return function(elm){return eq(rootNode,SugarElement.fromDom(elm.dom.parentNode))}}(rootNode)):Optional.none()},paddEmptyBody=function(editor){editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),function(editor){var body=editor.getBody(),node=body.firstChild&&editor.dom.isBlock(body.firstChild)?body.firstChild:body;editor.selection.setCursorLocation(node,0)}(editor))},blockBoundary=function(from,to){return{from,to}},getBlockPosition=function(rootNode,pos){var rootElm=SugarElement.fromDom(rootNode),containerElm=SugarElement.fromDom(pos.container());return getParentBlock$1(rootElm,containerElm).map((function(block){return function(block,position){return{block,position}}(block,pos)}))},readFromRange=function(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng)),toBlockPos=fromBlockPos.bind((function(blockPos){return fromPosition(forward,rootNode,blockPos.position).bind((function(to){return getBlockPosition(rootNode,to).map((function(blockPos){return function(rootNode,forward,blockPosition){return isBr$5(blockPosition.position.getNode())&&!1===isEmpty$2(blockPosition.block)?positionIn(!1,blockPosition.block.dom).bind((function(lastPositionInBlock){return lastPositionInBlock.isEqual(blockPosition.position)?fromPosition(forward,rootNode,lastPositionInBlock).bind((function(to){return getBlockPosition(rootNode,to)})):Optional.some(blockPosition)})).getOr(blockPosition):blockPosition}(rootNode,forward,blockPos)}))}))}));return lift2(fromBlockPos,toBlockPos,blockBoundary).filter((function(blockBoundary){return function(blockBoundary){return!1===eq(blockBoundary.from.block,blockBoundary.to.block)}(blockBoundary)&&function(blockBoundary){return parent(blockBoundary.from.block).bind((function(parent1){return parent(blockBoundary.to.block).filter((function(parent2){return eq(parent1,parent2)}))})).isSome()}(blockBoundary)&&function(blockBoundary){return!1===isContentEditableFalse$b(blockBoundary.from.block.dom)&&!1===isContentEditableFalse$b(blockBoundary.to.block.dom)}(blockBoundary)}))},getChildrenUntilBlockBoundary=function(block){var children$1=children(block);return findIndex$2(children$1,isBlock$2).fold(constant(children$1),(function(index){return children$1.slice(0,index)}))},extractChildren=function(block){var children=getChildrenUntilBlockBoundary(block);return each$k(children,remove$7),children},removeEmptyRoot=function(rootNode,block){var parents=parentsAndSelf(block,rootNode);return find$3(parents.reverse(),(function(element){return isEmpty$2(element)})).each(remove$7)},nestedBlockMerge=function(rootNode,fromBlock,toBlock,insertionPoint){if(isEmpty$2(toBlock))return fillWithPaddingBr(toBlock),firstPositionIn(toBlock.dom);0===filter$4(prevSiblings(insertionPoint),(function(el){return!isEmpty$2(el)})).length&&isEmpty$2(fromBlock)&&before$4(insertionPoint,SugarElement.fromTag("br"));var position=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom));return each$k(extractChildren(fromBlock),(function(child){before$4(insertionPoint,child)})),removeEmptyRoot(rootNode,fromBlock),position},sidelongBlockMerge=function(rootNode,fromBlock,toBlock){if(isEmpty$2(toBlock))return remove$7(toBlock),isEmpty$2(fromBlock)&&fillWithPaddingBr(fromBlock),firstPositionIn(fromBlock.dom);var position=lastPositionIn(toBlock.dom);return each$k(extractChildren(fromBlock),(function(child){append$1(toBlock,child)})),removeEmptyRoot(rootNode,fromBlock),position},getInsertionPoint=function(fromBlock,toBlock){return contains$1(toBlock,fromBlock)?function(toBlock,block){var parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1])}(toBlock,fromBlock):Optional.none()},trimBr=function(first,block){positionIn(first,block.dom).map((function(position){return position.getNode()})).map(SugarElement.fromDom).filter(isBr$4).each(remove$7)},mergeBlockInto=function(rootNode,fromBlock,toBlock){return trimBr(!0,fromBlock),trimBr(!1,toBlock),getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock))},mergeBlocks=function(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2)},backspaceDelete$8=function(editor,forward){var rootNode=SugarElement.fromDom(editor.getBody()),position=function(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none()}(rootNode.dom,forward,editor.selection.getRng()).bind((function(blockBoundary){return mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block)}));return position.each((function(pos){editor.selection.setRng(pos.toRange())})),position.isSome()},isRawNodeInTable=function(root,rawNode){var node=SugarElement.fromDom(rawNode),isRoot=curry(eq,root);return ancestor$3(node,isTableCell$4,isRoot).isSome()},isEverythingSelected=function(root,rng){var noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone(),noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!function(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer)}(root,rng)&&noPrevious&&noNext},deleteRange$1=function(editor){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?function(editor){return editor.setContent(""),editor.selection.setCursorLocation(),!0}(editor):function(rootNode,selection){var rng=selection.getRng();return lift2(getParentBlock$1(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$1(rootNode,SugarElement.fromDom(rng.endContainer)),(function(block1,block2){return!1===eq(block1,block2)&&(rng.deleteContents(),mergeBlocks(rootNode,!0,block1,block2).each((function(pos){selection.setRng(pos.toRange())})),!0)})).getOr(!1)}(rootNode,editor.selection)},backspaceDelete$7=function(editor,_forward){return!editor.selection.isCollapsed()&&deleteRange$1(editor)},isContentEditableTrue$2=isContentEditableTrue$4,isContentEditableFalse$4=isContentEditableFalse$b,showCaret=function(direction,editor,node,before,scrollIntoView){return Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView))},selectNode=function(editor,node){return editor.fire("BeforeObjectSelected",{target:node}).isDefaultPrevented()?Optional.none():Optional.some(function(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng}(node))},renderCaretAtRange=function(editor,range,scrollIntoView){var normalizedRange=normalizeRange(1,editor.getBody(),range),caretPosition=CaretPosition.fromRangeStart(normalizedRange),caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode))return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),!1);var caretPositionBeforeNode=caretPosition.getNode(!0);if(isInlineFakeCaretTarget(caretPositionBeforeNode))return showCaret(1,editor,caretPositionBeforeNode,!1,!1);var ceRoot=editor.dom.getParent(caretPosition.getNode(),(function(node){return isContentEditableFalse$4(node)||isContentEditableTrue$2(node)}));return isInlineFakeCaretTarget(ceRoot)?showCaret(1,editor,ceRoot,!1,scrollIntoView):Optional.none()},renderRangeCaret=function(editor,range,scrollIntoView){return range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range},isBeforeBoundary=function(pos){return isBeforeContentEditableFalse(pos)||isBeforeMedia(pos)},isAfterBoundary=function(pos){return isAfterContentEditableFalse(pos)||isAfterMedia(pos)},deleteContentAndShowCaret=function(editor,range,node,direction,forward,peekCaretPosition){return showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,!0).each((function(caretRange){if(range.collapsed){var deleteRange=range.cloneRange();forward?deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset):deleteRange.setStart(caretRange.endContainer,caretRange.endOffset),deleteRange.deleteContents()}else range.deleteContents();editor.selection.setRng(caretRange)})),function(dom,node){isText$7(node)&&0===node.data.length&&dom.remove(node)}(editor.dom,node),!0},backspaceDelete$6=function(editor,forward){return function(editor,forward){var range=editor.selection.getRng();if(!isText$7(range.commonAncestorContainer))return!1;var direction=forward?HDirection.Forwards:HDirection.Backwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev),isBeforeFn=forward?isBeforeBoundary:isAfterBoundary,caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),nextCaretPosition=normalizePosition(forward,getNextPosFn(caretPosition));if(!nextCaretPosition||!isMoveInsideSameBlock(caretPosition,nextCaretPosition))return!1;if(isBeforeFn(nextCaretPosition))return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,nextCaretPosition);var peekCaretPosition=getNextPosFn(nextCaretPosition);return!!(peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition))&&deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition)}(editor,forward)},DeleteAction=Adt_generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),deleteEmptyBlockOrMoveToCef=function(root,forward,from,to){var toCefElm=to.getNode(!1===forward);return getParentBlock$1(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map((function(blockElm){return isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm)})).orThunk((function(){return Optional.some(DeleteAction.moveToElement(toCefElm))}))},findCefPosition=function(root,forward,from){return fromPosition(forward,root,from).bind((function(to){return node=to.getNode(),isTableCell$4(SugarElement.fromDom(node))||isListItem(SugarElement.fromDom(node))||function(root,forward,from,to){var inSameBlock=function(elm){return isInline$1(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root)};return getRelativeCefElm(!forward,from).fold((function(){return getRelativeCefElm(forward,to).fold(never,inSameBlock)}),inSameBlock)}(root,forward,from,to)?Optional.none():forward&&isContentEditableFalse$b(to.getNode())||!1===forward&&isContentEditableFalse$b(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(root,forward,from,to):forward&&isAfterContentEditableFalse(from)||!1===forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.moveToPosition(to)):Optional.none();var node}))},getContentEditableAction=function(root,forward,from){return function(forward,from){var elm=from.getNode(!1===forward),caretLocation=forward?"after":"before";return isElement$5(elm)&&elm.getAttribute("data-mce-caret")===caretLocation}(forward,from)?function(forward,elm){return forward&&isContentEditableFalse$b(elm.nextSibling)?Optional.some(DeleteAction.moveToElement(elm.nextSibling)):!1===forward&&isContentEditableFalse$b(elm.previousSibling)?Optional.some(DeleteAction.moveToElement(elm.previousSibling)):Optional.none()}(forward,from.getNode(!1===forward)).fold((function(){return findCefPosition(root,forward,from)}),Optional.some):findCefPosition(root,forward,from).bind((function(deleteAction){return function(root,from,deleteAction){return deleteAction.fold((function(elm){return Optional.some(DeleteAction.remove(elm))}),(function(elm){return Optional.some(DeleteAction.moveToElement(elm))}),(function(to){return isInSameBlock(from,to,root)?Optional.none():Optional.some(DeleteAction.moveToPosition(to))}))}(root,from,deleteAction)}))},getAncestorCe=function(editor,node){return Optional.from(getContentEditableRoot$1(editor.getBody(),node))},backspaceDeleteCaret=function(editor,forward){var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold((function(){return function(root,forward,rng){var normalizedRange=normalizeRange(forward?1:-1,root,rng),from=CaretPosition.fromRangeStart(normalizedRange),rootElement=SugarElement.fromDom(root);return!1===forward&&isAfterContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode(!0))):forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode())):!1===forward&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from)?findPreviousBr(rootElement,from).map((function(br){return DeleteAction.remove(br.getNode())})):forward&&isAfterContentEditableFalse(from)&&isBeforeBr$1(rootElement,from)?findNextBr(rootElement,from).map((function(br){return DeleteAction.remove(br.getNode())})):getContentEditableAction(root,forward,from)}(editor.getBody(),forward,editor.selection.getRng()).exists((function(deleteAction){return deleteAction.fold(function(editor,forward){return function(element){return editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0}}(editor,forward),function(editor,forward){return function(element){var pos=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(pos.toRange()),!0}}(editor,forward),function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),!0}}(editor))}))}),always)},backspaceDeleteRange=function(editor,forward){var selectedNode=editor.selection.getNode();return!(!isContentEditableFalse$b(selectedNode)||isTableCell$5(selectedNode))&&getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b).fold((function(){var rootElement;return rootElement=SugarElement.fromDom(editor.getBody()),each$k(descendants(rootElement,".mce-offscreen-selection"),remove$7),deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode())),paddEmptyBody(editor),!0}),always)},paddEmptyElement=function(editor){var dom=editor.dom,selection=editor.selection,ceRoot=getContentEditableRoot$1(editor.getBody(),selection.getNode());if(isContentEditableTrue$4(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){var br=dom.create("br",{"data-mce-bogus":"1"});dom.setHTML(ceRoot,""),ceRoot.appendChild(br),selection.setRng(CaretPosition.before(br).toRange())}return!0},backspaceDelete$5=function(editor,forward){return editor.selection.isCollapsed()?backspaceDeleteCaret(editor,forward):backspaceDeleteRange(editor,forward)},backspaceDelete$4=function(editor,forward){return!!editor.selection.isCollapsed()&&function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter((function(pos){return forward?isBeforeImageBlock(pos):isAfterImageBlock(pos)})).bind((function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos))})).exists((function(elm){return editor.selection.select(elm),!0}))}(editor,forward)},isText=isText$7,startsWithCaretContainer=function(node){return isText(node)&&"\ufeff"===node.data[0]},endsWithCaretContainer=function(node){return isText(node)&&"\ufeff"===node.data[node.data.length-1]},createZwsp=function(node){return node.ownerDocument.createTextNode("\ufeff")},insertInline=function(before,node){return before?function(node){if(isText(node.previousSibling))return endsWithCaretContainer(node.previousSibling)||node.previousSibling.appendData("\ufeff"),node.previousSibling;if(isText(node))return startsWithCaretContainer(node)||node.insertData(0,"\ufeff"),node;var newNode=createZwsp(node);return node.parentNode.insertBefore(newNode,node),newNode}(node):function(node){if(isText(node.nextSibling))return startsWithCaretContainer(node.nextSibling)||node.nextSibling.insertData(0,"\ufeff"),node.nextSibling;if(isText(node))return endsWithCaretContainer(node)||node.appendData("\ufeff"),node;var newNode=createZwsp(node);return node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode),newNode}(node)},insertInlineBefore=curry(insertInline,!0),insertInlineAfter=curry(insertInline,!1),insertInlinePos=function(pos,before){return isText$7(pos.container())?insertInline(before,pos.container()):insertInline(before,pos.getNode())},isPosCaretContainer=function(pos,caret){var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode)},renderCaret=function(caret,location){return location.fold((function(element){remove$2(caret.get());var text=insertInlineBefore(element);return caret.set(text),Optional.some(CaretPosition(text,text.length-1))}),(function(element){return firstPositionIn(element).map((function(pos){if(isPosCaretContainer(pos,caret))return CaretPosition(caret.get(),1);remove$2(caret.get());var text=insertInlinePos(pos,!0);return caret.set(text),CaretPosition(text,1)}))}),(function(element){return lastPositionIn(element).map((function(pos){if(isPosCaretContainer(pos,caret))return CaretPosition(caret.get(),caret.get().length-1);remove$2(caret.get());var text=insertInlinePos(pos,!1);return caret.set(text),CaretPosition(text,text.length-1)}))}),(function(element){remove$2(caret.get());var text=insertInlineAfter(element);return caret.set(text),Optional.some(CaretPosition(text,1))}))},evaluateUntil=function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome())return result}return Optional.none()},Location=Adt_generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),rescope$1=function(rootNode,node){var parentBlock=getParentBlock$2(node,rootNode);return parentBlock||rootNode},before=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((function(){return nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((function(inline){return Location.before(inline)}))}),Optional.none)},isNotInsideFormatCaretContainer=function(rootNode,elm){return null===getParentCaretContainer(rootNode,elm)},findInsideRootInline=function(isInlineTarget,rootNode,pos){return findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode))},start$1=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((function(inline){return prevPosition(inline,nPos).isNone()?Optional.some(Location.start(inline)):Optional.none()}))},end=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((function(inline){return nextPosition(inline,nPos).isNone()?Optional.some(Location.end(inline)):Optional.none()}))},after=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((function(){return prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((function(inline){return Location.after(inline)}))}),Optional.none)},isValidLocation=function(location){return!1===isRtl(getElement(location))},readLocation=function(isInlineTarget,rootNode,pos){return evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]).filter(isValidLocation)},getElement=function(location){return location.fold(identity,identity,identity,identity)},getName=function(location){return location.fold(constant("before"),constant("start"),constant("end"),constant("after"))},outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after)},inside=function(location){return location.fold(Location.start,Location.start,Location.end,Location.end)},betweenInlines=function(forward,isInlineTarget,rootNode,from,to,location){return lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),(function(fromInline,toInline){return fromInline!==toInline&&function(rootNode,node1,node2){var block1=getParentBlock$2(node1,rootNode),block2=getParentBlock$2(node2,rootNode);return block1&&block1===block2}(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location})).getOr(location)},skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(always,(function(fromLocation){return location2=toLocation,!(getName(location1=fromLocation)===getName(location2)&&getElement(location1)===getElement(location2));var location1,location2}))},findLocationSimple=function(forward,location){return forward?location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none):location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end))},findLocation$1=function(forward,isInlineTarget,rootNode,pos){var from=normalizePosition(forward,pos),fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk((function(){return function(forward,isInlineTarget,rootNode,fromLocation,pos){var from=normalizePosition(forward,pos);return fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward)).fold((function(){return fromLocation.map(outside)}),(function(to){return readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation))})).filter(isValidLocation)}(forward,isInlineTarget,rootNode,fromLocation,pos)}))};curry(findLocation$1,!1),curry(findLocation$1,!0);var BreakType,moveRel=function(forward,selection,pos){var delta=forward?1:-1;return selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange()),selection.getSel().modify("move",forward?"forward":"backward","word"),!0},moveByWord=function(forward,editor){var rng=editor.selection.getRng(),pos=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);return!!function(editor){return isFunction(editor.selection.getSel().modify)}(editor)&&(forward&&isBeforeInline(pos)?moveRel(!0,editor.selection,pos):!(forward||!isAfterInline(pos))&&moveRel(!1,editor.selection,pos))};!function(BreakType){BreakType[BreakType.Br=0]="Br",BreakType[BreakType.Block=1]="Block",BreakType[BreakType.Wrap=2]="Wrap",BreakType[BreakType.Eol=3]="Eol"}(BreakType||(BreakType={}));var VDirection,flip=function(direction,positions){return direction===HDirection.Backwards?reverse(positions):positions},walk=function(direction,caretWalker,pos){return direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos)},getBreakType=function(scope,direction,currentPos,nextPos){return isBr$5(nextPos.getNode(direction===HDirection.Forwards))?BreakType.Br:!1===isInSameBlock(currentPos,nextPos)?BreakType.Block:BreakType.Wrap},getPositionsUntil=function(predicate,direction,scope,start){for(var caretWalker=CaretWalker(scope),currentPos=start,positions=[];currentPos;){var nextPos=walk(direction,caretWalker,currentPos);if(!nextPos)break;if(isBr$5(nextPos.getNode(!1)))return direction===HDirection.Forwards?{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)}:{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};if(nextPos.isVisible()){if(predicate(currentPos,nextPos)){var breakType=getBreakType(0,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType,breakAt:Optional.some(nextPos)}}positions.push(nextPos),currentPos=nextPos}else currentPos=nextPos}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()}},getAdjacentLinePositions=function(direction,getPositionsUntilBreak,scope,start){return getPositionsUntilBreak(scope,start).breakAt.map((function(pos){var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions)})).getOr([])},findClosestHorizontalPositionFromPoint=function(positions,x){return foldl(positions,(function(acc,newPos){return acc.fold((function(){return Optional.some(newPos)}),(function(lastPos){return lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),(function(lastRect,newRect){var lastDist=Math.abs(x-lastRect.left);return Math.abs(x-newRect.left)<=lastDist?newPos:lastPos})).or(acc)}))}),Optional.none())},findClosestHorizontalPosition=function(positions,pos){return head(pos.getClientRects()).bind((function(targetRect){return findClosestHorizontalPositionFromPoint(positions,targetRect.left)}))},getPositionsUntilPreviousLine=curry(getPositionsUntil,CaretPosition.isAbove,-1),getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1),getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine),getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine),getNodeClientRects=function(node){var toArrayWithNode=function(clientRects){return map$3(clientRects,(function(rect){var clientRect=clone(rect);return clientRect.node=node,clientRect}))};if(isElement$5(node))return toArrayWithNode(node.getClientRects());if(isText$7(node)){var rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())}},getClientRects=function(nodes){return bind(nodes,getNodeClientRects)};!function(VDirection){VDirection[VDirection.Up=-1]="Up",VDirection[VDirection.Down=1]="Down"}(VDirection||(VDirection={}));var customEventRootDelegates,beforeUnloadDelegate,walkUntil$1=function(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition){var line=0,result=[],add=function(node){var clientRects=getClientRects([node]);-1===direction&&(clientRects=clientRects.reverse());for(var i=0;i<clientRects.length;i++){var clientRect=clientRects[i];if(!isBeflowFn(clientRect,targetClientRect)){if(result.length>0&&isAboveFn(clientRect,last$1(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}},targetClientRect=last$1(caretPosition.getClientRects());if(!targetClientRect)return result;var node=caretPosition.getNode();return add(node),function(direction,root,predicateFn,node){for(;node=findNode$1(node,direction,isEditableCaretCandidate$1,root);)if(predicateFn(node))return}(direction,root,add,node),result},upUntil=curry(walkUntil$1,VDirection.Up,isAbove$1,isBelow$1),downUntil=curry(walkUntil$1,VDirection.Down,isBelow$1,isAbove$1),isAboveLine=function(lineNumber){return function(clientRect){return function(lineNumber,clientRect){return clientRect.line>lineNumber}(lineNumber,clientRect)}},isLine=function(lineNumber){return function(clientRect){return function(lineNumber,clientRect){return clientRect.line===lineNumber}(lineNumber,clientRect)}},isContentEditableFalse$3=isContentEditableFalse$b,findNode=findNode$1,distanceToRectLeft=function(clientRect,clientX){return Math.abs(clientRect.left-clientX)},distanceToRectRight=function(clientRect,clientX){return Math.abs(clientRect.right-clientX)},isInsideX=function(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right},isInsideY=function(clientY,clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom},findClosestClientRect=function(clientRects,clientX,allowInside){return void 0===allowInside&&(allowInside=always),reduce(clientRects,(function(oldClientRect,clientRect){if(isInsideX(clientX,clientRect))return allowInside(clientRect)?clientRect:oldClientRect;if(isInsideX(clientX,oldClientRect))return allowInside(oldClientRect)?oldClientRect:clientRect;var oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));return newDistance===oldDistance&&hasNonNullableKey(clientRect,"node")&&isContentEditableFalse$3(clientRect.node)||newDistance<oldDistance?clientRect:oldClientRect}))},walkUntil=function(direction,root,predicateFn,startNode,includeChildren){var node=findNode(startNode,direction,isEditableCaretCandidate$1,root,!includeChildren);do{if(!node||predicateFn(node))return}while(node=findNode(node,direction,isEditableCaretCandidate$1,root))},closestFakeCaret=function(root,clientX,clientY){var fakeTargetNodeRects=getClientRects(function(root){return filter$4(from(root.getElementsByTagName("*")),isFakeCaretTarget)}(root)),targetNodeRects=filter$4(fakeTargetNodeRects,curry(isInsideY,clientY)),checkInside=function(clientRect){return!isTable$3(clientRect.node)&&!isMedia$2(clientRect.node)},closestNodeRect=findClosestClientRect(targetNodeRects,clientX,checkInside);if(closestNodeRect){var includeChildren=checkInside(closestNodeRect);if(closestNodeRect=findClosestClientRect(function(root,targetNodeRect,includeChildren){void 0===includeChildren&&(includeChildren=!0);var clientRects=[],collect=function(checkPosFn,node){var lineRects=filter$4(getClientRects([node]),(function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}));return clientRects=clientRects.concat(lineRects),0===lineRects.length};return clientRects.push(targetNodeRect),walkUntil(VDirection.Up,root,curry(collect,isAbove$1),targetNodeRect.node,includeChildren),walkUntil(VDirection.Down,root,curry(collect,isBelow$1),targetNodeRect.node,includeChildren),clientRects}(root,closestNodeRect,includeChildren),clientX,checkInside),closestNodeRect&&isFakeCaretTarget(closestNodeRect.node))return function(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}(closestNodeRect,clientX)}return null},moveToRange=function(editor,rng){editor.selection.setRng(rng),scrollRangeIntoView(editor,editor.selection.getRng())},renderRangeCaretOpt=function(editor,range,scrollIntoView){return Optional.some(renderRangeCaret(editor,range,scrollIntoView))},moveHorizontally=function(editor,direction,range,isBefore,isAfter,isElement){var forwards=direction===HDirection.Forwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev),isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){var node=getSelectedNode(range);if(isElement(node))return showCaret(direction,editor,node,direction===HDirection.Backwards,!1)}var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition))return selectNode(editor,caretPosition.getNode(!forwards));var nextCaretPosition=normalizePosition(forwards,getNextPosFn(caretPosition)),rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition)return rangeIsInContainerBlock?Optional.some(range):Optional.none();if(isBeforeFn(nextCaretPosition))return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,!1);var peekCaretPosition=getNextPosFn(nextCaretPosition);return peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)?showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,!1):rangeIsInContainerBlock?renderRangeCaretOpt(editor,nextCaretPosition.toRange(),!1):Optional.none()},moveVertically=function(editor,direction,range,isBefore,isAfter,isElement){var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),caretClientRect=last$1(caretPosition.getClientRects()),forwards=direction===VDirection.Down;if(!caretClientRect)return Optional.none();var currentNode,linePositions=(forwards?downUntil:upUntil)(editor.getBody(),isAboveLine(1),caretPosition),nextLinePositions=filter$4(linePositions,isLine(1)),clientX=caretClientRect.left,nextLineRect=findClosestClientRect(nextLinePositions,clientX);if(nextLineRect&&isElement(nextLineRect.node)){var dist1=Math.abs(clientX-nextLineRect.left),dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,!1)}if(currentNode=isBefore(caretPosition)?caretPosition.getNode():isAfter(caretPosition)?caretPosition.getNode(!0):getSelectedNode(range)){var caretPositions=function(direction,root,predicateFn,node){var walkFn,isBelowFn,isAboveFn,caretPosition,caretWalker=CaretWalker(root),result=[],line=0,getClientRect=function(caretPosition){return last$1(caretPosition.getClientRects())};1===direction?(walkFn=caretWalker.next,isBelowFn=isBelow$1,isAboveFn=isAbove$1,caretPosition=CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=isAbove$1,isAboveFn=isBelow$1,caretPosition=CaretPosition.before(node));var targetClientRect=getClientRect(caretPosition);do{if(caretPosition.isVisible()){var rect=getClientRect(caretPosition);if(!isAboveFn(rect,targetClientRect)){result.length>0&&isBelowFn(rect,last$1(result))&&line++;var clientRect=clone(rect);if(clientRect.position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}}}while(caretPosition=walkFn(caretPosition));return result}(direction,editor.getBody(),isAboveLine(1),currentNode),closestNextLineRect=findClosestClientRect(filter$4(caretPositions,isLine(1)),clientX);if(closestNextLineRect)return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1);if(closestNextLineRect=last$1(filter$4(caretPositions,isLine(0))))return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1)}return 0===nextLinePositions.length?getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map((function(pos){return renderRangeCaret(editor,pos.toRange(),!1)})):Optional.none()},getLineEndPoint=function(editor,forward){var rng=editor.selection.getRng(),body=editor.getBody();if(forward){var from=CaretPosition.fromRangeEnd(rng),result=getPositionsUntilNextLine(body,from);return last$2(result.positions)}from=CaretPosition.fromRangeStart(rng),result=getPositionsUntilPreviousLine(body,from);return head(result.positions)},moveToLineEndPoint$3=function(editor,forward,isElementPosition){return getLineEndPoint(editor,forward).filter(isElementPosition).exists((function(pos){return editor.selection.setRng(pos.toRange()),!0}))},setCaretPosition=function(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)},setSelected=function(state,elm){state?elm.setAttribute("data-mce-selected","inline-boundary"):elm.removeAttribute("data-mce-selected")},renderCaretLocation=function(editor,caret,location){return renderCaret(caret,location).map((function(pos){return setCaretPosition(editor,pos),location}))},safeRemoveCaretContainer=function(editor,caret){if(editor.selection.isCollapsed()&&!0!==editor.composing&&caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());CaretPosition.isTextPosition(pos)&&!1===function(pos){return isBeforeInline(pos)||isAfterInline(pos)}(pos)&&(setCaretPosition(editor,removeAndReposition(caret.get(),pos)),caret.set(null))}},move$2=function(editor,caret,forward){return!!isInlineBoundariesEnabled(editor)&&function(editor,caret,forward){var rootNode=editor.getBody(),from=CaretPosition.fromRangeStart(editor.selection.getRng()),isInlineTarget$1=curry(isInlineTarget,editor);return findLocation$1(forward,isInlineTarget$1,rootNode,from).bind((function(location){return renderCaretLocation(editor,caret,location)}))}(editor,caret,forward).isSome()},moveWord=function(forward,editor,_caret){return!!isInlineBoundariesEnabled(editor)&&moveByWord(forward,editor)},setupSelectedState=function(editor){var caret=Cell(null),isInlineTarget$1=curry(isInlineTarget,editor);return editor.on("NodeChange",(function(e){!isInlineBoundariesEnabled(editor)||Env.browser.isIE()&&e.initial||(function(isInlineTarget,dom,elms){var inlineBoundaries=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected="inline-boundary"]'),(function(e){return e.dom})),selectedInlines=filter$4(inlineBoundaries,isInlineTarget),targetInlines=filter$4(elms,isInlineTarget);each$k(difference(selectedInlines,targetInlines),curry(setSelected,!1)),each$k(difference(targetInlines,selectedInlines),curry(setSelected,!0))}(isInlineTarget$1,editor.dom,e.parents),safeRemoveCaretContainer(editor,caret),function(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=filter$4(elms,isInlineTarget);each$k(inlines,(function(_inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind((function(location){return renderCaretLocation(editor,caret,location)}))}))}}(isInlineTarget$1,editor,caret,e.parents))})),caret},moveNextWord=curry(moveWord,!0),movePrevWord=curry(moveWord,!1),moveToLineEndPoint$2=function(editor,forward,caret){if(isInlineBoundariesEnabled(editor)){var linePoint=getLineEndPoint(editor,forward).getOrThunk((function(){var rng=editor.selection.getRng();return forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng)}));return readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists((function(loc){var outsideLoc=outside(loc);return renderCaret(caret,outsideLoc).exists((function(pos){return setCaretPosition(editor,pos),!0}))}))}return!1},setCaretLocation=function(editor,caret){return function(location){return renderCaret(caret,location).exists((function(pos){return setCaretPosition(editor,pos),!0}))}},deleteFromTo=function(editor,caret,from,to){var rootNode=editor.getBody(),isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore((function(){editor.selection.setRng(function(from,to){var range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range}(from,to)),editor.execCommand("Delete"),readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor,caret))})),editor.nodeChanged()},backspaceDeleteCollapsed=function(editor,caret,forward,from){var rootNode=function(rootNode,node){return getParentBlock$2(node,rootNode)||rootNode}(editor.getBody(),from.container()),isInlineTarget$1=curry(isInlineTarget,editor),fromLocation=readLocation(isInlineTarget$1,rootNode,from);return fromLocation.bind((function(location){return forward?location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none):location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))))})).map(setCaretLocation(editor,caret)).getOrThunk((function(){var toPosition=navigate(forward,rootNode,from),toLocation=toPosition.bind((function(pos){return readLocation(isInlineTarget$1,rootNode,pos)}));return lift2(fromLocation,toLocation,(function(){return findRootInline(isInlineTarget$1,rootNode,from).exists((function(elm){return!!function(elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),(function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos);return nextPosition(elm,normalizedFirstPos).forall((function(pos){return pos.isEqual(normalizedLastPos)}))})).getOr(!0)}(elm)&&(deleteElement$2(editor,forward,SugarElement.fromDom(elm)),!0)}))})).orThunk((function(){return toLocation.bind((function(_){return toPosition.map((function(to){return forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from),!0}))}))})).getOr(!1)}))},backspaceDelete$3=function(editor,caret,forward){if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from)}return!1},hasOnlyOneChild=function(elm){return 1===childNodesCount(elm)},deleteLastPosition=function(forward,editor,target,parentInlines){var isFormatElement$1=curry(isFormatElement,editor),formatNodes=map$3(filter$4(parentInlines,isFormatElement$1),(function(elm){return elm.dom}));if(0===formatNodes.length)deleteElement$2(editor,forward,target);else{var pos=function(targetNode,formatNodes){var caretContainer=createCaretContainer(!1),innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);return before$4(SugarElement.fromDom(targetNode),caretContainer),remove$7(SugarElement.fromDom(targetNode)),CaretPosition(innerMost,0)}(target.dom,formatNodes);editor.selection.setRng(pos.toRange())}},deleteCaret$1=function(editor,forward){var rootElm=SugarElement.fromDom(editor.getBody()),startElm=SugarElement.fromDom(editor.selection.getStart()),parentInlines=filter$4(function(rootElm,startElm){var parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,isBlock$2).fold(constant(parents),(function(index){return parents.slice(0,index)}))}(rootElm,startElm),hasOnlyOneChild);return last$2(parentInlines).exists((function(target){var element,fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return!(!function(forward,fromPos,elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),(function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos),normalizedFromPos=normalizePosition(!1,fromPos);return forward?nextPosition(elm,normalizedFromPos).exists((function(nextPos){return nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos)})):prevPosition(elm,normalizedFromPos).exists((function(prevPos){return prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos)}))})).getOr(!0)}(forward,fromPos,target.dom)||(element=target,isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom)))&&(deleteLastPosition(forward,editor,target,parentInlines),!0)}))},backspaceDelete$2=function(editor,forward){return!!editor.selection.isCollapsed()&&deleteCaret$1(editor,forward)},deleteElement=function(editor,forward,element){return editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0},backspaceDelete$1=function(editor,forward){return editor.selection.isCollapsed()?function(editor,forward){var isNearMedia=forward?isBeforeMedia:isAfterMedia,direction=forward?HDirection.Forwards:HDirection.Backwards,fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());return isNearMedia(fromPos)?deleteElement(editor,forward,fromPos.getNode(!forward)):Optional.from(normalizePosition(forward,fromPos)).filter((function(pos){return isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos)})).exists((function(pos){return deleteElement(editor,forward,pos.getNode(!forward))}))}(editor,forward):function(editor,forward){var selectedNode=editor.selection.getNode();return!!isMedia$2(selectedNode)&&deleteElement(editor,forward,selectedNode)}(editor,forward)},parseIndentValue=function(value){var number=parseInt(value,10);return isNaN(number)?0:number},getIndentStyleName=function(useMargin,element){return(useMargin||"table"===name(element)?"margin":"padding")+("rtl"===get$5(element,"direction")?"-right":"-left")},canOutdent=function(editor){var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||function(editor,blocks){return forall(blocks,(function(block){var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block),intentValue=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0);return"false"!==editor.dom.getContentEditable(block.dom)&&intentValue>0}))}(editor,blocks))},isListComponent=function(el){return isList(el)||isListItem(el)},getBlocksToIndent=function(editor){return filter$4((nodes=editor.selection.getSelectedBlocks(),map$3(nodes,SugarElement.fromDom)),(function(el){return!isListComponent(el)&&!function(el){return parent(el).exists(isListComponent)}(el)&&closest$3(el,(function(elm){return isContentEditableTrue$4(elm.dom)||isContentEditableFalse$b(elm.dom)})).exists((function(elm){return isContentEditableTrue$4(elm.dom)}))}));var nodes},handle=function(editor,command){var dom=editor.dom,selection=editor.selection,formatter=editor.formatter,indentation=function(editor){return editor.getParam("indentation","40px","string")}(editor),indentUnit=/[a-z%]+$/i.exec(indentation)[0],indentValue=parseInt(indentation,10),useMargin=shouldIndentUseMargin(editor),forcedRootBlock=getForcedRootBlock(editor);editor.queryCommandState("InsertUnorderedList")||editor.queryCommandState("InsertOrderedList")||""!==forcedRootBlock||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each$k(getBlocksToIndent(editor),(function(block){!function(dom,command,useMargin,value,unit,element){var indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element));if("outdent"===command){var styleValue=Math.max(0,parseIndentValue(element.style[indentStyleName])-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:"")}else styleValue=parseIndentValue(element.style[indentStyleName])+value+unit,dom.setStyle(element,indentStyleName,styleValue)}(dom,command,useMargin,indentValue,indentUnit,block.dom)}))},backspaceDelete=function(editor,_forward){if(editor.selection.isCollapsed()&&canOutdent(editor)){var dom=editor.dom,rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),block=dom.getParent(rng.startContainer,dom.isBlock);if(null!==block&&isAtStartOfBlock(SugarElement.fromDom(block),pos))return handle(editor,"outdent"),!0}return!1},nativeCommand=function(editor,command){editor.getDoc().execCommand(command,!1,null)},setup$f=function(editor,caret){editor.addCommand("delete",(function(){!function(editor,caret){backspaceDelete(editor)||backspaceDelete$5(editor,!1)||backspaceDelete$6(editor,!1)||backspaceDelete$3(editor,caret,!1)||backspaceDelete$8(editor,!1)||backspaceDelete$9(editor)||backspaceDelete$4(editor,!1)||backspaceDelete$1(editor,!1)||backspaceDelete$7(editor)||backspaceDelete$2(editor,!1)||(nativeCommand(editor,"Delete"),paddEmptyBody(editor))}(editor,caret)})),editor.addCommand("forwardDelete",(function(){!function(editor,caret){backspaceDelete$5(editor,!0)||backspaceDelete$6(editor,!0)||backspaceDelete$3(editor,caret,!0)||backspaceDelete$8(editor,!0)||backspaceDelete$9(editor)||backspaceDelete$4(editor,!0)||backspaceDelete$1(editor,!0)||backspaceDelete$7(editor)||backspaceDelete$2(editor,!0)||nativeCommand(editor,"ForwardDelete")}(editor,caret)}))},getTouch=function(event){return void 0===event.touches||1!==event.touches.length?Optional.none():Optional.some(event.touches[0])},setup$e=function(editor){var startData=value(),longpressFired=Cell(!1),debounceLongpress=last((function(e){editor.fire("longpress",__assign(__assign({},e),{type:"longpress"})),longpressFired.set(!0)}),400);editor.on("touchstart",(function(e){getTouch(e).each((function(touch){debounceLongpress.cancel();var data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e),longpressFired.set(!1),startData.set(data)}))}),!0),editor.on("touchmove",(function(e){debounceLongpress.cancel(),getTouch(e).each((function(touch){startData.on((function(data){(function(touch,data){var distX=Math.abs(touch.clientX-data.x),distY=Math.abs(touch.clientY-data.y);return distX>5||distY>5})(touch,data)&&(startData.clear(),longpressFired.set(!1),editor.fire("longpresscancel"))}))}))}),!0),editor.on("touchend touchcancel",(function(e){debounceLongpress.cancel(),"touchcancel"!==e.type&&startData.get().filter((function(data){return data.target.isEqualNode(e.target)})).each((function(){longpressFired.get()?e.preventDefault():editor.fire("tap",__assign(__assign({},e),{type:"tap"}))}))}),!0)},isBlockElement=function(blockElements,node){return has$2(blockElements,node.nodeName)},isValidTarget=function(blockElements,node){return!!isText$7(node)||!!isElement$5(node)&&(!isBlockElement(blockElements,node)&&!isBookmarkNode$1(node))},shouldRemoveTextNode=function(blockElements,node){if(isText$7(node)){if(0===node.nodeValue.length)return!0;if(/^\s+$/.test(node.nodeValue)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling)))return!0}return!1},addRootBlocks=function(editor){var rootBlockNode,tempNode,wrapped,dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements(),node=selection.getStart(),rootNode=editor.getBody(),forcedRootBlock=getForcedRootBlock(editor);if(node&&isElement$5(node)&&forcedRootBlock){var rootNodeName=rootNode.nodeName.toLowerCase();if(schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())&&!function(blockElements,root,node){return exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),(function(elm){return isBlockElement(blockElements,elm.dom)}))}(blockElements,rootNode,node)){var rng=selection.getRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,restoreSelection=hasFocus(editor);for(node=rootNode.firstChild;node;)if(isValidTarget(blockElements,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node,node=node.nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,getForcedRootBlockAttrs(editor)),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),tempNode=node,node=node.nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;wrapped&&restoreSelection&&(rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng),editor.nodeChanged())}}},showBlockCaretContainer=function(editor,blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.selection.scrollIntoView(blockCaretContainer))},handleBlockContainer=function(editor,e){var blockCaretContainer=function(editor){return descendant(SugarElement.fromDom(editor.getBody()),"*[data-mce-caret]").map((function(elm){return elm.dom})).getOrNull()}(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(editor,blockCaretContainer)):void(hasContent(blockCaretContainer)&&(showBlockCaretContainer(editor,blockCaretContainer),editor.undoManager.add()))},isContentEditableFalse$2=isContentEditableFalse$b,exitPreBlock=function(editor,direction,range){var caretWalker=CaretWalker(editor.getBody()),getVisualCaretPosition$1=curry(getVisualCaretPosition,1===direction?caretWalker.next:caretWalker.prev);if(range.collapsed&&function(editor){return""!==getForcedRootBlock(editor)}(editor)){var pre=editor.dom.getParent(range.startContainer,"PRE");if(!pre)return;if(!getVisualCaretPosition$1(CaretPosition.fromRangeStart(range))){var newBlock=function(editor){var textBlock=editor.dom.create(getForcedRootBlock(editor));return(!Env.ie||Env.ie>=11)&&(textBlock.innerHTML='<br data-mce-bogus="1">'),textBlock}(editor);1===direction?editor.$(pre).after(newBlock):editor.$(pre).before(newBlock),editor.selection.select(newBlock,!0),editor.selection.collapse()}}},getHorizontalRange=function(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return function(direction,editor,range){return moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$2)}(direction,editor,range).orThunk((function(){return exitPreBlock(editor,direction,range),Optional.none()}))},getVerticalRange=function(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return function(direction,editor,range){return moveVertically(editor,direction,range,(function(caretPosition){return isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition)}),(function(caretPosition){return isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition)}),isContentEditableFalse$2)}(direction,editor,range).orThunk((function(){return exitPreBlock(editor,direction,range),Optional.none()}))},moveH$2=function(editor,forward){return getHorizontalRange(editor,forward).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveV$3=function(editor,down){return getVerticalRange(editor,down).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveToLineEndPoint$1=function(editor,forward){return moveToLineEndPoint$3(editor,forward,forward?isAfterContentEditableFalse:isBeforeContentEditableFalse)},isTarget=function(node){return contains$3(["figcaption"],name(node))},rangeBefore=function(target){var rng=document.createRange();return rng.setStartBefore(target.dom),rng.setEndBefore(target.dom),rng},insertElement=function(root,elm,forward){forward?append$1(root,elm):prepend(root,elm)},insertEmptyLine=function(root,rootBlockName,attrs,forward){return""===rootBlockName?function(root,forward){var br=SugarElement.fromTag("br");return insertElement(root,br,forward),rangeBefore(br)}(root,forward):function(root,forward,blockName,attrs){var block=SugarElement.fromTag(blockName),br=SugarElement.fromTag("br");return setAll$1(block,attrs),append$1(block,br),insertElement(root,block,forward),rangeBefore(br)}(root,forward,rootBlockName,attrs)},isAtFirstOrLastLine=function(root,forward,pos){return forward?function(scope,pos){return getPositionsUntilNextLine(scope,pos).breakAt.isNone()}(root.dom,pos):function(scope,pos){return getPositionsUntilPreviousLine(scope,pos).breakAt.isNone()}(root.dom,pos)},moveCaretToNewEmptyLine=function(editor,forward){var root=SugarElement.fromDom(editor.getBody()),pos=CaretPosition.fromRangeStart(editor.selection.getRng()),rootBlock=getForcedRootBlock(editor),rootBlockAttrs=getForcedRootBlockAttrs(editor);return function(pos,root){var isRoot=curry(eq,root);return closest$3(SugarElement.fromDom(pos.container()),isBlock$2,isRoot).filter(isTarget)}(pos,root).exists((function(){if(isAtFirstOrLastLine(root,forward,pos)){var rng=insertEmptyLine(root,rootBlock,rootBlockAttrs,forward);return editor.selection.setRng(rng),!0}return!1}))},moveV$2=function(editor,forward){return!!editor.selection.isCollapsed()&&moveCaretToNewEmptyLine(editor,forward)},match$1=function(patterns,evt){return bind(function(patterns){return map$3(patterns,(function(pattern){return __assign({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:noop},pattern)}))}(patterns),(function(pattern){return function(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey}(pattern,evt)?[pattern]:[]}))},action=function(f){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];return function(){return f.apply(null,x)}},execute=function(patterns,evt){return find$3(match$1(patterns,evt),(function(pattern){return pattern.action()}))},moveH$1=function(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveV$1=function(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveToLineEndPoint=function(editor,forward){return moveToLineEndPoint$3(editor,forward,forward?isAfterMedia:isBeforeMedia)},getClosestCell=function(getYAxisValue,isTargetCorner,table,x,y){var cells=descendants(SugarElement.fromDom(table),"td,th,caption").map((function(e){return e.dom})),corners=filter$4(function(getYAxisValue,tds){return bind(tds,(function(td){var rect=function(rect,delta){return{left:rect.left-delta,top:rect.top-delta,right:rect.right+2*delta,bottom:rect.bottom+2*delta,width:rect.width+delta,height:rect.height+delta}}(clone(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}]}))}(getYAxisValue,cells),(function(corner){return isTargetCorner(corner,y)}));return function(corners,x,y){return foldl(corners,(function(acc,newCorner){return acc.fold((function(){return Optional.some(newCorner)}),(function(oldCorner){var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y)),newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner)}))}),Optional.none())}(corners,x,y).map((function(corner){return corner.cell}))},getClosestCellAbove=curry(getClosestCell,(function(rect){return rect.bottom}),(function(corner,y){return corner.y<y})),getClosestCellBelow=curry(getClosestCell,(function(rect){return rect.top}),(function(corner,y){return corner.y>y})),findClosestPositionInAboveCell=function(table,pos){return head(pos.getClientRects()).bind((function(rect){return getClosestCellAbove(table,rect.left,rect.top)})).bind((function(cell){return findClosestHorizontalPosition(lastPositionIn(scope=cell).map((function(pos){return getPositionsUntilPreviousLine(scope,pos).positions.concat(pos)})).getOr([]),pos);var scope}))},findClosestPositionInBelowCell=function(table,pos){return last$2(pos.getClientRects()).bind((function(rect){return getClosestCellBelow(table,rect.left,rect.top)})).bind((function(cell){return findClosestHorizontalPosition(firstPositionIn(scope=cell).map((function(pos){return[pos].concat(getPositionsUntilNextLine(scope,pos).positions)})).getOr([]),pos);var scope}))},isAtTableCellLine=function(getPositionsUntil,scope,pos){var lineInfo=getPositionsUntil(scope,pos);return function(lineInfo){return lineInfo.breakType===BreakType.Wrap&&0===lineInfo.positions.length}(lineInfo)||!isBr$5(pos.getNode())&&function(lineInfo){return lineInfo.breakType===BreakType.Br&&1===lineInfo.positions.length}(lineInfo)?!function(getPositionsUntil,scope,lineInfo){return lineInfo.breakAt.exists((function(breakPos){return getPositionsUntil(scope,breakPos).breakAt.isSome()}))}(getPositionsUntil,scope,lineInfo):lineInfo.breakAt.isNone()},isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine),isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine),navigateHorizontally=function(editor,forward,table,_td){var rng=editor.selection.getRng(),direction=forward?1:-1;return!(!isFakeCaretTableBrowser()||!function(forward,rng,table){var caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists((function(pos){return pos.isEqual(caretPos)}))}(forward,rng,table))&&(showCaret(direction,editor,table,!forward,!1).each((function(newRng){moveToRange(editor,newRng)})),!0)},getTable=function(previous,pos){var node=pos.getNode(previous);return isElement$5(node)&&"TABLE"===node.nodeName?Optional.some(node):Optional.none()},moveCaret=function(editor,down,pos){var table=getTable(!!down,pos),last=!1===down;table.fold((function(){return moveToRange(editor,pos.toRange())}),(function(table){return positionIn(last,editor.getBody()).filter((function(lastPos){return lastPos.isEqual(pos)})).fold((function(){return moveToRange(editor,pos.toRange())}),(function(_){return function(down,editor,table,pos){var forcedRootBlock=getForcedRootBlock(editor);forcedRootBlock?editor.undoManager.transact((function(){var element=SugarElement.fromTag(forcedRootBlock);setAll$1(element,getForcedRootBlockAttrs(editor)),append$1(element,SugarElement.fromTag("br")),down?after$3(SugarElement.fromDom(table),element):before$4(SugarElement.fromDom(table),element);var rng=editor.dom.createRng();rng.setStart(element.dom,0),rng.setEnd(element.dom,0),moveToRange(editor,rng)})):moveToRange(editor,pos.toRange())}(down,editor,table,pos)}))}))},navigateVertically=function(editor,down,table,td){var rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){var newPos=function(root,table,start){return findClosestPositionInAboveCell(table,start).orThunk((function(){return head(start.getClientRects()).bind((function(rect){return findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left)}))})).getOr(CaretPosition.before(table))}(root,table,pos);return moveCaret(editor,down,newPos),!0}if(down&&isAtLastTableCellLine(td,pos)){newPos=function(root,table,start){return findClosestPositionInBelowCell(table,start).orThunk((function(){return head(start.getClientRects()).bind((function(rect){return findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left)}))})).getOr(CaretPosition.after(table))}(root,table,pos);return moveCaret(editor,down,newPos),!0}return!1},move$1=function(editor,forward,mover){return Optional.from(editor.dom.getParent(editor.selection.getNode(),"td,th")).bind((function(td){return Optional.from(editor.dom.getParent(td,"table")).map((function(table){return mover(editor,forward,table,td)}))})).getOr(!1)},moveH=function(editor,forward){return move$1(editor,forward,navigateHorizontally)},moveV=function(editor,forward){return move$1(editor,forward,navigateVertically)},setup$b=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){var os=detect().os;execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$2,editor,!1)},{keyCode:VK.UP,action:action(moveV$3,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$3,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH,editor,!0)},{keyCode:VK.LEFT,action:action(moveH,editor,!1)},{keyCode:VK.UP,action:action(moveV,editor,!1)},{keyCode:VK.DOWN,action:action(moveV,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$1,editor,!1)},{keyCode:VK.UP,action:action(moveV$1,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$1,editor,!0)},{keyCode:VK.RIGHT,action:action(move$2,editor,caret,!0)},{keyCode:VK.LEFT,action:action(move$2,editor,caret,!1)},{keyCode:VK.RIGHT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$2,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$2,editor,!0)}],evt).each((function(_){evt.preventDefault()}))}(editor,caret,evt)}))},setup$a=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){execute([{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,!1)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,caret,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$1,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,!0)}],evt).each((function(_){evt.preventDefault()}))}(editor,caret,evt)})),editor.on("keyup",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,evt){execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)}],evt)}(editor,evt)}))},moveToCaretPosition=function(editor,root){var node,lastNode=root,dom=editor.dom,moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(root){if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=function(node){for(;node;){if(1===node.nodeType||3===node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}}(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(""),root.firstChild)}var rng=dom.createRng();if(root.normalize(),root.hasChildNodes()){for(var walker=new DomTreeWalker(root,root);node=walker.current();){if(isText$7(node)){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else isBr$5(root)?root.nextSibling&&dom.isBlock(root.nextSibling)?(rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)}},getParentBlock=function(editor){return Optional.from(editor.dom.getParent(editor.selection.getStart(!0),editor.dom.isBlock))},hasParent=function(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName},isListBlock=function(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName)},getContainerBlock=function(containerBlock){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock},isFirstOrLastLi=function(containerBlock,parentBlock,first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&!isElement$5(node);)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock},insert$3=function(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var dom=editor.dom,rng=editor.selection.getRng();if(containerBlock!==editor.getBody()){var elm;isListBlock(elm=containerBlock)&&isListBlock(elm.parentNode)&&(newBlockName="LI");var newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR");if(isFirstOrLastLi(containerBlock,parentBlock,!0)&&isFirstOrLastLi(containerBlock,parentBlock,!1))if(hasParent(containerBlock,"LI")){var containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent),!function(elm){var _a;return(null===(_a=elm.parentNode)||void 0===_a?void 0:_a.firstChild)===elm}(containerBlock)?dom.remove(containerBlock):dom.remove(containerBlockParent)}else dom.replace(newBlock,containerBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!0))hasParent(containerBlock,"LI")?(dom.insertAfter(newBlock,getContainerBlock(containerBlock)),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(newBlock,containerBlock),dom.remove(parentBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!1))dom.insertAfter(newBlock,getContainerBlock(containerBlock)),dom.remove(parentBlock);else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();"LI"===newBlockName&&function(elm,name){return elm.firstChild&&elm.firstChild.nodeName===name}(fragment,"LI")?(newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock)):(dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock)),dom.remove(parentBlock)}moveToCaretPosition(editor,newBlock)}},isEmptyAnchor=function(dom,elm){return elm&&"A"===elm.nodeName&&dom.isEmpty(elm)},emptyBlock=function(elm){elm.innerHTML='<br data-mce-bogus="1">'},containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName},canSplitBlock=function(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)},normalizeZwspOffset=function(start,container,offset){return!1===isText$7(container)?offset:start?1===offset&&"\ufeff"===container.data.charAt(offset-1)?0:offset:offset===container.data.length-1&&"\ufeff"===container.data.charAt(offset)?container.data.length:offset},getEditableRoot=function(dom,node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root},setForcedBlockAttrs=function(editor,node){var forcedRootBlockName=getForcedRootBlock(editor);forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()&&function(editor,node,forcedRootBlockAttrs){var dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each((function(attrStyles){var currentStyles=getAllRaw(SugarElement.fromDom(node)),newStyles=__assign(__assign({},currentStyles),attrStyles);dom.setStyles(node,newStyles)}));var attrClassesOpt=Optional.from(forcedRootBlockAttrs.class).map((function(attrClasses){return attrClasses.split(/\s+/)})),currentClassesOpt=Optional.from(node.className).map((function(currentClasses){return filter$4(currentClasses.split(/\s+/),(function(clazz){return""!==clazz}))}));lift2(attrClassesOpt,currentClassesOpt,(function(attrClasses,currentClasses){var filteredClasses=filter$4(currentClasses,(function(clazz){return!contains$3(attrClasses,clazz)})),newClasses=__spreadArray(__spreadArray([],attrClasses,!0),filteredClasses,!0);dom.setAttrib(node,"class",newClasses.join(" "))}));var appliedAttrs=["style","class"],remainingAttrs=filter$3(forcedRootBlockAttrs,(function(_,attrs){return!contains$3(appliedAttrs,attrs)}));dom.setAttribs(node,remainingAttrs)}(editor,node,getForcedRootBlockAttrs(editor))},insert$2=function(editor,evt){var tmpRng,container,offset,parentBlock,newBlock,fragment,containerBlock,parentBlockName,newBlockName,isAfterLastNodeInContainer,dom=editor.dom,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),rng=editor.selection.getRng(),createNewBlock=function(name){var block,clonedNode,caretNode,node=container,textInlineElements=schema.getTextInlineElements();if(caretNode=block=name||"TABLE"===parentBlockName||"HR"===parentBlockName?dom.create(name||newBlockName):parentBlock.cloneNode(!1),!1===function(editor){return editor.getParam("keep_styles",!0)}(editor))dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);else do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node))continue;clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?(clonedNode.appendChild(block.firstChild),block.appendChild(clonedNode)):(caretNode=clonedNode,block.appendChild(clonedNode))}}while((node=node.parentNode)&&node!==editableRoot);return setForcedBlockAttrs(editor,block),emptyBlock(caretNode),block},isCaretAtStartOrEndOfBlock=function(start){var node,name,normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$7(container)&&(start?normalizedOffset>0:normalizedOffset<container.nodeValue.length))return!1;if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&isElement$5(container)&&container===parentBlock.firstChild)return!0;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;var walker=new DomTreeWalker(container,parentBlock);for(isText$7(container)&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!==container.nodeValue.length||walker.next());node=walker.current();){if(isElement$5(node)){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return!1}else if(isText$7(node)&&!isWhitespaceText(node.nodeValue))return!1;start?walker.prev():walker.next()}return!0},insertNewBlockAfter=function(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!==containerBlockName?createNewBlock(newBlockName):createNewBlock(),function(editor){return editor.getParam("end_container_on_empty_block",!1)}(editor)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(editor,newBlock)};normalize$2(dom,rng).each((function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)})),container=rng.startContainer,offset=rng.startOffset,newBlockName=getForcedRootBlock(editor);var shiftKey=!(!evt||!evt.shiftKey),ctrlKey=!(!evt||!evt.ctrlKey);isElement$5(container)&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&isText$7(container)?container.nodeValue.length:0);var editableRoot=getEditableRoot(dom,container);if(editableRoot){(newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=function(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P",dom=editor.dom,editableRoot=getEditableRoot(dom,container);if(!(parentBlock=dom.getParent(container,dom.isBlock))||!canSplitBlock(dom,parentBlock)){if(rootBlockName=(parentBlock=parentBlock||editableRoot)===editor.getBody()||function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}(parentBlock)?parentBlock.nodeName.toLowerCase():parentBlock.parentNode.nodeName.toLowerCase(),!parentBlock.hasChildNodes())return newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!==parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)startNode=node,node=node.previousSibling;if(startNode&&editor.schema.isValidChild(rootBlockName,blockName.toLowerCase())){for(newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container}(editor,newBlockName,rng,container,offset)),parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"";"LI"!==containerBlockName||ctrlKey||(parentBlock=containerBlock,containerBlock=containerBlock.parentNode,parentBlockName=containerBlockName),/^(LI|DT|DD)$/.test(parentBlockName)&&dom.isEmpty(parentBlock)?insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName):newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",isCaretContainerBlock$1(parentBlock)?(newBlock=showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock)):isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),moveToCaretPosition(editor,containerAndSiblingName(parentBlock,"HR")?newBlock:parentBlock)):(tmpRng=function(rng){var newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng}(rng).cloneRange(),tmpRng.setEndAfter(parentBlock),function(fragment){each$k(descendants$1(SugarElement.fromDom(fragment),isText$8),(function(text){var rawNode=text.dom;rawNode.nodeValue=trim$2(rawNode.nodeValue)}))}(fragment=tmpRng.extractContents()),function(node){do{isText$7(node)&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild}while(node)}(fragment),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),function(dom,nonEmptyElementsMap,block){var i,node=block,firstChilds=[];if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;isElement$5(node)&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]&&firstChilds.push(node)}for(i=firstChilds.length;i--;)(!(node=firstChilds[i]).hasChildNodes()||node.firstChild===node.lastChild&&""===node.firstChild.nodeValue||isEmptyAnchor(dom,node))&&dom.remove(node)}}(dom,nonEmptyElementsMap,newBlock),function(dom,block){block.normalize();var lastChild=block.lastChild;lastChild&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br")}(dom,parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):(setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock))),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock}))}},moveSelectionToBr=function(editor,brElm,extraBr){var rng=editor.dom.createRng();extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)},insertBrAtCaret=function(editor,evt){var brElm,extraBr,selection=editor.selection,dom=editor.dom,rng=selection.getRng();normalize$2(dom,rng).each((function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)}));var offset=rng.startOffset,container=rng.startContainer;if(1===container.nodeType&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3===container.nodeType?container.nodeValue.length:0}var parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=!(!evt||!evt.ctrlKey);"LI"!==containerBlockName||isControlKey||(parentBlock=containerBlock),container&&3===container.nodeType&&offset>=container.nodeValue.length&&(function(schema,container,parentBlock){for(var node,walker=new DomTreeWalker(container,parentBlock),nonEmptyElementsMap=schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0)return!0}(editor.schema,container,parentBlock)||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rangeInsertNode(dom,rng,brElm),moveSelectionToBr(editor,brElm,extraBr),editor.undoManager.add()},insertBrBefore=function(editor,inline){var br=SugarElement.fromTag("br");before$4(SugarElement.fromDom(inline),br),editor.undoManager.add()},insertBrAfter=function(editor,inline){hasBrAfter(editor.getBody(),inline)||after$3(SugarElement.fromDom(inline),SugarElement.fromTag("br"));var br=SugarElement.fromTag("br");after$3(SugarElement.fromDom(inline),br),moveSelectionToBr(editor,br.dom,!1),editor.undoManager.add()},hasBrAfter=function(rootNode,startNode){return pos=CaretPosition.after(startNode),!!isBr$5(pos.getNode())||nextPosition(rootNode,CaretPosition.after(startNode)).map((function(pos){return isBr$5(pos.getNode())})).getOr(!1);var pos},isAnchorLink=function(elm){return elm&&"A"===elm.nodeName&&"href"in elm},isInsideAnchor=function(location){return location.fold(never,isAnchorLink,isAnchorLink,never)},insertBrOutsideAnchor=function(editor,location){location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop)},insert$1=function(editor,evt){var anchorLocation=function(editor){var isInlineTarget$1=curry(isInlineTarget,editor),position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor)}(editor);anchorLocation.isSome()?anchorLocation.each(curry(insertBrOutsideAnchor,editor)):insertBrAtCaret(editor,evt)},matchesSelector=function(editor,selector){return getParentBlock(editor).filter((function(parentBlock){return selector.length>0&&is$2(SugarElement.fromDom(parentBlock),selector)})).isSome()},newLineAction=Adt_generate([{br:[]},{block:[]},{none:[]}]),shouldBlockNewLine=function(editor,_shiftKey){return function(editor){return matchesSelector(editor,function(editor){return editor.getParam("no_newline_selector","")}(editor))}(editor)},isBrMode=function(requiredState){return function(editor,_shiftKey){return""===getForcedRootBlock(editor)===requiredState}},inListBlock=function(requiredState){return function(editor,_shiftKey){return function(editor){return getParentBlock(editor).filter((function(elm){return isListItem(SugarElement.fromDom(elm))})).isSome()}(editor)===requiredState}},inBlock=function(blockName,requiredState){return function(editor,_shiftKey){var state=function(editor){return getParentBlock(editor).fold(constant(""),(function(parentBlock){return parentBlock.nodeName.toUpperCase()}))}(editor)===blockName.toUpperCase();return state===requiredState}},inPreBlock=function(requiredState){return inBlock("pre",requiredState)},shouldPutBrInPre=function(requiredState){return function(editor,_shiftKey){return function(editor){return editor.getParam("br_in_pre",!0)}(editor)===requiredState}},inBrContext=function(editor,_shiftKey){return function(editor){return matchesSelector(editor,function(editor){return editor.getParam("br_newline_selector",".mce-toc h2,figcaption,caption")}(editor))}(editor)},hasShiftKey=function(_editor,shiftKey){return shiftKey},canInsertIntoEditableRoot=function(editor){var forcedRootBlock=getForcedRootBlock(editor),rootEditable=function(dom,node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root}(editor.dom,editor.selection.getStart());return rootEditable&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock||"P")},match=function(predicates,action){return function(editor,shiftKey){return foldl(predicates,(function(res,p){return res&&p(editor,shiftKey)}),!0)?Optional.some(action):Optional.none()}},insert=function(editor,evt){(function(editor,evt){return evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inBlock("summary",!0)],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1),hasShiftKey],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1)],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0),hasShiftKey],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0)],newLineAction.br()),match([inListBlock(!0),hasShiftKey],newLineAction.br()),match([inListBlock(!0)],newLineAction.block()),match([isBrMode(!0),hasShiftKey,canInsertIntoEditableRoot],newLineAction.block()),match([isBrMode(!0)],newLineAction.br()),match([inBrContext],newLineAction.br()),match([isBrMode(!1),hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block())],[editor,!(!evt||!evt.shiftKey)]).getOr(newLineAction.none())})(editor,evt).fold((function(){insert$1(editor,evt)}),(function(){insert$2(editor,evt)}),noop)},setup$9=function(editor){editor.on("keydown",(function(event){event.keyCode===VK.ENTER&&function(editor,event){var undoManager;event.isDefaultPrevented()||(event.preventDefault(),(undoManager=editor.undoManager).typing&&(undoManager.typing=!1,undoManager.add()),editor.undoManager.transact((function(){!1===editor.selection.isCollapsed()&&editor.execCommand("Delete"),insert(editor,event)})))}(editor,event)}))},setup$8=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,!0,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,!1,caret)}],evt).each((function(_){evt.preventDefault()}))}(editor,caret,evt)}))},browser=detect().browser,setup$7=function(editor){!function(editor){var keypressThrotter=first((function(){editor.composing||normalizeNbspsInEditor(editor)}),0);browser.isIE()&&(editor.on("keypress",(function(_e){keypressThrotter.throttle()})),editor.on("remove",(function(_e){keypressThrotter.cancel()})))}(editor),editor.on("input",(function(e){!1===e.isComposing&&normalizeNbspsInEditor(editor)}))},platform=detect(),stopImmediatePropagation=function(e){return e.stopImmediatePropagation()},isPageUpDown=function(evt){return evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN},setNodeChangeBlocker=function(blocked,editor,block){block&&!blocked.get()?editor.on("NodeChange",stopImmediatePropagation,!0):!block&&blocked.get()&&editor.off("NodeChange",stopImmediatePropagation),blocked.set(block)},setup$6=function(editor,caret){if(!platform.os.isOSX()){var blocked=Cell(!1);editor.on("keydown",(function(evt){isPageUpDown(evt)&&setNodeChangeBlocker(blocked,editor,!0)})),editor.on("keyup",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,caret,evt){execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,!1,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,!0,caret)}],evt)}(editor,caret,evt),isPageUpDown(evt)&&blocked.get()&&(setNodeChangeBlocker(blocked,editor,!1),editor.nodeChanged())}))}},insertTextAtPosition=function(text,pos){var container=pos.container(),offset=pos.offset();return isText$7(container)?(container.insertData(offset,text),Optional.some(CaretPosition(container,offset+text.length))):getElementFromPosition(pos).map((function(elm){var textNode=SugarElement.fromText(text);return pos.isAtEnd()?after$3(elm,textNode):before$4(elm,textNode),CaretPosition(textNode.dom,text.length)}))},insertNbspAtPosition=curry(insertTextAtPosition,""),insertSpaceAtPosition=curry(insertTextAtPosition," "),insertInlineBoundarySpaceOrNbsp=function(root,pos){return function(checkPos){return function(root,pos){return!isInPre(pos)&&(isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos))}(root,checkPos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos)}},insertSpaceOrNbspAtSelection=function(editor){var pos=CaretPosition.fromRangeStart(editor.selection.getRng()),root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){var isInlineTarget$1=curry(isInlineTarget,editor),caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(function(root){return function(location){return location.fold((function(element){return prevPosition(root.dom,CaretPosition.before(element))}),(function(element){return firstPositionIn(element)}),(function(element){return lastPositionIn(element)}),(function(element){return nextPosition(root.dom,CaretPosition.after(element))}))}}(root)).bind(insertInlineBoundarySpaceOrNbsp(root,pos)).exists(function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),editor.nodeChanged(),!0}}(editor))}return!1},setup$5=function(editor){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&function(editor,evt){execute([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)}],evt).each((function(_){evt.preventDefault()}))}(editor,evt)}))},registerKeyboardOverrides=function(editor){var caret=setupSelectedState(editor);return function(editor){editor.on("keyup compositionstart",curry(handleBlockContainer,editor))}(editor),setup$b(editor,caret),setup$a(editor,caret),setup$9(editor),setup$5(editor),setup$7(editor),setup$8(editor,caret),setup$6(editor,caret),caret},NodeChange=function(){function NodeChange(editor){var lastRng;this.lastPath=[],this.editor=editor;var self=this;"onselectionchange"in editor.getDoc()||editor.on("NodeChange click mouseup keyup focus",(function(e){var nativeRng=editor.selection.getRng(),fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};"nodechange"!==e.type&&isEq$4(fakeRng,lastRng)||editor.fire("SelectionChange"),lastRng=fakeRng})),editor.on("contextmenu",(function(){editor.fire("SelectionChange")})),editor.on("SelectionChange",(function(){var startElm=editor.selection.getStart(!0);!startElm||!Env.range&&editor.selection.isCollapsed()||hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})})),editor.on("mouseup",(function(e){!e.isDefaultPrevented()&&hasAnyRanges(editor)&&("IMG"===editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,(function(){editor.nodeChanged()})):editor.nodeChanged())}))}return NodeChange.prototype.nodeChanged=function(args){var node,parents,root,selection=this.editor.selection;this.editor.initialized&&selection&&!this.editor.getParam("disable_nodechange")&&!this.editor.mode.isReadOnly()&&(root=this.editor.getBody(),(node=selection.getStart(!0)||root).ownerDocument===this.editor.getDoc()&&this.editor.dom.isChildOf(node,root)||(node=root),parents=[],this.editor.dom.getParent(node,(function(node){if(node===root)return!0;parents.push(node)})),(args=args||{}).element=node,args.parents=parents,this.editor.fire("NodeChange",args))},NodeChange.prototype.isSameElementPath=function(startElm){var i,currentPath=this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0&&currentPath[i]===this.lastPath[i];i--);if(-1===i)return this.lastPath=currentPath,!0}return this.lastPath=currentPath,!1},NodeChange}(),setup$3=function(editor){!function(editor){editor.on("click",(function(e){editor.dom.getParent(e.target,"details")&&e.preventDefault()}))}(editor),function(editor){editor.parser.addNodeFilter("details",(function(elms){each$k(elms,(function(details){details.attr("data-mce-open",details.attr("open")),details.attr("open","open")}))})),editor.serializer.addNodeFilter("details",(function(elms){each$k(elms,(function(details){var open=details.attr("data-mce-open");details.attr("open",isString$1(open)?open:null),details.attr("data-mce-open",null)}))}))}(editor)},isTextBlockNode=function(node){return isElement$5(node)&&isTextBlock$2(SugarElement.fromDom(node))},setup$2=function(editor){editor.on("click",(function(e){e.detail>=3&&function(editor){var rng=editor.selection.getRng(),startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng);if(CaretPosition.isElementPosition(startPos)){var container=startPos.container();isTextBlockNode(container)&&firstPositionIn(container).each((function(pos){return rng.setStart(pos.container(),pos.offset())}))}CaretPosition.isElementPosition(endPos)&&(container=startPos.container(),isTextBlockNode(container)&&lastPositionIn(container).each((function(pos){return rng.setEnd(pos.container(),pos.offset())})));editor.selection.setRng(normalize(rng))}(editor)}))},getAbsolutePosition=function(elm){var clientRect=elm.getBoundingClientRect(),doc=elm.ownerDocument,docElem=doc.documentElement,win=doc.defaultView;return{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft}},calc=function(editor,event){return bodyPosition=function(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0}}(editor),scrollPosition=function(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}}(editor),mousePosition=function(editor,event){if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),scrollPosition=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll}(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top}}return{left:event.pageX,top:event.pageY}}(editor,event),{pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top};var bodyPosition,scrollPosition,mousePosition},isContentEditableFalse$1=isContentEditableFalse$b,isContentEditableTrue$1=isContentEditableTrue$4,createGhost=function(editor,elm,width,height){var dom=editor.dom,clonedElm=elm.cloneNode(!0);dom.setStyles(clonedElm,{width,height}),dom.setAttrib(clonedElm,"data-mce-selected",null);var ghostElm=dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return dom.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width,height}),dom.setStyles(clonedElm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(clonedElm),ghostElm},removeElement=function(elm){elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},start=function(state,editor){return function(e){if(function(e){return 0===e.button}(e)){var ceElm=find$3(editor.dom.getParents(e.target),function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}}(isContentEditableFalse$1,isContentEditableTrue$1)).getOr(null);if(rootElm=editor.getBody(),isContentEditableFalse$1(elm=ceElm)&&elm!==rootElm){var elmPos=editor.dom.getPos(ceElm),bodyElm=editor.getBody(),docElm=editor.getDoc().documentElement;state.set({element:ceElm,dragging:!1,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight)})}}var rootElm,elm}},drop=function(state,editor){return function(e){state.on((function(state){if(state.dragging){if(function(editor,targetElement,dragElement){return targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&!isContentEditableFalse$1(targetElement)}(editor,(selection=editor.selection,3===(startContainer=selection.getSel().getRangeAt(0).startContainer).nodeType?startContainer.parentNode:startContainer),state.element)){var targetClone_1=(elm=state.element,(cloneElm=elm.cloneNode(!0)).removeAttribute("data-mce-selected"),cloneElm);editor.fire("drop",{clientX:e.clientX,clientY:e.clientY}).isDefaultPrevented()||editor.undoManager.transact((function(){removeElement(state.element),editor.insertContent(editor.dom.getOuterHTML(targetClone_1)),editor._selectionOverrides.hideFakeCaret()}))}editor.fire("dragend")}var elm,cloneElm,selection,startContainer})),removeDragState(state)}},removeDragState=function(state){state.on((function(state){removeElement(state.ghost)})),state.clear()},bindFakeDragEvents=function(editor){var state=value(),pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start(state,editor),dragHandler=function(state,editor){var throttledPlaceCaretAt=Delay.throttle((function(clientX,clientY){editor._selectionOverrides.hideFakeCaret(),editor.selection.placeCaretAt(clientX,clientY)}),0);return editor.on("remove",throttledPlaceCaretAt.stop),function(e){return state.on((function(state){var ghostElm,bodyElm,movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){if(editor.fire("dragstart",{target:state.element}).isDefaultPrevented())return;state.dragging=!0,editor.focus()}if(state.dragging){var targetPos=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5}}(state,calc(editor,e));ghostElm=state.ghost,bodyElm=editor.getBody(),ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm),function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px"}(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY),throttledPlaceCaretAt(e.clientX,e.clientY)}}))}}(state,editor),dropHandler=drop(state,editor),dragEndHandler=function(state,editor){return function(){state.on((function(state){state.dragging&&editor.fire("dragend")})),removeDragState(state)}}(state,editor);editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",(function(){pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)})),editor.on("keydown",(function(e){e.keyCode===VK.ESC&&dragEndHandler()}))},init$2=function(editor){bindFakeDragEvents(editor),function(editor){editor.on("drop",(function(e){var realTarget=void 0!==e.clientX?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;(isContentEditableFalse$1(realTarget)||"false"===editor.dom.getContentEditableParent(realTarget))&&e.preventDefault()}))}(editor),function(editor){return editor.getParam("block_unsupported_drop",!0,"boolean")}(editor)&&function(editor){var preventFileDrop=function(e){if(!e.isDefaultPrevented()){var dataTransfer=e.dataTransfer;dataTransfer&&(contains$3(dataTransfer.types,"Files")||dataTransfer.files.length>0)&&(e.preventDefault(),"drop"===e.type&&displayError(editor,"Dropped file type is not supported"))}},preventFileDropIfUIElement=function(e){isUIElement(editor,e.target)&&preventFileDrop(e)},setup=function(){var pageDom=DOMUtils.DOM,dom=editor.dom,doc=document,editorRoot=editor.inline?editor.getBody():editor.getDoc(),eventNames=["drop","dragover"];each$k(eventNames,(function(name){pageDom.bind(doc,name,preventFileDropIfUIElement),dom.bind(editorRoot,name,preventFileDrop)})),editor.on("remove",(function(){each$k(eventNames,(function(name){pageDom.unbind(doc,name,preventFileDropIfUIElement),dom.unbind(editorRoot,name,preventFileDrop)}))}))};editor.on("init",(function(){Delay.setEditorTimeout(editor,setup,0)}))}(editor)},isContentEditableTrue=isContentEditableTrue$4,isContentEditableFalse=isContentEditableFalse$b,getContentEditableRoot=function(editor,node){return getContentEditableRoot$1(editor.getBody(),node)},SelectionOverrides=function(editor){var selectedElement,selection=editor.selection,dom=editor.dom,isBlock=dom.isBlock,rootNode=editor.getBody(),fakeCaret=FakeCaret(editor,rootNode,isBlock,(function(){return hasFocus(editor)})),realSelectionId="sel-"+dom.uniqueId(),isFakeSelectionTargetElement=function(node){return node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode)},isNearFakeSelectionElement=function(pos){return isBeforeContentEditableFalse(pos)||isAfterContentEditableFalse(pos)||isBeforeMedia(pos)||isAfterMedia(pos)},setRange=function(range){range&&selection.setRng(range)},getRange=selection.getRng,showCaret=function(direction,node,before,scrollIntoView){return void 0===scrollIntoView&&(scrollIntoView=!0),editor.fire("ShowCaret",{target:node,direction,before}).isDefaultPrevented()?null:(scrollIntoView&&selection.scrollIntoView(node,-1===direction),fakeCaret.show(before,node))},isWithinCaretContainer=function(node){return isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node)},isRangeInCaretContainer=function(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer)},normalizeShortEndedElementSelection=function(rng){var shortEndedElements=editor.schema.getShortEndedElements(),newRng=dom.createRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return has$2(shortEndedElements,startContainer.nodeName.toLowerCase())?0===startOffset?newRng.setStartBefore(startContainer):newRng.setStartAfter(startContainer):newRng.setStart(startContainer,startOffset),has$2(shortEndedElements,endContainer.nodeName.toLowerCase())?0===endOffset?newRng.setEndBefore(endContainer):newRng.setEndAfter(endContainer):newRng.setEnd(endContainer,endOffset),newRng},selectElement=function(elm){var targetClone=elm.cloneNode(!0),e=editor.fire("ObjectSelected",{target:elm,targetClone});if(e.isDefaultPrevented())return null;var range=function(node,targetClone,origTargetClone){var $=editor.$,$realSelectionContainer=descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).fold((function(){return $([])}),(function(elm){return $([elm.dom])}));0===$realSelectionContainer.length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId)).appendTo(editor.getBody());var newRange=dom.createRng();targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all"></p>').append(targetClone),newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild),newRange.setEndAfter(targetClone)):($realSelectionContainer.empty().append("").append(targetClone).append(""),newRange.setStart($realSelectionContainer[0].firstChild,1),newRange.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),$realSelectionContainer[0].focus();var sel=selection.getSel();return sel.removeAllRanges(),sel.addRange(newRange),newRange}(elm,e.targetClone,targetClone),nodeElm=SugarElement.fromDom(elm);return each$k(descendants(SugarElement.fromDom(editor.getBody()),"*[data-mce-selected]"),(function(elm){eq(nodeElm,elm)||remove$6(elm,"data-mce-selected")})),dom.getAttrib(elm,"data-mce-selected")||elm.setAttribute("data-mce-selected","1"),selectedElement=elm,hideFakeCaret(),range},setElementSelection=function(range,forward){if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1,caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range),beforeNode=caretPosition.getNode(!forward);if(isFakeCaretTarget(beforeNode))return showCaret(dir,beforeNode,!!forward&&!caretPosition.isAtEnd(),!1);var afterNode=caretPosition.getNode(forward);if(isFakeCaretTarget(afterNode))return showCaret(dir,afterNode,!forward&&!caretPosition.isAtEnd(),!1)}return null}var startContainer=range.startContainer,startOffset=range.startOffset,endOffset=range.endOffset;if(3===startContainer.nodeType&&0===startOffset&&isContentEditableFalse(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1!==startContainer.nodeType)return null;if(endOffset===startOffset+1&&startContainer===range.endContainer){var node=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(node))return selectElement(node)}return null},removeElementSelection=function(){selectedElement&&selectedElement.removeAttribute("data-mce-selected"),descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).each(remove$7),selectedElement=null},hideFakeCaret=function(){fakeCaret.hide()};return Env.ceFalse&&!isRtc(editor)&&function(){editor.on("mouseup",(function(e){var range=getRange();range.collapsed&&isXYInContentArea(editor,e.clientX,e.clientY)&&renderCaretAtRange(editor,range,!1).each(setRange)})),editor.on("click",(function(e){var contentEditableRoot=getContentEditableRoot(editor,e.target);contentEditableRoot&&(isContentEditableFalse(contentEditableRoot)&&(e.preventDefault(),editor.focus()),isContentEditableTrue(contentEditableRoot)&&dom.isChildOf(contentEditableRoot,selection.getNode())&&removeElementSelection())})),editor.on("blur NewBlock",removeElementSelection),editor.on("ResizeWindow FullscreenStateChanged",fakeCaret.reposition);var hasBetterMouseTarget=function(targetNode,caretNode){var node1,node2,targetBlock=dom.getParent(targetNode,isBlock),caretBlock=dom.getParent(caretNode,isBlock);return!isNullable(targetBlock)&&(!(targetNode===caretBlock||!dom.isChildOf(targetBlock,caretBlock)||!1!==isContentEditableFalse(getContentEditableRoot(editor,targetBlock)))||!dom.isChildOf(caretBlock,targetBlock)&&(node1=targetBlock,node2=caretBlock,!(dom.getParent(node1,isBlock)===dom.getParent(node2,isBlock)))&&function(elm){var start=elm.firstChild;if(isNullable(start))return!1;var startPos=CaretPosition.before(start);if(isBr$5(startPos.getNode())&&1===elm.childNodes.length)return!isNearFakeSelectionElement(startPos);var newPos=CaretWalker(elm).next(startPos);return newPos&&!isNearFakeSelectionElement(newPos)}(targetBlock))};editor.on("tap",(function(e){var targetElm=e.target,contentEditableRoot=getContentEditableRoot(editor,targetElm);isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):isFakeSelectionTargetElement(targetElm)&&selectNode(editor,targetElm).each(setElementSelection)}),!0),editor.on("mousedown",(function(e){var targetElm=e.target;if((targetElm===rootNode||"HTML"===targetElm.nodeName||dom.isChildOf(targetElm,rootNode))&&!1!==isXYInContentArea(editor,e.clientX,e.clientY)){var contentEditableRoot=getContentEditableRoot(editor,targetElm);if(contentEditableRoot)isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):(removeElementSelection(),isContentEditableTrue(contentEditableRoot)&&e.shiftKey||isXYWithinRange(e.clientX,e.clientY,selection.getRng())||(hideFakeCaret(),selection.placeCaretAt(e.clientX,e.clientY)));else if(isFakeSelectionTargetElement(targetElm))selectNode(editor,targetElm).each(setElementSelection);else if(!1===isFakeCaretTarget(targetElm)){removeElementSelection(),hideFakeCaret();var fakeCaretInfo=closestFakeCaret(rootNode,e.clientX,e.clientY);if(fakeCaretInfo&&!hasBetterMouseTarget(targetElm,fakeCaretInfo.node)){e.preventDefault();var range=showCaret(1,fakeCaretInfo.node,fakeCaretInfo.before,!1);setRange(range),editor.getBody().focus()}}}})),editor.on("keypress",(function(e){VK.modifierPressed(e)||isContentEditableFalse(selection.getNode())&&e.preventDefault()})),editor.on("GetSelectionRange",(function(e){var rng=e.range;if(selectedElement){if(!selectedElement.parentNode)return void(selectedElement=null);(rng=rng.cloneRange()).selectNode(selectedElement),e.range=rng}})),editor.on("SetSelectionRange",(function(e){e.range=normalizeShortEndedElementSelection(e.range);var rng=setElementSelection(e.range,e.forward);rng&&(e.range=rng)})),editor.on("AfterSetSelectionRange",(function(e){var node,rng=e.range,parentNode=rng.startContainer.parentNode;isRangeInCaretContainer(rng)||"mcepastebin"===parentNode.id||hideFakeCaret(),node=parentNode,dom.hasClass(node,"mce-offscreen-selection")||removeElementSelection()})),editor.on("copy",(function(e){var container,clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&&e.clipboardData&&!Env.ie){var realSelectionElement=(container=dom.get(realSelectionId))?container.getElementsByTagName("*")[0]:container;realSelectionElement&&(e.preventDefault(),clipboardData.clearData(),clipboardData.setData("text/html",realSelectionElement.outerHTML),clipboardData.setData("text/plain",realSelectionElement.outerText||realSelectionElement.innerText))}})),init$2(editor),function(editor){var renderFocusCaret=first((function(){if(!editor.removed&&editor.getBody().contains(document.activeElement)){var rng=editor.selection.getRng();if(rng.collapsed){var caretRange=renderRangeCaret(editor,rng,!1);editor.selection.setRng(caretRange)}}}),0);editor.on("focus",(function(){renderFocusCaret.throttle()})),editor.on("blur",(function(){renderFocusCaret.cancel()}))}(editor),function(editor){editor.on("init",(function(){editor.on("focusin",(function(e){var target=e.target;if(isMedia$2(target)){var ceRoot=getContentEditableRoot$1(editor.getBody(),target),node=isContentEditableFalse$b(ceRoot)?ceRoot:target;editor.selection.getNode()!==node&&selectNode(editor,node).each((function(rng){return editor.selection.setRng(rng)}))}}))}))}(editor)}(),{showCaret,showBlockCaretContainer:function(blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),setRange(getRange()),selection.scrollIntoView(blockCaretContainer))},hideFakeCaret,destroy:function(){fakeCaret.destroy(),selectedElement=null}}},Quirks=function(editor){var getAttributeApplyFunction,isSelectionAcrossElements,each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalDataType=isIE?"Text":"URL",setEditorCommandState=function(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}},isDefaultPrevented=function(e){return e.isDefaultPrevented()},emptyEditorWhenDeleting=function(){var serializeRng=function(rng){var body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})};editor.on("keydown",(function(e){var isCollapsed,body,keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)){if(isCollapsed=editor.selection.isCollapsed(),body=editor.getBody(),isCollapsed&&!dom.isEmpty(body))return;if(!isCollapsed&&!function(rng){var selection=serializeRng(rng),allRng=dom.createRng();return allRng.selectNode(editor.getBody()),selection===serializeRng(allRng)}(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}}))},selectAll=function(){editor.shortcuts.add("meta+a",null,"SelectAll")},documentElementEditingFocus=function(){editor.inline||dom.bind(editor.getDoc(),"mousedown mouseup",(function(e){var rng;if(e.target===editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"===e.type){if(isCaretContainer$2(rng.startContainer))return;selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)}))},focusBody=function(){Range.prototype.getClientRects||editor.on("mousedown",(function(e){if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){var body_1=editor.getBody();body_1.blur(),Delay.setEditorTimeout(editor,(function(){body_1.focus()}))}}))},selectControlElements=function(){editor.on("click",(function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"===target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))}))},disableBackspaceIntoATable=function(){editor.on("keydown",(function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng().startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}}))},setGeckoEditingOptions=function(){(function(editor){return editor.getParam("readonly")})(editor)||editor.on("BeforeExecCommand mousedown",(function(){setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),getObjectResizing(editor)||setEditorCommandState("enableObjectResizing",!1)}))},addBrAfterLastLinks=function(){editor.on("SetContent ExecCommand",(function(e){"setcontent"!==e.type&&"mceInsertLink"!==e.command||each(dom.select("a"),(function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}}))}))},showBrokenImageIcon=function(){editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")},restoreFocusOnKeyDown=function(){editor.inline||editor.on("keydown",(function(){document.activeElement===document.body&&editor.getWin().focus()}))},bodyHeight=function(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",(function(e){var rng;if("HTML"===e.target.nodeName){if(Env.ie>11)return void editor.getBody().focus();rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged()}})))},blockCmdArrowNavigation=function(){Env.mac&&editor.on("keydown",(function(e){!VK.metaKeyPressed(e)||e.shiftKey||37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37===e.keyCode?"backward":"forward","lineboundary"))}))},tapLinksAndImages=function(){editor.on("click",(function(e){var elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)})),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")},blockFormSubmitInsideEditor=function(){editor.on("init",(function(){editor.dom.bind(editor.getBody(),"submit",(function(e){e.preventDefault()}))}))},ieInternalDragAndDrop=function(){editor.on("dragstart",(function(e){!function(e){var selectionHtml,internalContent;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"===e.target.tagName&&selection.select(e.target),(selectionHtml=editor.selection.getContent()).length>0&&(internalContent="data:text/mce-internal,"+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,internalContent)))}(e)})),editor.on("drop",(function(e){if(!isDefaultPrevented(e)){var internalContent=function(e){var internalContent;return e.dataTransfer&&(internalContent=e.dataTransfer.getData(mceInternalDataType))&&internalContent.indexOf("data:text/mce-internal,")>=0?(internalContent=internalContent.substr("data:text/mce-internal,".length).split(","),{id:unescape(internalContent[0]),html:unescape(internalContent[1])}):null}(e);if(internalContent&&internalContent.id!==editor.id){e.preventDefault();var rng=fromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng),content=internalContent.html,internal=!0,editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content,internal}):editor.execCommand("mceInsertContent",!1,content)}}var content,internal}))},refreshContentEditable=noop;return isRtc(editor)?(isWebKit&&(documentElementEditingFocus(),selectControlElements(),blockFormSubmitInsideEditor(),selectAll(),Env.iOS&&(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages())),isGecko&&(focusBody(),setGeckoEditingOptions(),showBrokenImageIcon(),blockCmdArrowNavigation())):(editor.on("keydown",(function(e){var rng,parent;if(!isDefaultPrevented(e)&&e.keyCode===VK.BACKSPACE){var container=(rng=selection.getRng()).startContainer,offset=rng.startOffset,root=dom.getRoot();if(parent=container,rng.collapsed&&0===offset){for(;parent&&parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),(rng=dom.createRng()).setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}}})),emptyEditorWhenDeleting(),Env.windowsPhone||editor.on("keyup focusin mouseup",(function(e){VK.modifierPressed(e)||selection.normalize()}),!0),isWebKit&&(documentElementEditingFocus(),selectControlElements(),getForcedRootBlock(editor)&&editor.on("init",(function(){setEditorCommandState("DefaultParagraphSeparator",getForcedRootBlock(editor))})),blockFormSubmitInsideEditor(),disableBackspaceIntoATable(),parser.addNodeFilter("br",(function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"===nodes[i].attr("class")&&nodes[i].remove()})),Env.iOS?(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages()):selectAll()),Env.ie>=11&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),setEditorCommandState("AutoUrlDetect",!1),ieInternalDragAndDrop()),isGecko&&(editor.on("keydown",(function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng().startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"===node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}})),focusBody(),getAttributeApplyFunction=function(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,(function(attr){target.setAttributeNode(attr.cloneNode(!0))})))}},isSelectionAcrossElements=function(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock)},editor.on("keypress",(function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8===e.keyCode||46===e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1})),dom.bind(editor.getDoc(),"cut",(function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,(function(){applyAttributes()})))})),setGeckoEditingOptions(),addBrAfterLastLinks(),showBrokenImageIcon(),blockCmdArrowNavigation(),disableBackspaceIntoATable())),{refreshContentEditable,isHidden:function(){if(!isGecko||editor.removed)return!1;var sel=editor.selection.getSel();return!sel||!sel.rangeCount||0===sel.rangeCount}}},DOM$6=DOMUtils.DOM,getRootName=function(editor){return editor.inline?editor.getElement().nodeName.toLowerCase():void 0},removeUndefined=function(obj){return filter$3(obj,(function(v){return!1===isUndefined(v)}))},mkSchemaSettings=function(editor){var settings=editor.settings;return removeUndefined({block_elements:settings.block_elements,boolean_attributes:settings.boolean_attributes,custom_elements:settings.custom_elements,extended_valid_elements:settings.extended_valid_elements,invalid_elements:settings.invalid_elements,invalid_styles:settings.invalid_styles,move_caret_before_on_enter_elements:settings.move_caret_before_on_enter_elements,non_empty_elements:settings.non_empty_elements,schema:settings.schema,self_closing_elements:settings.self_closing_elements,short_ended_elements:settings.short_ended_elements,special:settings.special,text_block_elements:settings.text_block_elements,text_inline_elements:settings.text_inline_elements,valid_children:settings.valid_children,valid_classes:settings.valid_classes,valid_elements:settings.valid_elements,valid_styles:settings.valid_styles,verify_html:settings.verify_html,whitespace_elements:settings.whitespace_elements,padd_empty_block_inline_children:settings.format_empty_lines})},mkParserSettings=function(editor){var settings=editor.settings,blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:settings.allow_conditional_comments,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_html_in_named_anchor:settings.allow_html_in_named_anchor,allow_script_urls:settings.allow_script_urls,allow_unsafe_link_target:settings.allow_unsafe_link_target,convert_fonts_to_spans:settings.convert_fonts_to_spans,fix_list_elements:settings.fix_list_elements,font_size_legacy_values:settings.font_size_legacy_values,forced_root_block:settings.forced_root_block,forced_root_block_attrs:settings.forced_root_block_attrs,padd_empty_with_br:settings.padd_empty_with_br,preserve_cdata:settings.preserve_cdata,remove_trailing_brs:settings.remove_trailing_brs,inline_styles:settings.inline_styles,root_name:getRootName(editor),validate:!0,blob_cache:blobCache,document:editor.getDoc(),images_dataimg_filter:settings.images_dataimg_filter})},moveSelectionToFirstCaretPosition=function(editor){var root=editor.dom.getRoot();editor.inline||hasAnyRanges(editor)&&editor.selection.getStart(!0)!==root||firstPositionIn(root).each((function(pos){var node=pos.getNode(),caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;Env.browser.isIE()?function(editor,rng){var root=SugarElement.fromDom(editor.getBody()),newBookmark=(shouldStore(editor)?Optional.from(rng):Optional.none()).map(nativeRangeToSelectionRange).filter(isRngInRoot(root));editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark}(editor,caretPos.toRange()):editor.selection.setRng(caretPos.toRange())}))},initEditor=function(editor){editor.bindPendingEventDelegates(),editor.initialized=!0,function(editor){editor.fire("Init")}(editor),editor.focus(!0),moveSelectionToFirstCaretPosition(editor),editor.nodeChanged({initial:!0}),editor.execCallback("init_instance_callback",editor),function(editor){editor.settings.auto_focus&&Delay.setEditorTimeout(editor,(function(){var focusEditor;(focusEditor=!0===editor.settings.auto_focus?editor:editor.editorManager.get(editor.settings.auto_focus)).destroyed||focusEditor.focus()}),100)}(editor)},getStyleSheetLoader$1=function(editor){return editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader},loadContentCss=function(editor){var styleSheetLoader=getStyleSheetLoader$1(editor),fontCss=getFontCss(editor),css=editor.contentCSS,removeCss=function(){styleSheetLoader.unloadAll(css),editor.inline||editor.ui.styleSheetLoader.unloadAll(fontCss)},loaded=function(){editor.removed?removeCss():editor.on("remove",removeCss)};if(editor.contentStyles.length>0){var contentCssText_1="";Tools.each(editor.contentStyles,(function(style){contentCssText_1+=style+"\r\n"})),editor.dom.addStyle(contentCssText_1)}var allStylesheets=promiseObj.all(function(editor,css,framedFonts){var promises=[new promiseObj((function(resolve,reject){return getStyleSheetLoader$1(editor).loadAll(css,resolve,reject)}))];return editor.inline?promises:promises.concat([new promiseObj((function(resolve,reject){return editor.ui.styleSheetLoader.loadAll(framedFonts,resolve,reject)}))])}(editor,css,fontCss)).then(loaded).catch(loaded);return editor.settings.content_style&&function(editor,text){var body=SugarElement.fromDom(editor.getBody()),container=getStyleContainer(getRootNode(body)),style=SugarElement.fromTag("style");set$1(style,"type","text/css"),append$1(style,SugarElement.fromText(text)),append$1(container,style),editor.on("remove",(function(){remove$7(style)}))}(editor,editor.settings.content_style),allStylesheets},preInit=function(editor){var settings=editor.settings,doc=editor.getDoc(),body=editor.getBody();!function(editor){editor.fire("PreInit")}(editor),settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM$6.setAttrib(body,"spellcheck","false")),editor.quirks=Quirks(editor),function(editor){editor.fire("PostRender")}(editor);var directionality=function(editor){return editor.getParam("directionality",I18n.isRtl()?"rtl":void 0)}(editor);void 0!==directionality&&(body.dir=directionality),settings.protect&&editor.on("BeforeSetContent",(function(e){Tools.each(settings.protect,(function(pattern){e.content=e.content.replace(pattern,(function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"}))}))})),editor.on("SetContent",(function(){editor.addVisual(editor.getBody())})),editor.on("compositionstart compositionend",(function(e){editor.composing="compositionstart"===e.type}))},initEditorWithInitialContent=function(editor){!0!==editor.removed&&(!function(editor){isRtc(editor)||editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"})}(editor),initEditor(editor))},initContentBody=function(editor,skipWrite){var settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc();settings.inline||(editor.getElement().style.visibility=editor.orgVisibility),skipWrite||editor.inline||(doc.open(),doc.write(editor.iframeHTML),doc.close()),editor.inline&&(DOM$6.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=document,editor.contentWindow=window,editor.bodyElement=targetElm,editor.contentAreaContainer=targetElm);var body=editor.getBody();body.disabled=!0,editor.readonly=!!settings.readonly,editor.readonly||(editor.inline&&"static"===DOM$6.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable=editor.getParam("content_editable_state",!0)),body.disabled=!1,editor.editorUpload=EditorUpload(editor),editor.schema=Schema(mkSchemaSettings(editor)),editor.dom=DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:function(){return editor.inline},schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:function(e){editor.fire("SetAttrib",e)}}),editor.parser=function(editor){var parser=DomParser(mkParserSettings(editor),editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",(function(nodes,name){for(var node,value,i=nodes.length,dom=editor.dom,internalName="data-mce-"+name;i--;)if((value=(node=nodes[i]).attr(name))&&!node.attr(internalName)){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?((value=dom.serializeStyle(dom.parseStyle(value),node.name)).length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name))}})),parser.addNodeFilter("script",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i],type=node.attr("type")||"no/type";0!==type.indexOf("mce-")&&node.attr("type","mce-"+type)}})),editor.settings.preserve_cdata&&parser.addNodeFilter("#cdata",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];node.type=8,node.name="#comment",node.value="[CDATA["+editor.dom.encode(node.value)+"]]"}})),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",(function(nodes){for(var i=nodes.length,nonEmptyElements=editor.schema.getNonEmptyElements();i--;){var node=nodes[i];node.isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&(node.append(new AstNode("br",1)).shortEnded=!0)}})),parser}(editor),editor.serializer=DomSerializer(function(editor){var settings=editor.settings;return __assign(__assign(__assign({},mkParserSettings(editor)),mkSchemaSettings(editor)),removeUndefined({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope,element_format:settings.element_format,entities:settings.entities,entity_encoding:settings.entity_encoding,indent:settings.indent,indent_after:settings.indent_after,indent_before:settings.indent_before}))}(editor),editor),editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor),editor.annotator=Annotator(editor),editor.formatter=Formatter(editor),editor.undoManager=UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=SelectionOverrides(editor),setup$e(editor),setup$3(editor),isRtc(editor)||setup$2(editor);var caret=function(editor){return isRtc(editor)?Cell(null):registerKeyboardOverrides(editor)}(editor);setup$f(editor,caret),function(editor){getForcedRootBlock(editor)&&editor.on("NodeChange",curry(addRootBlocks,editor))}(editor),setup$g(editor);var setupRtcThunk=setup$i(editor);preInit(editor),setupRtcThunk.fold((function(){loadContentCss(editor).then((function(){return initEditorWithInitialContent(editor)}))}),(function(setupRtc){editor.setProgressState(!0),loadContentCss(editor).then((function(){setupRtc().then((function(_rtcMode){editor.setProgressState(!1),initEditorWithInitialContent(editor)}),(function(err){editor.notificationManager.open({type:"error",text:String(err)}),initEditorWithInitialContent(editor)}))}))}))},DOM$5=DOMUtils.DOM,getIframeHtml=function(editor){var iframeHTML=function(editor){return editor.getParam("doctype","<!DOCTYPE html>")}(editor)+"<html><head>";(function(editor){return editor.getParam("document_base_url","")})(editor)!==editor.documentBaseUrl&&(iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';var bodyId=function(editor){return getBodySetting(editor,"body_id","tinymce")}(editor),bodyClass=function(editor){return getBodySetting(editor,"body_class","")}(editor),translatedAriaText=editor.translate(function(editor){return editor.getParam("iframe_aria_text","Rich Text Area. Press ALT-0 for help.","string")}(editor));return getContentSecurityPolicy(editor)&&(iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+getContentSecurityPolicy(editor)+'" />'),iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'" aria-label="'+translatedAriaText+'"><br></body></html>'},createIframe=function(editor,o){var id,title,customAttrs,iframe,iframeTitle=editor.translate("Rich Text Area"),ifr=(id=editor.id,title=iframeTitle,o.height,customAttrs=function(editor){return editor.getParam("iframe_attrs",{})}(editor),iframe=SugarElement.fromTag("iframe"),setAll$1(iframe,customAttrs),setAll$1(iframe,{id:id+"_ifr",frameBorder:"0",allowTransparency:"true",title}),add$1(iframe,"tox-edit-area__iframe"),iframe).dom;ifr.onload=function(){ifr.onload=null,editor.fire("load")};var isDomainRelaxed=function(editor,ifr){if(document.domain!==window.location.hostname&&Env.browser.isIE()){var bodyUuid=uuid("mce");editor[bodyUuid]=function(){initContentBody(editor)};var domainRelaxUrl='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);document.close();ed.'+bodyUuid+"(true);})()";return DOM$5.setAttrib(ifr,"src",domainRelaxUrl),!0}return!1}(editor,ifr);return editor.contentAreaContainer=o.iframeContainer,editor.iframeElement=ifr,editor.iframeHTML=getIframeHtml(editor),DOM$5.add(o.iframeContainer,ifr),isDomainRelaxed},DOM$4=DOMUtils.DOM,initPlugin=function(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin),pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,"");if(plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)){if(Tools.each(PluginManager.dependencies(plugin),(function(dep){initPlugin(editor,initializedPlugins,dep)})),editor.plugins[plugin])return;try{var pluginInstance=new Plugin(editor,pluginUrl,editor.$);editor.plugins[plugin]=pluginInstance,pluginInstance.init&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}catch(e){!function(editor,name,err){var message=I18n.translate(["Failed to initialize plugin: {0}",name]);fireError(editor,"PluginLoadError",{message}),initError(message,err),displayError(editor,message)}(editor,plugin,e)}}},trimLegacyPrefix=function(name){return name.replace(/^\-/,"")},createThemeFalseResult=function(element){return{editorContainer:element,iframeContainer:element,api:{}}},renderThemeFalse=function(editor){var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):function(targetElement){var iframeContainer=DOM$4.create("div");return DOM$4.insertAfter(iframeContainer,targetElement),createThemeFalseResult(iframeContainer)}(targetElement)},renderThemeUi=function(editor){var elm=editor.getElement();return editor.orgDisplay=elm.style.display,isString$1(getTheme(editor))?function(editor){return editor.theme.renderUI()}(editor):isFunction(getTheme(editor))?function(editor){var elm=editor.getElement(),info=getTheme(editor)(editor,elm);return info.editorContainer.nodeType&&(info.editorContainer.id=info.editorContainer.id||editor.id+"_parent"),info.iframeContainer&&info.iframeContainer.nodeType&&(info.iframeContainer.id=info.iframeContainer.id||editor.id+"_iframecontainer"),info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight,info}(editor):renderThemeFalse(editor)},init=function(editor){editor.fire("ScriptsLoaded"),function(editor){var iconPackName=Tools.trim(getIconPackName(editor)),currentIcons=editor.ui.registry.getAll().icons,loadIcons=__assign(__assign({},IconManager.get("default").icons),IconManager.get(iconPackName).icons);each$j(loadIcons,(function(svgData,icon){has$2(currentIcons,icon)||editor.ui.registry.addIcon(icon,svgData)}))}(editor),function(editor){var theme=getTheme(editor);if(isString$1(theme)){editor.settings.theme=trimLegacyPrefix(theme);var Theme=ThemeManager.get(theme);editor.theme=new Theme(editor,ThemeManager.urls[theme]),editor.theme.init&&editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,""),editor.$)}else editor.theme={}}(editor),function(editor){var initializedPlugins=[];Tools.each(getPlugins(editor).split(/[ ,]/),(function(name){initPlugin(editor,initializedPlugins,trimLegacyPrefix(name))}))}(editor);var renderInfo=renderThemeUi(editor);!function(editor,api){var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),disable:Optional.from(api.disable).getOr(noop),isDisabled:Optional.from(api.isDisabled).getOr(never),enable:function(){editor.mode.isReadOnly()||Optional.from(api.enable).map(call)}};editor.ui=__assign(__assign({},editor.ui),uiApiFacade)}(editor,Optional.from(renderInfo.api).getOr({}));var boxInfo={editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer};return editor.editorContainer=boxInfo.editorContainer?boxInfo.editorContainer:null,appendContentCssFromSettings(editor),editor.inline?initContentBody(editor):function(editor,boxInfo){var isDomainRelaxed=createIframe(editor,boxInfo);boxInfo.editorContainer&&(DOM$5.get(boxInfo.editorContainer).style.display=editor.orgDisplay,editor.hidden=DOM$5.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM$5.setAttrib(editor.id,"aria-hidden","true"),isDomainRelaxed||initContentBody(editor)}(editor,boxInfo)},DOM$3=DOMUtils.DOM,hasSkipLoadPrefix=function(name){return"-"===name.charAt(0)},loadLanguage=function(scriptLoader,editor){var languageCode=getLanguageCode(editor),languageUrl=function(editor){return editor.getParam("language_url","","string")}(editor);if(!1===I18n.hasCode(languageCode)&&"en"!==languageCode){var url_1=""!==languageUrl?languageUrl:editor.editorManager.baseURL+"/langs/"+languageCode+".js";scriptLoader.add(url_1,noop,void 0,(function(){!function(editor,url,name){logError(editor,"LanguageLoadError",createLoadError("language",url,name))}(editor,url_1,languageCode)}))}},getIconsUrlMetaFromName=function(editor,name,suffix){return Optional.from(name).filter((function(name){return name.length>0&&!IconManager.has(name)})).map((function(name){return{url:editor.editorManager.baseURL+"/icons/"+name+"/icons"+suffix+".js",name:Optional.some(name)}}))},loadIcons=function(scriptLoader,editor,suffix){var defaultIconsUrl=getIconsUrlMetaFromName(editor,"default",suffix),customIconsUrl=function(editor){return Optional.from(function(editor){return editor.getParam("icons_url","","string")}(editor)).filter((function(url){return url.length>0})).map((function(url){return{url,name:Optional.none()}}))}(editor).orThunk((function(){return getIconsUrlMetaFromName(editor,getIconPackName(editor),"")}));each$k(function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r}([defaultIconsUrl,customIconsUrl]),(function(urlMeta){scriptLoader.add(urlMeta.url,noop,void 0,(function(){!function(editor,url,name){logError(editor,"IconsLoadError",createLoadError("icons",url,name))}(editor,urlMeta.url,urlMeta.name.getOrUndefined())}))}))},loadScripts=function(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;!function(scriptLoader,editor,suffix,callback){var theme=getTheme(editor);if(isString$1(theme)){if(!hasSkipLoadPrefix(theme)&&!has$2(ThemeManager.urls,theme)){var themeUrl=function(editor){return editor.getParam("theme_url")}(editor);themeUrl?ThemeManager.load(theme,editor.documentBaseURI.toAbsolute(themeUrl)):ThemeManager.load(theme,"themes/"+theme+"/theme"+suffix+".js")}scriptLoader.loadQueue((function(){ThemeManager.waitFor(theme,callback)}))}else callback()}(scriptLoader,editor,suffix,(function(){loadLanguage(scriptLoader,editor),loadIcons(scriptLoader,editor,suffix),function(editor,suffix){Tools.each(function(editor){return editor.getParam("external_plugins")}(editor),(function(url,name){PluginManager.load(name,url,noop,void 0,(function(){pluginLoadError(editor,url,name)})),editor.settings.plugins+=" "+name})),Tools.each(getPlugins(editor).split(/[ ,]/),(function(plugin){if((plugin=Tools.trim(plugin))&&!PluginManager.urls[plugin])if(hasSkipLoadPrefix(plugin)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,(function(depPlugin){var defaultSettings={prefix:"plugins/",resource:depPlugin,suffix:"/plugin"+suffix+".js"},dep=PluginManager.createUrl(defaultSettings,depPlugin);PluginManager.load(dep.resource,dep,noop,void 0,(function(){pluginLoadError(editor,dep.prefix+dep.resource+dep.suffix,dep.resource)}))}))}else{var url_2={prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"};PluginManager.load(plugin,url_2,noop,void 0,(function(){pluginLoadError(editor,url_2.prefix+url_2.resource+url_2.suffix,plugin)}))}}))}(editor,suffix),scriptLoader.loadQueue((function(){editor.removed||init(editor)}),editor,(function(){editor.removed||init(editor)}))}))},render=function(editor){var id=editor.id;I18n.setCode(getLanguageCode(editor));var readyHandler=function(){DOM$3.unbind(window,"ready",readyHandler),editor.render()};if(EventUtils.Event.domLoaded){if(editor.getElement()&&Env.contentEditable){var element=SugarElement.fromDom(editor.getElement()),snapshot=function(element){return foldl(element.dom.attributes,(function(acc,attr){return acc[attr.name]=attr.value,acc}),{})}(element);editor.on("remove",(function(){eachr(element.dom.attributes,(function(attr){return remove$6(element,attr.name)})),setAll$1(element,snapshot)})),editor.ui.styleSheetLoader=function(element,editor){return instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)})}(element,editor),!function(editor){return editor.getParam("inline")}(editor)?(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden"):editor.inline=!0;var form=editor.getElement().form||DOM$3.getParent(id,"form");form&&(editor.formElement=form,function(editor){return editor.getParam("hidden_input")}(editor)&&!isTextareaOrInput(editor.getElement())&&(DOM$3.insertAfter(DOM$3.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=function(e){editor.fire(e.type,e)},DOM$3.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",(function(){editor.resetContent()})),!function(editor){return editor.getParam("submit_patch")}(editor)||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)})),editor.windowManager=WindowManager(editor),editor.notificationManager=NotificationManager(editor),function(editor){return"xml"===editor.getParam("encoding")}(editor)&&editor.on("GetContent",(function(e){e.save&&(e.content=DOM$3.encode(e.content))})),function(editor){return editor.getParam("add_form_submit_trigger")}(editor)&&editor.on("submit",(function(){editor.initialized&&editor.save()})),function(editor){return editor.getParam("add_unload_trigger")}(editor)&&(editor._beforeUnload=function(){!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),loadScripts(editor,editor.suffix)}}else DOM$3.bind(window,"ready",readyHandler)},addVisual=function(editor,elm){return function(editor,elm){return getRtcInstanceWithError(editor).editor.addVisual(elm)}(editor,elm)},legacyPropNames={"font-size":"size","font-family":"face"},getSpecifiedFontProp=function(propName,rootElm,elm){return closest$1(SugarElement.fromDom(elm),(function(elm){return function(elm){return getRaw(elm,propName).orThunk((function(){return"font"===name(elm)?get$9(legacyPropNames,propName).bind((function(legacyPropName){return getOpt(elm,legacyPropName)})):Optional.none()}))}(elm)}),(function(elm){return eq(SugarElement.fromDom(rootElm),elm)}))},getFontProp=function(propName){return function(rootElm,elm){return Optional.from(elm).map(SugarElement.fromDom).filter(isElement$6).bind((function(element){return getSpecifiedFontProp(propName,rootElm,element.dom).or(function(propName,elm){return Optional.from(DOMUtils.DOM.getStyle(elm,propName,!0))}(propName,element.dom))})).getOr("")}},getFontSize=getFontProp("font-size"),getFontFamily=compose((function(fontFamily){return fontFamily.replace(/[\'\"\\]/g,"").replace(/,\s+/g,",")}),getFontProp("font-family")),findFirstCaretElement=function(editor){return firstPositionIn(editor.getBody()).map((function(caret){var container=caret.container();return isText$7(container)?container.parentNode:container}))},bindRange=function(editor,binder){return function(editor){return Optional.from(editor.selection.getRng()).bind((function(rng){var root=editor.getBody();return rng.startContainer===root&&0===rng.startOffset?Optional.none():Optional.from(editor.selection.getStart(!0))}))}(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$6).bind(binder)},mapRange=function(editor,mapper){return bindRange(editor,compose1(Optional.some,mapper))},fromFontSizeNumber=function(editor,value){if(/^[0-9.]+$/.test(value)){var fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){var fontSizes=function(editor){return Tools.explode(editor.getParam("font_size_style_values","xx-small,x-small,small,medium,large,x-large,xx-large"))}(editor),fontClasses=function(editor){return Tools.explode(editor.getParam("font_size_classes",""))}(editor);return fontClasses?fontClasses[fontSizeNumber-1]||value:fontSizes[fontSizeNumber-1]||value}return value}return value},normalizeFontNames=function(font){var fonts=font.split(/\s*,\s*/);return map$3(fonts,(function(font){return-1===font.indexOf(" ")||startsWith(font,'"')||startsWith(font,"'")?font:"'"+font+"'"})).join(",")},insertAtCaret=function(editor,value){var result=function(value){if("string"!=typeof value){var details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details}}return{content:value,details:{}}}(value);!function(editor,value,details){getRtcInstanceWithFallback(editor).editor.insertContent(value,details)}(editor,result.content,result.details)},each$4=Tools.each,map=Tools.map,inArray=Tools.inArray,EditorCommands=function(){function EditorCommands(editor){this.commands={state:{},exec:{},value:{}},this.editor=editor,this.setupCommands(editor)}return EditorCommands.prototype.execCommand=function(command,ui,value,args){var func,state=!1,self=this;if(!self.editor.removed){var editor;if("mcefocus"!==command.toLowerCase()&&(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus?(editor=self.editor,getRng(editor).each((function(rng){return editor.selection.setRng(rng)}))):self.editor.focus()),(args=self.editor.fire("BeforeExecCommand",{command,ui,value})).isDefaultPrevented())return!1;var customCommand=command.toLowerCase();if(func=self.commands.exec[customCommand])return func(customCommand,ui,value),self.editor.fire("ExecCommand",{command,ui,value}),!0;if(each$4(this.editor.plugins,(function(p){if(p.execCommand&&p.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command,ui,value}),state=!0,!1})),state)return state;if(self.editor.theme&&self.editor.theme.execCommand&&self.editor.theme.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command,ui,value}),!0;try{state=self.editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(self.editor.fire("ExecCommand",{command,ui,value}),!0)}},EditorCommands.prototype.queryCommandState=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.state[command])return func(command);try{return this.editor.getDoc().queryCommandState(command)}catch(ex){}return!1}},EditorCommands.prototype.queryCommandValue=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.value[command])return func(command);try{return this.editor.getDoc().queryCommandValue(command)}catch(ex){}}},EditorCommands.prototype.addCommands=function(commandList,type){void 0===type&&(type="exec");var self=this;each$4(commandList,(function(callback,command){each$4(command.toLowerCase().split(","),(function(command){self.commands[type][command]=callback}))}))},EditorCommands.prototype.addCommand=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.exec[command]=function(command,ui,value,args){return callback.call(scope||_this.editor,ui,value,args)}},EditorCommands.prototype.queryCommandSupported=function(command){if(command=command.toLowerCase(),this.commands.exec[command])return!0;try{return this.editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1},EditorCommands.prototype.addQueryStateHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.state[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.addQueryValueHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.value[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.hasCustomCommand=function(command){return command=command.toLowerCase(),!!this.commands.exec[command]},EditorCommands.prototype.execNativeCommand=function(command,ui,value){return void 0===ui&&(ui=!1),void 0===value&&(value=null),this.editor.getDoc().execCommand(command,ui,value)},EditorCommands.prototype.isFormatMatch=function(name){return this.editor.formatter.match(name)},EditorCommands.prototype.toggleFormat=function(name,value){this.editor.formatter.toggle(name,value),this.editor.nodeChanged()},EditorCommands.prototype.storeSelection=function(type){this.selectionBookmark=this.editor.selection.getBookmark(type)},EditorCommands.prototype.restoreSelection=function(){this.editor.selection.moveToBookmark(this.selectionBookmark)},EditorCommands.prototype.setupCommands=function(editor){var self=this;this.addCommands({"mceResetDesignMode,mceBeginUndoLevel":noop,"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},mceFocus:function(_command,_ui,value){focus(editor,value)},"Cut,Copy,Paste":function(command){var failed,doc=editor.getDoc();try{self.execNativeCommand(command)}catch(ex){failed=!0}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");Env.mac&&(msg=msg.replace(/Ctrl\+/g,"+")),editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(editor.selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),"a");elm&&editor.dom.remove(elm,!0)}else editor.formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"===align&&(align="justify"),each$4("left,center,right,justify".split(","),(function(name){align!==name&&editor.formatter.remove("align"+name)})),"none"!==align&&self.toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){var listParent;self.execNativeCommand(command);var listElm=editor.dom.getParent(editor.selection.getNode(),"ol,ul");listElm&&(listParent=listElm.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(self.storeSelection(),editor.dom.split(listParent,listElm),self.restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){self.toggleFormat(command)},"ForeColor,HiliteColor":function(command,ui,value){self.toggleFormat(command,{value})},FontName:function(command,ui,value){!function(editor,value){var font=fromFontSizeNumber(editor,value);editor.formatter.toggle("fontname",{value:normalizeFontNames(font)}),editor.nodeChanged()}(editor,value)},FontSize:function(command,ui,value){!function(editor,value){editor.formatter.toggle("fontsize",{value:fromFontSizeNumber(editor,value)}),editor.nodeChanged()}(editor,value)},LineHeight:function(command,ui,value){!function(editor,lineHeight){editor.formatter.toggle("lineheight",{value:String(lineHeight)}),editor.nodeChanged()}(editor,value)},Lang:function(command,ui,lang){self.toggleFormat(command,{value:lang.code,customValue:lang.customCode})},RemoveFormat:function(command){editor.formatter.remove(command)},mceBlockQuote:function(){self.toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return self.toggleFormat(value||"p")},mceCleanup:function(){var bookmark=editor.selection.getBookmark();editor.setContent(editor.getContent()),editor.selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||editor.selection.getNode();node!==editor.getBody()&&(self.storeSelection(),editor.dom.remove(node,!0),self.restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;editor.dom.getParent(editor.selection.getNode(),(function(node){if(1===node.nodeType&&counter++===value)return editor.selection.select(node),!1}),editor.getBody())},mceSelectNode:function(command,ui,value){editor.selection.select(value)},mceInsertContent:function(command,ui,value){insertAtCaret(editor,value)},mceInsertRawHTML:function(command,ui,value){editor.selection.setContent("tiny_mce_marker");var content=editor.getContent();editor.setContent(content.replace(/tiny_mce_marker/g,(function(){return value})))},mceInsertNewLine:function(command,ui,value){insert(editor,value)},mceToggleFormat:function(command,ui,value){self.toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){handle(editor,command)},mceRepaint:noop,InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,editor.selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){"string"==typeof value&&(value={href:value});var anchor=editor.dom.getParent(editor.selection.getNode(),"a");value.href=value.href.replace(/ /g,"%20"),anchor&&value.href||editor.formatter.remove("link"),value.href&&editor.formatter.apply("link",value,anchor)},selectAll:function(){var editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$4);if(editingHost){var rng=editor.dom.createRng();rng.selectNodeContents(editingHost),editor.selection.setRng(rng)}},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){return insert$1(editor,value),!0}});var alignStates=function(name){return function(){var selection=editor.selection,nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks(),matches=map(nodes,(function(node){return!!editor.formatter.matchNode(node,name)}));return-1!==inArray(matches,!0)}};self.addCommands({JustifyLeft:alignStates("alignleft"),JustifyCenter:alignStates("aligncenter"),JustifyRight:alignStates("alignright"),JustifyFull:alignStates("alignjustify"),"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return self.isFormatMatch(command)},mceBlockQuote:function(){return self.isFormatMatch("blockquote")},Outdent:function(){return canOutdent(editor)},"InsertUnorderedList,InsertOrderedList":function(command){var list=editor.dom.getParent(editor.selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),self.addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}}),self.addQueryValueHandler("FontName",(function(){return function(editor){return mapRange(editor,(function(elm){return getFontFamily(editor.getBody(),elm.dom)})).getOr("")}(editor)}),this),self.addQueryValueHandler("FontSize",(function(){return function(editor){return mapRange(editor,(function(elm){return getFontSize(editor.getBody(),elm.dom)})).getOr("")}(editor)}),this),self.addQueryValueHandler("LineHeight",(function(){return function(editor){return mapRange(editor,(function(elm){var root=SugarElement.fromDom(editor.getBody()),specifiedStyle=closest$1(elm,(function(elm){return getRaw(elm,"line-height")}),curry(eq,root));return specifiedStyle.getOrThunk((function(){var lineHeight=parseFloat(get$5(elm,"line-height")),fontSize=parseFloat(get$5(elm,"font-size"));return String(lineHeight/fontSize)}))})).getOr("")}(editor)}),this)},EditorCommands}(),toggleClass=function(elm,cls,state){var element,clazz;has(elm,cls)&&!1===state?(clazz=cls,supports(element=elm)?element.dom.classList.remove(clazz):remove$4(element,clazz),cleanClass(element)):state&&add$1(elm,cls)},setEditorCommandState=function(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,String(state))}catch(ex){}},setContentEditable=function(elm,state){elm.dom.contentEditable=state?"true":"false"},toggleReadOnly=function(editor,state){var body=SugarElement.fromDom(editor.getBody());toggleClass(body,"mce-content-readonly",state),state?(editor.selection.controlSelection.hideResizeRect(),editor._selectionOverrides.hideFakeCaret(),function(editor){Optional.from(editor.selection.getNode()).each((function(elm){elm.removeAttribute("data-mce-selected")}))}(editor),editor.readonly=!0,setContentEditable(body,!1),each$k(descendants(body,'*[contenteditable="true"]'),(function(elm){set$1(elm,"data-mce-contenteditable","true"),setContentEditable(elm,!1)}))):(editor.readonly=!1,setContentEditable(body,!0),function(elm){each$k(descendants(elm,'*[data-mce-contenteditable="true"]'),(function(elm){remove$6(elm,"data-mce-contenteditable"),setContentEditable(elm,!0)}))}(body),setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),hasEditorOrUiFocus(editor)&&editor.focus(),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.nodeChanged())},isReadOnly=function(editor){return editor.readonly},registerFilters=function(editor){editor.parser.addAttributeFilter("contenteditable",(function(nodes){isReadOnly(editor)&&each$k(nodes,(function(node){node.attr("data-mce-contenteditable",node.attr("contenteditable")),node.attr("contenteditable","false")}))})),editor.serializer.addAttributeFilter("data-mce-contenteditable",(function(nodes){isReadOnly(editor)&&each$k(nodes,(function(node){node.attr("contenteditable",node.attr("data-mce-contenteditable"))}))})),editor.serializer.addTempAttr("data-mce-contenteditable")},processReadonlyEvents=function(editor,e){if(function(e){return"click"===e.type}(e)&&!VK.metaKeyPressed(e)){var elm=SugarElement.fromDom(e.target);(function(editor,elm){return closest$2(elm,"a",(function(elm){return eq(elm,SugarElement.fromDom(editor.getBody()))})).bind((function(a){return getOpt(a,"href")}))})(editor,elm).each((function(href){if(e.preventDefault(),/^#/.test(href)){var targetEl=editor.dom.select(href+',[name="'+((startsWith(str=href,prefix="#")?function(str,numChars){return str.substring(numChars)}(str,prefix.length):str)+'"]'));targetEl.length&&editor.selection.scrollIntoView(targetEl[0],!0)}else window.open(href,"_blank","rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes");var str,prefix}))}},nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel"," "),EventDispatcher=function(){function EventDispatcher(settings){this.bindings={},this.settings=settings||{},this.scope=this.settings.scope||this,this.toggleEvent=this.settings.toggleEvent||never}return EventDispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},EventDispatcher.prototype.fire=function(name,args){var lcName=name.toLowerCase(),event=normalize$3(lcName,args||{},this.scope);this.settings.beforeFire&&this.settings.beforeFire(event);var handlers=this.bindings[lcName];if(handlers)for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(!callback.removed){if(callback.once&&this.off(lcName,callback.func),event.isImmediatePropagationStopped())return event;if(!1===callback.func.call(this.scope,event))return event.preventDefault(),event}}return event},EventDispatcher.prototype.on=function(name,callback,prepend,extra){if(!1===callback&&(callback=never),callback){var wrappedCallback={func:callback,removed:!1};extra&&Tools.extend(wrappedCallback,extra);for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];handlers||(handlers=[],this.toggleEvent(currentName,!0)),handlers=prepend?__spreadArray([wrappedCallback],handlers,!0):__spreadArray(__spreadArray([],handlers,!0),[wrappedCallback],!1),this.bindings[currentName]=handlers}}return this},EventDispatcher.prototype.off=function(name,callback){var _this=this;if(name)for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];if(!currentName)return each$j(this.bindings,(function(_value,bindingName){_this.toggleEvent(bindingName,!1),delete _this.bindings[bindingName]})),this;if(handlers){if(callback){var filteredHandlers=partition(handlers,(function(handler){return handler.func===callback}));handlers=filteredHandlers.fail,this.bindings[currentName]=handlers,each$k(filteredHandlers.pass,(function(handler){handler.removed=!0}))}else handlers.length=0;handlers.length||(this.toggleEvent(name,!1),delete this.bindings[currentName])}}else each$j(this.bindings,(function(_value,name){_this.toggleEvent(name,!1)})),this.bindings={};return this},EventDispatcher.prototype.once=function(name,callback,prepend){return this.on(name,callback,prepend,{once:!0})},EventDispatcher.prototype.has=function(name){return name=name.toLowerCase(),!(!this.bindings[name]||0===this.bindings[name].length)},EventDispatcher}(),getEventDispatcher=function(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher},Observable={fire:function(name,args,bubble){if(this.removed&&"remove"!==name&&"detach"!==name)return args;var dispatcherArgs=getEventDispatcher(this).fire(name,args);if(!1!==bubble&&this.parent)for(var parent_1=this.parent();parent_1&&!dispatcherArgs.isPropagationStopped();)parent_1.fire(name,dispatcherArgs,!1),parent_1=parent_1.parent();return dispatcherArgs},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}},DOM$2=DOMUtils.DOM,getEventTarget=function(editor,eventName){if("selectionchange"===eventName)return editor.getDoc();if(!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName))return editor.getDoc().documentElement;var eventRoot=getEventRoot(editor);return eventRoot?(editor.eventRoot||(editor.eventRoot=DOM$2.select(eventRoot)[0]),editor.eventRoot):editor.getBody()},fireEvent=function(editor,eventName,e){!function(editor){return!editor.hidden&&!isReadOnly(editor)}(editor)?isReadOnly(editor)&&processReadonlyEvents(editor,e):editor.fire(eventName,e)},bindEventDelegate=function(editor,eventName){var delegate;if(editor.delegates||(editor.delegates={}),!editor.delegates[eventName]&&!editor.removed){var eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",(function(){editor.editorManager.activeEditor||customEventRootDelegates&&(each$j(customEventRootDelegates,(function(_value,name){editor.dom.unbind(getEventTarget(editor,name))})),customEventRootDelegates=null)}))),customEventRootDelegates[eventName])return;delegate=function(e){for(var target=e.target,editors=editor.editorManager.get(),i=editors.length;i--;){var body=editors[i].getBody();(body===target||DOM$2.isChildOf(target,body))&&fireEvent(editors[i],eventName,e)}},customEventRootDelegates[eventName]=delegate,DOM$2.bind(eventRootElm,eventName,delegate)}else delegate=function(e){fireEvent(editor,eventName,e)},DOM$2.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}},EditorObservable=__assign(__assign({},Observable),{bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,(function(name){bindEventDelegate(self,name)}))},toggleNativeEvent:function(name,state){"focus"!==name&&"blur"!==name&&(this.removed||(state?this.initialized?bindEventDelegate(this,name):this._pendingNativeEvents?this._pendingNativeEvents.push(name):this._pendingNativeEvents=[name]:this.initialized&&(this.dom.unbind(getEventTarget(this,name),name,this.delegates[name]),delete this.delegates[name])))},unbindAllNativeEvents:function(){var self=this,body=self.getBody(),dom=self.dom;self.delegates&&(each$j(self.delegates,(function(value,name){self.dom.unbind(getEventTarget(self,name),name,value)})),delete self.delegates),!self.inline&&body&&dom&&(body.onload=null,dom.unbind(self.getWin()),dom.unbind(self.getDoc())),dom&&(dom.unbind(body),dom.unbind(self.getContainer()))}}),defaultModes=["design","readonly"],switchToMode=function(editor,activeMode,availableModes,mode){var oldMode=availableModes[activeMode.get()],newMode=availableModes[mode];try{newMode.activate()}catch(e){return void console.error("problem while activating editor mode "+mode+":",e)}oldMode.deactivate(),oldMode.editorReadOnly!==newMode.editorReadOnly&&toggleReadOnly(editor,newMode.editorReadOnly),activeMode.set(mode),function(editor,mode){editor.fire("SwitchMode",{mode})}(editor,mode)},create$4=function(editor){var activeMode=Cell("design"),availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:!1},readonly:{activate:noop,deactivate:noop,editorReadOnly:!0}});return function(editor){editor.serializer?registerFilters(editor):editor.on("PreInit",(function(){registerFilters(editor)}))}(editor),function(editor){editor.on("ShowCaret",(function(e){isReadOnly(editor)&&e.preventDefault()})),editor.on("ObjectSelected",(function(e){isReadOnly(editor)&&e.preventDefault()}))}(editor),{isReadOnly:function(){return isReadOnly(editor)},set:function(mode){return function(editor,availableModes,activeMode,mode){if(mode!==activeMode.get()){if(!has$2(availableModes,mode))throw new Error("Editor mode '"+mode+"' is invalid");editor.initialized?switchToMode(editor,activeMode,availableModes,mode):editor.on("init",(function(){return switchToMode(editor,activeMode,availableModes,mode)}))}}(editor,availableModes.get(),activeMode,mode)},get:function(){return activeMode.get()},register:function(mode,api){availableModes.set(function(availableModes,mode,api){var _a;if(contains$3(defaultModes,mode))throw new Error("Cannot override default mode "+mode);return __assign(__assign({},availableModes),((_a={})[mode]=__assign(__assign({},api),{deactivate:function(){try{api.deactivate()}catch(e){console.error("problem while deactivating editor mode "+mode+":",e)}}}),_a))}(availableModes.get(),mode,api))}}},each$3=Tools.each,explode$1=Tools.explode,keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access"),parseShortcut=function(pattern){var key,shortcut={};each$3(explode$1(pattern.toLowerCase(),"+"),(function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}));var id=[shortcut.keyCode];for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut},Shortcuts=function(){function Shortcuts(editor){this.shortcuts={},this.pendingPatterns=[],this.editor=editor;var self=this;editor.on("keyup keypress keydown",(function(e){!self.hasModifier(e)&&!self.isFunctionKey(e)||e.isDefaultPrevented()||(each$3(self.shortcuts,(function(shortcut){if(self.matchShortcut(e,shortcut))return self.pendingPatterns=shortcut.subpatterns.slice(0),"keydown"===e.type&&self.executeShortcutAction(shortcut),!0})),self.matchShortcut(e,self.pendingPatterns[0])&&(1===self.pendingPatterns.length&&"keydown"===e.type&&self.executeShortcutAction(self.pendingPatterns[0]),self.pendingPatterns.shift()))}))}return Shortcuts.prototype.add=function(pattern,desc,cmdFunc,scope){var self=this,func=self.normalizeCommandFunc(cmdFunc);return each$3(explode$1(Tools.trim(pattern)),(function(pattern){var shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut})),!0},Shortcuts.prototype.remove=function(pattern){var shortcut=this.createShortcut(pattern);return!!this.shortcuts[shortcut.id]&&(delete this.shortcuts[shortcut.id],!0)},Shortcuts.prototype.normalizeCommandFunc=function(cmdFunc){var self=this,cmd=cmdFunc;return"string"==typeof cmd?function(){self.editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)?function(){self.editor.execCommand(cmd[0],cmd[1],cmd[2])}:cmd},Shortcuts.prototype.createShortcut=function(pattern,desc,cmdFunc,scope){var shortcuts=Tools.map(explode$1(pattern,">"),parseShortcut);return shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor}),Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)})},Shortcuts.prototype.hasModifier=function(e){return e.altKey||e.ctrlKey||e.metaKey},Shortcuts.prototype.isFunctionKey=function(e){return"keydown"===e.type&&e.keyCode>=112&&e.keyCode<=123},Shortcuts.prototype.matchShortcut=function(e,shortcut){return!!shortcut&&(shortcut.ctrl===e.ctrlKey&&shortcut.meta===e.metaKey&&(shortcut.alt===e.altKey&&shortcut.shift===e.shiftKey&&(!!(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode)&&(e.preventDefault(),!0))))},Shortcuts.prototype.executeShortcutAction=function(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null},Shortcuts}(),registry=function(){var bridge=function(){var buttons={},menuItems={},popups={},icons={},contextMenus={},contextToolbars={},sidebars={},add=function(collection,type){return function(name,spec){return collection[name.toLowerCase()]=__assign(__assign({},spec),{type})}};return{addButton:add(buttons,"button"),addGroupToolbarButton:add(buttons,"grouptoolbarbutton"),addToggleButton:add(buttons,"togglebutton"),addMenuButton:add(buttons,"menubutton"),addSplitButton:add(buttons,"splitbutton"),addMenuItem:add(menuItems,"menuitem"),addNestedMenuItem:add(menuItems,"nestedmenuitem"),addToggleMenuItem:add(menuItems,"togglemenuitem"),addAutocompleter:add(popups,"autocompleter"),addContextMenu:add(contextMenus,"contextmenu"),addContextToolbar:add(contextToolbars,"contexttoolbar"),addContextForm:add(contextToolbars,"contextform"),addSidebar:add(sidebars,"sidebar"),addIcon:function(name,svgData){return icons[name.toLowerCase()]=svgData},getAll:function(){return{buttons,menuItems,icons,popups,contextMenus,contextToolbars,sidebars}}}}();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,getAll:bridge.getAll}},DOM$1=DOMUtils.DOM,extend$3=Tools.extend,each$2=Tools.each,resolve=Tools.resolve,ie=Env.ie,Editor=function(){function Editor(id,settings,editorManager){var _this=this;this.plugins={},this.contentCSS=[],this.contentStyles=[],this.loadedCSS={},this.isNotDirty=!1,this.editorManager=editorManager,this.documentBaseUrl=editorManager.documentBaseURL,extend$3(this,EditorObservable),this.settings=getEditorSettings(this,id,this.documentBaseUrl,editorManager.defaultSettings,settings),this.settings.suffix&&(editorManager.suffix=this.settings.suffix),this.suffix=editorManager.suffix,this.settings.base_url&&editorManager._setBaseUrl(this.settings.base_url),this.baseUri=editorManager.baseURI,this.settings.referrer_policy&&(ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy),DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy)),AddOnManager.languageLoad=this.settings.language_load,AddOnManager.baseURL=editorManager.baseURL,this.id=id,this.setDirty(!1),this.documentBaseURI=new URI(this.settings.document_base_url,{base_uri:this.baseUri}),this.baseURI=this.baseUri,this.inline=!!this.settings.inline,this.shortcuts=new Shortcuts(this),this.editorCommands=new EditorCommands(this),this.settings.cache_suffix&&(Env.cacheSuffix=this.settings.cache_suffix.replace(/^[\?\&]+/,"")),this.ui={registry:registry(),styleSheetLoader:void 0,show:noop,hide:noop,enable:noop,disable:noop,isDisabled:never};var modeInstance=create$4(this);this.mode=modeInstance,this.setMode=modeInstance.set,editorManager.fire("SetupEditor",{editor:this}),this.execCallback("setup",this),this.$=DomQuery.overrideDefaults((function(){return{context:_this.inline?_this.getBody():_this.getDoc(),element:_this.getBody()}}))}return Editor.prototype.render=function(){render(this)},Editor.prototype.focus=function(skipFocus){this.execCommand("mceFocus",!1,skipFocus)},Editor.prototype.hasFocus=function(){return hasFocus(this)},Editor.prototype.execCallback=function(name){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var scope,self=this,callback=self.settings[name];if(callback)return self.callbackLookup&&(scope=self.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=(scope=callback.replace(/\.\w+$/,""))?resolve(scope):0,callback=resolve(callback),self.callbackLookup=self.callbackLookup||{},self.callbackLookup[name]={func:callback,scope}),callback.apply(scope||self,x)},Editor.prototype.translate=function(text){return I18n.translate(text)},Editor.prototype.getParam=function(name,defaultVal,type){return getParam(this,name,defaultVal,type)},Editor.prototype.hasPlugin=function(name,loaded){return!!contains$3(getPlugins(this).split(/[ ,]/),name)&&(!loaded||void 0!==PluginManager.get(name))},Editor.prototype.nodeChanged=function(args){this._nodeChangeDispatcher.nodeChanged(args)},Editor.prototype.addCommand=function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},Editor.prototype.addQueryStateHandler=function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},Editor.prototype.addQueryValueHandler=function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},Editor.prototype.addShortcut=function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},Editor.prototype.execCommand=function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},Editor.prototype.queryCommandState=function(cmd){return this.editorCommands.queryCommandState(cmd)},Editor.prototype.queryCommandValue=function(cmd){return this.editorCommands.queryCommandValue(cmd)},Editor.prototype.queryCommandSupported=function(cmd){return this.editorCommands.queryCommandSupported(cmd)},Editor.prototype.show=function(){this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable="true":(DOM$1.show(this.getContainer()),DOM$1.hide(this.id)),this.load(),this.fire("show"))},Editor.prototype.hide=function(){var doc=this.getDoc();this.hidden||(ie&&doc&&!this.inline&&doc.execCommand("SelectAll"),this.save(),this.inline?(this.getBody().contentEditable="false",this===this.editorManager.focusedEditor&&(this.editorManager.focusedEditor=null)):(DOM$1.hide(this.getContainer()),DOM$1.setStyle(this.id,"display",this.orgDisplay)),this.hidden=!0,this.fire("hide"))},Editor.prototype.isHidden=function(){return!!this.hidden},Editor.prototype.setProgressState=function(state,time){this.fire("ProgressState",{state,time})},Editor.prototype.load=function(args){var html,elm=this.getElement();if(this.removed)return"";if(elm){(args=args||{}).load=!0;var value=isTextareaOrInput(elm)?elm.value:elm.innerHTML;return html=this.setContent(value,args),args.element=elm,args.no_events||this.fire("LoadContent",args),args.element=elm=null,html}},Editor.prototype.save=function(args){var html,form,self=this,elm=self.getElement();if(elm&&self.initialized&&!self.removed)return(args=args||{}).save=!0,args.element=elm,args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"===args.format&&self.fire("RawSaveContent",args),html=args.content,isTextareaOrInput(elm)?elm.value=html:(!args.is_removing&&self.inline||(elm.innerHTML=html),(form=DOM$1.getParent(self.id,"form"))&&each$2(form.elements,(function(elm){if(elm.name===self.id)return elm.value=html,!1}))),args.element=elm=null,!1!==args.set_dirty&&self.setDirty(!1),html},Editor.prototype.setContent=function(content,args){return setContent(this,content,args)},Editor.prototype.getContent=function(args){return getContent(this,args)},Editor.prototype.insertContent=function(content,args){args&&(content=extend$3({content},args)),this.execCommand("mceInsertContent",!1,content)},Editor.prototype.resetContent=function(initialContent){void 0===initialContent?setContent(this,this.startContent,{format:"raw"}):setContent(this,initialContent),this.undoManager.reset(),this.setDirty(!1),this.nodeChanged()},Editor.prototype.isDirty=function(){return!this.isNotDirty},Editor.prototype.setDirty=function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!==oldState&&this.fire("dirty")},Editor.prototype.getContainer=function(){return this.container||(this.container=DOM$1.get(this.editorContainer||this.id+"_parent")),this.container},Editor.prototype.getContentAreaContainer=function(){return this.contentAreaContainer},Editor.prototype.getElement=function(){return this.targetElm||(this.targetElm=DOM$1.get(this.id)),this.targetElm},Editor.prototype.getWin=function(){var elm;return this.contentWindow||(elm=this.iframeElement)&&(this.contentWindow=elm.contentWindow),this.contentWindow},Editor.prototype.getDoc=function(){var win;return this.contentDocument||(win=this.getWin())&&(this.contentDocument=win.document),this.contentDocument},Editor.prototype.getBody=function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null)},Editor.prototype.convertURL=function(url,name,elm){var settings=this.settings;return settings.urlconverter_callback?this.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"===elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?this.documentBaseURI.toRelative(url):url=this.documentBaseURI.toAbsolute(url,settings.remove_script_host)},Editor.prototype.addVisual=function(elm){addVisual(this,elm)},Editor.prototype.remove=function(){remove(this)},Editor.prototype.destroy=function(automatic){destroy(this,automatic)},Editor.prototype.uploadImages=function(callback){return this.editorUpload.uploadImages(callback)},Editor.prototype._scanForImages=function(){return this.editorUpload.scanForImages()},Editor.prototype.addButton=function(){throw new Error("editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead")},Editor.prototype.addSidebar=function(){throw new Error("editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead")},Editor.prototype.addMenuItem=function(){throw new Error("editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead")},Editor.prototype.addContextToolbar=function(){throw new Error("editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead")},Editor}(),DOM=DOMUtils.DOM,explode=Tools.explode,each$1=Tools.each,extend$2=Tools.extend,instanceCounter=0,boundGlobalEvents=!1,legacyEditors=[],editors=[],globalEventDelegate=function(e){var type=e.type;each$1(EditorManager.get(),(function(editor){switch(type){case"scroll":editor.fire("ScrollWindow",e);break;case"resize":editor.fire("ResizeWindow",e)}}))},toggleGlobalEvents=function(state){state!==boundGlobalEvents&&(state?DomQuery(window).on("resize scroll",globalEventDelegate):DomQuery(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)},removeEditorFromList=function(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++)if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break}return editors=filter$4(editors,(function(editor){return targetEditor!==editor})),EditorManager.activeEditor===targetEditor&&(EditorManager.activeEditor=editors.length>0?editors[0]:null),EditorManager.focusedEditor===targetEditor&&(EditorManager.focusedEditor=null),oldEditors.length!==editors.length},isQuirksMode="CSS1Compat"!==document.compatMode,EditorManager=__assign(__assign({},Observable),{baseURI:null,baseURL:null,defaultSettings:{},documentBaseURL:null,suffix:null,$:DomQuery,majorVersion:"5",minorVersion:"10.5",releaseDate:"2022-05-25",editors:legacyEditors,i18n:I18n,activeEditor:null,focusedEditor:null,settings:{},setup:function(){var baseURL,documentBaseURL,suffix="";documentBaseURL=URI.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/"));var editorManager,preInit=window.tinymce||window.tinyMCEPreInit;if(preInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++){var src;if(""!==(src=scripts[i].src||"")){var srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!==srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}}if(!baseURL&&document.currentScript)-1!==(src=document.currentScript.src).indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"))}this.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),this.documentBaseURL=documentBaseURL,this.baseURI=new URI(this.baseURL),this.suffix=suffix,(editorManager=this).on("AddEditor",curry(registerEvents$1,editorManager)),editorManager.on("RemoveEditor",curry(unregisterDocumentEvents,editorManager))},overrideDefaults:function(defaultSettings){var baseUrl=defaultSettings.base_url;baseUrl&&this._setBaseUrl(baseUrl);var suffix=defaultSettings.suffix;defaultSettings.suffix&&(this.suffix=suffix),this.defaultSettings=defaultSettings;var pluginBaseUrls=defaultSettings.plugin_base_urls;void 0!==pluginBaseUrls&&each$j(pluginBaseUrls,(function(pluginBaseUrl,pluginName){AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl}))},init:function(settings){var result,self=this,invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu"," "),createId=function(elm){var id=elm.id;return id||(id=get$9(elm,"name").filter((function(name){return!DOM.get(name)})).getOrThunk(DOM.uniqueId),elm.setAttribute("id",id)),id},hasClass=function(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)},provideResults=function(editors){result=editors},initEditors=function(){var targets,initCount=0,editors=[],createEditor=function(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor),editor.on("init",(function(){++initCount===targets.length&&provideResults(editors)})),editor.targetElm=editor.targetElm||targetElm,editor.render()};DOM.unbind(window,"ready",initEditors),function(name){var callback=settings[name];if(callback)callback.apply(self,[])}("onpageload"),targets=DomQuery.unique(function(settings){var targets=[];if(Env.browser.isIE()&&Env.browser.version.major<11)return initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(isQuirksMode)return initError("Failed to initialize the editor as the document is not in standards mode. TinyMCE requires standards mode."),[];if(settings.types)return each$1(settings.types,(function(type){targets=targets.concat(DOM.select(type.selector))})),targets;if(settings.selector)return DOM.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":var l=settings.elements||"";l.length>0&&each$1(explode(l),(function(id){var elm=DOM.get(id);elm?targets.push(elm):each$1(document.forms,(function(f){each$1(f.elements,(function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM.setAttrib(e,"id",id),targets.push(e))}))}))}));break;case"textareas":case"specific_textareas":each$1(DOM.select("textarea"),(function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)}))}return targets}(settings)),settings.types?each$1(settings.types,(function(type){Tools.each(targets,(function(elm){return!DOM.is(elm,type.selector)||(createEditor(createId(elm),extend$2({},settings,type),elm),!1)}))})):(Tools.each(targets,(function(elm){var editor;(editor=self.get(elm.id))&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0,editor=null)})),0===(targets=Tools.grep(targets,(function(elm){return!self.get(elm.id)}))).length?provideResults([]):each$1(targets,(function(elm){!function(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets}(settings,elm)?createEditor(createId(elm),settings,elm):initError("Could not initialize inline editor on invalid inline target element",elm)})))};return self.settings=settings,DOM.bind(window,"ready",initEditors),new promiseObj((function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}}))},get:function(id){return 0===arguments.length?editors.slice(0):isString$1(id)?find$3(editors,(function(editor){return editor.id===id})).getOr(null):isNumber(id)&&editors[id]?editors[id]:null},add:function(editor){var self=this;return legacyEditors[editor.id]===editor||(null===self.get(editor.id)&&("length"!==editor.id&&(legacyEditors[editor.id]=editor),legacyEditors.push(editor),editors.push(editor)),toggleGlobalEvents(!0),self.activeEditor=editor,self.fire("AddEditor",{editor}),beforeUnloadDelegate||(beforeUnloadDelegate=function(e){var event=self.fire("BeforeUnload");if(event.returnValue)return e.preventDefault(),e.returnValue=event.returnValue,event.returnValue},window.addEventListener("beforeunload",beforeUnloadDelegate))),editor},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var i,editor,self=this;if(selector){if(!isString$1(selector))return editor=selector,isNull(self.get(editor.id))?null:(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor}),0===editors.length&&window.removeEventListener("beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(editors.length>0),editor);each$1(DOM.select(selector),(function(elm){(editor=self.get(elm.id))&&self.remove(editor)}))}else for(i=editors.length-1;i>=0;i--)self.remove(editors[i])},execCommand:function(cmd,ui,value){var editor=this.get(value);switch(cmd){case"mceAddEditor":return this.get(value)||new Editor(value,this.settings,this).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(this.execCommand("mceAddEditor",!1,value),!0)}return!!this.activeEditor&&this.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each$1(editors,(function(editor){editor.save()}))},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!==editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor},_setBaseUrl:function(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)}});EditorManager.setup();var tasks,resultFns,extendClass,initializing,min$1=Math.min,max$1=Math.max,round$1=Math.round,relativePosition=function(rect,targetRect,rel){var x=targetRect.x,y=targetRect.y,w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,relChars=(rel||"").split("");return"b"===relChars[0]&&(y+=targetH),"r"===relChars[1]&&(x+=targetW),"c"===relChars[0]&&(y+=round$1(targetH/2)),"c"===relChars[1]&&(x+=round$1(targetW/2)),"b"===relChars[3]&&(y-=h),"r"===relChars[4]&&(x-=w),"c"===relChars[3]&&(y-=round$1(h/2)),"c"===relChars[4]&&(x-=round$1(w/2)),create$2(x,y,w,h)},create$2=function(x,y,w,h){return{x,y,w,h}},Rect={inflate:function(rect,w,h){return create$2(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h)},relativePosition,findBestRelativePosition:function(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++)if((pos=relativePosition(rect,targetRect,rels[i])).x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null},intersect:function(rect,cropRect){var x1=max$1(rect.x,cropRect.x),y1=max$1(rect.y,cropRect.y),x2=min$1(rect.x+rect.w,cropRect.x+cropRect.w),y2=min$1(rect.y+rect.h,cropRect.y+cropRect.h);return x2-x1<0||y2-y1<0?null:create$2(x1,y1,x2-x1,y2-y1)},clamp:function(rect,clampRect,fixedSize){var x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max$1(0,clampRect.x-x1),underflowY1=max$1(0,clampRect.y-y1),overflowX2=max$1(0,x2-cx2),overflowY2=max$1(0,y2-cy2);return x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),create$2(x1,y1,(x2-=overflowX2)-x1,(y2-=overflowY2)-y1)},create:create$2,fromClientRect:function(clientRect){return create$2(clientRect.left,clientRect.top,clientRect.width,clientRect.height)}},Resource=(tasks={},resultFns={},{load:function(id,url){var loadErrMsg='Script at URL "'+url+'" failed to load',runErrMsg='Script at URL "'+url+"\" did not call `tinymce.Resource.add('"+id+"', data)` within 1 second";if(void 0!==tasks[id])return tasks[id];var task=new promiseObj((function(resolve,reject){var waiter=function(resolveCb,rejectCb,timeout){void 0===timeout&&(timeout=1e3);var done=!1,timer=null,complete=function(completer){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||(done=!0,null!==timer&&(clearTimeout(timer),timer=null),completer.apply(null,args))}},resolve=complete(resolveCb),reject=complete(rejectCb);return{start:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||null!==timer||(timer=setTimeout((function(){return reject.apply(null,args)}),timeout))},resolve,reject}}(resolve,reject);resultFns[id]=waiter.resolve,ScriptLoader.ScriptLoader.loadScript(url,(function(){return waiter.start(runErrMsg)}),(function(){return waiter.reject(loadErrMsg)}))}));return tasks[id]=task,task},add:function(id,data){void 0!==resultFns[id]&&(resultFns[id](data),delete resultFns[id]),tasks[id]=promiseObj.resolve(data)}}),each=Tools.each,extend$1=Tools.extend,Class=function(){};Class.extend=extendClass=function(props){var _super=this.prototype,Class=function(){var i,mixins,mixin,self=this;if(!initializing&&(self.init&&self.init.apply(self,arguments),mixins=self.Mixins))for(i=mixins.length;i--;)(mixin=mixins[i]).init&&mixin.init.apply(self,arguments)},dummy=function(){return this};initializing=!0;var prototype=new this;return initializing=!1,props.Mixins&&(each(props.Mixins,(function(mixin){for(var name_1 in mixin)"init"!==name_1&&(props[name_1]=mixin[name_1])})),_super.Mixins&&(props.Mixins=_super.Mixins.concat(props.Mixins))),props.Methods&&each(props.Methods.split(","),(function(name){props[name]=dummy})),props.Properties&&each(props.Properties.split(","),(function(name){var fieldName="_"+name;props[name]=function(value){return void 0!==value?(this[fieldName]=value,this):this[fieldName]}})),props.Statics&&each(props.Statics,(function(func,name){Class[name]=func})),props.Defaults&&_super.Defaults&&(props.Defaults=extend$1({},_super.Defaults,props.Defaults)),each$j(props,(function(member,name){"function"==typeof member&&_super[name]?prototype[name]=function(name,fn){return function(){var self=this,tmp=self._super;self._super=_super[name];var ret=fn.apply(self,arguments);return self._super=tmp,ret}}(name,member):prototype[name]=member})),Class.prototype=prototype,Class.constructor=Class,Class.extend=extendClass,Class};var localStorage,min=Math.min,max=Math.max,round=Math.round,JSONUtils={serialize:function(obj){var data=JSON.stringify(obj);return isString$1(data)?data.replace(/[\u0080-\uFFFF]/g,(function(match){var hexCode=match.charCodeAt(0).toString(16);return"\\u"+"0000".substring(hexCode.length)+hexCode})):data},parse:function(text){try{return JSON.parse(text)}catch(ex){}}},JSONP={callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=void 0!==settings.count?settings.count:self.count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id,src:settings.url,type:"text/javascript"}),self.count++}},XHR=__assign(__assign({},Observable),{send:function(settings){var xhr,count=0,ready=function(){!settings.async||4===xhr.readyState||count++>1e4?(settings.success&&count<1e4&&200===xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,count>1e4?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):Delay.setTimeout(ready,10)};if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=!1!==settings.async,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings}),(xhr=new XMLHttpRequest).overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,(function(header){xhr.setRequestHeader(header.key,header.value)})),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),(xhr=XHR.fire("beforeSend",{xhr,settings}).xhr).send(settings.data),!settings.async)return ready();Delay.setTimeout(ready,10)}}),extend=Tools.extend,JSONRequest=function(){function JSONRequest(settings){this.settings=extend({},settings),this.count=0}return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype.send=function(args){var ecb=args.error,scb=args.success,xhrArgs=extend(this.settings,args);xhrArgs.success=function(c,x){void 0===(c=JSONUtils.parse(c))&&(c={error:"JSON Parse error."}),c.error?ecb.call(xhrArgs.error_scope||xhrArgs.scope,c.error,x):scb.call(xhrArgs.success_scope||xhrArgs.scope,c.result)},xhrArgs.error=function(ty,x){ecb&&ecb.call(xhrArgs.error_scope||xhrArgs.scope,ty,x)},xhrArgs.data=JSONUtils.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),xhrArgs.content_type="application/json",XHR.send(xhrArgs)},JSONRequest}();try{var test="__storage_test__";(localStorage=window.localStorage).setItem(test,test),localStorage.removeItem(test)}catch(e){localStorage=function(){var data={},keys=[],storage={getItem:function(key){return data[key]||null},setItem:function(key,value){keys.push(key),data[key]=String(value)},key:function(index){return keys[index]},removeItem:function(key){keys=keys.filter((function(k){return k===key})),delete data[key]},clear:function(){keys=[],data={}},length:0};return Object.defineProperty(storage,"length",{get:function(){return keys.length},configurable:!1,enumerable:!1}),storage}()}var publicApi={geom:{Rect},util:{Promise:promiseObj,Delay,Tools,VK,URI,Class,EventDispatcher,Observable,I18n,XHR,JSON:JSONUtils,JSONRequest,JSONP,LocalStorage:localStorage,Color:function(value){var self={},r=0,g=0,b=0,parse=function(value){var matches;return"object"==typeof value?"r"in value?(r=value.r,g=value.g,b=value.b):"v"in value&&function(hue,saturation,brightness){if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0!==saturation){var side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round(255*(r+match)),g=round(255*(g+match)),b=round(255*(b+match))}else r=g=b=round(255*brightness)}(value.h,value.s,value.v):(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16)),r=r<0?0:r>255?255:r,g=g<0?0:g>255?255:g,b=b<0?0:b>255?255:b,self};return value&&parse(value),self.toRgb=function(){return{r,g,b}},self.toHsv=function(){return function(r,g,b){var s,v;v=0;var minRGB=min(r/=255,min(g/=255,b/=255)),maxRGB=max(r,max(g,b));return minRGB===maxRGB?{h:0,s:0,v:100*(v=minRGB)}:(s=(maxRGB-minRGB)/maxRGB,v=maxRGB,{h:round(60*((r===minRGB?3:b===minRGB?1:5)-(r===minRGB?g-b:b===minRGB?r-g:b-r)/(maxRGB-minRGB))),s:round(100*s),v:round(100*v)})}(r,g,b)},self.toHex=function(){var hex=function(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val};return"#"+hex(r)+hex(g)+hex(b)},self.parse=parse,self},ImageUploader:function(editor){var uploadStatus=UploadStatus(),uploader=createUploader(editor,uploadStatus);return{upload:function(blobInfos,showNotification){return void 0===showNotification&&(showNotification=!0),uploader.upload(blobInfos,showNotification?openNotification(editor):void 0)}}}},dom:{EventUtils,Sizzle,DomQuery,TreeWalker:DomTreeWalker,TextSeeker,DOMUtils,ScriptLoader,RangeUtils,Serializer:DomSerializer,StyleSheetLoader,ControlSelection,BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles,Entities,Node:AstNode,Schema,SaxParser,DomParser,Writer,Serializer:HtmlSerializer},Env,AddOnManager,Annotator,Formatter,UndoManager,EditorCommands,WindowManager,NotificationManager,EditorObservable,Shortcuts,Editor,FocusManager,EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager,ThemeManager,IconManager,Resource,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac},tinymce=Tools.extend(EditorManager,publicApi);!function(tinymce){window.tinymce=tinymce,window.tinyMCE=tinymce}(tinymce),function(tinymce){if("object"==typeof module)try{module.exports=tinymce}catch(_){}}(tinymce)}();